!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.THREE={})}(this,function(e){"use strict";function t(){}void 0===Number.EPSILON&&(Number.EPSILON=Math.pow(2,-52)),void 0===Number.isInteger&&(Number.isInteger=function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e}),void 0===Math.sign&&(Math.sign=function(e){return e<0?-1:0<e?1:+e}),"name"in Function.prototype==!1&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*([^\(\s]*)/)[1]}}),void 0===Object.assign&&(Object.assign=function(e){if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),r=1;r<arguments.length;r++){var i=arguments[r];if(null!=i)for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t}),Object.assign(t.prototype,{addEventListener:function(e,t){void 0===this._listeners&&(this._listeners={});var r=this._listeners;void 0===r[e]&&(r[e]=[]),-1===r[e].indexOf(t)&&r[e].push(t)},hasEventListener:function(e,t){if(void 0===this._listeners)return!1;var r=this._listeners;return void 0!==r[e]&&-1!==r[e].indexOf(t)},removeEventListener:function(e,t){if(void 0!==this._listeners){var r=this._listeners[e];if(void 0!==r){var i=r.indexOf(t);-1!==i&&r.splice(i,1)}}},dispatchEvent:function(e){if(void 0!==this._listeners){var t=this._listeners[e.type];if(void 0!==t){e.target=this;for(var r=t.slice(0),i=0,n=r.length;i<n;i++)r[i].call(this,e)}}}});var r,i,u,h,n,o,a,s,l,c,p,d,f,m,g,v,y,b,x,E,_,w,W=0,X=1,Y=2,D=1,U=2,k=0,we=1,ee=2,T=0,M=2,Q=0,J=1,Z=2,K=3,$=4,te=5,re=100,S=101,R=102,P=103,A=104,C=200,L=201,O=202,H=203,F=204,I=205,j=206,N=207,V=208,B=209,z=210,ie=0,ne=1,oe=2,ae=3,se=4,le=5,ce=6,ue=7,q=0,G=1,he=2,pe=0,Te=1,de=2,fe=3,me=4,ge=5,ve=301,ye=302,be=303,xe=304,Ee=305,_e=306,Me=307,Se=1e3,Re=1001,Pe=1002,Ae=1003,Ce=1004,Le=1005,Oe=1006,He=1007,Fe=1008,ke=1009,Ie=1010,je=1011,Ne=1012,De=1013,Ue=1014,Ve=1015,Be=1016,ze=1017,qe=1018,Ge=1019,We=1020,Xe=1021,Ye=1022,Qe=1023,Je=1024,Ze=1025,Ke=Qe,$e=1026,et=1027,tt=1028,rt=33776,it=33777,nt=33778,ot=33779,at=35840,st=35841,lt=35842,ct=35843,ut=36196,ht=37808,pt=37809,dt=37810,ft=37811,mt=37812,gt=37813,vt=37814,yt=37815,bt=37816,xt=37817,Et=37818,_t=37819,wt=37820,Tt=37821,Mt=2300,St=2301,Rt=2400,Pt=2401,At=2402,Ct=0,Lt=3e3,Ot=3001,Ht=3007,Ft=3002,kt=3004,It=3005,jt=3006,Nt=3200,Dt=3201,Ut=0,Vt=1,Bt={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){for(var n=[],e=0;e<256;e++)n[e]=(e<16?"0":"")+e.toString(16);return function(){var e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,r=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return(n[255&e]+n[e>>8&255]+n[e>>16&255]+n[e>>24&255]+"-"+n[255&t]+n[t>>8&255]+"-"+n[t>>16&15|64]+n[t>>24&255]+"-"+n[63&r|128]+n[r>>8&255]+"-"+n[r>>16&255]+n[r>>24&255]+n[255&i]+n[i>>8&255]+n[i>>16&255]+n[i>>24&255]).toUpperCase()}}(),clamp:function(e,t,r){return Math.max(t,Math.min(r,e))},euclideanModulo:function(e,t){return(e%t+t)%t},mapLinear:function(e,t,r,i,n){return i+(e-t)*(n-i)/(r-t)},lerp:function(e,t,r){return(1-r)*e+r*t},smoothstep:function(e,t,r){return e<=t?0:r<=e?1:(e=(e-t)/(r-t))*e*(3-2*e)},smootherstep:function(e,t,r){return e<=t?0:r<=e?1:(e=(e-t)/(r-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},degToRad:function(e){return e*Bt.DEG2RAD},radToDeg:function(e){return e*Bt.RAD2DEG},isPowerOfTwo:function(e){return 0==(e&e-1)&&0!==e},ceilPowerOfTwo:function(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},floorPowerOfTwo:function(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}};function zt(e,t){this.x=e||0,this.y=t||0}function qt(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],0<arguments.length&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}function Gt(e,t,r,i){this._x=e||0,this._y=t||0,this._z=r||0,this._w=void 0!==i?i:1}function Wt(e,t,r){this.x=e||0,this.y=t||0,this.z=r||0}function Xt(){this.elements=[1,0,0,0,1,0,0,0,1],0<arguments.length&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}Object.defineProperties(zt.prototype,{width:{get:function(){return this.x},set:function(e){this.x=e}},height:{get:function(){return this.y},set:function(e){this.y=e}}}),Object.assign(zt.prototype,{isVector2:!0,set:function(e,t){return this.x=e,this.y=t,this},setScalar:function(e){return this.x=e,this.y=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(e){return this.x=e.x,this.y=e.y,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)},addScalar:function(e){return this.x+=e,this.y+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)},subScalar:function(e){return this.x-=e,this.y-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this},multiply:function(e){return this.x*=e.x,this.y*=e.y,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this},divide:function(e){return this.x/=e.x,this.y/=e.y,this},divideScalar:function(e){return this.multiplyScalar(1/e)},applyMatrix3:function(e){var t=this.x,r=this.y,i=e.elements;return this.x=i[0]*t+i[3]*r+i[6],this.y=i[1]*t+i[4]*r+i[7],this},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this},clampScalar:(r=new zt,i=new zt,function(e,t){return r.set(e,e),i.set(t,t),this.clamp(r,i)}),clampLength:function(e,t){var r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(e){return this.x*e.x+this.y*e.y},cross:function(e){return this.x*e.y-this.y*e.x},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length()||1)},angle:function(){var e=Math.atan2(this.y,this.x);return e<0&&(e+=2*Math.PI),e},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,r=this.y-e.y;return t*t+r*r},manhattanDistanceTo:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this},lerpVectors:function(e,t,r){return this.subVectors(t,e).multiplyScalar(r).add(e)},equals:function(e){return e.x===this.x&&e.y===this.y},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e},fromBufferAttribute:function(e,t,r){return void 0!==r&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this},rotateAround:function(e,t){var r=Math.cos(t),i=Math.sin(t),n=this.x-e.x,o=this.y-e.y;return this.x=n*r-o*i+e.x,this.y=n*i+o*r+e.y,this}}),Object.assign(qt.prototype,{isMatrix4:!0,set:function(e,t,r,i,n,o,a,s,l,c,u,h,p,d,f,m){var g=this.elements;return g[0]=e,g[4]=t,g[8]=r,g[12]=i,g[1]=n,g[5]=o,g[9]=a,g[13]=s,g[2]=l,g[6]=c,g[10]=u,g[14]=h,g[3]=p,g[7]=d,g[11]=f,g[15]=m,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return(new qt).fromArray(this.elements)},copy:function(e){var t=this.elements,r=e.elements;return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],t[9]=r[9],t[10]=r[10],t[11]=r[11],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15],this},copyPosition:function(e){var t=this.elements,r=e.elements;return t[12]=r[12],t[13]=r[13],t[14]=r[14],this},extractBasis:function(e,t,r){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),r.setFromMatrixColumn(this,2),this},makeBasis:function(e,t,r){return this.set(e.x,t.x,r.x,0,e.y,t.y,r.y,0,e.z,t.z,r.z,0,0,0,0,1),this},extractRotation:(p=new Wt,function(e){var t=this.elements,r=e.elements,i=1/p.setFromMatrixColumn(e,0).length(),n=1/p.setFromMatrixColumn(e,1).length(),o=1/p.setFromMatrixColumn(e,2).length();return t[0]=r[0]*i,t[1]=r[1]*i,t[2]=r[2]*i,t[3]=0,t[4]=r[4]*n,t[5]=r[5]*n,t[6]=r[6]*n,t[7]=0,t[8]=r[8]*o,t[9]=r[9]*o,t[10]=r[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}),makeRotationFromEuler:function(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var t=this.elements,r=e.x,i=e.y,n=e.z,o=Math.cos(r),a=Math.sin(r),s=Math.cos(i),l=Math.sin(i),c=Math.cos(n),u=Math.sin(n);if("XYZ"===e.order){var h=o*c,p=o*u,d=a*c,f=a*u;t[0]=s*c,t[4]=-s*u,t[8]=l,t[1]=p+d*l,t[5]=h-f*l,t[9]=-a*s,t[2]=f-h*l,t[6]=d+p*l,t[10]=o*s}else if("YXZ"===e.order){var m=s*c,g=s*u,v=l*c,y=l*u;t[0]=m+y*a,t[4]=v*a-g,t[8]=o*l,t[1]=o*u,t[5]=o*c,t[9]=-a,t[2]=g*a-v,t[6]=y+m*a,t[10]=o*s}else if("ZXY"===e.order){m=s*c,g=s*u,v=l*c,y=l*u;t[0]=m-y*a,t[4]=-o*u,t[8]=v+g*a,t[1]=g+v*a,t[5]=o*c,t[9]=y-m*a,t[2]=-o*l,t[6]=a,t[10]=o*s}else if("ZYX"===e.order){h=o*c,p=o*u,d=a*c,f=a*u;t[0]=s*c,t[4]=d*l-p,t[8]=h*l+f,t[1]=s*u,t[5]=f*l+h,t[9]=p*l-d,t[2]=-l,t[6]=a*s,t[10]=o*s}else if("YZX"===e.order){var b=o*s,x=o*l,E=a*s,_=a*l;t[0]=s*c,t[4]=_-b*u,t[8]=E*u+x,t[1]=u,t[5]=o*c,t[9]=-a*c,t[2]=-l*c,t[6]=x*u+E,t[10]=b-_*u}else if("XZY"===e.order){b=o*s,x=o*l,E=a*s,_=a*l;t[0]=s*c,t[4]=-u,t[8]=l*c,t[1]=b*u+_,t[5]=o*c,t[9]=x*u-E,t[2]=E*u-x,t[6]=a*c,t[10]=_*u+b}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},makeRotationFromQuaternion:(l=new Wt(0,0,0),c=new Wt(1,1,1),function(e){return this.compose(l,e,c)}),lookAt:(o=new Wt,a=new Wt,s=new Wt,function(e,t,r){var i=this.elements;return s.subVectors(e,t),0===s.lengthSq()&&(s.z=1),s.normalize(),o.crossVectors(r,s),0===o.lengthSq()&&(1===Math.abs(r.z)?s.x+=1e-4:s.z+=1e-4,s.normalize(),o.crossVectors(r,s)),o.normalize(),a.crossVectors(s,o),i[0]=o.x,i[4]=a.x,i[8]=s.x,i[1]=o.y,i[5]=a.y,i[9]=s.y,i[2]=o.z,i[6]=a.z,i[10]=s.z,this}),multiply:function(e,t){return void 0!==t?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)},premultiply:function(e){return this.multiplyMatrices(e,this)},multiplyMatrices:function(e,t){var r=e.elements,i=t.elements,n=this.elements,o=r[0],a=r[4],s=r[8],l=r[12],c=r[1],u=r[5],h=r[9],p=r[13],d=r[2],f=r[6],m=r[10],g=r[14],v=r[3],y=r[7],b=r[11],x=r[15],E=i[0],_=i[4],w=i[8],T=i[12],M=i[1],S=i[5],R=i[9],P=i[13],A=i[2],C=i[6],L=i[10],O=i[14],H=i[3],F=i[7],k=i[11],I=i[15];return n[0]=o*E+a*M+s*A+l*H,n[4]=o*_+a*S+s*C+l*F,n[8]=o*w+a*R+s*L+l*k,n[12]=o*T+a*P+s*O+l*I,n[1]=c*E+u*M+h*A+p*H,n[5]=c*_+u*S+h*C+p*F,n[9]=c*w+u*R+h*L+p*k,n[13]=c*T+u*P+h*O+p*I,n[2]=d*E+f*M+m*A+g*H,n[6]=d*_+f*S+m*C+g*F,n[10]=d*w+f*R+m*L+g*k,n[14]=d*T+f*P+m*O+g*I,n[3]=v*E+y*M+b*A+x*H,n[7]=v*_+y*S+b*C+x*F,n[11]=v*w+y*R+b*L+x*k,n[15]=v*T+y*P+b*O+x*I,this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this},applyToBufferAttribute:(n=new Wt,function(e){for(var t=0,r=e.count;t<r;t++)n.x=e.getX(t),n.y=e.getY(t),n.z=e.getZ(t),n.applyMatrix4(this),e.setXYZ(t,n.x,n.y,n.z);return e}),determinant:function(){var e=this.elements,t=e[0],r=e[4],i=e[8],n=e[12],o=e[1],a=e[5],s=e[9],l=e[13],c=e[2],u=e[6],h=e[10],p=e[14];return e[3]*(+n*s*u-i*l*u-n*a*h+r*l*h+i*a*p-r*s*p)+e[7]*(+t*s*p-t*l*h+n*o*h-i*o*p+i*l*c-n*s*c)+e[11]*(+t*l*u-t*a*p-n*o*u+r*o*p+n*a*c-r*l*c)+e[15]*(-i*a*c-t*s*u+t*a*h+i*o*u-r*o*h+r*s*c)},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this},setPosition:function(e){var t=this.elements;return t[12]=e.x,t[13]=e.y,t[14]=e.z,this},getInverse:function(e,t){var r=this.elements,i=e.elements,n=i[0],o=i[1],a=i[2],s=i[3],l=i[4],c=i[5],u=i[6],h=i[7],p=i[8],d=i[9],f=i[10],m=i[11],g=i[12],v=i[13],y=i[14],b=i[15],x=d*y*h-v*f*h+v*u*m-c*y*m-d*u*b+c*f*b,E=g*f*h-p*y*h-g*u*m+l*y*m+p*u*b-l*f*b,_=p*v*h-g*d*h+g*c*m-l*v*m-p*c*b+l*d*b,w=g*d*u-p*v*u-g*c*f+l*v*f+p*c*y-l*d*y,T=n*x+o*E+a*_+s*w;if(0===T){var M="THREE.Matrix4: .getInverse() can't invert matrix, determinant is 0";if(!0===t)throw new Error(M);return console.warn(M),this.identity()}var S=1/T;return r[0]=x*S,r[1]=(v*f*s-d*y*s-v*a*m+o*y*m+d*a*b-o*f*b)*S,r[2]=(c*y*s-v*u*s+v*a*h-o*y*h-c*a*b+o*u*b)*S,r[3]=(d*u*s-c*f*s-d*a*h+o*f*h+c*a*m-o*u*m)*S,r[4]=E*S,r[5]=(p*y*s-g*f*s+g*a*m-n*y*m-p*a*b+n*f*b)*S,r[6]=(g*u*s-l*y*s-g*a*h+n*y*h+l*a*b-n*u*b)*S,r[7]=(l*f*s-p*u*s+p*a*h-n*f*h-l*a*m+n*u*m)*S,r[8]=_*S,r[9]=(g*d*s-p*v*s-g*o*m+n*v*m+p*o*b-n*d*b)*S,r[10]=(l*v*s-g*c*s+g*o*h-n*v*h-l*o*b+n*c*b)*S,r[11]=(p*c*s-l*d*s-p*o*h+n*d*h+l*o*m-n*c*m)*S,r[12]=w*S,r[13]=(p*v*a-g*d*a+g*o*f-n*v*f-p*o*y+n*d*y)*S,r[14]=(g*c*a-l*v*a-g*o*u+n*v*u+l*o*y-n*c*y)*S,r[15]=(l*d*a-p*c*a+p*o*u-n*d*u-l*o*f+n*c*f)*S,this},scale:function(e){var t=this.elements,r=e.x,i=e.y,n=e.z;return t[0]*=r,t[4]*=i,t[8]*=n,t[1]*=r,t[5]*=i,t[9]*=n,t[2]*=r,t[6]*=i,t[10]*=n,t[3]*=r,t[7]*=i,t[11]*=n,this},getMaxScaleOnAxis:function(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],r=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,r,i))},makeTranslation:function(e,t,r){return this.set(1,0,0,e,0,1,0,t,0,0,1,r,0,0,0,1),this},makeRotationX:function(e){var t=Math.cos(e),r=Math.sin(e);return this.set(1,0,0,0,0,t,-r,0,0,r,t,0,0,0,0,1),this},makeRotationY:function(e){var t=Math.cos(e),r=Math.sin(e);return this.set(t,0,r,0,0,1,0,0,-r,0,t,0,0,0,0,1),this},makeRotationZ:function(e){var t=Math.cos(e),r=Math.sin(e);return this.set(t,-r,0,0,r,t,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(e,t){var r=Math.cos(t),i=Math.sin(t),n=1-r,o=e.x,a=e.y,s=e.z,l=n*o,c=n*a;return this.set(l*o+r,l*a-i*s,l*s+i*a,0,l*a+i*s,c*a+r,c*s-i*o,0,l*s-i*a,c*s+i*o,n*s*s+r,0,0,0,0,1),this},makeScale:function(e,t,r){return this.set(e,0,0,0,0,t,0,0,0,0,r,0,0,0,0,1),this},makeShear:function(e,t,r){return this.set(1,t,r,0,e,1,r,0,e,t,1,0,0,0,0,1),this},compose:function(e,t,r){var i=this.elements,n=t._x,o=t._y,a=t._z,s=t._w,l=n+n,c=o+o,u=a+a,h=n*l,p=n*c,d=n*u,f=o*c,m=o*u,g=a*u,v=s*l,y=s*c,b=s*u,x=r.x,E=r.y,_=r.z;return i[0]=(1-(f+g))*x,i[1]=(p+b)*x,i[2]=(d-y)*x,i[3]=0,i[4]=(p-b)*E,i[5]=(1-(h+g))*E,i[6]=(m+v)*E,i[7]=0,i[8]=(d+y)*_,i[9]=(m-v)*_,i[10]=(1-(h+f))*_,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,this},decompose:(u=new Wt,h=new qt,function(e,t,r){var i=this.elements,n=u.set(i[0],i[1],i[2]).length(),o=u.set(i[4],i[5],i[6]).length(),a=u.set(i[8],i[9],i[10]).length();this.determinant()<0&&(n=-n),e.x=i[12],e.y=i[13],e.z=i[14],h.copy(this);var s=1/n,l=1/o,c=1/a;return h.elements[0]*=s,h.elements[1]*=s,h.elements[2]*=s,h.elements[4]*=l,h.elements[5]*=l,h.elements[6]*=l,h.elements[8]*=c,h.elements[9]*=c,h.elements[10]*=c,t.setFromRotationMatrix(h),r.x=n,r.y=o,r.z=a,this}),makePerspective:function(e,t,r,i,n,o){void 0===o&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");var a=this.elements,s=2*n/(t-e),l=2*n/(r-i),c=(t+e)/(t-e),u=(r+i)/(r-i),h=-(o+n)/(o-n),p=-2*o*n/(o-n);return a[0]=s,a[4]=0,a[8]=c,a[12]=0,a[1]=0,a[5]=l,a[9]=u,a[13]=0,a[2]=0,a[6]=0,a[10]=h,a[14]=p,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this},makeOrthographic:function(e,t,r,i,n,o){var a=this.elements,s=1/(t-e),l=1/(r-i),c=1/(o-n),u=(t+e)*s,h=(r+i)*l,p=(o+n)*c;return a[0]=2*s,a[4]=0,a[8]=0,a[12]=-u,a[1]=0,a[5]=2*l,a[9]=0,a[13]=-h,a[2]=0,a[6]=0,a[10]=-2*c,a[14]=-p,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this},equals:function(e){for(var t=this.elements,r=e.elements,i=0;i<16;i++)if(t[i]!==r[i])return!1;return!0},fromArray:function(e,t){void 0===t&&(t=0);for(var r=0;r<16;r++)this.elements[r]=e[r+t];return this},toArray:function(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);var r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e[t+9]=r[9],e[t+10]=r[10],e[t+11]=r[11],e[t+12]=r[12],e[t+13]=r[13],e[t+14]=r[14],e[t+15]=r[15],e}}),Object.assign(Gt,{slerp:function(e,t,r,i){return r.copy(e).slerp(t,i)},slerpFlat:function(e,t,r,i,n,o,a){var s=r[i+0],l=r[i+1],c=r[i+2],u=r[i+3],h=n[o+0],p=n[o+1],d=n[o+2],f=n[o+3];if(u!==f||s!==h||l!==p||c!==d){var m=1-a,g=s*h+l*p+c*d+u*f,v=0<=g?1:-1,y=1-g*g;if(y>Number.EPSILON){var b=Math.sqrt(y),x=Math.atan2(b,g*v);m=Math.sin(m*x)/b,a=Math.sin(a*x)/b}var E=a*v;if(s=s*m+h*E,l=l*m+p*E,c=c*m+d*E,u=u*m+f*E,m===1-a){var _=1/Math.sqrt(s*s+l*l+c*c+u*u);s*=_,l*=_,c*=_,u*=_}}e[t]=s,e[t+1]=l,e[t+2]=c,e[t+3]=u}}),Object.defineProperties(Gt.prototype,{x:{get:function(){return this._x},set:function(e){this._x=e,this.onChangeCallback()}},y:{get:function(){return this._y},set:function(e){this._y=e,this.onChangeCallback()}},z:{get:function(){return this._z},set:function(e){this._z=e,this.onChangeCallback()}},w:{get:function(){return this._w},set:function(e){this._w=e,this.onChangeCallback()}}}),Object.assign(Gt.prototype,{isQuaternion:!0,set:function(e,t,r,i){return this._x=e,this._y=t,this._z=r,this._w=i,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this.onChangeCallback(),this},setFromEuler:function(e,t){if(!e||!e.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var r=e._x,i=e._y,n=e._z,o=e.order,a=Math.cos,s=Math.sin,l=a(r/2),c=a(i/2),u=a(n/2),h=s(r/2),p=s(i/2),d=s(n/2);return"XYZ"===o?(this._x=h*c*u+l*p*d,this._y=l*p*u-h*c*d,this._z=l*c*d+h*p*u,this._w=l*c*u-h*p*d):"YXZ"===o?(this._x=h*c*u+l*p*d,this._y=l*p*u-h*c*d,this._z=l*c*d-h*p*u,this._w=l*c*u+h*p*d):"ZXY"===o?(this._x=h*c*u-l*p*d,this._y=l*p*u+h*c*d,this._z=l*c*d+h*p*u,this._w=l*c*u-h*p*d):"ZYX"===o?(this._x=h*c*u-l*p*d,this._y=l*p*u+h*c*d,this._z=l*c*d-h*p*u,this._w=l*c*u+h*p*d):"YZX"===o?(this._x=h*c*u+l*p*d,this._y=l*p*u+h*c*d,this._z=l*c*d-h*p*u,this._w=l*c*u-h*p*d):"XZY"===o&&(this._x=h*c*u-l*p*d,this._y=l*p*u-h*c*d,this._z=l*c*d+h*p*u,this._w=l*c*u+h*p*d),!1!==t&&this.onChangeCallback(),this},setFromAxisAngle:function(e,t){var r=t/2,i=Math.sin(r);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(r),this.onChangeCallback(),this},setFromRotationMatrix:function(e){var t,r=e.elements,i=r[0],n=r[4],o=r[8],a=r[1],s=r[5],l=r[9],c=r[2],u=r[6],h=r[10],p=i+s+h;return this._z=0<p?(t=.5/Math.sqrt(p+1),this._w=.25/t,this._x=(u-l)*t,this._y=(o-c)*t,(a-n)*t):s<i&&h<i?(t=2*Math.sqrt(1+i-s-h),this._w=(u-l)/t,this._x=.25*t,this._y=(n+a)/t,(o+c)/t):h<s?(t=2*Math.sqrt(1+s-i-h),this._w=(o-c)/t,this._x=(n+a)/t,this._y=.25*t,(l+u)/t):(t=2*Math.sqrt(1+h-i-s),this._w=(a-n)/t,this._x=(o+c)/t,this._y=(l+u)/t,.25*t),this.onChangeCallback(),this},setFromUnitVectors:(f=new Wt,function(e,t){return void 0===f&&(f=new Wt),(d=e.dot(t)+1)<1e-6?(d=0,Math.abs(e.x)>Math.abs(e.z)?f.set(-e.y,e.x,0):f.set(0,-e.z,e.y)):f.crossVectors(e,t),this._x=f.x,this._y=f.y,this._z=f.z,this._w=d,this.normalize()}),angleTo:function(e){return 2*Math.acos(Math.abs(Bt.clamp(this.dot(e),-1,1)))},rotateTowards:function(e,t){var r=this.angleTo(e);if(0===r)return this;var i=Math.min(1,t/r);return this.slerp(e,i),this},inverse:function(){return this.conjugate()},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this.onChangeCallback(),this},dot:function(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var e=this.length();return this._w=0===e?(this._x=0,this._y=0,this._z=0,1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w*e),this.onChangeCallback(),this},multiply:function(e,t){return void 0!==t?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)},premultiply:function(e){return this.multiplyQuaternions(e,this)},multiplyQuaternions:function(e,t){var r=e._x,i=e._y,n=e._z,o=e._w,a=t._x,s=t._y,l=t._z,c=t._w;return this._x=r*c+o*a+i*l-n*s,this._y=i*c+o*s+n*a-r*l,this._z=n*c+o*l+r*s-i*a,this._w=o*c-r*a-i*s-n*l,this.onChangeCallback(),this},slerp:function(e,t){if(0===t)return this;if(1===t)return this.copy(e);var r=this._x,i=this._y,n=this._z,o=this._w,a=o*e._w+r*e._x+i*e._y+n*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),1<=a)return this._w=o,this._x=r,this._y=i,this._z=n,this;var s=1-a*a;if(s<=Number.EPSILON){var l=1-t;return this._w=l*o+t*this._w,this._x=l*r+t*this._x,this._y=l*i+t*this._y,this._z=l*n+t*this._z,this.normalize()}var c=Math.sqrt(s),u=Math.atan2(c,a),h=Math.sin((1-t)*u)/c,p=Math.sin(t*u)/c;return this._w=o*h+this._w*p,this._x=r*h+this._x*p,this._y=i*h+this._y*p,this._z=n*h+this._z*p,this.onChangeCallback(),this},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w},fromArray:function(e,t){return void 0===t&&(t=0),this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this.onChangeCallback(),this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e},onChange:function(e){return this.onChangeCallback=e,this},onChangeCallback:function(){}}),Object.assign(Wt.prototype,{isVector3:!0,set:function(e,t,r){return this.x=e,this.y=t,this.z=r,this},setScalar:function(e){return this.x=e,this.y=e,this.z=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this},multiply:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this},multiplyVectors:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this},applyEuler:(E=new Gt,function(e){return e&&e.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(E.setFromEuler(e))}),applyAxisAngle:(x=new Gt,function(e,t){return this.applyQuaternion(x.setFromAxisAngle(e,t))}),applyMatrix3:function(e){var t=this.x,r=this.y,i=this.z,n=e.elements;return this.x=n[0]*t+n[3]*r+n[6]*i,this.y=n[1]*t+n[4]*r+n[7]*i,this.z=n[2]*t+n[5]*r+n[8]*i,this},applyMatrix4:function(e){var t=this.x,r=this.y,i=this.z,n=e.elements,o=1/(n[3]*t+n[7]*r+n[11]*i+n[15]);return this.x=(n[0]*t+n[4]*r+n[8]*i+n[12])*o,this.y=(n[1]*t+n[5]*r+n[9]*i+n[13])*o,this.z=(n[2]*t+n[6]*r+n[10]*i+n[14])*o,this},applyQuaternion:function(e){var t=this.x,r=this.y,i=this.z,n=e.x,o=e.y,a=e.z,s=e.w,l=s*t+o*i-a*r,c=s*r+a*t-n*i,u=s*i+n*r-o*t,h=-n*t-o*r-a*i;return this.x=l*s+h*-n+c*-a-u*-o,this.y=c*s+h*-o+u*-n-l*-a,this.z=u*s+h*-a+l*-o-c*-n,this},project:function(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)},unproject:(b=new qt,function(e){return this.applyMatrix4(b.getInverse(e.projectionMatrix)).applyMatrix4(e.matrixWorld)}),transformDirection:function(e){var t=this.x,r=this.y,i=this.z,n=e.elements;return this.x=n[0]*t+n[4]*r+n[8]*i,this.y=n[1]*t+n[5]*r+n[9]*i,this.z=n[2]*t+n[6]*r+n[10]*i,this.normalize()},divide:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this},divideScalar:function(e){return this.multiplyScalar(1/e)},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this},clampScalar:(v=new Wt,y=new Wt,function(e,t){return v.set(e,e,e),y.set(t,t,t),this.clamp(v,y)}),clampLength:function(e,t){var r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this},lerpVectors:function(e,t,r){return this.subVectors(t,e).multiplyScalar(r).add(e)},cross:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t)):this.crossVectors(this,e)},crossVectors:function(e,t){var r=e.x,i=e.y,n=e.z,o=t.x,a=t.y,s=t.z;return this.x=i*s-n*a,this.y=n*o-r*s,this.z=r*a-i*o,this},projectOnVector:function(e){var t=e.dot(this)/e.lengthSq();return this.copy(e).multiplyScalar(t)},projectOnPlane:(g=new Wt,function(e){return g.copy(this).projectOnVector(e),this.sub(g)}),reflect:(m=new Wt,function(e){return this.sub(m.copy(e).multiplyScalar(2*this.dot(e)))}),angleTo:function(e){var t=this.dot(e)/Math.sqrt(this.lengthSq()*e.lengthSq());return Math.acos(Bt.clamp(t,-1,1))},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,r=this.y-e.y,i=this.z-e.z;return t*t+r*r+i*i},manhattanDistanceTo:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)},setFromSpherical:function(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)},setFromSphericalCoords:function(e,t,r){var i=Math.sin(t)*e;return this.x=i*Math.sin(r),this.y=Math.cos(t)*e,this.z=i*Math.cos(r),this},setFromCylindrical:function(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)},setFromCylindricalCoords:function(e,t,r){return this.x=e*Math.sin(t),this.y=r,this.z=e*Math.cos(t),this},setFromMatrixPosition:function(e){var t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this},setFromMatrixScale:function(e){var t=this.setFromMatrixColumn(e,0).length(),r=this.setFromMatrixColumn(e,1).length(),i=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=r,this.z=i,this},setFromMatrixColumn:function(e,t){return this.fromArray(e.elements,4*t)},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e},fromBufferAttribute:function(e,t,r){return void 0!==r&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}}),Object.assign(Xt.prototype,{isMatrix3:!0,set:function(e,t,r,i,n,o,a,s,l){var c=this.elements;return c[0]=e,c[1]=i,c[2]=a,c[3]=t,c[4]=n,c[5]=s,c[6]=r,c[7]=o,c[8]=l,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function(){return(new this.constructor).fromArray(this.elements)},copy:function(e){var t=this.elements,r=e.elements;return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],this},setFromMatrix4:function(e){var t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this},applyToBufferAttribute:(_=new Wt,function(e){for(var t=0,r=e.count;t<r;t++)_.x=e.getX(t),_.y=e.getY(t),_.z=e.getZ(t),_.applyMatrix3(this),e.setXYZ(t,_.x,_.y,_.z);return e}),multiply:function(e){return this.multiplyMatrices(this,e)},premultiply:function(e){return this.multiplyMatrices(e,this)},multiplyMatrices:function(e,t){var r=e.elements,i=t.elements,n=this.elements,o=r[0],a=r[3],s=r[6],l=r[1],c=r[4],u=r[7],h=r[2],p=r[5],d=r[8],f=i[0],m=i[3],g=i[6],v=i[1],y=i[4],b=i[7],x=i[2],E=i[5],_=i[8];return n[0]=o*f+a*v+s*x,n[3]=o*m+a*y+s*E,n[6]=o*g+a*b+s*_,n[1]=l*f+c*v+u*x,n[4]=l*m+c*y+u*E,n[7]=l*g+c*b+u*_,n[2]=h*f+p*v+d*x,n[5]=h*m+p*y+d*E,n[8]=h*g+p*b+d*_,this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this},determinant:function(){var e=this.elements,t=e[0],r=e[1],i=e[2],n=e[3],o=e[4],a=e[5],s=e[6],l=e[7],c=e[8];return t*o*c-t*a*l-r*n*c+r*a*s+i*n*l-i*o*s},getInverse:function(e,t){e&&e.isMatrix4&&console.error("THREE.Matrix3: .getInverse() no longer takes a Matrix4 argument.");var r=e.elements,i=this.elements,n=r[0],o=r[1],a=r[2],s=r[3],l=r[4],c=r[5],u=r[6],h=r[7],p=r[8],d=p*l-c*h,f=c*u-p*s,m=h*s-l*u,g=n*d+o*f+a*m;if(0===g){var v="THREE.Matrix3: .getInverse() can't invert matrix, determinant is 0";if(!0===t)throw new Error(v);return console.warn(v),this.identity()}var y=1/g;return i[0]=d*y,i[1]=(a*h-p*o)*y,i[2]=(c*o-a*l)*y,i[3]=f*y,i[4]=(p*n-a*u)*y,i[5]=(a*s-c*n)*y,i[6]=m*y,i[7]=(o*u-h*n)*y,i[8]=(l*n-o*s)*y,this},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this},getNormalMatrix:function(e){return this.setFromMatrix4(e).getInverse(this).transpose()},transposeIntoArray:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this},setUvTransform:function(e,t,r,i,n,o,a){var s=Math.cos(n),l=Math.sin(n);this.set(r*s,r*l,-r*(s*o+l*a)+o+e,-i*l,i*s,-i*(-l*o+s*a)+a+t,0,0,1)},scale:function(e,t){var r=this.elements;return r[0]*=e,r[3]*=e,r[6]*=e,r[1]*=t,r[4]*=t,r[7]*=t,this},rotate:function(e){var t=Math.cos(e),r=Math.sin(e),i=this.elements,n=i[0],o=i[3],a=i[6],s=i[1],l=i[4],c=i[7];return i[0]=t*n+r*s,i[3]=t*o+r*l,i[6]=t*a+r*c,i[1]=-r*n+t*s,i[4]=-r*o+t*l,i[7]=-r*a+t*c,this},translate:function(e,t){var r=this.elements;return r[0]+=e*r[2],r[3]+=e*r[5],r[6]+=e*r[8],r[1]+=t*r[2],r[4]+=t*r[5],r[7]+=t*r[8],this},equals:function(e){for(var t=this.elements,r=e.elements,i=0;i<9;i++)if(t[i]!==r[i])return!1;return!0},fromArray:function(e,t){void 0===t&&(t=0);for(var r=0;r<9;r++)this.elements[r]=e[r+t];return this},toArray:function(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);var r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e}});var Yt,Qt,Jt,Zt,Kt,$t,er,tr,rr,ir,nr,or,ar,sr,lr,cr,ur={getDataURL:function(e){var t;if("undefined"==typeof HTMLCanvasElement)return e.src;if(e instanceof HTMLCanvasElement)t=e;else{void 0===w&&(w=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),w.width=e.width,w.height=e.height;var r=w.getContext("2d");e instanceof ImageData?r.putImageData(e,0,0):r.drawImage(e,0,0,e.width,e.height),t=w}return 2048<t.width||2048<t.height?t.toDataURL("image/jpeg",.6):t.toDataURL("image/png")}},hr=0;function pr(e,t,r,i,n,o,a,s,l,c){Object.defineProperty(this,"id",{value:hr++}),this.uuid=Bt.generateUUID(),this.name="",this.image=void 0!==e?e:pr.DEFAULT_IMAGE,this.mipmaps=[],this.mapping=void 0!==t?t:pr.DEFAULT_MAPPING,this.wrapS=void 0!==r?r:Re,this.wrapT=void 0!==i?i:Re,this.magFilter=void 0!==n?n:Oe,this.minFilter=void 0!==o?o:Fe,this.anisotropy=void 0!==l?l:1,this.format=void 0!==a?a:Qe,this.type=void 0!==s?s:ke,this.offset=new zt(0,0),this.repeat=new zt(1,1),this.center=new zt(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Xt,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=void 0!==c?c:Lt,this.version=0,this.onUpdate=null}function dr(e,t,r,i){this.x=e||0,this.y=t||0,this.z=r||0,this.w=void 0!==i?i:1}function fr(e,t,r){this.width=e,this.height=t,this.scissor=new dr(0,0,e,t),this.scissorTest=!1,this.viewport=new dr(0,0,e,t),r=r||{},this.texture=new pr(void 0,void 0,r.wrapS,r.wrapT,r.magFilter,r.minFilter,r.format,r.type,r.anisotropy,r.encoding),this.texture.generateMipmaps=void 0!==r.generateMipmaps&&r.generateMipmaps,this.texture.minFilter=void 0!==r.minFilter?r.minFilter:Oe,this.depthBuffer=void 0===r.depthBuffer||r.depthBuffer,this.stencilBuffer=void 0===r.stencilBuffer||r.stencilBuffer,this.depthTexture=void 0!==r.depthTexture?r.depthTexture:null}function mr(e,t,r){fr.call(this,e,t,r),this.samples=4}function gr(e,t,r){fr.call(this,e,t,r),this.activeCubeFace=0,this.activeMipMapLevel=0}function vr(e,t,r,i,n,o,a,s,l,c,u,h){pr.call(this,null,o,a,s,l,c,i,n,u,h),this.image={data:e,width:t,height:r},this.magFilter=void 0!==l?l:Ae,this.minFilter=void 0!==c?c:Ae,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}function yr(e,t){this.min=void 0!==e?e:new Wt(1/0,1/0,1/0),this.max=void 0!==t?t:new Wt(-1/0,-1/0,-1/0)}function br(e,t){this.center=void 0!==e?e:new Wt,this.radius=void 0!==t?t:0}function xr(e,t){this.normal=void 0!==e?e:new Wt(1,0,0),this.constant=void 0!==t?t:0}function Er(e,t,r,i,n,o){this.planes=[void 0!==e?e:new xr,void 0!==t?t:new xr,void 0!==r?r:new xr,void 0!==i?i:new xr,void 0!==n?n:new xr,void 0!==o?o:new xr]}pr.DEFAULT_IMAGE=void 0,pr.DEFAULT_MAPPING=300,pr.prototype=Object.assign(Object.create(t.prototype),{constructor:pr,isTexture:!0,updateMatrix:function(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.name=e.name,this.image=e.image,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this},toJSON:function(e){var t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];var r={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(void 0!==this.image){var i=this.image;if(void 0===i.uuid&&(i.uuid=Bt.generateUUID()),!t&&void 0===e.images[i.uuid]){var n;if(Array.isArray(i)){n=[];for(var o=0,a=i.length;o<a;o++)n.push(ur.getDataURL(i[o]))}else n=ur.getDataURL(i);e.images[i.uuid]={uuid:i.uuid,url:n}}r.image=i.uuid}return t||(e.textures[this.uuid]=r),r},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(e){if(300!==this.mapping)return e;if(e.applyMatrix3(this.matrix),e.x<0||1<e.x)switch(this.wrapS){case Se:e.x=e.x-Math.floor(e.x);break;case Re:e.x=e.x<0?0:1;break;case Pe:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||1<e.y)switch(this.wrapT){case Se:e.y=e.y-Math.floor(e.y);break;case Re:e.y=e.y<0?0:1;break;case Pe:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}}),Object.defineProperty(pr.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(dr.prototype,{isVector4:!0,set:function(e,t,r,i){return this.x=e,this.y=t,this.z=r,this.w=i,this},setScalar:function(e){return this.x=e,this.y=e,this.z=e,this.w=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setW:function(e){return this.w=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},applyMatrix4:function(e){var t=this.x,r=this.y,i=this.z,n=this.w,o=e.elements;return this.x=o[0]*t+o[4]*r+o[8]*i+o[12]*n,this.y=o[1]*t+o[5]*r+o[9]*i+o[13]*n,this.z=o[2]*t+o[6]*r+o[10]*i+o[14]*n,this.w=o[3]*t+o[7]*r+o[11]*i+o[15]*n,this},divideScalar:function(e){return this.multiplyScalar(1/e)},setAxisAngleFromQuaternion:function(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);return this.z=t<1e-4?(this.x=1,this.y=0):(this.x=e.x/t,this.y=e.y/t,e.z/t),this},setAxisAngleFromRotationMatrix:function(e){var t,r,i,n,o=e.elements,a=o[0],s=o[4],l=o[8],c=o[1],u=o[5],h=o[9],p=o[2],d=o[6],f=o[10];if(Math.abs(s-c)<.01&&Math.abs(l-p)<.01&&Math.abs(h-d)<.01){if(Math.abs(s+c)<.1&&Math.abs(l+p)<.1&&Math.abs(h+d)<.1&&Math.abs(a+u+f-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;var m=(a+1)/2,g=(u+1)/2,v=(f+1)/2,y=(s+c)/4,b=(l+p)/4,x=(h+d)/4;return g<m&&v<m?n=m<.01?(r=0,i=.707106781):(i=y/(r=Math.sqrt(m)),b/r):v<g?n=g<.01?(i=0,r=.707106781):(r=y/(i=Math.sqrt(g)),x/i):v<.01?(i=r=.707106781,n=0):(r=b/(n=Math.sqrt(v)),i=x/n),this.set(r,i,n,t),this}var E=Math.sqrt((d-h)*(d-h)+(l-p)*(l-p)+(c-s)*(c-s));return Math.abs(E)<.001&&(E=1),this.x=(d-h)/E,this.y=(l-p)/E,this.z=(c-s)/E,this.w=Math.acos((a+u+f-1)/2),this},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this},clampScalar:function(e,t){return void 0===Yt&&(Yt=new dr,Qt=new dr),Yt.set(e,e,e,e),Qt.set(t,t,t,t),this.clamp(Yt,Qt)},clampLength:function(e,t){var r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this},lerpVectors:function(e,t,r){return this.subVectors(t,e).multiplyScalar(r).add(e)},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e},fromBufferAttribute:function(e,t,r){return void 0!==r&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}}),fr.prototype=Object.assign(Object.create(t.prototype),{constructor:fr,isWebGLRenderTarget:!0,setSize:function(e,t){this.width===e&&this.height===t||(this.width=e,this.height=t,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.width=e.width,this.height=e.height,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),mr.prototype=Object.assign(Object.create(fr.prototype),{constructor:mr,isWebGLMultisampleRenderTarget:!0,copy:function(e){return fr.prototype.copy.call(this,e),this.samples=e.samples,this}}),((gr.prototype=Object.create(fr.prototype)).constructor=gr).prototype.isWebGLRenderTargetCube=!0,((vr.prototype=Object.create(pr.prototype)).constructor=vr).prototype.isDataTexture=!0,Object.assign(yr.prototype,{isBox3:!0,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromArray:function(e){for(var t=1/0,r=1/0,i=1/0,n=-1/0,o=-1/0,a=-1/0,s=0,l=e.length;s<l;s+=3){var c=e[s],u=e[s+1],h=e[s+2];c<t&&(t=c),u<r&&(r=u),h<i&&(i=h),n<c&&(n=c),o<u&&(o=u),a<h&&(a=h)}return this.min.set(t,r,i),this.max.set(n,o,a),this},setFromBufferAttribute:function(e){for(var t=1/0,r=1/0,i=1/0,n=-1/0,o=-1/0,a=-1/0,s=0,l=e.count;s<l;s++){var c=e.getX(s),u=e.getY(s),h=e.getZ(s);c<t&&(t=c),u<r&&(r=u),h<i&&(i=h),n<c&&(n=c),o<u&&(o=u),a<h&&(a=h)}return this.min.set(t,r,i),this.max.set(n,o,a),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,r=e.length;t<r;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:(er=new Wt,function(e,t){var r=er.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(r),this.max.copy(e).add(r),this}),setFromObject:function(e){return this.makeEmpty(),this.expandByObject(e)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},getCenter:function(e){return void 0===e&&(console.warn("THREE.Box3: .getCenter() target is now required"),e=new Wt),this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(e){return void 0===e&&(console.warn("THREE.Box3: .getSize() target is now required"),e=new Wt),this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},expandByObject:function(){var n,o,a,s=new Wt;function t(e){var t=e.geometry;if(void 0!==t)if(t.isGeometry){var r=t.vertices;for(o=0,a=r.length;o<a;o++)s.copy(r[o]),s.applyMatrix4(e.matrixWorld),n.expandByPoint(s)}else if(t.isBufferGeometry){var i=t.attributes.position;if(void 0!==i)for(o=0,a=i.count;o<a;o++)s.fromBufferAttribute(i,o).applyMatrix4(e.matrixWorld),n.expandByPoint(s)}}return function(e){return n=this,e.updateMatrixWorld(!0),e.traverse(t),this}}(),containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z},getParameter:function(e,t){return void 0===t&&(console.warn("THREE.Box3: .getParameter() target is now required"),t=new Wt),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)},intersectsSphere:($t=new Wt,function(e){return this.clampPoint(e.center,$t),$t.distanceToSquared(e.center)<=e.radius*e.radius}),intersectsPlane:function(e){var t,r;return r=0<e.normal.x?(t=e.normal.x*this.min.x,e.normal.x*this.max.x):(t=e.normal.x*this.max.x,e.normal.x*this.min.x),0<e.normal.y?(t+=e.normal.y*this.min.y,r+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,r+=e.normal.y*this.min.y),0<e.normal.z?(t+=e.normal.z*this.min.z,r+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,r+=e.normal.z*this.min.z),t<=-e.constant&&r>=-e.constant},intersectsTriangle:function(){var s=new Wt,l=new Wt,c=new Wt,r=new Wt,i=new Wt,n=new Wt,u=new Wt,o=new Wt,h=new Wt,a=new Wt;function p(e){var t,r;for(t=0,r=e.length-3;t<=r;t+=3){u.fromArray(e,t);var i=h.x*Math.abs(u.x)+h.y*Math.abs(u.y)+h.z*Math.abs(u.z),n=s.dot(u),o=l.dot(u),a=c.dot(u);if(Math.max(-Math.max(n,o,a),Math.min(n,o,a))>i)return!1}return!0}return function(e){if(this.isEmpty())return!1;this.getCenter(o),h.subVectors(this.max,o),s.subVectors(e.a,o),l.subVectors(e.b,o),c.subVectors(e.c,o),r.subVectors(l,s),i.subVectors(c,l),n.subVectors(s,c);var t=[0,-r.z,r.y,0,-i.z,i.y,0,-n.z,n.y,r.z,0,-r.x,i.z,0,-i.x,n.z,0,-n.x,-r.y,r.x,0,-i.y,i.x,0,-n.y,n.x,0];return!!p(t)&&(!!p(t=[1,0,0,0,1,0,0,0,1])&&(a.crossVectors(r,i),p(t=[a.x,a.y,a.z])))}}(),clampPoint:function(e,t){return void 0===t&&(console.warn("THREE.Box3: .clampPoint() target is now required"),t=new Wt),t.copy(e).clamp(this.min,this.max)},distanceToPoint:(Kt=new Wt,function(e){return Kt.copy(e).clamp(this.min,this.max).sub(e).length()}),getBoundingSphere:(Zt=new Wt,function(e){return void 0===e&&(console.warn("THREE.Box3: .getBoundingSphere() target is now required"),e=new br),this.getCenter(e.center),e.radius=.5*this.getSize(Zt).length(),e}),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},applyMatrix4:(Jt=[new Wt,new Wt,new Wt,new Wt,new Wt,new Wt,new Wt,new Wt],function(e){return this.isEmpty()||(Jt[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Jt[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Jt[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Jt[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Jt[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Jt[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Jt[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Jt[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Jt)),this}),translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}),Object.assign(br.prototype,{set:function(e,t){return this.center.copy(e),this.radius=t,this},setFromPoints:(tr=new yr,function(e,t){var r=this.center;void 0!==t?r.copy(t):tr.setFromPoints(e).getCenter(r);for(var i=0,n=0,o=e.length;n<o;n++)i=Math.max(i,r.distanceToSquared(e[n]));return this.radius=Math.sqrt(i),this}),clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.center.copy(e.center),this.radius=e.radius,this},empty:function(){return this.radius<=0},containsPoint:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(e){return e.distanceTo(this.center)-this.radius},intersectsSphere:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t},intersectsBox:function(e){return e.intersectsSphere(this)},intersectsPlane:function(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius},clampPoint:function(e,t){var r=this.center.distanceToSquared(e);return void 0===t&&(console.warn("THREE.Sphere: .clampPoint() target is now required"),t=new Wt),t.copy(e),r>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t},getBoundingBox:function(e){return void 0===e&&(console.warn("THREE.Sphere: .getBoundingBox() target is now required"),e=new yr),e.set(this.center,this.center),e.expandByScalar(this.radius),e},applyMatrix4:function(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this},translate:function(e){return this.center.add(e),this},equals:function(e){return e.center.equals(this.center)&&e.radius===this.radius}}),Object.assign(xr.prototype,{set:function(e,t){return this.normal.copy(e),this.constant=t,this},setComponents:function(e,t,r,i){return this.normal.set(e,t,r),this.constant=i,this},setFromNormalAndCoplanarPoint:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this},setFromCoplanarPoints:(or=new Wt,ar=new Wt,function(e,t,r){var i=or.subVectors(r,t).cross(ar.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(i,e),this}),clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this},normalize:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(e){return this.normal.dot(e)+this.constant},distanceToSphere:function(e){return this.distanceToPoint(e.center)-e.radius},projectPoint:function(e,t){return void 0===t&&(console.warn("THREE.Plane: .projectPoint() target is now required"),t=new Wt),t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)},intersectLine:(nr=new Wt,function(e,t){void 0===t&&(console.warn("THREE.Plane: .intersectLine() target is now required"),t=new Wt);var r=e.delta(nr),i=this.normal.dot(r);if(0===i)return 0===this.distanceToPoint(e.start)?t.copy(e.start):void 0;var n=-(e.start.dot(this.normal)+this.constant)/i;return n<0||1<n?void 0:t.copy(r).multiplyScalar(n).add(e.start)}),intersectsLine:function(e){var t=this.distanceToPoint(e.start),r=this.distanceToPoint(e.end);return t<0&&0<r||r<0&&0<t},intersectsBox:function(e){return e.intersectsPlane(this)},intersectsSphere:function(e){return e.intersectsPlane(this)},coplanarPoint:function(e){return void 0===e&&(console.warn("THREE.Plane: .coplanarPoint() target is now required"),e=new Wt),e.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:(rr=new Wt,ir=new Xt,function(e,t){var r=t||ir.getNormalMatrix(e),i=this.coplanarPoint(rr).applyMatrix4(e),n=this.normal.applyMatrix3(r).normalize();return this.constant=-i.dot(n),this}),translate:function(e){return this.constant-=e.dot(this.normal),this},equals:function(e){return e.normal.equals(this.normal)&&e.constant===this.constant}}),Object.assign(Er.prototype,{set:function(e,t,r,i,n,o){var a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(r),a[3].copy(i),a[4].copy(n),a[5].copy(o),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){for(var t=this.planes,r=0;r<6;r++)t[r].copy(e.planes[r]);return this},setFromMatrix:function(e){var t=this.planes,r=e.elements,i=r[0],n=r[1],o=r[2],a=r[3],s=r[4],l=r[5],c=r[6],u=r[7],h=r[8],p=r[9],d=r[10],f=r[11],m=r[12],g=r[13],v=r[14],y=r[15];return t[0].setComponents(a-i,u-s,f-h,y-m).normalize(),t[1].setComponents(a+i,u+s,f+h,y+m).normalize(),t[2].setComponents(a+n,u+l,f+p,y+g).normalize(),t[3].setComponents(a-n,u-l,f-p,y-g).normalize(),t[4].setComponents(a-o,u-c,f-d,y-v).normalize(),t[5].setComponents(a+o,u+c,f+d,y+v).normalize(),this},intersectsObject:(cr=new br,function(e){var t=e.geometry;return null===t.boundingSphere&&t.computeBoundingSphere(),cr.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(cr)}),intersectsSprite:(lr=new br,function(e){return lr.center.set(0,0,0),lr.radius=.7071067811865476,lr.applyMatrix4(e.matrixWorld),this.intersectsSphere(lr)}),intersectsSphere:function(e){for(var t=this.planes,r=e.center,i=-e.radius,n=0;n<6;n++){if(t[n].distanceToPoint(r)<i)return!1}return!0},intersectsBox:(sr=new Wt,function(e){for(var t=this.planes,r=0;r<6;r++){var i=t[r];if(sr.x=0<i.normal.x?e.max.x:e.min.x,sr.y=0<i.normal.y?e.max.y:e.min.y,sr.z=0<i.normal.z?e.max.z:e.min.z,i.distanceToPoint(sr)<0)return!1}return!0}),containsPoint:function(e){for(var t=this.planes,r=0;r<6;r++)if(t[r].distanceToPoint(e)<0)return!1;return!0}});var _r={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) {\n\t\tdiscard;\n\t} else {\n\t\tdiffuseColor.a = opacity;\n\t}\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );",bsdfs:"vec2 integrateSpecularBRDF( const in float dotNV, const in float roughness ) {\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\treturn vec2( -1.04, 1.04 ) * a004 + r.zw;\n}\nfloat punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\tif( cutoffDistance > 0.0 ) {\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t}\n\treturn distanceFalloff;\n#else\n\tif( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t}\n\treturn 1.0;\n#endif\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNL = saturate( dot( geometry.normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE  = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS  = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nvec3 BRDF_Specular_GGX_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\treturn specularColor * brdf.x + brdf.y;\n}\nvoid BRDF_Specular_Multiscattering_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tvec3 F = F_Schlick( specularColor, dotNV );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\tvec3 FssEss = F * brdf.x + brdf.y;\n\tfloat Ess = brdf.x + brdf.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\t\tfDet *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vViewPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vViewPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\t#if ! defined( PHYSICAL ) && ! defined( PHONG ) && ! defined( MATCAP )\n\t\tvarying vec3 vViewPosition;\n\t#endif\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG ) && ! defined( MATCAP )\n\tvarying vec3 vViewPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG ) && ! defined( MATCAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif",color_fragment:"#ifdef USE_COLOR\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_vertex:"#ifdef USE_COLOR\n\tvColor.xyz = color.xyz;\n#endif",common:"#define PI 3.14159265359\n#define PI2 6.28318530718\n#define PI_HALF 1.5707963267949\n#define RECIPROCAL_PI 0.31830988618\n#define RECIPROCAL_PI2 0.15915494\n#define LOG2 1.442695\n#define EPSILON 1e-6\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#define whiteCompliment(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n#define cubeUV_textureSize (1024.0)\nint getFaceFromDirection(vec3 direction) {\n\tvec3 absDirection = abs(direction);\n\tint face = -1;\n\tif( absDirection.x > absDirection.z ) {\n\t\tif(absDirection.x > absDirection.y )\n\t\t\tface = direction.x > 0.0 ? 0 : 3;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\telse {\n\t\tif(absDirection.z > absDirection.y )\n\t\t\tface = direction.z > 0.0 ? 2 : 5;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\treturn face;\n}\n#define cubeUV_maxLods1  (log2(cubeUV_textureSize*0.25) - 1.0)\n#define cubeUV_rangeClamp (exp2((6.0 - 1.0) * 2.0))\nvec2 MipLevelInfo( vec3 vec, float roughnessLevel, float roughness ) {\n\tfloat scale = exp2(cubeUV_maxLods1 - roughnessLevel);\n\tfloat dxRoughness = dFdx(roughness);\n\tfloat dyRoughness = dFdy(roughness);\n\tvec3 dx = dFdx( vec * scale * dxRoughness );\n\tvec3 dy = dFdy( vec * scale * dyRoughness );\n\tfloat d = max( dot( dx, dx ), dot( dy, dy ) );\n\td = clamp(d, 1.0, cubeUV_rangeClamp);\n\tfloat mipLevel = 0.5 * log2(d);\n\treturn vec2(floor(mipLevel), fract(mipLevel));\n}\n#define cubeUV_maxLods2 (log2(cubeUV_textureSize*0.25) - 2.0)\n#define cubeUV_rcpTextureSize (1.0 / cubeUV_textureSize)\nvec2 getCubeUV(vec3 direction, float roughnessLevel, float mipLevel) {\n\tmipLevel = roughnessLevel > cubeUV_maxLods2 - 3.0 ? 0.0 : mipLevel;\n\tfloat a = 16.0 * cubeUV_rcpTextureSize;\n\tvec2 exp2_packed = exp2( vec2( roughnessLevel, mipLevel ) );\n\tvec2 rcp_exp2_packed = vec2( 1.0 ) / exp2_packed;\n\tfloat powScale = exp2_packed.x * exp2_packed.y;\n\tfloat scale = rcp_exp2_packed.x * rcp_exp2_packed.y * 0.25;\n\tfloat mipOffset = 0.75*(1.0 - rcp_exp2_packed.y) * rcp_exp2_packed.x;\n\tbool bRes = mipLevel == 0.0;\n\tscale =  bRes && (scale < a) ? a : scale;\n\tvec3 r;\n\tvec2 offset;\n\tint face = getFaceFromDirection(direction);\n\tfloat rcpPowScale = 1.0 / powScale;\n\tif( face == 0) {\n\t\tr = vec3(direction.x, -direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 1) {\n\t\tr = vec3(direction.y, direction.x, direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 2) {\n\t\tr = vec3(direction.z, direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 3) {\n\t\tr = vec3(direction.x, direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\telse if( face == 4) {\n\t\tr = vec3(direction.y, direction.x, -direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\telse {\n\t\tr = vec3(direction.z, -direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\tr = normalize(r);\n\tfloat texelOffset = 0.5 * cubeUV_rcpTextureSize;\n\tvec2 s = ( r.yz / abs( r.x ) + vec2( 1.0 ) ) * 0.5;\n\tvec2 base = offset + vec2( texelOffset );\n\treturn base + s * ( scale - 2.0 * texelOffset );\n}\n#define cubeUV_maxLods3 (log2(cubeUV_textureSize*0.25) - 3.0)\nvec4 textureCubeUV( sampler2D envMap, vec3 reflectedDirection, float roughness ) {\n\tfloat roughnessVal = roughness* cubeUV_maxLods3;\n\tfloat r1 = floor(roughnessVal);\n\tfloat r2 = r1 + 1.0;\n\tfloat t = fract(roughnessVal);\n\tvec2 mipInfo = MipLevelInfo(reflectedDirection, r1, roughness);\n\tfloat s = mipInfo.y;\n\tfloat level0 = mipInfo.x;\n\tfloat level1 = level0 + 1.0;\n\tlevel1 = level1 > 5.0 ? 5.0 : level1;\n\tlevel0 += min( floor( s + 0.5 ), 5.0 );\n\tvec2 uv_10 = getCubeUV(reflectedDirection, r1, level0);\n\tvec4 color10 = envMapTexelToLinear(texture2D(envMap, uv_10));\n\tvec2 uv_20 = getCubeUV(reflectedDirection, r2, level0);\n\tvec4 color20 = envMapTexelToLinear(texture2D(envMap, uv_20));\n\tvec4 result = mix(color10, color20, t);\n\treturn vec4(result.rgb, 1.0);\n}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = normalMatrix * objectNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, uv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * value.a * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat M = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat D = max( maxRange / maxRGB, 1.0 );\n\tD = min( floor( D ) / 255.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value )  {\n\tvec3 Xp_Y_XYZp = cLogLuvM * value.rgb;\n\tXp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract( Le );\n\tvResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;\n\treturn vec4( max( vRGB, 0.0 ), 1.0 );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\tvec2 sampleUV;\n\t\treflectVec = normalize( reflectVec );\n\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\tvec4 envColor = texture2D( envMap, sampleUV );\n\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\treflectVec = normalize( reflectVec );\n\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) );\n\t\tvec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\tenvColor = envMapTexelToLinear( envColor );\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_pars_fragment:"#if defined( USE_ENVMAP ) || defined( PHYSICAL )\n\tuniform float reflectivity;\n\tuniform float envMapIntensity;\n#endif\n#ifdef USE_ENVMAP\n\t#if ! defined( PHYSICAL ) && ( defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) )\n\t\tvarying vec3 vWorldPosition;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\tuniform float flipEnvMap;\n\tuniform int maxMipLevel;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( PHYSICAL )\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, queryVec, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar + 0.79248 - 0.5 * log2( pow2( blinnShininessExponent ) + 1.0 );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance( const in GeometricContext geometry, const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( -geometry.viewDir, geometry.normal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( -geometry.viewDir, geometry.normal, refractionRatio );\n\t\t#endif\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( blinnShininessExponent, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, queryReflectVec, BlinnExponentToGGXRoughness(blinnShininessExponent ));\n\t\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\t\tvec2 sampleUV;\n\t\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\t\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, sampleUV, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, sampleUV, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0,0.0,1.0 ) );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tfogDepth = -mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float fogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * fogDepth * fogDepth * LOG2 ) );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float fogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef TOON\n\tuniform sampler2D gradientMap;\n\tvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\t\tfloat dotNL = dot( normal, lightDirection );\n\t\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t\t#ifdef USE_GRADIENTMAP\n\t\t\treturn texture2D( gradientMap, coord ).rgb;\n\t\t#else\n\t\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t\t#endif\n\t}\n#endif",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\treflectedLight.indirectDiffuse += PI * texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n#endif",lights_pars_begin:"uniform vec3 ambientLightColor;\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t\tfloat shadowCameraNear;\n\t\tfloat shadowCameraFar;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight  ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( angleCos > spotLight.coneCos ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct BlinnPhongMaterial {\n\tvec3\tdiffuseColor;\n\tvec3\tspecularColor;\n\tfloat\tspecularShininess;\n\tfloat\tspecularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\t#ifdef TOON\n\t\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t#else\n\t\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\t\tvec3 irradiance = dotNL * directLight.color;\n\t#endif\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nmaterial.specularRoughness = clamp( roughnessFactor, 0.04, 1.0 );\n#ifdef STANDARD\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.clearCoat = saturate( clearCoat );\tmaterial.clearCoatRoughness = clamp( clearCoatRoughness, 0.04, 1.0 );\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3\tdiffuseColor;\n\tfloat\tspecularRoughness;\n\tvec3\tspecularColor;\n\t#ifndef STANDARD\n\t\tfloat clearCoat;\n\t\tfloat clearCoatRoughness;\n\t#endif\n};\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\nfloat clearCoatDHRApprox( const in float roughness, const in float dotNL ) {\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.specularRoughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\t#ifndef STANDARD\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\n\t#else\n\t\tfloat clearCoatDHR = 0.0;\n\t#endif\n\treflectedLight.directSpecular += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry, material.specularColor, material.specularRoughness );\n\treflectedLight.directDiffuse += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\t#ifndef STANDARD\n\t\treflectedLight.directSpecular += irradiance * material.clearCoat * BRDF_Specular_GGX( directLight, geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\t#endif\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t#ifndef ENVMAP_TYPE_CUBE_UV\n\t\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\t#endif\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearCoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifndef STANDARD\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\tfloat dotNL = dotNV;\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\n\t#else\n\t\tfloat clearCoatDHR = 0.0;\n\t#endif\n\tfloat clearCoatInv = 1.0 - clearCoatDHR;\n\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec3 singleScattering = vec3( 0.0 );\n\t\tvec3 multiScattering = vec3( 0.0 );\n\t\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\t\tBRDF_Specular_Multiscattering_Environment( geometry, material.specularColor, material.specularRoughness, singleScattering, multiScattering );\n\t\tvec3 diffuse = material.diffuseColor;\n\t\treflectedLight.indirectSpecular += clearCoatInv * radiance * singleScattering;\n\t\treflectedLight.indirectDiffuse += multiScattering * cosineWeightedIrradiance;\n\t\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n\t#else\n\t\treflectedLight.indirectSpecular += clearCoatInv * radiance * BRDF_Specular_GGX_Environment( geometry, material.specularColor, material.specularRoughness );\n\t#endif\n\t#ifndef STANDARD\n\t\treflectedLight.indirectSpecular += clearCoatRadiance * material.clearCoat * BRDF_Specular_GGX_Environment( geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\t#endif\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\n#define Material_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.specularRoughness )\n#define Material_ClearCoat_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.clearCoatRoughness )\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = normalize( vViewPosition );\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( pointLight.shadow, directLight.visible ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( spotLight.shadow, directLight.visible ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( directionalLight.shadow, directLight.visible ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearCoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec3 lightMapIrradiance = texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tirradiance += getLightProbeIndirectIrradiance( geometry, maxMipLevel );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getLightProbeIndirectRadiance( geometry, Material_BlinnShininessExponent( material ), maxMipLevel );\n\t#ifndef STANDARD\n\t\tclearCoatRadiance += getLightProbeIndirectRadiance( geometry, Material_ClearCoat_BlinnShininessExponent( material ), maxMipLevel );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, irradiance, clearCoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t#else\n\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\tgl_Position.z *= gl_Position.w;\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#ifdef USE_MAP\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif",map_particle_pars_fragment:"#ifdef USE_MAP\n\tuniform mat3 uvTransform;\n\tuniform sampler2D map;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\n\tobjectNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\n\tobjectNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\n\tobjectNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\t#ifndef USE_MORPHNORMALS\n\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\n\ttransformed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\n\ttransformed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\n\ttransformed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\ttransformed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\n\ttransformed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\n\ttransformed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\n\ttransformed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n\t#endif\n#endif",normal_fragment_begin:"#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n#endif",normal_fragment_maps:"#ifdef USE_NORMALMAP\n\t#ifdef OBJECTSPACE_NORMALMAP\n\t\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t\t#ifdef FLIP_SIDED\n\t\t\tnormal = - normal;\n\t\t#endif\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t#endif\n\t\tnormal = normalize( normalMatrix * normal );\n\t#else\n\t\tnormal = perturbNormal2Arb( -vViewPosition, normal );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n\t#ifdef OBJECTSPACE_NORMALMAP\n\t\tuniform mat3 normalMatrix;\n\t#else\n\t\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\n\t\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\t\tvec2 st0 = dFdx( vUv.st );\n\t\t\tvec2 st1 = dFdy( vUv.st );\n\t\t\tfloat scale = sign( st1.t * st0.s - st0.t * st1.s );\n\t\t\tvec3 S = normalize( ( q0 * st1.t - q1 * st0.t ) * scale );\n\t\t\tvec3 T = normalize( ( - q0 * st1.s + q1 * st0.s ) * scale );\n\t\t\tvec3 N = normalize( surf_norm );\n\t\t\tmat3 tsn = mat3( S, T, N );\n\t\t\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t\t\tmapN.xy *= normalScale;\n\t\t\tmapN.xy *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t\treturn normalize( tsn * mapN );\n\t\t}\n\t#endif\n#endif",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#if defined( DITHERING )\n  gl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#if defined( DITHERING )\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tfloat texture2DShadowLerp( sampler2D depths, vec2 size, vec2 uv, float compare ) {\n\t\tconst vec2 offset = vec2( 0.0, 1.0 );\n\t\tvec2 texelSize = vec2( 1.0 ) / size;\n\t\tvec2 centroidUV = floor( uv * size + 0.5 ) / size;\n\t\tfloat lb = texture2DCompare( depths, centroidUV + texelSize * offset.xx, compare );\n\t\tfloat lt = texture2DCompare( depths, centroidUV + texelSize * offset.xy, compare );\n\t\tfloat rb = texture2DCompare( depths, centroidUV + texelSize * offset.yx, compare );\n\t\tfloat rt = texture2DCompare( depths, centroidUV + texelSize * offset.yy, compare );\n\t\tvec2 f = fract( uv * size + 0.5 );\n\t\tfloat a = mix( lb, lt, f.y );\n\t\tfloat b = mix( rb, rt, f.y );\n\t\tfloat c = mix( a, b, f.x );\n\t\treturn c;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tshadow = (\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\tDirectionalLight directionalLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tshadow *= bool( directionalLight.shadow ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\tSpotLight spotLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tshadow *= bool( spotLight.shadow ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\tPointLight pointLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tshadow *= bool( pointLight.shadow ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\tuniform mat4 localBindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( localBindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n  gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n\t#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nuniform float toneMappingWhitePoint;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\n#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )\nvec3 Uncharted2ToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( toneMappingWhitePoint ) ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( ( color * ( 2.51 * color + 0.03 ) ) / ( color * ( 2.43 * color + 0.59 ) + 0.14 ) );\n}",uv_pars_fragment:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = uv2;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )\n\tvec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );\n#endif",background_frag:"uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nuniform mat4 colorMatrix;\nvarying vec3 vWorldDirection;\nvoid main() {\n\tvec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\n\tgl_FragColor = colorMatrix * mapTexelToLinear( texColor );\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - gl_FragCoord.z ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( gl_FragCoord.z );\n\t#endif\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV;\n\tsampleUV.y = asin( clamp( direction.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\tsampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;\n\tvec4 texColor = texture2D( tEquirect, sampleUV );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\tvLineDistance = scale * lineDistance;\n\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\treflectedLight.indirectDiffuse += texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\treflectedLight.indirectDiffuse = getAmbientLightIrradiance( ambientLightColor );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\t#else\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\t#endif\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t\tmatcapColor = matcapTexelToLinear( matcapColor );\n\t#else\n\t\tvec4 matcapColor = vec4( 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#ifndef FLAT_SHADED\n\t\tvNormal = normalize( transformedNormal );\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphysical_frag:"#define PHYSICAL\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifndef STANDARD\n\tuniform float clearCoat;\n\tuniform float clearCoatRoughness;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define PHYSICAL\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",normal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || ( defined( USE_NORMALMAP ) && ! defined( OBJECTSPACE_NORMALMAP ) )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}",normal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || ( defined( USE_NORMALMAP ) && ! defined( OBJECTSPACE_NORMALMAP ) )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || ( defined( USE_NORMALMAP ) && ! defined( OBJECTSPACE_NORMALMAP ) )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <fog_fragment>\n}",shadow_vert:"#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}"};function wr(e){var t={};for(var r in e)for(var i in t[r]={},e[r]){var n=e[r][i];n&&(n.isColor||n.isMatrix3||n.isMatrix4||n.isVector2||n.isVector3||n.isVector4||n.isTexture)?t[r][i]=n.clone():Array.isArray(n)?t[r][i]=n.slice():t[r][i]=n}return t}function Tr(e){for(var t={},r=0;r<e.length;r++){var i=wr(e[r]);for(var n in i)t[n]=i[n]}return t}var Mr,Sr,Rr,Pr={clone:wr,merge:Tr},Ar={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function Cr(e,t,r){return void 0===t&&void 0===r?this.set(e):this.setRGB(e,t,r)}Object.assign(Cr.prototype,{isColor:!0,r:1,g:1,b:1,set:function(e){return e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this},setScalar:function(e){return this.r=e,this.g=e,this.b=e,this},setHex:function(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this},setRGB:function(e,t,r){return this.r=e,this.g=t,this.b=r,this},setHSL:function(){function o(e,t,r){return r<0&&(r+=1),1<r&&(r-=1),r<1/6?e+6*(t-e)*r:r<.5?t:r<2/3?e+6*(t-e)*(2/3-r):e}return function(e,t,r){if(e=Bt.euclideanModulo(e,1),t=Bt.clamp(t,0,1),r=Bt.clamp(r,0,1),0===t)this.r=this.g=this.b=r;else{var i=r<=.5?r*(1+t):r+t-r*t,n=2*r-i;this.r=o(n,i,e+1/3),this.g=o(n,i,e),this.b=o(n,i,e-1/3)}return this}}(),setStyle:function(t){function e(e){void 0!==e&&parseFloat(e)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}var r;if(r=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(t)){var i,n=r[1],o=r[2];switch(n){case"rgb":case"rgba":if(i=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(o))return this.r=Math.min(255,parseInt(i[1],10))/255,this.g=Math.min(255,parseInt(i[2],10))/255,this.b=Math.min(255,parseInt(i[3],10))/255,e(i[5]),this;if(i=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(o))return this.r=Math.min(100,parseInt(i[1],10))/100,this.g=Math.min(100,parseInt(i[2],10))/100,this.b=Math.min(100,parseInt(i[3],10))/100,e(i[5]),this;break;case"hsl":case"hsla":if(i=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(o)){var a=parseFloat(i[1])/360,s=parseInt(i[2],10)/100,l=parseInt(i[3],10)/100;return e(i[5]),this.setHSL(a,s,l)}}}else if(r=/^\#([A-Fa-f0-9]+)$/.exec(t)){var c,u=(c=r[1]).length;if(3===u)return this.r=parseInt(c.charAt(0)+c.charAt(0),16)/255,this.g=parseInt(c.charAt(1)+c.charAt(1),16)/255,this.b=parseInt(c.charAt(2)+c.charAt(2),16)/255,this;if(6===u)return this.r=parseInt(c.charAt(0)+c.charAt(1),16)/255,this.g=parseInt(c.charAt(2)+c.charAt(3),16)/255,this.b=parseInt(c.charAt(4)+c.charAt(5),16)/255,this}t&&0<t.length&&(void 0!==(c=Ar[t])?this.setHex(c):console.warn("THREE.Color: Unknown color "+t));return this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},copyGammaToLinear:function(e,t){return void 0===t&&(t=2),this.r=Math.pow(e.r,t),this.g=Math.pow(e.g,t),this.b=Math.pow(e.b,t),this},copyLinearToGamma:function(e,t){void 0===t&&(t=2);var r=0<t?1/t:1;return this.r=Math.pow(e.r,r),this.g=Math.pow(e.g,r),this.b=Math.pow(e.b,r),this},convertGammaToLinear:function(e){return this.copyGammaToLinear(this,e),this},convertLinearToGamma:function(e){return this.copyLinearToGamma(this,e),this},copySRGBToLinear:function(){function t(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}return function(e){return this.r=t(e.r),this.g=t(e.g),this.b=t(e.b),this}}(),copyLinearToSRGB:function(){function t(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}return function(e){return this.r=t(e.r),this.g=t(e.g),this.b=t(e.b),this}}(),convertSRGBToLinear:function(){return this.copySRGBToLinear(this),this},convertLinearToSRGB:function(){return this.copyLinearToSRGB(this),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(e){void 0===e&&(console.warn("THREE.Color: .getHSL() target is now required"),e={h:0,s:0,l:0});var t,r,i=this.r,n=this.g,o=this.b,a=Math.max(i,n,o),s=Math.min(i,n,o),l=(s+a)/2;if(s===a)r=t=0;else{var c=a-s;switch(r=l<=.5?c/(a+s):c/(2-a-s),a){case i:t=(n-o)/c+(n<o?6:0);break;case n:t=(o-i)/c+2;break;case o:t=(i-n)/c+4}t/=6}return e.h=t,e.s=r,e.l=l,e},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:(Rr={},function(e,t,r){return this.getHSL(Rr),Rr.h+=e,Rr.s+=t,Rr.l+=r,this.setHSL(Rr.h,Rr.s,Rr.l),this}),add:function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this},addColors:function(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this},addScalar:function(e){return this.r+=e,this.g+=e,this.b+=e,this},sub:function(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this},multiply:function(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this},multiplyScalar:function(e){return this.r*=e,this.g*=e,this.b*=e,this},lerp:function(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this},lerpHSL:(Mr={h:0,s:0,l:0},Sr={h:0,s:0,l:0},function(e,t){this.getHSL(Mr),e.getHSL(Sr);var r=Bt.lerp(Mr.h,Sr.h,t),i=Bt.lerp(Mr.s,Sr.s,t),n=Bt.lerp(Mr.l,Sr.l,t);return this.setHSL(r,i,n),this}),equals:function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b},fromArray:function(e,t){return void 0===t&&(t=0),this.r=e[t],this.g=e[t+1],this.b=e[t+2],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e},toJSON:function(){return this.getHex()},getColorKeyword:function(){return Ar}});var Lr,Or,Hr={common:{diffuse:{value:new Cr(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new Xt},uvTransform1:{value:new Xt},alphaMap:{value:null},alphaMap1:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new zt(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Cr(16777215)}},lights:{ambientLightColor:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}}},points:{diffuse:{value:new Cr(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},uvTransform:{value:new Xt}},sprite:{diffuse:{value:new Cr(15658734)},opacity:{value:1},center:{value:new zt(.5,.5)},rotation:{value:0},map:{value:null},uvTransform:{value:new Xt}}},Fr={basic:{uniforms:Tr([Hr.common,Hr.specularmap,Hr.envmap,Hr.aomap,Hr.lightmap,Hr.fog]),vertexShader:_r.meshbasic_vert,fragmentShader:_r.meshbasic_frag},lambert:{uniforms:Tr([Hr.common,Hr.specularmap,Hr.envmap,Hr.aomap,Hr.lightmap,Hr.emissivemap,Hr.fog,Hr.lights,{emissive:{value:new Cr(0)}}]),vertexShader:_r.meshlambert_vert,fragmentShader:_r.meshlambert_frag},phong:{uniforms:Tr([Hr.common,Hr.specularmap,Hr.envmap,Hr.aomap,Hr.lightmap,Hr.emissivemap,Hr.bumpmap,Hr.normalmap,Hr.displacementmap,Hr.gradientmap,Hr.fog,Hr.lights,{emissive:{value:new Cr(0)},specular:{value:new Cr(1118481)},shininess:{value:30}}]),vertexShader:_r.meshphong_vert,fragmentShader:_r.meshphong_frag},standard:{uniforms:Tr([Hr.common,Hr.envmap,Hr.aomap,Hr.lightmap,Hr.emissivemap,Hr.bumpmap,Hr.normalmap,Hr.displacementmap,Hr.roughnessmap,Hr.metalnessmap,Hr.fog,Hr.lights,{emissive:{value:new Cr(0)},roughness:{value:.5},metalness:{value:.5},envMapIntensity:{value:1}}]),vertexShader:_r.meshphysical_vert,fragmentShader:_r.meshphysical_frag},matcap:{uniforms:Tr([Hr.common,Hr.bumpmap,Hr.normalmap,Hr.displacementmap,Hr.fog,{matcap:{value:null}}]),vertexShader:_r.meshmatcap_vert,fragmentShader:_r.meshmatcap_frag},points:{uniforms:Tr([Hr.points,Hr.fog]),vertexShader:_r.points_vert,fragmentShader:_r.points_frag},dashed:{uniforms:Tr([Hr.common,Hr.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:_r.linedashed_vert,fragmentShader:_r.linedashed_frag},depth:{uniforms:Tr([Hr.common,Hr.displacementmap]),vertexShader:_r.depth_vert,fragmentShader:_r.depth_frag},normal:{uniforms:Tr([Hr.common,Hr.bumpmap,Hr.normalmap,Hr.displacementmap,{opacity:{value:1}}]),vertexShader:_r.normal_vert,fragmentShader:_r.normal_frag},sprite:{uniforms:Tr([Hr.sprite,Hr.fog]),vertexShader:_r.sprite_vert,fragmentShader:_r.sprite_frag},background:{uniforms:{uvTransform:{value:new Xt},t2D:{value:null}},vertexShader:_r.background_vert,fragmentShader:_r.background_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1},colorMatrix:{value:new qt}},vertexShader:_r.cube_vert,fragmentShader:_r.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:_r.equirect_vert,fragmentShader:_r.equirect_frag},distanceRGBA:{uniforms:Tr([Hr.common,Hr.displacementmap,{referencePosition:{value:new Wt},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:_r.distanceRGBA_vert,fragmentShader:_r.distanceRGBA_frag},shadow:{uniforms:Tr([Hr.lights,Hr.fog,{color:{value:new Cr(0)},opacity:{value:1}}]),vertexShader:_r.shadow_vert,fragmentShader:_r.shadow_frag}};function kr(){var r=null,i=!1,n=null;function o(e,t){!1!==i&&(n(e,t),r.requestAnimationFrame(o))}return{start:function(){!0!==i&&null!==n&&(r.requestAnimationFrame(o),i=!0)},stop:function(){i=!1},setAnimationLoop:function(e){n=e},setContext:function(e){r=e}}}function Ir(l){var c=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),c.get(e)},remove:function(e){e.isInterleavedBufferAttribute&&(e=e.data);var t=c.get(e);t&&(l.deleteBuffer(t.buffer),c.delete(e))},update:function(e,t){e.isInterleavedBufferAttribute&&(e=e.data);var r,i,n,o,a,s=c.get(e);void 0===s?c.set(e,function(e,t){var r=e.array,i=e.dynamic?35048:35044,n=l.createBuffer();l.bindBuffer(t,n),l.bufferData(t,r,i),e.onUploadCallback();var o=5126;return r instanceof Float32Array?o=5126:r instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):r instanceof Uint16Array?o=5123:r instanceof Int16Array?o=5122:r instanceof Uint32Array?o=5125:r instanceof Int32Array?o=5124:r instanceof Int8Array?o=5120:r instanceof Uint8Array&&(o=5121),{buffer:n,type:o,bytesPerElement:r.BYTES_PER_ELEMENT,version:e.version}}(e,t)):s.version<e.version&&(r=s.buffer,n=t,o=(i=e).array,a=i.updateRange,l.bindBuffer(n,r),!1===i.dynamic?l.bufferData(n,o,35044):-1===a.count?l.bufferSubData(n,0,o):0===a.count?console.error("THREE.WebGLObjects.updateBuffer: dynamic THREE.BufferAttribute marked as needsUpdate but updateRange.count is 0, ensure you are using set methods or updating manually."):(l.bufferSubData(n,a.offset*o.BYTES_PER_ELEMENT,o.subarray(a.offset,a.offset+a.count)),a.count=-1),s.version=e.version)}}}function jr(e,t,r,i,n,o){this.a=e,this.b=t,this.c=r,this.normal=i&&i.isVector3?i:new Wt,this.vertexNormals=Array.isArray(i)?i:[],this.color=n&&n.isColor?n:new Cr,this.vertexColors=Array.isArray(n)?n:[],this.materialIndex=void 0!==o?o:0}function Nr(e,t,r,i){this._x=e||0,this._y=t||0,this._z=r||0,this._order=i||Nr.DefaultOrder}function Dr(){this.mask=1}Fr.physical={uniforms:Tr([Fr.standard.uniforms,{clearCoat:{value:0},clearCoatRoughness:{value:0}}]),vertexShader:_r.meshphysical_vert,fragmentShader:_r.meshphysical_frag},Object.assign(jr.prototype,{clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.a=e.a,this.b=e.b,this.c=e.c,this.normal.copy(e.normal),this.color.copy(e.color),this.materialIndex=e.materialIndex;for(var t=0,r=e.vertexNormals.length;t<r;t++)this.vertexNormals[t]=e.vertexNormals[t].clone();for(t=0,r=e.vertexColors.length;t<r;t++)this.vertexColors[t]=e.vertexColors[t].clone();return this}}),Nr.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],Nr.DefaultOrder="XYZ",Object.defineProperties(Nr.prototype,{x:{get:function(){return this._x},set:function(e){this._x=e,this.onChangeCallback()}},y:{get:function(){return this._y},set:function(e){this._y=e,this.onChangeCallback()}},z:{get:function(){return this._z},set:function(e){this._z=e,this.onChangeCallback()}},order:{get:function(){return this._order},set:function(e){this._order=e,this.onChangeCallback()}}}),Object.assign(Nr.prototype,{isEuler:!0,set:function(e,t,r,i){return this._x=e,this._y=t,this._z=r,this._order=i||this._order,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this.onChangeCallback(),this},setFromRotationMatrix:function(e,t,r){var i=Bt.clamp,n=e.elements,o=n[0],a=n[4],s=n[8],l=n[1],c=n[5],u=n[9],h=n[2],p=n[6],d=n[10];return"XYZ"===(t=t||this._order)?(this._y=Math.asin(i(s,-1,1)),Math.abs(s)<.99999?(this._x=Math.atan2(-u,d),this._z=Math.atan2(-a,o)):(this._x=Math.atan2(p,c),this._z=0)):"YXZ"===t?(this._x=Math.asin(-i(u,-1,1)),Math.abs(u)<.99999?(this._y=Math.atan2(s,d),this._z=Math.atan2(l,c)):(this._y=Math.atan2(-h,o),this._z=0)):"ZXY"===t?(this._x=Math.asin(i(p,-1,1)),Math.abs(p)<.99999?(this._y=Math.atan2(-h,d),this._z=Math.atan2(-a,c)):(this._y=0,this._z=Math.atan2(l,o))):"ZYX"===t?(this._y=Math.asin(-i(h,-1,1)),Math.abs(h)<.99999?(this._x=Math.atan2(p,d),this._z=Math.atan2(l,o)):(this._x=0,this._z=Math.atan2(-a,c))):"YZX"===t?(this._z=Math.asin(i(l,-1,1)),Math.abs(l)<.99999?(this._x=Math.atan2(-u,c),this._y=Math.atan2(-h,o)):(this._x=0,this._y=Math.atan2(s,d))):"XZY"===t?(this._z=Math.asin(-i(a,-1,1)),Math.abs(a)<.99999?(this._x=Math.atan2(p,c),this._y=Math.atan2(s,o)):(this._x=Math.atan2(-u,d),this._y=0)):console.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+t),this._order=t,!1!==r&&this.onChangeCallback(),this},setFromQuaternion:(Or=new qt,function(e,t,r){return Or.makeRotationFromQuaternion(e),this.setFromRotationMatrix(Or,t,r)}),setFromVector3:function(e,t){return this.set(e.x,e.y,e.z,t||this._order)},reorder:(Lr=new Gt,function(e){return Lr.setFromEuler(this),this.setFromQuaternion(Lr,e)}),equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order},fromArray:function(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this.onChangeCallback(),this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e},toVector3:function(e){return e?e.set(this._x,this._y,this._z):new Wt(this._x,this._y,this._z)},onChange:function(e){return this.onChangeCallback=e,this},onChangeCallback:function(){}}),Object.assign(Dr.prototype,{set:function(e){this.mask=1<<e|0},enable:function(e){this.mask|=1<<e|0},toggle:function(e){this.mask^=1<<e|0},disable:function(e){this.mask&=~(1<<e|0)},test:function(e){return 0!=(this.mask&e.mask)}});var Ur,Vr,Br,zr,qr,Gr,Wr,Xr,Yr,Qr,Jr,Zr,Kr,$r,ei,ti,ri,ii,ni=0;function oi(){Object.defineProperty(this,"id",{value:ni++}),this.uuid=Bt.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=oi.DefaultUp.clone();var e=new Wt,t=new Nr,r=new Gt,i=new Wt(1,1,1);t.onChange(function(){r.setFromEuler(t,!1)}),r.onChange(function(){t.setFromQuaternion(r,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:r},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new qt},normalMatrix:{value:new Xt}}),this.matrix=new qt,this.matrixWorld=new qt,this.matrixAutoUpdate=oi.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new Dr,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={}}oi.DefaultUp=new Wt(0,1,0),oi.DefaultMatrixAutoUpdate=!0,oi.prototype=Object.assign(Object.create(t.prototype),{constructor:oi,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix:function(e){this.matrix.multiplyMatrices(e,this.matrix),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(e){return this.quaternion.premultiply(e),this},setRotationFromAxisAngle:function(e,t){this.quaternion.setFromAxisAngle(e,t)},setRotationFromEuler:function(e){this.quaternion.setFromEuler(e,!0)},setRotationFromMatrix:function(e){this.quaternion.setFromRotationMatrix(e)},setRotationFromQuaternion:function(e){this.quaternion.copy(e)},rotateOnAxis:(ii=new Gt,function(e,t){return ii.setFromAxisAngle(e,t),this.quaternion.multiply(ii),this}),rotateOnWorldAxis:(ri=new Gt,function(e,t){return ri.setFromAxisAngle(e,t),this.quaternion.premultiply(ri),this}),rotateX:(ti=new Wt(1,0,0),function(e){return this.rotateOnAxis(ti,e)}),rotateY:(ei=new Wt(0,1,0),function(e){return this.rotateOnAxis(ei,e)}),rotateZ:($r=new Wt(0,0,1),function(e){return this.rotateOnAxis($r,e)}),translateOnAxis:(Kr=new Wt,function(e,t){return Kr.copy(e).applyQuaternion(this.quaternion),this.position.add(Kr.multiplyScalar(t)),this}),translateX:(Zr=new Wt(1,0,0),function(e){return this.translateOnAxis(Zr,e)}),translateY:(Jr=new Wt(0,1,0),function(e){return this.translateOnAxis(Jr,e)}),translateZ:(Qr=new Wt(0,0,1),function(e){return this.translateOnAxis(Qr,e)}),localToWorld:function(e){return e.applyMatrix4(this.matrixWorld)},worldToLocal:(Yr=new qt,function(e){return e.applyMatrix4(Yr.getInverse(this.matrixWorld))}),lookAt:(qr=new Gt,Gr=new qt,Wr=new Wt,Xr=new Wt,function(e,t,r){e.isVector3?Wr.copy(e):Wr.set(e,t,r);var i=this.parent;this.updateWorldMatrix(!0,!1),Xr.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Gr.lookAt(Xr,Wr,this.up):Gr.lookAt(Wr,Xr,this.up),this.quaternion.setFromRotationMatrix(Gr),i&&(Gr.extractRotation(i.matrixWorld),qr.setFromRotationMatrix(Gr),this.quaternion.premultiply(qr.inverse()))}),add:function(e){if(1<arguments.length){for(var t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?console.error("THREE.Object3D.add: object can't be added as a child of itself.",e):e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,e.dispatchEvent({type:"added"}),this.children.push(e),this.dispatchEvent({type:"addedChild",object:e})):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this},remove:function(e){if(1<arguments.length){for(var t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}var r=this.children.indexOf(e);return-1!==r&&(e.parent=null,e.dispatchEvent({type:"removed"}),this.children.splice(r,1)),this},getObjectById:function(e){return this.getObjectByProperty("id",e)},getObjectByName:function(e){return this.getObjectByProperty("name",e)},getObjectByProperty:function(e,t){if(this[e]===t)return this;for(var r=0,i=this.children.length;r<i;r++){var n=this.children[r].getObjectByProperty(e,t);if(void 0!==n)return n}},getWorldPosition:function(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldPosition() target is now required"),e=new Wt),this.updateMatrixWorld(!0),e.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:(Br=new Wt,zr=new Wt,function(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldQuaternion() target is now required"),e=new Gt),this.updateMatrixWorld(!0),this.matrixWorld.decompose(Br,e,zr),e}),getWorldScale:(Ur=new Wt,Vr=new Gt,function(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldScale() target is now required"),e=new Wt),this.updateMatrixWorld(!0),this.matrixWorld.decompose(Ur,Vr,e),e}),getWorldDirection:function(e){void 0===e&&(console.warn("THREE.Object3D: .getWorldDirection() target is now required"),e=new Wt),this.updateMatrixWorld(!0);var t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()},raycast:function(){},traverse:function(e){e(this);for(var t=this.children,r=0,i=t.length;r<i;r++)t[r].traverse(e)},traverseVisible:function(e){if(!1!==this.visible){e(this);for(var t=this.children,r=0,i=t.length;r<i;r++)t[r].traverseVisible(e)}},traverseAncestors:function(e){var t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),e=!(this.matrixWorldNeedsUpdate=!1));for(var t=this.children,r=0,i=t.length;r<i;r++)t[r].updateMatrixWorld(e)},updateWorldMatrix:function(e,t){var r=this.parent;if(!0===e&&null!==r&&r.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t)for(var i=this.children,n=0,o=i.length;n<o;n++)i[n].updateWorldMatrix(!1,!0)},toJSON:function(r){var e=void 0===r||"string"==typeof r,t={};e&&(r={geometries:{},materials:{},textures:{},images:{},shapes:{}},t.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});var i={};function n(e,t){return void 0===e[t.uuid]&&(e[t.uuid]=t.toJSON(r)),t.uuid}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),!0===this.castShadow&&(i.castShadow=!0),!0===this.receiveShadow&&(i.receiveShadow=!0),!1===this.visible&&(i.visible=!1),!1===this.frustumCulled&&(i.frustumCulled=!1),0!==this.renderOrder&&(i.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(i.matrixAutoUpdate=!1),this.isMesh&&this.drawMode!==Ct&&(i.drawMode=this.drawMode),this.isMesh||this.isLine||this.isPoints){i.geometry=n(r.geometries,this.geometry);var o=this.geometry.parameters;if(void 0!==o&&void 0!==o.shapes){var a=o.shapes;if(Array.isArray(a))for(var s=0,l=a.length;s<l;s++){var c=a[s];n(r.shapes,c)}else n(r.shapes,a)}}if(void 0!==this.material)if(Array.isArray(this.material)){var u=[];for(s=0,l=this.material.length;s<l;s++)u.push(n(r.materials,this.material[s]));i.material=u}else i.material=n(r.materials,this.material);if(0<this.children.length){i.children=[];for(s=0;s<this.children.length;s++)i.children.push(this.children[s].toJSON(r).object)}if(e){var h=m(r.geometries),p=m(r.materials),d=m(r.textures),f=m(r.images);a=m(r.shapes);0<h.length&&(t.geometries=h),0<p.length&&(t.materials=p),0<d.length&&(t.textures=d),0<f.length&&(t.images=f),0<a.length&&(t.shapes=a)}return t.object=i,t;function m(e){var t=[];for(var r in e){var i=e[r];delete i.metadata,t.push(i)}return t}},clone:function(e){return(new this.constructor).copy(this,e)},copy:function(e,t){if(void 0===t&&(t=!0),this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(var r=0;r<e.children.length;r++){var i=e.children[r];this.add(i.clone())}return this}});var ai,si,li,ci,ui,hi,pi,di=0;function fi(){Object.defineProperty(this,"id",{value:di+=2}),this.uuid=Bt.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}function mi(e,t,r){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=!0===r,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.version=0}function gi(e,t,r){mi.call(this,new Int8Array(e),t,r)}function vi(e,t,r){mi.call(this,new Uint8Array(e),t,r)}function yi(e,t,r){mi.call(this,new Uint8ClampedArray(e),t,r)}function bi(e,t,r){mi.call(this,new Int16Array(e),t,r)}function xi(e,t,r){mi.call(this,new Uint16Array(e),t,r)}function Ei(e,t,r){mi.call(this,new Int32Array(e),t,r)}function _i(e,t,r){mi.call(this,new Uint32Array(e),t,r)}function wi(e,t,r){mi.call(this,new Float32Array(e),t,r)}function Ti(e,t,r){mi.call(this,new Float64Array(e),t,r)}function Mi(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}function Si(e){if(0===e.length)return-1/0;for(var t=e[0],r=1,i=e.length;r<i;++r)e[r]>t&&(t=e[r]);return t}fi.prototype=Object.assign(Object.create(t.prototype),{constructor:fi,isGeometry:!0,applyMatrix:function(e){for(var t=(new Xt).getNormalMatrix(e),r=0,i=this.vertices.length;r<i;r++){this.vertices[r].applyMatrix4(e)}for(r=0,i=this.faces.length;r<i;r++){var n=this.faces[r];n.normal.applyMatrix3(t).normalize();for(var o=0,a=n.vertexNormals.length;o<a;o++)n.vertexNormals[o].applyMatrix3(t).normalize()}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this},rotateX:(pi=new qt,function(e){return pi.makeRotationX(e),this.applyMatrix(pi),this}),rotateY:(hi=new qt,function(e){return hi.makeRotationY(e),this.applyMatrix(hi),this}),rotateZ:(ui=new qt,function(e){return ui.makeRotationZ(e),this.applyMatrix(ui),this}),translate:(ci=new qt,function(e,t,r){return ci.makeTranslation(e,t,r),this.applyMatrix(ci),this}),scale:(li=new qt,function(e,t,r){return li.makeScale(e,t,r),this.applyMatrix(li),this}),lookAt:(si=new oi,function(e){si.lookAt(e),si.updateMatrix(),this.applyMatrix(si.matrix)}),fromBufferGeometry:function(e){var a=this,t=null!==e.index?e.index.array:void 0,r=e.attributes,i=r.position.array,s=void 0!==r.normal?r.normal.array:void 0,l=void 0!==r.color?r.color.array:void 0,c=void 0!==r.uv?r.uv.array:void 0,u=void 0!==r.uv2?r.uv2.array:void 0;void 0!==u&&(this.faceVertexUvs[1]=[]);for(var n=0,o=0;n<i.length;n+=3,o+=2)a.vertices.push((new Wt).fromArray(i,n)),void 0!==l&&a.colors.push((new Cr).fromArray(l,n));function h(e,t,r,i){var n=void 0===l?[]:[a.colors[e].clone(),a.colors[t].clone(),a.colors[r].clone()],o=new jr(e,t,r,void 0===s?[]:[(new Wt).fromArray(s,3*e),(new Wt).fromArray(s,3*t),(new Wt).fromArray(s,3*r)],n,i);a.faces.push(o),void 0!==c&&a.faceVertexUvs[0].push([(new zt).fromArray(c,2*e),(new zt).fromArray(c,2*t),(new zt).fromArray(c,2*r)]),void 0!==u&&a.faceVertexUvs[1].push([(new zt).fromArray(u,2*e),(new zt).fromArray(u,2*t),(new zt).fromArray(u,2*r)])}var p=e.groups;if(0<p.length)for(n=0;n<p.length;n++)for(var d=p[n],f=d.start,m=(o=f,f+d.count);o<m;o+=3)void 0!==t?h(t[o],t[o+1],t[o+2],d.materialIndex):h(o,o+1,o+2,d.materialIndex);else if(void 0!==t)for(n=0;n<t.length;n+=3)h(t[n],t[n+1],t[n+2]);else for(n=0;n<i.length/3;n+=3)h(n,n+1,n+2);return this.computeFaceNormals(),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this},center:(ai=new Wt,function(){return this.computeBoundingBox(),this.boundingBox.getCenter(ai).negate(),this.translate(ai.x,ai.y,ai.z),this}),normalize:function(){this.computeBoundingSphere();var e=this.boundingSphere.center,t=this.boundingSphere.radius,r=0===t?1:1/t,i=new qt;return i.set(r,0,0,-r*e.x,0,r,0,-r*e.y,0,0,r,-r*e.z,0,0,0,1),this.applyMatrix(i),this},computeFaceNormals:function(){for(var e=new Wt,t=new Wt,r=0,i=this.faces.length;r<i;r++){var n=this.faces[r],o=this.vertices[n.a],a=this.vertices[n.b],s=this.vertices[n.c];e.subVectors(s,a),t.subVectors(o,a),e.cross(t),e.normalize(),n.normal.copy(e)}},computeVertexNormals:function(e){var t,r,i,n,o,a;for(void 0===e&&(e=!0),a=new Array(this.vertices.length),t=0,r=this.vertices.length;t<r;t++)a[t]=new Wt;if(e){var s,l,c,u=new Wt,h=new Wt;for(i=0,n=this.faces.length;i<n;i++)o=this.faces[i],s=this.vertices[o.a],l=this.vertices[o.b],c=this.vertices[o.c],u.subVectors(c,l),h.subVectors(s,l),u.cross(h),a[o.a].add(u),a[o.b].add(u),a[o.c].add(u)}else for(this.computeFaceNormals(),i=0,n=this.faces.length;i<n;i++)a[(o=this.faces[i]).a].add(o.normal),a[o.b].add(o.normal),a[o.c].add(o.normal);for(t=0,r=this.vertices.length;t<r;t++)a[t].normalize();for(i=0,n=this.faces.length;i<n;i++){var p=(o=this.faces[i]).vertexNormals;3===p.length?(p[0].copy(a[o.a]),p[1].copy(a[o.b]),p[2].copy(a[o.c])):(p[0]=a[o.a].clone(),p[1]=a[o.b].clone(),p[2]=a[o.c].clone())}0<this.faces.length&&(this.normalsNeedUpdate=!0)},computeFlatVertexNormals:function(){var e,t,r;for(this.computeFaceNormals(),e=0,t=this.faces.length;e<t;e++){var i=(r=this.faces[e]).vertexNormals;3===i.length?(i[0].copy(r.normal),i[1].copy(r.normal),i[2].copy(r.normal)):(i[0]=r.normal.clone(),i[1]=r.normal.clone(),i[2]=r.normal.clone())}0<this.faces.length&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){var e,t,r,i,n;for(r=0,i=this.faces.length;r<i;r++)for((n=this.faces[r]).__originalFaceNormal?n.__originalFaceNormal.copy(n.normal):n.__originalFaceNormal=n.normal.clone(),n.__originalVertexNormals||(n.__originalVertexNormals=[]),e=0,t=n.vertexNormals.length;e<t;e++)n.__originalVertexNormals[e]?n.__originalVertexNormals[e].copy(n.vertexNormals[e]):n.__originalVertexNormals[e]=n.vertexNormals[e].clone();var o=new fi;for(o.faces=this.faces,e=0,t=this.morphTargets.length;e<t;e++){if(!this.morphNormals[e]){this.morphNormals[e]={},this.morphNormals[e].faceNormals=[],this.morphNormals[e].vertexNormals=[];var a=this.morphNormals[e].faceNormals,s=this.morphNormals[e].vertexNormals;for(r=0,i=this.faces.length;r<i;r++)l=new Wt,c={a:new Wt,b:new Wt,c:new Wt},a.push(l),s.push(c)}var l,c,u=this.morphNormals[e];for(o.vertices=this.morphTargets[e].vertices,o.computeFaceNormals(),o.computeVertexNormals(),r=0,i=this.faces.length;r<i;r++)n=this.faces[r],l=u.faceNormals[r],c=u.vertexNormals[r],l.copy(n.normal),c.a.copy(n.vertexNormals[0]),c.b.copy(n.vertexNormals[1]),c.c.copy(n.vertexNormals[2])}for(r=0,i=this.faces.length;r<i;r++)(n=this.faces[r]).normal=n.__originalFaceNormal,n.vertexNormals=n.__originalVertexNormals},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new yr),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new br),this.boundingSphere.setFromPoints(this.vertices)},merge:function(e,t,r){if(e&&e.isGeometry){var i,n=this.vertices.length,o=this.vertices,a=e.vertices,s=this.faces,l=e.faces,c=this.faceVertexUvs[0],u=e.faceVertexUvs[0],h=this.colors,p=e.colors;void 0===r&&(r=0),void 0!==t&&(i=(new Xt).getNormalMatrix(t));for(var d=0,f=a.length;d<f;d++){var m=a[d].clone();void 0!==t&&m.applyMatrix4(t),o.push(m)}for(d=0,f=p.length;d<f;d++)h.push(p[d].clone());for(d=0,f=l.length;d<f;d++){var g,v,y,b=l[d],x=b.vertexNormals,E=b.vertexColors;(g=new jr(b.a+n,b.b+n,b.c+n)).normal.copy(b.normal),void 0!==i&&g.normal.applyMatrix3(i).normalize();for(var _=0,w=x.length;_<w;_++)v=x[_].clone(),void 0!==i&&v.applyMatrix3(i).normalize(),g.vertexNormals.push(v);g.color.copy(b.color);for(_=0,w=E.length;_<w;_++)y=E[_],g.vertexColors.push(y.clone());g.materialIndex=b.materialIndex+r,s.push(g)}for(d=0,f=u.length;d<f;d++){var T=u[d],M=[];if(void 0!==T){for(_=0,w=T.length;_<w;_++)M.push(T[_].clone());c.push(M)}}}else console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",e)},mergeMesh:function(e){e&&e.isMesh?(e.matrixAutoUpdate&&e.updateMatrix(),this.merge(e.geometry,e.matrix)):console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",e)},mergeVertices:function(){var e,t,r,i,n,o,a,s,l={},c=[],u=[],h=Math.pow(10,4);for(r=0,i=this.vertices.length;r<i;r++)e=this.vertices[r],void 0===l[t=Math.round(e.x*h)+"_"+Math.round(e.y*h)+"_"+Math.round(e.z*h)]?(l[t]=r,c.push(this.vertices[r]),u[r]=c.length-1):u[r]=u[l[t]];var p=[];for(r=0,i=this.faces.length;r<i;r++){(n=this.faces[r]).a=u[n.a],n.b=u[n.b],n.c=u[n.c],o=[n.a,n.b,n.c];for(var d=0;d<3;d++)if(o[d]===o[(d+1)%3]){p.push(r);break}}for(r=p.length-1;0<=r;r--){var f=p[r];for(this.faces.splice(f,1),a=0,s=this.faceVertexUvs.length;a<s;a++)this.faceVertexUvs[a].splice(f,1)}var m=this.vertices.length-c.length;return this.vertices=c,m},setFromPoints:function(e){this.vertices=[];for(var t=0,r=e.length;t<r;t++){var i=e[t];this.vertices.push(new Wt(i.x,i.y,i.z||0))}return this},sortFacesByMaterialIndex:function(){for(var e=this.faces,t=e.length,r=0;r<t;r++)e[r]._id=r;e.sort(function(e,t){return e.materialIndex-t.materialIndex});var i,n,o=this.faceVertexUvs[0],a=this.faceVertexUvs[1];o&&o.length===t&&(i=[]),a&&a.length===t&&(n=[]);for(r=0;r<t;r++){var s=e[r]._id;i&&i.push(o[s]),n&&n.push(a[s])}i&&(this.faceVertexUvs[0]=i),n&&(this.faceVertexUvs[1]=n)},toJSON:function(){var e={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),void 0!==this.parameters){var t=this.parameters;for(var r in t)void 0!==t[r]&&(e[r]=t[r]);return e}for(var i=[],n=0;n<this.vertices.length;n++){var o=this.vertices[n];i.push(o.x,o.y,o.z)}var a=[],s=[],l={},c=[],u={},h=[],p={};for(n=0;n<this.faces.length;n++){var d=this.faces[n],f=void 0!==this.faceVertexUvs[0][n],m=0<d.normal.length(),g=0<d.vertexNormals.length,v=1!==d.color.r||1!==d.color.g||1!==d.color.b,y=0<d.vertexColors.length,b=0;if(b=w(b=w(b=w(b=w(b=w(b=w(b=w(b=w(b,0,0),1,!0),2,!1),3,f),4,m),5,g),6,v),7,y),a.push(b),a.push(d.a,d.b,d.c),a.push(d.materialIndex),f){var x=this.faceVertexUvs[0][n];a.push(S(x[0]),S(x[1]),S(x[2]))}if(m&&a.push(T(d.normal)),g){var E=d.vertexNormals;a.push(T(E[0]),T(E[1]),T(E[2]))}if(v&&a.push(M(d.color)),y){var _=d.vertexColors;a.push(M(_[0]),M(_[1]),M(_[2]))}}function w(e,t,r){return r?e|1<<t:e&~(1<<t)}function T(e){var t=e.x.toString()+e.y.toString()+e.z.toString();return void 0!==l[t]||(l[t]=s.length/3,s.push(e.x,e.y,e.z)),l[t]}function M(e){var t=e.r.toString()+e.g.toString()+e.b.toString();return void 0!==u[t]||(u[t]=c.length,c.push(e.getHex())),u[t]}function S(e){var t=e.x.toString()+e.y.toString();return void 0!==p[t]||(p[t]=h.length/2,h.push(e.x,e.y)),p[t]}return e.data={},e.data.vertices=i,e.data.normals=s,0<c.length&&(e.data.colors=c),0<h.length&&(e.data.uvs=[h]),e.data.faces=a,e},clone:function(){return(new fi).copy(this)},copy:function(e){var t,r,i,n,o,a;this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=e.name;var s=e.vertices;for(t=0,r=s.length;t<r;t++)this.vertices.push(s[t].clone());var l=e.colors;for(t=0,r=l.length;t<r;t++)this.colors.push(l[t].clone());var c=e.faces;for(t=0,r=c.length;t<r;t++)this.faces.push(c[t].clone());for(t=0,r=e.faceVertexUvs.length;t<r;t++){var u=e.faceVertexUvs[t];for(void 0===this.faceVertexUvs[t]&&(this.faceVertexUvs[t]=[]),i=0,n=u.length;i<n;i++){var h=u[i],p=[];for(o=0,a=h.length;o<a;o++){var d=h[o];p.push(d.clone())}this.faceVertexUvs[t].push(p)}}var f=e.morphTargets;for(t=0,r=f.length;t<r;t++){var m={};if(m.name=f[t].name,void 0!==f[t].vertices)for(m.vertices=[],i=0,n=f[t].vertices.length;i<n;i++)m.vertices.push(f[t].vertices[i].clone());if(void 0!==f[t].normals)for(m.normals=[],i=0,n=f[t].normals.length;i<n;i++)m.normals.push(f[t].normals[i].clone());this.morphTargets.push(m)}var g=e.morphNormals;for(t=0,r=g.length;t<r;t++){var v={};if(void 0!==g[t].vertexNormals)for(v.vertexNormals=[],i=0,n=g[t].vertexNormals.length;i<n;i++){var y=g[t].vertexNormals[i],b={};b.a=y.a.clone(),b.b=y.b.clone(),b.c=y.c.clone(),v.vertexNormals.push(b)}if(void 0!==g[t].faceNormals)for(v.faceNormals=[],i=0,n=g[t].faceNormals.length;i<n;i++)v.faceNormals.push(g[t].faceNormals[i].clone());this.morphNormals.push(v)}var x=e.skinWeights;for(t=0,r=x.length;t<r;t++)this.skinWeights.push(x[t].clone());var E=e.skinIndices;for(t=0,r=E.length;t<r;t++)this.skinIndices.push(E[t].clone());var _=e.lineDistances;for(t=0,r=_.length;t<r;t++)this.lineDistances.push(_[t]);var w=e.boundingBox;null!==w&&(this.boundingBox=w.clone());var T=e.boundingSphere;return null!==T&&(this.boundingSphere=T.clone()),this.elementsNeedUpdate=e.elementsNeedUpdate,this.verticesNeedUpdate=e.verticesNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.lineDistancesNeedUpdate=e.lineDistancesNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Object.defineProperty(mi.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(mi.prototype,{isBufferAttribute:!0,onUploadCallback:function(){},setArray:function(e){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");return this.count=void 0!==e?e.length/this.itemSize:0,this.array=e,this},setDynamic:function(e){return this.dynamic=e,this},copy:function(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.dynamic=e.dynamic,this},copyAt:function(e,t,r){e*=this.itemSize,r*=t.itemSize;for(var i=0,n=this.itemSize;i<n;i++)this.array[e+i]=t.array[r+i];return this},copyArray:function(e){return this.array.set(e),this},copyColorsArray:function(e){for(var t=this.array,r=0,i=0,n=e.length;i<n;i++){var o=e[i];void 0===o&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",i),o=new Cr),t[r++]=o.r,t[r++]=o.g,t[r++]=o.b}return this},copyVector2sArray:function(e){for(var t=this.array,r=0,i=0,n=e.length;i<n;i++){var o=e[i];void 0===o&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",i),o=new zt),t[r++]=o.x,t[r++]=o.y}return this},copyVector3sArray:function(e){for(var t=this.array,r=0,i=0,n=e.length;i<n;i++){var o=e[i];void 0===o&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",i),o=new Wt),t[r++]=o.x,t[r++]=o.y,t[r++]=o.z}return this},copyVector4sArray:function(e){for(var t=this.array,r=0,i=0,n=e.length;i<n;i++){var o=e[i];void 0===o&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",i),o=new dr),t[r++]=o.x,t[r++]=o.y,t[r++]=o.z,t[r++]=o.w}return this},set:function(e,t){return void 0===t&&(t=0),this.array.set(e,t),this},getX:function(e){return this.array[e*this.itemSize]},setX:function(e,t){return this.array[e*this.itemSize]=t,this},getY:function(e){return this.array[e*this.itemSize+1]},setY:function(e,t){return this.array[e*this.itemSize+1]=t,this},getZ:function(e){return this.array[e*this.itemSize+2]},setZ:function(e,t){return this.array[e*this.itemSize+2]=t,this},getW:function(e){return this.array[e*this.itemSize+3]},setW:function(e,t){return this.array[e*this.itemSize+3]=t,this},setXY:function(e,t,r){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=r,this},setXYZ:function(e,t,r,i){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=r,this.array[e+2]=i,this},setXYZW:function(e,t,r,i,n){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=r,this.array[e+2]=i,this.array[e+3]=n,this},onUpload:function(e){return this.onUploadCallback=e,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)}}),(gi.prototype=Object.create(mi.prototype)).constructor=gi,(vi.prototype=Object.create(mi.prototype)).constructor=vi,(yi.prototype=Object.create(mi.prototype)).constructor=yi,(bi.prototype=Object.create(mi.prototype)).constructor=bi,(xi.prototype=Object.create(mi.prototype)).constructor=xi,(Ei.prototype=Object.create(mi.prototype)).constructor=Ei,(_i.prototype=Object.create(mi.prototype)).constructor=_i,(wi.prototype=Object.create(mi.prototype)).constructor=wi,(Ti.prototype=Object.create(mi.prototype)).constructor=Ti,Object.assign(Mi.prototype,{computeGroups:function(e){for(var t,r=[],i=void 0,n=e.faces,o=0;o<n.length;o++){var a=n[o];a.materialIndex!==i&&(i=a.materialIndex,void 0!==t&&(t.count=3*o-t.start,r.push(t)),t={start:3*o,materialIndex:i})}void 0!==t&&(t.count=3*o-t.start,r.push(t)),this.groups=r},fromGeometry:function(e){var t,r=e.faces,i=e.vertices,n=e.faceVertexUvs,o=n[0]&&0<n[0].length,a=n[1]&&0<n[1].length,s=e.morphTargets,l=s.length;if(0<l){t=[];for(var c=0;c<l;c++)t[c]={name:s[c].name,data:[]};this.morphTargets.position=t}var u,h=e.morphNormals,p=h.length;if(0<p){u=[];for(c=0;c<p;c++)u[c]={name:h[c].name,data:[]};this.morphTargets.normal=u}var d=e.skinIndices,f=e.skinWeights,m=d.length===i.length,g=f.length===i.length;0<i.length&&0===r.length&&console.error("THREE.DirectGeometry: Faceless geometries are not supported.");for(c=0;c<r.length;c++){var v=r[c];this.vertices.push(i[v.a],i[v.b],i[v.c]);var y=v.vertexNormals;if(3===y.length)this.normals.push(y[0],y[1],y[2]);else{var b=v.normal;this.normals.push(b,b,b)}var x,E=v.vertexColors;if(3===E.length)this.colors.push(E[0],E[1],E[2]);else{var _=v.color;this.colors.push(_,_,_)}if(!0===o)void 0!==(x=n[0][c])?this.uvs.push(x[0],x[1],x[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",c),this.uvs.push(new zt,new zt,new zt));if(!0===a)void 0!==(x=n[1][c])?this.uvs2.push(x[0],x[1],x[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",c),this.uvs2.push(new zt,new zt,new zt));for(var w=0;w<l;w++){var T=s[w].vertices;t[w].data.push(T[v.a],T[v.b],T[v.c])}for(w=0;w<p;w++){var M=h[w].vertexNormals[c];u[w].data.push(M.a,M.b,M.c)}m&&this.skinIndices.push(d[v.a],d[v.b],d[v.c]),g&&this.skinWeights.push(f[v.a],f[v.b],f[v.c])}return this.computeGroups(e),this.verticesNeedUpdate=e.verticesNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,this}});var Ri,Pi,Ai,Ci,Li,Oi,Hi,Fi,ki,Ii,ji=1;function Ni(){Object.defineProperty(this,"id",{value:ji+=2}),this.uuid=Bt.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}function Di(e,t,r,i,n,o){fi.call(this),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:r,widthSegments:i,heightSegments:n,depthSegments:o},this.fromBufferGeometry(new Ui(e,t,r,i,n,o)),this.mergeVertices()}function Ui(e,t,r,i,n,o){Ni.call(this),this.type="BoxBufferGeometry",this.parameters={width:e,height:t,depth:r,widthSegments:i,heightSegments:n,depthSegments:o};var A=this;e=e||1,t=t||1,r=r||1,i=Math.floor(i)||1,n=Math.floor(n)||1,o=Math.floor(o)||1;var C=[],L=[],O=[],H=[],F=0,k=0;function a(e,t,r,i,n,o,a,s,l,c,u){var h,p,d=o/l,f=a/c,m=o/2,g=a/2,v=s/2,y=l+1,b=c+1,x=0,E=0,_=new Wt;for(p=0;p<b;p++){var w=p*f-g;for(h=0;h<y;h++){var T=h*d-m;_[e]=T*i,_[t]=w*n,_[r]=v,L.push(_.x,_.y,_.z),_[e]=0,_[t]=0,_[r]=0<s?1:-1,O.push(_.x,_.y,_.z),H.push(h/l),H.push(1-p/c),x+=1}}for(p=0;p<c;p++)for(h=0;h<l;h++){var M=F+h+y*p,S=F+h+y*(p+1),R=F+(h+1)+y*(p+1),P=F+(h+1)+y*p;C.push(M,S,P),C.push(S,R,P),E+=6}A.addGroup(k,E,u),k+=E,F+=x}a("z","y","x",-1,-1,r,t,e,o,n,0),a("z","y","x",1,-1,r,t,-e,o,n,1),a("x","z","y",1,1,e,r,t,i,o,2),a("x","z","y",1,-1,e,r,-t,i,o,3),a("x","y","z",1,-1,e,t,r,i,n,4),a("x","y","z",-1,-1,e,t,-r,i,n,5),this.setIndex(C),this.addAttribute("position",new wi(L,3)),this.addAttribute("normal",new wi(O,3)),this.addAttribute("uv",new wi(H,2))}function Vi(e,t,r,i){fi.call(this),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:r,heightSegments:i},this.fromBufferGeometry(new Bi(e,t,r,i)),this.mergeVertices()}function Bi(e,t,r,i){Ni.call(this),this.type="PlaneBufferGeometry",this.parameters={width:e,height:t,widthSegments:r,heightSegments:i};var n,o,a=(e=e||1)/2,s=(t=t||1)/2,l=Math.floor(r)||1,c=Math.floor(i)||1,u=l+1,h=c+1,p=e/l,d=t/c,f=[],m=[],g=[],v=[];for(o=0;o<h;o++){var y=o*d-s;for(n=0;n<u;n++){var b=n*p-a;m.push(b,-y,0),g.push(0,0,1),v.push(n/l),v.push(1-o/c)}}for(o=0;o<c;o++)for(n=0;n<l;n++){var x=n+u*o,E=n+u*(o+1),_=n+1+u*(o+1),w=n+1+u*o;f.push(x,E,w),f.push(E,_,w)}this.setIndex(f),this.addAttribute("position",new wi(m,3)),this.addAttribute("normal",new wi(g,3)),this.addAttribute("uv",new wi(v,2))}Ni.prototype=Object.assign(Object.create(t.prototype),{constructor:Ni,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(e){Array.isArray(e)?this.index=new(65535<Si(e)?_i:xi)(e,1):this.index=e},addAttribute:function(e,t){return t&&t.isBufferAttribute||t&&t.isInterleavedBufferAttribute?("index"===e?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(t)):this.attributes[e]=t,this):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.addAttribute(e,new mi(t,arguments[2])))},getAttribute:function(e){return this.attributes[e]},removeAttribute:function(e){return delete this.attributes[e],this},addGroup:function(e,t,r){this.groups.push({start:e,count:t,materialIndex:void 0!==r?r:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(e,t){this.drawRange.start=e,this.drawRange.count=t},applyMatrix:function(e){var t=this.attributes.position;void 0!==t&&(e.applyToBufferAttribute(t),t.needsUpdate=!0);var r=this.attributes.normal;void 0!==r&&((new Xt).getNormalMatrix(e).applyToBufferAttribute(r),r.needsUpdate=!0);return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},rotateX:(Ii=new qt,function(e){return Ii.makeRotationX(e),this.applyMatrix(Ii),this}),rotateY:(ki=new qt,function(e){return ki.makeRotationY(e),this.applyMatrix(ki),this}),rotateZ:(Fi=new qt,function(e){return Fi.makeRotationZ(e),this.applyMatrix(Fi),this}),translate:(Hi=new qt,function(e,t,r){return Hi.makeTranslation(e,t,r),this.applyMatrix(Hi),this}),scale:(Oi=new qt,function(e,t,r){return Oi.makeScale(e,t,r),this.applyMatrix(Oi),this}),lookAt:(Li=new oi,function(e){Li.lookAt(e),Li.updateMatrix(),this.applyMatrix(Li.matrix)}),center:(Ci=new Wt,function(){return this.computeBoundingBox(),this.boundingBox.getCenter(Ci).negate(),this.translate(Ci.x,Ci.y,Ci.z),this}),setFromObject:function(e){var t=e.geometry;if(e.isPoints||e.isLine){var r=new wi(3*t.vertices.length,3),i=new wi(3*t.colors.length,3);if(this.addAttribute("position",r.copyVector3sArray(t.vertices)),this.addAttribute("color",i.copyColorsArray(t.colors)),t.lineDistances&&t.lineDistances.length===t.vertices.length){var n=new wi(t.lineDistances.length,1);this.addAttribute("lineDistance",n.copyArray(t.lineDistances))}null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone())}else e.isMesh&&t&&t.isGeometry&&this.fromGeometry(t);return this},setFromPoints:function(e){for(var t=[],r=0,i=e.length;r<i;r++){var n=e[r];t.push(n.x,n.y,n.z||0)}return this.addAttribute("position",new wi(t,3)),this},updateFromObject:function(e){var t,r=e.geometry;if(e.isMesh){var i=r.__directGeometry;if(!0===r.elementsNeedUpdate&&(i=void 0,r.elementsNeedUpdate=!1),void 0===i)return this.fromGeometry(r);i.verticesNeedUpdate=r.verticesNeedUpdate,i.normalsNeedUpdate=r.normalsNeedUpdate,i.colorsNeedUpdate=r.colorsNeedUpdate,i.uvsNeedUpdate=r.uvsNeedUpdate,i.groupsNeedUpdate=r.groupsNeedUpdate,r.verticesNeedUpdate=!1,r.normalsNeedUpdate=!1,r.colorsNeedUpdate=!1,r.uvsNeedUpdate=!1,r.groupsNeedUpdate=!1,r=i}return!0===r.verticesNeedUpdate&&(void 0!==(t=this.attributes.position)&&(t.copyVector3sArray(r.vertices),t.needsUpdate=!0),r.verticesNeedUpdate=!1),!0===r.normalsNeedUpdate&&(void 0!==(t=this.attributes.normal)&&(t.copyVector3sArray(r.normals),t.needsUpdate=!0),r.normalsNeedUpdate=!1),!0===r.colorsNeedUpdate&&(void 0!==(t=this.attributes.color)&&(t.copyColorsArray(r.colors),t.needsUpdate=!0),r.colorsNeedUpdate=!1),r.uvsNeedUpdate&&(void 0!==(t=this.attributes.uv)&&(t.copyVector2sArray(r.uvs),t.needsUpdate=!0),r.uvsNeedUpdate=!1),r.lineDistancesNeedUpdate&&(void 0!==(t=this.attributes.lineDistance)&&(t.copyArray(r.lineDistances),t.needsUpdate=!0),r.lineDistancesNeedUpdate=!1),r.groupsNeedUpdate&&(r.computeGroups(e.geometry),this.groups=r.groups,r.groupsNeedUpdate=!1),this},fromGeometry:function(e){return e.__directGeometry=(new Mi).fromGeometry(e),this.fromDirectGeometry(e.__directGeometry)},fromDirectGeometry:function(e){var t=new Float32Array(3*e.vertices.length);if(this.addAttribute("position",new mi(t,3).copyVector3sArray(e.vertices)),0<e.normals.length){var r=new Float32Array(3*e.normals.length);this.addAttribute("normal",new mi(r,3).copyVector3sArray(e.normals))}if(0<e.colors.length){var i=new Float32Array(3*e.colors.length);this.addAttribute("color",new mi(i,3).copyColorsArray(e.colors))}if(0<e.uvs.length){var n=new Float32Array(2*e.uvs.length);this.addAttribute("uv",new mi(n,2).copyVector2sArray(e.uvs))}if(0<e.uvs2.length){var o=new Float32Array(2*e.uvs2.length);this.addAttribute("uv2",new mi(o,2).copyVector2sArray(e.uvs2))}for(var a in this.groups=e.groups,e.morphTargets){for(var s=[],l=e.morphTargets[a],c=0,u=l.length;c<u;c++){var h=l[c],p=new wi(3*h.data.length,3);p.name=h.name,s.push(p.copyVector3sArray(h.data))}this.morphAttributes[a]=s}if(0<e.skinIndices.length){var d=new wi(4*e.skinIndices.length,4);this.addAttribute("skinIndex",d.copyVector4sArray(e.skinIndices))}if(0<e.skinWeights.length){var f=new wi(4*e.skinWeights.length,4);this.addAttribute("skinWeight",f.copyVector4sArray(e.skinWeights))}return null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),this},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new yr);var e=this.attributes.position;void 0!==e?this.boundingBox.setFromBufferAttribute(e):this.boundingBox.makeEmpty(),(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)},computeBoundingSphere:(Pi=new yr,Ai=new Wt,function(){null===this.boundingSphere&&(this.boundingSphere=new br);var e=this.attributes.position;if(e){var t=this.boundingSphere.center;Pi.setFromBufferAttribute(e),Pi.getCenter(t);for(var r=0,i=0,n=e.count;i<n;i++)Ai.x=e.getX(i),Ai.y=e.getY(i),Ai.z=e.getZ(i),r=Math.max(r,t.distanceToSquared(Ai));this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}),computeFaceNormals:function(){},computeVertexNormals:function(){var e=this.index,t=this.attributes;if(t.position){var r=t.position.array;if(void 0===t.normal)this.addAttribute("normal",new mi(new Float32Array(r.length),3));else for(var i=t.normal.array,n=0,o=i.length;n<o;n++)i[n]=0;var a,s,l,c=t.normal.array,u=new Wt,h=new Wt,p=new Wt,d=new Wt,f=new Wt;if(e){var m=e.array;for(n=0,o=e.count;n<o;n+=3)a=3*m[n+0],s=3*m[n+1],l=3*m[n+2],u.fromArray(r,a),h.fromArray(r,s),p.fromArray(r,l),d.subVectors(p,h),f.subVectors(u,h),d.cross(f),c[a]+=d.x,c[a+1]+=d.y,c[a+2]+=d.z,c[s]+=d.x,c[s+1]+=d.y,c[s+2]+=d.z,c[l]+=d.x,c[l+1]+=d.y,c[l+2]+=d.z}else for(n=0,o=r.length;n<o;n+=9)u.fromArray(r,n),h.fromArray(r,n+3),p.fromArray(r,n+6),d.subVectors(p,h),f.subVectors(u,h),d.cross(f),c[n]=d.x,c[n+1]=d.y,c[n+2]=d.z,c[n+3]=d.x,c[n+4]=d.y,c[n+5]=d.z,c[n+6]=d.x,c[n+7]=d.y,c[n+8]=d.z;this.normalizeNormals(),t.normal.needsUpdate=!0}},merge:function(e,t){if(e&&e.isBufferGeometry){void 0===t&&(t=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));var r=this.attributes;for(var i in r)if(void 0!==e.attributes[i])for(var n=r[i].array,o=e.attributes[i],a=o.array,s=0,l=o.itemSize*t;s<a.length;s++,l++)n[l]=a[s];return this}console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e)},normalizeNormals:(Ri=new Wt,function(){for(var e=this.attributes.normal,t=0,r=e.count;t<r;t++)Ri.x=e.getX(t),Ri.y=e.getY(t),Ri.z=e.getZ(t),Ri.normalize(),e.setXYZ(t,Ri.x,Ri.y,Ri.z)}),toNonIndexed:function(){function e(e,t){for(var r=e.array,i=e.itemSize,n=new r.constructor(t.length*i),o=0,a=0,s=0,l=t.length;s<l;s++){o=t[s]*i;for(var c=0;c<i;c++)n[a++]=r[o++]}return new mi(n,i)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): Geometry is already non-indexed."),this;var t=new Ni,r=this.index.array,i=this.attributes;for(var n in i){var o=e(i[n],r);t.addAttribute(n,o)}var a=this.morphAttributes;for(n in a){for(var s=[],l=a[n],c=0,u=l.length;c<u;c++){o=e(l[c],r);s.push(o)}t.morphAttributes[n]=s}for(var h=this.groups,p=(c=0,h.length);c<p;c++){var d=h[c];t.addGroup(d.start,d.count,d.materialIndex)}return t},toJSON:function(){var e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),0<Object.keys(this.userData).length&&(e.userData=this.userData),void 0!==this.parameters){var t=this.parameters;for(var r in t)void 0!==t[r]&&(e[r]=t[r]);return e}e.data={attributes:{}};var i=this.index;if(null!==i){var n=Array.prototype.slice.call(i.array);e.data.index={type:i.array.constructor.name,array:n}}var o=this.attributes;for(var r in o){var a=o[r];n=Array.prototype.slice.call(a.array);e.data.attributes[r]={itemSize:a.itemSize,type:a.array.constructor.name,array:n,normalized:a.normalized}}var s=this.groups;0<s.length&&(e.data.groups=JSON.parse(JSON.stringify(s)));var l=this.boundingSphere;return null!==l&&(e.data.boundingSphere={center:l.center.toArray(),radius:l.radius}),e},clone:function(){return(new Ni).copy(this)},copy:function(e){var t,r,i;this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.name=e.name;var n=e.index;null!==n&&this.setIndex(n.clone());var o=e.attributes;for(t in o){var a=o[t];this.addAttribute(t,a.clone())}var s=e.morphAttributes;for(t in s){var l=[],c=s[t];for(r=0,i=c.length;r<i;r++)l.push(c[r].clone());this.morphAttributes[t]=l}var u=e.groups;for(r=0,i=u.length;r<i;r++){var h=u[r];this.addGroup(h.start,h.count,h.materialIndex)}var p=e.boundingBox;null!==p&&(this.boundingBox=p.clone());var d=e.boundingSphere;return null!==d&&(this.boundingSphere=d.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),(Di.prototype=Object.create(fi.prototype)).constructor=Di,(Ui.prototype=Object.create(Ni.prototype)).constructor=Ui,(Vi.prototype=Object.create(fi.prototype)).constructor=Vi,(Bi.prototype=Object.create(Ni.prototype)).constructor=Bi;var zi,qi,Gi,Wi,Xi,Yi,Qi,Ji,Zi,Ki,$i,en,tn,rn,nn,on,an,sn,ln,cn,un,hn,pn,dn,fn,mn=0;function gn(){Object.defineProperty(this,"id",{value:mn++}),this.uuid=Bt.generateUUID(),this.name="",this.type="Material",this.fog=!0,this.lights=!0,this.blending=J,this.side=k,this.flatShading=!1,this.vertexColors=T,this.opacity=1,this.transparent=!1,this.blendSrc=F,this.blendDst=I,this.blendEquation=re,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=ae,this.depthTest=!0,this.depthWrite=!0,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.premultipliedAlpha=!1,this.visible=!0,this.userData={},this.needsUpdate=!0}function vn(e){gn.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,void 0!==e&&(void 0!==e.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(e))}function yn(e,t){this.origin=void 0!==e?e:new Wt,this.direction=void 0!==t?t:new Wt}function bn(e,t,r){this.a=void 0!==e?e:new Wt,this.b=void 0!==t?t:new Wt,this.c=void 0!==r?r:new Wt}function xn(e){gn.call(this),this.type="MeshBasicMaterial",this.color=new Cr(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=q,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.lights=!1,this.setValues(e)}function En(e,t){oi.call(this),this.type="Mesh",this.geometry=void 0!==e?e:new Ni,this.material=void 0!==t?t:new xn({color:16777215*Math.random()}),this.drawMode=Ct,this.updateMorphTargets()}function _n(a,r,s,i){var l,c,u=new Cr(0),h=0,p=null,d=0;function f(e,t){r.buffers.color.setClear(e.r,e.g,e.b,t,i)}return{getClearColor:function(){return u},setClearColor:function(e,t){u.set(e),f(u,h=void 0!==t?t:1)},getClearAlpha:function(){return h},setClearAlpha:function(e){f(u,h=e)},render:function(e,t,r,i){var n=t.background;if(null===n?(f(u,h),p=null,d=0):n&&n.isColor&&(f(n,1),i=!0,p=null,d=0),(a.autoClear||i)&&a.clear(a.autoClearColor,a.autoClearDepth,a.autoClearStencil),n&&(n.isCubeTexture||n.isWebGLRenderTargetCube)){void 0===c&&((c=new En(new Ui(1,1,1),new vn({type:"BackgroundCubeMaterial",uniforms:wr(Fr.cube.uniforms),vertexShader:Fr.cube.vertexShader,fragmentShader:Fr.cube.fragmentShader,side:we,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.removeAttribute("normal"),c.geometry.removeAttribute("uv"),c.onBeforeRender=function(e,t,r){this.matrixWorld.copyPosition(r.matrixWorld)},Object.defineProperty(c.material,"map",{get:function(){return this.uniforms.tCube.value}}),s.update(c));var o=n.isWebGLRenderTargetCube?n.texture:n;c.material.uniforms.tCube.value=o,c.material.uniforms.tFlip.value=n.isWebGLRenderTargetCube?1:-1,o.colorMatrix?c.material.uniforms.colorMatrix.value.copy(o.colorMatrix):c.material.uniforms.colorMatrix.value.identity(),p===n&&d===o.version||(c.material.needsUpdate=!0,p=n,d=o.version),e.unshift(c,c.geometry,c.material,0,0,null)}else n&&n.isTexture&&(void 0===l&&((l=new En(new Bi(2,2),new vn({type:"BackgroundMaterial",uniforms:wr(Fr.background.uniforms),vertexShader:Fr.background.vertexShader,fragmentShader:Fr.background.fragmentShader,side:k,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.removeAttribute("normal"),Object.defineProperty(l.material,"map",{get:function(){return this.uniforms.t2D.value}}),s.update(l)),!0===(l.material.uniforms.t2D.value=n).matrixAutoUpdate&&n.updateMatrix(),l.material.uniforms.uvTransform.value.copy(n.matrix),p===n&&d===n.version||(l.material.needsUpdate=!0,d=(p=n).version),e.unshift(l,l.geometry,l.material,0,0,null))}}}function wn(n,o,a,s){var l;this.setMode=function(e){l=e},this.render=function(e,t){n.drawArrays(l,e,t),a.update(t,l)},this.renderInstances=function(e,t,r){var i;if(s.isWebGL2)i=n;else if(null===(i=o.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");i[s.isWebGL2?"drawArraysInstanced":"drawArraysInstancedANGLE"](l,t,r,e.maxInstancedCount),a.update(r,l,e.maxInstancedCount)}}function Tn(t,r,e){var i;function n(e){if("highp"===e){if(0<t.getShaderPrecisionFormat(35633,36338).precision&&0<t.getShaderPrecisionFormat(35632,36338).precision)return"highp";e="mediump"}return"mediump"===e&&0<t.getShaderPrecisionFormat(35633,36337).precision&&0<t.getShaderPrecisionFormat(35632,36337).precision?"mediump":"lowp"}var o="undefined"!=typeof WebGL2RenderingContext&&t instanceof WebGL2RenderingContext,a=void 0!==e.precision?e.precision:"highp",s=n(a);s!==a&&(console.warn("THREE.WebGLRenderer:",a,"not supported, using",s,"instead."),a=s);var l=!0===e.logarithmicDepthBuffer,c=t.getParameter(34930),u=t.getParameter(35660),h=t.getParameter(3379),p=t.getParameter(34076),d=t.getParameter(34921),f=t.getParameter(36347),m=t.getParameter(36348),g=t.getParameter(36349),v=0<u,y=o||!!r.get("OES_texture_float");return{isWebGL2:o,getMaxAnisotropy:function(){if(void 0!==i)return i;var e=r.get("EXT_texture_filter_anisotropic");return i=null!==e?t.getParameter(e.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0},getMaxPrecision:n,precision:a,logarithmicDepthBuffer:l,maxTextures:c,maxVertexTextures:u,maxTextureSize:h,maxCubemapSize:p,maxAttributes:d,maxVertexUniforms:f,maxVaryings:m,maxFragmentUniforms:g,vertexTextures:v,floatFragmentTextures:y,floatVertexTextures:v&&y,maxSamples:o?t.getParameter(36183):0}}function Mn(){var u=this,h=null,p=0,d=!1,f=!1,m=new xr,g=new Xt,v={value:null,needsUpdate:!1};function y(){v.value!==h&&(v.value=h,v.needsUpdate=0<p),u.numPlanes=p,u.numIntersection=0}function b(e,t,r,i){var n=null!==e?e.length:0,o=null;if(0!==n){if(o=v.value,!0!==i||null===o){var a=r+4*n,s=t.matrixWorldInverse;g.getNormalMatrix(s),(null===o||o.length<a)&&(o=new Float32Array(a));for(var l=0,c=r;l!==n;++l,c+=4)m.copy(e[l]).applyMatrix4(s,g),m.normal.toArray(o,c),o[c+3]=m.constant}v.value=o,v.needsUpdate=!0}return u.numPlanes=n,o}this.uniform=v,this.numPlanes=0,this.numIntersection=0,this.init=function(e,t,r){var i=0!==e.length||t||0!==p||d;return d=t,h=b(e,r,0),p=e.length,i},this.beginShadows=function(){f=!0,b(null)},this.endShadows=function(){f=!1,y()},this.setState=function(e,t,r,i,n,o){if(!d||null===e||0===e.length||f&&!r)f?b(null):y();else{var a=f?0:p,s=4*a,l=n.clippingState||null;v.value=l,l=b(e,i,s,o);for(var c=0;c!==s;++c)l[c]=h[c];n.clippingState=l,this.numIntersection=t?this.numPlanes:0,this.numPlanes+=a}}}function Sn(r){var i={};return{get:function(e){if(void 0!==i[e])return i[e];var t;switch(e){case"WEBGL_depth_texture":t=r.getExtension("WEBGL_depth_texture")||r.getExtension("MOZ_WEBGL_depth_texture")||r.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":t=r.getExtension("EXT_texture_filter_anisotropic")||r.getExtension("MOZ_EXT_texture_filter_anisotropic")||r.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":t=r.getExtension("WEBGL_compressed_texture_s3tc")||r.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||r.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":t=r.getExtension("WEBGL_compressed_texture_pvrtc")||r.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:t=r.getExtension(e)}return null===t&&console.warn("THREE.WebGLRenderer: "+e+" extension not supported."),i[e]=t}}}function Rn(e,h,o){var a={},p={};function s(e){var t=e.target,r=a[t.id];for(var i in null!==r.index&&h.remove(r.index),r.attributes)h.remove(r.attributes[i]);t.removeEventListener("dispose",s),delete a[t.id];var n=p[r.id];n&&(h.remove(n),delete p[r.id]),o.memory.geometries--}return{get:function(e,t){var r=a[t.id];return r||(t.addEventListener("dispose",s),t.isBufferGeometry?r=t:t.isGeometry&&(void 0===t._bufferGeometry&&(t._bufferGeometry=(new Ni).setFromObject(e)),r=t._bufferGeometry),a[t.id]=r,o.memory.geometries++,r)},update:function(e){var t=e.index,r=e.attributes;for(var i in null!==t&&h.update(t,34963),r)h.update(r[i],34962);var n=e.morphAttributes;for(var i in n)for(var o=n[i],a=0,s=o.length;a<s;a++)h.update(o[a],34962)},getWireframeAttribute:function(e){var t=p[e.id];if(t)return t;var r,i=[],n=e.index,o=e.attributes;if(null!==n)for(var a=0,s=(r=n.array).length;a<s;a+=3){var l=r[a+0],c=r[a+1],u=r[a+2];i.push(l,c,c,u,u,l)}else for(a=0,s=(r=o.position.array).length/3-1;a<s;a+=3)l=a+0,c=a+1,u=a+2,i.push(l,c,c,u,u,l);return t=new(65535<Si(i)?_i:xi)(i,1),h.update(t,34963),p[e.id]=t}}}function Pn(n,o,a,s){var l,c,u;this.setMode=function(e){l=e},this.setIndex=function(e){c=e.type,u=e.bytesPerElement},this.render=function(e,t){n.drawElements(l,t,c,e*u),a.update(t,l)},this.renderInstances=function(e,t,r){var i;if(s.isWebGL2)i=n;else if(null===(i=o.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");i[s.isWebGL2?"drawElementsInstanced":"drawElementsInstancedANGLE"](l,r,c,t*u,e.maxInstancedCount),a.update(r,l,e.maxInstancedCount)}}function An(e){var i={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:i,programs:null,autoReset:!0,reset:function(){i.frame++,i.calls=0,i.triangles=0,i.points=0,i.lines=0},update:function(e,t,r){switch(r=r||1,i.calls++,t){case 4:i.triangles+=r*(e/3);break;case 5:case 6:i.triangles+=r*(e-2);break;case 1:i.lines+=r*(e/2);break;case 3:i.lines+=r*(e-1);break;case 2:i.lines+=r*e;break;case 0:i.points+=r*e;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",t)}}}}function Cn(e,t){return Math.abs(t[1])-Math.abs(e[1])}function Ln(d){var f={},m=new Float32Array(8);return{update:function(e,t,r,i){var n=e.morphTargetInfluences,o=n.length,a=f[t.id];if(void 0===a){a=[];for(var s=0;s<o;s++)a[s]=[s,0];f[t.id]=a}var l=r.morphTargets&&t.morphAttributes.position,c=r.morphNormals&&t.morphAttributes.normal;for(s=0;s<o;s++)0!==(u=a[s])[1]&&(l&&t.removeAttribute("morphTarget"+s),c&&t.removeAttribute("morphNormal"+s));for(s=0;s<o;s++)(u=a[s])[0]=s,u[1]=n[s];for(a.sort(Cn),s=0;s<8;s++){var u;if(u=a[s]){var h=u[0],p=u[1];if(p){l&&t.addAttribute("morphTarget"+s,l[h]),c&&t.addAttribute("morphNormal"+s,c[h]),m[s]=p;continue}}m[s]=0}i.getUniforms().setValue(d,"morphTargetInfluences",m)}}}function On(n,o){var a={};return{update:function(e){var t=o.render.frame,r=e.geometry,i=n.get(e,r);return a[i.id]!==t&&(r.isGeometry&&i.updateFromObject(e),n.update(i),a[i.id]=t),i},dispose:function(){a={}}}}function Hn(e,t,r,i,n,o,a,s,l,c){pr.call(this,e=void 0!==e?e:[],t=void 0!==t?t:ve,r,i,n,o,a,s,l,c),this.flipY=!1}function Fn(e,t,r,i){pr.call(this,null),this.image={data:e,width:t,height:r,depth:i},this.magFilter=Ae,this.minFilter=Ae,this.generateMipmaps=!1,this.flipY=!1}gn.prototype=Object.assign(Object.create(t.prototype),{constructor:gn,isMaterial:!0,onBeforeCompile:function(){},setValues:function(e){if(void 0!==e)for(var t in e){var r=e[t];if(void 0!==r)if("shading"!==t){var i=this[t];void 0!==i?i&&i.isColor?i.set(r):i&&i.isVector3&&r&&r.isVector3?i.copy(r):this[t]=r:console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.")}else console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===r;else console.warn("THREE.Material: '"+t+"' parameter is undefined.")}},toJSON:function(e){var t=void 0===e||"string"==typeof e;t&&(e={textures:{},images:{}});var r={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function i(e){var t=[];for(var r in e){var i=e[r];delete i.metadata,t.push(i)}return t}if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),this.color&&this.color.isColor&&(r.color=this.color.getHex()),void 0!==this.roughness&&(r.roughness=this.roughness),void 0!==this.metalness&&(r.metalness=this.metalness),this.emissive&&this.emissive.isColor&&(r.emissive=this.emissive.getHex()),1!==this.emissiveIntensity&&(r.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(r.specular=this.specular.getHex()),void 0!==this.shininess&&(r.shininess=this.shininess),void 0!==this.clearCoat&&(r.clearCoat=this.clearCoat),void 0!==this.clearCoatRoughness&&(r.clearCoatRoughness=this.clearCoatRoughness),this.map&&this.map.isTexture&&(r.map=this.map.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(r.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(r.lightMap=this.lightMap.toJSON(e).uuid),this.aoMap&&this.aoMap.isTexture&&(r.aoMap=this.aoMap.toJSON(e).uuid,r.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(r.bumpMap=this.bumpMap.toJSON(e).uuid,r.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(r.normalMap=this.normalMap.toJSON(e).uuid,r.normalMapType=this.normalMapType,r.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(r.displacementMap=this.displacementMap.toJSON(e).uuid,r.displacementScale=this.displacementScale,r.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(r.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(r.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(r.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(r.specularMap=this.specularMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(r.envMap=this.envMap.toJSON(e).uuid,r.reflectivity=this.reflectivity,void 0!==this.combine&&(r.combine=this.combine),void 0!==this.envMapIntensity&&(r.envMapIntensity=this.envMapIntensity)),this.gradientMap&&this.gradientMap.isTexture&&(r.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.size&&(r.size=this.size),void 0!==this.sizeAttenuation&&(r.sizeAttenuation=this.sizeAttenuation),this.blending!==J&&(r.blending=this.blending),!0===this.flatShading&&(r.flatShading=this.flatShading),this.side!==k&&(r.side=this.side),this.vertexColors!==T&&(r.vertexColors=this.vertexColors),this.opacity<1&&(r.opacity=this.opacity),!0===this.transparent&&(r.transparent=this.transparent),r.depthFunc=this.depthFunc,r.depthTest=this.depthTest,r.depthWrite=this.depthWrite,0!==this.rotation&&(r.rotation=this.rotation),!0===this.polygonOffset&&(r.polygonOffset=!0),0!==this.polygonOffsetFactor&&(r.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(r.polygonOffsetUnits=this.polygonOffsetUnits),1!==this.linewidth&&(r.linewidth=this.linewidth),void 0!==this.dashSize&&(r.dashSize=this.dashSize),void 0!==this.gapSize&&(r.gapSize=this.gapSize),void 0!==this.scale&&(r.scale=this.scale),!0===this.dithering&&(r.dithering=!0),0<this.alphaTest&&(r.alphaTest=this.alphaTest),!0===this.premultipliedAlpha&&(r.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(r.wireframe=this.wireframe),1<this.wireframeLinewidth&&(r.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(r.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(r.wireframeLinejoin=this.wireframeLinejoin),!0===this.morphTargets&&(r.morphTargets=!0),!0===this.skinning&&(r.skinning=!0),!1===this.visible&&(r.visible=!1),"{}"!==JSON.stringify(this.userData)&&(r.userData=this.userData),t){var n=i(e.textures),o=i(e.images);0<n.length&&(r.textures=n),0<o.length&&(r.images=o)}return r},clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.name=e.name,this.fog=e.fog,this.lights=e.lights,this.blending=e.blending,this.side=e.side,this.flatShading=e.flatShading,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.userData=JSON.parse(JSON.stringify(e.userData)),this.clipShadows=e.clipShadows,this.clipIntersection=e.clipIntersection;var t=e.clippingPlanes,r=null;if(null!==t){var i=t.length;r=new Array(i);for(var n=0;n!==i;++n)r[n]=t[n].clone()}return this.clippingPlanes=r,this.shadowSide=e.shadowSide,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),((vn.prototype=Object.create(gn.prototype)).constructor=vn).prototype.isShaderMaterial=!0,vn.prototype.copy=function(e){return gn.prototype.copy.call(this,e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=wr(e.uniforms),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.extensions=e.extensions,this},vn.prototype.toJSON=function(e){var t=gn.prototype.toJSON.call(this,e);for(var r in t.uniforms={},this.uniforms){var i=this.uniforms[r].value;i&&i.isTexture?t.uniforms[r]={type:"t",value:i.toJSON(e).uuid}:i&&i.isColor?t.uniforms[r]={type:"c",value:i.getHex()}:i&&i.isVector2?t.uniforms[r]={type:"v2",value:i.toArray()}:i&&i.isVector3?t.uniforms[r]={type:"v3",value:i.toArray()}:i&&i.isVector4?t.uniforms[r]={type:"v4",value:i.toArray()}:i&&i.isMatrix3?t.uniforms[r]={type:"m3",value:i.toArray()}:i&&i.isMatrix4?t.uniforms[r]={type:"m4",value:i.toArray()}:t.uniforms[r]={value:i}}0<Object.keys(this.defines).length&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;var n={};for(var o in this.extensions)!0===this.extensions[o]&&(n[o]=!0);return 0<Object.keys(n).length&&(t.extensions=n),t},Object.assign(yn.prototype,{set:function(e,t){return this.origin.copy(e),this.direction.copy(t),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this},at:function(e,t){return void 0===t&&(console.warn("THREE.Ray: .at() target is now required"),t=new Wt),t.copy(this.direction).multiplyScalar(e).add(this.origin)},lookAt:function(e){return this.direction.copy(e).sub(this.origin).normalize(),this},recast:($i=new Wt,function(e){return this.origin.copy(this.at(e,$i)),this}),closestPointToPoint:function(e,t){void 0===t&&(console.warn("THREE.Ray: .closestPointToPoint() target is now required"),t=new Wt),t.subVectors(e,this.origin);var r=t.dot(this.direction);return r<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(r).add(this.origin)},distanceToPoint:function(e){return Math.sqrt(this.distanceSqToPoint(e))},distanceSqToPoint:(Ki=new Wt,function(e){var t=Ki.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(Ki.copy(this.direction).multiplyScalar(t).add(this.origin),Ki.distanceToSquared(e))}),distanceSqToSegment:(Qi=new Wt,Ji=new Wt,Zi=new Wt,function(e,t,r,i){Qi.copy(e).add(t).multiplyScalar(.5),Ji.copy(t).sub(e).normalize(),Zi.copy(this.origin).sub(Qi);var n,o,a,s,l=.5*e.distanceTo(t),c=-this.direction.dot(Ji),u=Zi.dot(this.direction),h=-Zi.dot(Ji),p=Zi.lengthSq(),d=Math.abs(1-c*c);if(0<d)if(o=c*u-h,s=l*d,0<=(n=c*h-u))if(-s<=o)if(o<=s){var f=1/d;a=(n*=f)*(n+c*(o*=f)+2*u)+o*(c*n+o+2*h)+p}else o=l,a=-(n=Math.max(0,-(c*o+u)))*n+o*(o+2*h)+p;else o=-l,a=-(n=Math.max(0,-(c*o+u)))*n+o*(o+2*h)+p;else a=o<=-s?-(n=Math.max(0,-(-c*l+u)))*n+(o=0<n?-l:Math.min(Math.max(-l,-h),l))*(o+2*h)+p:o<=s?(n=0,(o=Math.min(Math.max(-l,-h),l))*(o+2*h)+p):-(n=Math.max(0,-(c*l+u)))*n+(o=0<n?l:Math.min(Math.max(-l,-h),l))*(o+2*h)+p;else o=0<c?-l:l,a=-(n=Math.max(0,-(c*o+u)))*n+o*(o+2*h)+p;return r&&r.copy(this.direction).multiplyScalar(n).add(this.origin),i&&i.copy(Ji).multiplyScalar(o).add(Qi),a}),intersectSphere:(Yi=new Wt,function(e,t){Yi.subVectors(e.center,this.origin);var r=Yi.dot(this.direction),i=Yi.dot(Yi)-r*r,n=e.radius*e.radius;if(n<i)return null;var o=Math.sqrt(n-i),a=r-o,s=r+o;return a<0&&s<0?null:a<0?this.at(s,t):this.at(a,t)}),intersectsSphere:function(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius},distanceToPlane:function(e){var t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;var r=-(this.origin.dot(e.normal)+e.constant)/t;return 0<=r?r:null},intersectPlane:function(e,t){var r=this.distanceToPlane(e);return null===r?null:this.at(r,t)},intersectsPlane:function(e){var t=e.distanceToPoint(this.origin);return 0===t||e.normal.dot(this.direction)*t<0},intersectBox:function(e,t){var r,i,n,o,a,s,l=1/this.direction.x,c=1/this.direction.y,u=1/this.direction.z,h=this.origin;return i=0<=l?(r=(e.min.x-h.x)*l,(e.max.x-h.x)*l):(r=(e.max.x-h.x)*l,(e.min.x-h.x)*l),(o=0<=c?(n=(e.min.y-h.y)*c,(e.max.y-h.y)*c):(n=(e.max.y-h.y)*c,(e.min.y-h.y)*c))<r||i<n?null:((r<n||r!=r)&&(r=n),(o<i||i!=i)&&(i=o),(s=0<=u?(a=(e.min.z-h.z)*u,(e.max.z-h.z)*u):(a=(e.max.z-h.z)*u,(e.min.z-h.z)*u))<r||i<a?null:((r<a||r!=r)&&(r=a),(s<i||i!=i)&&(i=s),i<0?null:this.at(0<=r?r:i,t)))},intersectsBox:(Xi=new Wt,function(e){return null!==this.intersectBox(e,Xi)}),intersectTriangle:(zi=new Wt,qi=new Wt,Gi=new Wt,Wi=new Wt,function(e,t,r,i,n){qi.subVectors(t,e),Gi.subVectors(r,e),Wi.crossVectors(qi,Gi);var o,a=this.direction.dot(Wi);if(0<a){if(i)return null;o=1}else{if(!(a<0))return null;o=-1,a=-a}zi.subVectors(this.origin,e);var s=o*this.direction.dot(Gi.crossVectors(zi,Gi));if(s<0)return null;var l=o*this.direction.dot(qi.cross(zi));if(l<0)return null;if(a<s+l)return null;var c=-o*zi.dot(Wi);return c<0?null:this.at(c/a,n)}),applyMatrix4:function(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this},equals:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}}),Object.assign(bn,{getNormal:(an=new Wt,function(e,t,r,i){void 0===i&&(console.warn("THREE.Triangle: .getNormal() target is now required"),i=new Wt),i.subVectors(r,t),an.subVectors(e,t),i.cross(an);var n=i.lengthSq();return 0<n?i.multiplyScalar(1/Math.sqrt(n)):i.set(0,0,0)}),getBarycoord:(rn=new Wt,nn=new Wt,on=new Wt,function(e,t,r,i,n){rn.subVectors(i,t),nn.subVectors(r,t),on.subVectors(e,t);var o=rn.dot(rn),a=rn.dot(nn),s=rn.dot(on),l=nn.dot(nn),c=nn.dot(on),u=o*l-a*a;if(void 0===n&&(console.warn("THREE.Triangle: .getBarycoord() target is now required"),n=new Wt),0===u)return n.set(-2,-1,-1);var h=1/u,p=(l*s-a*c)*h,d=(o*c-a*s)*h;return n.set(1-p-d,d,p)}),containsPoint:(tn=new Wt,function(e,t,r,i){return bn.getBarycoord(e,t,r,i,tn),0<=tn.x&&0<=tn.y&&tn.x+tn.y<=1}),getUV:(en=new Wt,function(e,t,r,i,n,o,a,s){return this.getBarycoord(e,t,r,i,en),s.set(0,0),s.addScaledVector(n,en.x),s.addScaledVector(o,en.y),s.addScaledVector(a,en.z),s})}),Object.assign(bn.prototype,{set:function(e,t,r){return this.a.copy(e),this.b.copy(t),this.c.copy(r),this},setFromPointsAndIndices:function(e,t,r,i){return this.a.copy(e[t]),this.b.copy(e[r]),this.c.copy(e[i]),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this},getArea:(dn=new Wt,fn=new Wt,function(){return dn.subVectors(this.c,this.b),fn.subVectors(this.a,this.b),.5*dn.cross(fn).length()}),getMidpoint:function(e){return void 0===e&&(console.warn("THREE.Triangle: .getMidpoint() target is now required"),e=new Wt),e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},getNormal:function(e){return bn.getNormal(this.a,this.b,this.c,e)},getPlane:function(e){return void 0===e&&(console.warn("THREE.Triangle: .getPlane() target is now required"),e=new Wt),e.setFromCoplanarPoints(this.a,this.b,this.c)},getBarycoord:function(e,t){return bn.getBarycoord(e,this.a,this.b,this.c,t)},containsPoint:function(e){return bn.containsPoint(e,this.a,this.b,this.c)},getUV:function(e,t,r,i,n){return bn.getUV(e,this.a,this.b,this.c,t,r,i,n)},intersectsBox:function(e){return e.intersectsTriangle(this)},closestPointToPoint:(sn=new Wt,ln=new Wt,cn=new Wt,un=new Wt,hn=new Wt,pn=new Wt,function(e,t){void 0===t&&(console.warn("THREE.Triangle: .closestPointToPoint() target is now required"),t=new Wt);var r,i,n=this.a,o=this.b,a=this.c;sn.subVectors(o,n),ln.subVectors(a,n),un.subVectors(e,n);var s=sn.dot(un),l=ln.dot(un);if(s<=0&&l<=0)return t.copy(n);hn.subVectors(e,o);var c=sn.dot(hn),u=ln.dot(hn);if(0<=c&&u<=c)return t.copy(o);var h=s*u-c*l;if(h<=0&&0<=s&&c<=0)return r=s/(s-c),t.copy(n).addScaledVector(sn,r);pn.subVectors(e,a);var p=sn.dot(pn),d=ln.dot(pn);if(0<=d&&p<=d)return t.copy(a);var f=p*l-s*d;if(f<=0&&0<=l&&d<=0)return i=l/(l-d),t.copy(n).addScaledVector(ln,i);var m=c*d-p*u;if(m<=0&&0<=u-c&&0<=p-d)return cn.subVectors(a,o),i=(u-c)/(u-c+(p-d)),t.copy(o).addScaledVector(cn,i);var g=1/(m+f+h);return r=f*g,i=h*g,t.copy(n).addScaledVector(sn,r).addScaledVector(ln,i)}),equals:function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}),((xn.prototype=Object.create(gn.prototype)).constructor=xn).prototype.isMeshBasicMaterial=!0,xn.prototype.copy=function(e){return gn.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this},En.prototype=Object.assign(Object.create(oi.prototype),{constructor:En,isMesh:!0,setDrawMode:function(e){this.drawMode=e},copy:function(e){return oi.prototype.copy.call(this,e),this.drawMode=e.drawMode,void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this},updateMorphTargets:function(){var e,t,r,i=this.geometry;if(i.isBufferGeometry){var n=i.morphAttributes,o=Object.keys(n);if(0<o.length){var a=n[o[0]];if(void 0!==a)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},e=0,t=a.length;e<t;e++)r=a[e].name||String(e),this.morphTargetInfluences.push(0),this.morphTargetDictionary[r]=e}}else{var s=i.morphTargets;void 0!==s&&0<s.length&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}},raycast:function(){var D=new qt,U=new yn,V=new br,B=new Wt,z=new Wt,q=new Wt,G=new Wt,W=new Wt,X=new Wt,Y=new zt,Q=new zt,J=new zt,Z=new Wt,c=new Wt;function K(e,t,r,i,n,o,a,s){if(null===(t.side===we?i.intersectTriangle(a,o,n,!0,s):i.intersectTriangle(n,o,a,t.side!==ee,s)))return null;c.copy(s),c.applyMatrix4(e.matrixWorld);var l=r.ray.origin.distanceTo(c);return l<r.near||l>r.far?null:{distance:l,point:c.clone(),object:e}}function $(e,t,r,i,n,o,a,s,l){B.fromBufferAttribute(n,a),z.fromBufferAttribute(n,s),q.fromBufferAttribute(n,l);var c=K(e,t,r,i,B,z,q,Z);if(c){o&&(Y.fromBufferAttribute(o,a),Q.fromBufferAttribute(o,s),J.fromBufferAttribute(o,l),c.uv=bn.getUV(Z,B,z,q,Y,Q,J,new zt));var u=new jr(a,s,l);bn.getNormal(B,z,q,u.normal),c.face=u}return c}return function(e,t){var r,i=this.geometry,n=this.material,o=this.matrixWorld;if(void 0!==n&&(null===i.boundingSphere&&i.computeBoundingSphere(),V.copy(i.boundingSphere),V.applyMatrix4(o),!1!==e.ray.intersectsSphere(V)&&(D.getInverse(o),U.copy(e.ray).applyMatrix4(D),null===i.boundingBox||!1!==U.intersectsBox(i.boundingBox))))if(i.isBufferGeometry){var a,s,l,c,u,h,p,d,f,m=i.index,g=i.attributes.position,v=i.attributes.uv,y=i.groups,b=i.drawRange;if(null!==m)if(Array.isArray(n))for(c=0,h=y.length;c<h;c++)for(f=n[(d=y[c]).materialIndex],u=Math.max(d.start,b.start),p=Math.min(d.start+d.count,b.start+b.count);u<p;u+=3)a=m.getX(u),s=m.getX(u+1),l=m.getX(u+2),(r=$(this,f,e,U,g,v,a,s,l))&&(r.faceIndex=Math.floor(u/3),r.face.materialIndex=d.materialIndex,t.push(r));else for(c=Math.max(0,b.start),h=Math.min(m.count,b.start+b.count);c<h;c+=3)a=m.getX(c),s=m.getX(c+1),l=m.getX(c+2),(r=$(this,n,e,U,g,v,a,s,l))&&(r.faceIndex=Math.floor(c/3),t.push(r));else if(void 0!==g)if(Array.isArray(n))for(c=0,h=y.length;c<h;c++)for(f=n[(d=y[c]).materialIndex],u=Math.max(d.start,b.start),p=Math.min(d.start+d.count,b.start+b.count);u<p;u+=3)(r=$(this,f,e,U,g,v,a=u,s=u+1,l=u+2))&&(r.faceIndex=Math.floor(u/3),r.face.materialIndex=d.materialIndex,t.push(r));else for(c=Math.max(0,b.start),h=Math.min(g.count,b.start+b.count);c<h;c+=3)(r=$(this,n,e,U,g,v,a=c,s=c+1,l=c+2))&&(r.faceIndex=Math.floor(c/3),t.push(r))}else if(i.isGeometry){var x,E,_,w,T=Array.isArray(n),M=i.vertices,S=i.faces,R=i.faceVertexUvs[0];0<R.length&&(w=R);for(var P=0,A=S.length;P<A;P++){var C=S[P],L=T?n[C.materialIndex]:n;if(void 0!==L){if(x=M[C.a],E=M[C.b],_=M[C.c],!0===L.morphTargets){var O=i.morphTargets,H=this.morphTargetInfluences;B.set(0,0,0),z.set(0,0,0),q.set(0,0,0);for(var F=0,k=O.length;F<k;F++){var I=H[F];if(0!==I){var j=O[F].vertices;B.addScaledVector(G.subVectors(j[C.a],x),I),z.addScaledVector(W.subVectors(j[C.b],E),I),q.addScaledVector(X.subVectors(j[C.c],_),I)}}B.add(x),z.add(E),q.add(_),x=B,E=z,_=q}if(r=K(this,L,e,U,x,E,_,Z)){if(w&&w[P]){var N=w[P];Y.copy(N[0]),Q.copy(N[1]),J.copy(N[2]),r.uv=bn.getUV(Z,x,E,_,Y,Q,J,new zt)}r.face=C,r.faceIndex=P,t.push(r)}}}}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),((Hn.prototype=Object.create(pr.prototype)).constructor=Hn).prototype.isCubeTexture=!0,Object.defineProperty(Hn.prototype,"images",{get:function(){return this.image},set:function(e){this.image=e}}),((Fn.prototype=Object.create(pr.prototype)).constructor=Fn).prototype.isDataTexture3D=!0;var kn=new pr,In=new Fn,jn=new Hn;function Nn(){this.seq=[],this.map={}}var Dn=[],Un=[],Vn=new Float32Array(16),Bn=new Float32Array(9),zn=new Float32Array(4);function qn(e,t,r){var i=e[0];if(i<=0||0<i)return e;var n=t*r,o=Dn[n];if(void 0===o&&(o=new Float32Array(n),Dn[n]=o),0!==t){i.toArray(o,0);for(var a=1,s=0;a!==t;++a)s+=r,e[a].toArray(o,s)}return o}function Gn(e,t){if(e.length!==t.length)return!1;for(var r=0,i=e.length;r<i;r++)if(e[r]!==t[r])return!1;return!0}function Wn(e,t){for(var r=0,i=t.length;r<i;r++)e[r]=t[r]}function Xn(e,t){var r=Un[t];void 0===r&&(r=new Int32Array(t),Un[t]=r);for(var i=0;i!==t;++i)r[i]=e.allocTextureUnit();return r}function Yn(e,t){var r=this.cache;r[0]!==t&&(e.uniform1f(this.addr,t),r[0]=t)}function Qn(e,t){var r=this.cache;r[0]!==t&&(e.uniform1i(this.addr,t),r[0]=t)}function Jn(e,t){var r=this.cache;if(void 0!==t.x)r[0]===t.x&&r[1]===t.y||(e.uniform2f(this.addr,t.x,t.y),r[0]=t.x,r[1]=t.y);else{if(Gn(r,t))return;e.uniform2fv(this.addr,t),Wn(r,t)}}function Zn(e,t){var r=this.cache;if(void 0!==t.x)r[0]===t.x&&r[1]===t.y&&r[2]===t.z||(e.uniform3f(this.addr,t.x,t.y,t.z),r[0]=t.x,r[1]=t.y,r[2]=t.z);else if(void 0!==t.r)r[0]===t.r&&r[1]===t.g&&r[2]===t.b||(e.uniform3f(this.addr,t.r,t.g,t.b),r[0]=t.r,r[1]=t.g,r[2]=t.b);else{if(Gn(r,t))return;e.uniform3fv(this.addr,t),Wn(r,t)}}function Kn(e,t){var r=this.cache;if(void 0!==t.x)r[0]===t.x&&r[1]===t.y&&r[2]===t.z&&r[3]===t.w||(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),r[0]=t.x,r[1]=t.y,r[2]=t.z,r[3]=t.w);else{if(Gn(r,t))return;e.uniform4fv(this.addr,t),Wn(r,t)}}function $n(e,t){var r=this.cache,i=t.elements;if(void 0===i){if(Gn(r,t))return;e.uniformMatrix2fv(this.addr,!1,t),Wn(r,t)}else{if(Gn(r,i))return;zn.set(i),e.uniformMatrix2fv(this.addr,!1,zn),Wn(r,i)}}function eo(e,t){var r=this.cache,i=t.elements;if(void 0===i){if(Gn(r,t))return;e.uniformMatrix3fv(this.addr,!1,t),Wn(r,t)}else{if(Gn(r,i))return;Bn.set(i),e.uniformMatrix3fv(this.addr,!1,Bn),Wn(r,i)}}function to(e,t){var r=this.cache,i=t.elements;if(void 0===i){if(Gn(r,t))return;e.uniformMatrix4fv(this.addr,!1,t),Wn(r,t)}else{if(Gn(r,i))return;Vn.set(i),e.uniformMatrix4fv(this.addr,!1,Vn),Wn(r,i)}}function ro(e,t,r){var i=this.cache,n=r.allocTextureUnit();i[0]!==n&&(e.uniform1i(this.addr,n),i[0]=n),r.setTexture2D(t||kn,n)}function io(e,t,r){var i=this.cache,n=r.allocTextureUnit();i[0]!==n&&(e.uniform1i(this.addr,n),i[0]=n),r.setTexture3D(t||In,n)}function no(e,t,r){var i=this.cache,n=r.allocTextureUnit();i[0]!==n&&(e.uniform1i(this.addr,n),i[0]=n),r.setTextureCube(t||jn,n)}function oo(e,t){var r=this.cache;Gn(r,t)||(e.uniform2iv(this.addr,t),Wn(r,t))}function ao(e,t){var r=this.cache;Gn(r,t)||(e.uniform3iv(this.addr,t),Wn(r,t))}function so(e,t){var r=this.cache;Gn(r,t)||(e.uniform4iv(this.addr,t),Wn(r,t))}function lo(e,t){var r=this.cache;Gn(r,t)||(e.uniform1fv(this.addr,t),Wn(r,t))}function co(e,t){var r=this.cache;Gn(r,t)||(e.uniform1iv(this.addr,t),Wn(r,t))}function uo(e,t){var r=this.cache,i=qn(t,this.size,2);Gn(r,i)||(e.uniform2fv(this.addr,i),this.updateCache(i))}function ho(e,t){var r=this.cache,i=qn(t,this.size,3);Gn(r,i)||(e.uniform3fv(this.addr,i),this.updateCache(i))}function po(e,t){var r=this.cache,i=qn(t,this.size,4);Gn(r,i)||(e.uniform4fv(this.addr,i),this.updateCache(i))}function fo(e,t){var r=this.cache,i=qn(t,this.size,4);Gn(r,i)||(e.uniformMatrix2fv(this.addr,!1,i),this.updateCache(i))}function mo(e,t){var r=this.cache,i=qn(t,this.size,9);Gn(r,i)||(e.uniformMatrix3fv(this.addr,!1,i),this.updateCache(i))}function go(e,t){var r=this.cache,i=qn(t,this.size,16);Gn(r,i)||(e.uniformMatrix4fv(this.addr,!1,i),this.updateCache(i))}function vo(e,t,r){var i=this.cache,n=t.length,o=Xn(r,n);!1===Gn(i,o)&&(e.uniform1iv(this.addr,o),Wn(i,o));for(var a=0;a!==n;++a)r.setTexture2D(t[a]||kn,o[a])}function yo(e,t,r){var i=this.cache,n=t.length,o=Xn(r,n);!1===Gn(i,o)&&(e.uniform1iv(this.addr,o),Wn(i,o));for(var a=0;a!==n;++a)r.setTextureCube(t[a]||jn,o[a])}function bo(e,t,r){this.id=e,this.addr=r,this.cache=[],this.setValue=function(e){switch(e){case 5126:return Yn;case 35664:return Jn;case 35665:return Zn;case 35666:return Kn;case 35674:return $n;case 35675:return eo;case 35676:return to;case 35678:case 36198:return ro;case 35679:return io;case 35680:return no;case 5124:case 35670:return Qn;case 35667:case 35671:return oo;case 35668:case 35672:return ao;case 35669:case 35673:return so}}(t.type)}function xo(e,t,r){this.id=e,this.addr=r,this.cache=[],this.size=t.size,this.setValue=function(e){switch(e){case 5126:return lo;case 35664:return uo;case 35665:return ho;case 35666:return po;case 35674:return fo;case 35675:return mo;case 35676:return go;case 35678:return vo;case 35680:return yo;case 5124:case 35670:return co;case 35667:case 35671:return oo;case 35668:case 35672:return ao;case 35669:case 35673:return so}}(t.type)}function Eo(e){this.id=e,Nn.call(this)}xo.prototype.updateCache=function(e){var t=this.cache;e instanceof Float32Array&&t.length!==e.length&&(this.cache=new Float32Array(e.length)),Wn(t,e)},Eo.prototype.setValue=function(e,t,r){for(var i=this.seq,n=0,o=i.length;n!==o;++n){var a=i[n];a.setValue(e,t[a.id],r)}};var _o=/([\w\d_]+)(\])?(\[|\.)?/g;function wo(e,t){e.seq.push(t),e.map[t.id]=t}function To(e,t,r){var i=e.name,n=i.length;for(_o.lastIndex=0;;){var o=_o.exec(i),a=_o.lastIndex,s=o[1],l="]"===o[2],c=o[3];if(l&&(s|=0),void 0===c||"["===c&&a+2===n){wo(r,void 0===c?new bo(s,e,t):new xo(s,e,t));break}var u=r.map[s];void 0===u&&wo(r,u=new Eo(s)),r=u}}function Mo(e,t,r){Nn.call(this),this.renderer=r;for(var i=e.getProgramParameter(t,35718),n=0;n<i;++n){var o=e.getActiveUniform(t,n);To(o,e.getUniformLocation(t,o.name),this)}}function So(e,t,r){var i=e.createShader(t);return e.shaderSource(i,r),e.compileShader(i),!1===e.getShaderParameter(i,35713)&&console.error("THREE.WebGLShader: Shader couldn't compile."),""!==e.getShaderInfoLog(i)&&console.warn("THREE.WebGLShader: gl.getShaderInfoLog()",35633===t?"vertex":"fragment",e.getShaderInfoLog(i),function(e){for(var t=e.split("\n"),r=0;r<t.length;r++)t[r]=r+1+": "+t[r];return t.join("\n")}(r)),i}Mo.prototype.setValue=function(e,t,r){var i=this.map[t];void 0!==i&&i.setValue(e,r,this.renderer)},Mo.prototype.setOptional=function(e,t,r){var i=t[r];void 0!==i&&this.setValue(e,r,i)},Mo.upload=function(e,t,r,i){for(var n=0,o=t.length;n!==o;++n){var a=t[n],s=r[a.id];!1!==s.needsUpdate&&a.setValue(e,s.value,i)}},Mo.seqWithValue=function(e,t){for(var r=[],i=0,n=e.length;i!==n;++i){var o=e[i];o.id in t&&r.push(o)}return r};var Ro=0;function Po(e){switch(e){case Lt:return["Linear","( value )"];case Ot:return["sRGB","( value )"];case Ft:return["RGBE","( value )"];case kt:return["RGBM","( value, 7.0 )"];case It:return["RGBM","( value, 16.0 )"];case jt:return["RGBD","( value, 256.0 )"];case Ht:return["Gamma","( value, float( GAMMA_FACTOR ) )"];default:throw new Error("unsupported encoding: "+e)}}function Ao(e,t){var r=Po(t);return"vec4 "+e+"( vec4 value ) { return "+r[0]+"ToLinear"+r[1]+"; }"}function Co(e){return""!==e}function Lo(e,t){return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights)}function Oo(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}function Ho(e){return e.replace(/^[ \t]*#include +<([\w\d./]+)>/gm,function(e,t){var r=_r[t];if(void 0===r)throw new Error("Can not resolve #include <"+t+">");return Ho(r)})}function Fo(e){return e.replace(/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,function(e,t,r,i){for(var n="",o=parseInt(t);o<parseInt(r);o++)n+=i.replace(/\[ i \]/g,"[ "+o+" ]");return n})}function ko(e,t,r,i,n,o,a){var s=e.context,l=i.defines,c=n.vertexShader,u=n.fragmentShader,h="SHADOWMAP_TYPE_BASIC";o.shadowMapType===D?h="SHADOWMAP_TYPE_PCF":o.shadowMapType===U&&(h="SHADOWMAP_TYPE_PCF_SOFT");var p="ENVMAP_TYPE_CUBE",d="ENVMAP_MODE_REFLECTION",f="ENVMAP_BLENDING_MULTIPLY";if(o.envMap){switch(i.envMap.mapping){case ve:case ye:p="ENVMAP_TYPE_CUBE";break;case _e:case Me:p="ENVMAP_TYPE_CUBE_UV";break;case be:case xe:p="ENVMAP_TYPE_EQUIREC";break;case Ee:p="ENVMAP_TYPE_SPHERE"}switch(i.envMap.mapping){case ye:case xe:d="ENVMAP_MODE_REFRACTION"}switch(i.combine){case q:f="ENVMAP_BLENDING_MULTIPLY";break;case G:f="ENVMAP_BLENDING_MIX";break;case he:f="ENVMAP_BLENDING_ADD"}}var m,g,v,y,b,x,E,_,w=0<e.gammaFactor?e.gammaFactor:1,T=a.isWebGL2?"":(m=i.extensions,g=o,v=t,[(m=m||{}).derivatives||g.envMapCubeUV||g.bumpMap||g.normalMap&&!g.objectSpaceNormalMap||g.flatShading?"#extension GL_OES_standard_derivatives : enable":"",(m.fragDepth||g.logarithmicDepthBuffer)&&v.get("EXT_frag_depth")?"#extension GL_EXT_frag_depth : enable":"",m.drawBuffers&&v.get("WEBGL_draw_buffers")?"#extension GL_EXT_draw_buffers : require":"",(m.shaderTextureLOD||g.envMap)&&v.get("EXT_shader_texture_lod")?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Co).join("\n")),M=function(e){var t=[];for(var r in e){var i=e[r];!1!==i&&t.push("#define "+r+" "+i)}return t.join("\n")}(l),S=s.createProgram();if(i.isRawShaderMaterial?(0<(y=[M].filter(Co).join("\n")).length&&(y+="\n"),0<(b=[T,M].filter(Co).join("\n")).length&&(b+="\n")):(y=["precision "+o.precision+" float;","precision "+o.precision+" int;","#define SHADER_NAME "+n.name,M,o.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+w,"#define MAX_BONES "+o.maxBones,o.useFog&&o.fog?"#define USE_FOG":"",o.useFog&&o.fogExp?"#define FOG_EXP2":"",o.map?"#define USE_MAP":"",o.envMap?"#define USE_ENVMAP":"",o.envMap?"#define "+d:"",o.lightMap?"#define USE_LIGHTMAP":"",o.aoMap?"#define USE_AOMAP":"",o.emissiveMap?"#define USE_EMISSIVEMAP":"",o.bumpMap?"#define USE_BUMPMAP":"",o.normalMap?"#define USE_NORMALMAP":"",o.normalMap&&o.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",o.displacementMap&&o.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",o.specularMap?"#define USE_SPECULARMAP":"",o.roughnessMap?"#define USE_ROUGHNESSMAP":"",o.metalnessMap?"#define USE_METALNESSMAP":"",o.alphaMap?"#define USE_ALPHAMAP":"",o.vertexColors?"#define USE_COLOR":"",o.flatShading?"#define FLAT_SHADED":"",o.skinning?"#define USE_SKINNING":"",o.useVertexTexture?"#define BONE_TEXTURE":"",o.morphTargets?"#define USE_MORPHTARGETS":"",o.morphNormals&&!1===o.flatShading?"#define USE_MORPHNORMALS":"",o.doubleSided?"#define DOUBLE_SIDED":"",o.flipSided?"#define FLIP_SIDED":"",o.shadowMapEnabled?"#define USE_SHADOWMAP":"",o.shadowMapEnabled?"#define "+h:"",o.sizeAttenuation?"#define USE_SIZEATTENUATION":"",o.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",o.logarithmicDepthBuffer&&(a.isWebGL2||t.get("EXT_frag_depth"))?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(Co).join("\n"),b=[T,"precision "+o.precision+" float;","precision "+o.precision+" int;","#define SHADER_NAME "+n.name,M,o.alphaTest?"#define ALPHATEST "+o.alphaTest+(o.alphaTest%1?"":".0"):"","#define GAMMA_FACTOR "+w,o.useFog&&o.fog?"#define USE_FOG":"",o.useFog&&o.fogExp?"#define FOG_EXP2":"",o.map?"#define USE_MAP":"",o.matcap?"#define USE_MATCAP":"",o.envMap?"#define USE_ENVMAP":"",o.envMap?"#define "+p:"",o.envMap?"#define "+d:"",o.envMap?"#define "+f:"",o.lightMap?"#define USE_LIGHTMAP":"",o.aoMap?"#define USE_AOMAP":"",o.emissiveMap?"#define USE_EMISSIVEMAP":"",o.bumpMap?"#define USE_BUMPMAP":"",o.normalMap?"#define USE_NORMALMAP":"",o.normalMap&&o.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",o.specularMap?"#define USE_SPECULARMAP":"",o.roughnessMap?"#define USE_ROUGHNESSMAP":"",o.metalnessMap?"#define USE_METALNESSMAP":"",o.alphaMap?"#define USE_ALPHAMAP":"",o.vertexColors?"#define USE_COLOR":"",o.gradientMap?"#define USE_GRADIENTMAP":"",o.flatShading?"#define FLAT_SHADED":"",o.doubleSided?"#define DOUBLE_SIDED":"",o.flipSided?"#define FLIP_SIDED":"",o.shadowMapEnabled?"#define USE_SHADOWMAP":"",o.shadowMapEnabled?"#define "+h:"",o.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",o.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",o.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",o.logarithmicDepthBuffer&&(a.isWebGL2||t.get("EXT_frag_depth"))?"#define USE_LOGDEPTHBUF_EXT":"",o.envMap&&(a.isWebGL2||t.get("EXT_shader_texture_lod"))?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;",o.toneMapping!==pe?"#define TONE_MAPPING":"",o.toneMapping!==pe?_r.tonemapping_pars_fragment:"",o.toneMapping!==pe?function(e,t){var r;switch(t){case Te:r="Linear";break;case de:r="Reinhard";break;case fe:r="Uncharted2";break;case me:r="OptimizedCineon";break;case ge:r="ACESFilmic";break;default:throw new Error("unsupported toneMapping: "+t)}return"vec3 "+e+"( vec3 color ) { return "+r+"ToneMapping( color ); }"}("toneMapping",o.toneMapping):"",o.dithering?"#define DITHERING":"",o.outputEncoding||o.mapEncoding||o.matcapEncoding||o.envMapEncoding||o.emissiveMapEncoding?_r.encodings_pars_fragment:"",o.mapEncoding?Ao("mapTexelToLinear",o.mapEncoding):"",o.matcapEncoding?Ao("matcapTexelToLinear",o.matcapEncoding):"",o.envMapEncoding?Ao("envMapTexelToLinear",o.envMapEncoding):"",o.emissiveMapEncoding?Ao("emissiveMapTexelToLinear",o.emissiveMapEncoding):"",o.outputEncoding?(x="linearToOutputTexel",E=o.outputEncoding,_=Po(E),"vec4 "+x+"( vec4 value ) { return LinearTo"+_[0]+_[1]+"; }"):"",o.depthPacking?"#define DEPTH_PACKING "+i.depthPacking:"","\n"].filter(Co).join("\n")),c=Oo(c=Lo(c=Ho(c),o),o),u=Oo(u=Lo(u=Ho(u),o),o),c=Fo(c),u=Fo(u),a.isWebGL2&&!i.isRawShaderMaterial){var R=!1,P=/^\s*#version\s+300\s+es\s*\n/;i.isShaderMaterial&&null!==c.match(P)&&null!==u.match(P)&&(R=!0,c=c.replace(P,""),u=u.replace(P,"")),y=["#version 300 es\n","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+y,b=["#version 300 es\n","#define varying in",R?"":"out highp vec4 pc_fragColor;",R?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+b}var A=b+u,C=So(s,35633,y+c),L=So(s,35632,A);s.attachShader(S,C),s.attachShader(S,L),void 0!==i.index0AttributeName?s.bindAttribLocation(S,0,i.index0AttributeName):!0===o.morphTargets&&s.bindAttribLocation(S,0,"position"),s.linkProgram(S);var O,H,F=s.getProgramInfoLog(S).trim(),k=s.getShaderInfoLog(C).trim(),I=s.getShaderInfoLog(L).trim(),j=!0,N=!0;return!1===s.getProgramParameter(S,35714)?(j=!1,console.error("THREE.WebGLProgram: shader error: ",s.getError(),"35715",s.getProgramParameter(S,35715),"gl.getProgramInfoLog",F,k,I)):""!==F?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",F):""!==k&&""!==I||(N=!1),N&&(this.diagnostics={runnable:j,material:i,programLog:F,vertexShader:{log:k,prefix:y},fragmentShader:{log:I,prefix:b}}),s.deleteShader(C),s.deleteShader(L),this.getUniforms=function(){return void 0===O&&(O=new Mo(s,S,e)),O},this.getAttributes=function(){return void 0===H&&(H=function(e,t){for(var r={},i=e.getProgramParameter(t,35721),n=0;n<i;n++){var o=e.getActiveAttrib(t,n).name;r[o]=e.getAttribLocation(t,o)}return r}(s,S)),H},this.destroy=function(){s.deleteProgram(S),this.program=void 0},Object.defineProperties(this,{uniforms:{get:function(){return console.warn("THREE.WebGLProgram: .uniforms is now .getUniforms()."),this.getUniforms()}},attributes:{get:function(){return console.warn("THREE.WebGLProgram: .attributes is now .getAttributes()."),this.getAttributes()}}}),this.name=n.name,this.id=Ro++,this.code=r,this.usedTimes=1,this.program=S,this.vertexShader=C,this.fragmentShader=L,this}function Io(h,l,p){var c=[],d={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"phong",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},o=["precision","supportsVertexTextures","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","lightMap","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","fog","useFog","fogExp","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering"];function f(e,t){var r;return e?e.isTexture?r=e.encoding:e.isWebGLRenderTarget&&(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),r=e.texture.encoding):r=Lt,r===Lt&&t&&(r=Ht),r}this.getParameters=function(e,t,r,i,n,o,a){var s=d[e.type],l=a.isSkinnedMesh?function(e){var t=e.skeleton.bones;if(p.floatVertexTextures)return 1024;var r=p.maxVertexUniforms,i=Math.floor((r-20)/4),n=Math.min(i,t.length);return n<t.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+t.length+" bones. This GPU supports "+n+"."),0):n}(a):0,c=p.precision;null!==e.precision&&(c=p.getMaxPrecision(e.precision))!==e.precision&&console.warn("THREE.WebGLProgram.getParameters:",e.precision,"not supported, using",c,"instead.");var u=h.getRenderTarget();return{shaderID:s,precision:c,supportsVertexTextures:p.vertexTextures,outputEncoding:f(u?u.texture:null,h.gammaOutput),map:!!e.map,mapEncoding:f(e.map,h.gammaInput),matcap:!!e.matcap,matcapEncoding:f(e.matcap,h.gammaInput),envMap:!!e.envMap,envMapMode:e.envMap&&e.envMap.mapping,envMapEncoding:f(e.envMap,h.gammaInput),envMapCubeUV:!!e.envMap&&(e.envMap.mapping===_e||e.envMap.mapping===Me),lightMap:!!e.lightMap,aoMap:!!e.aoMap,emissiveMap:!!e.emissiveMap,emissiveMapEncoding:f(e.emissiveMap,h.gammaInput),bumpMap:!!e.bumpMap,normalMap:!!e.normalMap,objectSpaceNormalMap:e.normalMapType===Vt,displacementMap:!!e.displacementMap,roughnessMap:!!e.roughnessMap,metalnessMap:!!e.metalnessMap,specularMap:!!e.specularMap,alphaMap:!!e.alphaMap,gradientMap:!!e.gradientMap,combine:e.combine,vertexColors:e.vertexColors,fog:!!i,useFog:e.fog,fogExp:i&&i.isFogExp2,flatShading:e.flatShading,sizeAttenuation:e.sizeAttenuation,logarithmicDepthBuffer:p.logarithmicDepthBuffer,skinning:e.skinning&&0<l,maxBones:l,useVertexTexture:p.floatVertexTextures,morphTargets:e.morphTargets,morphNormals:e.morphNormals,maxMorphTargets:h.maxMorphTargets,maxMorphNormals:h.maxMorphNormals,numDirLights:t.directional.length,numPointLights:t.point.length,numSpotLights:t.spot.length,numRectAreaLights:t.rectArea.length,numHemiLights:t.hemi.length,numClippingPlanes:n,numClipIntersection:o,dithering:e.dithering,shadowMapEnabled:h.shadowMap.enabled&&a.receiveShadow&&0<r.length,shadowMapType:h.shadowMap.type,toneMapping:h.toneMapping,physicallyCorrectLights:h.physicallyCorrectLights,premultipliedAlpha:e.premultipliedAlpha,alphaTest:e.alphaTest,doubleSided:e.side===ee,flipSided:e.side===we,depthPacking:void 0!==e.depthPacking&&e.depthPacking}},this.getProgramCode=function(e,t){var r=[];if(t.shaderID?r.push(t.shaderID):(r.push(e.fragmentShader),r.push(e.vertexShader)),void 0!==e.defines)for(var i in e.defines)r.push(i),r.push(e.defines[i]);for(var n=0;n<o.length;n++)r.push(t[o[n]]);return r.push(e.onBeforeCompile.toString()),r.push(h.gammaOutput),r.push(h.gammaFactor),r.join()},this.acquireProgram=function(e,t,r,i){for(var n,o=0,a=c.length;o<a;o++){var s=c[o];if(s.code===i){++(n=s).usedTimes;break}}return void 0===n&&(n=new ko(h,l,i,e,t,r,p),c.push(n)),n},this.releaseProgram=function(e){if(0==--e.usedTimes){var t=c.indexOf(e);c[t]=c[c.length-1],c.pop(),e.destroy()}},this.programs=c}function jo(){var i=new WeakMap;return{get:function(e){var t=i.get(e);return void 0===t&&(t={},i.set(e,t)),t},remove:function(e){i.delete(e)},update:function(e,t,r){i.get(e)[t]=r},dispose:function(){i=new WeakMap}}}function No(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.program&&t.program&&e.program!==t.program?e.program.id-t.program.id:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function Do(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.material.id!==t.material.id?e.material.id-t.material.id:e.id-t.id}function Uo(){var s=[],l=0,c=[],u=[];function h(e,t,r,i,n,o){var a=s[l];return void 0===a?(a={id:e.id,object:e,geometry:t,material:r,program:r.program,groupOrder:i,renderOrder:e.renderOrder,z:n,group:o},s[l]=a):(a.id=e.id,a.object=e,a.geometry=t,a.material=r,a.program=r.program,a.groupOrder=i,a.renderOrder=e.renderOrder,a.z=n,a.group=o),l++,a}return{opaque:c,transparent:u,init:function(){l=0,c.length=0,u.length=0},push:function(e,t,r,i,n,o){var a=h(e,t,r,i,n,o);(!0===r.transparent?u:c).push(a)},unshift:function(e,t,r,i,n,o){var a=h(e,t,r,i,n,o);(!0===r.transparent?u:c).unshift(a)},sort:function(){1<c.length&&c.sort(No),1<u.length&&u.sort(Do)}}}function Vo(){var n={};function o(e){var t=e.target;t.removeEventListener("dispose",o),delete n[t.id]}return{get:function(e,t){var r,i=n[e.id];return void 0===i?(r=new Uo,n[e.id]={},n[e.id][t.id]=r,e.addEventListener("dispose",o)):void 0===(r=i[t.id])&&(r=new Uo,i[t.id]=r),r},dispose:function(){n={}}}}function Bo(){var r={};return{get:function(e){if(void 0!==r[e.id])return r[e.id];var t;switch(e.type){case"DirectionalLight":t={direction:new Wt,color:new Cr,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new zt};break;case"SpotLight":t={position:new Wt,direction:new Wt,color:new Cr,distance:0,coneCos:0,penumbraCos:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new zt};break;case"PointLight":t={position:new Wt,color:new Cr,distance:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new zt,shadowCameraNear:1,shadowCameraFar:1e3};break;case"HemisphereLight":t={direction:new Wt,skyColor:new Cr,groundColor:new Cr};break;case"RectAreaLight":t={color:new Cr,position:new Wt,halfWidth:new Wt,halfHeight:new Wt}}return r[e.id]=t}}}var zo=0;function qo(){var E=new Bo,_={id:zo++,hash:{stateID:-1,directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,shadowsLength:-1},ambient:[0,0,0],directional:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],point:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]},w=new Wt,T=new qt,M=new qt;return{setup:function(e,t,r){for(var i=0,n=0,o=0,a=0,s=0,l=0,c=0,u=0,h=r.matrixWorldInverse,p=0,d=e.length;p<d;p++){var f=e[p],m=f.color,g=f.intensity,v=f.distance,y=f.shadow&&f.shadow.map?f.shadow.map.texture:null;if(f.isAmbientLight)i+=m.r*g,n+=m.g*g,o+=m.b*g;else if(f.isDirectionalLight){if((x=E.get(f)).color.copy(f.color).multiplyScalar(f.intensity),x.direction.setFromMatrixPosition(f.matrixWorld),w.setFromMatrixPosition(f.target.matrixWorld),x.direction.sub(w),x.direction.transformDirection(h),x.shadow=f.castShadow,f.castShadow){var b=f.shadow;x.shadowBias=b.bias,x.shadowRadius=b.radius,x.shadowMapSize=b.mapSize}_.directionalShadowMap[a]=y,_.directionalShadowMatrix[a]=f.shadow.matrix,_.directional[a]=x,a++}else if(f.isSpotLight)(x=E.get(f)).position.setFromMatrixPosition(f.matrixWorld),x.position.applyMatrix4(h),x.color.copy(m).multiplyScalar(g),x.distance=v,x.direction.setFromMatrixPosition(f.matrixWorld),w.setFromMatrixPosition(f.target.matrixWorld),x.direction.sub(w),x.direction.transformDirection(h),x.coneCos=Math.cos(f.angle),x.penumbraCos=Math.cos(f.angle*(1-f.penumbra)),x.decay=f.decay,x.shadow=f.castShadow,f.castShadow&&(b=f.shadow,x.shadowBias=b.bias,x.shadowRadius=b.radius,x.shadowMapSize=b.mapSize),_.spotShadowMap[l]=y,_.spotShadowMatrix[l]=f.shadow.matrix,_.spot[l]=x,l++;else if(f.isRectAreaLight)(x=E.get(f)).color.copy(m).multiplyScalar(g),x.position.setFromMatrixPosition(f.matrixWorld),x.position.applyMatrix4(h),M.identity(),T.copy(f.matrixWorld),T.premultiply(h),M.extractRotation(T),x.halfWidth.set(.5*f.width,0,0),x.halfHeight.set(0,.5*f.height,0),x.halfWidth.applyMatrix4(M),x.halfHeight.applyMatrix4(M),_.rectArea[c]=x,c++;else if(f.isPointLight)(x=E.get(f)).position.setFromMatrixPosition(f.matrixWorld),x.position.applyMatrix4(h),x.color.copy(f.color).multiplyScalar(f.intensity),x.distance=f.distance,x.decay=f.decay,x.shadow=f.castShadow,f.castShadow&&(b=f.shadow,x.shadowBias=b.bias,x.shadowRadius=b.radius,x.shadowMapSize=b.mapSize,x.shadowCameraNear=b.camera.near,x.shadowCameraFar=b.camera.far),_.pointShadowMap[s]=y,_.pointShadowMatrix[s]=f.shadow.matrix,_.point[s]=x,s++;else if(f.isHemisphereLight){var x;(x=E.get(f)).direction.setFromMatrixPosition(f.matrixWorld),x.direction.transformDirection(h),x.direction.normalize(),x.skyColor.copy(f.color).multiplyScalar(g),x.groundColor.copy(f.groundColor).multiplyScalar(g),_.hemi[u]=x,u++}}_.ambient[0]=i,_.ambient[1]=n,_.ambient[2]=o,_.directional.length=a,_.spot.length=l,_.rectArea.length=c,_.point.length=s,_.hemi.length=u,_.hash.stateID=_.id,_.hash.directionalLength=a,_.hash.pointLength=s,_.hash.spotLength=l,_.hash.rectAreaLength=c,_.hash.hemiLength=u,_.hash.shadowsLength=t.length},state:_}}function Go(){var t=new qo,r=[],i=[];return{init:function(){r.length=0,i.length=0},state:{lightsArray:r,shadowsArray:i,lights:t},setupLights:function(e){t.setup(r,i,e)},pushLight:function(e){r.push(e)},pushShadow:function(e){i.push(e)}}}function Wo(){var i={};function n(e){var t=e.target;t.removeEventListener("dispose",n),delete i[t.id]}return{get:function(e,t){var r;return void 0===i[e.id]?(r=new Go,i[e.id]={},i[e.id][t.id]=r,e.addEventListener("dispose",n)):void 0===i[e.id][t.id]?(r=new Go,i[e.id][t.id]=r):r=i[e.id][t.id],r},dispose:function(){i={}}}}function Xo(e){gn.call(this),this.type="MeshDepthMaterial",this.depthPacking=Nt,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.setValues(e)}function Yo(e){gn.call(this),this.type="MeshDistanceMaterial",this.referencePosition=new Wt,this.nearDistance=1,this.farDistance=1e3,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.lights=!1,this.setValues(e)}function Qo(y,m,e){for(var b=new Er,x=new qt,E=new zt,_=new zt(e,e),w=new Wt,T=new Wt,v=1,M=2,t=1+(v|M),S=new Array(t),R=new Array(t),P={},A={0:we,1:k,2:ee},C=[new Wt(1,0,0),new Wt(-1,0,0),new Wt(0,0,1),new Wt(0,0,-1),new Wt(0,1,0),new Wt(0,-1,0)],L=[new Wt(0,1,0),new Wt(0,1,0),new Wt(0,1,0),new Wt(0,1,0),new Wt(0,0,1),new Wt(0,0,-1)],O=[new dr,new dr,new dr,new dr,new dr,new dr],r=0;r!==t;++r){var i=0!=(r&v),n=0!=(r&M),o=new Xo({depthPacking:Dt,morphTargets:i,skinning:n});S[r]=o;var a=new Yo({morphTargets:i,skinning:n});R[r]=a}var H=this;function g(e,t,r,i,n,o){var a=e.geometry,s=null,l=S,c=e.customDepthMaterial;if(r&&(l=R,c=e.customDistanceMaterial),c)s=c;else{var u=!1;t.morphTargets&&(a&&a.isBufferGeometry?u=a.morphAttributes&&a.morphAttributes.position&&0<a.morphAttributes.position.length:a&&a.isGeometry&&(u=a.morphTargets&&0<a.morphTargets.length)),e.isSkinnedMesh&&!1===t.skinning&&console.warn("THREE.WebGLShadowMap: THREE.SkinnedMesh with material.skinning set to false:",e);var h=e.isSkinnedMesh&&t.skinning,p=0;u&&(p|=v),h&&(p|=M),s=l[p]}if(y.localClippingEnabled&&!0===t.clipShadows&&0!==t.clippingPlanes.length){var d=s.uuid,f=t.uuid,m=P[d];void 0===m&&(m={},P[d]=m);var g=m[f];void 0===g&&(g=s.clone(),m[f]=g),s=g}return s.visible=t.visible,s.wireframe=t.wireframe,s.side=null!=t.shadowSide?t.shadowSide:A[t.side],s.clipShadows=t.clipShadows,s.clippingPlanes=t.clippingPlanes,s.clipIntersection=t.clipIntersection,s.wireframeLinewidth=t.wireframeLinewidth,s.linewidth=t.linewidth,r&&s.isMeshDistanceMaterial&&(s.referencePosition.copy(i),s.nearDistance=n,s.farDistance=o),s}function F(e,t,r,i){if(!1!==e.visible){if(e.layers.test(t.layers)&&(e.isMesh||e.isLine||e.isPoints)&&e.castShadow&&(!e.frustumCulled||b.intersectsObject(e))){e.modelViewMatrix.multiplyMatrices(r.matrixWorldInverse,e.matrixWorld);var n=m.update(e),o=e.material;if(Array.isArray(o))for(var a=n.groups,s=0,l=a.length;s<l;s++){var c=a[s],u=o[c.materialIndex];if(u&&u.visible){var h=g(e,u,i,T,r.near,r.far);y.renderBufferDirect(r,null,n,h,e,c)}}else if(o.visible){h=g(e,o,i,T,r.near,r.far);y.renderBufferDirect(r,null,n,h,e,null)}}for(var p=e.children,d=0,f=p.length;d<f;d++)F(p[d],t,r,i)}}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=D,this.render=function(e,t,r){if(!1!==H.enabled&&(!1!==H.autoUpdate||!1!==H.needsUpdate)&&0!==e.length){var i,n=y.state;n.setBlending(Q),n.buffers.color.setClear(1,1,1,1),n.buffers.depth.setTest(!0),n.setScissorTest(!1);for(var o=0,a=e.length;o<a;o++){var s=e[o],l=s.shadow,c=s&&s.isPointLight;if(void 0!==l){var u=l.camera;if(E.copy(l.mapSize),E.min(_),c){var h=E.x,p=E.y;O[0].set(2*h,p,h,p),O[1].set(0,p,h,p),O[2].set(3*h,p,h,p),O[3].set(h,p,h,p),O[4].set(3*h,0,h,p),O[5].set(h,0,h,p),E.x*=4,E.y*=2}if(null===l.map){var d={minFilter:Ae,magFilter:Ae,format:Qe};l.map=new fr(E.x,E.y,d),l.map.texture.name=s.name+".shadowMap",u.updateProjectionMatrix()}l.isSpotLightShadow&&l.update(s);var f=l.map,m=l.matrix;T.setFromMatrixPosition(s.matrixWorld),u.position.copy(T),c?(i=6,m.makeTranslation(-T.x,-T.y,-T.z)):(i=1,w.setFromMatrixPosition(s.target.matrixWorld),u.lookAt(w),u.updateMatrixWorld(),m.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),m.multiply(u.projectionMatrix),m.multiply(u.matrixWorldInverse)),y.setRenderTarget(f),y.clear();for(var g=0;g<i;g++){if(c){w.copy(u.position),w.add(C[g]),u.up.copy(L[g]),u.lookAt(w),u.updateMatrixWorld();var v=O[g];n.viewport(v)}x.multiplyMatrices(u.projectionMatrix,u.matrixWorldInverse),b.setFromMatrix(x),F(t,r,u,c)}}else console.warn("THREE.WebGLShadowMap:",s,"has no shadow.")}H.needsUpdate=!1}}}function Jo(u,r,l,i){var n=new function(){var t=!1,o=new dr,r=null,a=new dr(0,0,0,0);return{setMask:function(e){r===e||t||(u.colorMask(e,e,e,e),r=e)},setLocked:function(e){t=e},setClear:function(e,t,r,i,n){!0===n&&(e*=i,t*=i,r*=i),o.set(e,t,r,i),!1===a.equals(o)&&(u.clearColor(e,t,r,i),a.copy(o))},reset:function(){t=!1,r=null,a.set(-1,0,0,0)}}},o=new function(){var t=!1,r=null,i=null,n=null;return{setTest:function(e){e?D(2929):U(2929)},setMask:function(e){r===e||t||(u.depthMask(e),r=e)},setFunc:function(e){if(i!==e){if(e)switch(e){case ie:u.depthFunc(512);break;case ne:u.depthFunc(519);break;case oe:u.depthFunc(513);break;case ae:u.depthFunc(515);break;case se:u.depthFunc(514);break;case le:u.depthFunc(518);break;case ce:u.depthFunc(516);break;case ue:u.depthFunc(517);break;default:u.depthFunc(515)}else u.depthFunc(515);i=e}},setLocked:function(e){t=e},setClear:function(e){n!==e&&(u.clearDepth(e),n=e)},reset:function(){t=!1,n=i=r=null}}},t=new function(){var t=!1,r=null,i=null,n=null,o=null,a=null,s=null,l=null,c=null;return{setTest:function(e){e?D(2960):U(2960)},setMask:function(e){r===e||t||(u.stencilMask(e),r=e)},setFunc:function(e,t,r){i===e&&n===t&&o===r||(u.stencilFunc(e,t,r),i=e,n=t,o=r)},setOp:function(e,t,r){a===e&&s===t&&l===r||(u.stencilOp(e,t,r),a=e,s=t,l=r)},setLocked:function(e){t=e},setClear:function(e){c!==e&&(u.clearStencil(e),c=e)},reset:function(){t=!1,c=l=s=a=o=n=i=r=null}}},e=u.getParameter(34921),a=new Uint8Array(e),s=new Uint8Array(e),c=new Uint8Array(e),h={},p=null,d=null,f=null,m=null,g=null,v=null,y=null,b=null,x=null,E=null,_=!1,w=null,T=null,M=null,S=null,R=null,P=u.getParameter(35661),A=!1,C=0,L=u.getParameter(7938);-1!==L.indexOf("WebGL")?(C=parseFloat(/^WebGL\ ([0-9])/.exec(L)[1]),A=1<=C):-1!==L.indexOf("OpenGL ES")&&(C=parseFloat(/^OpenGL\ ES\ ([0-9])/.exec(L)[1]),A=2<=C);var O=null,H={},F=new dr,k=new dr;function I(e,t,r){var i=new Uint8Array(4),n=u.createTexture();u.bindTexture(e,n),u.texParameteri(e,10241,9728),u.texParameteri(e,10240,9728);for(var o=0;o<r;o++)u.texImage2D(t+o,0,6408,1,1,0,6408,5121,i);return n}var j={};function N(e,t){(a[e]=1,0===s[e]&&(u.enableVertexAttribArray(e),s[e]=1),c[e]!==t)&&((i.isWebGL2?u:r.get("ANGLE_instanced_arrays"))[i.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](e,t),c[e]=t)}function D(e){!0!==h[e]&&(u.enable(e),h[e]=!0)}function U(e){!1!==h[e]&&(u.disable(e),h[e]=!1)}function V(e,t,r,i,n,o,a,s){if(e!==Q){if(f||(D(3042),f=!0),e===te)n=n||t,o=o||r,a=a||i,t===g&&n===b||(u.blendEquationSeparate(l.convert(t),l.convert(n)),g=t,b=n),r===v&&i===y&&o===x&&a===E||(u.blendFuncSeparate(l.convert(r),l.convert(i),l.convert(o),l.convert(a)),v=r,y=i,x=o,E=a),m=e,_=null;else if(e!==m||s!==_){if(g===re&&b===re||(u.blendEquation(32774),b=g=re),s)switch(e){case J:u.blendFuncSeparate(1,771,1,771);break;case Z:u.blendFunc(1,1);break;case K:u.blendFuncSeparate(0,0,769,771);break;case $:u.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}else switch(e){case J:u.blendFuncSeparate(770,771,1,771);break;case Z:u.blendFunc(770,1);break;case K:u.blendFunc(0,769);break;case $:u.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}E=x=y=v=null,m=e,_=s}}else f&&(U(3042),f=!1)}function B(e){w!==e&&(e?u.frontFace(2304):u.frontFace(2305),w=e)}function z(e){e!==W?(D(2884),e!==T&&(e===X?u.cullFace(1029):e===Y?u.cullFace(1028):u.cullFace(1032))):U(2884),T=e}function q(e,t,r){e?(D(32823),S===t&&R===r||(u.polygonOffset(t,r),S=t,R=r)):U(32823)}function G(e){void 0===e&&(e=33984+P-1),O!==e&&(u.activeTexture(e),O=e)}return j[3553]=I(3553,3553,1),j[34067]=I(34067,34069,6),n.setClear(0,0,0,1),o.setClear(1),t.setClear(0),D(2929),o.setFunc(ae),B(!1),z(X),D(2884),V(Q),{buffers:{color:n,depth:o,stencil:t},initAttributes:function(){for(var e=0,t=a.length;e<t;e++)a[e]=0},enableAttribute:function(e){N(e,0)},enableAttributeAndDivisor:N,disableUnusedAttributes:function(){for(var e=0,t=s.length;e!==t;++e)s[e]!==a[e]&&(u.disableVertexAttribArray(e),s[e]=0)},enable:D,disable:U,getCompressedTextureFormats:function(){if(null===p&&(p=[],r.get("WEBGL_compressed_texture_pvrtc")||r.get("WEBGL_compressed_texture_s3tc")||r.get("WEBGL_compressed_texture_etc1")||r.get("WEBGL_compressed_texture_astc")))for(var e=u.getParameter(34467),t=0;t<e.length;t++)p.push(e[t]);return p},useProgram:function(e){return d!==e&&(u.useProgram(e),d=e,!0)},setBlending:V,setMaterial:function(e,t){e.side===ee?U(2884):D(2884);var r=e.side===we;t&&(r=!r),B(r),e.blending===J&&!1===e.transparent?V(Q):V(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha),o.setFunc(e.depthFunc),o.setTest(e.depthTest),o.setMask(e.depthWrite),n.setMask(e.colorWrite),q(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits)},setFlipSided:B,setCullFace:z,setLineWidth:function(e){e!==M&&(A&&u.lineWidth(e),M=e)},setPolygonOffset:q,setScissorTest:function(e){e?D(3089):U(3089)},activeTexture:G,bindTexture:function(e,t){null===O&&G();var r=H[O];void 0===r&&(r={type:void 0,texture:void 0},H[O]=r),r.type===e&&r.texture===t||(u.bindTexture(e,t||j[e]),r.type=e,r.texture=t)},compressedTexImage2D:function(){try{u.compressedTexImage2D.apply(u,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage2D:function(){try{u.texImage2D.apply(u,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage3D:function(){try{u.texImage3D.apply(u,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},scissor:function(e){!1===F.equals(e)&&(u.scissor(e.x,e.y,e.z,e.w),F.copy(e))},viewport:function(e){!1===k.equals(e)&&(u.viewport(e.x,e.y,e.z,e.w),k.copy(e))},reset:function(){for(var e=0;e<s.length;e++)1===s[e]&&(u.disableVertexAttribArray(e),s[e]=0);h={},H={},T=w=m=d=O=p=null,n.reset(),o.reset(),t.reset()}}}function Zo(g,n,v,y,b,x,E){var s,l={};function _(e,t,r,i){var n=1;if((e.width>i||e.height>i)&&(n=i/Math.max(e.width,e.height)),n<1||!0===t){if(e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof ImageBitmap){void 0===s&&(s=document.createElementNS("http://www.w3.org/1999/xhtml","canvas"));var o=r?document.createElementNS("http://www.w3.org/1999/xhtml","canvas"):s,a=t?Bt.floorPowerOfTwo:Math.floor;return o.width=a(n*e.width),o.height=a(n*e.height),o.getContext("2d").drawImage(e,0,0,o.width,o.height),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+e.width+"x"+e.height+") to ("+o.width+"x"+o.height+")."),o}return"data"in e&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+e.width+"x"+e.height+")."),e}return e}function w(e){return Bt.isPowerOfTwo(e.width)&&Bt.isPowerOfTwo(e.height)}function T(e,t){return e.generateMipmaps&&t&&e.minFilter!==Ae&&e.minFilter!==Oe}function M(e,t,r,i){g.generateMipmap(e),y.get(t).__maxMipLevel=Math.log(Math.max(r,i))*Math.LOG2E}function S(e,t){if(!b.isWebGL2)return e;var r=e;return 6403===e&&(5126===t&&(r=33326),5131===t&&(r=33325),5121===t&&(r=33321)),6407===e&&(5126===t&&(r=34837),5131===t&&(r=34843),5121===t&&(r=32849)),6408===e&&(5126===t&&(r=34836),5131===t&&(r=34842),5121===t&&(r=32856)),6402===e&&(5123===t&&(r=33189),5125===t&&(r=g.DEPTH_COMPONENT24),5126===t&&(r=36012)),34041===e&&(34042===t&&(r=g.DEPTH24_STENCIL8),t===g.FLOAT_32_UNSIGNED_INT_24_8_REV&&(r=g.DEPTH32F_STENCIL8)),33325===r||33326===r||34842===r||34836===r?n.get("EXT_color_buffer_float"):34843!==r&&34837!==r||console.warn("THREE.WebGLRenderer: Floating point textures with RGB format not supported. Please use RGBA instead."),r}function o(e){return e===Ae||e===Ce||e===Le?9728:9729}function R(e){var t=e.target;t.removeEventListener("dispose",R),function(e){var t=y.get(e);if(e.image&&t.__image__webglTextureCube)g.deleteTexture(t.__image__webglTextureCube);else{if(void 0===t.__webglInit)return;g.deleteTexture(t.__webglTexture)}y.remove(e)}(t),t.isVideoTexture&&delete l[t.id],E.memory.textures--}function c(e){var t=e.target;t.removeEventListener("dispose",c),function(e){var t=y.get(e),r=y.get(e.texture);if(!e)return;void 0!==r.__webglTexture&&g.deleteTexture(r.__webglTexture);e.depthTexture&&e.depthTexture.dispose();if(e.isWebGLRenderTargetCube)for(var i=0;i<6;i++)g.deleteFramebuffer(t.__webglFramebuffer[i]),t.__webglDepthbuffer&&g.deleteRenderbuffer(t.__webglDepthbuffer[i]);else g.deleteFramebuffer(t.__webglFramebuffer),t.__webglDepthbuffer&&g.deleteRenderbuffer(t.__webglDepthbuffer);e.isWebGLMultisampleRenderTarget&&(t.__webglMultisampledFramebuffer&&g.deleteFramebuffer(t.__webglSamplingbuffer),t.__webglColorRenderbuffer&&g.deleteRenderbuffer(t.__webglColorRenderbuffer));y.remove(e.texture),y.remove(e)}(t),E.memory.textures--}function a(e,t){var r,i,n,o=y.get(e);if(e.isVideoTexture&&(i=(r=e).id,n=E.render.frame,l[i]!==n&&(l[i]=n,r.update())),0<e.version&&o.__version!==e.version){var a=e.image;if(void 0===a)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else{if(!1!==a.complete)return void u(o,e,t);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}v.activeTexture(33984+t),v.bindTexture(3553,o.__webglTexture)}function P(e,t,r){var i;if(r?(g.texParameteri(e,10242,x.convert(t.wrapS)),g.texParameteri(e,10243,x.convert(t.wrapT)),g.texParameteri(e,10240,x.convert(t.magFilter)),g.texParameteri(e,10241,x.convert(t.minFilter))):(g.texParameteri(e,10242,33071),g.texParameteri(e,10243,33071),t.wrapS===Re&&t.wrapT===Re||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),g.texParameteri(e,10240,o(t.magFilter)),g.texParameteri(e,10241,o(t.minFilter)),t.minFilter!==Ae&&t.minFilter!==Oe&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),i=n.get("EXT_texture_filter_anisotropic")){if(t.type===Ve&&null===n.get("OES_texture_float_linear"))return;if(t.type===Be&&null===(b.isWebGL2||n.get("OES_texture_half_float_linear")))return;(1<t.anisotropy||y.get(t).__currentAnisotropy)&&(g.texParameterf(e,i.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(t.anisotropy,b.getMaxAnisotropy())),y.get(t).__currentAnisotropy=t.anisotropy)}}function u(e,t,r){var i;i=t.isDataTexture3D?32879:3553,void 0===e.__webglInit&&(e.__webglInit=!0,t.addEventListener("dispose",R),e.__webglTexture=g.createTexture(),E.memory.textures++),v.activeTexture(33984+r),v.bindTexture(i,e.__webglTexture),g.pixelStorei(37440,t.flipY),g.pixelStorei(37441,t.premultiplyAlpha),g.pixelStorei(3317,t.unpackAlignment);var n,o=(n=t,!b.isWebGL2&&(n.wrapS!==Re||n.wrapT!==Re||n.minFilter!==Ae&&n.minFilter!==Oe)&&!1===w(t.image)),a=_(t.image,o,!1,b.maxTextureSize),s=w(a)||b.isWebGL2,l=x.convert(t.format),c=x.convert(t.type),u=S(l,c);P(i,t,s);var h,p=t.mipmaps;if(t.isDepthTexture){if(!b.isWebGL2){if(u=6402,t.type===Ve){if(!b.isWebGL2)throw new Error("Float Depth Texture only supported in WebGL2.0");u=36012}else b.isWebGL2&&(u=33189);t.format===$e&&6402===u&&t.type!==Ne&&t.type!==Ue&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),t.type=Ne,c=x.convert(t.type)),t.format===et&&(u=34041,t.type!==We&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),t.type=We,c=x.convert(t.type)))}v.texImage2D(3553,0,u,a.width,a.height,0,l,c,null)}else if(t.isDataTexture)if(0<p.length&&s){for(var d=0,f=p.length;d<f;d++)h=p[d],v.texImage2D(3553,d,u,h.width,h.height,0,l,c,h.data);t.generateMipmaps=!1,e.__maxMipLevel=p.length-1}else v.texImage2D(3553,0,u,a.width,a.height,0,l,c,a.data),e.__maxMipLevel=0;else if(t.isCompressedTexture){for(d=0,f=p.length;d<f;d++)h=p[d],t.format!==Qe&&t.format!==Ye?-1<v.getCompressedTextureFormats().indexOf(l)?v.compressedTexImage2D(3553,d,u,h.width,h.height,0,h.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):v.texImage2D(3553,d,u,h.width,h.height,0,l,c,h.data);e.__maxMipLevel=p.length-1}else if(t.isDataTexture3D)v.texImage3D(32879,0,u,a.width,a.height,a.depth,0,l,c,a.data),e.__maxMipLevel=0;else if(0<p.length&&s){for(d=0,f=p.length;d<f;d++)h=p[d],v.texImage2D(3553,d,u,l,c,h);t.generateMipmaps=!1,e.__maxMipLevel=p.length-1}else v.texImage2D(3553,0,u,l,c,a),e.__maxMipLevel=0;T(t,s)&&M(3553,t,a.width,a.height),e.__version=t.version,t.onUpdate&&t.onUpdate(t)}function h(e,t,r,i){var n=x.convert(t.texture.format),o=x.convert(t.texture.type),a=S(n,o);v.texImage2D(i,0,a,t.width,t.height,0,n,o,null),g.bindFramebuffer(36160,e),g.framebufferTexture2D(36160,r,i,y.get(t.texture).__webglTexture,0),g.bindFramebuffer(36160,null)}function p(e,t,r){if(g.bindRenderbuffer(36161,e),t.depthBuffer&&!t.stencilBuffer){if(r){var i=f(t);g.renderbufferStorageMultisample(36161,i,33189,t.width,t.height)}else g.renderbufferStorage(36161,33189,t.width,t.height);g.framebufferRenderbuffer(36160,36096,36161,e)}else if(t.depthBuffer&&t.stencilBuffer){if(r){i=f(t);g.renderbufferStorageMultisample(36161,i,g.DEPTH24_STENCIL8,t.width,t.height)}else g.renderbufferStorage(36161,34041,t.width,t.height);g.framebufferRenderbuffer(36160,33306,36161,e)}else{var n=S(x.convert(t.texture.format),x.convert(t.texture.type));if(r){i=f(t);g.renderbufferStorageMultisample(36161,i,n,t.width,t.height)}else g.renderbufferStorage(36161,n,t.width,t.height)}g.bindRenderbuffer(36161,null)}function d(e){var t=y.get(e),r=!0===e.isWebGLRenderTargetCube;if(e.depthTexture){if(r)throw new Error("target.depthTexture not supported in Cube render targets");!function(e,t){if(t&&t.isWebGLRenderTargetCube)throw new Error("Depth Texture with cube render targets is not supported");if(g.bindFramebuffer(36160,e),!t.depthTexture||!t.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");y.get(t.depthTexture).__webglTexture&&t.depthTexture.image.width===t.width&&t.depthTexture.image.height===t.height||(t.depthTexture.image.width=t.width,t.depthTexture.image.height=t.height,t.depthTexture.needsUpdate=!0),a(t.depthTexture,0);var r=y.get(t.depthTexture).__webglTexture;if(t.depthTexture.format===$e)g.framebufferTexture2D(36160,36096,3553,r,0);else{if(t.depthTexture.format!==et)throw new Error("Unknown depthTexture format");g.framebufferTexture2D(36160,33306,3553,r,0)}}(t.__webglFramebuffer,e)}else if(r){t.__webglDepthbuffer=[];for(var i=0;i<6;i++)g.bindFramebuffer(36160,t.__webglFramebuffer[i]),t.__webglDepthbuffer[i]=g.createRenderbuffer(),p(t.__webglDepthbuffer[i],e)}else g.bindFramebuffer(36160,t.__webglFramebuffer),t.__webglDepthbuffer=g.createRenderbuffer(),p(t.__webglDepthbuffer,e);g.bindFramebuffer(36160,null)}function f(e){return b.isWebGL2&&e.isWebGLMultisampleRenderTarget?Math.min(b.maxSamples,e.samples):0}this.setTexture2D=a,this.setTexture3D=function(e,t){var r=y.get(e);0<e.version&&r.__version!==e.version?u(r,e,t):(v.activeTexture(33984+t),v.bindTexture(32879,r.__webglTexture))},this.setTextureCube=function(e,t){var r=y.get(e);if(6===e.image.length)if(0<e.version&&r.__version!==e.version){r.__image__webglTextureCube||(e.addEventListener("dispose",R),r.__image__webglTextureCube=g.createTexture(),E.memory.textures++),v.activeTexture(33984+t),v.bindTexture(34067,r.__image__webglTextureCube),g.pixelStorei(37440,e.flipY);for(var i=e&&e.isCompressedTexture,n=e.image[0]&&e.image[0].isDataTexture,o=[],a=0;a<6;a++)o[a]=i||n?n?e.image[a].image:e.image[a]:_(e.image[a],!1,!0,b.maxCubemapSize);var s=o[0],l=w(s)||b.isWebGL2,c=x.convert(e.format),u=x.convert(e.type),h=S(c,u);for(P(34067,e,l),a=0;a<6;a++)if(i)for(var p,d=o[a].mipmaps,f=0,m=d.length;f<m;f++)p=d[f],e.format!==Qe&&e.format!==Ye?-1<v.getCompressedTextureFormats().indexOf(c)?v.compressedTexImage2D(34069+a,f,h,p.width,p.height,0,p.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):v.texImage2D(34069+a,f,h,p.width,p.height,0,c,u,p.data);else n?v.texImage2D(34069+a,0,h,o[a].width,o[a].height,0,c,u,o[a].data):v.texImage2D(34069+a,0,h,c,u,o[a]);r.__maxMipLevel=i?d.length-1:0,T(e,l)&&M(34067,e,s.width,s.height),r.__version=e.version,e.onUpdate&&e.onUpdate(e)}else v.activeTexture(33984+t),v.bindTexture(34067,r.__image__webglTextureCube)},this.setTextureCubeDynamic=function(e,t){v.activeTexture(33984+t),v.bindTexture(34067,y.get(e).__webglTexture)},this.setupRenderTarget=function(e){var t=y.get(e),r=y.get(e.texture);e.addEventListener("dispose",c),r.__webglTexture=g.createTexture(),E.memory.textures++;var i=!0===e.isWebGLRenderTargetCube,n=!0===e.isWebGLMultisampleRenderTarget,o=w(e)||b.isWebGL2;if(i){t.__webglFramebuffer=[];for(var a=0;a<6;a++)t.__webglFramebuffer[a]=g.createFramebuffer()}else if(t.__webglFramebuffer=g.createFramebuffer(),n)if(b.isWebGL2){t.__webglMultisampledFramebuffer=g.createFramebuffer(),t.__webglColorRenderbuffer=g.createRenderbuffer(),g.bindRenderbuffer(36161,t.__webglColorRenderbuffer);var s=S(x.convert(e.texture.format),x.convert(e.texture.type)),l=f(e);g.renderbufferStorageMultisample(36161,l,s,e.width,e.height),g.bindFramebuffer(36160,t.__webglMultisampledFramebuffer),g.framebufferRenderbuffer(36160,36064,36161,t.__webglColorRenderbuffer),g.bindRenderbuffer(36161,null),e.depthBuffer&&(t.__webglDepthRenderbuffer=g.createRenderbuffer(),p(t.__webglDepthRenderbuffer,e,!0)),g.bindFramebuffer(36160,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");if(i){for(v.bindTexture(34067,r.__webglTexture),P(34067,e.texture,o),a=0;a<6;a++)h(t.__webglFramebuffer[a],e,36064,34069+a);T(e.texture,o)&&M(34067,e.texture,e.width,e.height),v.bindTexture(34067,null)}else v.bindTexture(3553,r.__webglTexture),P(3553,e.texture,o),h(t.__webglFramebuffer,e,36064,3553),T(e.texture,o)&&M(3553,e.texture,e.width,e.height),v.bindTexture(3553,null);e.depthBuffer&&d(e)},this.updateRenderTargetMipmap=function(e){var t=e.texture;if(T(t,w(e)||b.isWebGL2)){var r=e.isWebGLRenderTargetCube?34067:3553,i=y.get(t).__webglTexture;v.bindTexture(r,i),M(r,t,e.width,e.height),v.bindTexture(r,null)}},this.updateMultisampleRenderTarget=function(e){if(e.isWebGLMultisampleRenderTarget)if(b.isWebGL2){var t=y.get(e);g.bindFramebuffer(36008,t.__webglMultisampledFramebuffer),g.bindFramebuffer(36009,t.__webglFramebuffer);var r=e.width,i=e.height,n=16384;e.depthBuffer&&(n|=256),e.stencilBuffer&&(n|=1024),g.blitFramebuffer(0,0,r,i,0,0,r,i,n,9728)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")}}function Ko(e,r,i){return{convert:function(e){var t;if(e===Se)return 10497;if(e===Re)return 33071;if(e===Pe)return 33648;if(e===Ae)return 9728;if(e===Ce)return 9984;if(e===Le)return 9986;if(e===Oe)return 9729;if(e===He)return 9985;if(e===Fe)return 9987;if(e===ke)return 5121;if(e===ze)return 32819;if(e===qe)return 32820;if(e===Ge)return 33635;if(e===Ie)return 5120;if(e===je)return 5122;if(e===Ne)return 5123;if(e===De)return 5124;if(e===Ue)return 5125;if(e===Ve)return 5126;if(e===Be){if(i.isWebGL2)return 5131;if(null!==(t=r.get("OES_texture_half_float")))return t.HALF_FLOAT_OES}if(e===Xe)return 6406;if(e===Ye)return 6407;if(e===Qe)return 6408;if(e===Je)return 6409;if(e===Ze)return 6410;if(e===$e)return 6402;if(e===et)return 34041;if(e===tt)return 6403;if(e===re)return 32774;if(e===S)return 32778;if(e===R)return 32779;if(e===C)return 0;if(e===L)return 1;if(e===O)return 768;if(e===H)return 769;if(e===F)return 770;if(e===I)return 771;if(e===j)return 772;if(e===N)return 773;if(e===V)return 774;if(e===B)return 775;if(e===z)return 776;if((e===rt||e===it||e===nt||e===ot)&&null!==(t=r.get("WEBGL_compressed_texture_s3tc"))){if(e===rt)return t.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===it)return t.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===nt)return t.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===ot)return t.COMPRESSED_RGBA_S3TC_DXT5_EXT}if((e===at||e===st||e===lt||e===ct)&&null!==(t=r.get("WEBGL_compressed_texture_pvrtc"))){if(e===at)return t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(e===st)return t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(e===lt)return t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(e===ct)return t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(e===ut&&null!==(t=r.get("WEBGL_compressed_texture_etc1")))return t.COMPRESSED_RGB_ETC1_WEBGL;if((e===ht||e===pt||e===dt||e===ft||e===mt||e===gt||e===vt||e===yt||e===bt||e===xt||e===Et||e===_t||e===wt||e===Tt)&&null!==(t=r.get("WEBGL_compressed_texture_astc")))return e;if(e===P||e===A){if(i.isWebGL2){if(e===P)return 32775;if(e===A)return 32776}if(null!==(t=r.get("EXT_blend_minmax"))){if(e===P)return t.MIN_EXT;if(e===A)return t.MAX_EXT}}if(e===We){if(i.isWebGL2)return 34042;if(null!==(t=r.get("WEBGL_depth_texture")))return t.UNSIGNED_INT_24_8_WEBGL}return 0}}}function $o(){oi.call(this),this.type="Group"}function ea(){oi.call(this),this.type="Camera",this.matrixWorldInverse=new qt,this.projectionMatrix=new qt,this.projectionMatrixInverse=new qt}function ta(e,t,r,i){ea.call(this),this.type="PerspectiveCamera",this.fov=void 0!==e?e:50,this.zoom=1,this.near=void 0!==r?r:.1,this.far=void 0!==i?i:2e3,this.focus=10,this.aspect=void 0!==t?t:1,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}function ra(e){ta.call(this),this.cameras=e||[]}((Xo.prototype=Object.create(gn.prototype)).constructor=Xo).prototype.isMeshDepthMaterial=!0,Xo.prototype.copy=function(e){return gn.prototype.copy.call(this,e),this.depthPacking=e.depthPacking,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this},((Yo.prototype=Object.create(gn.prototype)).constructor=Yo).prototype.isMeshDistanceMaterial=!0,Yo.prototype.copy=function(e){return gn.prototype.copy.call(this,e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this},$o.prototype=Object.assign(Object.create(oi.prototype),{constructor:$o,isGroup:!0}),ea.prototype=Object.assign(Object.create(oi.prototype),{constructor:ea,isCamera:!0,copy:function(e,t){return oi.prototype.copy.call(this,e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this},getWorldDirection:function(e){void 0===e&&(console.warn("THREE.Camera: .getWorldDirection() target is now required"),e=new Wt),this.updateMatrixWorld(!0);var t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()},updateMatrixWorld:function(e){oi.prototype.updateMatrixWorld.call(this,e),this.matrixWorldInverse.getInverse(this.matrixWorld)},clone:function(){return(new this.constructor).copy(this)}}),ta.prototype=Object.assign(Object.create(ea.prototype),{constructor:ta,isPerspectiveCamera:!0,copy:function(e,t){return ea.prototype.copy.call(this,e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this},setFocalLength:function(e){var t=.5*this.getFilmHeight()/e;this.fov=2*Bt.RAD2DEG*Math.atan(t),this.updateProjectionMatrix()},getFocalLength:function(){var e=Math.tan(.5*Bt.DEG2RAD*this.fov);return.5*this.getFilmHeight()/e},getEffectiveFOV:function(){return 2*Bt.RAD2DEG*Math.atan(Math.tan(.5*Bt.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(e,t,r,i,n,o){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=r,this.view.offsetY=i,this.view.width=n,this.view.height=o,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var e=this.near,t=e*Math.tan(.5*Bt.DEG2RAD*this.fov)/this.zoom,r=2*t,i=this.aspect*r,n=-.5*i,o=this.view;if(null!==this.view&&this.view.enabled){var a=o.fullWidth,s=o.fullHeight;n+=o.offsetX*i/a,t-=o.offsetY*r/s,i*=o.width/a,r*=o.height/s}var l=this.filmOffset;0!==l&&(n+=e*l/this.getFilmWidth()),this.projectionMatrix.makePerspective(n,n+i,t,t-r,e,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(e){var t=oi.prototype.toJSON.call(this,e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}),ra.prototype=Object.assign(Object.create(ta.prototype),{constructor:ra,isArrayCamera:!0});var ia,na,oa,aa,sa,la,ca,ua,ha,pa,da,fa,ma,ga,va,ya,ba=new Wt,xa=new Wt;function Ea(e,t,r){ba.setFromMatrixPosition(t.matrixWorld),xa.setFromMatrixPosition(r.matrixWorld);var i=ba.distanceTo(xa),n=t.projectionMatrix.elements,o=r.projectionMatrix.elements,a=n[14]/(n[10]-1),s=n[14]/(n[10]+1),l=(n[9]+1)/n[5],c=(n[9]-1)/n[5],u=(n[8]-1)/n[0],h=(o[8]+1)/o[0],p=a*u,d=a*h,f=i/(-u+h),m=f*-u;t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(m),e.translateZ(f),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.getInverse(e.matrixWorld);var g=a+f,v=s+f,y=p-m,b=d+(i-m),x=l*s/v*g,E=c*s/v*g;e.projectionMatrix.makePerspective(y,b,x,E,g,v)}function _a(i){var n=this,l=null,c=null,u=null,h=[],p=new qt,d=new qt,o=1,f="stage";"undefined"!=typeof window&&"VRFrameData"in window&&(c=new window.VRFrameData,window.addEventListener("vrdisplaypresentchange",e,!1));var m=new qt,g=new Gt,v=new Wt,y=new ta;y.bounds=new dr(0,0,.5,1),y.layers.enable(1);var b=new ta;b.bounds=new dr(.5,0,.5,1),b.layers.enable(2);var a,s,x=new ra([y,b]);function E(){return null!==l&&!0===l.isPresenting}function e(){if(E()){var e=l.getEyeParameters("left"),t=e.renderWidth*o,r=e.renderHeight*o;s=i.getPixelRatio(),a=i.getSize(),i.setDrawingBufferSize(2*t,r,1),T.start()}else n.enabled&&i.setDrawingBufferSize(a.width,a.height,s),T.stop()}x.layers.enable(1),x.layers.enable(2);var _=[];function w(e){for(var t=navigator.getGamepads&&navigator.getGamepads(),r=0,i=0,n=t.length;r<n;r++){var o=t[r];if(o&&("Daydream Controller"===o.id||"Gear VR Controller"===o.id||"Oculus Go Controller"===o.id||"OpenVR Gamepad"===o.id||o.id.startsWith("Oculus Touch")||o.id.startsWith("Spatial Controller"))){if(i===e)return o;i++}}}this.enabled=!1,this.getController=function(e){var t=h[e];return void 0===t&&((t=new $o).matrixAutoUpdate=!1,t.visible=!1,h[e]=t),t},this.getDevice=function(){return l},this.setDevice=function(e){void 0!==e&&(l=e),T.setContext(e)},this.setFramebufferScaleFactor=function(e){o=e},this.setFrameOfReferenceType=function(e){f=e},this.setPoseTarget=function(e){void 0!==e&&(u=e)},this.getCamera=function(e){var t="stage"===f?1.6:0;if(null===l)return e.position.set(0,t,0),e;if(l.depthNear=e.near,l.depthFar=e.far,l.getFrameData(c),"stage"===f){var r=l.stageParameters;r?p.fromArray(r.sittingToStandingTransform):p.makeTranslation(0,t,0)}var i=c.pose,n=null!==u?u:e;if(n.matrix.copy(p),n.matrix.decompose(n.position,n.quaternion,n.scale),null!==i.orientation&&(g.fromArray(i.orientation),n.quaternion.multiply(g)),null!==i.position&&(g.setFromRotationMatrix(p),v.fromArray(i.position),v.applyQuaternion(g),n.position.add(v)),n.updateMatrixWorld(),!1===l.isPresenting)return e;y.near=e.near,b.near=e.near,y.far=e.far,b.far=e.far,y.matrixWorldInverse.fromArray(c.leftViewMatrix),b.matrixWorldInverse.fromArray(c.rightViewMatrix),d.getInverse(p),"stage"===f&&(y.matrixWorldInverse.multiply(d),b.matrixWorldInverse.multiply(d));var o=n.parent;null!==o&&(m.getInverse(o.matrixWorld),y.matrixWorldInverse.multiply(m),b.matrixWorldInverse.multiply(m)),y.matrixWorld.getInverse(y.matrixWorldInverse),b.matrixWorld.getInverse(b.matrixWorldInverse),y.projectionMatrix.fromArray(c.leftProjectionMatrix),b.projectionMatrix.fromArray(c.rightProjectionMatrix),Ea(x,y,b);var a=l.getLayers();if(a.length){var s=a[0];null!==s.leftBounds&&4===s.leftBounds.length&&y.bounds.fromArray(s.leftBounds),null!==s.rightBounds&&4===s.rightBounds.length&&b.bounds.fromArray(s.rightBounds)}return function(){for(var e=0;e<h.length;e++){var t=h[e],r=w(e);if(void 0!==r&&void 0!==r.pose){if(null===r.pose)return;var i=r.pose;!1===i.hasPosition&&t.position.set(.2,-.6,-.05),null!==i.position&&t.position.fromArray(i.position),null!==i.orientation&&t.quaternion.fromArray(i.orientation),t.matrix.compose(t.position,t.quaternion,t.scale),t.matrix.premultiply(p),t.matrix.decompose(t.position,t.quaternion,t.scale),t.matrixWorldNeedsUpdate=!0,t.visible=!0;var n="Daydream Controller"===r.id?0:1;_[e]!==r.buttons[n].pressed&&(_[e]=r.buttons[n].pressed,!0===_[e]?t.dispatchEvent({type:"selectstart"}):(t.dispatchEvent({type:"selectend"}),t.dispatchEvent({type:"select"})))}else t.visible=!1}}(),x},this.getStandingMatrix=function(){return p},this.isPresenting=E;var T=new kr;this.setAnimationLoop=function(e){T.setAnimationLoop(e)},this.submitFrame=function(){E()&&l.submitFrame()},this.dispose=function(){"undefined"!=typeof window&&window.removeEventListener("vrdisplaypresentchange",e)}}function wa(t){var r=t.context,i=null,p=null,n=1,d=null,o="stage",f=null,m=[],g=[];function a(){return null!==p&&null!==d}var s=new ta;s.layers.enable(1),s.viewport=new dr;var l=new ta;l.layers.enable(2),l.viewport=new dr;var v=new ra([s,l]);function c(e){var t=m[g.indexOf(e.inputSource)];t&&t.dispatchEvent({type:e.type})}function u(){t.setFramebuffer(null),b.stop()}function h(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.getInverse(e.matrixWorld)}v.layers.enable(1),v.layers.enable(2),this.enabled=!1,this.getController=function(e){var t=m[e];return void 0===t&&((t=new $o).matrixAutoUpdate=!1,t.visible=!1,m[e]=t),t},this.getDevice=function(){return i},this.setDevice=function(e){void 0!==e&&(i=e),e instanceof XRDevice&&r.setCompatibleXRDevice(e)},this.setFramebufferScaleFactor=function(e){n=e},this.setFrameOfReferenceType=function(e){o=e},this.setSession=function(e){null!==(p=e)&&(p.addEventListener("select",c),p.addEventListener("selectstart",c),p.addEventListener("selectend",c),p.addEventListener("end",u),p.baseLayer=new XRWebGLLayer(p,r,{framebufferScaleFactor:n}),p.requestFrameOfReference(o).then(function(e){d=e,t.setFramebuffer(p.baseLayer.framebuffer),b.setContext(p),b.start()}),g=p.getInputSources(),p.addEventListener("inputsourceschange",function(){g=p.getInputSources(),console.log(g);for(var e=0;e<m.length;e++){m[e].userData.inputSource=g[e]}}))},this.getCamera=function(e){if(a()){var t=e.parent,r=v.cameras;h(v,t);for(var i=0;i<r.length;i++)h(r[i],t);e.matrixWorld.copy(v.matrixWorld);for(var n=e.children,o=(i=0,n.length);i<o;i++)n[i].updateMatrixWorld(!0);return Ea(v,s,l),v}return e},this.isPresenting=a;var y=null;var b=new kr;b.setAnimationLoop(function(e,t){if(null!==(f=t.getDevicePose(d)))for(var r=p.baseLayer,i=t.views,n=0;n<i.length;n++){var o=i[n],a=r.getViewport(o),s=f.getViewMatrix(o),l=v.cameras[n];l.matrix.fromArray(s).getInverse(l.matrix),l.projectionMatrix.fromArray(o.projectionMatrix),l.viewport.set(a.x,a.y,a.width,a.height),0===n&&v.matrix.copy(l.matrix)}for(n=0;n<m.length;n++){var c=m[n],u=g[n];if(u){var h=t.getInputPose(u,d);if(null!==h){"targetRay"in h?c.matrix.elements=h.targetRay.transformMatrix:"pointerMatrix"in h&&(c.matrix.elements=h.pointerMatrix),c.matrix.decompose(c.position,c.rotation,c.scale),c.visible=!0;continue}}c.visible=!1}y&&y(e)}),this.setAnimationLoop=function(e){y=e},this.dispose=function(){},this.getStandingMatrix=function(){return console.warn("THREE.WebXRManager: getStandingMatrix() is no longer needed."),new THREE.Matrix4},this.submitFrame=function(){}}function Ta(){var r=new Map;this.$mode=0;var t=this;this.setMode=function(e){t.$mode=e},this.getMode=function(){return t.$mode},this.addStrategy=function(e,t){r.set(e,t)},this.getStrategy=function(){return r.get(t.$mode)},this.hasStrategy=function(e){return r.has(e)}}function Ma(e){var i=void 0!==(e=e||{}).canvas?e.canvas:document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),t=void 0!==e.context?e.context:null,r=void 0!==e.alpha&&e.alpha,n=void 0===e.depth||e.depth,o=void 0===e.stencil||e.stencil,a=void 0!==e.antialias&&e.antialias,s=void 0===e.premultipliedAlpha||e.premultipliedAlpha,l=void 0!==e.preserveDrawingBuffer&&e.preserveDrawingBuffer,c=void 0!==e.powerPreference?e.powerPreference:"default",f=null,B=null;this.domElement=i,this.context=null,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.gammaInput=!1,this.gammaOutput=!1,this.physicallyCorrectLights=!1,this.toneMapping=Te,this.toneMappingExposure=1,this.toneMappingWhitePoint=1,this.maxMorphTargets=8,this.maxMorphNormals=4;var z,w,q,G,u,W,h,T,M,m,y,p,d,g,S,R,P,v,X=this,b=!1,x=null,E=null,_=null,Y=-1,A={geometry:null,program:null,wireframe:!1},Q=null,C=null,L=new dr,O=new dr,H=null,J=0,F=i.width,Z=i.height,K=1,k=new dr(0,0,F,Z),I=new dr(0,0,F,Z),j=!1,N=new Er,$=new Mn,ee=!1,te=!1,D=new qt,re=new Wt;function U(){return null===E?K:1}try{var V={alpha:r,depth:n,stencil:o,antialias:a,premultipliedAlpha:s,preserveDrawingBuffer:l,powerPreference:c};if(i.addEventListener("webglcontextlost",se,!1),i.addEventListener("webglcontextrestored",le,!1),null===(z=t||i.getContext("webgl",V)||i.getContext("experimental-webgl",V)))throw null!==i.getContext("webgl")?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.");void 0===z.getShaderPrecisionFormat&&(z.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(e){console.error("THREE.WebGLRenderer: "+e.message)}function ie(){w=new Sn(z),(q=new Tn(z,w,e)).isWebGL2||(w.get("WEBGL_depth_texture"),w.get("OES_texture_float"),w.get("OES_texture_half_float"),w.get("OES_texture_half_float_linear"),w.get("OES_standard_derivatives"),w.get("OES_element_index_uint"),w.get("ANGLE_instanced_arrays")),w.get("OES_texture_float_linear"),v=new Ko(z,w,q),(G=new Jo(z,w,v,q)).scissor(O.copy(I).multiplyScalar(K)),G.viewport(L.copy(k).multiplyScalar(K)),u=new An(z),W=new jo,h=new Zo(z,w,G,W,q,v,u),T=new Ir(z),M=new Rn(z,T,u),m=new On(M,u),S=new Ln(z),y=new Io(X,w,q),p=new Vo,d=new Wo,g=new _n(X,G,m,s),R=new wn(z,w,u,q),P=new Pn(z,w,u,q),u.programs=y.programs,X.context=z,X.capabilities=q,X.extensions=w,X.properties=W,X.renderLists=p,X.state=G,X.info=u}ie();var ne=null;"undefined"!=typeof navigator&&(ne="xr"in navigator?new wa(X):new _a(X)),this.vr=ne;var oe=new Qo(X,m,q.maxTextureSize);this.shadowMap=oe;var ae=new Ta;function se(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),b=!0}function le(){console.log("THREE.WebGLRenderer: Context Restored."),b=!1,ie()}function ce(e){var t,r=e.target;r.removeEventListener("dispose",ce),ue(t=r),W.remove(t)}function ue(e){var t=W.get(e).program;(e.program=void 0)!==t&&y.releaseProgram(t)}this.materialManager=ae,this.getContext=function(){return z},this.getContextAttributes=function(){return z.getContextAttributes()},this.forceContextLoss=function(){var e=w.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){var e=w.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return K},this.setPixelRatio=function(e){void 0!==e&&(K=e,this.setSize(F,Z,!1))},this.getSize=function(){return{width:F,height:Z}},this.setSize=function(e,t,r){ne.isPresenting()?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(F=e,Z=t,i.width=e*K,i.height=t*K,!1!==r&&(i.style.width=e+"px",i.style.height=t+"px"),this.setViewport(0,0,e,t))},this.getDrawingBufferSize=function(){return{width:F*K,height:Z*K}},this.setDrawingBufferSize=function(e,t,r){F=e,Z=t,K=r,i.width=e*r,i.height=t*r,this.setViewport(0,0,e,t)},this.getCurrentViewport=function(){return L},this.setViewport=function(e,t,r,i){k.set(e,Z-t-i,r,i),G.viewport(L.copy(k).multiplyScalar(K))},this.setScissor=function(e,t,r,i){I.set(e,Z-t-i,r,i),G.scissor(O.copy(I).multiplyScalar(K))},this.setScissorTest=function(e){G.setScissorTest(j=e)},this.getClearColor=function(){return g.getClearColor()},this.setClearColor=function(){g.setClearColor.apply(g,arguments)},this.getClearAlpha=function(){return g.getClearAlpha()},this.setClearAlpha=function(){g.setClearAlpha.apply(g,arguments)},this.clear=function(e,t,r){var i=0;(void 0===e||e)&&(i|=16384),(void 0===t||t)&&(i|=256),(void 0===r||r)&&(i|=1024),z.clear(i)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){i.removeEventListener("webglcontextlost",se,!1),i.removeEventListener("webglcontextrestored",le,!1),p.dispose(),d.dispose(),W.dispose(),m.dispose(),ne.dispose(),me.stop()},this.renderBufferImmediate=function(e,t){G.initAttributes();var r=W.get(e);e.hasPositions&&!r.position&&(r.position=z.createBuffer()),e.hasNormals&&!r.normal&&(r.normal=z.createBuffer()),e.hasUvs&&!r.uv&&(r.uv=z.createBuffer()),e.hasColors&&!r.color&&(r.color=z.createBuffer());var i=t.getAttributes();e.hasPositions&&(z.bindBuffer(34962,r.position),z.bufferData(34962,e.positionArray,35048),G.enableAttribute(i.position),z.vertexAttribPointer(i.position,3,5126,!1,0,0)),e.hasNormals&&(z.bindBuffer(34962,r.normal),z.bufferData(34962,e.normalArray,35048),G.enableAttribute(i.normal),z.vertexAttribPointer(i.normal,3,5126,!1,0,0)),e.hasUvs&&(z.bindBuffer(34962,r.uv),z.bufferData(34962,e.uvArray,35048),G.enableAttribute(i.uv),z.vertexAttribPointer(i.uv,2,5126,!1,0,0)),e.hasColors&&(z.bindBuffer(34962,r.color),z.bufferData(34962,e.colorArray,35048),G.enableAttribute(i.color),z.vertexAttribPointer(i.color,3,5126,!1,0,0)),G.disableUnusedAttributes(),z.drawArrays(4,0,e.count),e.count=0},this.renderBufferDirect=function(e,t,r,i,n,o){var a=n.isMesh&&n.normalMatrix.determinant()<0;G.setMaterial(i,a);var s=be(e,t,i,n),l=!1;A.geometry===r.id&&A.program===s.id&&A.wireframe===(!0===i.wireframe)||(A.geometry=r.id,A.program=s.id,A.wireframe=!0===i.wireframe,l=!0),n.morphTargetInfluences&&(S.update(n,r,i,s),l=!0);var c,u=r.index,h=r.attributes.position,p=1;!0===i.wireframe&&(u=M.getWireframeAttribute(r),p=2);var d=R;null!==u&&(c=T.get(u),(d=P).setIndex(c)),l&&(!function(e,t,r){if(r&&r.isInstancedBufferGeometry&!q.isWebGL2&&null===w.get("ANGLE_instanced_arrays"))return console.error("THREE.WebGLRenderer.setupVertexAttributes: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");G.initAttributes();var i=r.attributes,n=t.getAttributes(),o=e.defaultAttributeValues;for(var a in n){var s=n[a];if(0<=s){var l=i[a];if(void 0!==l){var c=l.normalized,u=l.itemSize,h=T.get(l);if(void 0===h)continue;var p=h.buffer,d=h.type,f=h.bytesPerElement;if(l.isInterleavedBufferAttribute){var m=l.data,g=m.stride,v=l.offset;m&&m.isInstancedInterleavedBuffer?(G.enableAttributeAndDivisor(s,m.meshPerAttribute),void 0===r.maxInstancedCount&&(r.maxInstancedCount=m.meshPerAttribute*m.count)):G.enableAttribute(s),z.bindBuffer(34962,p),z.vertexAttribPointer(s,u,d,c,g*f,v*f)}else l.isInstancedBufferAttribute?(G.enableAttributeAndDivisor(s,l.meshPerAttribute),void 0===r.maxInstancedCount&&(r.maxInstancedCount=l.meshPerAttribute*l.count)):G.enableAttribute(s),z.bindBuffer(34962,p),z.vertexAttribPointer(s,u,d,c,0,0)}else if(void 0!==o){var y=o[a];if(void 0!==y)switch(y.length){case 2:z.vertexAttrib2fv(s,y);break;case 3:z.vertexAttrib3fv(s,y);break;case 4:z.vertexAttrib4fv(s,y);break;default:z.vertexAttrib1fv(s,y)}}}}G.disableUnusedAttributes()}(i,s,r),null!==u&&z.bindBuffer(34963,c.buffer));var f=1/0;null!==u?f=u.count:void 0!==h&&(f=h.count);var m=r.drawRange.start*p,g=r.drawRange.count*p,v=null!==o?o.start*p:0,y=null!==o?o.count*p:1/0,b=Math.max(m,v),x=Math.min(f,m+g,v+y)-1,E=Math.max(0,x-b+1);if(0!==E){if(n.isMesh)if(!0===i.wireframe)G.setLineWidth(i.wireframeLinewidth*U()),d.setMode(1);else switch(n.drawMode){case Ct:d.setMode(4);break;case 1:d.setMode(5);break;case 2:d.setMode(6)}else if(n.isLine){var _=i.linewidth;void 0===_&&(_=1),G.setLineWidth(_*U()),n.isLineSegments?d.setMode(1):n.isLineLoop?d.setMode(2):d.setMode(3)}else n.isPoints?d.setMode(0):n.isSprite&&d.setMode(4);r&&r.isInstancedBufferGeometry?0<r.maxInstancedCount&&d.renderInstances(r,b,E):d.render(b,E)}},this.compile=function(r,e){(B=d.get(r,e)).init(),r.traverse(function(e){e.isLight&&(B.pushLight(e),e.castShadow&&B.pushShadow(e))}),B.setupLights(e),r.traverse(function(e){if(e.material)if(Array.isArray(e.material))for(var t=0;t<e.material.length;t++)ye(e.material[t],r.fog,e);else ye(e.material,r.fog,e)})};var he=null;var pe,de,fe,me=new kr;function ge(e,t,r,i){for(var n=0,o=e.length;n<o;n++){var a=e[n],s=a.object,l=a.geometry,c=void 0===i?a.material:i,u=a.group;if(r.isArrayCamera)for(var h=(C=r).cameras,p=0,d=h.length;p<d;p++){var f=h[p];if(s.layers.test(f.layers)){if("viewport"in f)G.viewport(L.copy(f.viewport));else{var m=f.bounds,g=m.x*F,v=m.y*Z,y=m.z*F,b=m.w*Z;G.viewport(L.set(g,v,y,b).multiplyScalar(K))}B.setupLights(f),ve(s,t,f,l,c,u)}}else C=null,ve(s,t,r,l,c,u)}}function ve(e,t,r,i,n,o){var a;a=e.onBeforeRender(X,t,r,i,n,o);var s=e.onBeforeUpdateModelViewMatrix;if(!s||null!==s.call(e,X,t,r,i,a,o)){if(0!==ae.$mode){var l=ae.getStrategy();l&&(a=l.call(e,this,t,r,i,n,o))}if(null!==a){if(a&&(n=a),B=d.get(t,C||r),e.modelViewMatrix.multiplyMatrices(r.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),e.isImmediateRenderObject){G.setMaterial(n);var c=be(r,t.fog,n,e);A.geometry=null,A.program=null,A.wireframe=!1,u=c,e.render(function(e){X.renderBufferImmediate(e,u)})}else X.renderBufferDirect(r,t.fog,i,n,e,o);var u,h=e.onAfterUpdateModelViewMatrix;h&&null===h.call(e,X,t,r,i,a,o)||(e.onAfterRender(X,t,r,i,n,o),B=d.get(t,C||r))}}}function ye(e,t,r){var i=W.get(e),n=B.state.lights,o=B.state.shadowsArray,a=i.lightsHash,s=n.state.hash,l=y.getParameters(e,n.state,o,t,$.numPlanes,$.numIntersection,r),c=y.getProgramCode(e,l),u=i.program,h=!0;if(void 0===u)e.addEventListener("dispose",ce);else if(u.code!==c)ue(e);else if(a.stateID!==s.stateID||a.directionalLength!==s.directionalLength||a.pointLength!==s.pointLength||a.spotLength!==s.spotLength||a.rectAreaLength!==s.rectAreaLength||a.hemiLength!==s.hemiLength||a.shadowsLength!==s.shadowsLength)a.stateID=s.stateID,a.directionalLength=s.directionalLength,a.pointLength=s.pointLength,a.spotLength=s.spotLength,a.rectAreaLength=s.rectAreaLength,a.hemiLength=s.hemiLength,a.shadowsLength=s.shadowsLength,h=!1;else{if(void 0!==l.shaderID)return;h=!1}if(h){if(l.shaderID){var p=Fr[l.shaderID];i.shader={name:e.type,uniforms:wr(p.uniforms),vertexShader:p.vertexShader,fragmentShader:p.fragmentShader}}else i.shader={name:e.type,uniforms:e.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader};e.onBeforeCompile(i.shader,X),c=y.getProgramCode(e,l),u=y.acquireProgram(e,i.shader,l,c),i.program=u,e.program=u}var d=u.getAttributes();if(e.morphTargets)for(var f=e.numSupportedMorphTargets=0;f<X.maxMorphTargets;f++)0<=d["morphTarget"+f]&&e.numSupportedMorphTargets++;if(e.morphNormals)for(f=e.numSupportedMorphNormals=0;f<X.maxMorphNormals;f++)0<=d["morphNormal"+f]&&e.numSupportedMorphNormals++;var m=i.shader.uniforms;(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(i.numClippingPlanes=$.numPlanes,i.numIntersection=$.numIntersection,m.clippingPlanes=$.uniform),i.fog=t,void 0===a&&(i.lightsHash=a={}),a.stateID=s.stateID,a.directionalLength=s.directionalLength,a.pointLength=s.pointLength,a.spotLength=s.spotLength,a.rectAreaLength=s.rectAreaLength,a.hemiLength=s.hemiLength,a.shadowsLength=s.shadowsLength,e.lights&&(m.ambientLightColor.value=n.state.ambient,m.directionalLights.value=n.state.directional,m.spotLights.value=n.state.spot,m.rectAreaLights.value=n.state.rectArea,m.pointLights.value=n.state.point,m.hemisphereLights.value=n.state.hemi,m.directionalShadowMap.value=n.state.directionalShadowMap,m.directionalShadowMatrix.value=n.state.directionalShadowMatrix,m.spotShadowMap.value=n.state.spotShadowMap,m.spotShadowMatrix.value=n.state.spotShadowMatrix,m.pointShadowMap.value=n.state.pointShadowMap,m.pointShadowMatrix.value=n.state.pointShadowMatrix);var g=i.program.getUniforms(),v=Mo.seqWithValue(g.seq,m);i.uniformsList=v}function be(e,t,r,i){J=0;var n=W.get(r),o=B.state.lights,a=n.lightsHash,s=o.state.hash;if(ee&&(te||e!==Q)){var l=e===Q&&r.id===Y;$.setState(r.clippingPlanes,r.clipIntersection,r.clipShadows,e,n,l)}!1===r.needsUpdate&&(void 0===n.program?r.needsUpdate=!0:r.fog&&n.fog!==t?r.needsUpdate=!0:(!r.lights||a.stateID===s.stateID&&a.directionalLength===s.directionalLength&&a.pointLength===s.pointLength&&a.spotLength===s.spotLength&&a.rectAreaLength===s.rectAreaLength&&a.hemiLength===s.hemiLength&&a.shadowsLength===s.shadowsLength)&&(void 0===n.numClippingPlanes||n.numClippingPlanes===$.numPlanes&&n.numIntersection===$.numIntersection)||(r.needsUpdate=!0)),r.needsUpdate&&(ye(r,t,i),r.needsUpdate=!1);var c,u,h,p,d,f,m,g,v,y,b,x,E,_,w,T,M,S,R,P,A=!1,C=!1,L=!1,O=n.program,H=O.getUniforms(),F=n.shader.uniforms;if(G.useProgram(O.program)&&(L=C=A=!0),r.id!==Y&&(Y=r.id,C=!0),A||Q!==e){if(H.setValue(z,"projectionMatrix",e.projectionMatrix),q.logarithmicDepthBuffer&&H.setValue(z,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),Q!==e&&(Q=e,L=C=!0),r.isShaderMaterial||r.isMeshPhongMaterial||r.isMeshStandardMaterial||r.envMap){var k=H.map.cameraPosition;void 0!==k&&k.setValue(z,re.setFromMatrixPosition(e.matrixWorld))}(r.isMeshPhongMaterial||r.isMeshLambertMaterial||r.isMeshBasicMaterial||r.isMeshStandardMaterial||r.isShaderMaterial||r.skinning)&&H.setValue(z,"viewMatrix",e.matrixWorldInverse)}if(r.skinning){H.setOptional(z,i,"bindMatrix"),H.setOptional(z,i,"bindMatrixInverse");var I=i.skeleton;if(I){var j=I.bones,N=i.bindMatrixInverse.clone();if(N.elements[12]=0,N.elements[13]=0,N.elements[14]=0,H.setValue(z,"localBindMatrixInverse",N),q.floatVertexTextures){if(void 0===I.boneTexture){var D=Math.sqrt(4*j.length);D=Bt.ceilPowerOfTwo(D),D=Math.max(D,4);var U=new Float32Array(D*D*4);U.set(I.boneMatrices);var V=new vr(U,D,D,Qe,Ve);V.needsUpdate=!0,I.boneMatrices=U,I.boneTexture=V,I.boneTextureSize=D}H.setValue(z,"boneTexture",I.boneTexture),H.setValue(z,"boneTextureSize",I.boneTextureSize)}else H.setOptional(z,I,"boneMatrices")}}return C&&(H.setValue(z,"toneMappingExposure",X.toneMappingExposure),H.setValue(z,"toneMappingWhitePoint",X.toneMappingWhitePoint),r.lights&&(P=L,(R=F).ambientLightColor.needsUpdate=P,R.directionalLights.needsUpdate=P,R.pointLights.needsUpdate=P,R.spotLights.needsUpdate=P,R.rectAreaLights.needsUpdate=P,R.hemisphereLights.needsUpdate=P),t&&r.fog&&(S=t,(M=F).fogColor.value=S.color,S.isFog?(M.fogNear.value=S.near,M.fogFar.value=S.far):S.isFogExp2&&(M.fogDensity.value=S.density)),r.isMeshBasicMaterial?xe(F,r):r.isMeshLambertMaterial?(xe(F,r),w=F,(T=r).emissiveMap&&(w.emissiveMap.value=T.emissiveMap)):r.isMeshPhongMaterial?(xe(F,r),r.isMeshToonMaterial?(Ee(E=F,_=r),_.gradientMap&&(E.gradientMap.value=_.gradientMap)):Ee(F,r)):r.isMeshStandardMaterial?(xe(F,r),r.isMeshPhysicalMaterial?(_e(b=F,x=r),b.reflectivity.value=x.reflectivity,b.clearCoat.value=x.clearCoat,b.clearCoatRoughness.value=x.clearCoatRoughness):_e(F,r)):r.isMeshMatcapMaterial?(xe(F,r),function(e,t){t.matcap&&(e.matcap.value=t.matcap);t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===we&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===we&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(F,r)):r.isMeshDepthMaterial?(xe(F,r),v=F,(y=r).displacementMap&&(v.displacementMap.value=y.displacementMap,v.displacementScale.value=y.displacementScale,v.displacementBias.value=y.displacementBias)):r.isMeshDistanceMaterial?(xe(F,r),function(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias);e.referencePosition.value.copy(t.referencePosition),e.nearDistance.value=t.nearDistance,e.farDistance.value=t.farDistance}(F,r)):r.isMeshNormalMaterial?(xe(F,r),function(e,t){t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===we&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===we&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(F,r)):r.isLineBasicMaterial?(g=r,(m=F).diffuse.value=g.color,m.opacity.value=g.opacity,r.isLineDashedMaterial&&(f=r,(d=F).dashSize.value=f.dashSize,d.totalSize.value=f.dashSize+f.gapSize,d.scale.value=f.scale)):r.isPointsMaterial?(p=r,(h=F).diffuse.value=p.color,h.opacity.value=p.opacity,h.size.value=p.size*K,h.scale.value=.5*Z,h.map.value=p.map,null!==p.map&&(!0===p.map.matrixAutoUpdate&&p.map.updateMatrix(),h.uvTransform.value.copy(p.map.matrix))):r.isSpriteMaterial?(u=r,(c=F).diffuse.value=u.color,c.opacity.value=u.opacity,c.rotation.value=u.rotation,c.map.value=u.map,null!==u.map&&(!0===u.map.matrixAutoUpdate&&u.map.updateMatrix(),c.uvTransform.value.copy(u.map.matrix))):r.isShadowMaterial&&(F.color.value=r.color,F.opacity.value=r.opacity),void 0!==F.ltc_1&&(F.ltc_1.value=Hr.LTC_1),void 0!==F.ltc_2&&(F.ltc_2.value=Hr.LTC_2),Mo.upload(z,n.uniformsList,F,X)),H.setValue(z,"baseId",r.baseId),r.isShaderMaterial&&!0===r.uniformsNeedUpdate&&(Mo.upload(z,n.uniformsList,F,X),r.uniformsNeedUpdate=!1),r.isSpriteMaterial&&H.setValue(z,"center",i.center),H.setValue(z,"modelViewMatrix",i.modelViewMatrix),H.setValue(z,"normalMatrix",i.normalMatrix),H.setValue(z,"modelMatrix",i.matrixWorld),O}function xe(e,t){var r;e.opacity.value=t.opacity,t.color&&(e.diffuse.value=t.color),t.emissive&&e.emissive.value.copy(t.emissive).multiplyScalar(t.emissiveIntensity),t.map&&(e.map.value=t.map),t.alphaMap&&(e.alphaMap.value=t.alphaMap),t.specularMap&&(e.specularMap.value=t.specularMap),t.envMap&&(e.envMap.value=t.envMap,e.flipEnvMap.value=t.envMap.isCubeTexture?-1:1,e.reflectivity.value=t.reflectivity,e.refractionRatio.value=t.refractionRatio,e.maxMipLevel.value=W.get(t.envMap).__maxMipLevel),t.lightMap&&(e.lightMap.value=t.lightMap,e.lightMapIntensity.value=t.lightMapIntensity),t.aoMap&&(e.aoMap.value=t.aoMap,e.aoMapIntensity.value=t.aoMapIntensity),t.map?r=t.map:t.specularMap?r=t.specularMap:t.displacementMap?r=t.displacementMap:t.normalMap?r=t.normalMap:t.bumpMap?r=t.bumpMap:t.roughnessMap?r=t.roughnessMap:t.metalnessMap?r=t.metalnessMap:t.alphaMap?r=t.alphaMap:t.emissiveMap&&(r=t.emissiveMap),void 0!==r&&(r.isWebGLRenderTarget&&(r=r.texture),!0===r.matrixAutoUpdate&&r.updateMatrix(),e.uvTransform.value.copy(r.matrix)),t.alphaMap&&(!0===t.alphaMap.matrixAutoUpdate&&t.alphaMap.updateMatrix(),e.uvTransform1.value.copy(t.alphaMap.matrix)),t.alphaMap1&&(!0===t.alphaMap1.matrixAutoUpdate&&t.alphaMap1.updateMatrix(),e.uvTransform1.value.copy(t.alphaMap1.matrix))}function Ee(e,t){e.specular.value=t.specular,e.shininess.value=Math.max(t.shininess,1e-4),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===we&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===we&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}function _e(e,t){e.roughness.value=t.roughness,e.metalness.value=t.metalness,t.roughnessMap&&(e.roughnessMap.value=t.roughnessMap),t.metalnessMap&&(e.metalnessMap.value=t.metalnessMap),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===we&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===we&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias),t.envMap&&(e.envMapIntensity.value=t.envMapIntensity)}me.setAnimationLoop(function(e){ne.isPresenting()||he&&he(e)}),"undefined"!=typeof window&&me.setContext(window),this.setAnimationLoop=function(e){he=e,ne.setAnimationLoop(e),me.start()},this.render=function(e,t,r,i){if(t&&t.isCamera){if(!b){A.geometry=null,A.program=null,A.wireframe=!1,Y=-1,!(Q=null)===e.autoUpdate&&e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(),ne.enabled&&(t=ne.getCamera(t)),(B=d.get(e,t)).init(),e.onBeforeRender(X,e,t,r),D.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),N.setFromMatrix(D),te=this.localClippingEnabled,ee=$.init(this.clippingPlanes,te,t),(f=p.get(e,t)).init(),function e(t,r,i,n){if(!1===t.visible)return;var o=t.layers.test(r.layers);if(o)if(t.isGroup)i=t.renderOrder;else if(t.isLight)B.pushLight(t),t.castShadow&&B.pushShadow(t);else if(t.isSprite){if(!t.frustumCulled||N.intersectsSprite(t)){n&&re.setFromMatrixPosition(t.matrixWorld).applyMatrix4(D);var a=m.update(t),s=t.material;f.push(t,a,s,i,re.z,null)}}else if(t.isImmediateRenderObject)n&&re.setFromMatrixPosition(t.matrixWorld).applyMatrix4(D),f.push(t,null,t.material,i,re.z,null);else if((t.isMesh||t.isLine||t.isPoints)&&(t.isSkinnedMesh&&t.skeleton.update(t),!t.frustumCulled||N.intersectsObject(t))){n&&re.setFromMatrixPosition(t.matrixWorld).applyMatrix4(D);var a=m.update(t),s=t.material;if(Array.isArray(s))for(var l=a.groups,c=0,u=l.length;c<u;c++){var h=l[c],p=s[h.materialIndex];p&&p.visible&&f.push(t,a,p,i,re.z,h)}else s.visible&&f.push(t,a,s,i,re.z,null)}var d=t.children;for(var c=0,u=d.length;c<u;c++)e(d[c],r,i,n)}(e,t,0,X.sortObjects),!0===X.sortObjects&&f.sort(),ee&&$.beginShadows();var n=B.state.shadowsArray;oe.render(n,e,t),B.setupLights(t),ee&&$.endShadows(),this.info.autoReset&&this.info.reset(),void 0===r&&(r=null),this.setRenderTarget(r),g.render(f,e,t,i);var o=f.opaque,a=f.transparent;if(e.overrideMaterial){var s=e.overrideMaterial;o.length&&ge(o,e,t,s),a.length&&ge(a,e,t,s)}else o.length&&ge(o,e,t),a.length&&ge(a,e,t);r&&(h.updateRenderTargetMipmap(r),h.updateMultisampleRenderTarget(r)),G.buffers.depth.setTest(!0),G.buffers.depth.setMask(!0),G.buffers.color.setMask(!0),G.setPolygonOffset(!1),e.onAfterRender(X,e,t),ne.enabled&&ne.submitFrame(),B=f=null}}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.allocTextureUnit=function(){var e=J;return e>=q.maxTextures&&console.warn("THREE.WebGLRenderer: Trying to use "+e+" texture units while this GPU supports only "+q.maxTextures),J+=1,e},this.setTexture2D=(pe=!1,function(e,t){e&&e.isWebGLRenderTarget&&(pe||(console.warn("THREE.WebGLRenderer.setTexture2D: don't use render targets as textures. Use their .texture property instead."),pe=!0),e=e.texture),h.setTexture2D(e,t)}),this.setTexture3D=function(e,t){h.setTexture3D(e,t)},this.setTexture=(de=!1,function(e,t){de||(console.warn("THREE.WebGLRenderer: .setTexture is deprecated, use setTexture2D instead."),de=!0),h.setTexture2D(e,t)}),this.setTextureCube=(fe=!1,function(e,t){e&&e.isWebGLRenderTargetCube&&(fe||(console.warn("THREE.WebGLRenderer.setTextureCube: don't use cube render targets as textures. Use their .texture property instead."),fe=!0),e=e.texture),e&&e.isCubeTexture||Array.isArray(e.image)&&6===e.image.length?h.setTextureCube(e,t):h.setTextureCubeDynamic(e,t)}),this.setFramebuffer=function(e){x=e},this.getRenderTarget=function(){return E},this.setRenderTarget=function(e){(E=e)&&void 0===W.get(e).__webglFramebuffer&&h.setupRenderTarget(e);var t=x,r=!1;if(e){var i=W.get(e).__webglFramebuffer;e.isWebGLRenderTargetCube?(t=i[e.activeCubeFace],r=!0):t=e.isWebGLMultisampleRenderTarget?W.get(e).__webglMultisampledFramebuffer:i,L.copy(e.viewport),O.copy(e.scissor),H=e.scissorTest}else L.copy(k).multiplyScalar(K),O.copy(I).multiplyScalar(K),H=j;if(_!==t&&(z.bindFramebuffer(36160,t),_=t),G.viewport(L),G.scissor(O),G.setScissorTest(H),r){var n=W.get(e.texture);z.framebufferTexture2D(36160,36064,34069+e.activeCubeFace,n.__webglTexture,e.activeMipMapLevel)}},this.readRenderTargetPixels=function(e,t,r,i,n,o){if(e&&e.isWebGLRenderTarget){var a=W.get(e).__webglFramebuffer;if(a){var s=!1;a!==_&&(z.bindFramebuffer(36160,a),s=!0);try{var l=e.texture,c=l.format,u=l.type;if(c!==Qe&&v.convert(c)!==z.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");if(!(u===ke||v.convert(u)===z.getParameter(35738)||u===Ve&&(q.isWebGL2||w.get("OES_texture_float")||w.get("WEBGL_color_buffer_float"))||u===Be&&(q.isWebGL2?w.get("EXT_color_buffer_float"):w.get("EXT_color_buffer_half_float"))))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");36053===z.checkFramebufferStatus(36160)?0<=t&&t<=e.width-i&&0<=r&&r<=e.height-n&&z.readPixels(t,r,i,n,v.convert(c),v.convert(u),o):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{s&&z.bindFramebuffer(36160,_)}}}else console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.")},this.copyFramebufferToTexture=function(e,t,r){var i=t.image.width,n=t.image.height,o=v.convert(t.format);this.setTexture2D(t,0),z.copyTexImage2D(3553,r||0,o,e.x,e.y,i,n,0)},this.copyTextureToTexture=function(e,t,r,i){var n=t.image.width,o=t.image.height,a=v.convert(r.format),s=v.convert(r.type);this.setTexture2D(r,0),t.isDataTexture?z.texSubImage2D(3553,i||0,e.x,e.y,n,o,a,s,t.image.data):z.texSubImage2D(3553,i||0,e.x,e.y,a,s,t.image)}}function Sa(e,t){this.name="",this.color=new Cr(e),this.density=void 0!==t?t:25e-5}function Ra(e,t,r){this.name="",this.color=new Cr(e),this.near=void 0!==t?t:1,this.far=void 0!==r?r:1e3}function Pa(){oi.call(this),this.type="Scene",this.background=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0}function Aa(e,t){this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.version=0}function Ca(e,t,r,i){this.data=e,this.itemSize=t,this.offset=r,this.normalized=!0===i}function La(e){gn.call(this),this.type="SpriteMaterial",this.color=new Cr(16777215),this.map=null,this.rotation=0,this.sizeAttenuation=!0,this.lights=!1,this.transparent=!0,this.setValues(e)}function Oa(e){if(oi.call(this),this.type="Sprite",void 0===ia){ia=new Ni;var t=new Aa(new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),5);ia.setIndex([0,1,2,0,2,3]),ia.addAttribute("position",new Ca(t,3,0,!1)),ia.addAttribute("uv",new Ca(t,2,3,!1))}this.geometry=ia,this.material=void 0!==e?e:new La,this.center=new zt(.5,.5)}function Ha(){oi.call(this),this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}})}function Fa(e,t){e&&e.isGeometry&&console.error("THREE.SkinnedMesh no longer supports THREE.Geometry. Use THREE.BufferGeometry instead."),En.call(this,e,t),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new qt,this.bindMatrixInverse=new qt}function ka(e,t){if(e=e||[],this.bones=e.slice(0),this.boneMatrices=new Float32Array(16*this.bones.length),void 0===t)this.calculateInverses();else if(this.bones.length===t.length)this.boneInverses=t.slice(0);else{console.warn("THREE.Skeleton boneInverses is the wrong length."),this.boneInverses=[];for(var r=0,i=this.bones.length;r<i;r++)this.boneInverses.push(new qt)}}function Ia(){oi.call(this),this.type="Bone"}function ja(e){gn.call(this),this.type="LineBasicMaterial",this.color=new Cr(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.lights=!1,this.setValues(e)}function Na(e,t,r){1===r&&console.error("THREE.Line: parameter THREE.LinePieces no longer supported. Use THREE.LineSegments instead."),oi.call(this),this.type="Line",this.geometry=void 0!==e?e:new Ni,this.material=void 0!==t?t:new ja({color:16777215*Math.random()})}function Da(e,t){Na.call(this,e,t),this.type="LineSegments"}function Ua(e,t){Na.call(this,e,t),this.type="LineLoop"}function Va(e){gn.call(this),this.type="PointsMaterial",this.color=new Cr(16777215),this.map=null,this.size=1,this.sizeAttenuation=!0,this.morphTargets=!1,this.lights=!1,this.setValues(e)}function Ba(e,t){oi.call(this),this.type="Points",this.geometry=void 0!==e?e:new Ni,this.material=void 0!==t?t:new Va({color:16777215*Math.random()})}function za(e,t,r,i,n,o,a,s,l){pr.call(this,e,t,r,i,n,o,a,s,l),this.format=void 0!==a?a:Ye,this.minFilter=void 0!==o?o:Oe,this.magFilter=void 0!==n?n:Oe,this.generateMipmaps=!1}function qa(e,t,r,i,n,o,a,s,l,c,u,h){pr.call(this,null,o,a,s,l,c,i,n,u,h),this.image={width:t,height:r},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}function Ga(e,t,r,i,n,o,a,s,l){pr.call(this,e,t,r,i,n,o,a,s,l),this.needsUpdate=!0}function Wa(e,t,r,i,n,o,a,s,l,c){if((c=void 0!==c?c:$e)!==$e&&c!==et)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===r&&c===$e&&(r=Ne),void 0===r&&c===et&&(r=We),pr.call(this,null,i,n,o,a,s,c,r,l),this.image={width:e,height:t},this.magFilter=void 0!==a?a:Ae,this.minFilter=void 0!==s?s:Ae,this.flipY=!1,this.generateMipmaps=!1}function Xa(e){Ni.call(this),this.type="WireframeGeometry";var t,r,i,n,o,a,s,l,c,u,h=[],p=[0,0],d={},f=["a","b","c"];if(e&&e.isGeometry){var m=e.faces;for(t=0,i=m.length;t<i;t++){var g=m[t];for(r=0;r<3;r++)s=g[f[r]],l=g[f[(r+1)%3]],p[0]=Math.min(s,l),p[1]=Math.max(s,l),void 0===d[c=p[0]+","+p[1]]&&(d[c]={index1:p[0],index2:p[1]})}for(c in d)a=d[c],u=e.vertices[a.index1],h.push(u.x,u.y,u.z),u=e.vertices[a.index2],h.push(u.x,u.y,u.z)}else if(e&&e.isBufferGeometry){var v,y,b,x,E,_;if(u=new Wt,null!==e.index){for(v=e.attributes.position,y=e.index,0===(b=e.groups).length&&(b=[{start:0,count:y.count,materialIndex:0}]),n=0,o=b.length;n<o;++n)for(i=(t=(x=b[n]).start)+x.count;t<i;t+=3)for(r=0;r<3;r++)s=y.getX(t+r),l=y.getX(t+(r+1)%3),p[0]=Math.min(s,l),p[1]=Math.max(s,l),void 0===d[c=p[0]+","+p[1]]&&(d[c]={index1:p[0],index2:p[1]});for(c in d)a=d[c],u.fromBufferAttribute(v,a.index1),h.push(u.x,u.y,u.z),u.fromBufferAttribute(v,a.index2),h.push(u.x,u.y,u.z)}else for(t=0,i=(v=e.attributes.position).count/3;t<i;t++)for(r=0;r<3;r++)E=3*t+r,u.fromBufferAttribute(v,E),h.push(u.x,u.y,u.z),_=3*t+(r+1)%3,u.fromBufferAttribute(v,_),h.push(u.x,u.y,u.z)}this.addAttribute("position",new wi(h,3))}function Ya(e,t,r){fi.call(this),this.type="ParametricGeometry",this.parameters={func:e,slices:t,stacks:r},this.fromBufferGeometry(new Qa(e,t,r)),this.mergeVertices()}function Qa(e,t,r){Ni.call(this),this.type="ParametricBufferGeometry",this.parameters={func:e,slices:t,stacks:r};var i,n,o=[],a=[],s=[],l=[],c=new Wt,u=new Wt,h=new Wt,p=new Wt,d=new Wt;e.length<3&&console.error("THREE.ParametricGeometry: Function must now modify a Vector3 as third parameter.");var f=t+1;for(i=0;i<=r;i++){var m=i/r;for(n=0;n<=t;n++){var g=n/t;e(g,m,u),a.push(u.x,u.y,u.z),0<=g-1e-5?(e(g-1e-5,m,h),p.subVectors(u,h)):(e(g+1e-5,m,h),p.subVectors(h,u)),0<=m-1e-5?(e(g,m-1e-5,h),d.subVectors(u,h)):(e(g,m+1e-5,h),d.subVectors(h,u)),c.crossVectors(p,d).normalize(),s.push(c.x,c.y,c.z),l.push(g,m)}}for(i=0;i<r;i++)for(n=0;n<t;n++){var v=i*f+n,y=i*f+n+1,b=(i+1)*f+n+1,x=(i+1)*f+n;o.push(v,y,x),o.push(y,b,x)}this.setIndex(o),this.addAttribute("position",new wi(a,3)),this.addAttribute("normal",new wi(s,3)),this.addAttribute("uv",new wi(l,2))}function Ja(e,t,r,i){fi.call(this),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:r,detail:i},this.fromBufferGeometry(new Za(e,t,r,i)),this.mergeVertices()}function Za(i,o,e,t){Ni.call(this),this.type="PolyhedronBufferGeometry",this.parameters={vertices:i,indices:o,radius:e,detail:t},e=e||1;var u=[],h=[];function a(e,t,r,i){var n,o,a=Math.pow(2,i),s=[];for(n=0;n<=a;n++){s[n]=[];var l=e.clone().lerp(r,n/a),c=t.clone().lerp(r,n/a),u=a-n;for(o=0;o<=u;o++)s[n][o]=0===o&&n===a?l:l.clone().lerp(c,o/u)}for(n=0;n<a;n++)for(o=0;o<2*(a-n)-1;o++){var h=Math.floor(o/2);o%2==0?(p(s[n][h+1]),p(s[n+1][h]),p(s[n][h])):(p(s[n][h+1]),p(s[n+1][h+1]),p(s[n+1][h]))}}function p(e){u.push(e.x,e.y,e.z)}function s(e,t){var r=3*e;t.x=i[r+0],t.y=i[r+1],t.z=i[r+2]}function d(e,t,r,i){i<0&&1===e.x&&(h[t]=e.x-1),0===r.x&&0===r.z&&(h[t]=i/2/Math.PI+.5)}function f(e){return Math.atan2(e.z,-e.x)}!function(e){for(var t=new Wt,r=new Wt,i=new Wt,n=0;n<o.length;n+=3)s(o[n+0],t),s(o[n+1],r),s(o[n+2],i),a(t,r,i,e)}(t=t||0),function(e){for(var t=new Wt,r=0;r<u.length;r+=3)t.x=u[r+0],t.y=u[r+1],t.z=u[r+2],t.normalize().multiplyScalar(e),u[r+0]=t.x,u[r+1]=t.y,u[r+2]=t.z}(e),function(){for(var e=new Wt,t=0;t<u.length;t+=3){e.x=u[t+0],e.y=u[t+1],e.z=u[t+2];var r=f(e)/2/Math.PI+.5,i=(n=e,Math.atan2(-n.y,Math.sqrt(n.x*n.x+n.z*n.z))/Math.PI+.5);h.push(r,1-i)}var n;(function(){for(var e=new Wt,t=new Wt,r=new Wt,i=new Wt,n=new zt,o=new zt,a=new zt,s=0,l=0;s<u.length;s+=9,l+=6){e.set(u[s+0],u[s+1],u[s+2]),t.set(u[s+3],u[s+4],u[s+5]),r.set(u[s+6],u[s+7],u[s+8]),n.set(h[l+0],h[l+1]),o.set(h[l+2],h[l+3]),a.set(h[l+4],h[l+5]),i.copy(e).add(t).add(r).divideScalar(3);var c=f(i);d(n,l+0,e,c),d(o,l+2,t,c),d(a,l+4,r,c)}})(),function(){for(var e=0;e<h.length;e+=6){var t=h[e+0],r=h[e+2],i=h[e+4],n=Math.max(t,r,i),o=Math.min(t,r,i);.9<n&&o<.1&&(t<.2&&(h[e+0]+=1),r<.2&&(h[e+2]+=1),i<.2&&(h[e+4]+=1))}}()}(),this.addAttribute("position",new wi(u,3)),this.addAttribute("normal",new wi(u.slice(),3)),this.addAttribute("uv",new wi(h,2)),0===t?this.computeVertexNormals():this.normalizeNormals()}function Ka(e,t){fi.call(this),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new $a(e,t)),this.mergeVertices()}function $a(e,t){Za.call(this,[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],e,t),this.type="TetrahedronBufferGeometry",this.parameters={radius:e,detail:t}}function es(e,t){fi.call(this),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new ts(e,t)),this.mergeVertices()}function ts(e,t){Za.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,t),this.type="OctahedronBufferGeometry",this.parameters={radius:e,detail:t}}function rs(e,t){fi.call(this),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new is(e,t)),this.mergeVertices()}function is(e,t){var r=(1+Math.sqrt(5))/2;Za.call(this,[-1,r,0,1,r,0,-1,-r,0,1,-r,0,0,-1,r,0,1,r,0,-1,-r,0,1,-r,r,0,-1,r,0,1,-r,0,-1,-r,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,t),this.type="IcosahedronBufferGeometry",this.parameters={radius:e,detail:t}}function ns(e,t){fi.call(this),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new os(e,t)),this.mergeVertices()}function os(e,t){var r=(1+Math.sqrt(5))/2,i=1/r;Za.call(this,[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-i,-r,0,-i,r,0,i,-r,0,i,r,-i,-r,0,-i,r,0,i,-r,0,i,r,0,-r,0,-i,r,0,-i,-r,0,i,r,0,i],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],e,t),this.type="DodecahedronBufferGeometry",this.parameters={radius:e,detail:t}}function as(e,t,r,i,n,o){fi.call(this),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:r,radialSegments:i,closed:n},void 0!==o&&console.warn("THREE.TubeGeometry: taper has been removed.");var a=new ss(e,t,r,i,n);this.tangents=a.tangents,this.normals=a.normals,this.binormals=a.binormals,this.fromBufferGeometry(a),this.mergeVertices()}function ss(a,s,l,c,e){Ni.call(this),this.type="TubeBufferGeometry",this.parameters={path:a,tubularSegments:s,radius:l,radialSegments:c,closed:e},s=s||64,l=l||1,c=c||8,e=e||!1;var u=a.computeFrenetFrames(s,e);this.tangents=u.tangents,this.normals=u.normals,this.binormals=u.binormals;var n,h,p=new Wt,d=new Wt,t=new zt,f=new Wt,m=[],g=[],r=[],o=[];function i(e){f=a.getPointAt(e/s,f);var t=u.normals[e],r=u.binormals[e];for(h=0;h<=c;h++){var i=h/c*Math.PI*2,n=Math.sin(i),o=-Math.cos(i);d.x=o*t.x+n*r.x,d.y=o*t.y+n*r.y,d.z=o*t.z+n*r.z,d.normalize(),g.push(d.x,d.y,d.z),p.x=f.x+l*d.x,p.y=f.y+l*d.y,p.z=f.z+l*d.z,m.push(p.x,p.y,p.z)}}!function(){for(n=0;n<s;n++)i(n);i(!1===e?s:0),function(){for(n=0;n<=s;n++)for(h=0;h<=c;h++)t.x=n/s,t.y=h/c,r.push(t.x,t.y)}(),function(){for(h=1;h<=s;h++)for(n=1;n<=c;n++){var e=(c+1)*(h-1)+(n-1),t=(c+1)*h+(n-1),r=(c+1)*h+n,i=(c+1)*(h-1)+n;o.push(e,t,i),o.push(t,r,i)}}()}(),this.setIndex(o),this.addAttribute("position",new wi(m,3)),this.addAttribute("normal",new wi(g,3)),this.addAttribute("uv",new wi(r,2))}function ls(e,t,r,i,n,o,a){fi.call(this),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:r,radialSegments:i,p:n,q:o},void 0!==a&&console.warn("THREE.TorusKnotGeometry: heightScale has been deprecated. Use .scale( x, y, z ) instead."),this.fromBufferGeometry(new cs(e,t,r,i,n,o)),this.mergeVertices()}function cs(e,t,r,i,n,o){Ni.call(this),this.type="TorusKnotBufferGeometry",this.parameters={radius:e,tube:t,tubularSegments:r,radialSegments:i,p:n,q:o},e=e||1,t=t||.4,r=Math.floor(r)||64,i=Math.floor(i)||8,n=n||2,o=o||3;var a,s,l=[],c=[],u=[],h=[],p=new Wt,d=new Wt,f=new Wt,m=new Wt,g=new Wt,v=new Wt,y=new Wt;for(a=0;a<=r;++a){var b=a/r*n*Math.PI*2;for(R(b,n,o,e,f),R(b+.01,n,o,e,m),v.subVectors(m,f),y.addVectors(m,f),g.crossVectors(v,y),y.crossVectors(g,v),g.normalize(),y.normalize(),s=0;s<=i;++s){var x=s/i*Math.PI*2,E=-t*Math.cos(x),_=t*Math.sin(x);p.x=f.x+(E*y.x+_*g.x),p.y=f.y+(E*y.y+_*g.y),p.z=f.z+(E*y.z+_*g.z),c.push(p.x,p.y,p.z),d.subVectors(p,f).normalize(),u.push(d.x,d.y,d.z),h.push(a/r),h.push(s/i)}}for(s=1;s<=r;s++)for(a=1;a<=i;a++){var w=(i+1)*(s-1)+(a-1),T=(i+1)*s+(a-1),M=(i+1)*s+a,S=(i+1)*(s-1)+a;l.push(w,T,S),l.push(T,M,S)}function R(e,t,r,i,n){var o=Math.cos(e),a=Math.sin(e),s=r/t*e,l=Math.cos(s);n.x=i*(2+l)*.5*o,n.y=i*(2+l)*a*.5,n.z=i*Math.sin(s)*.5}this.setIndex(l),this.addAttribute("position",new wi(c,3)),this.addAttribute("normal",new wi(u,3)),this.addAttribute("uv",new wi(h,2))}function us(e,t,r,i,n){fi.call(this),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:r,tubularSegments:i,arc:n},this.fromBufferGeometry(new hs(e,t,r,i,n)),this.mergeVertices()}function hs(e,t,r,i,n){Ni.call(this),this.type="TorusBufferGeometry",this.parameters={radius:e,tube:t,radialSegments:r,tubularSegments:i,arc:n},e=e||1,t=t||.4,r=Math.floor(r)||8,i=Math.floor(i)||6,n=n||2*Math.PI;var o,a,s=[],l=[],c=[],u=[],h=new Wt,p=new Wt,d=new Wt;for(o=0;o<=r;o++)for(a=0;a<=i;a++){var f=a/i*n,m=o/r*Math.PI*2;p.x=(e+t*Math.cos(m))*Math.cos(f),p.y=(e+t*Math.cos(m))*Math.sin(f),p.z=t*Math.sin(m),l.push(p.x,p.y,p.z),h.x=e*Math.cos(f),h.y=e*Math.sin(f),d.subVectors(p,h).normalize(),c.push(d.x,d.y,d.z),u.push(a/i),u.push(o/r)}for(o=1;o<=r;o++)for(a=1;a<=i;a++){var g=(i+1)*o+a-1,v=(i+1)*(o-1)+a-1,y=(i+1)*(o-1)+a,b=(i+1)*o+a;s.push(g,v,b),s.push(v,y,b)}this.setIndex(s),this.addAttribute("position",new wi(l,3)),this.addAttribute("normal",new wi(c,3)),this.addAttribute("uv",new wi(u,2))}Sa.prototype.isFogExp2=!0,Sa.prototype.clone=function(){return new Sa(this.color,this.density)},Sa.prototype.toJSON=function(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}},Ra.prototype.isFog=!0,Ra.prototype.clone=function(){return new Ra(this.color,this.near,this.far)},Ra.prototype.toJSON=function(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}},Pa.prototype=Object.assign(Object.create(oi.prototype),{constructor:Pa,isScene:!0,copy:function(e,t){return oi.prototype.copy.call(this,e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.fog&&(this.fog=e.fog.clone()),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this},toJSON:function(e){var t=oi.prototype.toJSON.call(this,e);return null!==this.background&&(t.object.background=this.background.toJSON(e)),null!==this.fog&&(t.object.fog=this.fog.toJSON()),t},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Object.defineProperty(Aa.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(Aa.prototype,{isInterleavedBuffer:!0,onUploadCallback:function(){},setArray:function(e){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");return this.count=void 0!==e?e.length/this.stride:0,this.array=e,this},setDynamic:function(e){return this.dynamic=e,this},copy:function(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.dynamic=e.dynamic,this},copyAt:function(e,t,r){e*=this.stride,r*=t.stride;for(var i=0,n=this.stride;i<n;i++)this.array[e+i]=t.array[r+i];return this},set:function(e,t){return void 0===t&&(t=0),this.array.set(e,t),this},clone:function(){return(new this.constructor).copy(this)},onUpload:function(e){return this.onUploadCallback=e,this}}),Object.defineProperties(Ca.prototype,{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}}}),Object.assign(Ca.prototype,{isInterleavedBufferAttribute:!0,setX:function(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this},setY:function(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this},setZ:function(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this},setW:function(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this},getX:function(e){return this.data.array[e*this.data.stride+this.offset]},getY:function(e){return this.data.array[e*this.data.stride+this.offset+1]},getZ:function(e){return this.data.array[e*this.data.stride+this.offset+2]},getW:function(e){return this.data.array[e*this.data.stride+this.offset+3]},setXY:function(e,t,r){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=r,this},setXYZ:function(e,t,r,i){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=r,this.data.array[e+2]=i,this},setXYZW:function(e,t,r,i,n){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=r,this.data.array[e+2]=i,this.data.array[e+3]=n,this}}),((La.prototype=Object.create(gn.prototype)).constructor=La).prototype.isSpriteMaterial=!0,La.prototype.copy=function(e){return gn.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this},Oa.prototype=Object.assign(Object.create(oi.prototype),{constructor:Oa,isSprite:!0,raycast:function(){var l=new Wt,c=new Wt,u=new Wt,a=new zt,s=new zt,h=new qt,p=new Wt,d=new Wt,f=new Wt,m=new zt,g=new zt,v=new zt;function y(e,t,r,i,n,o){a.subVectors(e,r).addScalar(.5).multiply(i),void 0!==n?(s.x=o*a.x-n*a.y,s.y=n*a.x+o*a.y):s.copy(a),e.copy(t),e.x+=s.x,e.y+=s.y,e.applyMatrix4(h)}return function(e,t){c.setFromMatrixScale(this.matrixWorld),h.getInverse(this.modelViewMatrix).premultiply(this.matrixWorld),u.setFromMatrixPosition(this.modelViewMatrix);var r,i,n=this.material.rotation;0!==n&&(i=Math.cos(n),r=Math.sin(n));var o=this.center;y(p.set(-.5,-.5,0),u,o,c,r,i),y(d.set(.5,-.5,0),u,o,c,r,i),y(f.set(.5,.5,0),u,o,c,r,i),m.set(0,0),g.set(1,0),v.set(1,1);var a=e.ray.intersectTriangle(p,d,f,!1,l);if(null!==a||(y(d.set(-.5,.5,0),u,o,c,r,i),g.set(0,1),null!==(a=e.ray.intersectTriangle(p,f,d,!1,l)))){var s=e.ray.origin.distanceTo(l);s<e.near||s>e.far||t.push({distance:s,point:l.clone(),uv:bn.getUV(l,p,d,f,m,g,v,new zt),face:null,object:this})}}}(),clone:function(){return new this.constructor(this.material).copy(this)},copy:function(e){return oi.prototype.copy.call(this,e),void 0!==e.center&&this.center.copy(e.center),this}}),Ha.prototype=Object.assign(Object.create(oi.prototype),{constructor:Ha,copy:function(e){oi.prototype.copy.call(this,e,!1);for(var t=e.levels,r=0,i=t.length;r<i;r++){var n=t[r];this.addLevel(n.object.clone(),n.distance)}return this},addLevel:function(e,t){void 0===t&&(t=0),t=Math.abs(t);for(var r=this.levels,i=0;i<r.length&&!(t<r[i].distance);i++);r.splice(i,0,{distance:t,object:e}),this.add(e)},getObjectForDistance:function(e){for(var t=this.levels,r=1,i=t.length;r<i&&!(e<t[r].distance);r++);return t[r-1].object},raycast:(aa=new Wt,function(e,t){aa.setFromMatrixPosition(this.matrixWorld);var r=e.ray.origin.distanceTo(aa);this.getObjectForDistance(r).raycast(e,t)}),update:(na=new Wt,oa=new Wt,function(e){var t=this.levels;if(1<t.length){na.setFromMatrixPosition(e.matrixWorld),oa.setFromMatrixPosition(this.matrixWorld);var r=na.distanceTo(oa);t[0].object.visible=!0;for(var i=1,n=t.length;i<n&&r>=t[i].distance;i++)t[i-1].object.visible=!1,t[i].object.visible=!0;for(;i<n;i++)t[i].object.visible=!1}}),toJSON:function(e){var t=oi.prototype.toJSON.call(this,e);t.object.levels=[];for(var r=this.levels,i=0,n=r.length;i<n;i++){var o=r[i];t.object.levels.push({object:o.object.uuid,distance:o.distance})}return t}}),Fa.prototype=Object.assign(Object.create(En.prototype),{constructor:Fa,isSkinnedMesh:!0,bind:function(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.getInverse(t)},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){for(var e=new dr,t=this.geometry.attributes.skinWeight,r=0,i=t.count;r<i;r++){e.x=t.getX(r),e.y=t.getY(r),e.z=t.getZ(r),e.w=t.getW(r);var n=1/e.manhattanLength();n!==1/0?e.multiplyScalar(n):e.set(1,0,0,0),t.setXYZW(r,e.x,e.y,e.z,e.w)}},updateMatrixWorld:function(e){En.prototype.updateMatrixWorld.call(this,e),"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):"detached"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),Object.assign(ka.prototype,{calculateInverses:function(){this.boneInverses=[];for(var e=0,t=this.bones.length;e<t;e++){var r=new qt;this.bones[e]&&r.getInverse(this.bones[e].matrixWorld),this.boneInverses.push(r)}},pose:function(){var e,t,r;for(t=0,r=this.bones.length;t<r;t++)(e=this.bones[t])&&e.matrixWorld.getInverse(this.boneInverses[t]);for(t=0,r=this.bones.length;t<r;t++)(e=this.bones[t])&&(e.parent&&e.parent.isBone?(e.matrix.getInverse(e.parent.matrixWorld),e.matrix.multiply(e.matrixWorld)):e.matrix.copy(e.matrixWorld),e.matrix.decompose(e.position,e.quaternion,e.scale))},update:(sa=new qt,la=new qt,function(e){var t=this.bones,r=this.boneInverses,i=this.boneMatrices,n=this.boneTexture,o=new THREE.Vector3;e.getWorldPosition(o);for(var a=0,s=t.length;a<s;a++){var l=t[a]?t[a].matrixWorld:la;sa.multiplyMatrices(l,r[a]);var c=sa.elements;c[12]-=o.x,c[13]-=o.y,c[14]-=o.z,sa.toArray(i,16*a)}void 0!==n&&(n.needsUpdate=!0)}),clone:function(){return new ka(this.bones,this.boneInverses)},getBoneByName:function(e){for(var t=0,r=this.bones.length;t<r;t++){var i=this.bones[t];if(i.name===e)return i}}}),Ia.prototype=Object.assign(Object.create(oi.prototype),{constructor:Ia,isBone:!0}),((ja.prototype=Object.create(gn.prototype)).constructor=ja).prototype.isLineBasicMaterial=!0,ja.prototype.copy=function(e){return gn.prototype.copy.call(this,e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this},Na.prototype=Object.assign(Object.create(oi.prototype),{constructor:Na,isLine:!0,computeLineDistances:(pa=new Wt,da=new Wt,function(){var e=this.geometry;if(e.isBufferGeometry)if(null===e.index){for(var t=e.attributes.position,r=[0],i=1,n=t.count;i<n;i++)pa.fromBufferAttribute(t,i-1),da.fromBufferAttribute(t,i),r[i]=r[i-1],r[i]+=pa.distanceTo(da);e.addAttribute("lineDistance",new wi(r,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(e.isGeometry){var o=e.vertices;for((r=e.lineDistances)[0]=0,i=1,n=o.length;i<n;i++)r[i]=r[i-1],r[i]+=o[i-1].distanceTo(o[i])}return this}),raycast:(ca=new qt,ua=new yn,ha=new br,function(e,t){var r=e.linePrecision,i=this.geometry,n=this.matrixWorld;if(null===i.boundingSphere&&i.computeBoundingSphere(),ha.copy(i.boundingSphere),ha.applyMatrix4(n),ha.radius+=r,!1!==e.ray.intersectsSphere(ha)){ca.getInverse(n),ua.copy(e.ray).applyMatrix4(ca);var o=r/((this.scale.x+this.scale.y+this.scale.z)/3),a=o*o,s=new Wt,l=new Wt,c=new Wt,u=new Wt,h=this&&this.isLineSegments?2:1;if(i.isBufferGeometry){var p=i.index,d=i.attributes.position.array;if(null!==p)for(var f=p.array,m=0,g=f.length-1;m<g;m+=h){var v=f[m],y=f[m+1];s.fromArray(d,3*v),l.fromArray(d,3*y),a<ua.distanceSqToSegment(s,l,u,c)||(u.applyMatrix4(this.matrixWorld),(E=e.ray.origin.distanceTo(u))<e.near||E>e.far||t.push({distance:E,point:c.clone().applyMatrix4(this.matrixWorld),index:m,face:null,faceIndex:null,object:this}))}else for(m=0,g=d.length/3-1;m<g;m+=h)s.fromArray(d,3*m),l.fromArray(d,3*m+3),a<ua.distanceSqToSegment(s,l,u,c)||(u.applyMatrix4(this.matrixWorld),(E=e.ray.origin.distanceTo(u))<e.near||E>e.far||t.push({distance:E,point:c.clone().applyMatrix4(this.matrixWorld),index:m,face:null,faceIndex:null,object:this}))}else if(i.isGeometry){var b=i.vertices,x=b.length;for(m=0;m<x-1;m+=h){var E;a<ua.distanceSqToSegment(b[m],b[m+1],u,c)||(u.applyMatrix4(this.matrixWorld),(E=e.ray.origin.distanceTo(u))<e.near||E>e.far||t.push({distance:E,point:c.clone().applyMatrix4(this.matrixWorld),index:m,face:null,faceIndex:null,object:this}))}}}}),copy:function(e){return oi.prototype.copy.call(this,e),this.geometry.copy(e.geometry),this.material.copy(e.material),this},clone:function(){return(new this.constructor).copy(this)}}),Da.prototype=Object.assign(Object.create(Na.prototype),{constructor:Da,isLineSegments:!0,computeLineDistances:(fa=new Wt,ma=new Wt,function(){var e=this.geometry;if(e.isBufferGeometry)if(null===e.index){for(var t=e.attributes.position,r=[],i=0,n=t.count;i<n;i+=2)fa.fromBufferAttribute(t,i),ma.fromBufferAttribute(t,i+1),r[i]=0===i?0:r[i-1],r[i+1]=r[i]+fa.distanceTo(ma);e.addAttribute("lineDistance",new wi(r,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(e.isGeometry){var o=e.vertices;for(r=e.lineDistances,i=0,n=o.length;i<n;i+=2)fa.copy(o[i]),ma.copy(o[i+1]),r[i]=0===i?0:r[i-1],r[i+1]=r[i]+fa.distanceTo(ma)}return this})}),Ua.prototype=Object.assign(Object.create(Na.prototype),{constructor:Ua,isLineLoop:!0}),((Va.prototype=Object.create(gn.prototype)).constructor=Va).prototype.isPointsMaterial=!0,Va.prototype.copy=function(e){return gn.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.morphTargets=e.morphTargets,this},Ba.prototype=Object.assign(Object.create(oi.prototype),{constructor:Ba,isPoints:!0,raycast:(ga=new qt,va=new yn,ya=new br,function(n,o){var a=this,e=this.geometry,s=this.matrixWorld,t=n.params.Points.threshold;if(null===e.boundingSphere&&e.computeBoundingSphere(),ya.copy(e.boundingSphere),ya.applyMatrix4(s),ya.radius+=t,!1!==n.ray.intersectsSphere(ya)){ga.getInverse(s),va.copy(n.ray).applyMatrix4(ga);var r=t/((this.scale.x+this.scale.y+this.scale.z)/3),l=r*r,i=new Wt,c=new Wt;if(e.isBufferGeometry){var u=e.index,h=e.attributes.position.array;if(null!==u)for(var p=u.array,d=0,f=p.length;d<f;d++){var m=p[d];i.fromArray(h,3*m),y(i,m)}else{d=0;for(var g=h.length/3;d<g;d++)i.fromArray(h,3*d),y(i,d)}}else{var v=e.vertices;for(d=0,g=v.length;d<g;d++)y(v[d],d)}}function y(e,t){var r=va.distanceSqToPoint(e);if(r<l){va.closestPointToPoint(e,c),c.applyMatrix4(s);var i=n.ray.origin.distanceTo(c);if(i<n.near||i>n.far)return;o.push({distance:i,distanceToRay:Math.sqrt(r),point:c.clone(),index:t,face:null,object:a})}}}),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),za.prototype=Object.assign(Object.create(pr.prototype),{constructor:za,isVideoTexture:!0,update:function(){var e=this.image;e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}),((qa.prototype=Object.create(pr.prototype)).constructor=qa).prototype.isCompressedTexture=!0,((Ga.prototype=Object.create(pr.prototype)).constructor=Ga).prototype.isCanvasTexture=!0,((Wa.prototype=Object.create(pr.prototype)).constructor=Wa).prototype.isDepthTexture=!0,(Xa.prototype=Object.create(Ni.prototype)).constructor=Xa,(Ya.prototype=Object.create(fi.prototype)).constructor=Ya,(Qa.prototype=Object.create(Ni.prototype)).constructor=Qa,(Ja.prototype=Object.create(fi.prototype)).constructor=Ja,(Za.prototype=Object.create(Ni.prototype)).constructor=Za,(Ka.prototype=Object.create(fi.prototype)).constructor=Ka,($a.prototype=Object.create(Za.prototype)).constructor=$a,(es.prototype=Object.create(fi.prototype)).constructor=es,(ts.prototype=Object.create(Za.prototype)).constructor=ts,(rs.prototype=Object.create(fi.prototype)).constructor=rs,(is.prototype=Object.create(Za.prototype)).constructor=is,(ns.prototype=Object.create(fi.prototype)).constructor=ns,(os.prototype=Object.create(Za.prototype)).constructor=os,(as.prototype=Object.create(fi.prototype)).constructor=as,(ss.prototype=Object.create(Ni.prototype)).constructor=ss,(ls.prototype=Object.create(fi.prototype)).constructor=ls,(cs.prototype=Object.create(Ni.prototype)).constructor=cs,(us.prototype=Object.create(fi.prototype)).constructor=us,(hs.prototype=Object.create(Ni.prototype)).constructor=hs;var ps=function(e,t,r){r=r||2;var i,n,o,a,s,l,c,u=t&&t.length,h=u?t[0]*r:e.length,p=ds(e,0,h,r,!0),d=[];if(!p)return d;if(u&&(p=function(e,t,r,i){var n,o,a,s,l,c=[];for(n=0,o=t.length;n<o;n++)a=t[n]*i,s=n<o-1?t[n+1]*i:e.length,(l=ds(e,a,s,i,!1))===l.next&&(l.steiner=!0),c.push(ws(l));for(c.sort(xs),n=0;n<c.length;n++)Es(c[n],r),r=fs(r,r.next);return r}(e,t,p,r)),e.length>80*r){i=o=e[0],n=a=e[1];for(var f=r;f<h;f+=r)(s=e[f])<i&&(i=s),(l=e[f+1])<n&&(n=l),o<s&&(o=s),a<l&&(a=l);c=0!==(c=Math.max(o-i,a-n))?1/c:0}return ms(p,d,r,i,n,c),d};function ds(e,t,r,i,n){var o,a;if(n===0<function(e,t,r,i){for(var n=0,o=t,a=r-i;o<r;o+=i)n+=(e[a]-e[o])*(e[o+1]+e[a+1]),a=o;return n}(e,t,r,i))for(o=t;o<r;o+=i)a=Cs(o,e[o],e[o+1],a);else for(o=r-i;t<=o;o-=i)a=Cs(o,e[o],e[o+1],a);return a&&Ss(a,a.next)&&(Ls(a),a=a.next),a}function fs(e,t){if(!e)return e;t||(t=e);var r,i=e;do{if(r=!1,i.steiner||!Ss(i,i.next)&&0!==Ms(i.prev,i,i.next))i=i.next;else{if(Ls(i),(i=t=i.prev)===i.next)break;r=!0}}while(r||i!==t);return t}function ms(e,t,r,i,n,o,a){if(e){!a&&o&&function(e,t,r,i){var n=e;for(;null===n.z&&(n.z=_s(n.x,n.y,t,r,i)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next,n!==e;);n.prevZ.nextZ=null,n.prevZ=null,function(e){var t,r,i,n,o,a,s,l,c=1;do{for(r=e,o=e=null,a=0;r;){for(a++,i=r,t=s=0;t<c&&(s++,i=i.nextZ);t++);for(l=c;0<s||0<l&&i;)0!==s&&(0===l||!i||r.z<=i.z)?(r=(n=r).nextZ,s--):(i=(n=i).nextZ,l--),o?o.nextZ=n:e=n,n.prevZ=o,o=n;r=i}o.nextZ=null,c*=2}while(1<a)}(n)}(e,i,n,o);for(var s,l,c=e;e.prev!==e.next;)if(s=e.prev,l=e.next,o?vs(e,i,n,o):gs(e))t.push(s.i/r),t.push(e.i/r),t.push(l.i/r),Ls(e),e=l.next,c=l.next;else if((e=l)===c){a?1===a?ms(e=ys(e,t,r),t,r,i,n,o,2):2===a&&bs(e,t,r,i,n,o):ms(fs(e),t,r,i,n,o,1);break}}}function gs(e){var t=e.prev,r=e,i=e.next;if(0<=Ms(t,r,i))return!1;for(var n=e.next.next;n!==e.prev;){if(Ts(t.x,t.y,r.x,r.y,i.x,i.y,n.x,n.y)&&0<=Ms(n.prev,n,n.next))return!1;n=n.next}return!0}function vs(e,t,r,i){var n=e.prev,o=e,a=e.next;if(0<=Ms(n,o,a))return!1;for(var s=n.x<o.x?n.x<a.x?n.x:a.x:o.x<a.x?o.x:a.x,l=n.y<o.y?n.y<a.y?n.y:a.y:o.y<a.y?o.y:a.y,c=n.x>o.x?n.x>a.x?n.x:a.x:o.x>a.x?o.x:a.x,u=n.y>o.y?n.y>a.y?n.y:a.y:o.y>a.y?o.y:a.y,h=_s(s,l,t,r,i),p=_s(c,u,t,r,i),d=e.nextZ;d&&d.z<=p;){if(d!==e.prev&&d!==e.next&&Ts(n.x,n.y,o.x,o.y,a.x,a.y,d.x,d.y)&&0<=Ms(d.prev,d,d.next))return!1;d=d.nextZ}for(d=e.prevZ;d&&d.z>=h;){if(d!==e.prev&&d!==e.next&&Ts(n.x,n.y,o.x,o.y,a.x,a.y,d.x,d.y)&&0<=Ms(d.prev,d,d.next))return!1;d=d.prevZ}return!0}function ys(e,t,r){var i=e;do{var n=i.prev,o=i.next.next;!Ss(n,o)&&Rs(n,i,i.next,o)&&Ps(n,o)&&Ps(o,n)&&(t.push(n.i/r),t.push(i.i/r),t.push(o.i/r),Ls(i),Ls(i.next),i=e=o),i=i.next}while(i!==e);return i}function bs(e,t,r,i,n,o){var a,s,l=e;do{for(var c=l.next.next;c!==l.prev;){if(l.i!==c.i&&(s=c,(a=l).next.i!==s.i&&a.prev.i!==s.i&&!function(e,t){var r=e;do{if(r.i!==e.i&&r.next.i!==e.i&&r.i!==t.i&&r.next.i!==t.i&&Rs(r,r.next,e,t))return!0;r=r.next}while(r!==e);return!1}(a,s)&&Ps(a,s)&&Ps(s,a)&&function(e,t){var r=e,i=!1,n=(e.x+t.x)/2,o=(e.y+t.y)/2;for(;r.y>o!=r.next.y>o&&r.next.y!==r.y&&n<(r.next.x-r.x)*(o-r.y)/(r.next.y-r.y)+r.x&&(i=!i),r=r.next,r!==e;);return i}(a,s))){var u=As(l,c);return l=fs(l,l.next),u=fs(u,u.next),ms(l,t,r,i,n,o),void ms(u,t,r,i,n,o)}c=c.next}l=l.next}while(l!==e)}function xs(e,t){return e.x-t.x}function Es(e,t){if(t=function(e,t){var r,i=t,n=e.x,o=e.y,a=-1/0;do{if(o<=i.y&&o>=i.next.y&&i.next.y!==i.y){var s=i.x+(o-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(s<=n&&a<s){if((a=s)===n){if(o===i.y)return i;if(o===i.next.y)return i.next}r=i.x<i.next.x?i:i.next}}i=i.next}while(i!==t);if(!r)return null;if(n===a)return r.prev;var l,c=r,u=r.x,h=r.y,p=1/0;i=r.next;for(;i!==c;)n>=i.x&&i.x>=u&&n!==i.x&&Ts(o<h?n:a,o,u,h,o<h?a:n,o,i.x,i.y)&&((l=Math.abs(o-i.y)/(n-i.x))<p||l===p&&i.x>r.x)&&Ps(i,e)&&(r=i,p=l),i=i.next;return r}(e,t)){var r=As(t,e);fs(r,r.next)}}function _s(e,t,r,i,n){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*n)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*n)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function ws(e){for(var t=e,r=e;t.x<r.x&&(r=t),(t=t.next)!==e;);return r}function Ts(e,t,r,i,n,o,a,s){return 0<=(n-a)*(t-s)-(e-a)*(o-s)&&0<=(e-a)*(i-s)-(r-a)*(t-s)&&0<=(r-a)*(o-s)-(n-a)*(i-s)}function Ms(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function Ss(e,t){return e.x===t.x&&e.y===t.y}function Rs(e,t,r,i){return!!(Ss(e,t)&&Ss(r,i)||Ss(e,i)&&Ss(r,t))||0<Ms(e,t,r)!=0<Ms(e,t,i)&&0<Ms(r,i,e)!=0<Ms(r,i,t)}function Ps(e,t){return Ms(e.prev,e,e.next)<0?0<=Ms(e,t,e.next)&&0<=Ms(e,e.prev,t):Ms(e,t,e.prev)<0||Ms(e,e.next,t)<0}function As(e,t){var r=new Os(e.i,e.x,e.y),i=new Os(t.i,t.x,t.y),n=e.next,o=t.prev;return(e.next=t).prev=e,(r.next=n).prev=r,(i.next=r).prev=i,(o.next=i).prev=o,i}function Cs(e,t,r,i){var n=new Os(e,t,r);return i?(n.next=i.next,(n.prev=i).next.prev=n,i.next=n):(n.prev=n).next=n,n}function Ls(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Os(e,t,r){this.i=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}var Hs={area:function(e){for(var t=e.length,r=0,i=t-1,n=0;n<t;i=n++)r+=e[i].x*e[n].y-e[n].x*e[i].y;return.5*r},isClockWise:function(e){return Hs.area(e)<0},triangulateShape:function(e,t){var r=[],i=[],n=[];Fs(e),ks(r,e);var o=e.length;t.forEach(Fs);for(var a=0;a<t.length;a++)i.push(o),o+=t[a].length,ks(r,t[a]);var s=ps(r,i);for(a=0;a<s.length;a+=3)n.push(s.slice(a,a+3));return n}};function Fs(e){var t=e.length;2<t&&e[t-1].equals(e[0])&&e.pop()}function ks(e,t){for(var r=0;r<t.length;r++)e.push(t[r].x),e.push(t[r].y)}function Is(e,t){fi.call(this),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},this.fromBufferGeometry(new js(e,t)),this.mergeVertices()}function js(e,J){Ni.call(this),this.type="ExtrudeBufferGeometry",this.parameters={shapes:e,options:J},e=Array.isArray(e)?e:[e];for(var Z=this,K=[],$=[],t=0,r=e.length;t<r;t++){i(e[t])}function i(e){var i=[],t=void 0!==J.curveSegments?J.curveSegments:12,l=void 0!==J.steps?J.steps:1,r=void 0!==J.depth?J.depth:100,n=void 0===J.bevelEnabled||J.bevelEnabled,o=void 0!==J.bevelThickness?J.bevelThickness:6,a=void 0!==J.bevelSize?J.bevelSize:o-2,c=void 0!==J.bevelSegments?J.bevelSegments:3,s=J.extrudePath,u=void 0!==J.UVGenerator?J.UVGenerator:Ns;void 0!==J.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),r=J.amount);var h,p,d,f,m,g,v,y,b=!1;s&&(h=s.getSpacedPoints(l),n=!(b=!0),p=s.computeFrenetFrames(l,!1),d=new Wt,f=new Wt,m=new Wt),n||(a=o=c=0);var x=e.extractPoints(t),E=x.shape,_=x.holes;if(!Hs.isClockWise(E))for(E=E.reverse(),v=0,y=_.length;v<y;v++)g=_[v],Hs.isClockWise(g)&&(_[v]=g.reverse());var w=Hs.triangulateShape(E,_),T=E;for(v=0,y=_.length;v<y;v++)g=_[v],E=E.concat(g);function M(e,t,r){return t||console.error("THREE.ExtrudeGeometry: vec does not exist"),t.clone().multiplyScalar(r).add(e)}var S,R,P,A,C,L,O=E.length,H=w.length;function F(e,t,r){var i,n,o,a=e.x-t.x,s=e.y-t.y,l=r.x-e.x,c=r.y-e.y,u=a*a+s*s,h=a*c-s*l;if(Math.abs(h)>Number.EPSILON){var p=Math.sqrt(u),d=Math.sqrt(l*l+c*c),f=t.x-s/p,m=t.y+a/p,g=((r.x-c/d-f)*c-(r.y+l/d-m)*l)/(a*c-s*l),v=(i=f+a*g-e.x)*i+(n=m+s*g-e.y)*n;if(v<=2)return new zt(i,n);o=Math.sqrt(v/2)}else{var y=!1;a>Number.EPSILON?l>Number.EPSILON&&(y=!0):a<-Number.EPSILON?l<-Number.EPSILON&&(y=!0):Math.sign(s)===Math.sign(c)&&(y=!0),o=y?(i=-s,n=a,Math.sqrt(u)):(i=a,n=s,Math.sqrt(u/2))}return new zt(i/o,n/o)}for(var k=[],I=0,j=T.length,N=j-1,D=I+1;I<j;I++,N++,D++)N===j&&(N=0),D===j&&(D=0),k[I]=F(T[I],T[N],T[D]);var U,V,B=[],z=k.concat();for(v=0,y=_.length;v<y;v++){for(g=_[v],U=[],I=0,N=(j=g.length)-1,D=I+1;I<j;I++,N++,D++)N===j&&(N=0),D===j&&(D=0),U[I]=F(g[I],g[N],g[D]);B.push(U),z=z.concat(U)}for(S=0;S<c;S++){for(P=S/c,A=o*Math.cos(P*Math.PI/2),R=a*Math.sin(P*Math.PI/2),I=0,j=T.length;I<j;I++)G((C=M(T[I],k[I],R)).x,C.y,-A);for(v=0,y=_.length;v<y;v++)for(g=_[v],U=B[v],I=0,j=g.length;I<j;I++)G((C=M(g[I],U[I],R)).x,C.y,-A)}for(R=a,I=0;I<O;I++)C=n?M(E[I],z[I],R):E[I],b?(f.copy(p.normals[0]).multiplyScalar(C.x),d.copy(p.binormals[0]).multiplyScalar(C.y),m.copy(h[0]).add(f).add(d),G(m.x,m.y,m.z)):G(C.x,C.y,0);for(V=1;V<=l;V++)for(I=0;I<O;I++)C=n?M(E[I],z[I],R):E[I],b?(f.copy(p.normals[V]).multiplyScalar(C.x),d.copy(p.binormals[V]).multiplyScalar(C.y),m.copy(h[V]).add(f).add(d),G(m.x,m.y,m.z)):G(C.x,C.y,r/l*V);for(S=c-1;0<=S;S--){for(P=S/c,A=o*Math.cos(P*Math.PI/2),R=a*Math.sin(P*Math.PI/2),I=0,j=T.length;I<j;I++)G((C=M(T[I],k[I],R)).x,C.y,r+A);for(v=0,y=_.length;v<y;v++)for(g=_[v],U=B[v],I=0,j=g.length;I<j;I++)C=M(g[I],U[I],R),b?G(C.x,C.y+h[l-1].y,h[l-1].x+A):G(C.x,C.y,r+A)}function q(e,t){var r,i;for(I=e.length;0<=--I;){(i=(r=I)-1)<0&&(i=e.length-1);var n=0,o=l+2*c;for(n=0;n<o;n++){var a=O*n,s=O*(n+1);X(t+r+a,t+i+a,t+i+s,t+r+s)}}}function G(e,t,r){i.push(e),i.push(t),i.push(r)}function W(e,t,r){Y(e),Y(t),Y(r);var i=K.length/3,n=u.generateTopUV(Z,K,i-3,i-2,i-1);Q(n[0]),Q(n[1]),Q(n[2])}function X(e,t,r,i){Y(e),Y(t),Y(i),Y(t),Y(r),Y(i);var n=K.length/3,o=u.generateSideWallUV(Z,K,n-6,n-3,n-2,n-1);Q(o[0]),Q(o[1]),Q(o[3]),Q(o[1]),Q(o[2]),Q(o[3])}function Y(e){K.push(i[3*e+0]),K.push(i[3*e+1]),K.push(i[3*e+2])}function Q(e){$.push(e.x),$.push(e.y)}!function(){var e=K.length/3;if(n){var t=0,r=O*t;for(I=0;I<H;I++)W((L=w[I])[2]+r,L[1]+r,L[0]+r);for(r=O*(t=l+2*c),I=0;I<H;I++)W((L=w[I])[0]+r,L[1]+r,L[2]+r)}else{for(I=0;I<H;I++)W((L=w[I])[2],L[1],L[0]);for(I=0;I<H;I++)W((L=w[I])[0]+O*l,L[1]+O*l,L[2]+O*l)}Z.addGroup(e,K.length/3-e,0)}(),function(){var e=K.length/3,t=0;for(q(T,t),t+=T.length,v=0,y=_.length;v<y;v++)q(g=_[v],t),t+=g.length;Z.addGroup(e,K.length/3-e,1)}()}this.addAttribute("position",new wi(K,3)),this.addAttribute("uv",new wi($,2)),this.computeVertexNormals()}((Is.prototype=Object.create(fi.prototype)).constructor=Is).prototype.toJSON=function(){var e=fi.prototype.toJSON.call(this);return Ds(this.parameters.shapes,this.parameters.options,e)},((js.prototype=Object.create(Ni.prototype)).constructor=js).prototype.toJSON=function(){var e=Ni.prototype.toJSON.call(this);return Ds(this.parameters.shapes,this.parameters.options,e)};var Ns={generateTopUV:function(e,t,r,i,n){var o=t[3*r],a=t[3*r+1],s=t[3*i],l=t[3*i+1],c=t[3*n],u=t[3*n+1];return[new zt(o,a),new zt(s,l),new zt(c,u)]},generateSideWallUV:function(e,t,r,i,n,o){var a=t[3*r],s=t[3*r+1],l=t[3*r+2],c=t[3*i],u=t[3*i+1],h=t[3*i+2],p=t[3*n],d=t[3*n+1],f=t[3*n+2],m=t[3*o],g=t[3*o+1],v=t[3*o+2];return Math.abs(s-u)<.01?[new zt(a,1-l),new zt(c,1-h),new zt(p,1-f),new zt(m,1-v)]:[new zt(s,1-l),new zt(u,1-h),new zt(d,1-f),new zt(g,1-v)]}};function Ds(e,t,r){if(r.shapes=[],Array.isArray(e))for(var i=0,n=e.length;i<n;i++){var o=e[i];r.shapes.push(o.uuid)}else r.shapes.push(e.uuid);return void 0!==t.extrudePath&&(r.options.extrudePath=t.extrudePath.toJSON()),r}function Us(e,t){fi.call(this),this.type="TextGeometry",this.parameters={text:e,parameters:t},this.fromBufferGeometry(new Vs(e,t)),this.mergeVertices()}function Vs(e,t){var r=(t=t||{}).font;if(!r||!r.isFont)return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),new fi;var i=r.generateShapes(e,t.size);t.depth=void 0!==t.height?t.height:50,void 0===t.bevelThickness&&(t.bevelThickness=10),void 0===t.bevelSize&&(t.bevelSize=8),void 0===t.bevelEnabled&&(t.bevelEnabled=!1),js.call(this,i,t),this.type="TextBufferGeometry"}function Bs(e,t,r,i,n,o,a){fi.call(this),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:r,phiStart:i,phiLength:n,thetaStart:o,thetaLength:a},this.fromBufferGeometry(new zs(e,t,r,i,n,o,a)),this.mergeVertices()}function zs(e,t,r,i,n,o,a){Ni.call(this),this.type="SphereBufferGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:r,phiStart:i,phiLength:n,thetaStart:o,thetaLength:a},e=e||1,t=Math.max(3,Math.floor(t)||8),r=Math.max(2,Math.floor(r)||6),i=void 0!==i?i:0,n=void 0!==n?n:2*Math.PI;var s,l,c=(o=void 0!==o?o:0)+(a=void 0!==a?a:Math.PI),u=0,h=[],p=new Wt,d=new Wt,f=[],m=[],g=[],v=[];for(l=0;l<=r;l++){var y=[],b=l/r;for(s=0;s<=t;s++){var x=s/t;p.x=-e*Math.cos(i+x*n)*Math.sin(o+b*a),p.y=e*Math.cos(o+b*a),p.z=e*Math.sin(i+x*n)*Math.sin(o+b*a),m.push(p.x,p.y,p.z),d.set(p.x,p.y,p.z).normalize(),g.push(d.x,d.y,d.z),v.push(x,1-b),y.push(u++)}h.push(y)}for(l=0;l<r;l++)for(s=0;s<t;s++){var E=h[l][s+1],_=h[l][s],w=h[l+1][s],T=h[l+1][s+1];(0!==l||0<o)&&f.push(E,_,T),(l!==r-1||c<Math.PI)&&f.push(_,w,T)}this.setIndex(f),this.addAttribute("position",new wi(m,3)),this.addAttribute("normal",new wi(g,3)),this.addAttribute("uv",new wi(v,2))}function qs(e,t,r,i,n,o){fi.call(this),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:r,phiSegments:i,thetaStart:n,thetaLength:o},this.fromBufferGeometry(new Gs(e,t,r,i,n,o)),this.mergeVertices()}function Gs(e,t,r,i,n,o){Ni.call(this),this.type="RingBufferGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:r,phiSegments:i,thetaStart:n,thetaLength:o},e=e||.5,t=t||1,n=void 0!==n?n:0,o=void 0!==o?o:2*Math.PI,r=void 0!==r?Math.max(3,r):8;var a,s,l,c=[],u=[],h=[],p=[],d=e,f=(t-e)/(i=void 0!==i?Math.max(1,i):1),m=new Wt,g=new zt;for(s=0;s<=i;s++){for(l=0;l<=r;l++)a=n+l/r*o,m.x=d*Math.cos(a),m.y=d*Math.sin(a),u.push(m.x,m.y,m.z),h.push(0,0,1),g.x=(m.x/t+1)/2,g.y=(m.y/t+1)/2,p.push(g.x,g.y);d+=f}for(s=0;s<i;s++){var v=s*(r+1);for(l=0;l<r;l++){var y=a=l+v,b=a+r+1,x=a+r+2,E=a+1;c.push(y,b,E),c.push(b,x,E)}}this.setIndex(c),this.addAttribute("position",new wi(u,3)),this.addAttribute("normal",new wi(h,3)),this.addAttribute("uv",new wi(p,2))}function Ws(e,t,r,i){fi.call(this),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:r,phiLength:i},this.fromBufferGeometry(new Xs(e,t,r,i)),this.mergeVertices()}function Xs(e,t,r,i){Ni.call(this),this.type="LatheBufferGeometry",this.parameters={points:e,segments:t,phiStart:r,phiLength:i},t=Math.floor(t)||12,r=r||0,i=i||2*Math.PI,i=Bt.clamp(i,0,2*Math.PI);var n,o,a,s=[],l=[],c=[],u=1/t,h=new Wt,p=new zt;for(o=0;o<=t;o++){var d=r+o*u*i,f=Math.sin(d),m=Math.cos(d);for(a=0;a<=e.length-1;a++)h.x=e[a].x*f,h.y=e[a].y,h.z=e[a].x*m,l.push(h.x,h.y,h.z),p.x=o/t,p.y=a/(e.length-1),c.push(p.x,p.y)}for(o=0;o<t;o++)for(a=0;a<e.length-1;a++){var g=n=a+o*e.length,v=n+e.length,y=n+e.length+1,b=n+1;s.push(g,v,b),s.push(v,y,b)}if(this.setIndex(s),this.addAttribute("position",new wi(l,3)),this.addAttribute("uv",new wi(c,2)),this.computeVertexNormals(),i===2*Math.PI){var x=this.attributes.normal.array,E=new Wt,_=new Wt,w=new Wt;for(n=t*e.length*3,a=o=0;o<e.length;o++,a+=3)E.x=x[a+0],E.y=x[a+1],E.z=x[a+2],_.x=x[n+a+0],_.y=x[n+a+1],_.z=x[n+a+2],w.addVectors(E,_).normalize(),x[a+0]=x[n+a+0]=w.x,x[a+1]=x[n+a+1]=w.y,x[a+2]=x[n+a+2]=w.z}}function Ys(e,t){fi.call(this),this.type="ShapeGeometry","object"==typeof t&&(console.warn("THREE.ShapeGeometry: Options parameter has been removed."),t=t.curveSegments),this.parameters={shapes:e,curveSegments:t},this.fromBufferGeometry(new Qs(e,t)),this.mergeVertices()}function Qs(e,f){Ni.call(this),this.type="ShapeBufferGeometry",this.parameters={shapes:e,curveSegments:f},f=f||12;var m=[],g=[],v=[],y=[],t=0,b=0;if(!1===Array.isArray(e))i(e);else for(var r=0;r<e.length;r++)i(e[r]),this.addGroup(t,b,r),t+=b,b=0;function i(e){var t,r,i,n=g.length/3,o=e.extractPoints(f),a=o.shape,s=o.holes;for(!1===Hs.isClockWise(a)&&(a=a.reverse()),t=0,r=s.length;t<r;t++)i=s[t],!0===Hs.isClockWise(i)&&(s[t]=i.reverse());var l=Hs.triangulateShape(a,s);for(t=0,r=s.length;t<r;t++)i=s[t],a=a.concat(i);for(t=0,r=a.length;t<r;t++){var c=a[t];g.push(c.x,c.y,0),v.push(0,0,1),y.push(c.x,c.y)}for(t=0,r=l.length;t<r;t++){var u=l[t],h=u[0]+n,p=u[1]+n,d=u[2]+n;m.push(h,p,d),b+=3}}this.setIndex(m),this.addAttribute("position",new wi(g,3)),this.addAttribute("normal",new wi(v,3)),this.addAttribute("uv",new wi(y,2))}function Js(e,t){if(t.shapes=[],Array.isArray(e))for(var r=0,i=e.length;r<i;r++){var n=e[r];t.shapes.push(n.uuid)}else t.shapes.push(e.uuid);return t}function Zs(e,t){Ni.call(this),this.type="EdgesGeometry",this.parameters={thresholdAngle:t},t=void 0!==t?t:1;var r,i,n,o,a=[],s=Math.cos(Bt.DEG2RAD*t),l=[0,0],c={},u=["a","b","c"];e.isBufferGeometry?(o=new fi).fromBufferGeometry(e):o=e.clone(),o.mergeVertices(),o.computeFaceNormals();for(var h=o.vertices,p=o.faces,d=0,f=p.length;d<f;d++)for(var m=p[d],g=0;g<3;g++)r=m[u[g]],i=m[u[(g+1)%3]],l[0]=Math.min(r,i),l[1]=Math.max(r,i),void 0===c[n=l[0]+","+l[1]]?c[n]={index1:l[0],index2:l[1],face1:d,face2:void 0}:c[n].face2=d;for(n in c){var v=c[n];if(void 0===v.face2||p[v.face1].normal.dot(p[v.face2].normal)<=s){var y=h[v.index1];a.push(y.x,y.y,y.z),y=h[v.index2],a.push(y.x,y.y,y.z)}}this.addAttribute("position",new wi(a,3))}function Ks(e,t,r,i,n,o,a,s){fi.call(this),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:r,radialSegments:i,heightSegments:n,openEnded:o,thetaStart:a,thetaLength:s},this.fromBufferGeometry(new $s(e,t,r,i,n,o,a,s)),this.mergeVertices()}function $s(v,y,b,x,E,e,_,w){Ni.call(this),this.type="CylinderBufferGeometry",this.parameters={radiusTop:v,radiusBottom:y,height:b,radialSegments:x,heightSegments:E,openEnded:e,thetaStart:_,thetaLength:w};var T=this;v=void 0!==v?v:1,y=void 0!==y?y:1,b=b||1,x=Math.floor(x)||8,E=Math.floor(E)||1,e=void 0!==e&&e,_=void 0!==_?_:0,w=void 0!==w?w:2*Math.PI;var M=[],S=[],R=[],P=[],A=0,C=[],L=b/2,O=0;function t(e){var t,r,i,n=new zt,o=new Wt,a=0,s=!0===e?v:y,l=!0===e?1:-1;for(r=A,t=1;t<=x;t++)S.push(0,L*l,0),R.push(0,l,0),P.push(.5,.5),A++;for(i=A,t=0;t<=x;t++){var c=t/x*w+_,u=Math.cos(c),h=Math.sin(c);o.x=s*h,o.y=L*l,o.z=s*u,S.push(o.x,o.y,o.z),R.push(0,l,0),n.x=.5*u+.5,n.y=.5*h*l+.5,P.push(n.x,n.y),A++}for(t=0;t<x;t++){var p=r+t,d=i+t;!0===e?M.push(d,d+1,p):M.push(d+1,d,p),a+=3}T.addGroup(O,a,!0===e?1:2),O+=a}!function(){var e,t,r=new Wt,i=new Wt,n=0,o=(y-v)/b;for(t=0;t<=E;t++){var a=[],s=t/E,l=s*(y-v)+v;for(e=0;e<=x;e++){var c=e/x,u=c*w+_,h=Math.sin(u),p=Math.cos(u);i.x=l*h,i.y=-s*b+L,i.z=l*p,S.push(i.x,i.y,i.z),r.set(h,o,p).normalize(),R.push(r.x,r.y,r.z),P.push(c,1-s),a.push(A++)}C.push(a)}for(e=0;e<x;e++)for(t=0;t<E;t++){var d=C[t][e],f=C[t+1][e],m=C[t+1][e+1],g=C[t][e+1];M.push(d,f,g),M.push(f,m,g),n+=6}T.addGroup(O,n,0),O+=n}(),!1===e&&(0<v&&t(!0),0<y&&t(!1)),this.setIndex(M),this.addAttribute("position",new wi(S,3)),this.addAttribute("normal",new wi(R,3)),this.addAttribute("uv",new wi(P,2))}function el(e,t,r,i,n,o,a){Ks.call(this,0,e,t,r,i,n,o,a),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:r,heightSegments:i,openEnded:n,thetaStart:o,thetaLength:a}}function tl(e,t,r,i,n,o,a){$s.call(this,0,e,t,r,i,n,o,a),this.type="ConeBufferGeometry",this.parameters={radius:e,height:t,radialSegments:r,heightSegments:i,openEnded:n,thetaStart:o,thetaLength:a}}function rl(e,t,r,i){fi.call(this),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:r,thetaLength:i},this.fromBufferGeometry(new il(e,t,r,i)),this.mergeVertices()}function il(e,t,r,i){Ni.call(this),this.type="CircleBufferGeometry",this.parameters={radius:e,segments:t,thetaStart:r,thetaLength:i},e=e||1,t=void 0!==t?Math.max(3,t):8,r=void 0!==r?r:0,i=void 0!==i?i:2*Math.PI;var n,o,a=[],s=[],l=[],c=[],u=new Wt,h=new zt;for(s.push(0,0,0),l.push(0,0,1),c.push(.5,.5),o=0,n=3;o<=t;o++,n+=3){var p=r+o/t*i;u.x=e*Math.cos(p),u.y=e*Math.sin(p),s.push(u.x,u.y,u.z),l.push(0,0,1),h.x=(s[n]/e+1)/2,h.y=(s[n+1]/e+1)/2,c.push(h.x,h.y)}for(n=1;n<=t;n++)a.push(n,n+1,0);this.setIndex(a),this.addAttribute("position",new wi(s,3)),this.addAttribute("normal",new wi(l,3)),this.addAttribute("uv",new wi(c,2))}(Us.prototype=Object.create(fi.prototype)).constructor=Us,(Vs.prototype=Object.create(js.prototype)).constructor=Vs,(Bs.prototype=Object.create(fi.prototype)).constructor=Bs,(zs.prototype=Object.create(Ni.prototype)).constructor=zs,(qs.prototype=Object.create(fi.prototype)).constructor=qs,(Gs.prototype=Object.create(Ni.prototype)).constructor=Gs,(Ws.prototype=Object.create(fi.prototype)).constructor=Ws,(Xs.prototype=Object.create(Ni.prototype)).constructor=Xs,((Ys.prototype=Object.create(fi.prototype)).constructor=Ys).prototype.toJSON=function(){var e=fi.prototype.toJSON.call(this);return Js(this.parameters.shapes,e)},((Qs.prototype=Object.create(Ni.prototype)).constructor=Qs).prototype.toJSON=function(){var e=Ni.prototype.toJSON.call(this);return Js(this.parameters.shapes,e)},(Zs.prototype=Object.create(Ni.prototype)).constructor=Zs,(Ks.prototype=Object.create(fi.prototype)).constructor=Ks,($s.prototype=Object.create(Ni.prototype)).constructor=$s,(el.prototype=Object.create(Ks.prototype)).constructor=el,(tl.prototype=Object.create($s.prototype)).constructor=tl,(rl.prototype=Object.create(fi.prototype)).constructor=rl,(il.prototype=Object.create(Ni.prototype)).constructor=il;var nl=Object.freeze({WireframeGeometry:Xa,ParametricGeometry:Ya,ParametricBufferGeometry:Qa,TetrahedronGeometry:Ka,TetrahedronBufferGeometry:$a,OctahedronGeometry:es,OctahedronBufferGeometry:ts,IcosahedronGeometry:rs,IcosahedronBufferGeometry:is,DodecahedronGeometry:ns,DodecahedronBufferGeometry:os,PolyhedronGeometry:Ja,PolyhedronBufferGeometry:Za,TubeGeometry:as,TubeBufferGeometry:ss,TorusKnotGeometry:ls,TorusKnotBufferGeometry:cs,TorusGeometry:us,TorusBufferGeometry:hs,TextGeometry:Us,TextBufferGeometry:Vs,SphereGeometry:Bs,SphereBufferGeometry:zs,RingGeometry:qs,RingBufferGeometry:Gs,PlaneGeometry:Vi,PlaneBufferGeometry:Bi,LatheGeometry:Ws,LatheBufferGeometry:Xs,ShapeGeometry:Ys,ShapeBufferGeometry:Qs,ExtrudeGeometry:Is,ExtrudeBufferGeometry:js,EdgesGeometry:Zs,ConeGeometry:el,ConeBufferGeometry:tl,CylinderGeometry:Ks,CylinderBufferGeometry:$s,CircleGeometry:rl,CircleBufferGeometry:il,BoxGeometry:Di,BoxBufferGeometry:Ui});function ol(e){gn.call(this),this.type="ShadowMaterial",this.color=new Cr(0),this.transparent=!0,this.setValues(e)}function al(e){vn.call(this,e),this.type="RawShaderMaterial"}function sl(e){gn.call(this),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Cr(16777215),this.roughness=.5,this.metalness=.5,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Cr(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Ut,this.normalScale=new zt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function ll(e){sl.call(this),this.defines={PHYSICAL:""},this.type="MeshPhysicalMaterial",this.reflectivity=.5,this.clearCoat=0,this.clearCoatRoughness=0,this.setValues(e)}function cl(e){gn.call(this),this.type="MeshPhongMaterial",this.color=new Cr(16777215),this.specular=new Cr(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Cr(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Ut,this.normalScale=new zt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=q,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function ul(e){cl.call(this),this.defines={TOON:""},this.type="MeshToonMaterial",this.gradientMap=null,this.setValues(e)}function hl(e){gn.call(this),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Ut,this.normalScale=new zt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function pl(e){gn.call(this),this.type="MeshLambertMaterial",this.color=new Cr(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Cr(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=q,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function dl(e){gn.call(this),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Cr(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Ut,this.normalScale=new zt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.lights=!1,this.setValues(e)}function fl(e){ja.call(this),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}((ol.prototype=Object.create(gn.prototype)).constructor=ol).prototype.isShadowMaterial=!0,ol.prototype.copy=function(e){return gn.prototype.copy.call(this,e),this.color.copy(e.color),this},((al.prototype=Object.create(vn.prototype)).constructor=al).prototype.isRawShaderMaterial=!0,((sl.prototype=Object.create(gn.prototype)).constructor=sl).prototype.isMeshStandardMaterial=!0,sl.prototype.copy=function(e){return gn.prototype.copy.call(this,e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},((ll.prototype=Object.create(sl.prototype)).constructor=ll).prototype.isMeshPhysicalMaterial=!0,ll.prototype.copy=function(e){return sl.prototype.copy.call(this,e),this.defines={PHYSICAL:""},this.reflectivity=e.reflectivity,this.clearCoat=e.clearCoat,this.clearCoatRoughness=e.clearCoatRoughness,this},((cl.prototype=Object.create(gn.prototype)).constructor=cl).prototype.isMeshPhongMaterial=!0,cl.prototype.copy=function(e){return gn.prototype.copy.call(this,e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},((ul.prototype=Object.create(cl.prototype)).constructor=ul).prototype.isMeshToonMaterial=!0,ul.prototype.copy=function(e){return cl.prototype.copy.call(this,e),this.gradientMap=e.gradientMap,this},((hl.prototype=Object.create(gn.prototype)).constructor=hl).prototype.isMeshNormalMaterial=!0,hl.prototype.copy=function(e){return gn.prototype.copy.call(this,e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},((pl.prototype=Object.create(gn.prototype)).constructor=pl).prototype.isMeshLambertMaterial=!0,pl.prototype.copy=function(e){return gn.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},((dl.prototype=Object.create(gn.prototype)).constructor=dl).prototype.isMeshMatcapMaterial=!0,dl.prototype.copy=function(e){return gn.prototype.copy.call(this,e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},((fl.prototype=Object.create(ja.prototype)).constructor=fl).prototype.isLineDashedMaterial=!0,fl.prototype.copy=function(e){return ja.prototype.copy.call(this,e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this};var ml=Object.freeze({ShadowMaterial:ol,SpriteMaterial:La,RawShaderMaterial:al,ShaderMaterial:vn,PointsMaterial:Va,MeshPhysicalMaterial:ll,MeshStandardMaterial:sl,MeshPhongMaterial:cl,MeshToonMaterial:ul,MeshNormalMaterial:hl,MeshLambertMaterial:pl,MeshDepthMaterial:Xo,MeshDistanceMaterial:Yo,MeshBasicMaterial:xn,MeshMatcapMaterial:dl,LineDashedMaterial:fl,LineBasicMaterial:ja,Material:gn}),gl={arraySlice:function(e,t,r){return gl.isTypedArray(e)?new e.constructor(e.subarray(t,void 0!==r?r:e.length)):e.slice(t,r)},convertArray:function(e,t,r){return!e||!r&&e.constructor===t?e:"number"==typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)},isTypedArray:function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)},getKeyframeOrder:function(r){for(var e=r.length,t=new Array(e),i=0;i!==e;++i)t[i]=i;return t.sort(function(e,t){return r[e]-r[t]}),t},sortedArray:function(e,t,r){for(var i=e.length,n=new e.constructor(i),o=0,a=0;a!==i;++o)for(var s=r[o]*t,l=0;l!==t;++l)n[a++]=e[s+l];return n},flattenJSON:function(e,t,r,i){for(var n=1,o=e[0];void 0!==o&&void 0===o[i];)o=e[n++];if(void 0!==o){var a=o[i];if(void 0!==a)if(Array.isArray(a))for(;void 0!==(a=o[i])&&(t.push(o.time),r.push.apply(r,a)),void 0!==(o=e[n++]););else if(void 0!==a.toArray)for(;void 0!==(a=o[i])&&(t.push(o.time),a.toArray(r,r.length)),void 0!==(o=e[n++]););else for(;void 0!==(a=o[i])&&(t.push(o.time),r.push(a)),void 0!==(o=e[n++]););}}};function vl(e,t,r,i){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==i?i:new t.constructor(r),this.sampleValues=t,this.valueSize=r}function yl(e,t,r,i){vl.call(this,e,t,r,i),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0}function bl(e,t,r,i){vl.call(this,e,t,r,i)}function xl(e,t,r,i){vl.call(this,e,t,r,i)}function El(e,t,r,i){if(void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=gl.convertArray(t,this.TimeBufferType),this.values=gl.convertArray(r,this.ValueBufferType),this.setInterpolation(i||this.DefaultInterpolation)}function _l(e,t,r){El.call(this,e,t,r)}function wl(e,t,r,i){El.call(this,e,t,r,i)}function Tl(e,t,r,i){El.call(this,e,t,r,i)}function Ml(e,t,r,i){vl.call(this,e,t,r,i)}function Sl(e,t,r,i){El.call(this,e,t,r,i)}function Rl(e,t,r,i){El.call(this,e,t,r,i)}function Pl(e,t,r,i){El.call(this,e,t,r,i)}function Al(e,t,r){this.name=e,this.tracks=r,this.duration=void 0!==t?t:-1,this.uuid=Bt.generateUUID(),this.duration<0&&this.resetDuration()}function Cl(e){if(void 0===e.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");var t=function(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Tl;case"vector":case"vector2":case"vector3":case"vector4":return Pl;case"color":return wl;case"quaternion":return Sl;case"bool":case"boolean":return _l;case"string":return Rl}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}(e.type);if(void 0===e.times){var r=[],i=[];gl.flattenJSON(e.keys,r,i,"value"),e.times=r,e.values=i}return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}Object.assign(vl.prototype,{evaluate:function(e){var t=this.parameterPositions,r=this._cachedIndex,i=t[r],n=t[r-1];e:{t:{var o;r:{i:if(!(e<i)){for(var a=r+2;;){if(void 0===i){if(e<n)break i;return r=t.length,this._cachedIndex=r,this.afterEnd_(r-1,e,n)}if(r===a)break;if(n=i,e<(i=t[++r]))break t}o=t.length;break r}if(n<=e)break e;var s=t[1];e<s&&(r=2,n=s);for(a=r-2;;){if(void 0===n)return this._cachedIndex=0,this.beforeStart_(0,e,i);if(r===a)break;if(i=n,(n=t[--r-1])<=e)break t}o=r,r=0}for(;r<o;){var l=r+o>>>1;e<t[l]?o=l:r=l+1}if(i=t[r],void 0===(n=t[r-1]))return this._cachedIndex=0,this.beforeStart_(0,e,i);if(void 0===i)return r=t.length,this._cachedIndex=r,this.afterEnd_(r-1,n,e)}this._cachedIndex=r,this.intervalChanged_(r,n,i)}return this.interpolate_(r,n,e,i)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(e){for(var t=this.resultBuffer,r=this.sampleValues,i=this.valueSize,n=e*i,o=0;o!==i;++o)t[o]=r[n+o];return t},interpolate_:function(){throw new Error("call to abstract method")},intervalChanged_:function(){}}),Object.assign(vl.prototype,{beforeStart_:vl.prototype.copySampleValue_,afterEnd_:vl.prototype.copySampleValue_}),yl.prototype=Object.assign(Object.create(vl.prototype),{constructor:yl,DefaultSettings_:{endingStart:Rt,endingEnd:Rt},intervalChanged_:function(e,t,r){var i=this.parameterPositions,n=e-2,o=e+1,a=i[n],s=i[o];if(void 0===a)switch(this.getSettings_().endingStart){case Pt:n=e,a=2*t-r;break;case At:a=t+i[n=i.length-2]-i[n+1];break;default:n=e,a=r}if(void 0===s)switch(this.getSettings_().endingEnd){case Pt:o=e,s=2*r-t;break;case At:s=r+i[o=1]-i[0];break;default:o=e-1,s=t}var l=.5*(r-t),c=this.valueSize;this._weightPrev=l/(t-a),this._weightNext=l/(s-r),this._offsetPrev=n*c,this._offsetNext=o*c},interpolate_:function(e,t,r,i){for(var n=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=e*a,l=s-a,c=this._offsetPrev,u=this._offsetNext,h=this._weightPrev,p=this._weightNext,d=(r-t)/(i-t),f=d*d,m=f*d,g=-h*m+2*h*f-h*d,v=(1+h)*m+(-1.5-2*h)*f+(-.5+h)*d+1,y=(-1-p)*m+(1.5+p)*f+.5*d,b=p*m-p*f,x=0;x!==a;++x)n[x]=g*o[c+x]+v*o[l+x]+y*o[s+x]+b*o[u+x];return n}}),bl.prototype=Object.assign(Object.create(vl.prototype),{constructor:bl,interpolate_:function(e,t,r,i){for(var n=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=e*a,l=s-a,c=(r-t)/(i-t),u=1-c,h=0;h!==a;++h)n[h]=o[l+h]*u+o[s+h]*c;return n}}),xl.prototype=Object.assign(Object.create(vl.prototype),{constructor:xl,interpolate_:function(e){return this.copySampleValue_(e-1)}}),Object.assign(El,{toJSON:function(e){var t,r=e.constructor;if(void 0!==r.toJSON)t=r.toJSON(e);else{t={name:e.name,times:gl.convertArray(e.times,Array),values:gl.convertArray(e.values,Array)};var i=e.getInterpolation();i!==e.DefaultInterpolation&&(t.interpolation=i)}return t.type=e.ValueTypeName,t}}),Object.assign(El.prototype,{constructor:El,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:St,InterpolantFactoryMethodDiscrete:function(e){return new xl(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodLinear:function(e){return new bl(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:function(e){return new yl(this.times,this.values,this.getValueSize(),e)},setInterpolation:function(e){var t;switch(e){case Mt:t=this.InterpolantFactoryMethodDiscrete;break;case St:t=this.InterpolantFactoryMethodLinear;break;case 2302:t=this.InterpolantFactoryMethodSmooth}if(void 0!==t)return this.createInterpolant=t,this;var r="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(r);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",r),this},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Mt;case this.InterpolantFactoryMethodLinear:return St;case this.InterpolantFactoryMethodSmooth:return 2302}},getValueSize:function(){return this.values.length/this.times.length},shift:function(e){if(0!==e)for(var t=this.times,r=0,i=t.length;r!==i;++r)t[r]+=e;return this},scale:function(e){if(1!==e)for(var t=this.times,r=0,i=t.length;r!==i;++r)t[r]*=e;return this},trim:function(e,t){for(var r=this.times,i=r.length,n=0,o=i-1;n!==i&&r[n]<e;)++n;for(;-1!==o&&r[o]>t;)--o;if(++o,0!==n||o!==i){o<=n&&(n=(o=Math.max(o,1))-1);var a=this.getValueSize();this.times=gl.arraySlice(r,n,o),this.values=gl.arraySlice(this.values,n*a,o*a)}return this},validate:function(){var e=!0,t=this.getValueSize();t-Math.floor(t)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);var r=this.times,i=this.values,n=r.length;0===n&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);for(var o=null,a=0;a!==n;a++){var s=r[a];if("number"==typeof s&&isNaN(s)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,a,s),e=!1;break}if(null!==o&&s<o){console.error("THREE.KeyframeTrack: Out of order keys.",this,a,s,o),e=!1;break}o=s}if(void 0!==i&&gl.isTypedArray(i)){a=0;for(var l=i.length;a!==l;++a){var c=i[a];if(isNaN(c)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,a,c),e=!1;break}}}return e},optimize:function(){for(var e=this.times,t=this.values,r=this.getValueSize(),i=2302===this.getInterpolation(),n=1,o=e.length-1,a=1;a<o;++a){var s=!1,l=e[a];if(l!==e[a+1]&&(1!==a||l!==l[0]))if(i)s=!0;else for(var c=a*r,u=c-r,h=c+r,p=0;p!==r;++p){var d=t[c+p];if(d!==t[u+p]||d!==t[h+p]){s=!0;break}}if(s){if(a!==n){e[n]=e[a];var f=a*r,m=n*r;for(p=0;p!==r;++p)t[m+p]=t[f+p]}++n}}if(0<o){e[n]=e[o];for(f=o*r,m=n*r,p=0;p!==r;++p)t[m+p]=t[f+p];++n}return n!==e.length&&(this.times=gl.arraySlice(e,0,n),this.values=gl.arraySlice(t,0,n*r)),this},clone:function(){var e=gl.arraySlice(this.times,0),t=gl.arraySlice(this.values,0),r=new this.constructor(this.name,e,t);return r.createInterpolant=this.createInterpolant,r}}),_l.prototype=Object.assign(Object.create(El.prototype),{constructor:_l,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:Mt,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),wl.prototype=Object.assign(Object.create(El.prototype),{constructor:wl,ValueTypeName:"color"}),Tl.prototype=Object.assign(Object.create(El.prototype),{constructor:Tl,ValueTypeName:"number"}),Ml.prototype=Object.assign(Object.create(vl.prototype),{constructor:Ml,interpolate_:function(e,t,r,i){for(var n=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=e*a,l=(r-t)/(i-t),c=s+a;s!==c;s+=4)Gt.slerpFlat(n,0,o,s-a,o,s,l);return n}}),Sl.prototype=Object.assign(Object.create(El.prototype),{constructor:Sl,ValueTypeName:"quaternion",DefaultInterpolation:St,InterpolantFactoryMethodLinear:function(e){return new Ml(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:void 0}),Rl.prototype=Object.assign(Object.create(El.prototype),{constructor:Rl,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:Mt,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),Pl.prototype=Object.assign(Object.create(El.prototype),{constructor:Pl,ValueTypeName:"vector"}),Object.assign(Al,{parse:function(e){for(var t=[],r=e.tracks,i=1/(e.fps||1),n=0,o=r.length;n!==o;++n)t.push(Cl(r[n]).scale(i));return new Al(e.name,e.duration,t)},toJSON:function(e){for(var t=[],r=e.tracks,i={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid},n=0,o=r.length;n!==o;++n)t.push(El.toJSON(r[n]));return i},CreateFromMorphTargetSequence:function(e,t,r,i){for(var n=t.length,o=[],a=0;a<n;a++){var s=[],l=[];s.push((a+n-1)%n,a,(a+1)%n),l.push(0,1,0);var c=gl.getKeyframeOrder(s);s=gl.sortedArray(s,1,c),l=gl.sortedArray(l,1,c),i||0!==s[0]||(s.push(n),l.push(l[0])),o.push(new Tl(".morphTargetInfluences["+t[a].name+"]",s,l).scale(1/r))}return new Al(e,-1,o)},findByName:function(e,t){var r=e;if(!Array.isArray(e)){var i=e;r=i.geometry&&i.geometry.animations||i.animations}for(var n=0;n<r.length;n++)if(r[n].name===t)return r[n];return null},CreateClipsFromMorphTargetSequences:function(e,t,r){for(var i={},n=/^([\w-]*?)([\d]+)$/,o=0,a=e.length;o<a;o++){var s=e[o],l=s.name.match(n);if(l&&1<l.length){var c=i[h=l[1]];c||(i[h]=c=[]),c.push(s)}}var u=[];for(var h in i)u.push(Al.CreateFromMorphTargetSequence(h,i[h],t,r));return u},parseAnimation:function(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;for(var r=function(e,t,r,i,n){if(0!==r.length){var o=[],a=[];gl.flattenJSON(r,o,a,i),0!==o.length&&n.push(new e(t,o,a))}},i=[],n=e.name||"default",o=e.length||-1,a=e.fps||30,s=e.hierarchy||[],l=0;l<s.length;l++){var c=s[l].keys;if(c&&0!==c.length)if(c[0].morphTargets){for(var u={},h=0;h<c.length;h++)if(c[h].morphTargets)for(var p=0;p<c[h].morphTargets.length;p++)u[c[h].morphTargets[p]]=-1;for(var d in u){var f=[],m=[];for(p=0;p!==c[h].morphTargets.length;++p){var g=c[h];f.push(g.time),m.push(g.morphTarget===d?1:0)}i.push(new Tl(".morphTargetInfluence["+d+"]",f,m))}o=u.length*(a||1)}else{var v=".bones["+t[l].name+"]";r(Pl,v+".position",c,"pos",i),r(Sl,v+".quaternion",c,"rot",i),r(Pl,v+".scale",c,"scl",i)}}return 0===i.length?null:new Al(n,o,i)}}),Object.assign(Al.prototype,{resetDuration:function(){for(var e=0,t=0,r=this.tracks.length;t!==r;++t){var i=this.tracks[t];e=Math.max(e,i.times[i.times.length-1])}return this.duration=e,this},trim:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this},validate:function(){for(var e=!0,t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e},optimize:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this},clone:function(){for(var e=[],t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new Al(this.name,this.duration,e)}});var Ll={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};function Ol(e,t,r){var i=this,n=!1,o=0,a=0,s=void 0;this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=r,this.itemStart=function(e){a++,!1===n&&void 0!==i.onStart&&i.onStart(e,o,a),n=!0},this.itemEnd=function(e){o++,void 0!==i.onProgress&&i.onProgress(e,o,a),o===a&&(n=!1,void 0!==i.onLoad&&i.onLoad())},this.itemError=function(e){void 0!==i.onError&&i.onError(e)},this.resolveURL=function(e){return s?s(e):e},this.setURLModifier=function(e){return s=e,this}}var Hl=new Ol,Fl={};function kl(e){this.manager=void 0!==e?e:Hl}function Il(e){this.manager=void 0!==e?e:Hl}function jl(e){this.manager=void 0!==e?e:Hl,this._parser=null}function Nl(e){this.manager=void 0!==e?e:Hl,this._parser=null}function Dl(e){this.manager=void 0!==e?e:Hl}function Ul(e){this.manager=void 0!==e?e:Hl}function Vl(e){this.manager=void 0!==e?e:Hl}function Bl(){this.type="Curve",this.arcLengthDivisions=200}function zl(e,t,r,i,n,o,a,s){Bl.call(this),this.type="EllipseCurve",this.aX=e||0,this.aY=t||0,this.xRadius=r||1,this.yRadius=i||1,this.aStartAngle=n||0,this.aEndAngle=o||2*Math.PI,this.aClockwise=a||!1,this.aRotation=s||0}function ql(e,t,r,i,n,o){zl.call(this,e,t,r,r,i,n,o),this.type="ArcCurve"}function Gl(){var n=0,o=0,a=0,s=0;function c(e,t,r,i){a=-3*(n=e)+3*t-2*(o=r)-i,s=2*e-2*t+r+i}return{initCatmullRom:function(e,t,r,i,n){c(t,r,n*(r-e),n*(i-t))},initNonuniformCatmullRom:function(e,t,r,i,n,o,a){var s=(t-e)/n-(r-e)/(n+o)+(r-t)/o,l=(r-t)/o-(i-t)/(o+a)+(i-r)/a;c(t,r,s*=o,l*=o)},calc:function(e){var t=e*e;return n+o*e+a*t+s*(t*e)}}}Object.assign(kl.prototype,{load:function(a,e,t,r){void 0===a&&(a=""),void 0!==this.path&&(a=this.path+a),a=this.manager.resolveURL(a);var s=this,i=Ll.get(a);if(void 0!==i)return s.manager.itemStart(a),setTimeout(function(){e&&e(i),s.manager.itemEnd(a)},0),i;if(void 0===Fl[a]){var n=a.match(/^data:(.*?)(;base64)?,(.*)$/);if(n){var o=n[1],l=!!n[2],c=n[3];c=decodeURIComponent(c),l&&(c=atob(c));try{var u,h=(this.responseType||"").toLowerCase();switch(h){case"arraybuffer":case"blob":for(var p=new Uint8Array(c.length),d=0;d<c.length;d++)p[d]=c.charCodeAt(d);u="blob"===h?new Blob([p.buffer],{type:o}):p.buffer;break;case"document":var f=new DOMParser;u=f.parseFromString(c,o);break;case"json":u=JSON.parse(c);break;default:u=c}setTimeout(function(){e&&e(u),s.manager.itemEnd(a)},0)}catch(e){setTimeout(function(){r&&r(e),s.manager.itemError(a),s.manager.itemEnd(a)},0)}}else{Fl[a]=[],Fl[a].push({onLoad:e,onProgress:t,onError:r});var m=new XMLHttpRequest;for(var g in m.open("GET",a,!0),m.addEventListener("load",function(e){var t=this.response;Ll.add(a,t);var r=Fl[a];if(delete Fl[a],200===this.status||0===this.status){0===this.status&&console.warn("THREE.FileLoader: HTTP Status 0 received.");for(var i=0,n=r.length;i<n;i++){(o=r[i]).onLoad&&o.onLoad(t)}s.manager.itemEnd(a)}else{for(i=0,n=r.length;i<n;i++){var o;(o=r[i]).onError&&o.onError(e)}s.manager.itemError(a),s.manager.itemEnd(a)}},!1),m.addEventListener("progress",function(e){for(var t=Fl[a],r=0,i=t.length;r<i;r++){var n=t[r];n.onProgress&&n.onProgress(e)}},!1),m.addEventListener("error",function(e){var t=Fl[a];delete Fl[a];for(var r=0,i=t.length;r<i;r++){var n=t[r];n.onError&&n.onError(e)}s.manager.itemError(a),s.manager.itemEnd(a)},!1),m.addEventListener("abort",function(e){var t=Fl[a];delete Fl[a];for(var r=0,i=t.length;r<i;r++){var n=t[r];n.onError&&n.onError(e)}s.manager.itemError(a),s.manager.itemEnd(a)},!1),void 0!==this.responseType&&(m.responseType=this.responseType),void 0!==this.withCredentials&&(m.withCredentials=this.withCredentials),m.overrideMimeType&&m.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain"),this.requestHeader)m.setRequestHeader(g,this.requestHeader[g]);m.send(null)}return s.manager.itemStart(a),m}Fl[a].push({onLoad:e,onProgress:t,onError:r})},setPath:function(e){return this.path=e,this},setResponseType:function(e){return this.responseType=e,this},setWithCredentials:function(e){return this.withCredentials=e,this},setMimeType:function(e){return this.mimeType=e,this},setRequestHeader:function(e){return this.requestHeader=e,this}}),Object.assign(Il.prototype,{load:function(e,t,r,i){var n=this,o=new kl(n.manager);o.setPath(n.path),o.load(e,function(e){t(n.parse(JSON.parse(e)))},r,i)},parse:function(e,t){for(var r=[],i=0;i<e.length;i++){var n=Al.parse(e[i]);r.push(n)}t(r)},setPath:function(e){return this.path=e,this}}),Object.assign(jl.prototype,{load:function(e,o,t,i){var a=this,s=[],l=new qa;l.image=s;var n=new kl(this.manager);function r(r){n.load(e[r],function(e){var t=a._parser(e,!0);s[r]={width:t.width,height:t.height,format:t.format,mipmaps:t.mipmaps},6===(c+=1)&&(1===t.mipmapCount&&(l.minFilter=Oe),l.format=t.format,l.needsUpdate=!0,o&&o(l))},t,i)}if(n.setPath(this.path),n.setResponseType("arraybuffer"),Array.isArray(e))for(var c=0,u=0,h=e.length;u<h;++u)r(u);else n.load(e,function(e){var t=a._parser(e,!0);if(t.isCubemap)for(var r=t.mipmaps.length/t.mipmapCount,i=0;i<r;i++){s[i]={mipmaps:[]};for(var n=0;n<t.mipmapCount;n++)s[i].mipmaps.push(t.mipmaps[i*t.mipmapCount+n]),s[i].format=t.format,s[i].width=t.width,s[i].height=t.height}else l.image.width=t.width,l.image.height=t.height,l.mipmaps=t.mipmaps;1===t.mipmapCount&&(l.minFilter=Oe),l.format=t.format,l.needsUpdate=!0,o&&o(l)},t,i);return l},setPath:function(e){return this.path=e,this}}),Object.assign(Nl.prototype,{load:function(e,r,t,i){var n=this,o=new vr,a=new kl(this.manager);return a.setResponseType("arraybuffer"),a.setPath(this.path),a.load(e,function(e){var t=n._parser(e);t&&(void 0!==t.image?o.image=t.image:void 0!==t.data&&(o.image.width=t.width,o.image.height=t.height,o.image.data=t.data),o.wrapS=void 0!==t.wrapS?t.wrapS:Re,o.wrapT=void 0!==t.wrapT?t.wrapT:Re,o.magFilter=void 0!==t.magFilter?t.magFilter:Oe,o.minFilter=void 0!==t.minFilter?t.minFilter:Fe,o.anisotropy=void 0!==t.anisotropy?t.anisotropy:1,void 0!==t.format&&(o.format=t.format),void 0!==t.type&&(o.type=t.type),void 0!==t.mipmaps&&(o.mipmaps=t.mipmaps),1===t.mipmapCount&&(o.minFilter=Oe),o.needsUpdate=!0,r&&r(o,t))},t,i),o},setPath:function(e){return this.path=e,this}}),Object.assign(Dl.prototype,{crossOrigin:"anonymous",load:function(t,e,r,i){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);var n=this,o=Ll.get(t);if(void 0!==o)return n.manager.itemStart(t),setTimeout(function(){e&&e(o),n.manager.itemEnd(t)},0),o;var a=document.createElementNS("http://www.w3.org/1999/xhtml","img");function s(){a.removeEventListener("load",s,!1),a.removeEventListener("error",l,!1),Ll.add(t,this),e&&e(this),n.manager.itemEnd(t)}function l(e){a.removeEventListener("load",s,!1),a.removeEventListener("error",l,!1),i&&i(e),n.manager.itemError(t),n.manager.itemEnd(t)}return a.addEventListener("load",s,!1),a.addEventListener("error",l,!1),"data:"!==t.substr(0,5)&&void 0!==this.crossOrigin&&(a.crossOrigin=this.crossOrigin),n.manager.itemStart(t),a.src=t,a},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(e){return this.path=e,this}}),Object.assign(Ul.prototype,{crossOrigin:"anonymous",load:function(e,r,t,i){var n=new Hn,o=new Dl(this.manager);o.setCrossOrigin(this.crossOrigin),o.setPath(this.path);var a=0;function s(t){o.load(e[t],function(e){n.images[t]=e,6===++a&&(n.needsUpdate=!0,r&&r(n))},void 0,i)}for(var l=0;l<e.length;++l)s(l);return n},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(e){return this.path=e,this}}),Object.assign(Vl.prototype,{crossOrigin:"anonymous",load:function(r,i,e,t){var n=new pr,o=new Dl(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(r,function(e){n.image=e;var t=0<r.search(/\.jpe?g($|\?)/i)||0===r.search(/^data\:image\/jpeg/);n.format=t?Ye:Qe,n.needsUpdate=!0,void 0!==i&&i(n)},e,t),n},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(e){return this.path=e,this}}),Object.assign(Bl.prototype,{getPoint:function(){return console.warn("THREE.Curve: .getPoint() not implemented."),null},getPointAt:function(e,t){var r=this.getUtoTmapping(e);return this.getPoint(r,t)},getPoints:function(e){void 0===e&&(e=5);for(var t=[],r=0;r<=e;r++)t.push(this.getPoint(r/e));return t},getSpacedPoints:function(e){void 0===e&&(e=5);for(var t=[],r=0;r<=e;r++)t.push(this.getPointAt(r/e));return t},getLength:function(){var e=this.getLengths();return e[e.length-1]},getLengths:function(e){if(void 0===e&&(e=this.arcLengthDivisions),this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var t,r,i=[],n=this.getPoint(0),o=0;for(i.push(0),r=1;r<=e;r++)o+=(t=this.getPoint(r/e)).distanceTo(n),i.push(o),n=t;return this.cacheArcLengths=i},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(e,t){var r,i=this.getLengths(),n=0,o=i.length;r=t||e*i[o-1];for(var a,s=0,l=o-1;s<=l;)if((a=i[n=Math.floor(s+(l-s)/2)]-r)<0)s=n+1;else{if(!(0<a)){l=n;break}l=n-1}if(i[n=l]===r)return n/(o-1);var c=i[n];return(n+(r-c)/(i[n+1]-c))/(o-1)},getTangent:function(e){var t=e-1e-4,r=e+1e-4;t<0&&(t=0),1<r&&(r=1);var i=this.getPoint(t);return this.getPoint(r).clone().sub(i).normalize()},getTangentAt:function(e){var t=this.getUtoTmapping(e);return this.getTangent(t)},computeFrenetFrames:function(e,t){var r,i,n,o=new Wt,a=[],s=[],l=[],c=new Wt,u=new qt;for(r=0;r<=e;r++)i=r/e,a[r]=this.getTangentAt(i),a[r].normalize();s[0]=new Wt,l[0]=new Wt;var h=Number.MAX_VALUE,p=Math.abs(a[0].x),d=Math.abs(a[0].y),f=Math.abs(a[0].z);for(p<=h&&(h=p,o.set(1,0,0)),d<=h&&(h=d,o.set(0,1,0)),f<=h&&o.set(0,0,1),c.crossVectors(a[0],o).normalize(),s[0].crossVectors(a[0],c),l[0].crossVectors(a[0],s[0]),r=1;r<=e;r++)s[r]=s[r-1].clone(),l[r]=l[r-1].clone(),c.crossVectors(a[r-1],a[r]),c.length()>Number.EPSILON&&(c.normalize(),n=Math.acos(Bt.clamp(a[r-1].dot(a[r]),-1,1)),s[r].applyMatrix4(u.makeRotationAxis(c,n))),l[r].crossVectors(a[r],s[r]);if(!0===t)for(n=Math.acos(Bt.clamp(s[0].dot(s[e]),-1,1)),n/=e,0<a[0].dot(c.crossVectors(s[0],s[e]))&&(n=-n),r=1;r<=e;r++)s[r].applyMatrix4(u.makeRotationAxis(a[r],n*r)),l[r].crossVectors(a[r],s[r]);return{tangents:a,normals:s,binormals:l}},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this},toJSON:function(){var e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e},fromJSON:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}),((zl.prototype=Object.create(Bl.prototype)).constructor=zl).prototype.isEllipseCurve=!0,zl.prototype.getPoint=function(e,t){for(var r=t||new zt,i=2*Math.PI,n=this.aEndAngle-this.aStartAngle,o=Math.abs(n)<Number.EPSILON;n<0;)n+=i;for(;i<n;)n-=i;n<Number.EPSILON&&(n=o?0:i),!0!==this.aClockwise||o||(n===i?n=-i:n-=i);var a=this.aStartAngle+e*n,s=this.aX+this.xRadius*Math.cos(a),l=this.aY+this.yRadius*Math.sin(a);if(0!==this.aRotation){var c=Math.cos(this.aRotation),u=Math.sin(this.aRotation),h=s-this.aX,p=l-this.aY;s=h*c-p*u+this.aX,l=h*u+p*c+this.aY}return r.set(s,l)},zl.prototype.copy=function(e){return Bl.prototype.copy.call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this},zl.prototype.toJSON=function(){var e=Bl.prototype.toJSON.call(this);return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e},zl.prototype.fromJSON=function(e){return Bl.prototype.fromJSON.call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this},((ql.prototype=Object.create(zl.prototype)).constructor=ql).prototype.isArcCurve=!0;var Wl=new Wt,Xl=new Gl,Yl=new Gl,Ql=new Gl;function Jl(e,t,r,i){Bl.call(this),this.type="CatmullRomCurve3",this.points=e||[],this.closed=t||!1,this.curveType=r||"centripetal",this.tension=i||.5}function Zl(e,t,r,i,n){var o=.5*(i-t),a=.5*(n-r),s=e*e;return(2*r-2*i+o+a)*(e*s)+(-3*r+3*i-2*o-a)*s+o*e+r}function Kl(e,t,r,i){return(a=1-e)*a*t+2*(1-(o=e))*o*r+(n=e)*n*i;var n,o,a}function $l(e,t,r,i,n){return(c=1-e)*c*c*t+3*(l=1-(s=e))*l*s*r+3*(1-(a=e))*a*a*i+(o=e)*o*o*n;var o,a,s,l,c}function ec(e,t,r,i){Bl.call(this),this.type="CubicBezierCurve",this.v0=e||new zt,this.v1=t||new zt,this.v2=r||new zt,this.v3=i||new zt}function tc(e,t,r,i){Bl.call(this),this.type="CubicBezierCurve3",this.v0=e||new Wt,this.v1=t||new Wt,this.v2=r||new Wt,this.v3=i||new Wt}function rc(e,t){Bl.call(this),this.type="LineCurve",this.v1=e||new zt,this.v2=t||new zt}function ic(e,t){Bl.call(this),this.type="LineCurve3",this.v1=e||new Wt,this.v2=t||new Wt}function nc(e,t,r){Bl.call(this),this.type="QuadraticBezierCurve",this.v0=e||new zt,this.v1=t||new zt,this.v2=r||new zt}function oc(e,t,r){Bl.call(this),this.type="QuadraticBezierCurve3",this.v0=e||new Wt,this.v1=t||new Wt,this.v2=r||new Wt}function ac(e){Bl.call(this),this.type="SplineCurve",this.points=e||[]}((Jl.prototype=Object.create(Bl.prototype)).constructor=Jl).prototype.isCatmullRomCurve3=!0,Jl.prototype.getPoint=function(e,t){var r,i,n,o,a=t||new Wt,s=this.points,l=s.length,c=(l-(this.closed?0:1))*e,u=Math.floor(c),h=c-u;if(this.closed?u+=0<u?0:(Math.floor(Math.abs(u)/l)+1)*l:0===h&&u===l-1&&(u=l-2,h=1),r=this.closed||0<u?s[(u-1)%l]:(Wl.subVectors(s[0],s[1]).add(s[0]),Wl),i=s[u%l],n=s[(u+1)%l],o=this.closed||u+2<l?s[(u+2)%l]:(Wl.subVectors(s[l-1],s[l-2]).add(s[l-1]),Wl),"centripetal"===this.curveType||"chordal"===this.curveType){var p="chordal"===this.curveType?.5:.25,d=Math.pow(r.distanceToSquared(i),p),f=Math.pow(i.distanceToSquared(n),p),m=Math.pow(n.distanceToSquared(o),p);f<1e-4&&(f=1),d<1e-4&&(d=f),m<1e-4&&(m=f),Xl.initNonuniformCatmullRom(r.x,i.x,n.x,o.x,d,f,m),Yl.initNonuniformCatmullRom(r.y,i.y,n.y,o.y,d,f,m),Ql.initNonuniformCatmullRom(r.z,i.z,n.z,o.z,d,f,m)}else"catmullrom"===this.curveType&&(Xl.initCatmullRom(r.x,i.x,n.x,o.x,this.tension),Yl.initCatmullRom(r.y,i.y,n.y,o.y,this.tension),Ql.initCatmullRom(r.z,i.z,n.z,o.z,this.tension));return a.set(Xl.calc(h),Yl.calc(h),Ql.calc(h)),a},Jl.prototype.copy=function(e){Bl.prototype.copy.call(this,e),this.points=[];for(var t=0,r=e.points.length;t<r;t++){var i=e.points[t];this.points.push(i.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this},Jl.prototype.toJSON=function(){var e=Bl.prototype.toJSON.call(this);e.points=[];for(var t=0,r=this.points.length;t<r;t++){var i=this.points[t];e.points.push(i.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e},Jl.prototype.fromJSON=function(e){Bl.prototype.fromJSON.call(this,e),this.points=[];for(var t=0,r=e.points.length;t<r;t++){var i=e.points[t];this.points.push((new Wt).fromArray(i))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this},((ec.prototype=Object.create(Bl.prototype)).constructor=ec).prototype.isCubicBezierCurve=!0,ec.prototype.getPoint=function(e,t){var r=t||new zt,i=this.v0,n=this.v1,o=this.v2,a=this.v3;return r.set($l(e,i.x,n.x,o.x,a.x),$l(e,i.y,n.y,o.y,a.y)),r},ec.prototype.copy=function(e){return Bl.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this},ec.prototype.toJSON=function(){var e=Bl.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e},ec.prototype.fromJSON=function(e){return Bl.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this},((tc.prototype=Object.create(Bl.prototype)).constructor=tc).prototype.isCubicBezierCurve3=!0,tc.prototype.getPoint=function(e,t){var r=t||new Wt,i=this.v0,n=this.v1,o=this.v2,a=this.v3;return r.set($l(e,i.x,n.x,o.x,a.x),$l(e,i.y,n.y,o.y,a.y),$l(e,i.z,n.z,o.z,a.z)),r},tc.prototype.copy=function(e){return Bl.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this},tc.prototype.toJSON=function(){var e=Bl.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e},tc.prototype.fromJSON=function(e){return Bl.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this},((rc.prototype=Object.create(Bl.prototype)).constructor=rc).prototype.isLineCurve=!0,rc.prototype.getPoint=function(e,t){var r=t||new zt;return 1===e?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(e).add(this.v1)),r},rc.prototype.getPointAt=function(e,t){return this.getPoint(e,t)},rc.prototype.getTangent=function(){return this.v2.clone().sub(this.v1).normalize()},rc.prototype.copy=function(e){return Bl.prototype.copy.call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this},rc.prototype.toJSON=function(){var e=Bl.prototype.toJSON.call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},rc.prototype.fromJSON=function(e){return Bl.prototype.fromJSON.call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},((ic.prototype=Object.create(Bl.prototype)).constructor=ic).prototype.isLineCurve3=!0,ic.prototype.getPoint=function(e,t){var r=t||new Wt;return 1===e?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(e).add(this.v1)),r},ic.prototype.getPointAt=function(e,t){return this.getPoint(e,t)},ic.prototype.copy=function(e){return Bl.prototype.copy.call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this},ic.prototype.toJSON=function(){var e=Bl.prototype.toJSON.call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},ic.prototype.fromJSON=function(e){return Bl.prototype.fromJSON.call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},((nc.prototype=Object.create(Bl.prototype)).constructor=nc).prototype.isQuadraticBezierCurve=!0,nc.prototype.getPoint=function(e,t){var r=t||new zt,i=this.v0,n=this.v1,o=this.v2;return r.set(Kl(e,i.x,n.x,o.x),Kl(e,i.y,n.y,o.y)),r},nc.prototype.copy=function(e){return Bl.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this},nc.prototype.toJSON=function(){var e=Bl.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},nc.prototype.fromJSON=function(e){return Bl.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},((oc.prototype=Object.create(Bl.prototype)).constructor=oc).prototype.isQuadraticBezierCurve3=!0,oc.prototype.getPoint=function(e,t){var r=t||new Wt,i=this.v0,n=this.v1,o=this.v2;return r.set(Kl(e,i.x,n.x,o.x),Kl(e,i.y,n.y,o.y),Kl(e,i.z,n.z,o.z)),r},oc.prototype.copy=function(e){return Bl.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this},oc.prototype.toJSON=function(){var e=Bl.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},oc.prototype.fromJSON=function(e){return Bl.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},((ac.prototype=Object.create(Bl.prototype)).constructor=ac).prototype.isSplineCurve=!0,ac.prototype.getPoint=function(e,t){var r=t||new zt,i=this.points,n=(i.length-1)*e,o=Math.floor(n),a=n-o,s=i[0===o?o:o-1],l=i[o],c=i[o>i.length-2?i.length-1:o+1],u=i[o>i.length-3?i.length-1:o+2];return r.set(Zl(a,s.x,l.x,c.x,u.x),Zl(a,s.y,l.y,c.y,u.y)),r},ac.prototype.copy=function(e){Bl.prototype.copy.call(this,e),this.points=[];for(var t=0,r=e.points.length;t<r;t++){var i=e.points[t];this.points.push(i.clone())}return this},ac.prototype.toJSON=function(){var e=Bl.prototype.toJSON.call(this);e.points=[];for(var t=0,r=this.points.length;t<r;t++){var i=this.points[t];e.points.push(i.toArray())}return e},ac.prototype.fromJSON=function(e){Bl.prototype.fromJSON.call(this,e),this.points=[];for(var t=0,r=e.points.length;t<r;t++){var i=e.points[t];this.points.push((new zt).fromArray(i))}return this};var sc=Object.freeze({ArcCurve:ql,CatmullRomCurve3:Jl,CubicBezierCurve:ec,CubicBezierCurve3:tc,EllipseCurve:zl,LineCurve:rc,LineCurve3:ic,QuadraticBezierCurve:nc,QuadraticBezierCurve3:oc,SplineCurve:ac});function lc(){Bl.call(this),this.type="CurvePath",this.curves=[],this.autoClose=!1}function cc(e){lc.call(this),this.type="Path",this.currentPoint=new zt,e&&this.setFromPoints(e)}function uc(e){cc.call(this,e),this.uuid=Bt.generateUUID(),this.type="Shape",this.holes=[]}function hc(e,t){oi.call(this),this.type="Light",this.color=new Cr(e),this.intensity=void 0!==t?t:1,this.receiveShadow=void 0}function pc(e,t,r){hc.call(this,e,r),this.type="HemisphereLight",this.castShadow=void 0,this.position.copy(oi.DefaultUp),this.updateMatrix(),this.groundColor=new Cr(t)}function dc(e){this.camera=e,this.bias=0,this.radius=1,this.mapSize=new zt(512,512),this.map=null,this.matrix=new qt}function fc(){dc.call(this,new ta(50,1,.5,500))}function mc(e,t,r,i,n,o){hc.call(this,e,t),this.type="SpotLight",this.position.copy(oi.DefaultUp),this.updateMatrix(),this.target=new oi,Object.defineProperty(this,"power",{get:function(){return this.intensity*Math.PI},set:function(e){this.intensity=e/Math.PI}}),this.distance=void 0!==r?r:0,this.angle=void 0!==i?i:Math.PI/3,this.penumbra=void 0!==n?n:0,this.decay=void 0!==o?o:1,this.shadow=new fc}function gc(e,t,r,i){hc.call(this,e,t),this.type="PointLight",Object.defineProperty(this,"power",{get:function(){return 4*this.intensity*Math.PI},set:function(e){this.intensity=e/(4*Math.PI)}}),this.distance=void 0!==r?r:0,this.decay=void 0!==i?i:1,this.shadow=new dc(new ta(90,1,.5,500))}function vc(e,t,r,i,n,o){ea.call(this),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=void 0!==e?e:-1,this.right=void 0!==t?t:1,this.top=void 0!==r?r:1,this.bottom=void 0!==i?i:-1,this.near=void 0!==n?n:.1,this.far=void 0!==o?o:2e3,this.updateProjectionMatrix()}function yc(){dc.call(this,new vc(-5,5,5,-5,.5,500))}function bc(e,t){hc.call(this,e,t),this.type="DirectionalLight",this.position.copy(oi.DefaultUp),this.updateMatrix(),this.target=new oi,this.shadow=new yc}function xc(e,t){hc.call(this,e,t),this.type="AmbientLight",this.castShadow=void 0}function Ec(e,t,r,i){hc.call(this,e,t),this.type="RectAreaLight",this.width=void 0!==r?r:10,this.height=void 0!==i?i:10}function _c(e){this.manager=void 0!==e?e:Hl,this.textures={}}lc.prototype=Object.assign(Object.create(Bl.prototype),{constructor:lc,add:function(e){this.curves.push(e)},closePath:function(){var e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new rc(t,e))},getPoint:function(e){for(var t=e*this.getLength(),r=this.getCurveLengths(),i=0;i<r.length;){if(r[i]>=t){var n=r[i]-t,o=this.curves[i],a=o.getLength(),s=0===a?0:1-n/a;return o.getPointAt(s)}i++}return null},getLength:function(){var e=this.getCurveLengths();return e[e.length-1]},updateArcLengths:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var e=[],t=0,r=0,i=this.curves.length;r<i;r++)t+=this.curves[r].getLength(),e.push(t);return this.cacheLengths=e},getSpacedPoints:function(e){void 0===e&&(e=40);for(var t=[],r=0;r<=e;r++)t.push(this.getPoint(r/e));return this.autoClose&&t.push(t[0]),t},getPoints:function(e){e=e||12;for(var t,r=[],i=0,n=this.curves;i<n.length;i++)for(var o=n[i],a=o&&o.isEllipseCurve?2*e:o&&(o.isLineCurve||o.isLineCurve3)?1:o&&o.isSplineCurve?e*o.points.length:e,s=o.getPoints(a),l=0;l<s.length;l++){var c=s[l];t&&t.equals(c)||(r.push(c),t=c)}return this.autoClose&&1<r.length&&!r[r.length-1].equals(r[0])&&r.push(r[0]),r},copy:function(e){Bl.prototype.copy.call(this,e),this.curves=[];for(var t=0,r=e.curves.length;t<r;t++){var i=e.curves[t];this.curves.push(i.clone())}return this.autoClose=e.autoClose,this},toJSON:function(){var e=Bl.prototype.toJSON.call(this);e.autoClose=this.autoClose,e.curves=[];for(var t=0,r=this.curves.length;t<r;t++){var i=this.curves[t];e.curves.push(i.toJSON())}return e},fromJSON:function(e){Bl.prototype.fromJSON.call(this,e),this.autoClose=e.autoClose,this.curves=[];for(var t=0,r=e.curves.length;t<r;t++){var i=e.curves[t];this.curves.push((new sc[i.type]).fromJSON(i))}return this}}),cc.prototype=Object.assign(Object.create(lc.prototype),{constructor:cc,setFromPoints:function(e){this.moveTo(e[0].x,e[0].y);for(var t=1,r=e.length;t<r;t++)this.lineTo(e[t].x,e[t].y)},moveTo:function(e,t){this.currentPoint.set(e,t)},lineTo:function(e,t){var r=new rc(this.currentPoint.clone(),new zt(e,t));this.curves.push(r),this.currentPoint.set(e,t)},quadraticCurveTo:function(e,t,r,i){var n=new nc(this.currentPoint.clone(),new zt(e,t),new zt(r,i));this.curves.push(n),this.currentPoint.set(r,i)},bezierCurveTo:function(e,t,r,i,n,o){var a=new ec(this.currentPoint.clone(),new zt(e,t),new zt(r,i),new zt(n,o));this.curves.push(a),this.currentPoint.set(n,o)},splineThru:function(e){var t=new ac([this.currentPoint.clone()].concat(e));this.curves.push(t),this.currentPoint.copy(e[e.length-1])},arc:function(e,t,r,i,n,o){var a=this.currentPoint.x,s=this.currentPoint.y;this.absarc(e+a,t+s,r,i,n,o)},absarc:function(e,t,r,i,n,o){this.absellipse(e,t,r,r,i,n,o)},ellipse:function(e,t,r,i,n,o,a,s){var l=this.currentPoint.x,c=this.currentPoint.y;this.absellipse(e+l,t+c,r,i,n,o,a,s)},absellipse:function(e,t,r,i,n,o,a,s){var l=new zl(e,t,r,i,n,o,a,s);if(0<this.curves.length){var c=l.getPoint(0);c.equals(this.currentPoint)||this.lineTo(c.x,c.y)}this.curves.push(l);var u=l.getPoint(1);this.currentPoint.copy(u)},copy:function(e){return lc.prototype.copy.call(this,e),this.currentPoint.copy(e.currentPoint),this},toJSON:function(){var e=lc.prototype.toJSON.call(this);return e.currentPoint=this.currentPoint.toArray(),e},fromJSON:function(e){return lc.prototype.fromJSON.call(this,e),this.currentPoint.fromArray(e.currentPoint),this}}),uc.prototype=Object.assign(Object.create(cc.prototype),{constructor:uc,getPointsHoles:function(e){for(var t=[],r=0,i=this.holes.length;r<i;r++)t[r]=this.holes[r].getPoints(e);return t},extractPoints:function(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}},copy:function(e){cc.prototype.copy.call(this,e),this.holes=[];for(var t=0,r=e.holes.length;t<r;t++){var i=e.holes[t];this.holes.push(i.clone())}return this},toJSON:function(){var e=cc.prototype.toJSON.call(this);e.uuid=this.uuid,e.holes=[];for(var t=0,r=this.holes.length;t<r;t++){var i=this.holes[t];e.holes.push(i.toJSON())}return e},fromJSON:function(e){cc.prototype.fromJSON.call(this,e),this.uuid=e.uuid,this.holes=[];for(var t=0,r=e.holes.length;t<r;t++){var i=e.holes[t];this.holes.push((new cc).fromJSON(i))}return this}}),hc.prototype=Object.assign(Object.create(oi.prototype),{constructor:hc,isLight:!0,copy:function(e){return oi.prototype.copy.call(this,e),this.color.copy(e.color),this.intensity=e.intensity,this},toJSON:function(e){var t=oi.prototype.toJSON.call(this,e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}}),pc.prototype=Object.assign(Object.create(hc.prototype),{constructor:pc,isHemisphereLight:!0,copy:function(e){return hc.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this}}),Object.assign(dc.prototype,{copy:function(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){var e={};return 0!==this.bias&&(e.bias=this.bias),1!==this.radius&&(e.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}),fc.prototype=Object.assign(Object.create(dc.prototype),{constructor:fc,isSpotLightShadow:!0,update:function(e){var t=this.camera,r=2*Bt.RAD2DEG*e.angle,i=this.mapSize.width/this.mapSize.height,n=e.distance||t.far;r===t.fov&&i===t.aspect&&n===t.far||(t.fov=r,t.aspect=i,t.far=n,t.updateProjectionMatrix())}}),mc.prototype=Object.assign(Object.create(hc.prototype),{constructor:mc,isSpotLight:!0,copy:function(e){return hc.prototype.copy.call(this,e),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}),gc.prototype=Object.assign(Object.create(hc.prototype),{constructor:gc,isPointLight:!0,copy:function(e){return hc.prototype.copy.call(this,e),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}),vc.prototype=Object.assign(Object.create(ea.prototype),{constructor:vc,isOrthographicCamera:!0,copy:function(e,t){return ea.prototype.copy.call(this,e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this},setViewOffset:function(e,t,r,i,n,o){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=r,this.view.offsetY=i,this.view.width=n,this.view.height=o,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),r=(this.right+this.left)/2,i=(this.top+this.bottom)/2,n=r-e,o=r+e,a=i+t,s=i-t;if(null!==this.view&&this.view.enabled){var l=this.zoom/(this.view.width/this.view.fullWidth),c=this.zoom/(this.view.height/this.view.fullHeight),u=(this.right-this.left)/this.view.width,h=(this.top-this.bottom)/this.view.height;o=(n+=u*(this.view.offsetX/l))+u*(this.view.width/l),s=(a-=h*(this.view.offsetY/c))-h*(this.view.height/c)}this.projectionMatrix.makeOrthographic(n,o,a,s,this.near,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(e){var t=oi.prototype.toJSON.call(this,e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}),yc.prototype=Object.assign(Object.create(dc.prototype),{constructor:yc}),bc.prototype=Object.assign(Object.create(hc.prototype),{constructor:bc,isDirectionalLight:!0,copy:function(e){return hc.prototype.copy.call(this,e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}),xc.prototype=Object.assign(Object.create(hc.prototype),{constructor:xc,isAmbientLight:!0}),Ec.prototype=Object.assign(Object.create(hc.prototype),{constructor:Ec,isRectAreaLight:!0,copy:function(e){return hc.prototype.copy.call(this,e),this.width=e.width,this.height=e.height,this},toJSON:function(e){var t=hc.prototype.toJSON.call(this,e);return t.object.width=this.width,t.object.height=this.height,t}}),Object.assign(_c.prototype,{load:function(e,t,r,i){var n=this,o=new kl(n.manager);o.setPath(n.path),o.load(e,function(e){t(n.parse(JSON.parse(e)))},r,i)},parse:function(e){var t=this.textures;function r(e){return void 0===t[e]&&console.warn("THREE.MaterialLoader: Undefined texture",e),t[e]}var i=new ml[e.type];if(void 0!==e.uuid&&(i.uuid=e.uuid),void 0!==e.name&&(i.name=e.name),void 0!==e.color&&i.color.setHex(e.color),void 0!==e.roughness&&(i.roughness=e.roughness),void 0!==e.metalness&&(i.metalness=e.metalness),void 0!==e.emissive&&i.emissive.setHex(e.emissive),void 0!==e.specular&&i.specular.setHex(e.specular),void 0!==e.shininess&&(i.shininess=e.shininess),void 0!==e.clearCoat&&(i.clearCoat=e.clearCoat),void 0!==e.clearCoatRoughness&&(i.clearCoatRoughness=e.clearCoatRoughness),void 0!==e.vertexColors&&(i.vertexColors=e.vertexColors),void 0!==e.fog&&(i.fog=e.fog),void 0!==e.flatShading&&(i.flatShading=e.flatShading),void 0!==e.blending&&(i.blending=e.blending),void 0!==e.combine&&(i.combine=e.combine),void 0!==e.side&&(i.side=e.side),void 0!==e.opacity&&(i.opacity=e.opacity),void 0!==e.transparent&&(i.transparent=e.transparent),void 0!==e.alphaTest&&(i.alphaTest=e.alphaTest),void 0!==e.depthTest&&(i.depthTest=e.depthTest),void 0!==e.depthWrite&&(i.depthWrite=e.depthWrite),void 0!==e.colorWrite&&(i.colorWrite=e.colorWrite),void 0!==e.wireframe&&(i.wireframe=e.wireframe),void 0!==e.wireframeLinewidth&&(i.wireframeLinewidth=e.wireframeLinewidth),void 0!==e.wireframeLinecap&&(i.wireframeLinecap=e.wireframeLinecap),void 0!==e.wireframeLinejoin&&(i.wireframeLinejoin=e.wireframeLinejoin),void 0!==e.rotation&&(i.rotation=e.rotation),1!==e.linewidth&&(i.linewidth=e.linewidth),void 0!==e.dashSize&&(i.dashSize=e.dashSize),void 0!==e.gapSize&&(i.gapSize=e.gapSize),void 0!==e.scale&&(i.scale=e.scale),void 0!==e.polygonOffset&&(i.polygonOffset=e.polygonOffset),void 0!==e.polygonOffsetFactor&&(i.polygonOffsetFactor=e.polygonOffsetFactor),void 0!==e.polygonOffsetUnits&&(i.polygonOffsetUnits=e.polygonOffsetUnits),void 0!==e.skinning&&(i.skinning=e.skinning),void 0!==e.morphTargets&&(i.morphTargets=e.morphTargets),void 0!==e.dithering&&(i.dithering=e.dithering),void 0!==e.visible&&(i.visible=e.visible),void 0!==e.userData&&(i.userData=e.userData),void 0!==e.uniforms)for(var n in e.uniforms){var o=e.uniforms[n];switch(i.uniforms[n]={},o.type){case"t":i.uniforms[n].value=r(o.value);break;case"c":i.uniforms[n].value=(new Cr).setHex(o.value);break;case"v2":i.uniforms[n].value=(new zt).fromArray(o.value);break;case"v3":i.uniforms[n].value=(new Wt).fromArray(o.value);break;case"v4":i.uniforms[n].value=(new dr).fromArray(o.value);break;case"m3":i.uniforms[n].value=(new Xt).fromArray(o.value);case"m4":i.uniforms[n].value=(new qt).fromArray(o.value);break;default:i.uniforms[n].value=o.value}}if(void 0!==e.defines&&(i.defines=e.defines),void 0!==e.vertexShader&&(i.vertexShader=e.vertexShader),void 0!==e.fragmentShader&&(i.fragmentShader=e.fragmentShader),void 0!==e.extensions)for(var a in e.extensions)i.extensions[a]=e.extensions[a];if(void 0!==e.shading&&(i.flatShading=1===e.shading),void 0!==e.size&&(i.size=e.size),void 0!==e.sizeAttenuation&&(i.sizeAttenuation=e.sizeAttenuation),void 0!==e.map&&(i.map=r(e.map)),void 0!==e.alphaMap&&(i.alphaMap=r(e.alphaMap),i.transparent=!0),void 0!==e.bumpMap&&(i.bumpMap=r(e.bumpMap)),void 0!==e.bumpScale&&(i.bumpScale=e.bumpScale),void 0!==e.normalMap&&(i.normalMap=r(e.normalMap)),void 0!==e.normalMapType&&(i.normalMapType=e.normalMapType),void 0!==e.normalScale){var s=e.normalScale;!1===Array.isArray(s)&&(s=[s,s]),i.normalScale=(new zt).fromArray(s)}return void 0!==e.displacementMap&&(i.displacementMap=r(e.displacementMap)),void 0!==e.displacementScale&&(i.displacementScale=e.displacementScale),void 0!==e.displacementBias&&(i.displacementBias=e.displacementBias),void 0!==e.roughnessMap&&(i.roughnessMap=r(e.roughnessMap)),void 0!==e.metalnessMap&&(i.metalnessMap=r(e.metalnessMap)),void 0!==e.emissiveMap&&(i.emissiveMap=r(e.emissiveMap)),void 0!==e.emissiveIntensity&&(i.emissiveIntensity=e.emissiveIntensity),void 0!==e.specularMap&&(i.specularMap=r(e.specularMap)),void 0!==e.envMap&&(i.envMap=r(e.envMap)),void 0!==e.envMapIntensity&&(i.envMapIntensity=e.envMapIntensity),void 0!==e.reflectivity&&(i.reflectivity=e.reflectivity),void 0!==e.lightMap&&(i.lightMap=r(e.lightMap)),void 0!==e.lightMapIntensity&&(i.lightMapIntensity=e.lightMapIntensity),void 0!==e.aoMap&&(i.aoMap=r(e.aoMap)),void 0!==e.aoMapIntensity&&(i.aoMapIntensity=e.aoMapIntensity),void 0!==e.gradientMap&&(i.gradientMap=r(e.gradientMap)),i},setPath:function(e){return this.path=e,this},setTextures:function(e){return this.textures=e,this}});var wc={decodeText:function(e){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(e);for(var t="",r=0,i=e.length;r<i;r++)t+=String.fromCharCode(e[r]);return decodeURIComponent(escape(t))},extractUrlBase:function(e){var t=e.lastIndexOf("/");return-1===t?"./":e.substr(0,t+1)}};function Tc(e){this.manager=void 0!==e?e:Hl}Object.assign(Tc.prototype,{load:function(e,t,r,i){var n=this,o=new kl(n.manager);o.setPath(n.path),o.load(e,function(e){t(n.parse(JSON.parse(e)))},r,i)},parse:function(e){var t=new Ni,r=e.data.index;if(void 0!==r){var i=new Mc[r.type](r.array);t.setIndex(new mi(i,1))}var n=e.data.attributes;for(var o in n){var a=n[o];i=new Mc[a.type](a.array);t.addAttribute(o,new mi(i,a.itemSize,a.normalized))}var s=e.data.groups||e.data.drawcalls||e.data.offsets;if(void 0!==s)for(var l=0,c=s.length;l!==c;++l){var u=s[l];t.addGroup(u.start,u.count,u.materialIndex)}var h=e.data.boundingSphere;if(void 0!==h){var p=new Wt;void 0!==h.center&&p.fromArray(h.center),t.boundingSphere=new br(p,h.radius)}return e.name&&(t.name=e.name),e.userData&&(t.userData=e.userData),t},setPath:function(e){return this.path=e,this}});var Mc={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:"undefined"!=typeof Uint8ClampedArray?Uint8ClampedArray:Uint8Array,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};function Sc(e){this.manager=void 0!==e?e:Hl,this.resourcePath=""}Object.assign(Sc.prototype,{crossOrigin:"anonymous",load:function(i,n,e,o){var a=this,t=void 0===this.path?wc.extractUrlBase(i):this.path;this.resourcePath=this.resourcePath||t;var r=new kl(a.manager);r.setPath(this.path),r.load(i,function(e){var t=null;try{t=JSON.parse(e)}catch(e){return void 0!==o&&o(e),void console.error("THREE:ObjectLoader: Can't parse "+i+".",e.message)}var r=t.metadata;void 0!==r&&void 0!==r.type&&"geometry"!==r.type.toLowerCase()?a.parse(t,n):console.error("THREE.ObjectLoader: Can't load "+i)},e,o)},setPath:function(e){return this.path=e,this},setResourcePath:function(e){return this.resourcePath=e,this},setCrossOrigin:function(e){return this.crossOrigin=e,this},parse:function(e,t){var r=this.parseShape(e.shapes),i=this.parseGeometries(e.geometries,r),n=this.parseImages(e.images,function(){void 0!==t&&t(s)}),o=this.parseTextures(e.textures,n),a=this.parseMaterials(e.materials,o),s=this.parseObject(e.object,i,a);return e.animations&&(s.animations=this.parseAnimations(e.animations)),void 0!==e.images&&0!==e.images.length||void 0!==t&&t(s),s},parseShape:function(e){var t={};if(void 0!==e)for(var r=0,i=e.length;r<i;r++){var n=(new uc).fromJSON(e[r]);t[n.uuid]=n}return t},parseGeometries:function(e,t){var r={};if(void 0!==e)for(var i=new Tc,n=0,o=e.length;n<o;n++){var a,s=e[n];switch(s.type){case"PlaneGeometry":case"PlaneBufferGeometry":a=new nl[s.type](s.width,s.height,s.widthSegments,s.heightSegments);break;case"BoxGeometry":case"BoxBufferGeometry":case"CubeGeometry":a=new nl[s.type](s.width,s.height,s.depth,s.widthSegments,s.heightSegments,s.depthSegments);break;case"CircleGeometry":case"CircleBufferGeometry":a=new nl[s.type](s.radius,s.segments,s.thetaStart,s.thetaLength);break;case"CylinderGeometry":case"CylinderBufferGeometry":a=new nl[s.type](s.radiusTop,s.radiusBottom,s.height,s.radialSegments,s.heightSegments,s.openEnded,s.thetaStart,s.thetaLength);break;case"ConeGeometry":case"ConeBufferGeometry":a=new nl[s.type](s.radius,s.height,s.radialSegments,s.heightSegments,s.openEnded,s.thetaStart,s.thetaLength);break;case"SphereGeometry":case"SphereBufferGeometry":a=new nl[s.type](s.radius,s.widthSegments,s.heightSegments,s.phiStart,s.phiLength,s.thetaStart,s.thetaLength);break;case"DodecahedronGeometry":case"DodecahedronBufferGeometry":case"IcosahedronGeometry":case"IcosahedronBufferGeometry":case"OctahedronGeometry":case"OctahedronBufferGeometry":case"TetrahedronGeometry":case"TetrahedronBufferGeometry":a=new nl[s.type](s.radius,s.detail);break;case"RingGeometry":case"RingBufferGeometry":a=new nl[s.type](s.innerRadius,s.outerRadius,s.thetaSegments,s.phiSegments,s.thetaStart,s.thetaLength);break;case"TorusGeometry":case"TorusBufferGeometry":a=new nl[s.type](s.radius,s.tube,s.radialSegments,s.tubularSegments,s.arc);break;case"TorusKnotGeometry":case"TorusKnotBufferGeometry":a=new nl[s.type](s.radius,s.tube,s.tubularSegments,s.radialSegments,s.p,s.q);break;case"LatheGeometry":case"LatheBufferGeometry":a=new nl[s.type](s.points,s.segments,s.phiStart,s.phiLength);break;case"PolyhedronGeometry":case"PolyhedronBufferGeometry":a=new nl[s.type](s.vertices,s.indices,s.radius,s.details);break;case"ShapeGeometry":case"ShapeBufferGeometry":for(var l=[],c=0,u=s.shapes.length;c<u;c++){var h=t[s.shapes[c]];l.push(h)}a=new nl[s.type](l,s.curveSegments);break;case"ExtrudeGeometry":case"ExtrudeBufferGeometry":for(l=[],c=0,u=s.shapes.length;c<u;c++){h=t[s.shapes[c]];l.push(h)}var p=s.options.extrudePath;void 0!==p&&(s.options.extrudePath=(new sc[p.type]).fromJSON(p)),a=new nl[s.type](l,s.options);break;case"BufferGeometry":a=i.parse(s);break;case"Geometry":if("THREE"in window&&"LegacyJSONLoader"in THREE)a=(new THREE.LegacyJSONLoader).parse(s,this.resourcePath).geometry;else console.error('THREE.ObjectLoader: You have to import LegacyJSONLoader in order load geometry data of type "Geometry".');break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type "'+s.type+'"');continue}a.uuid=s.uuid,void 0!==s.name&&(a.name=s.name),!0===a.isBufferGeometry&&void 0!==s.userData&&(a.userData=s.userData),r[s.uuid]=a}return r},parseMaterials:function(e,t){var r={},i={};if(void 0!==e){var n=new _c;n.setTextures(t);for(var o=0,a=e.length;o<a;o++){var s=e[o];if("MultiMaterial"===s.type){for(var l=[],c=0;c<s.materials.length;c++){var u=s.materials[c];void 0===r[u.uuid]&&(r[u.uuid]=n.parse(u)),l.push(r[u.uuid])}i[s.uuid]=l}else void 0===r[s.uuid]&&(r[s.uuid]=n.parse(s)),i[s.uuid]=r[s.uuid]}}return i},parseAnimations:function(e){for(var t=[],r=0;r<e.length;r++){var i=e[r],n=Al.parse(i);void 0!==i.uuid&&(n.uuid=i.uuid),t.push(n)}return t},parseImages:function(e,t){var r=this,i={};function n(e){return r.manager.itemStart(e),o.load(e,function(){r.manager.itemEnd(e)},void 0,function(){r.manager.itemError(e),r.manager.itemEnd(e)})}if(void 0!==e&&0<e.length){var o=new Dl(new Ol(t));o.setCrossOrigin(this.crossOrigin);for(var a=0,s=e.length;a<s;a++){var l=e[a],c=l.url;if(Array.isArray(c)){i[l.uuid]=[];for(var u=0,h=c.length;u<h;u++){var p=c[u],d=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(p)?p:r.resourcePath+p;i[l.uuid].push(n(d))}}else{d=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(l.url)?l.url:r.resourcePath+l.url;i[l.uuid]=n(d)}}}return i},parseTextures:function(e,t){function r(e,t){return"number"==typeof e?e:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",e),t[e])}var i={};if(void 0!==e)for(var n=0,o=e.length;n<o;n++){var a,s=e[n];void 0===s.image&&console.warn('THREE.ObjectLoader: No "image" specified for',s.uuid),void 0===t[s.image]&&console.warn("THREE.ObjectLoader: Undefined image",s.image),(a=Array.isArray(t[s.image])?new Hn(t[s.image]):new pr(t[s.image])).needsUpdate=!0,a.uuid=s.uuid,void 0!==s.name&&(a.name=s.name),void 0!==s.mapping&&(a.mapping=r(s.mapping,Oc)),void 0!==s.offset&&a.offset.fromArray(s.offset),void 0!==s.repeat&&a.repeat.fromArray(s.repeat),void 0!==s.center&&a.center.fromArray(s.center),void 0!==s.rotation&&(a.rotation=s.rotation),void 0!==s.wrap&&(a.wrapS=r(s.wrap[0],Hc),a.wrapT=r(s.wrap[1],Hc)),void 0!==s.format&&(a.format=s.format),void 0!==s.type&&(a.type=s.type),void 0!==s.encoding&&(a.encoding=s.encoding),void 0!==s.minFilter&&(a.minFilter=r(s.minFilter,Fc)),void 0!==s.magFilter&&(a.magFilter=r(s.magFilter,Fc)),void 0!==s.anisotropy&&(a.anisotropy=s.anisotropy),void 0!==s.flipY&&(a.flipY=s.flipY),void 0!==s.premultiplyAlpha&&(a.premultiplyAlpha=s.premultiplyAlpha),void 0!==s.unpackAlignment&&(a.unpackAlignment=s.unpackAlignment),i[s.uuid]=a}return i},parseObject:function(e,t,o){var r;function i(e){return void 0===t[e]&&console.warn("THREE.ObjectLoader: Undefined geometry",e),t[e]}function n(e){if(void 0!==e){if(Array.isArray(e)){for(var t=[],r=0,i=e.length;r<i;r++){var n=e[r];void 0===o[n]&&console.warn("THREE.ObjectLoader: Undefined material",n),t.push(o[n])}return t}return void 0===o[e]&&console.warn("THREE.ObjectLoader: Undefined material",e),o[e]}}switch(e.type){case"Scene":r=new Pa,void 0!==e.background&&Number.isInteger(e.background)&&(r.background=new Cr(e.background)),void 0!==e.fog&&("Fog"===e.fog.type?r.fog=new Ra(e.fog.color,e.fog.near,e.fog.far):"FogExp2"===e.fog.type&&(r.fog=new Sa(e.fog.color,e.fog.density)));break;case"PerspectiveCamera":r=new ta(e.fov,e.aspect,e.near,e.far),void 0!==e.focus&&(r.focus=e.focus),void 0!==e.zoom&&(r.zoom=e.zoom),void 0!==e.filmGauge&&(r.filmGauge=e.filmGauge),void 0!==e.filmOffset&&(r.filmOffset=e.filmOffset),void 0!==e.view&&(r.view=Object.assign({},e.view));break;case"OrthographicCamera":r=new vc(e.left,e.right,e.top,e.bottom,e.near,e.far),void 0!==e.zoom&&(r.zoom=e.zoom),void 0!==e.view&&(r.view=Object.assign({},e.view));break;case"AmbientLight":r=new xc(e.color,e.intensity);break;case"DirectionalLight":r=new bc(e.color,e.intensity);break;case"PointLight":r=new gc(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":r=new Ec(e.color,e.intensity,e.width,e.height);break;case"SpotLight":r=new mc(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":r=new pc(e.color,e.groundColor,e.intensity);break;case"SkinnedMesh":console.warn("THREE.ObjectLoader.parseObject() does not support SkinnedMesh yet.");case"Mesh":var a=i(e.geometry),s=n(e.material);r=a.bones&&0<a.bones.length?new Fa(a,s):new En(a,s),void 0!==e.drawMode&&r.setDrawMode(e.drawMode);break;case"LOD":r=new Ha;break;case"Line":r=new Na(i(e.geometry),n(e.material),e.mode);break;case"LineLoop":r=new Ua(i(e.geometry),n(e.material));break;case"LineSegments":r=new Da(i(e.geometry),n(e.material));break;case"PointCloud":case"Points":r=new Ba(i(e.geometry),n(e.material));break;case"Sprite":r=new Oa(n(e.material));break;case"Group":r=new $o;break;default:r=new oi}if(r.uuid=e.uuid,void 0!==e.name&&(r.name=e.name),void 0!==e.matrix?(r.matrix.fromArray(e.matrix),void 0!==e.matrixAutoUpdate&&(r.matrixAutoUpdate=e.matrixAutoUpdate),r.matrixAutoUpdate&&r.matrix.decompose(r.position,r.quaternion,r.scale)):(void 0!==e.position&&r.position.fromArray(e.position),void 0!==e.rotation&&r.rotation.fromArray(e.rotation),void 0!==e.quaternion&&r.quaternion.fromArray(e.quaternion),void 0!==e.scale&&r.scale.fromArray(e.scale)),void 0!==e.castShadow&&(r.castShadow=e.castShadow),void 0!==e.receiveShadow&&(r.receiveShadow=e.receiveShadow),e.shadow&&(void 0!==e.shadow.bias&&(r.shadow.bias=e.shadow.bias),void 0!==e.shadow.radius&&(r.shadow.radius=e.shadow.radius),void 0!==e.shadow.mapSize&&r.shadow.mapSize.fromArray(e.shadow.mapSize),void 0!==e.shadow.camera&&(r.shadow.camera=this.parseObject(e.shadow.camera))),void 0!==e.visible&&(r.visible=e.visible),void 0!==e.frustumCulled&&(r.frustumCulled=e.frustumCulled),void 0!==e.renderOrder&&(r.renderOrder=e.renderOrder),void 0!==e.userData&&(r.userData=e.userData),void 0!==e.layers&&(r.layers.mask=e.layers),void 0!==e.children)for(var l=e.children,c=0;c<l.length;c++)r.add(this.parseObject(l[c],t,o));if("LOD"===e.type)for(var u=e.levels,h=0;h<u.length;h++){var p=u[h],d=r.getObjectByProperty("uuid",p.object);void 0!==d&&r.addLevel(d,p.distance)}return r}});var Rc,Pc,Ac,Cc,Lc,Oc={UVMapping:300,CubeReflectionMapping:ve,CubeRefractionMapping:ye,EquirectangularReflectionMapping:be,EquirectangularRefractionMapping:xe,SphericalReflectionMapping:Ee,CubeUVReflectionMapping:_e,CubeUVRefractionMapping:Me},Hc={RepeatWrapping:Se,ClampToEdgeWrapping:Re,MirroredRepeatWrapping:Pe},Fc={NearestFilter:Ae,NearestMipMapNearestFilter:Ce,NearestMipMapLinearFilter:Le,LinearFilter:Oe,LinearMipMapNearestFilter:He,LinearMipMapLinearFilter:Fe};function kc(e){"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.manager=void 0!==e?e:Hl,this.options=void 0}function Ic(){this.type="ShapePath",this.color=new Cr,this.subPaths=[],this.currentPath=null}function jc(e){this.type="Font",this.data=e}function Nc(e,t,r,i,n){var o=n.glyphs[e]||n.glyphs["?"];if(o){var a,s,l,c,u,h,p,d,f=new Ic;if(o.o)for(var m=o._cachedOutline||(o._cachedOutline=o.o.split(" ")),g=0,v=m.length;g<v;){switch(m[g++]){case"m":a=m[g++]*t+r,s=m[g++]*t+i,f.moveTo(a,s);break;case"l":a=m[g++]*t+r,s=m[g++]*t+i,f.lineTo(a,s);break;case"q":l=m[g++]*t+r,c=m[g++]*t+i,u=m[g++]*t+r,h=m[g++]*t+i,f.quadraticCurveTo(u,h,l,c);break;case"b":l=m[g++]*t+r,c=m[g++]*t+i,u=m[g++]*t+r,h=m[g++]*t+i,p=m[g++]*t+r,d=m[g++]*t+i,f.bezierCurveTo(u,h,p,d,l,c)}}return{offsetX:o.ha*t,path:f}}}function Dc(e){this.manager=void 0!==e?e:Hl}function Uc(){}kc.prototype={constructor:kc,setOptions:function(e){return this.options=e,this},load:function(t,r,e,i){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);var n=this,o=Ll.get(t);if(void 0!==o)return n.manager.itemStart(t),setTimeout(function(){r&&r(o),n.manager.itemEnd(t)},0),o;fetch(t).then(function(e){return e.blob()}).then(function(e){return createImageBitmap(e,n.options)}).then(function(e){Ll.add(t,e),r&&r(e),n.manager.itemEnd(t)}).catch(function(e){i&&i(e),n.manager.itemError(t),n.manager.itemEnd(t)})},setCrossOrigin:function(){return this},setPath:function(e){return this.path=e,this}},Object.assign(Ic.prototype,{moveTo:function(e,t){this.currentPath=new cc,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t)},lineTo:function(e,t){this.currentPath.lineTo(e,t)},quadraticCurveTo:function(e,t,r,i){this.currentPath.quadraticCurveTo(e,t,r,i)},bezierCurveTo:function(e,t,r,i,n,o){this.currentPath.bezierCurveTo(e,t,r,i,n,o)},splineThru:function(e){this.currentPath.splineThru(e)},toShapes:function(e,t){function r(e){for(var t=[],r=0,i=e.length;r<i;r++){var n=e[r],o=new uc;o.curves=n.curves,t.push(o)}return t}function i(e,t){for(var r=t.length,i=!1,n=r-1,o=0;o<r;n=o++){var a=t[n],s=t[o],l=s.x-a.x,c=s.y-a.y;if(Math.abs(c)>Number.EPSILON){if(c<0&&(a=t[o],l=-l,s=t[n],c=-c),e.y<a.y||e.y>s.y)continue;if(e.y===a.y){if(e.x===a.x)return!0}else{var u=c*(e.x-a.x)-l*(e.y-a.y);if(0===u)return!0;if(u<0)continue;i=!i}}else{if(e.y!==a.y)continue;if(s.x<=e.x&&e.x<=a.x||a.x<=e.x&&e.x<=s.x)return!0}}return i}var n=Hs.isClockWise,o=this.subPaths;if(0===o.length)return[];if(!0===t)return r(o);var a,s,l,c=[];if(1===o.length)return s=o[0],(l=new uc).curves=s.curves,c.push(l),c;var u=!n(o[0].getPoints());u=e?!u:u;var h,p,d=[],f=[],m=[],g=0;f[g]=void 0,m[g]=[];for(var v=0,y=o.length;v<y;v++)a=n(h=(s=o[v]).getPoints()),(a=e?!a:a)?(!u&&f[g]&&g++,f[g]={s:new uc,p:h},f[g].s.curves=s.curves,u&&g++,m[g]=[]):m[g].push({h:s,p:h[0]});if(!f[0])return r(o);if(1<f.length){for(var b=!1,x=[],E=0,_=f.length;E<_;E++)d[E]=[];for(E=0,_=f.length;E<_;E++)for(var w=m[E],T=0;T<w.length;T++){for(var M=w[T],S=!0,R=0;R<f.length;R++)i(M.p,f[R].p)&&(E!==R&&x.push({froms:E,tos:R,hole:T}),S?(S=!1,d[R].push(M)):b=!0);S&&d[E].push(M)}0<x.length&&(b||(m=d))}v=0;for(var P=f.length;v<P;v++){l=f[v].s,c.push(l);for(var A=0,C=(p=m[v]).length;A<C;A++)l.holes.push(p[A].h)}return c}}),Object.assign(jc.prototype,{isFont:!0,generateShapes:function(e,t){void 0===t&&(t=100);for(var r=[],i=function(e,t,r){for(var i=Array.from?Array.from(e):String(e).split(""),n=t/r.resolution,o=(r.boundingBox.yMax-r.boundingBox.yMin+r.underlineThickness)*n,a=[],s=0,l=0,c=0;c<i.length;c++){var u=i[c];if("\n"===u)s=0,l-=o;else{var h=Nc(u,n,s,l,r);s+=h.offsetX,a.push(h.path)}}return a}(e,t,this.data),n=0,o=i.length;n<o;n++)Array.prototype.push.apply(r,i[n].toShapes());return r}}),Object.assign(Dc.prototype,{load:function(e,i,t,r){var n=this,o=new kl(this.manager);o.setPath(this.path),o.load(e,function(t){var r;try{r=JSON.parse(t)}catch(e){console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),r=JSON.parse(t.substring(65,t.length-2))}var e=n.parse(r);i&&i(e)},t,r)},parse:function(e){return new jc(e)},setPath:function(e){return this.path=e,this}}),Uc.Handlers={handlers:[],add:function(e,t){this.handlers.push(e,t)},get:function(e){for(var t=this.handlers,r=0,i=t.length;r<i;r+=2){var n=t[r],o=t[r+1];if(n.test(e))return o}return null}},Object.assign(Uc.prototype,{crossOrigin:"anonymous",onLoadStart:function(){},onLoadProgress:function(){},onLoadComplete:function(){},initMaterials:function(e,t,r){for(var i=[],n=0;n<e.length;++n)i[n]=this.createMaterial(e[n],t,r);return i},createMaterial:(Rc={NoBlending:Q,NormalBlending:J,AdditiveBlending:Z,SubtractiveBlending:K,MultiplyBlending:$,CustomBlending:te},Pc=new Cr,Ac=new Vl,Cc=new _c,function(e,c,u){var h={};function t(e,t,r,i,n){var o,a=c+e,s=Uc.Handlers.get(a);o=null!==s?s.load(a):(Ac.setCrossOrigin(u),Ac.load(a)),void 0!==t&&(o.repeat.fromArray(t),1!==t[0]&&(o.wrapS=Se),1!==t[1]&&(o.wrapT=Se)),void 0!==r&&o.offset.fromArray(r),void 0!==i&&("repeat"===i[0]&&(o.wrapS=Se),"mirror"===i[0]&&(o.wrapS=Pe),"repeat"===i[1]&&(o.wrapT=Se),"mirror"===i[1]&&(o.wrapT=Pe)),void 0!==n&&(o.anisotropy=n);var l=Bt.generateUUID();return h[l]=o,l}var r={uuid:Bt.generateUUID(),type:"MeshLambertMaterial"};for(var i in e){var n=e[i];switch(i){case"DbgColor":case"DbgIndex":case"opticalDensity":case"illumination":break;case"DbgName":r.name=n;break;case"blending":r.blending=Rc[n];break;case"colorAmbient":case"mapAmbient":console.warn("THREE.Loader.createMaterial:",i,"is no longer supported.");break;case"colorDiffuse":r.color=Pc.fromArray(n).getHex();break;case"colorSpecular":r.specular=Pc.fromArray(n).getHex();break;case"colorEmissive":r.emissive=Pc.fromArray(n).getHex();break;case"specularCoef":r.shininess=n;break;case"shading":"basic"===n.toLowerCase()&&(r.type="MeshBasicMaterial"),"phong"===n.toLowerCase()&&(r.type="MeshPhongMaterial"),"standard"===n.toLowerCase()&&(r.type="MeshStandardMaterial");break;case"mapDiffuse":r.map=t(n,e.mapDiffuseRepeat,e.mapDiffuseOffset,e.mapDiffuseWrap,e.mapDiffuseAnisotropy);break;case"mapDiffuseRepeat":case"mapDiffuseOffset":case"mapDiffuseWrap":case"mapDiffuseAnisotropy":break;case"mapEmissive":r.emissiveMap=t(n,e.mapEmissiveRepeat,e.mapEmissiveOffset,e.mapEmissiveWrap,e.mapEmissiveAnisotropy);break;case"mapEmissiveRepeat":case"mapEmissiveOffset":case"mapEmissiveWrap":case"mapEmissiveAnisotropy":break;case"mapLight":r.lightMap=t(n,e.mapLightRepeat,e.mapLightOffset,e.mapLightWrap,e.mapLightAnisotropy);break;case"mapLightRepeat":case"mapLightOffset":case"mapLightWrap":case"mapLightAnisotropy":break;case"mapAO":r.aoMap=t(n,e.mapAORepeat,e.mapAOOffset,e.mapAOWrap,e.mapAOAnisotropy);break;case"mapAORepeat":case"mapAOOffset":case"mapAOWrap":case"mapAOAnisotropy":break;case"mapBump":r.bumpMap=t(n,e.mapBumpRepeat,e.mapBumpOffset,e.mapBumpWrap,e.mapBumpAnisotropy);break;case"mapBumpScale":r.bumpScale=n;break;case"mapBumpRepeat":case"mapBumpOffset":case"mapBumpWrap":case"mapBumpAnisotropy":break;case"mapNormal":r.normalMap=t(n,e.mapNormalRepeat,e.mapNormalOffset,e.mapNormalWrap,e.mapNormalAnisotropy);break;case"mapNormalFactor":r.normalScale=n;break;case"mapNormalRepeat":case"mapNormalOffset":case"mapNormalWrap":case"mapNormalAnisotropy":break;case"mapSpecular":r.specularMap=t(n,e.mapSpecularRepeat,e.mapSpecularOffset,e.mapSpecularWrap,e.mapSpecularAnisotropy);break;case"mapSpecularRepeat":case"mapSpecularOffset":case"mapSpecularWrap":case"mapSpecularAnisotropy":break;case"mapMetalness":r.metalnessMap=t(n,e.mapMetalnessRepeat,e.mapMetalnessOffset,e.mapMetalnessWrap,e.mapMetalnessAnisotropy);break;case"mapMetalnessRepeat":case"mapMetalnessOffset":case"mapMetalnessWrap":case"mapMetalnessAnisotropy":break;case"mapRoughness":r.roughnessMap=t(n,e.mapRoughnessRepeat,e.mapRoughnessOffset,e.mapRoughnessWrap,e.mapRoughnessAnisotropy);break;case"mapRoughnessRepeat":case"mapRoughnessOffset":case"mapRoughnessWrap":case"mapRoughnessAnisotropy":break;case"mapAlpha":r.alphaMap=t(n,e.mapAlphaRepeat,e.mapAlphaOffset,e.mapAlphaWrap,e.mapAlphaAnisotropy);break;case"mapAlphaRepeat":case"mapAlphaOffset":case"mapAlphaWrap":case"mapAlphaAnisotropy":break;case"flipSided":r.side=we;break;case"doubleSided":r.side=ee;break;case"transparency":console.warn("THREE.Loader.createMaterial: transparency has been renamed to opacity"),r.opacity=n;break;case"depthTest":case"depthWrite":case"colorWrite":case"opacity":case"reflectivity":case"transparent":case"visible":case"wireframe":r[i]=n;break;case"vertexColors":!0===n&&(r.vertexColors=M),"face"===n&&(r.vertexColors=1);break;default:console.error("THREE.Loader.createMaterial: Unsupported",i,n)}}return"MeshBasicMaterial"===r.type&&delete r.emissive,"MeshPhongMaterial"!==r.type&&delete r.specular,r.opacity<1&&(r.transparent=!0),Cc.setTextures(h),Cc.parse(r)})});var Vc,Bc,zc,qc,Gc,Wc,Xc,Yc,Qc,Jc,Zc,Kc,$c,eu,tu,ru,iu,nu,ou,au={getContext:function(){return void 0===Lc&&(Lc=new(window.AudioContext||window.webkitAudioContext)),Lc},setContext:function(e){Lc=e}};function su(e){this.manager=void 0!==e?e:Hl}function lu(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new ta,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new ta,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1}function cu(e,t,r,i){oi.call(this),this.type="CubeCamera";var o=new ta(90,1,e,t);o.up.set(0,-1,0),o.lookAt(new Wt(1,0,0)),this.add(o);var a=new ta(90,1,e,t);a.up.set(0,-1,0),a.lookAt(new Wt(-1,0,0)),this.add(a);var s=new ta(90,1,e,t);s.up.set(0,0,1),s.lookAt(new Wt(0,1,0)),this.add(s);var l=new ta(90,1,e,t);l.up.set(0,0,-1),l.lookAt(new Wt(0,-1,0)),this.add(l);var c=new ta(90,1,e,t);c.up.set(0,-1,0),c.lookAt(new Wt(0,0,1)),this.add(c);var u=new ta(90,1,e,t);u.up.set(0,-1,0),u.lookAt(new Wt(0,0,-1)),this.add(u),i=i||{format:Ye,magFilter:Oe,minFilter:Oe},this.renderTarget=new gr(r,r,i),this.renderTarget.texture.name="CubeCamera",this.update=function(e,t){null===this.parent&&this.updateMatrixWorld();var r=e.getRenderTarget(),i=this.renderTarget,n=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,i.activeCubeFace=0,e.render(t,o,i),i.activeCubeFace=1,e.render(t,a,i),i.activeCubeFace=2,e.render(t,s,i),i.activeCubeFace=3,e.render(t,l,i),i.activeCubeFace=4,e.render(t,c,i),i.texture.generateMipmaps=n,i.activeCubeFace=5,e.render(t,u,i),e.setRenderTarget(r)},this.clear=function(e,t,r,i){for(var n=e.getRenderTarget(),o=this.renderTarget,a=0;a<6;a++)o.activeCubeFace=a,e.setRenderTarget(o),e.clear(t,r,i);e.setRenderTarget(n)}}function uu(e){this.autoStart=void 0===e||e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}function hu(){oi.call(this),this.type="AudioListener",this.context=au.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0}function pu(e){oi.call(this),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.startTime=0,this.offset=0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.sourceType="empty",this.filters=[]}function du(e){pu.call(this,e),this.panner=this.context.createPanner(),this.panner.connect(this.gain)}function fu(e,t){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=void 0!==t?t:2048,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}function mu(e,t,r){this.binding=e,this.valueSize=r;var i,n=Float64Array;switch(t){case"quaternion":i=this._slerp;break;case"string":case"bool":n=Array,i=this._select;break;default:i=this._lerp}this.buffer=new n(4*r),this._mixBufferRegion=i,this.cumulativeWeight=0,this.useCount=0,this.referenceCount=0}Object.assign(su.prototype,{load:function(e,r,t,i){var n=new kl(this.manager);n.setResponseType("arraybuffer"),n.setPath(this.path),n.load(e,function(e){var t=e.slice(0);au.getContext().decodeAudioData(t,function(e){r(e)})},t,i)},setPath:function(e){return this.path=e,this}}),Object.assign(lu.prototype,{update:(Qc=new qt,Jc=new qt,function(e){if(Vc!==this||Bc!==e.focus||zc!==e.fov||qc!==e.aspect*this.aspect||Gc!==e.near||Wc!==e.far||Xc!==e.zoom||Yc!==this.eyeSep){Vc=this,Bc=e.focus,zc=e.fov,qc=e.aspect*this.aspect,Gc=e.near,Wc=e.far,Xc=e.zoom;var t,r,i=e.projectionMatrix.clone(),n=(Yc=this.eyeSep/2)*Gc/Bc,o=Gc*Math.tan(Bt.DEG2RAD*zc*.5)/Xc;Jc.elements[12]=-Yc,Qc.elements[12]=Yc,t=-o*qc+n,r=o*qc+n,i.elements[0]=2*Gc/(r-t),i.elements[8]=(r+t)/(r-t),this.cameraL.projectionMatrix.copy(i),t=-o*qc-n,r=o*qc-n,i.elements[0]=2*Gc/(r-t),i.elements[8]=(r+t)/(r-t),this.cameraR.projectionMatrix.copy(i)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(Jc),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(Qc)})}),(cu.prototype=Object.create(oi.prototype)).constructor=cu,Object.assign(uu.prototype,{start:function(){this.startTime=("undefined"==typeof performance?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0},stop:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var t=("undefined"==typeof performance?Date:performance).now();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}),hu.prototype=Object.assign(Object.create(oi.prototype),{constructor:hu,getInput:function(){return this.gain},removeFilter:function(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this},getFilter:function(){return this.filter},setFilter:function(e){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this},getMasterVolume:function(){return this.gain.gain.value},setMasterVolume:function(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this},updateMatrixWorld:(Zc=new Wt,Kc=new Gt,$c=new Wt,eu=new Wt,tu=new uu,function(e){oi.prototype.updateMatrixWorld.call(this,e);var t=this.context.listener,r=this.up;if(this.timeDelta=tu.getDelta(),this.matrixWorld.decompose(Zc,Kc,$c),eu.set(0,0,-1).applyQuaternion(Kc),t.positionX){var i=this.context.currentTime+this.timeDelta;t.positionX.linearRampToValueAtTime(Zc.x,i),t.positionY.linearRampToValueAtTime(Zc.y,i),t.positionZ.linearRampToValueAtTime(Zc.z,i),t.forwardX.linearRampToValueAtTime(eu.x,i),t.forwardY.linearRampToValueAtTime(eu.y,i),t.forwardZ.linearRampToValueAtTime(eu.z,i),t.upX.linearRampToValueAtTime(r.x,i),t.upY.linearRampToValueAtTime(r.y,i),t.upZ.linearRampToValueAtTime(r.z,i)}else t.setPosition(Zc.x,Zc.y,Zc.z),t.setOrientation(eu.x,eu.y,eu.z,r.x,r.y,r.z)})}),pu.prototype=Object.assign(Object.create(oi.prototype),{constructor:pu,getOutput:function(){return this.gain},setNodeSource:function(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this},setMediaElementSource:function(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this},setBuffer:function(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this},play:function(){if(!0!==this.isPlaying){if(!1!==this.hasPlaybackControl){var e=this.context.createBufferSource();return e.buffer=this.buffer,e.loop=this.loop,e.onended=this.onEnded.bind(this),this.startTime=this.context.currentTime,e.start(this.startTime,this.offset),this.isPlaying=!0,this.source=e,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}console.warn("THREE.Audio: this Audio has no playback control.")}else console.warn("THREE.Audio: Audio is already playing.")},pause:function(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this.source.stop(),this.source.onended=null,this.offset+=(this.context.currentTime-this.startTime)*this.playbackRate,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")},stop:function(){if(!1!==this.hasPlaybackControl)return this.source.stop(),this.source.onended=null,this.offset=0,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")},connect:function(){if(0<this.filters.length){this.source.connect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this},disconnect:function(){if(0<this.filters.length){this.source.disconnect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this},getFilters:function(){return this.filters},setFilters:function(e){return e||(e=[]),!0===this.isPlaying?(this.disconnect(),this.filters=e,this.connect()):this.filters=e,this},setDetune:function(e){if(this.detune=e,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this},getDetune:function(){return this.detune},getFilter:function(){return this.getFilters()[0]},setFilter:function(e){return this.setFilters(e?[e]:[])},setPlaybackRate:function(e){if(!1!==this.hasPlaybackControl)return this.playbackRate=e,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")},getPlaybackRate:function(){return this.playbackRate},onEnded:function(){this.isPlaying=!1},getLoop:function(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop},setLoop:function(e){if(!1!==this.hasPlaybackControl)return this.loop=e,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")},getVolume:function(){return this.gain.gain.value},setVolume:function(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}}),du.prototype=Object.assign(Object.create(pu.prototype),{constructor:du,getOutput:function(){return this.panner},getRefDistance:function(){return this.panner.refDistance},setRefDistance:function(e){return this.panner.refDistance=e,this},getRolloffFactor:function(){return this.panner.rolloffFactor},setRolloffFactor:function(e){return this.panner.rolloffFactor=e,this},getDistanceModel:function(){return this.panner.distanceModel},setDistanceModel:function(e){return this.panner.distanceModel=e,this},getMaxDistance:function(){return this.panner.maxDistance},setMaxDistance:function(e){return this.panner.maxDistance=e,this},setDirectionalCone:function(e,t,r){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=r,this},updateMatrixWorld:(ru=new Wt,iu=new Gt,nu=new Wt,ou=new Wt,function(e){if(oi.prototype.updateMatrixWorld.call(this,e),!1!==this.isPlaying){this.matrixWorld.decompose(ru,iu,nu),ou.set(0,0,1).applyQuaternion(iu);var t=this.panner;if(t.positionX){var r=this.context.currentTime+this.listener.timeDelta;t.positionX.linearRampToValueAtTime(ru.x,r),t.positionY.linearRampToValueAtTime(ru.y,r),t.positionZ.linearRampToValueAtTime(ru.z,r),t.orientationX.linearRampToValueAtTime(ou.x,r),t.orientationY.linearRampToValueAtTime(ou.y,r),t.orientationZ.linearRampToValueAtTime(ou.z,r)}else t.setPosition(ru.x,ru.y,ru.z),t.setOrientation(ou.x,ou.y,ou.z)}})}),Object.assign(fu.prototype,{getFrequencyData:function(){return this.analyser.getByteFrequencyData(this.data),this.data},getAverageFrequency:function(){for(var e=0,t=this.getFrequencyData(),r=0;r<t.length;r++)e+=t[r];return e/t.length}}),Object.assign(mu.prototype,{accumulate:function(e,t){var r=this.buffer,i=this.valueSize,n=e*i+i,o=this.cumulativeWeight;if(0===o){for(var a=0;a!==i;++a)r[n+a]=r[a];o=t}else{var s=t/(o+=t);this._mixBufferRegion(r,n,0,s,i)}this.cumulativeWeight=o},apply:function(e){var t=this.valueSize,r=this.buffer,i=e*t+t,n=this.cumulativeWeight,o=this.binding;if(this.cumulativeWeight=0,n<1){var a=3*t;this._mixBufferRegion(r,i,a,1-n,t)}for(var s=t,l=t+t;s!==l;++s)if(r[s]!==r[s+t]){o.setValue(r,i);break}},saveOriginalState:function(){var e=this.binding,t=this.buffer,r=this.valueSize,i=3*r;e.getValue(t,i);for(var n=r,o=i;n!==o;++n)t[n]=t[i+n%r];this.cumulativeWeight=0},restoreOriginalState:function(){var e=3*this.valueSize;this.binding.setValue(this.buffer,e)},_select:function(e,t,r,i,n){if(.5<=i)for(var o=0;o!==n;++o)e[t+o]=e[r+o]},_slerp:function(e,t,r,i){Gt.slerpFlat(e,t,e,t,e,r,i)},_lerp:function(e,t,r,i,n){for(var o=1-i,a=0;a!==n;++a){var s=t+a;e[s]=e[s]*o+e[r+a]*i}}});var gu,vu,yu,bu,xu,Eu,_u,wu,Tu,Mu,Su,Ru,Pu,Au,Cu,Lu,Ou,Hu,Fu,ku,Iu,ju,Nu,Du,Uu,Vu,Bu,zu,qu,Gu,Wu,Xu,Yu,Qu,Ju="\\[\\]\\.:\\/";function Zu(e,t,r){var i=r||Ku.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,i)}function Ku(e,t,r){this.path=t,this.parsedPath=r||Ku.parseTrackName(t),this.node=Ku.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e}function $u(){this.uuid=Bt.generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;var e={};this._indicesByUUID=e;for(var t=0,r=arguments.length;t!==r;++t)e[arguments[t].uuid]=t;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};var i=this;this.stats={objects:{get total(){return i._objects.length},get inUse(){return this.total-i.nCachedObjects_}},get bindingsPerObject(){return i._bindings.length}}}function eh(e,t,r){this._mixer=e,this._clip=t,this._localRoot=r||null;for(var i=t.tracks,n=i.length,o=new Array(n),a={endingStart:Rt,endingEnd:Rt},s=0;s!==n;++s){var l=i[s].createInterpolant(null);(o[s]=l).settings=a}this._interpolantSettings=a,this._interpolants=o,this._propertyBindings=new Array(n),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=2201,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}function th(e){this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}function rh(e){"string"==typeof e&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),e=arguments[1]),this.value=e}function ih(){Ni.call(this),this.type="InstancedBufferGeometry",this.maxInstancedCount=void 0}function nh(e,t,r){Aa.call(this,e,t),this.meshPerAttribute=r||1}function oh(e,t,r,i){"number"==typeof r&&(i=r,r=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),mi.call(this,e,t,r),this.meshPerAttribute=i||1}function ah(e,t,r,i){this.ray=new yn(e,t),this.near=r||0,this.far=i||1/0,this.params={Mesh:{},Line:{},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})}function sh(e,t){return e.distance-t.distance}function lh(e,t,r,i){if(!1!==e.visible&&(e.raycast(t,r),!0===i))for(var n=e.children,o=0,a=n.length;o<a;o++)lh(n[o],t,r,!0)}function ch(e,t,r){return this.radius=void 0!==e?e:1,this.phi=void 0!==t?t:0,this.theta=void 0!==r?r:0,this}function uh(e,t,r){return this.radius=void 0!==e?e:1,this.theta=void 0!==t?t:0,this.y=void 0!==r?r:0,this}function hh(e,t){this.min=void 0!==e?e:new zt(1/0,1/0),this.max=void 0!==t?t:new zt(-1/0,-1/0)}function ph(e,t){this.start=void 0!==e?e:new Wt,this.end=void 0!==t?t:new Wt}function dh(e){oi.call(this),this.material=e,this.render=function(){}}function fh(e,t,r,i){this.object=e,this.size=void 0!==t?t:1;var n=void 0!==r?r:16711680,o=void 0!==i?i:1,a=0,s=this.object.geometry;s&&s.isGeometry?a=3*s.faces.length:s&&s.isBufferGeometry&&(a=s.attributes.normal.count);var l=new Ni,c=new wi(2*a*3,3);l.addAttribute("position",c),Da.call(this,l,new ja({color:n,linewidth:o})),this.matrixAutoUpdate=!1,this.update()}function mh(e,t){oi.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t;for(var r=new Ni,i=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1],n=0,o=1;n<32;n++,o++){var a=n/32*Math.PI*2,s=o/32*Math.PI*2;i.push(Math.cos(a),Math.sin(a),1,Math.cos(s),Math.sin(s),1)}r.addAttribute("position",new wi(i,3));var l=new ja({fog:!1});this.cone=new Da(r,l),this.add(this.cone),this.update()}function gh(e){for(var t=function e(t){var r=[];t&&t.isBone&&r.push(t);for(var i=0;i<t.children.length;i++)r.push.apply(r,e(t.children[i]));return r}(e),r=new Ni,i=[],n=[],o=new Cr(0,0,1),a=new Cr(0,1,0),s=0;s<t.length;s++){var l=t[s];l.parent&&l.parent.isBone&&(i.push(0,0,0),i.push(0,0,0),n.push(o.r,o.g,o.b),n.push(a.r,a.g,a.b))}r.addAttribute("position",new wi(i,3)),r.addAttribute("color",new wi(n,3));var c=new ja({vertexColors:M,depthTest:!1,depthWrite:!1,transparent:!0});Da.call(this,r,c),this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}function vh(e,t,r){this.light=e,this.light.updateMatrixWorld(),this.color=r;var i=new zs(t,4,2),n=new xn({wireframe:!0,fog:!1});En.call(this,i,n),this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}function yh(e,t){this.type="RectAreaLightHelper",this.light=e,this.color=t;var r=new Ni;r.addAttribute("position",new wi([1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],3)),r.computeBoundingSphere();var i=new ja({fog:!1});Na.call(this,r,i);var n=new Ni;n.addAttribute("position",new wi([1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],3)),n.computeBoundingSphere(),this.add(new En(n,new xn({side:we,fog:!1}))),this.update()}function bh(e,t,r){oi.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=r;var i=new ts(t);i.rotateY(.5*Math.PI),this.material=new xn({wireframe:!0,fog:!1}),void 0===this.color&&(this.material.vertexColors=M);var n=i.getAttribute("position"),o=new Float32Array(3*n.count);i.addAttribute("color",new mi(o,3)),this.add(new En(i,this.material)),this.update()}function xh(e,t,r,i){e=e||10,t=t||10,r=new Cr(void 0!==r?r:4473924),i=new Cr(void 0!==i?i:8947848);for(var n=t/2,o=e/t,a=e/2,s=[],l=[],c=0,u=0,h=-a;c<=t;c++,h+=o){s.push(-a,0,h,a,0,h),s.push(h,0,-a,h,0,a);var p=c===n?r:i;p.toArray(l,u),u+=3,p.toArray(l,u),u+=3,p.toArray(l,u),u+=3,p.toArray(l,u),u+=3}var d=new Ni;d.addAttribute("position",new wi(s,3)),d.addAttribute("color",new wi(l,3));var f=new ja({vertexColors:M});Da.call(this,d,f)}function Eh(e,t,r,i,n,o){e=e||10,t=t||16,r=r||8,i=i||64,n=new Cr(void 0!==n?n:4473924),o=new Cr(void 0!==o?o:8947848);var a,s,l,c,u,h,p,d=[],f=[];for(c=0;c<=t;c++)l=c/t*(2*Math.PI),a=Math.sin(l)*e,s=Math.cos(l)*e,d.push(0,0,0),d.push(a,0,s),p=1&c?n:o,f.push(p.r,p.g,p.b),f.push(p.r,p.g,p.b);for(c=0;c<=r;c++)for(p=1&c?n:o,h=e-e/r*c,u=0;u<i;u++)l=u/i*(2*Math.PI),a=Math.sin(l)*h,s=Math.cos(l)*h,d.push(a,0,s),f.push(p.r,p.g,p.b),l=(u+1)/i*(2*Math.PI),a=Math.sin(l)*h,s=Math.cos(l)*h,d.push(a,0,s),f.push(p.r,p.g,p.b);var m=new Ni;m.addAttribute("position",new wi(d,3)),m.addAttribute("color",new wi(f,3));var g=new ja({vertexColors:M});Da.call(this,m,g)}function _h(e,t,r,i){this.object=e,this.size=void 0!==t?t:1;var n=void 0!==r?r:16776960,o=void 0!==i?i:1,a=0,s=this.object.geometry;s&&s.isGeometry?a=s.faces.length:console.warn("THREE.FaceNormalsHelper: only THREE.Geometry is supported. Use THREE.VertexNormalsHelper, instead.");var l=new Ni,c=new wi(2*a*3,3);l.addAttribute("position",c),Da.call(this,l,new ja({color:n,linewidth:o})),this.matrixAutoUpdate=!1,this.update()}function wh(e,t,r){oi.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=r,void 0===t&&(t=1);var i=new Ni;i.addAttribute("position",new wi([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));var n=new ja({fog:!1});this.lightPlane=new Na(i,n),this.add(this.lightPlane),(i=new Ni).addAttribute("position",new wi([0,0,0,0,0,1],3)),this.targetLine=new Na(i,n),this.add(this.targetLine),this.update()}function Th(e){var t=new Ni,r=new ja({color:16777215,vertexColors:1}),i=[],n=[],o={},a=new Cr(16755200),s=new Cr(16711680),l=new Cr(43775),c=new Cr(16777215),u=new Cr(3355443);function h(e,t,r){p(e,r),p(t,r)}function p(e,t){i.push(0,0,0),n.push(t.r,t.g,t.b),void 0===o[e]&&(o[e]=[]),o[e].push(i.length/3-1)}h("n1","n2",a),h("n2","n4",a),h("n4","n3",a),h("n3","n1",a),h("f1","f2",a),h("f2","f4",a),h("f4","f3",a),h("f3","f1",a),h("n1","f1",a),h("n2","f2",a),h("n3","f3",a),h("n4","f4",a),h("p","n1",s),h("p","n2",s),h("p","n3",s),h("p","n4",s),h("u1","u2",l),h("u2","u3",l),h("u3","u1",l),h("c","t",c),h("p","c",u),h("cn1","cn2",u),h("cn3","cn4",u),h("cf1","cf2",u),h("cf3","cf4",u),t.addAttribute("position",new wi(i,3)),t.addAttribute("color",new wi(n,3)),Da.call(this,t,r),this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=o,this.update()}function Mh(e,t){this.object=e,void 0===t&&(t=16776960);var r=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=new Float32Array(24),n=new Ni;n.setIndex(new mi(r,1)),n.addAttribute("position",new mi(i,3)),Da.call(this,n,new ja({color:t})),this.matrixAutoUpdate=!1,this.update()}function Sh(e,t){this.type="Box3Helper",this.box=e;var r=void 0!==t?t:16776960,i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=new Ni;n.setIndex(new mi(i,1)),n.addAttribute("position",new wi([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),Da.call(this,n,new ja({color:r})),this.geometry.computeBoundingSphere()}function Rh(e,t,r){this.type="PlaneHelper",this.plane=e,this.size=void 0===t?1:t;var i=void 0!==r?r:16776960,n=new Ni;n.addAttribute("position",new wi([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3)),n.computeBoundingSphere(),Na.call(this,n,new ja({color:i}));var o=new Ni;o.addAttribute("position",new wi([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3)),o.computeBoundingSphere(),this.add(new En(o,new xn({color:i,opacity:.2,transparent:!0,depthWrite:!1})))}function Ph(e,t,r,i,n,o){oi.call(this),void 0===e&&(e=new Wt(0,0,1)),void 0===t&&(t=new Wt(0,0,0)),void 0===r&&(r=1),void 0===i&&(i=16776960),void 0===n&&(n=.2*r),void 0===o&&(o=.2*n),void 0===Wu&&((Wu=new Ni).addAttribute("position",new wi([0,0,0,0,1,0],3)),(Xu=new $s(0,.5,1,5,1)).translate(0,-.5,0)),this.position.copy(t),this.line=new Na(Wu,new ja({color:i})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new En(Xu,new xn({color:i})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(r,n,o)}function Ah(e){var t=[0,0,0,e=e||1,0,0,0,0,0,0,e,0,0,0,0,0,0,e],r=new Ni;r.addAttribute("position",new wi(t,3)),r.addAttribute("color",new wi([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));var i=new ja({vertexColors:M});Da.call(this,r,i)}Object.assign(Zu.prototype,{getValue:function(e,t){this.bind();var r=this._targetGroup.nCachedObjects_,i=this._bindings[r];void 0!==i&&i.getValue(e,t)},setValue:function(e,t){for(var r=this._bindings,i=this._targetGroup.nCachedObjects_,n=r.length;i!==n;++i)r[i].setValue(e,t)},bind:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,r=e.length;t!==r;++t)e[t].bind()},unbind:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,r=e.length;t!==r;++t)e[t].unbind()}}),Object.assign(Ku,{Composite:Zu,create:function(e,t,r){return e&&e.isAnimationObjectGroup?new Ku.Composite(e,t,r):new Ku(e,t,r)},sanitizeNodeName:(Tu=new RegExp("["+Ju+"]","g"),function(e){return e.replace(/\s/g,"_").replace(Tu,"")}),parseTrackName:(gu="[^"+Ju+"]",vu="[^"+Ju.replace("\\.","")+"]",yu=/((?:WC+[\/:])*)/.source.replace("WC",gu),bu=/(WCOD+)?/.source.replace("WCOD",vu),xu=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",gu),Eu=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",gu),_u=new RegExp("^"+yu+bu+xu+Eu+"$"),wu=["material","materials","bones"],function(e){var t=_u.exec(e);if(!t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);var r={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},i=r.nodeName&&r.nodeName.lastIndexOf(".");if(void 0!==i&&-1!==i){var n=r.nodeName.substring(i+1);-1!==wu.indexOf(n)&&(r.nodeName=r.nodeName.substring(0,i),r.objectName=n)}if(null===r.propertyName||0===r.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return r}),findNode:function(e,n){if(!n||""===n||"root"===n||"."===n||-1===n||n===e.name||n===e.uuid)return e;if(e.skeleton){var t=e.skeleton.getBoneByName(n);if(void 0!==t)return t}if(e.children){var o=function(e){for(var t=0;t<e.length;t++){var r=e[t];if(r.name===n||r.uuid===n)return r;var i=o(r.children);if(i)return i}return null},r=o(e.children);if(r)return r}return null}}),Object.assign(Ku.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(e,t){e[t]=this.node[this.propertyName]},function(e,t){for(var r=this.resolvedProperty,i=0,n=r.length;i!==n;++i)e[t++]=r[i]},function(e,t){e[t]=this.resolvedProperty[this.propertyIndex]},function(e,t){this.resolvedProperty.toArray(e,t)}],SetterByBindingTypeAndVersioning:[[function(e,t){this.targetObject[this.propertyName]=e[t]},function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0},function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){for(var r=this.resolvedProperty,i=0,n=r.length;i!==n;++i)r[i]=e[t++]},function(e,t){for(var r=this.resolvedProperty,i=0,n=r.length;i!==n;++i)r[i]=e[t++];this.targetObject.needsUpdate=!0},function(e,t){for(var r=this.resolvedProperty,i=0,n=r.length;i!==n;++i)r[i]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){this.resolvedProperty[this.propertyIndex]=e[t]},function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0},function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){this.resolvedProperty.fromArray(e,t)},function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0},function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}]],getValue:function(e,t){this.bind(),this.getValue(e,t)},setValue:function(e,t){this.bind(),this.setValue(e,t)},bind:function(){var e=this.node,t=this.parsedPath,r=t.objectName,i=t.propertyName,n=t.propertyIndex;if(e||(e=Ku.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,e){if(r){var o=t.objectIndex;switch(r){case"materials":if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);e=e.skeleton.bones;for(var a=0;a<e.length;a++)if(e[a].name===o){o=a;break}break;default:if(void 0===e[r])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);e=e[r]}if(void 0!==o){if(void 0===e[o])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);e=e[o]}}var s=e[i];if(void 0!==s){var l=this.Versioning.None;void 0!==(this.targetObject=e).needsUpdate?l=this.Versioning.NeedsUpdate:void 0!==e.matrixWorldNeedsUpdate&&(l=this.Versioning.MatrixWorldNeedsUpdate);var c=this.BindingType.Direct;if(void 0!==n){if("morphTargetInfluences"===i){if(!e.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(e.geometry.isBufferGeometry){if(!e.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);for(a=0;a<this.node.geometry.morphAttributes.position.length;a++)if(e.geometry.morphAttributes.position[a].name===n){n=a;break}}else{if(!e.geometry.morphTargets)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphTargets.",this);for(a=0;a<this.node.geometry.morphTargets.length;a++)if(e.geometry.morphTargets[a].name===n){n=a;break}}}c=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=n}else void 0!==s.fromArray&&void 0!==s.toArray?(c=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(c=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=i;this.getValue=this.GetterByBindingType[c],this.setValue=this.SetterByBindingTypeAndVersioning[c][l]}else{var u=t.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+u+"."+i+" but it wasn't found.",e)}}else console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.")},unbind:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}),Object.assign(Ku.prototype,{_getValue_unbound:Ku.prototype.getValue,_setValue_unbound:Ku.prototype.setValue}),Object.assign($u.prototype,{isAnimationObjectGroup:!0,add:function(){for(var e=this._objects,t=e.length,r=this.nCachedObjects_,i=this._indicesByUUID,n=this._paths,o=this._parsedPaths,a=this._bindings,s=a.length,l=void 0,c=0,u=arguments.length;c!==u;++c){var h=arguments[c],p=h.uuid,d=i[p];if(void 0===d){d=t++,i[p]=d,e.push(h);for(var f=0,m=s;f!==m;++f)a[f].push(new Ku(h,n[f],o[f]))}else if(d<r){l=e[d];var g=--r,v=e[g];e[i[v.uuid]=d]=v,e[i[p]=g]=h;for(f=0,m=s;f!==m;++f){var y=a[f],b=y[g],x=y[d];y[d]=b,void 0===x&&(x=new Ku(h,n[f],o[f])),y[g]=x}}else e[d]!==l&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=r},remove:function(){for(var e=this._objects,t=this.nCachedObjects_,r=this._indicesByUUID,i=this._bindings,n=i.length,o=0,a=arguments.length;o!==a;++o){var s=arguments[o],l=s.uuid,c=r[l];if(void 0!==c&&t<=c){var u=t++,h=e[u];e[r[h.uuid]=c]=h,e[r[l]=u]=s;for(var p=0,d=n;p!==d;++p){var f=i[p],m=f[u],g=f[c];f[c]=m,f[u]=g}}}this.nCachedObjects_=t},uncache:function(){for(var e=this._objects,t=e.length,r=this.nCachedObjects_,i=this._indicesByUUID,n=this._bindings,o=n.length,a=0,s=arguments.length;a!==s;++a){var l=arguments[a].uuid,c=i[l];if(void 0!==c)if(delete i[l],c<r){var u=--r,h=e[u],p=e[v=--t];e[i[h.uuid]=c]=h,e[i[p.uuid]=u]=p,e.pop();for(var d=0,f=o;d!==f;++d){var m=(y=n[d])[u],g=y[v];y[c]=m,y[u]=g,y.pop()}}else{var v;e[i[(p=e[v=--t]).uuid]=c]=p,e.pop();for(d=0,f=o;d!==f;++d){var y;(y=n[d])[c]=y[v],y.pop()}}}this.nCachedObjects_=r},subscribe_:function(e,t){var r=this._bindingsIndicesByPath,i=r[e],n=this._bindings;if(void 0!==i)return n[i];var o=this._paths,a=this._parsedPaths,s=this._objects,l=s.length,c=this.nCachedObjects_,u=new Array(l);i=n.length,r[e]=i,o.push(e),a.push(t),n.push(u);for(var h=c,p=s.length;h!==p;++h){var d=s[h];u[h]=new Ku(d,e,t)}return u},unsubscribe_:function(e){var t=this._bindingsIndicesByPath,r=t[e];if(void 0!==r){var i=this._paths,n=this._parsedPaths,o=this._bindings,a=o.length-1,s=o[a];o[t[e[a]]=r]=s,o.pop(),n[r]=n[a],n.pop(),i[r]=i[a],i.pop()}}}),Object.assign(eh.prototype,{play:function(){return this._mixer._activateAction(this),this},stop:function(){return this._mixer._deactivateAction(this),this.reset()},reset:function(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()},isRunning:function(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)},isScheduled:function(){return this._mixer._isActiveAction(this)},startAt:function(e){return this._startTime=e,this},setLoop:function(e,t){return this.loop=e,this.repetitions=t,this},setEffectiveWeight:function(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()},getEffectiveWeight:function(){return this._effectiveWeight},fadeIn:function(e){return this._scheduleFading(e,0,1)},fadeOut:function(e){return this._scheduleFading(e,1,0)},crossFadeFrom:function(e,t,r){if(e.fadeOut(t),this.fadeIn(t),r){var i=this._clip.duration,n=e._clip.duration,o=n/i,a=i/n;e.warp(1,o,t),this.warp(a,1,t)}return this},crossFadeTo:function(e,t,r){return e.crossFadeFrom(this,t,r)},stopFading:function(){var e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this},setEffectiveTimeScale:function(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()},getEffectiveTimeScale:function(){return this._effectiveTimeScale},setDuration:function(e){return this.timeScale=this._clip.duration/e,this.stopWarping()},syncWith:function(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()},halt:function(e){return this.warp(this._effectiveTimeScale,0,e)},warp:function(e,t,r){var i=this._mixer,n=i.time,o=this._timeScaleInterpolant,a=this.timeScale;null===o&&(o=i._lendControlInterpolant(),this._timeScaleInterpolant=o);var s=o.parameterPositions,l=o.sampleValues;return s[0]=n,s[1]=n+r,l[0]=e/a,l[1]=t/a,this},stopWarping:function(){var e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this},getMixer:function(){return this._mixer},getClip:function(){return this._clip},getRoot:function(){return this._localRoot||this._mixer._root},_update:function(e,t,r,i){if(this.enabled){var n=this._startTime;if(null!==n){var o=(e-n)*r;if(o<0||0===r)return;this._startTime=null,t=r*o}t*=this._updateTimeScale(e);var a=this._updateTime(t),s=this._updateWeight(e);if(0<s)for(var l=this._interpolants,c=this._propertyBindings,u=0,h=l.length;u!==h;++u)l[u].evaluate(a),c[u].accumulate(i,s)}else this._updateWeight(e)},_updateWeight:function(e){var t=0;if(this.enabled){t=this.weight;var r=this._weightInterpolant;if(null!==r){var i=r.evaluate(e)[0];t*=i,e>r.parameterPositions[1]&&(this.stopFading(),0===i&&(this.enabled=!1))}}return this._effectiveWeight=t},_updateTimeScale:function(e){var t=0;if(!this.paused){t=this.timeScale;var r=this._timeScaleInterpolant;if(null!==r)t*=r.evaluate(e)[0],e>r.parameterPositions[1]&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t)}return this._effectiveTimeScale=t},_updateTime:function(e){var t=this.time+e,r=this._clip.duration,i=this.loop,n=this._loopCount,o=2202===i;if(0===e)return-1===n?t:o&&1==(1&n)?r-t:t;if(2200===i){-1===n&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(r<=t)t=r;else{if(!(t<0))break e;t=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(-1===n&&(0<=e?(n=0,this._setEndings(!0,0===this.repetitions,o)):this._setEndings(0===this.repetitions,!0,o)),r<=t||t<0){var a=Math.floor(t/r);t-=r*a,n+=Math.abs(a);var s=this.repetitions-n;if(s<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,t=0<e?r:0,this._mixer.dispatchEvent({type:"finished",action:this,direction:0<e?1:-1});else{if(1===s){var l=e<0;this._setEndings(l,!l,o)}else this._setEndings(!1,!1,o);this._loopCount=n,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:a})}}if(o&&1==(1&n))return r-(this.time=t)}return this.time=t},_setEndings:function(e,t,r){var i=this._interpolantSettings;i.endingEnd=r?i.endingStart=Pt:(i.endingStart=e?this.zeroSlopeAtStart?Pt:Rt:At,t?this.zeroSlopeAtEnd?Pt:Rt:At)},_scheduleFading:function(e,t,r){var i=this._mixer,n=i.time,o=this._weightInterpolant;null===o&&(o=i._lendControlInterpolant(),this._weightInterpolant=o);var a=o.parameterPositions,s=o.sampleValues;return a[0]=n,s[0]=t,a[1]=n+e,s[1]=r,this}}),th.prototype=Object.assign(Object.create(t.prototype),{constructor:th,_bindAction:function(e,t){var r=e._localRoot||this._root,i=e._clip.tracks,n=i.length,o=e._propertyBindings,a=e._interpolants,s=r.uuid,l=this._bindingsByRootAndName,c=l[s];void 0===c&&(c={},l[s]=c);for(var u=0;u!==n;++u){var h=i[u],p=h.name,d=c[p];if(void 0!==d)o[u]=d;else{if(void 0!==(d=o[u])){null===d._cacheIndex&&(++d.referenceCount,this._addInactiveBinding(d,s,p));continue}var f=t&&t._propertyBindings[u].binding.parsedPath;++(d=new mu(Ku.create(r,p,f),h.ValueTypeName,h.getValueSize())).referenceCount,this._addInactiveBinding(d,s,p),o[u]=d}a[u].resultBuffer=d.buffer}},_activateAction:function(e){if(!this._isActiveAction(e)){if(null===e._cacheIndex){var t=(e._localRoot||this._root).uuid,r=e._clip.uuid,i=this._actionsByClip[r];this._bindAction(e,i&&i.knownActions[0]),this._addInactiveAction(e,r,t)}for(var n=e._propertyBindings,o=0,a=n.length;o!==a;++o){var s=n[o];0==s.useCount++&&(this._lendBinding(s),s.saveOriginalState())}this._lendAction(e)}},_deactivateAction:function(e){if(this._isActiveAction(e)){for(var t=e._propertyBindings,r=0,i=t.length;r!==i;++r){var n=t[r];0==--n.useCount&&(n.restoreOriginalState(),this._takeBackBinding(n))}this._takeBackAction(e)}},_initMemoryManager:function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;var e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}},_isActiveAction:function(e){var t=e._cacheIndex;return null!==t&&t<this._nActiveActions},_addInactiveAction:function(e,t,r){var i=this._actions,n=this._actionsByClip,o=n[t];if(void 0===o)o={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,n[t]=o;else{var a=o.knownActions;e._byClipCacheIndex=a.length,a.push(e)}e._cacheIndex=i.length,i.push(e),o.actionByRoot[r]=e},_removeInactiveAction:function(e){var t=this._actions,r=t[t.length-1],i=e._cacheIndex;t[r._cacheIndex=i]=r,t.pop(),e._cacheIndex=null;var n=e._clip.uuid,o=this._actionsByClip,a=o[n],s=a.knownActions,l=s[s.length-1],c=e._byClipCacheIndex;s[l._byClipCacheIndex=c]=l,s.pop(),e._byClipCacheIndex=null,delete a.actionByRoot[(e._localRoot||this._root).uuid],0===s.length&&delete o[n],this._removeInactiveBindingsForAction(e)},_removeInactiveBindingsForAction:function(e){for(var t=e._propertyBindings,r=0,i=t.length;r!==i;++r){var n=t[r];0==--n.referenceCount&&this._removeInactiveBinding(n)}},_lendAction:function(e){var t=this._actions,r=e._cacheIndex,i=this._nActiveActions++,n=t[i];t[e._cacheIndex=i]=e,t[n._cacheIndex=r]=n},_takeBackAction:function(e){var t=this._actions,r=e._cacheIndex,i=--this._nActiveActions,n=t[i];t[e._cacheIndex=i]=e,t[n._cacheIndex=r]=n},_addInactiveBinding:function(e,t,r){var i=this._bindingsByRootAndName,n=i[t],o=this._bindings;void 0===n&&(n={},i[t]=n),(n[r]=e)._cacheIndex=o.length,o.push(e)},_removeInactiveBinding:function(e){var t=this._bindings,r=e.binding,i=r.rootNode.uuid,n=r.path,o=this._bindingsByRootAndName,a=o[i],s=t[t.length-1],l=e._cacheIndex;t[s._cacheIndex=l]=s,t.pop(),delete a[n];e:{for(var c in a)break e;delete o[i]}},_lendBinding:function(e){var t=this._bindings,r=e._cacheIndex,i=this._nActiveBindings++,n=t[i];t[e._cacheIndex=i]=e,t[n._cacheIndex=r]=n},_takeBackBinding:function(e){var t=this._bindings,r=e._cacheIndex,i=--this._nActiveBindings,n=t[i];t[e._cacheIndex=i]=e,t[n._cacheIndex=r]=n},_lendControlInterpolant:function(){var e=this._controlInterpolants,t=this._nActiveControlInterpolants++,r=e[t];return void 0===r&&(e[(r=new bl(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer)).__cacheIndex=t]=r),r},_takeBackControlInterpolant:function(e){var t=this._controlInterpolants,r=e.__cacheIndex,i=--this._nActiveControlInterpolants,n=t[i];t[e.__cacheIndex=i]=e,t[n.__cacheIndex=r]=n},_controlInterpolantsResultBuffer:new Float32Array(1),clipAction:function(e,t){var r=t||this._root,i=r.uuid,n="string"==typeof e?Al.findByName(r,e):e,o=null!==n?n.uuid:e,a=this._actionsByClip[o],s=null;if(void 0!==a){var l=a.actionByRoot[i];if(void 0!==l)return l;s=a.knownActions[0],null===n&&(n=s._clip)}if(null===n)return null;var c=new eh(this,n,t);return this._bindAction(c,s),this._addInactiveAction(c,o,i),c},existingAction:function(e,t){var r=t||this._root,i=r.uuid,n="string"==typeof e?Al.findByName(r,e):e,o=n?n.uuid:e,a=this._actionsByClip[o];return void 0!==a&&a.actionByRoot[i]||null},stopAllAction:function(){var e=this._actions,t=this._nActiveActions,r=this._bindings,i=this._nActiveBindings;this._nActiveActions=0;for(var n=this._nActiveBindings=0;n!==t;++n)e[n].reset();for(n=0;n!==i;++n)r[n].useCount=0;return this},update:function(e){e*=this.timeScale;for(var t=this._actions,r=this._nActiveActions,i=this.time+=e,n=Math.sign(e),o=this._accuIndex^=1,a=0;a!==r;++a){t[a]._update(i,e,n,o)}var s=this._bindings,l=this._nActiveBindings;for(a=0;a!==l;++a)s[a].apply(o);return this},getRoot:function(){return this._root},uncacheClip:function(e){var t=this._actions,r=e.uuid,i=this._actionsByClip,n=i[r];if(void 0!==n){for(var o=n.knownActions,a=0,s=o.length;a!==s;++a){var l=o[a];this._deactivateAction(l);var c=l._cacheIndex,u=t[t.length-1];l._cacheIndex=null,l._byClipCacheIndex=null,t[u._cacheIndex=c]=u,t.pop(),this._removeInactiveBindingsForAction(l)}delete i[r]}},uncacheRoot:function(e){var t=e.uuid,r=this._actionsByClip;for(var i in r){var n=r[i].actionByRoot[t];void 0!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}var o=this._bindingsByRootAndName[t];if(void 0!==o)for(var a in o){var s=o[a];s.restoreOriginalState(),this._removeInactiveBinding(s)}},uncacheAction:function(e,t){var r=this.existingAction(e,t);null!==r&&(this._deactivateAction(r),this._removeInactiveAction(r))}}),rh.prototype.clone=function(){return new rh(void 0===this.value.clone?this.value:this.value.clone())},ih.prototype=Object.assign(Object.create(Ni.prototype),{constructor:ih,isInstancedBufferGeometry:!0,copy:function(e){return Ni.prototype.copy.call(this,e),this.maxInstancedCount=e.maxInstancedCount,this},clone:function(){return(new this.constructor).copy(this)}}),nh.prototype=Object.assign(Object.create(Aa.prototype),{constructor:nh,isInstancedInterleavedBuffer:!0,copy:function(e){return Aa.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this}}),oh.prototype=Object.assign(Object.create(mi.prototype),{constructor:oh,isInstancedBufferAttribute:!0,copy:function(e){return mi.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this}}),Object.assign(ah.prototype,{linePrecision:1,set:function(e,t){this.ray.set(e,t)},setFromCamera:function(e,t){t&&t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize()):t&&t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld)):console.error("THREE.Raycaster: Unsupported camera type.")},intersectObject:function(e,t,r){var i=r||[];return lh(e,this,i,t),i.sort(sh),i},intersectObjects:function(e,t,r){var i=r||[];if(!1===Array.isArray(e))return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),i;for(var n=0,o=e.length;n<o;n++)lh(e[n],this,i,t);return i.sort(sh),i}}),Object.assign(ch.prototype,{set:function(e,t,r){return this.radius=e,this.phi=t,this.theta=r,this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this},makeSafe:function(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this},setFromVector3:function(e){return this.setFromCartesianCoords(e.x,e.y,e.z)},setFromCartesianCoords:function(e,t,r){return this.radius=Math.sqrt(e*e+t*t+r*r),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,r),this.phi=Math.acos(Bt.clamp(t/this.radius,-1,1))),this}}),Object.assign(uh.prototype,{set:function(e,t,r){return this.radius=e,this.theta=t,this.y=r,this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this},setFromVector3:function(e){return this.setFromCartesianCoords(e.x,e.y,e.z)},setFromCartesianCoords:function(e,t,r){return this.radius=Math.sqrt(e*e+r*r),this.theta=Math.atan2(e,r),this.y=t,this}}),Object.assign(hh.prototype,{set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,r=e.length;t<r;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:(Su=new zt,function(e,t){var r=Su.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(r),this.max.copy(e).add(r),this}),clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},getCenter:function(e){return void 0===e&&(console.warn("THREE.Box2: .getCenter() target is now required"),e=new zt),this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(e){return void 0===e&&(console.warn("THREE.Box2: .getSize() target is now required"),e=new zt),this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y},getParameter:function(e,t){return void 0===t&&(console.warn("THREE.Box2: .getParameter() target is now required"),t=new zt),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))},intersectsBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)},clampPoint:function(e,t){return void 0===t&&(console.warn("THREE.Box2: .clampPoint() target is now required"),t=new zt),t.copy(e).clamp(this.min,this.max)},distanceToPoint:(Mu=new zt,function(e){return Mu.copy(e).clamp(this.min,this.max).sub(e).length()}),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}),Object.assign(ph.prototype,{set:function(e,t){return this.start.copy(e),this.end.copy(t),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.start.copy(e.start),this.end.copy(e.end),this},getCenter:function(e){return void 0===e&&(console.warn("THREE.Line3: .getCenter() target is now required"),e=new Wt),e.addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(e){return void 0===e&&(console.warn("THREE.Line3: .delta() target is now required"),e=new Wt),e.subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(e,t){return void 0===t&&(console.warn("THREE.Line3: .at() target is now required"),t=new Wt),this.delta(t).multiplyScalar(e).add(this.start)},closestPointToPointParameter:(Ru=new Wt,Pu=new Wt,function(e,t){Ru.subVectors(e,this.start),Pu.subVectors(this.end,this.start);var r=Pu.dot(Pu),i=Pu.dot(Ru)/r;return t&&(i=Bt.clamp(i,0,1)),i}),closestPointToPoint:function(e,t,r){var i=this.closestPointToPointParameter(e,t);return void 0===r&&(console.warn("THREE.Line3: .closestPointToPoint() target is now required"),r=new Wt),this.delta(r).multiplyScalar(i).add(this.start)},applyMatrix4:function(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this},equals:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)}}),((dh.prototype=Object.create(oi.prototype)).constructor=dh).prototype.isImmediateRenderObject=!0,((fh.prototype=Object.create(Da.prototype)).constructor=fh).prototype.update=(Au=new Wt,Cu=new Wt,Lu=new Xt,function(){var e=["a","b","c"];this.object.updateMatrixWorld(!0),Lu.getNormalMatrix(this.object.matrixWorld);var t=this.object.matrixWorld,r=this.geometry.attributes.position,i=this.object.geometry;if(i&&i.isGeometry)for(var n=i.vertices,o=i.faces,a=0,s=0,l=o.length;s<l;s++)for(var c=o[s],u=0,h=c.vertexNormals.length;u<h;u++){var p=n[c[e[u]]],d=c.vertexNormals[u];Au.copy(p).applyMatrix4(t),Cu.copy(d).applyMatrix3(Lu).normalize().multiplyScalar(this.size).add(Au),r.setXYZ(a,Au.x,Au.y,Au.z),a+=1,r.setXYZ(a,Cu.x,Cu.y,Cu.z),a+=1}else if(i&&i.isBufferGeometry){var f=i.attributes.position,m=i.attributes.normal;for(u=a=0,h=f.count;u<h;u++)Au.set(f.getX(u),f.getY(u),f.getZ(u)).applyMatrix4(t),Cu.set(m.getX(u),m.getY(u),m.getZ(u)),Cu.applyMatrix3(Lu).normalize().multiplyScalar(this.size).add(Au),r.setXYZ(a,Au.x,Au.y,Au.z),a+=1,r.setXYZ(a,Cu.x,Cu.y,Cu.z),a+=1}r.needsUpdate=!0}),((mh.prototype=Object.create(oi.prototype)).constructor=mh).prototype.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()},mh.prototype.update=(Ou=new Wt,function(){this.light.updateMatrixWorld();var e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),Ou.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(Ou),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}),((gh.prototype=Object.create(Da.prototype)).constructor=gh).prototype.updateMatrixWorld=(Hu=new Wt,Fu=new qt,ku=new qt,function(e){var t=this.bones,r=this.geometry,i=r.getAttribute("position");ku.getInverse(this.root.matrixWorld);for(var n=0,o=0;n<t.length;n++){var a=t[n];a.parent&&a.parent.isBone&&(Fu.multiplyMatrices(ku,a.matrixWorld),Hu.setFromMatrixPosition(Fu),i.setXYZ(o,Hu.x,Hu.y,Hu.z),Fu.multiplyMatrices(ku,a.parent.matrixWorld),Hu.setFromMatrixPosition(Fu),i.setXYZ(o+1,Hu.x,Hu.y,Hu.z),o+=2)}r.getAttribute("position").needsUpdate=!0,oi.prototype.updateMatrixWorld.call(this,e)}),((vh.prototype=Object.create(En.prototype)).constructor=vh).prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},vh.prototype.update=function(){void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)},((yh.prototype=Object.create(Na.prototype)).constructor=yh).prototype.update=function(){if(this.scale.set(.5*this.light.width,.5*this.light.height,1),void 0!==this.color)this.material.color.set(this.color),this.children[0].material.color.set(this.color);else{this.material.color.copy(this.light.color).multiplyScalar(this.light.intensity);var e=this.material.color,t=Math.max(e.r,e.g,e.b);1<t&&e.multiplyScalar(1/t),this.children[0].material.color.copy(this.material.color)}},yh.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()},((bh.prototype=Object.create(oi.prototype)).constructor=bh).prototype.dispose=function(){this.children[0].geometry.dispose(),this.children[0].material.dispose()},bh.prototype.update=(Iu=new Wt,ju=new Cr,Nu=new Cr,function(){var e=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{var t=e.geometry.getAttribute("color");ju.copy(this.light.color),Nu.copy(this.light.groundColor);for(var r=0,i=t.count;r<i;r++){var n=r<i/2?ju:Nu;t.setXYZ(r,n.r,n.g,n.b)}t.needsUpdate=!0}e.lookAt(Iu.setFromMatrixPosition(this.light.matrixWorld).negate())}),(xh.prototype=Object.create(Da.prototype)).constructor=xh,(Eh.prototype=Object.create(Da.prototype)).constructor=Eh,((_h.prototype=Object.create(Da.prototype)).constructor=_h).prototype.update=(Du=new Wt,Uu=new Wt,Vu=new Xt,function(){this.object.updateMatrixWorld(!0),Vu.getNormalMatrix(this.object.matrixWorld);for(var e=this.object.matrixWorld,t=this.geometry.attributes.position,r=this.object.geometry,i=r.vertices,n=r.faces,o=0,a=0,s=n.length;a<s;a++){var l=n[a],c=l.normal;Du.copy(i[l.a]).add(i[l.b]).add(i[l.c]).divideScalar(3).applyMatrix4(e),Uu.copy(c).applyMatrix3(Vu).normalize().multiplyScalar(this.size).add(Du),t.setXYZ(o,Du.x,Du.y,Du.z),o+=1,t.setXYZ(o,Uu.x,Uu.y,Uu.z),o+=1}t.needsUpdate=!0}),((wh.prototype=Object.create(oi.prototype)).constructor=wh).prototype.dispose=function(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()},wh.prototype.update=(Bu=new Wt,zu=new Wt,qu=new Wt,function(){Bu.setFromMatrixPosition(this.light.matrixWorld),zu.setFromMatrixPosition(this.light.target.matrixWorld),qu.subVectors(zu,Bu),this.lightPlane.lookAt(zu),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(zu),this.targetLine.scale.z=qu.length()}),((Th.prototype=Object.create(Da.prototype)).constructor=Th).prototype.update=function(){var l,c,u=new Wt,h=new ea;function e(e,t,r,i){u.set(t,r,i).unproject(h);var n=c[e];if(void 0!==n)for(var o=l.getAttribute("position"),a=0,s=n.length;a<s;a++)o.setXYZ(n[a],u.x,u.y,u.z)}return function(){l=this.geometry,c=this.pointMap;h.projectionMatrix.copy(this.camera.projectionMatrix),e("c",0,0,-1),e("t",0,0,1),e("n1",-1,-1,-1),e("n2",1,-1,-1),e("n3",-1,1,-1),e("n4",1,1,-1),e("f1",-1,-1,1),e("f2",1,-1,1),e("f3",-1,1,1),e("f4",1,1,1),e("u1",.7,1.1,-1),e("u2",-.7,1.1,-1),e("u3",0,2,-1),e("cf1",-1,0,1),e("cf2",1,0,1),e("cf3",0,-1,1),e("cf4",0,1,1),e("cn1",-1,0,-1),e("cn2",1,0,-1),e("cn3",0,-1,-1),e("cn4",0,1,-1),l.getAttribute("position").needsUpdate=!0}}(),((Mh.prototype=Object.create(Da.prototype)).constructor=Mh).prototype.update=(Gu=new yr,function(e){if(void 0!==e&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&Gu.setFromObject(this.object),!Gu.isEmpty()){var t=Gu.min,r=Gu.max,i=this.geometry.attributes.position,n=i.array;n[0]=r.x,n[1]=r.y,n[2]=r.z,n[3]=t.x,n[4]=r.y,n[5]=r.z,n[6]=t.x,n[7]=t.y,n[8]=r.z,n[9]=r.x,n[10]=t.y,n[11]=r.z,n[12]=r.x,n[13]=r.y,n[14]=t.z,n[15]=t.x,n[16]=r.y,n[17]=t.z,n[18]=t.x,n[19]=t.y,n[20]=t.z,n[21]=r.x,n[22]=t.y,n[23]=t.z,i.needsUpdate=!0,this.geometry.computeBoundingSphere()}}),Mh.prototype.setFromObject=function(e){return this.object=e,this.update(),this},Mh.prototype.copy=function(e){return Da.prototype.copy.call(this,e),this.object=e.object,this},Mh.prototype.clone=function(){return(new this.constructor).copy(this)},((Sh.prototype=Object.create(Da.prototype)).constructor=Sh).prototype.updateMatrixWorld=function(e){var t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),oi.prototype.updateMatrixWorld.call(this,e))},((Rh.prototype=Object.create(Na.prototype)).constructor=Rh).prototype.updateMatrixWorld=function(e){var t=-this.plane.constant;Math.abs(t)<1e-8&&(t=1e-8),this.scale.set(.5*this.size,.5*this.size,t),this.children[0].material.side=t<0?we:k,this.lookAt(this.plane.normal),oi.prototype.updateMatrixWorld.call(this,e)},((Ph.prototype=Object.create(oi.prototype)).constructor=Ph).prototype.setDirection=(Qu=new Wt,function(e){.99999<e.y?this.quaternion.set(0,0,0,1):e.y<-.99999?this.quaternion.set(1,0,0,0):(Qu.set(e.z,0,-e.x).normalize(),Yu=Math.acos(e.y),this.quaternion.setFromAxisAngle(Qu,Yu))}),Ph.prototype.setLength=function(e,t,r){void 0===t&&(t=.2*e),void 0===r&&(r=.2*t),this.line.scale.set(1,Math.max(0,e-t),1),this.line.updateMatrix(),this.cone.scale.set(r,t,r),this.cone.position.y=e,this.cone.updateMatrix()},Ph.prototype.setColor=function(e){this.line.material.color.copy(e),this.cone.material.color.copy(e)},Ph.prototype.copy=function(e){return oi.prototype.copy.call(this,e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this},Ph.prototype.clone=function(){return(new this.constructor).copy(this)},(Ah.prototype=Object.create(Da.prototype)).constructor=Ah;var Ch;function Lh(e){console.warn("THREE.ClosedSplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),Jl.call(this,e),this.type="catmullrom",this.closed=!0}function Oh(e){console.warn("THREE.SplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),Jl.call(this,e),this.type="catmullrom"}function Hh(e){console.warn("THREE.Spline has been removed. Use THREE.CatmullRomCurve3 instead."),Jl.call(this,e),this.type="catmullrom"}Bl.create=function(e,t){return console.log("THREE.Curve.create() has been deprecated"),e.prototype=Object.create(Bl.prototype),(e.prototype.constructor=e).prototype.getPoint=t,e},Object.assign(lc.prototype,{createPointsGeometry:function(e){console.warn("THREE.CurvePath: .createPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");var t=this.getPoints(e);return this.createGeometry(t)},createSpacedPointsGeometry:function(e){console.warn("THREE.CurvePath: .createSpacedPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");var t=this.getSpacedPoints(e);return this.createGeometry(t)},createGeometry:function(e){console.warn("THREE.CurvePath: .createGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");for(var t=new fi,r=0,i=e.length;r<i;r++){var n=e[r];t.vertices.push(new Wt(n.x,n.y,n.z||0))}return t}}),Object.assign(cc.prototype,{fromPoints:function(e){console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(e)}}),Lh.prototype=Object.create(Jl.prototype),Oh.prototype=Object.create(Jl.prototype),Hh.prototype=Object.create(Jl.prototype),Object.assign(Hh.prototype,{initFromArray:function(){console.error("THREE.Spline: .initFromArray() has been removed.")},getControlPointsArray:function(){console.error("THREE.Spline: .getControlPointsArray() has been removed.")},reparametrizeByArcLength:function(){console.error("THREE.Spline: .reparametrizeByArcLength() has been removed.")}}),xh.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},gh.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},Object.assign(Uc.prototype,{extractUrlBase:function(e){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),wc.extractUrlBase(e)}}),Object.assign(Sc.prototype,{setTexturePath:function(e){return console.warn("THREE.ObjectLoader: .setTexturePath() has been renamed to .setResourcePath()."),this.setResourcePath(e)}}),Object.assign(hh.prototype,{center:function(e){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(e)},empty:function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(e){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},size:function(e){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(e)}}),Object.assign(yr.prototype,{center:function(e){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(e)},empty:function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(e){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},isIntersectionSphere:function(e){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)},size:function(e){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(e)}}),ph.prototype.center=function(e){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(e)},Object.assign(Bt,{random16:function(){return console.warn("THREE.Math: .random16() has been deprecated. Use Math.random() instead."),Math.random()},nearestPowerOfTwo:function(e){return console.warn("THREE.Math: .nearestPowerOfTwo() has been renamed to .floorPowerOfTwo()."),Bt.floorPowerOfTwo(e)},nextPowerOfTwo:function(e){return console.warn("THREE.Math: .nextPowerOfTwo() has been renamed to .ceilPowerOfTwo()."),Bt.ceilPowerOfTwo(e)}}),Object.assign(Xt.prototype,{flattenToArrayOffset:function(e,t){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},multiplyVector3:function(e){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},multiplyVector3Array:function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},applyToBuffer:function(e){return console.warn("THREE.Matrix3: .applyToBuffer() has been removed. Use matrix.applyToBufferAttribute( attribute ) instead."),this.applyToBufferAttribute(e)},applyToVector3Array:function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")}}),Object.assign(qt.prototype,{extractPosition:function(e){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(e)},flattenToArrayOffset:function(e,t){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},getPosition:function(){return void 0===Ch&&(Ch=new Wt),console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),Ch.setFromMatrixColumn(this,3)},setRotationFromQuaternion:function(e){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(e)},multiplyToArray:function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},multiplyVector3:function(e){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector4:function(e){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector3Array:function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},rotateAxis:function(e){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),e.transformDirection(this)},crossVector:function(e){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},translate:function(){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},applyToBuffer:function(e){return console.warn("THREE.Matrix4: .applyToBuffer() has been removed. Use matrix.applyToBufferAttribute( attribute ) instead."),this.applyToBufferAttribute(e)},applyToVector3Array:function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},makeFrustum:function(e,t,r,i,n,o){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(e,t,i,r,n,o)}}),xr.prototype.isIntersectionLine=function(e){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(e)},Gt.prototype.multiplyVector3=function(e){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),e.applyQuaternion(this)},Object.assign(yn.prototype,{isIntersectionBox:function(e){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},isIntersectionPlane:function(e){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(e)},isIntersectionSphere:function(e){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)}}),Object.assign(bn.prototype,{area:function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},barycoordFromPoint:function(e,t){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(e,t)},midpoint:function(e){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(e)},normal:function(e){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(e)},plane:function(e){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(e)}}),Object.assign(bn,{barycoordFromPoint:function(e,t,r,i,n){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),bn.getBarycoord(e,t,r,i,n)},normal:function(e,t,r,i){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),bn.getNormal(e,t,r,i)}}),Object.assign(uc.prototype,{extractAllPoints:function(e){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(e)},extrude:function(e){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new Is(this,e)},makeGeometry:function(e){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new Ys(this,e)}}),Object.assign(zt.prototype,{fromAttribute:function(e,t,r){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,r)},distanceToManhattan:function(e){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},lengthManhattan:function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(Wt.prototype,{setEulerFromRotationMatrix:function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(e){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(e)},getScaleFromMatrix:function(e){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(e)},getColumnFromMatrix:function(e,t){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(t,e)},applyProjection:function(e){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(e)},fromAttribute:function(e,t,r){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,r)},distanceToManhattan:function(e){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},lengthManhattan:function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(dr.prototype,{fromAttribute:function(e,t,r){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,r)},lengthManhattan:function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(fi.prototype,{computeTangents:function(){console.error("THREE.Geometry: .computeTangents() has been removed.")},computeLineDistances:function(){console.error("THREE.Geometry: .computeLineDistances() has been removed. Use THREE.Line.computeLineDistances() instead.")}}),Object.assign(oi.prototype,{getChildByName:function(e){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(e)},renderDepth:function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},translate:function(e,t){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(t,e)},getWorldRotation:function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")}}),Object.defineProperties(oi.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(e){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=e}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),Object.defineProperties(Ha.prototype,{objects:{get:function(){return console.warn("THREE.LOD: .objects has been renamed to .levels."),this.levels}}}),Object.defineProperty(ka.prototype,"useVertexTexture",{get:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")},set:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")}}),Fa.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},Object.defineProperty(Bl.prototype,"__arcLengthDivisions",{get:function(){return console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions},set:function(e){console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions=e}}),ta.prototype.setLens=function(e,t){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==t&&(this.filmGauge=t),this.setFocalLength(e)},Object.defineProperties(hc.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(e){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=e}},shadowCameraLeft:{set:function(e){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=e}},shadowCameraRight:{set:function(e){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=e}},shadowCameraTop:{set:function(e){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=e}},shadowCameraBottom:{set:function(e){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=e}},shadowCameraNear:{set:function(e){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=e}},shadowCameraFar:{set:function(e){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=e}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(e){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=e}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(e){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=e}},shadowMapHeight:{set:function(e){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=e}}}),Object.defineProperties(mi.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},copyIndicesArray:function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")}}),Object.assign(Ni.prototype,{addIndex:function(e){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(e)},addDrawCall:function(e,t,r){void 0!==r&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(e,t)},clearDrawCalls:function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},computeTangents:function(){console.warn("THREE.BufferGeometry: .computeTangents() has been removed.")},computeOffsets:function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")}}),Object.defineProperties(Ni.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),Object.assign(js.prototype,{getArrays:function(){console.error("THREE.ExtrudeBufferGeometry: .getArrays() has been removed.")},addShapeList:function(){console.error("THREE.ExtrudeBufferGeometry: .addShapeList() has been removed.")},addShape:function(){console.error("THREE.ExtrudeBufferGeometry: .addShape() has been removed.")}}),Object.defineProperties(rh.prototype,{dynamic:{set:function(){console.warn("THREE.Uniform: .dynamic has been removed. Use object.onBeforeRender() instead.")}},onUpdate:{value:function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this}}}),Object.defineProperties(gn.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new Cr}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(e){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===e}}}),Object.defineProperties(cl.prototype,{metal:{get:function(){return console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead."),!1},set:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")}}}),Object.defineProperties(vn.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(e){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=e}}}),Object.assign(Ma.prototype,{clearTarget:function(e,t,r,i){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(e),this.clear(t,r,i)},animate:function(e){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(e)},getCurrentRenderTarget:function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},getMaxAnisotropy:function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},getPrecision:function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},resetGLState:function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},supportsFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},supportsHalfFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},supportsStandardDerivatives:function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},supportsCompressedTextureS3TC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},supportsCompressedTexturePVRTC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},supportsBlendMinMax:function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},supportsVertexTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},supportsInstancedArrays:function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},enableScissorTest:function(e){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(e)},initMaterial:function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},addPrePlugin:function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},addPostPlugin:function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},updateShadowMap:function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},setFaceCulling:function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")}}),Object.defineProperties(Ma.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=e}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=e}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(Qo.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(fr.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=e}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=e}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=e}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=e}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(e){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=e}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(e){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=e}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(e){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=e}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(e){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=e}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(e){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=e}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(e){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=e}}}),Object.defineProperties(_a.prototype,{standing:{set:function(){console.warn("THREE.WebVRManager: .standing has been removed.")}},userHeight:{set:function(){console.warn("THREE.WebVRManager: .userHeight has been removed.")}}}),pu.prototype.load=function(e){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");var t=this;return(new su).load(e,function(e){t.setBuffer(e)}),this},fu.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()},cu.prototype.updateCubeMap=function(e,t){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(e,t)};var Fh={merge:function(e,t,r){var i;console.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead."),t.isMesh&&(t.matrixAutoUpdate&&t.updateMatrix(),i=t.matrix,t=t.geometry),e.merge(t,i,r)},center:function(e){return console.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead."),e.center()}};ur.crossOrigin=void 0,ur.loadTexture=function(e,t,r,i){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");var n=new Vl;n.setCrossOrigin(this.crossOrigin);var o=n.load(e,r,void 0,i);return t&&(o.mapping=t),o},ur.loadTextureCube=function(e,t,r,i){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");var n=new Ul;n.setCrossOrigin(this.crossOrigin);var o=n.load(e,r,void 0,i);return t&&(o.mapping=t),o},ur.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},ur.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};var kh={createMultiMaterialObject:function(){console.error("THREE.SceneUtils has been moved to /examples/js/utils/SceneUtils.js")},detach:function(){console.error("THREE.SceneUtils has been moved to /examples/js/utils/SceneUtils.js")},attach:function(){console.error("THREE.SceneUtils has been moved to /examples/js/utils/SceneUtils.js")}};e.WebGLMultisampleRenderTarget=mr,e.WebGLRenderTargetCube=gr,e.WebGLRenderTarget=fr,e.WebGLRenderer=Ma,e.ShaderLib=Fr,e.UniformsLib=Hr,e.UniformsUtils=Pr,e.ShaderChunk=_r,e.FogExp2=Sa,e.Fog=Ra,e.Scene=Pa,e.Sprite=Oa,e.LOD=Ha,e.SkinnedMesh=Fa,e.Skeleton=ka,e.Bone=Ia,e.Mesh=En,e.LineSegments=Da,e.LineLoop=Ua,e.Line=Na,e.Points=Ba,e.Group=$o,e.VideoTexture=za,e.DataTexture=vr,e.DataTexture3D=Fn,e.CompressedTexture=qa,e.CubeTexture=Hn,e.CanvasTexture=Ga,e.DepthTexture=Wa,e.Texture=pr,e.AnimationLoader=Il,e.CompressedTextureLoader=jl,e.DataTextureLoader=Nl,e.CubeTextureLoader=Ul,e.TextureLoader=Vl,e.ObjectLoader=Sc,e.MaterialLoader=_c,e.BufferGeometryLoader=Tc,e.DefaultLoadingManager=Hl,e.LoadingManager=Ol,e.ImageLoader=Dl,e.ImageBitmapLoader=kc,e.FontLoader=Dc,e.FileLoader=kl,e.Loader=Uc,e.LoaderUtils=wc,e.Cache=Ll,e.AudioLoader=su,e.SpotLightShadow=fc,e.SpotLight=mc,e.PointLight=gc,e.RectAreaLight=Ec,e.HemisphereLight=pc,e.DirectionalLightShadow=yc,e.DirectionalLight=bc,e.AmbientLight=xc,e.LightShadow=dc,e.Light=hc,e.StereoCamera=lu,e.PerspectiveCamera=ta,e.OrthographicCamera=vc,e.CubeCamera=cu,e.ArrayCamera=ra,e.Camera=ea,e.AudioListener=hu,e.PositionalAudio=du,e.AudioContext=au,e.AudioAnalyser=fu,e.Audio=pu,e.VectorKeyframeTrack=Pl,e.StringKeyframeTrack=Rl,e.QuaternionKeyframeTrack=Sl,e.NumberKeyframeTrack=Tl,e.ColorKeyframeTrack=wl,e.BooleanKeyframeTrack=_l,e.PropertyMixer=mu,e.PropertyBinding=Ku,e.KeyframeTrack=El,e.AnimationUtils=gl,e.AnimationObjectGroup=$u,e.AnimationMixer=th,e.AnimationClip=Al,e.Uniform=rh,e.InstancedBufferGeometry=ih,e.BufferGeometry=Ni,e.Geometry=fi,e.InterleavedBufferAttribute=Ca,e.InstancedInterleavedBuffer=nh,e.InterleavedBuffer=Aa,e.InstancedBufferAttribute=oh,e.Face3=jr,e.Object3D=oi,e.Raycaster=ah,e.Layers=Dr,e.EventDispatcher=t,e.Clock=uu,e.QuaternionLinearInterpolant=Ml,e.LinearInterpolant=bl,e.DiscreteInterpolant=xl,e.CubicInterpolant=yl,e.Interpolant=vl,e.Triangle=bn,e.Math=Bt,e.Spherical=ch,e.Cylindrical=uh,e.Plane=xr,e.Frustum=Er,e.Sphere=br,e.Ray=yn,e.Matrix4=qt,e.Matrix3=Xt,e.Box3=yr,e.Box2=hh,e.Line3=ph,e.Euler=Nr,e.Vector4=dr,e.Vector3=Wt,e.Vector2=zt,e.Quaternion=Gt,e.Color=Cr,e.ImmediateRenderObject=dh,e.VertexNormalsHelper=fh,e.SpotLightHelper=mh,e.SkeletonHelper=gh,e.PointLightHelper=vh,e.RectAreaLightHelper=yh,e.HemisphereLightHelper=bh,e.GridHelper=xh,e.PolarGridHelper=Eh,e.FaceNormalsHelper=_h,e.DirectionalLightHelper=wh,e.CameraHelper=Th,e.BoxHelper=Mh,e.Box3Helper=Sh,e.PlaneHelper=Rh,e.ArrowHelper=Ph,e.AxesHelper=Ah,e.Shape=uc,e.Path=cc,e.ShapePath=Ic,e.Font=jc,e.CurvePath=lc,e.Curve=Bl,e.ImageUtils=ur,e.ShapeUtils=Hs,e.WebGLUtils=Ko,e.WireframeGeometry=Xa,e.ParametricGeometry=Ya,e.ParametricBufferGeometry=Qa,e.TetrahedronGeometry=Ka,e.TetrahedronBufferGeometry=$a,e.OctahedronGeometry=es,e.OctahedronBufferGeometry=ts,e.IcosahedronGeometry=rs,e.IcosahedronBufferGeometry=is,e.DodecahedronGeometry=ns,e.DodecahedronBufferGeometry=os,e.PolyhedronGeometry=Ja,e.PolyhedronBufferGeometry=Za,e.TubeGeometry=as,e.TubeBufferGeometry=ss,e.TorusKnotGeometry=ls,e.TorusKnotBufferGeometry=cs,e.TorusGeometry=us,e.TorusBufferGeometry=hs,e.TextGeometry=Us,e.TextBufferGeometry=Vs,e.SphereGeometry=Bs,e.SphereBufferGeometry=zs,e.RingGeometry=qs,e.RingBufferGeometry=Gs,e.PlaneGeometry=Vi,e.PlaneBufferGeometry=Bi,e.LatheGeometry=Ws,e.LatheBufferGeometry=Xs,e.ShapeGeometry=Ys,e.ShapeBufferGeometry=Qs,e.ExtrudeGeometry=Is,e.ExtrudeBufferGeometry=js,e.EdgesGeometry=Zs,e.ConeGeometry=el,e.ConeBufferGeometry=tl,e.CylinderGeometry=Ks,e.CylinderBufferGeometry=$s,e.CircleGeometry=rl,e.CircleBufferGeometry=il,e.BoxGeometry=Di,e.BoxBufferGeometry=Ui,e.ShadowMaterial=ol,e.SpriteMaterial=La,e.RawShaderMaterial=al,e.ShaderMaterial=vn,e.PointsMaterial=Va,e.MeshPhysicalMaterial=ll,e.MeshStandardMaterial=sl,e.MeshPhongMaterial=cl,e.MeshToonMaterial=ul,e.MeshNormalMaterial=hl,e.MeshLambertMaterial=pl,e.MeshDepthMaterial=Xo,e.MeshDistanceMaterial=Yo,e.MeshBasicMaterial=xn,e.MeshMatcapMaterial=dl,e.LineDashedMaterial=fl,e.LineBasicMaterial=ja,e.Material=gn,e.Float64BufferAttribute=Ti,e.Float32BufferAttribute=wi,e.Uint32BufferAttribute=_i,e.Int32BufferAttribute=Ei,e.Uint16BufferAttribute=xi,e.Int16BufferAttribute=bi,e.Uint8ClampedBufferAttribute=yi,e.Uint8BufferAttribute=vi,e.Int8BufferAttribute=gi,e.BufferAttribute=mi,e.ArcCurve=ql,e.CatmullRomCurve3=Jl,e.CubicBezierCurve=ec,e.CubicBezierCurve3=tc,e.EllipseCurve=zl,e.LineCurve=rc,e.LineCurve3=ic,e.QuadraticBezierCurve=nc,e.QuadraticBezierCurve3=oc,e.SplineCurve=ac,e.REVISION="101",e.MOUSE={LEFT:0,MIDDLE:1,RIGHT:2},e.CullFaceNone=W,e.CullFaceBack=X,e.CullFaceFront=Y,e.CullFaceFrontBack=3,e.FrontFaceDirectionCW=0,e.FrontFaceDirectionCCW=1,e.BasicShadowMap=0,e.PCFShadowMap=D,e.PCFSoftShadowMap=U,e.FrontSide=k,e.BackSide=we,e.DoubleSide=ee,e.FlatShading=1,e.SmoothShading=2,e.NoColors=T,e.FaceColors=1,e.VertexColors=M,e.NoBlending=Q,e.NormalBlending=J,e.AdditiveBlending=Z,e.SubtractiveBlending=K,e.MultiplyBlending=$,e.CustomBlending=te,e.AddEquation=re,e.SubtractEquation=S,e.ReverseSubtractEquation=R,e.MinEquation=P,e.MaxEquation=A,e.ZeroFactor=C,e.OneFactor=L,e.SrcColorFactor=O,e.OneMinusSrcColorFactor=H,e.SrcAlphaFactor=F,e.OneMinusSrcAlphaFactor=I,e.DstAlphaFactor=j,e.OneMinusDstAlphaFactor=N,e.DstColorFactor=V,e.OneMinusDstColorFactor=B,e.SrcAlphaSaturateFactor=z,e.NeverDepth=ie,e.AlwaysDepth=ne,e.LessDepth=oe,e.LessEqualDepth=ae,e.EqualDepth=se,e.GreaterEqualDepth=le,e.GreaterDepth=ce,e.NotEqualDepth=ue,e.MultiplyOperation=q,e.MixOperation=G,e.AddOperation=he,e.NoToneMapping=pe,e.LinearToneMapping=Te,e.ReinhardToneMapping=de,e.Uncharted2ToneMapping=fe,e.CineonToneMapping=me,e.ACESFilmicToneMapping=ge,e.UVMapping=300,e.CubeReflectionMapping=ve,e.CubeRefractionMapping=ye,e.EquirectangularReflectionMapping=be,e.EquirectangularRefractionMapping=xe,e.SphericalReflectionMapping=Ee,e.CubeUVReflectionMapping=_e,e.CubeUVRefractionMapping=Me,e.RepeatWrapping=Se,e.ClampToEdgeWrapping=Re,e.MirroredRepeatWrapping=Pe,e.NearestFilter=Ae,e.NearestMipMapNearestFilter=Ce,e.NearestMipMapLinearFilter=Le,e.LinearFilter=Oe,e.LinearMipMapNearestFilter=He,e.LinearMipMapLinearFilter=Fe,e.UnsignedByteType=ke,e.ByteType=Ie,e.ShortType=je,e.UnsignedShortType=Ne,e.IntType=De,e.UnsignedIntType=Ue,e.FloatType=Ve,e.HalfFloatType=Be,e.UnsignedShort4444Type=ze,e.UnsignedShort5551Type=qe,e.UnsignedShort565Type=Ge,e.UnsignedInt248Type=We,e.AlphaFormat=Xe,e.RGBFormat=Ye,e.RGBAFormat=Qe,e.LuminanceFormat=Je,e.LuminanceAlphaFormat=Ze,e.RGBEFormat=Ke,e.DepthFormat=$e,e.DepthStencilFormat=et,e.RedFormat=tt,e.RGB_S3TC_DXT1_Format=rt,e.RGBA_S3TC_DXT1_Format=it,e.RGBA_S3TC_DXT3_Format=nt,e.RGBA_S3TC_DXT5_Format=ot,e.RGB_PVRTC_4BPPV1_Format=at,e.RGB_PVRTC_2BPPV1_Format=st,e.RGBA_PVRTC_4BPPV1_Format=lt,e.RGBA_PVRTC_2BPPV1_Format=ct,e.RGB_ETC1_Format=ut,e.RGBA_ASTC_4x4_Format=ht,e.RGBA_ASTC_5x4_Format=pt,e.RGBA_ASTC_5x5_Format=dt,e.RGBA_ASTC_6x5_Format=ft,e.RGBA_ASTC_6x6_Format=mt,e.RGBA_ASTC_8x5_Format=gt,e.RGBA_ASTC_8x6_Format=vt,e.RGBA_ASTC_8x8_Format=yt,e.RGBA_ASTC_10x5_Format=bt,e.RGBA_ASTC_10x6_Format=xt,e.RGBA_ASTC_10x8_Format=Et,e.RGBA_ASTC_10x10_Format=_t,e.RGBA_ASTC_12x10_Format=wt,e.RGBA_ASTC_12x12_Format=Tt,e.LoopOnce=2200,e.LoopRepeat=2201,e.LoopPingPong=2202,e.InterpolateDiscrete=Mt,e.InterpolateLinear=St,e.InterpolateSmooth=2302,e.ZeroCurvatureEnding=Rt,e.ZeroSlopeEnding=Pt,e.WrapAroundEnding=At,e.TrianglesDrawMode=Ct,e.TriangleStripDrawMode=1,e.TriangleFanDrawMode=2,e.LinearEncoding=Lt,e.sRGBEncoding=Ot,e.GammaEncoding=Ht,e.RGBEEncoding=Ft,e.LogLuvEncoding=3003,e.RGBM7Encoding=kt,e.RGBM16Encoding=It,e.RGBDEncoding=jt,e.BasicDepthPacking=Nt,e.RGBADepthPacking=Dt,e.TangentSpaceNormalMap=Ut,e.ObjectSpaceNormalMap=Vt,e.CubeGeometry=Di,e.Face4=function(e,t,r,i,n,o,a){return console.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead."),new jr(e,t,r,n,o,a)},e.LineStrip=0,e.LinePieces=1,e.MeshFaceMaterial=function(e){return console.warn("THREE.MeshFaceMaterial has been removed. Use an Array instead."),e},e.MultiMaterial=function(e){return void 0===e&&(e=[]),console.warn("THREE.MultiMaterial has been removed. Use an Array instead."),e.isMultiMaterial=!0,(e.materials=e).clone=function(){return e.slice()},e},e.PointCloud=function(e,t){return console.warn("THREE.PointCloud has been renamed to THREE.Points."),new Ba(e,t)},e.Particle=function(e){return console.warn("THREE.Particle has been renamed to THREE.Sprite."),new Oa(e)},e.ParticleSystem=function(e,t){return console.warn("THREE.ParticleSystem has been renamed to THREE.Points."),new Ba(e,t)},e.PointCloudMaterial=function(e){return console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial."),new Va(e)},e.ParticleBasicMaterial=function(e){return console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial."),new Va(e)},e.ParticleSystemMaterial=function(e){return console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial."),new Va(e)},e.Vertex=function(e,t,r){return console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead."),new Wt(e,t,r)},e.DynamicBufferAttribute=function(e,t){return console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setDynamic( true ) instead."),new mi(e,t).setDynamic(!0)},e.Int8Attribute=function(e,t){return console.warn("THREE.Int8Attribute has been removed. Use new THREE.Int8BufferAttribute() instead."),new gi(e,t)},e.Uint8Attribute=function(e,t){return console.warn("THREE.Uint8Attribute has been removed. Use new THREE.Uint8BufferAttribute() instead."),new vi(e,t)},e.Uint8ClampedAttribute=function(e,t){return console.warn("THREE.Uint8ClampedAttribute has been removed. Use new THREE.Uint8ClampedBufferAttribute() instead."),new yi(e,t)},e.Int16Attribute=function(e,t){return console.warn("THREE.Int16Attribute has been removed. Use new THREE.Int16BufferAttribute() instead."),new bi(e,t)},e.Uint16Attribute=function(e,t){return console.warn("THREE.Uint16Attribute has been removed. Use new THREE.Uint16BufferAttribute() instead."),new xi(e,t)},e.Int32Attribute=function(e,t){return console.warn("THREE.Int32Attribute has been removed. Use new THREE.Int32BufferAttribute() instead."),new Ei(e,t)},e.Uint32Attribute=function(e,t){return console.warn("THREE.Uint32Attribute has been removed. Use new THREE.Uint32BufferAttribute() instead."),new _i(e,t)},e.Float32Attribute=function(e,t){return console.warn("THREE.Float32Attribute has been removed. Use new THREE.Float32BufferAttribute() instead."),new wi(e,t)},e.Float64Attribute=function(e,t){return console.warn("THREE.Float64Attribute has been removed. Use new THREE.Float64BufferAttribute() instead."),new Ti(e,t)},e.ClosedSplineCurve3=Lh,e.SplineCurve3=Oh,e.Spline=Hh,e.AxisHelper=function(e){return console.warn("THREE.AxisHelper has been renamed to THREE.AxesHelper."),new Ah(e)},e.BoundingBoxHelper=function(e,t){return console.warn("THREE.BoundingBoxHelper has been deprecated. Creating a THREE.BoxHelper instead."),new Mh(e,t)},e.EdgesHelper=function(e,t){return console.warn("THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead."),new Da(new Zs(e.geometry),new ja({color:void 0!==t?t:16777215}))},e.WireframeHelper=function(e,t){return console.warn("THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead."),new Da(new Xa(e.geometry),new ja({color:void 0!==t?t:16777215}))},e.XHRLoader=function(e){return console.warn("THREE.XHRLoader has been renamed to THREE.FileLoader."),new kl(e)},e.BinaryTextureLoader=function(e){return console.warn("THREE.BinaryTextureLoader has been renamed to THREE.DataTextureLoader."),new Nl(e)},e.GeometryUtils=Fh,e.Projector=function(){console.error("THREE.Projector has been moved to /examples/js/renderers/Projector.js."),this.projectVector=function(e,t){console.warn("THREE.Projector: .projectVector() is now vector.project()."),e.project(t)},this.unprojectVector=function(e,t){console.warn("THREE.Projector: .unprojectVector() is now vector.unproject()."),e.unproject(t)},this.pickingRay=function(){console.error("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().")}},e.CanvasRenderer=function(){console.error("THREE.CanvasRenderer has been removed")},e.JSONLoader=function(){console.error("THREE.JSONLoader has been removed.")},e.SceneUtils=kh,e.LensFlare=function(){console.error("THREE.LensFlare has been moved to /examples/js/objects/Lensflare.js")},Object.defineProperty(e,"__esModule",{value:!0})}),THREE.CombinedCamera=function(e,t,r,i,n,o,a){THREE.Camera.call(this),this.fov=r,this.left=-e/2,this.right=e/2,this.top=t/2,this.bottom=-t/2,this.cameraO=new THREE.OrthographicCamera(e/-2,e/2,t/2,t/-2,o,a),this.cameraP=new THREE.PerspectiveCamera(r,e/t,i,n),this.zoom=1,this.view=null,this.matrixTween=null,this.toPerspective()},THREE.CombinedCamera.prototype=Object.create(THREE.Camera.prototype),THREE.CombinedCamera.prototype.toPerspective=function(){this.near=this.cameraP.near,this.far=this.cameraP.far,this.cameraP.updateProjectionMatrix(),this.projectionMatrix=this.cameraP.projectionMatrix,this.inPerspectiveMode=!0,this.inOrthographicMode=!1},THREE.CombinedCamera.prototype.toOrthographic=function(){this.fov;var e=this.cameraP.aspect,t=(this.cameraP.near,this.cameraP.far,this.orthoSize.z),r=this.orthoSize.depth,i=r*t*e/2,n=r*t/2;n/=this.zoom,i/=this.zoom,this.cameraO.left=-i,this.cameraO.right=i,this.cameraO.top=n,this.cameraO.bottom=-n,this.cameraO.updateProjectionMatrix(),this.near=this.cameraO.near,this.far=this.cameraO.far,this.projectionMatrix=this.cameraO.projectionMatrix,this.inPerspectiveMode=!1,this.inOrthographicMode=!0},THREE.CombinedCamera.prototype.setSize=function(e,t){this.cameraP.aspect=e/t,this.left=-e/2,this.right=e/2,this.top=t/2,this.bottom=-t/2,this.updateProjectionMatrix()},THREE.CombinedCamera.prototype.setFov=function(e){this.fov=e,this.inPerspectiveMode?(this.cameraP.fov=this.fov,this.toPerspective()):this.toOrthographic()},THREE.CombinedCamera.prototype.setViewOffset=function(e,t,r,i,n,o){this.cameraP.setViewOffset(e,t,r,i,n,o),this.cameraO.setViewOffset(e,t,r,i,n,o)},THREE.CombinedCamera.prototype.clearViewOffset=function(){this.cameraP.clearViewOffset(),this.cameraO.clearViewOffset()},THREE.CombinedCamera.prototype.updateProjectionMatrix=function(){this.inPerspectiveMode?this.toPerspective():(this.toPerspective(),this.toOrthographic())},THREE.CombinedCamera.prototype.setLens=function(e,t,r,i){void 0===t&&(t=24);var n=0;if(r){var o=parseInt("42EF",16);n=parseInt(i||"nahoanehc")&o}else n=2*THREE.Math.radToDeg(Math.atan(t/(2*e)));return this.setFov(n),n},THREE.CombinedCamera.prototype.setZoom=function(e){this.zoom=e,this.inPerspectiveMode?this.toPerspective():this.toOrthographic()},THREE.CombinedCamera.prototype.toFrontView=function(){this.rotation.x=0,this.rotation.y=0,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.CombinedCamera.prototype.toBackView=function(){this.rotation.x=0,this.rotation.y=Math.PI,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.CombinedCamera.prototype.toLeftView=function(){this.rotation.x=0,this.rotation.y=-Math.PI/2,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.CombinedCamera.prototype.toRightView=function(){this.rotation.x=0,this.rotation.y=Math.PI/2,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.CombinedCamera.prototype.toTopView=function(){this.rotation.x=-Math.PI/2,this.rotation.y=0,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.CombinedCamera.prototype.toBottomView=function(){this.rotation.x=Math.PI/2,this.rotation.y=0,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.CSS3DObject=function(e){THREE.Object3D.call(this),this.element=e,this.element.style.position="absolute",this.addEventListener("removed",function(){null!==this.element.parentNode&&this.element.parentNode.removeChild(this.element)})},THREE.CSS3DObject.prototype=Object.create(THREE.Object3D.prototype),THREE.CSS3DObject.prototype.constructor=THREE.CSS3DObject,THREE.CSS3DSprite=function(e){THREE.CSS3DObject.call(this,e)},THREE.CSS3DSprite.prototype=Object.create(THREE.CSS3DObject.prototype),THREE.CSS3DSprite.prototype.constructor=THREE.CSS3DSprite,THREE.CSS3DRenderer=function(){var r,u,h,p,d=new THREE.Matrix4,f={camera:{fov:0,style:""},objects:{}},m=document.createElement("div");m.style.overflow="hidden",this.domElement=m;var g=document.createElement("div");g.style.WebkitTransformStyle="preserve-3d",g.style.MozTransformStyle="preserve-3d",g.style.transformStyle="preserve-3d",m.appendChild(g);var v=/Trident/i.test(navigator.userAgent);function y(e){return Math.abs(e)<1e-10?0:e}function b(e,t){var r=e.elements,i="matrix3d("+y(r[0])+","+y(r[1])+","+y(r[2])+","+y(r[3])+","+y(-r[4])+","+y(-r[5])+","+y(-r[6])+","+y(-r[7])+","+y(r[8])+","+y(r[9])+","+y(r[10])+","+y(r[11])+","+y(r[12])+","+y(r[13])+","+y(r[14])+","+y(r[15])+")";return v?"translate(-50%,-50%)translate("+h+"px,"+p+"px)"+t+i:"translate(-50%,-50%)"+i}this.setClearColor=function(){},this.getSize=function(){return{width:r,height:u}},this.setSize=function(e,t){h=(r=e)/2,p=(u=t)/2,m.style.width=e+"px",m.style.height=t+"px",g.style.width=e+"px",g.style.height=t+"px"};var i,n,x=(i=new THREE.Vector3,n=new THREE.Vector3,function(e,t){return i.setFromMatrixPosition(e.matrixWorld),n.setFromMatrixPosition(t.matrixWorld),i.distanceToSquared(n)});this.render=function(e,t){var r=.5/Math.tan(THREE.Math.degToRad(.5*t.getEffectiveFOV()))*u;f.camera.fov!==r&&(m.style.WebkitPerspective=r+"px",m.style.MozPerspective=r+"px",m.style.perspective=r+"px",f.camera.fov=r),e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld();var i,n,o="translateZ("+r+"px)";t.isOrthographicCamera&&(o+="scale("+t.zoom+")");var a,s,l,c=(o+=(i=t.matrixWorldInverse,"matrix3d("+y((n=i.elements)[0])+","+y(-n[1])+","+y(n[2])+","+y(n[3])+","+y(n[4])+","+y(-n[5])+","+y(n[6])+","+y(n[7])+","+y(n[8])+","+y(-n[9])+","+y(n[10])+","+y(n[11])+","+y(n[12])+","+y(-n[13])+","+y(n[14])+","+y(n[15])+")"))+"translate("+h+"px,"+p+"px)";f.camera.style===c||v||(g.style.WebkitTransform=c,g.style.MozTransform=c,g.style.transform=c,f.camera.style=c),function e(t,r,i){if(t instanceof THREE.CSS3DObject){var n;n=t instanceof THREE.CSS3DSprite?(d.copy(r.matrixWorldInverse),d.transpose(),d.copyPosition(t.matrixWorld),d.scale(t.scale),d.elements[3]=0,d.elements[7]=0,d.elements[11]=0,d.elements[15]=1,b(d,i)):b(t.matrixWorld,i);var o=t.element,a=f.objects[t.id]&&f.objects[t.id].style;void 0!==a&&a===n||(o.style.WebkitTransform=n,o.style.MozTransform=n,o.style.transform=n,f.objects[t.id]={style:n},v&&(f.objects[t.id].distanceToCameraSquared=x(r,t))),o.parentNode!==g&&g.appendChild(o)}for(var s=0,l=t.children.length;s<l;s++)e(t.children[s],r,i)}(e,t,o),v&&(a=e,s=Object.keys(f.objects).sort(function(e,t){return f.objects[e].distanceToCameraSquared-f.objects[t].distanceToCameraSquared}),l=s.length,a.traverse(function(e){var t=s.indexOf(e.id+"");-1!==t&&(e.element.style.zIndex=l-t)}))}},THREE.DeviceOrientationControls=function(e){var o=this;this.object=e,this.object.rotation.reorder("YXZ"),this.enabled=!0,this.deviceOrientation={},this.screenOrientation=0,this.alphaOffset=0;var a,s,l,c,t=function(e){o.deviceOrientation=e},r=function(){o.screenOrientation=window.orientation||0},u=(a=new THREE.Vector3(0,0,1),s=new THREE.Euler,l=new THREE.Quaternion,c=new THREE.Quaternion(-Math.sqrt(.5),0,0,Math.sqrt(.5)),function(e,t,r,i,n){s.set(r,t,-i,"YXZ"),e.setFromEuler(s),e.multiply(c),e.multiply(l.setFromAxisAngle(a,-n))});this.connect=function(){r(),window.addEventListener("orientationchange",r,!1),window.addEventListener("deviceorientation",t,!1),o.enabled=!0},this.disconnect=function(){window.removeEventListener("orientationchange",r,!1),window.removeEventListener("deviceorientation",t,!1),o.enabled=!1},this.update=function(){if(!1!==o.enabled){var e=o.deviceOrientation;if(e){var t=e.alpha?THREE.Math.degToRad(e.alpha)+o.alphaOffset:0,r=e.beta?THREE.Math.degToRad(e.beta):0,i=e.gamma?THREE.Math.degToRad(e.gamma):0,n=o.screenOrientation?THREE.Math.degToRad(o.screenOrientation):0;u(o.object.quaternion,t,r,i,n)}}},this.dispose=function(){o.disconnect()},this.connect()},THREE.EarthOrbitControls=function(e,t){var c;this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.target=new THREE.Vector3,this._leftInteractive=!0,this.minDistance=0,this.maxDistance=11079114.2,this.minZoom=0,this.maxZoom=1/0,this.maxPitchAngle=82,this.minPolarAngle=0,this.maxPolarAngle=Math.PI/2,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.25,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.keyPanSpeed=7,this.mousePanSpeed=1,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={ORBIT:THREE.MOUSE.LEFT,ZOOM:THREE.MOUSE.MIDDLE,PAN:THREE.MOUSE.RIGHT},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.standardRadius=10216133.731679259,this.targetMaxOffset=6e7,this.panStander=this.maxDistance-6378e3,this.isDispatchEvent=!0,this.getPolarAngle=function(){return f.phi},this.getAzimuthalAngle=function(){return f.theta},this.getRotationSpherePhi=function(){return m.phi},this.getSphericalRadius=function(){return f.radius},this.saveState=function(){u.target0.copy(u.target),u.position0.copy(u.object.position),u.zoom0=u.object.zoom},this.reset=function(){u.target.copy(u.target0),u.object.position.copy(u.position0),u.object.zoom=u.zoom0,u.object.updateProjectionMatrix(),u.dispatchEvent(h),u.update(),d=p.NONE},this.goHome=function(){P=!0,u.object.up.set(0,1,0),u.object.position.set(4890109.86328125,9295980.46875,13943610.3515625),f.radius,m.phi=-.01,m.theta=Math.PI/2,m.radius=f.radius-6378e3,u.update()},this.setState=function(e){var t=u._getIntersectPoint();u.target.copy(t);var r=u.target,i=u.object.position,n=(new THREE.Vector3).subVectors(r,i),o=(new THREE.Vector3).crossVectors(i,n),a=(new THREE.Vector3).crossVectors(n,o);a=a.normalize(),u.object.up.copy(a),u.object.lookAt(r.x,r.y,r.z)},this._getIntersectPoint=function(){var e=new THREE.Vector3;this.object.getWorldDirection(e),e.normalize(),l.set(this.object.position,e);var t=new THREE.Vector3;return l.intersectSphere(O,t),t},this._getIntersectQuaternion=function(e,t){(new THREE.Vector3).copy(e);var r=new THREE.Vector3;r.copy(e),r.normalize();var i=new THREE.Quaternion;i.setFromUnitVectors(new THREE.Vector3(0,1,0),r);var n=new THREE.Quaternion;return n.setFromAxisAngle(new THREE.Vector3(0,1,0),Math.PI/2+t),i.multiply(n),i.normalize(),i},this._correctCube=function(){var e=this._getIntersectPoint();k.position.copy(e),v.setFromVector3(e),v.radius=6378e3;var t=this._getIntersectQuaternion(e,v.theta);k.rotation.set(0,0,0),k.applyQuaternion(t),k.updateMatrixWorld(!0)},this._correctSphericalRotation=function(e){var t=new THREE.Vector3;if(t.copy(e),k.worldToLocal(t),m.setFromVector3(t),0!=u.target.length()){var r=u.object.position.distanceTo(u.target);m.radius=r}m.phi=-m.phi,m.theta=Math.PI+m.theta,!1},this._getAngle=function(){if(0!=u.target.length()){var e=new THREE.Vector3;e.copy(u.target),e.normalize();var t=new THREE.Vector3(0,6378e3,0);t.sub(this.object.position),t.normalize();var r=new THREE.Vector3;this.object.getWorldDirection(r),r.projectOnPlane(e),t.projectOnPlane(e);var i=t.angleTo(r);return r.cross(t),r.sub(e),r.length()<=1&&(i*=-1),i}},this.update=(c=new THREE.Vector3,function(){var e=u.object.position;if(c.copy(e),f.setFromVector3(c),v.setFromVector3(u.target),v.radius=6378e3,!I&&u.app&&(u.app.scene.add(k),k.visible=!1,I=!0),P){if(u.dispatchEvent(h),P=!1,N.multiply(j),e.applyQuaternion(N),u.object.updateMatrixWorld(!0),0!=u.target.length())(r=new THREE.Vector3).copy(e),r.normalize(),u.object.up.copy(r),u.target.applyQuaternion(N);else{var t=this._getIntersectPoint();t.y+=100,u.target.copy(t)}u.object.lookAt(u.target)}else if(A){u.dispatchEvent(h),A=!1;var r,i=this._getIntersectPoint();(r=new THREE.Vector3).copy(k.position),r.normalize();var n=new THREE.Vector3;n.setFromSpherical(m),n.applyMatrix4(k.matrixWorld),u.object.up.copy(r),u.object.position.copy(n),u.target.copy(i),u.object.lookAt(u.target)}else if(C||L){u.dispatchEvent(h);var o=u.object.position.distanceTo(this._getIntersectPoint());if(o>u.maxDistance&&L||o<u.minDistance&&C)return L=C=!1,void(m.radius=o);var a=f.radius*y-f.radius;u.object.translateZ(a),i=this._getIntersectPoint();var s=u.object.position.distanceTo(i);m.radius=s,L=C=!1}this._correctCube(),this._correctSphericalRotation(e);var l=u.object.position.distanceTo(u.target);return u.rotateSpeed=l/3e7,u.zoomSpeed=(f.radius-6378e3)/4e6,u.mousePanSpeed=1,u.enableDamping,g.set(0,0,0),y=1,b.set(0,0,0),!1}),this.dispose=function(){u._leftInteractive?(u.domElement.removeEventListener("contextmenu",ie,!1),u.domElement.removeEventListener("mousedown",Q,!1)):(u.domElement.removeEventListener("mousedown",ie,!1),u.domElement.removeEventListener("contextmenu",Q,!1)),u.domElement.removeEventListener("wheel",K,!1),u.domElement.removeEventListener("touchstart",ee,!1),u.domElement.removeEventListener("touchend",re,!1),u.domElement.removeEventListener("touchmove",te,!1),document.removeEventListener("mousemove",J,!1),document.removeEventListener("mouseup",Z,!1),window.removeEventListener("keydown",$,!1)};var u=this,r={type:"wheel"},h={type:"change"},a={type:"start"},i={type:"end"},p={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},d=p.NONE,f=new THREE.Spherical,m=new THREE.Spherical;m.theta=Math.PI/2,m.phi=-.01,m.radius=this.panStander;var g=new THREE.Spherical,v=new THREE.Spherical;v.radius=6378e3;new THREE.Spherical,new THREE.Cylindrical,new THREE.Cylindrical;var y=1,b=new THREE.Vector3,x=new THREE.Vector2,E=new THREE.Vector2,_=new THREE.Vector2,n=new THREE.Vector2,o=new THREE.Vector2,s=new THREE.Vector2,w=new THREE.Vector2,T=new THREE.Vector2,M=new THREE.Vector2,S=new THREE.Vector2,R=new THREE.Vector2,P=(new THREE.Vector3,new THREE.Vector3,!1),A=!1,C=!1,L=!1,l=new THREE.Ray,O=new THREE.Sphere(new THREE.Vector3(0,0,0),6378e3),H=new THREE.BoxGeometry(1e3,1e3,1e3),F=new THREE.MeshBasicMaterial({color:65280}),k=new THREE.Mesh(H,F),I=!1,j=new THREE.Quaternion,N=new THREE.Quaternion;function D(){return Math.pow(.95,u.zoomSpeed)}function U(e){var t=new THREE.Vector3(0,6378e4,0);t.unproject(u.object),t.normalize(),e*=1-Math.sin(m.phi),N.setFromAxisAngle(t,-e)}function V(e){var t=new THREE.Vector3(6378e3,0,0);t.unproject(u.object),t.normalize(),j.setFromAxisAngle(t,-e)}var B=function(e){-.001<m.phi||(m.theta-=e,m.theta>2*Math.PI&&(m.theta=m.theta-2*Math.PI),m.theta<0&&(m.theta=2*Math.PI+m.theta))},z=function(e){A=!0,m.phi+=e,-.01<=m.phi&&(m.phi=-.01),m.phi<-u.maxPitchAngle*Math.PI/180&&(m.phi=-u.maxPitchAngle*Math.PI/180)},q=function(){new THREE.Vector3;return function(e,t){var r=u.domElement===document?u.domElement.body:u.domElement;u.object.isPerspectiveCamera?(B(2*Math.PI*e/r.clientWidth*u.mousePanSpeed),z(2*Math.PI*t/r.clientHeight*u.mousePanSpeed)):u.object.isOrthographicCamera?(B(e*(u.object.right-u.object.left)/u.object.zoom/r.clientWidth,u.object.matrix),z(t*(u.object.top-u.object.bottom)/u.object.zoom/r.clientHeight,u.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),u.enablePan=!1)}}();function G(e){L=!0,u.object.isPerspectiveCamera?y/=e:u.object.isOrthographicCamera?(u.object.zoom=Math.max(u.minZoom,Math.min(u.maxZoom,u.object.zoom*e)),u.object.updateProjectionMatrix(),!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),u.enableZoom=!1)}function W(e){C=!0,u.object.isPerspectiveCamera?y*=e:u.object.isOrthographicCamera?(u.object.zoom=Math.max(u.minZoom,Math.min(u.maxZoom,u.object.zoom/e)),u.object.updateProjectionMatrix(),!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),u.enableZoom=!1)}function X(e){n.set(e.touches[0].pageX,e.touches[0].pageY)}function Y(e){o.set(e.touches[0].pageX,e.touches[0].pageY),s.subVectors(o,n),q(s.x,s.y),n.copy(o),u.update()}function Q(e){if(!1!==u.enabled){switch(e.preventDefault(),e.button){case u.mouseButtons.ORBIT:if(!1===u.enableRotate)return;i=e,x.set(i.clientX,i.clientY),d=p.ROTATE;break;case u.mouseButtons.ZOOM:if(!1===u.enableZoom)return;r=e,w.set(r.clientX,r.clientY),d=p.DOLLY;break;case u.mouseButtons.PAN:if(!1===u.enablePan)return;t=e,n.set(t.clientX,t.clientY),d=p.PAN}var t,r,i;d!==p.NONE&&(document.addEventListener("mousemove",J,!1),document.addEventListener("mouseup",Z,!1),u.dispatchEvent(a))}}function J(e){var t,r;if(!1!==u.enabled)switch(e.preventDefault(),d){case p.ROTATE:if(!1===u.enableRotate)return;!function(e){P=!0,E.set(e.clientX,e.clientY),_.subVectors(E,x);var t=u.domElement===document?u.domElement.body:u.domElement;U(2*Math.PI*_.x/t.clientWidth*u.rotateSpeed),V(2*Math.PI*_.y/t.clientHeight*u.rotateSpeed),x.copy(E),u.update()}(e);break;case p.DOLLY:if(!1===u.enableZoom)return;r=e,T.set(r.clientX,r.clientY),M.subVectors(T,w),0<M.y?G(D()):M.y<0&&W(D()),w.copy(T),u.update();break;case p.PAN:if(!1===u.enablePan)return;t=e,o.set(t.clientX,t.clientY),s.subVectors(o,n),q(s.x,s.y),n.copy(o),u.update()}}function Z(e){if(!1===u.enabled)return document.removeEventListener("mousemove",J,!1),void document.removeEventListener("mouseup",Z,!1);document.removeEventListener("mousemove",J,!1),document.removeEventListener("mouseup",Z,!1),u.dispatchEvent(i),d=p.NONE}function K(e){var t;!1===u.enabled||!1===u.enableZoom||d!==p.NONE&&d!==p.ROTATE||(e.preventDefault(),e.stopPropagation(),(t=e).deltaY<0?(W(D()),u.dispatchEvent(r)):0<t.deltaY&&(G(D()),u.dispatchEvent(r)),u.update(),u.dispatchEvent(a),u.dispatchEvent(i))}function $(e){!1!==u.enabled&&!1!==u.enableKeys&&!1!==u.enablePan&&function(e){switch(e.keyCode){case u.keys.UP:q(0,u.keyPanSpeed),u.update();break;case u.keys.BOTTOM:q(0,-u.keyPanSpeed),u.update();break;case u.keys.LEFT:q(u.keyPanSpeed,0),u.update();break;case u.keys.RIGHT:q(-u.keyPanSpeed,0),u.update()}}(e)}function ee(e){if(!1!==u.enabled){switch(e.touches.length){case 1:if(!1===u.enableRotate)return;o=e,x.set(o.touches[0].pageX,o.touches[0].pageY),d=p.TOUCH_ROTATE;break;case 3:if(!1===u.enableZoom)return;X(e),d=p.TOUCH_PAN;break;case 2:if(S.set(e.touches[0].pageX,e.touches[0].pageY),R.set(e.touches[1].pageX,e.touches[1].pageY),!1===u.enablePan)return;X(e),r=(t=e).touches[0].pageX-t.touches[1].pageX,i=t.touches[0].pageY-t.touches[1].pageY,n=Math.sqrt(r*r+i*i),w.set(0,n),d=p.TOUCH_PAN;break;default:d=p.NONE}var t,r,i,n,o;d!==p.NONE&&u.dispatchEvent(a)}}function te(e){var t,r,i,n;if(!1!==u.enabled)switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:if(!1===u.enableRotate)return;if(d!==p.TOUCH_ROTATE)return;!function(e){P=!0,E.set(e.touches[0].pageX,e.touches[0].pageY),_.subVectors(E,x);var t=u.domElement===document?u.domElement.body:u.domElement;U(2*Math.PI*_.x/t.clientWidth*u.rotateSpeed),V(2*Math.PI*_.y/t.clientHeight*u.rotateSpeed),x.copy(E),u.update()}(e);break;case 3:if(!1===u.enableZoom)return;if(d!==p.TOUCH_PAN)return;Y(e);break;case 2:var o=new THREE.Vector2(e.touches[0].pageX,e.touches[0].pageY),a=new THREE.Vector2(e.touches[1].pageX,e.touches[1].pageY),s=o.sub(S).normalize(),l=a.sub(R).normalize();if(0<s.dot(l)){if(d=p.TOUCH_PAN,!1===u.enablePan)return;Y(e)}else{if(d=p.TOUCH_DOLLY,!1===u.enableZoom)return;r=(t=e).touches[0].pageX-t.touches[1].pageX,i=t.touches[0].pageY-t.touches[1].pageY,n=Math.sqrt(r*r+i*i),T.set(0,n),M.subVectors(T,w),0<M.y?W(D()):M.y<0&&G(D()),w.copy(T),u.update()}break;default:d=p.NONE}}function re(e){!1!==u.enabled&&(u.dispatchEvent(i),d=p.NONE)}function ie(e){!1!==u.enabled&&e.preventDefault()}u.rotate=function(e,t){switch(t=(t=t||1e3)/180*Math.PI,e){case"up":this.pan(0,t);break;case"down":this.pan(0,-t);break;case"left":this.pan(t,0);break;case"right":this.pan(-t,0)}},u.zoom=function(e,t){switch(t=t||.95,t=Math.pow(t,u.zoomSpeed),e){case"in":W(t);break;case"out":G(t)}},u.earthRotate=function(e,t){switch(t=(t=t||10)/180*Math.PI,t*=this.rotateSpeed,N.set(0,0,0,1),j.set(0,0,0,1),P=!0,e){case"right":U(-t);break;case"left":U(t);break;case"up":V(t);break;case"down":V(-t)}},u._leftInteractive?(u.domElement.addEventListener("contextmenu",ie,!1),u.domElement.addEventListener("mousedown",Q,!1)):(u.domElement.addEventListener("mousedown",ie,!1),u.domElement.addEventListener("contextmenu",Q,!1)),u.domElement.addEventListener("wheel",K,!1),u.domElement.addEventListener("touchstart",ee,!1),u.domElement.addEventListener("touchend",re,!1),u.domElement.addEventListener("touchmove",te,!1),window.addEventListener("keydown",$,!1),u.setLeftInteractive=function(e){u.mouseButtons=e?{ORBIT:0,ZOOM:1,PAN:2}:{ORBIT:2,ZOOM:1,PAN:0},u._leftInteractive=e},this.update(),u.pan=q,u.panDelta=s},THREE.EarthOrbitControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.EarthOrbitControls.prototype.constructor=THREE.EarthOrbitControls,Object.defineProperties(THREE.EarthOrbitControls.prototype,{leftInteractive:{get:function(){return this._leftInteractive},set:function(e){this.setLeftInteractive(e)}},center:{get:function(){return console.warn("THREE.EarthOrbitControls: .center has been renamed to .target"),this.target}},noZoom:{get:function(){return console.warn("THREE.EarthOrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),!this.enableZoom},set:function(e){console.warn("THREE.EarthOrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),this.enableZoom=!e}},noRotate:{get:function(){return console.warn("THREE.EarthOrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),!this.enableRotate},set:function(e){console.warn("THREE.EarthOrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),this.enableRotate=!e}},noPan:{get:function(){return console.warn("THREE.EarthOrbitControls: .noPan has been deprecated. Use .enablePan instead."),!this.enablePan},set:function(e){console.warn("THREE.EarthOrbitControls: .noPan has been deprecated. Use .enablePan instead."),this.enablePan=!e}},noKeys:{get:function(){return console.warn("THREE.EarthOrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),!this.enableKeys},set:function(e){console.warn("THREE.EarthOrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),this.enableKeys=!e}},staticMoving:{get:function(){return console.warn("THREE.EarthOrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),!this.enableDamping},set:function(e){console.warn("THREE.EarthOrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),this.enableDamping=!e}},dynamicDampingFactor:{get:function(){return console.warn("THREE.EarthOrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor},set:function(e){console.warn("THREE.EarthOrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor=e}}}),THREE.EarthOrbitControls.prototype.setLookAt=function(e){this.object.lookAt(new THREE.Vector3(e[0],e[1],e[2]))},THREE.FirstPersonControls=function(e,t){function r(e){e.preventDefault()}this.object=e,this.target=new THREE.Vector3(0,0,0),this.domElement=void 0!==t?t:document,this.enabled=!0,this.movementSpeed=5,this.lookSpeed=.1,this.lookVertical=!0,this.autoForward=!1,this.activeLook=!0,this.heightSpeed=!1,this.heightCoef=1,this.heightMin=0,this.heightMax=1,this.constrainVertical=!0,this.verticalMin=1,this.verticalMax=2,this.autoSpeedFactor=0,this.mouseX=0,this.mouseY=0,this.lat=0,this.lon=0,this.phi=0,this.theta=0,this.moveJump=!1,this.mouseRightDown=!1,this.surfaceFloor=null,this.birdsEye=1.8,this.timeLeft=6,this.raycaster=new THREE.Raycaster,this.originPos=[-2,18.7,25],this.dropDistance=-123,this.raycaster.ray.direction.set(0,-1,0),this.initEnabled=!0,this.accelerate=2.5,this.peopleHeight=1.7,this.smooth=.1,this.moveForward=!1,this.moveBackward=!1,this.moveLeft=!1,this.moveRight=!1,this.mouseDragOn=!1,this.viewHalfX=0,this.viewHalfY=0,this.domElement!==document&&this.domElement.setAttribute("tabindex",-1),this.handleResize=function(){this.domElement===document?(this.viewHalfX=window.innerWidth/2,this.viewHalfY=window.innerHeight/2):(this.viewHalfX=this.domElement.offsetWidth/2,this.viewHalfY=this.domElement.offsetHeight/2)},this.onMouseDown=function(e){if(this.domElement!==document&&this.domElement.focus(),e.preventDefault(),e.stopPropagation(),this.activeLook)switch(e.button){case 2:this.mouseRightDown=!0}this.mouseDragOn=!0},this.onMouseUp=function(e){if(e.preventDefault(),e.stopPropagation(),this.activeLook)switch(e.button){case 2:this.mouseRightDown=!1}this.mouseDragOn=!1},this.onMouseMove=function(e){this.domElement===document?(this.mouseX=e.pageX-this.viewHalfX,this.mouseY=e.pageY-this.viewHalfY):(this.mouseX=e.pageX-this.domElement.offsetLeft-this.viewHalfX,this.mouseY=e.pageY-this.domElement.offsetTop-this.viewHalfY)},this.onKeyDown=function(e){switch(e.keyCode){case 16:this.speedUp=!0;break;case 38:case 87:this.moveForward=!0;break;case 37:case 65:this.moveLeft=!0;break;case 40:case 83:this.moveBackward=!0;break;case 39:case 68:this.moveRight=!0;break;case 82:this.moveUp=!0;break;case 70:this.moveDown=!0}},this.onKeyUp=function(e){switch(e.keyCode){case 16:this.speedUp=!1;break;case 38:case 87:this.moveForward=!1;break;case 37:case 65:this.moveLeft=!1;break;case 40:case 83:this.moveBackward=!1;break;case 39:case 68:this.moveRight=!1;break;case 82:this.moveUp=!1;break;case 70:this.moveDown=!1}},this.resetToOrigin=function(){this.initEnabled=!0},this.update=function(e){if(!1!==this.enabled&&null!=this.surfaceFloor){if(this.heightSpeed){var t=THREE.Math.clamp(this.object.position.y,this.heightMin,this.heightMax)-this.heightMin;this.autoSpeedFactor=e*(t*this.heightCoef)}else this.autoSpeedFactor=0;if(this.mouseRightDown||this.initEnabled){this.initEnabled&&(this.object.position.set(this.originPos[0],this.originPos[1],this.originPos[2]),this.initEnabled=!1);var r=e*this.lookSpeed;this.activeLook||(r=0);var i=1;this.constrainVertical&&(i=Math.PI/(this.verticalMax-this.verticalMin)),this.lon+=this.mouseX*r,this.lookVertical&&(this.lat-=this.mouseY*r*i),this.lat=Math.max(-85,Math.min(85,this.lat)),this.phi=THREE.Math.degToRad(90-this.lat),this.theta=THREE.Math.degToRad(this.lon),this.constrainVertical&&(this.phi=THREE.Math.mapLinear(this.phi,0,Math.PI,this.verticalMin,this.verticalMax))}this.object.position.y<this.dropDistance&&this.object.position.set(this.originPos[0],this.originPos[1],this.originPos[2]);var n=1;n=this.speedUp?e*this.movementSpeed*this.accelerate:e*this.movementSpeed,(this.moveForward||this.autoForward&&!this.moveBackward)&&this.object.translateZ(-(n+this.autoSpeedFactor)),this.moveBackward&&this.object.translateZ(n),this.moveLeft&&this.object.translateX(-n),this.moveRight&&this.object.translateX(n),this.raycaster.ray.origin.copy(this.object.position),this.raycaster.ray.origin.y+=this.birdsEye;var o=this.raycaster.intersectObject(this.surfaceFloor,!0);if(o.length<1)(this.moveForward||this.autoForward&&!this.moveBackward)&&this.object.translateZ(n+this.autoSpeedFactor+this.smooth),this.moveBackward&&this.object.translateZ(-n-this.smooth),this.moveLeft&&this.object.translateX(n+this.smooth),this.moveRight&&this.object.translateX(-n-this.smooth);else{var a=o[0].distance-this.birdsEye;this.object.position.y=this.peopleHeight+this.object.position.y-a}var s=this.target,l=this.object.position;s.x=l.x+100*Math.sin(this.phi)*Math.cos(this.theta),s.y=l.y+100*Math.cos(this.phi),s.z=l.z+100*Math.sin(this.phi)*Math.sin(this.theta),this.object.lookAt(s)}},this.dispose=function(){this.domElement.removeEventListener("contextmenu",r,!1),this.domElement.removeEventListener("mousedown",n,!1),this.domElement.removeEventListener("mousemove",i,!1),this.domElement.removeEventListener("mouseup",o,!1),window.removeEventListener("keydown",a,!1),window.removeEventListener("keyup",s,!1)};var i=l(this,this.onMouseMove),n=l(this,this.onMouseDown),o=l(this,this.onMouseUp),a=l(this,this.onKeyDown),s=l(this,this.onKeyUp);function l(e,t){return function(){t.apply(e,arguments)}}this.domElement.addEventListener("contextmenu",r,!1),this.domElement.addEventListener("mousemove",i,!1),this.domElement.addEventListener("mousedown",n,!1),this.domElement.addEventListener("mouseup",o,!1),window.addEventListener("keydown",a,!1),window.addEventListener("keyup",s,!1),this.handleResize()},THREE.FreeControls=function(e){this.object=e,this.object.rotation.setRotationOrder("YXZ"),this.movementSpeed=.25,this.rotateSpeed=.25,this.enableMovementDamping=!0,this.movementDampingFactor=.25,this.enableRotateDamping=!0,this.rotateDampingFactor=.25,this.enableFly=!0,this.enableKeyRotate=!1,this.getMoveDirection=function(e){return e=e||new THREE.Vector3,this.enableFly?(r.set(1,0,0).applyQuaternion(this.object.quaternion).multiplyScalar(c.x),e.add(r),r.set(0,1,0).applyQuaternion(this.object.quaternion).multiplyScalar(c.y),e.add(r),r.set(0,0,1).applyQuaternion(this.object.quaternion).multiplyScalar(c.z)):(r.set(1,0,0).applyQuaternion(this.object.quaternion).multiplyScalar(c.x),e.add(r),r.set(0,0,1).applyAxisAngle(new THREE.Vector3(1,0,0),-this.object.rotation.x).applyQuaternion(this.object.quaternion).multiplyScalar(c.z)),e.add(r),e},this.update=function(e){var t=(e=e||.0166)*this.movementSpeed/.0166*(1===u.run?2:1);return c.add(s),l.add(a),this.enableFly?(r.set(1,0,0).applyQuaternion(this.object.quaternion).multiplyScalar(c.x*t),this.object.position.add(r),r.set(0,1,0).applyQuaternion(this.object.quaternion).multiplyScalar(c.y*t),this.object.position.add(r),r.set(0,0,1).applyQuaternion(this.object.quaternion).multiplyScalar(c.z*t)):(r.set(1,0,0).applyQuaternion(this.object.quaternion).multiplyScalar(c.x*t),this.object.position.add(r),r.set(0,0,1).applyAxisAngle(h,-this.object.rotation.x).applyQuaternion(this.object.quaternion).multiplyScalar(c.z*t)),this.object.position.add(r),this.object.rotation.x+=e*l.x/.0166,this.object.rotation.y+=e*l.y/.0166,this.enableMovementDamping?c.multiplyScalar(1-this.movementDampingFactor):c.set(0,0,0),this.enableRotateDamping?l.multiplyScalar(1-this.rotateDampingFactor):l.set(0,0),this.enableKeyRotate||a.set(0,0),(i.distanceToSquared(this.object.position)>o||8*(1-n.dot(this.object.quaternion))>o)&&(i.copy(this.object.position),n.copy(this.object.quaternion),!0)};var r=new THREE.Vector3,i=new THREE.Vector3,n=new THREE.Quaternion,o=1e-6,a=new THREE.Vector2,s=new THREE.Vector3,l=new THREE.Vector2,c=new THREE.Vector3,u={up:0,down:0,left:0,right:0,forward:0,back:0,run:0},h=new THREE.Vector3(1,0,0),t=this;this.updateMovementVector=function(){t.enableKeyRotate?a.y=-2*Math.PI*.005*(-u.left+u.right)*t.rotateSpeed:s.x=-u.left+u.right,s.y=-u.down+u.up,s.z=-u.forward+u.back},this.rotateDelta=a,this.moveDelta=s,this.moveState=u},THREE.FreeMouseControls=function(e,t){THREE.FreeControls.call(this,e),this.domElement=void 0!==t?t:document,t&&this.domElement.setAttribute("tabindex",-1);var r=new THREE.Vector2,i=new THREE.Vector2,n=this.rotateDelta,o=(this.moveDelta,0),a=this.moveState,s=this;function l(){var e=s.domElement===document?s.domElement.body:s.domElement,t=n.x,r=n.y;n.x=2*Math.PI*r/e.clientHeight,n.y=2*Math.PI*t/e.clientWidth}var c=this.updateMovementVector;function u(e){r.set(e.clientX,e.clientY),o=1}function h(e){0!=o&&(s.enableKeyRotate||(i.set(e.clientX,e.clientY),n.subVectors(i,r).multiplyScalar(-s.rotateSpeed),l(),r.copy(i)))}function p(e){o=0,n.set(0,0)}function d(e){switch(e.keyCode){case 87:a.forward=1;break;case 83:a.back=1;break;case 65:a.left=1;break;case 68:a.right=1;break;case 82:a.up=1;break;case 70:a.down=1;break;case 69:a.up=1;break;case 81:a.down=1;break;case 16:a.run=1}c()}function f(e){switch(e.keyCode){case 87:a.forward=0;break;case 83:a.back=0;break;case 65:a.left=0;break;case 68:a.right=0;break;case 82:a.up=0;break;case 70:a.down=0;break;case 69:a.up=0;break;case 81:a.down=0;break;case 16:a.run=0}c()}this.domElement.addEventListener("mousemove",h,!1),this.domElement.addEventListener("mousedown",u,!1),this.domElement.addEventListener("mouseup",p,!1),window.addEventListener("keydown",d,!1),window.addEventListener("keyup",f,!1),c(),l(),this.dispose=function(){this.domElement.removeEventListener("mousemove",h,!1),this.domElement.removeEventListener("mousedown",u,!1),this.domElement.removeEventListener("mouseup",p,!1),window.removeEventListener("keydown",d,!1),window.removeEventListener("keyup",f,!1)}},THREE.OBJLoader=function(){var q=/^[og]\s*(.+)?/,G=/^mtllib /,W=/^usemtl /;function X(){var e={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materialLibraries:[],startObject:function(e,t){if(this.object&&!1===this.object.fromDeclaration)return this.object.name=e,void(this.object.fromDeclaration=!1!==t);var r=this.object&&"function"==typeof this.object.currentMaterial?this.object.currentMaterial():void 0;if(this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0),this.object={name:e||"",fromDeclaration:!1!==t,geometry:{vertices:[],normals:[],colors:[],uvs:[]},materials:[],smooth:!0,startMaterial:function(e,t){var r=this._finalize(!1);r&&(r.inherited||r.groupCount<=0)&&this.materials.splice(r.index,1);var i={index:this.materials.length,name:e||"",mtllib:Array.isArray(t)&&0<t.length?t[t.length-1]:"",smooth:void 0!==r?r.smooth:this.smooth,groupStart:void 0!==r?r.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(e){var t={index:"number"==typeof e?e:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return t.clone=this.clone.bind(t),t}};return this.materials.push(i),i},currentMaterial:function(){if(0<this.materials.length)return this.materials[this.materials.length-1]},_finalize:function(e){var t=this.currentMaterial();if(t&&-1===t.groupEnd&&(t.groupEnd=this.geometry.vertices.length/3,t.groupCount=t.groupEnd-t.groupStart,t.inherited=!1),e&&1<this.materials.length)for(var r=this.materials.length-1;0<=r;r--)this.materials[r].groupCount<=0&&this.materials.splice(r,1);return e&&0===this.materials.length&&this.materials.push({name:"",smooth:this.smooth}),t}},r&&r.name&&"function"==typeof r.clone){var i=r.clone(0);i.inherited=!0,this.object.materials.push(i)}this.objects.push(this.object)},finalize:function(){this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0)},parseVertexIndex:function(e,t){var r=parseInt(e,10);return 3*(0<=r?r-1:r+t/3)},parseNormalIndex:function(e,t){var r=parseInt(e,10);return 3*(0<=r?r-1:r+t/3)},parseUVIndex:function(e,t){var r=parseInt(e,10);return 2*(0<=r?r-1:r+t/2)},addVertex:function(e,t,r){var i=this.vertices,n=this.object.geometry.vertices;n.push(i[e+0],i[e+1],i[e+2]),n.push(i[t+0],i[t+1],i[t+2]),n.push(i[r+0],i[r+1],i[r+2])},addVertexPoint:function(e){var t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addVertexLine:function(e){var t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addNormal:function(e,t,r){var i=this.normals,n=this.object.geometry.normals;n.push(i[e+0],i[e+1],i[e+2]),n.push(i[t+0],i[t+1],i[t+2]),n.push(i[r+0],i[r+1],i[r+2])},addColor:function(e,t,r){var i=this.colors,n=this.object.geometry.colors;n.push(i[e+0],i[e+1],i[e+2]),n.push(i[t+0],i[t+1],i[t+2]),n.push(i[r+0],i[r+1],i[r+2])},addUV:function(e,t,r){var i=this.uvs,n=this.object.geometry.uvs;n.push(i[e+0],i[e+1]),n.push(i[t+0],i[t+1]),n.push(i[r+0],i[r+1])},addUVLine:function(e){var t=this.uvs;this.object.geometry.uvs.push(t[e+0],t[e+1])},addFace:function(e,t,r,i,n,o,a,s,l){var c=this.vertices.length,u=this.parseVertexIndex(e,c),h=this.parseVertexIndex(t,c),p=this.parseVertexIndex(r,c);if(this.addVertex(u,h,p),void 0!==i&&""!==i){var d=this.uvs.length;u=this.parseUVIndex(i,d),h=this.parseUVIndex(n,d),p=this.parseUVIndex(o,d),this.addUV(u,h,p)}if(void 0!==a&&""!==a){var f=this.normals.length;u=this.parseNormalIndex(a,f),h=a===s?u:this.parseNormalIndex(s,f),p=a===l?u:this.parseNormalIndex(l,f),this.addNormal(u,h,p)}0<this.colors.length&&this.addColor(u,h,p)},addPointGeometry:function(e){this.object.geometry.type="Points";for(var t=this.vertices.length,r=0,i=e.length;r<i;r++)this.addVertexPoint(this.parseVertexIndex(e[r],t))},addLineGeometry:function(e,t){this.object.geometry.type="Line";for(var r=this.vertices.length,i=this.uvs.length,n=0,o=e.length;n<o;n++)this.addVertexLine(this.parseVertexIndex(e[n],r));var a=0;for(o=t.length;a<o;a++)this.addUVLine(this.parseUVIndex(t[a],i))}};return e.startObject("",!1),e}function e(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager,this.materials=null}return e.prototype={constructor:e,load:function(e,t,r,i){var n=this,o=new THREE.FileLoader(n.manager);o.setPath(this.path),o.load(e,function(e){t(n.parse(e))},r,i)},setPath:function(e){return this.path=e,this},setMaterials:function(e){return this.materials=e,this},parse:function(e){console.time("OBJLoader");var t=new X;-1!==e.indexOf("\r\n")&&(e=e.replace(/\r\n/g,"\n")),-1!==e.indexOf("\\\n")&&(e=e.replace(/\\\n/g,""));for(var r=e.split("\n"),i="",n="",o=[],a="function"==typeof"".trimLeft,s=0,l=r.length;s<l;s++)if(i=r[s],0!==(i=a?i.trimLeft():i.trim()).length&&"#"!==(n=i.charAt(0)))if("v"===n){var c=i.split(/\s+/);switch(c[0]){case"v":t.vertices.push(parseFloat(c[1]),parseFloat(c[2]),parseFloat(c[3])),8===c.length&&t.colors.push(parseFloat(c[4]),parseFloat(c[5]),parseFloat(c[6]));break;case"vn":t.normals.push(parseFloat(c[1]),parseFloat(c[2]),parseFloat(c[3]));break;case"vt":t.uvs.push(parseFloat(c[1]),parseFloat(c[2]))}}else if("f"===n){for(var u=i.substr(1).trim().split(/\s+/),h=[],p=0,d=u.length;p<d;p++){var f=u[p];if(0<f.length){var m=f.split("/");h.push(m)}}var g=h[0];for(p=1,d=h.length-1;p<d;p++){var v=h[p],y=h[p+1];t.addFace(g[0],v[0],y[0],g[1],v[1],y[1],g[2],v[2],y[2])}}else if("l"===n){var b=i.substring(1).trim().split(" "),x=[],E=[];if(-1===i.indexOf("/"))x=b;else for(var _=0,w=b.length;_<w;_++){var T=b[_].split("/");""!==T[0]&&x.push(T[0]),""!==T[1]&&E.push(T[1])}t.addLineGeometry(x,E)}else if("p"===n){var M=i.substr(1).trim().split(" ");t.addPointGeometry(M)}else if(null!==(o=q.exec(i))){var S=(" "+o[0].substr(1).trim()).substr(1);t.startObject(S)}else if(W.test(i))t.object.startMaterial(i.substring(7).trim(),t.materialLibraries);else if(G.test(i))t.materialLibraries.push(i.substring(7).trim());else{if("s"!==n){if("\0"===i)continue;throw new Error('THREE.OBJLoader: Unexpected line: "'+i+'"')}if(1<(o=i.split(" ")).length){var R=o[1].trim().toLowerCase();t.object.smooth="0"!==R&&"off"!==R}else t.object.smooth=!0;(V=t.object.currentMaterial())&&(V.smooth=t.object.smooth)}t.finalize();var P=new THREE.Group;P.materialLibraries=[].concat(t.materialLibraries);for(s=0,l=t.objects.length;s<l;s++){var A=t.objects[s],C=A.geometry,L=A.materials,O="Line"===C.type,H="Points"===C.type,F=!1;if(0!==C.vertices.length){var k=new THREE.BufferGeometry;k.addAttribute("position",new THREE.Float32BufferAttribute(C.vertices,3)),0<C.normals.length?k.addAttribute("normal",new THREE.Float32BufferAttribute(C.normals,3)):k.computeVertexNormals(),0<C.colors.length&&(F=!0,k.addAttribute("color",new THREE.Float32BufferAttribute(C.colors,3))),0<C.uvs.length&&k.addAttribute("uv",new THREE.Float32BufferAttribute(C.uvs,2));for(var I,j=[],N=0,D=L.length;N<D;N++){var U=L[N],V=void 0;if(null!==this.materials)if(V=this.materials.create(U.name),!O||!V||V instanceof THREE.LineBasicMaterial){if(H&&V&&!(V instanceof THREE.PointsMaterial)){var B=new THREE.PointsMaterial({size:10,sizeAttenuation:!1});z.copy(V),V=B}}else{var z=new THREE.LineBasicMaterial;z.copy(V),z.lights=!1,V=z}V||((V=O?new THREE.LineBasicMaterial:H?new THREE.PointsMaterial({size:1,sizeAttenuation:!1}):new THREE.MeshPhongMaterial).name=U.name),V.flatShading=!U.smooth,V.vertexColors=F?THREE.VertexColors:THREE.NoColors,j.push(V)}if(1<j.length){for(N=0,D=L.length;N<D;N++){U=L[N];k.addGroup(U.groupStart,U.groupCount,N)}I=O?new THREE.LineSegments(k,j):H?new THREE.Points(k,j):new THREE.Mesh(k,j)}else I=O?new THREE.LineSegments(k,j[0]):H?new THREE.Points(k,j[0]):new THREE.Mesh(k,j[0]);I.name=A.name,P.add(I)}}return console.timeEnd("OBJLoader"),P}},e}(),THREE.OrbitControls=function(e,t){var r,i,n,o,a;this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.target=new THREE.Vector3,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.25,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!1,this.keyPanSpeed=7,this.autoRotate=!1,this.autoLeftRotate=!1,this.autoUpRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={LEFT:THREE.MOUSE.LEFT,MIDDLE:THREE.MOUSE.MIDDLE,RIGHT:THREE.MOUSE.RIGHT},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.move=function(e,t){V(e,t)},this.getPolarAngle=function(){return v.phi},this.getAzimuthalAngle=function(){return v.theta},this.saveState=function(){s.target0.copy(s.target),s.position0.copy(s.object.position),s.zoom0=s.object.zoom},this.reset=function(){s.target.copy(s.target0),s.object.position.copy(s.position0),s.object.zoom=s.zoom0,s.object.updateProjectionMatrix(),s.dispatchEvent(u),s.update(),m=f.NONE},this.update=(r=new THREE.Vector3,i=(new THREE.Quaternion).setFromUnitVectors(e.up,new THREE.Vector3(0,1,0)),n=i.clone().inverse(),o=new THREE.Vector3,a=new THREE.Quaternion,function(){var e=s.object.position;return r.copy(e).sub(s.target),r.applyQuaternion(i),v.setFromVector3(r),s.autoRotate&&m===f.NONE&&(s.autoLeftRotate?F(O()):s.autoUpRotate&&k(O())),v.theta+=y.theta,v.phi+=y.phi,v.theta=Math.max(s.minAzimuthAngle,Math.min(s.maxAzimuthAngle,v.theta)),v.phi=Math.max(s.minPolarAngle,Math.min(s.maxPolarAngle,v.phi)),v.makeSafe(),v.radius*=b,v.radius=Math.max(s.minDistance,Math.min(s.maxDistance,v.radius)),s.target.add(x),r.setFromSpherical(v),r.applyQuaternion(n),e.copy(s.target).add(r),s.object.lookAt(s.target),!0===s.enableDamping?(y.theta*=1-s.dampingFactor,y.phi*=1-s.dampingFactor,x.multiplyScalar(1-s.dampingFactor)):(y.set(0,0,0),x.set(0,0,0)),b=1,!(!(E||o.distanceToSquared(s.object.position)>g||8*(1-a.dot(s.object.quaternion))>g)||(s.dispatchEvent(u),o.copy(s.object.position),a.copy(s.object.quaternion),E=!1))}),this.dispose=function(){s.domElement.removeEventListener("contextmenu",ee,!1),s.domElement.removeEventListener("mousedown",G,!1),s.domElement.removeEventListener("wheel",Y,!1),s.domElement.removeEventListener("touchstart",Z,!1),s.domElement.removeEventListener("touchend",$,!1),s.domElement.removeEventListener("touchmove",K,!1),s.domElement.removeEventListener("mousemove",J,!1),document.removeEventListener("mousemove",W,!1),document.removeEventListener("mouseup",X,!1),window.removeEventListener("keydown",Q,!1)};var s=this,l={type:"mousemoveevent"},c={type:"wheel",delta:0},u={type:"change"},h={type:"start"},p={type:"end"},d={type:"mousedownpanevent"},f={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY_PAN:4},m=f.NONE,g=1e-6,v=new THREE.Spherical,y=new THREE.Spherical,b=1,x=new THREE.Vector3,E=!1,_=new THREE.Vector2,w=new THREE.Vector2,T=new THREE.Vector2,M=new THREE.Vector2,S=new THREE.Vector2,R=new THREE.Vector2,P=new THREE.Vector2,A=new THREE.Vector2,C=new THREE.Vector2,L=null;function O(){return 2*Math.PI/60/60*s.autoRotateSpeed}function H(){return Math.pow(.95,s.zoomSpeed)}function F(e){y.theta-=e}function k(e){y.phi-=e}var I,j,N,D=(I=new THREE.Vector3,function(e,t){I.setFromMatrixColumn(t,0),I.multiplyScalar(-e),x.add(I)}),U=(j=new THREE.Vector3,function(e,t){!0===s.screenSpacePanning?j.setFromMatrixColumn(t,1):(j.setFromMatrixColumn(t,0),j.crossVectors(s.object.up,j)),j.multiplyScalar(e),x.add(j)}),V=(N=new THREE.Vector3,function(e,t){var r=s.domElement===document?s.domElement.body:s.domElement;if(s.object.isPerspectiveCamera){var i=s.object.position;N.copy(i).sub(s.target);var n=N.length();n*=Math.tan(s.object.fov/2*Math.PI/180),D(2*e*n/r.clientHeight,s.object.matrix),U(2*t*n/r.clientHeight,s.object.matrix)}else s.object.isOrthographicCamera?(D(e*(s.object.right-s.object.left)/s.object.zoom/r.clientWidth,s.object.matrix),U(t*(s.object.top-s.object.bottom)/s.object.zoom/r.clientHeight,s.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),s.enablePan=!1)});function B(e){s.object.isPerspectiveCamera?b/=e:s.object.isOrthographicCamera?(s.object.zoom=Math.max(s.minZoom,Math.min(s.maxZoom,s.object.zoom*e)),s.object.updateProjectionMatrix(),E=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),s.enableZoom=!1)}function z(e){s.object.isPerspectiveCamera?b*=e:s.object.isOrthographicCamera?(s.object.zoom=Math.max(s.minZoom,Math.min(s.maxZoom,s.object.zoom/e)),s.object.updateProjectionMatrix(),E=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),s.enableZoom=!1)}function q(e){M.set(e.clientX,e.clientY),s.dispatchEvent(d)}function G(e){if(!1!==s.enabled){switch(e.preventDefault(),e.button){case s.mouseButtons.LEFT:if(e.ctrlKey||e.metaKey){if(!1===s.enablePan)return;q(e),m=f.PAN}else{if(!1===s.enableRotate)return;r=e,_.set(r.clientX,r.clientY),m=f.ROTATE}break;case s.mouseButtons.MIDDLE:if(!1===s.enableZoom)return;t=e,P.set(t.clientX,t.clientY),m=f.DOLLY;break;case s.mouseButtons.RIGHT:if(!1===s.enablePan)return;q(e),m=f.PAN}var t,r;m!==f.NONE&&(document.addEventListener("mousemove",W,!1),document.addEventListener("mouseup",X,!1),s.dispatchEvent(h))}}function W(e){var t,r;if(!1!==s.enabled)switch(e.preventDefault(),m){case f.ROTATE:if(!1===s.enableRotate)return;!function(e){w.set(e.clientX,e.clientY),T.subVectors(w,_).multiplyScalar(s.rotateSpeed);var t=s.domElement===document?s.domElement.body:s.domElement;F(2*Math.PI*T.x/t.clientHeight),k(2*Math.PI*T.y/t.clientHeight),_.copy(w),s.update()}(e);break;case f.DOLLY:if(!1===s.enableZoom)return;r=e,A.set(r.clientX,r.clientY),C.subVectors(A,P),0<C.y?B(H()):C.y<0&&z(H()),P.copy(A),s.update();break;case f.PAN:if(!1===s.enablePan)return;t=e,S.set(t.clientX,t.clientY),R.subVectors(S,M).multiplyScalar(s.panSpeed),V(R.x,R.y),M.copy(S),s.update()}}function X(e){!1!==s.enabled&&(document.removeEventListener("mousemove",W,!1),document.removeEventListener("mouseup",X,!1),s.dispatchEvent(p),m=f.NONE)}function Y(e){var t;!1===s.enabled||!1===s.enableZoom||m!==f.NONE&&m!==f.ROTATE||(e.preventDefault(),e.stopPropagation(),(t=e).deltaY<0?z(H()):0<t.deltaY&&B(H()),c.delta=t.deltaY,s.dispatchEvent(c),s.update())}function Q(e){!1!==s.enabled&&!1!==s.enableKeys&&!1!==s.enablePan&&function(e){switch(e.keyCode){case s.keys.UP:V(0,s.keyPanSpeed),s.update();break;case s.keys.BOTTOM:V(0,-s.keyPanSpeed),s.update();break;case s.keys.LEFT:V(s.keyPanSpeed,0),s.update();break;case s.keys.RIGHT:V(-s.keyPanSpeed,0),s.update()}}(e)}function J(e){var t=!1;if(L){var r=L.distanceTo({x:e.x,y:e.y});0!==e.buttons&&2<=r&&(t=!0)}else L=new THREE.Vector2;L.set(e.x,e.y),t&&s.dispatchEvent(l)}function Z(e){if(!1!==s.enabled){switch(e.preventDefault(),e.touches.length){case 1:if(!1===s.enableRotate)return;t=e,_.set(t.touches[0].pageX,t.touches[0].pageY),m=f.TOUCH_ROTATE;break;case 2:if(!1===s.enableZoom&&!1===s.enablePan)return;!function(e){if(s.enableZoom){var t=e.touches[0].pageX-e.touches[1].pageX,r=e.touches[0].pageY-e.touches[1].pageY,i=Math.sqrt(t*t+r*r);P.set(0,i)}if(s.enablePan){var n=.5*(e.touches[0].pageX+e.touches[1].pageX),o=.5*(e.touches[0].pageY+e.touches[1].pageY);M.set(n,o)}}(e),m=f.TOUCH_DOLLY_PAN;break;default:m=f.NONE}var t;m!==f.NONE&&s.dispatchEvent(h)}}function K(e){if(!1!==s.enabled)switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:if(!1===s.enableRotate)return;if(m!==f.TOUCH_ROTATE)return;!function(e){w.set(e.touches[0].pageX,e.touches[0].pageY),T.subVectors(w,_).multiplyScalar(s.rotateSpeed);var t=s.domElement===document?s.domElement.body:s.domElement;F(2*Math.PI*T.x/t.clientHeight),k(2*Math.PI*T.y/t.clientHeight),_.copy(w),s.update()}(e);break;case 2:if(!1===s.enableZoom&&!1===s.enablePan)return;if(m!==f.TOUCH_DOLLY_PAN)return;!function(e){if(s.enableZoom){var t=e.touches[0].pageX-e.touches[1].pageX,r=e.touches[0].pageY-e.touches[1].pageY,i=Math.sqrt(t*t+r*r);A.set(0,i),C.set(0,Math.pow(A.y/P.y,s.zoomSpeed)),B(C.y),P.copy(A)}if(s.enablePan){var n=.5*(e.touches[0].pageX+e.touches[1].pageX),o=.5*(e.touches[0].pageY+e.touches[1].pageY);S.set(n,o),R.subVectors(S,M).multiplyScalar(s.panSpeed),V(R.x,R.y),M.copy(S)}s.update()}(e);break;default:m=f.NONE}}function $(e){!1!==s.enabled&&(s.dispatchEvent(p),m=f.NONE)}function ee(e){!1!==s.enabled&&e.preventDefault()}s.domElement.addEventListener("contextmenu",ee,!1),s.domElement.addEventListener("mousedown",G,!1),s.domElement.addEventListener("wheel",Y,!1),s.domElement.addEventListener("touchstart",Z,!1),s.domElement.addEventListener("touchend",$,!1),s.domElement.addEventListener("touchmove",K,!1),s.domElement.addEventListener("mousemove",J,!1),window.addEventListener("keydown",Q,!1),this.update()},THREE.OrbitControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.OrbitControls.prototype.constructor=THREE.OrbitControls,Object.defineProperties(THREE.OrbitControls.prototype,{center:{get:function(){return console.warn("THREE.OrbitControls: .center has been renamed to .target"),this.target}},noZoom:{get:function(){return console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),!this.enableZoom},set:function(e){console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),this.enableZoom=!e}},noRotate:{get:function(){return console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),!this.enableRotate},set:function(e){console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),this.enableRotate=!e}},noPan:{get:function(){return console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),!this.enablePan},set:function(e){console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),this.enablePan=!e}},noKeys:{get:function(){return console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),!this.enableKeys},set:function(e){console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),this.enableKeys=!e}},staticMoving:{get:function(){return console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),!this.enableDamping},set:function(e){console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),this.enableDamping=!e}},dynamicDampingFactor:{get:function(){return console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor},set:function(e){console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor=e}}}),THREE.Reflector=function(e,t){THREE.Mesh.call(this,e),this.type="Reflector";var u=this,r=void 0!==(t=t||{}).color?new THREE.Color(t.color):new THREE.Color(8355711),i=t.textureWidth||512,n=t.textureHeight||512,h=t.clipBias||0,o=t.shader||THREE.Reflector.ReflectorShader,p=void 0!==t.recursion?t.recursion:0,d=new THREE.Plane,f=new THREE.Vector3,m=new THREE.Vector3,g=new THREE.Vector3,v=new THREE.Matrix4,y=new THREE.Vector3(0,0,-1),b=new THREE.Vector4,x=new THREE.Vector4,E=new THREE.Vector3,_=new THREE.Vector3,w=new THREE.Vector4,T=new THREE.Matrix4,M=new THREE.PerspectiveCamera,a={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBFormat,stencilBuffer:!1},S=new THREE.WebGLRenderTarget(i,n,a);THREE.Math.isPowerOfTwo(i)&&THREE.Math.isPowerOfTwo(n)||(S.texture.generateMipmaps=!1);var s=new THREE.ShaderMaterial({uniforms:THREE.UniformsUtils.clone(o.uniforms),fragmentShader:o.fragmentShader,vertexShader:o.vertexShader});s.uniforms.tDiffuse.value=S.texture,s.uniforms.color.value=r,s.uniforms.textureMatrix.value=T,this.material=s,this.renderOrder=-1/0,this.addBeforeRenderFunction("THREE.Reflector",function(e,t,r){if("recursion"in r.userData){if(r.userData.recursion===p)return;r.userData.recursion++}if(m.setFromMatrixPosition(u.matrixWorld),g.setFromMatrixPosition(r.matrixWorld),v.extractRotation(u.matrixWorld),f.set(0,0,1),f.applyMatrix4(v),E.subVectors(m,g),!(0<E.dot(f))){E.reflect(f).negate(),E.add(m),v.extractRotation(r.matrixWorld),y.set(0,0,-1),y.applyMatrix4(v),y.add(g),_.subVectors(m,y),_.reflect(f).negate(),_.add(m),M.position.copy(E),M.up.set(0,1,0),M.up.applyMatrix4(v),M.up.reflect(f),M.lookAt(_),M.far=r.far,M.updateMatrixWorld(),M.projectionMatrix.copy(r.projectionMatrix),M.userData.recursion=0,T.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),T.multiply(M.projectionMatrix),T.multiply(M.matrixWorldInverse),T.multiply(u.matrixWorld),d.setFromNormalAndCoplanarPoint(f,m),d.applyMatrix4(M.matrixWorldInverse),b.set(d.normal.x,d.normal.y,d.normal.z,d.constant);var i=M.projectionMatrix;w.x=(Math.sign(b.x)+i.elements[8])/i.elements[0],w.y=(Math.sign(b.y)+i.elements[9])/i.elements[5],w.z=-1,w.w=(1+i.elements[10])/i.elements[14],b.multiplyScalar(2/b.dot(w)),i.elements[2]=b.x,i.elements[6]=b.y,i.elements[10]=b.z+1-h,i.elements[14]=b.w,u.visible=!1;var n=e.getRenderTarget(),o=e.vr.enabled,a=e.shadowMap.autoUpdate;e.vr.enabled=!1,e.shadowMap.autoUpdate=!1,e.render(t,M,S,!0),e.vr.enabled=o,e.shadowMap.autoUpdate=a,e.setRenderTarget(n);var s=r.bounds;if(void 0!==s){var l=e.getSize(),c=e.getPixelRatio();x.x=s.x*l.width*c,x.y=s.y*l.height*c,x.z=s.z*l.width*c,x.w=s.w*l.height*c,e.state.viewport(x)}u.visible=!0}}),this.getRenderTarget=function(){return S}},THREE.Reflector.prototype=Object.create(THREE.Mesh.prototype),THREE.Reflector.prototype.constructor=THREE.Reflector,THREE.Reflector.ReflectorShader={uniforms:{color:{type:"c",value:null},tDiffuse:{type:"t",value:null},textureMatrix:{type:"m4",value:null}},vertexShader:["uniform mat4 textureMatrix;","varying vec4 vUv;","void main() {","\tvUv = textureMatrix * vec4( position, 1.0 );","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform vec3 color;","uniform sampler2D tDiffuse;","varying vec4 vUv;","float blendOverlay( float base, float blend ) {","\treturn( base < 0.5 ? ( 2.0 * base * blend ) : ( 1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );","}","vec3 blendOverlay( vec3 base, vec3 blend ) {","\treturn vec3( blendOverlay( base.r, blend.r ), blendOverlay( base.g, blend.g ), blendOverlay( base.b, blend.b ) );","}","void main() {","\tvec4 base = texture2DProj( tDiffuse, vUv );","\tgl_FragColor = vec4( blendOverlay( base.rgb, color ), 1.0 );","}"].join("\n")},THREE.ReflectorRTT=function(e,t){THREE.Reflector.call(this,e,t),this.geometry.setDrawRange(0,0)},THREE.ReflectorRTT.prototype=Object.create(THREE.Reflector.prototype),THREE.Refractor=function(e,t){THREE.Mesh.call(this,e),this.type="Refractor";var c=this,r=void 0!==(t=t||{}).color?new THREE.Color(t.color):new THREE.Color(8355711),i=t.textureWidth||512,n=t.textureHeight||512,o=t.clipBias||0,a=t.shader||THREE.Refractor.RefractorShader,u=new THREE.PerspectiveCamera;u.matrixAutoUpdate=!1,u.userData.refractor=!0;var s=new THREE.Plane,l=new THREE.Matrix4,h={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBFormat,stencilBuffer:!1},p=new THREE.WebGLRenderTarget(i,n,h);THREE.Math.isPowerOfTwo(i)&&THREE.Math.isPowerOfTwo(n)||(p.texture.generateMipmaps=!1),this.material=new THREE.ShaderMaterial({uniforms:THREE.UniformsUtils.clone(a.uniforms),vertexShader:a.vertexShader,fragmentShader:a.fragmentShader,transparent:!0}),this.material.uniforms.color.value=r,this.material.uniforms.tDiffuse.value=p.texture,this.material.uniforms.textureMatrix.value=l;var d,f,m,g,v,y,b,x,E,_,w,T,M=(d=new THREE.Vector3,f=new THREE.Vector3,m=new THREE.Matrix4,g=new THREE.Vector3,v=new THREE.Vector3,function(e){return d.setFromMatrixPosition(c.matrixWorld),f.setFromMatrixPosition(e.matrixWorld),g.subVectors(d,f),m.extractRotation(c.matrixWorld),v.set(0,0,1),v.applyMatrix4(m),g.dot(v)<0}),S=(y=new THREE.Vector3,b=new THREE.Vector3,x=new THREE.Quaternion,E=new THREE.Vector3,function(){c.matrixWorld.decompose(b,x,E),y.set(0,0,1).applyQuaternion(x).normalize(),y.negate(),s.setFromNormalAndCoplanarPoint(y,b)}),R=(_=new THREE.Plane,w=new THREE.Vector4,T=new THREE.Vector4,function(e){u.matrixWorld.copy(e.matrixWorld),u.matrixWorldInverse.getInverse(u.matrixWorld),u.projectionMatrix.copy(e.projectionMatrix),u.far=e.far,_.copy(s),_.applyMatrix4(u.matrixWorldInverse),w.set(_.normal.x,_.normal.y,_.normal.z,_.constant);var t=u.projectionMatrix;T.x=(Math.sign(w.x)+t.elements[8])/t.elements[0],T.y=(Math.sign(w.y)+t.elements[9])/t.elements[5],T.z=-1,T.w=(1+t.elements[10])/t.elements[14],w.multiplyScalar(2/w.dot(T)),t.elements[2]=w.x,t.elements[6]=w.y,t.elements[10]=w.z+1-o,t.elements[14]=w.w});var P,A=(P=new THREE.Vector4,function(e,t,r){c.visible=!1;var i=e.getRenderTarget(),n=e.vr.enabled,o=e.shadowMap.autoUpdate;e.vr.enabled=!1,e.shadowMap.autoUpdate=!1,e.render(t,u,p,!0),e.vr.enabled=n,e.shadowMap.autoUpdate=o,e.setRenderTarget(i);var a=r.bounds;if(void 0!==a){var s=e.getSize(),l=e.getPixelRatio();P.x=a.x*s.width*l,P.y=a.y*s.height*l,P.z=a.z*s.width*l,P.w=a.w*s.height*l,e.state.viewport(P)}c.visible=!0});this.onBeforeRender=function(e,t,r){var i;!0!==r.userData.refractor&&(!0!=!M(r)&&(S(),i=r,l.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),l.multiply(i.projectionMatrix),l.multiply(i.matrixWorldInverse),l.multiply(c.matrixWorld),R(r),A(e,t,r)))},this.getRenderTarget=function(){return p}},THREE.Refractor.prototype=Object.create(THREE.Mesh.prototype),THREE.Refractor.prototype.constructor=THREE.Refractor,THREE.Refractor.RefractorShader={uniforms:{color:{type:"c",value:null},tDiffuse:{type:"t",value:null},textureMatrix:{type:"m4",value:null}},vertexShader:["uniform mat4 textureMatrix;","varying vec4 vUv;","void main() {","\tvUv = textureMatrix * vec4( position, 1.0 );","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform vec3 color;","uniform sampler2D tDiffuse;","varying vec4 vUv;","float blendOverlay( float base, float blend ) {","\treturn( base < 0.5 ? ( 2.0 * base * blend ) : ( 1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );","}","vec3 blendOverlay( vec3 base, vec3 blend ) {","\treturn vec3( blendOverlay( base.r, blend.r ), blendOverlay( base.g, blend.g ), blendOverlay( base.b, blend.b ) );","}","void main() {","\tvec4 base = texture2DProj( tDiffuse, vUv );","\tgl_FragColor = vec4( blendOverlay( base.rgb, color ), 1.0 );","}"].join("\n")},THREE.SceneUtils={createMultiMaterialObject:function(e,t){for(var r=new THREE.Group,i=0,n=t.length;i<n;i++)r.add(new THREE.Mesh(e,t[i]));return r},detach:function(e,t,r){e.applyMatrix(t.matrixWorld),t.remove(e),r.add(e)},attach:function(e,t,r){e.applyMatrix((new THREE.Matrix4).getInverse(r.matrixWorld)),t.remove(e),r.add(e)}},THREE.SimplifyModifier=function(){},function(){var i=new THREE.Vector3,n=new THREE.Vector3;function a(e,t){var r=e.indexOf(t);-1<r&&e.splice(r,1)}function o(e,t){var r=t.position.distanceTo(e.position),i=0,n=[],o=(e.faces,e.faces.length);for(u=0;u<o;u++)(h=e.faces[u]).hasVertex(t)&&n.push(h);for(u=0;u<o;u++){var a=1;h=e.faces[u];for(var s=0;s<n.length;s++){p=n[s];var l=h.normal.dot(p.normal);a=Math.min(a,(1.001-l)/2)}i=Math.max(i,a)}n.length<2&&(i=1),e.isBorder()&&1<n.length&&(i=1);for(var c=0,u=0;u<o;u++){var h=e.faces[u];for(s=0;s<n.length;s++){var p=n[s];if(h.uvAt(e).equals(p.uvAt(e)))break}s==n.length&&c++}return c&&(i=1),r*i+0}function m(e){if(0===e.neighbors.length)return e.collapseNeighbor=null,void(e.collapseCost=-.01);e.collapseCost=1e5,e.collapseNeighbor=null;for(var t=0;t<e.neighbors.length;t++){var r=o(e,e.neighbors[t]);e.collapseNeighbor||(e.collapseNeighbor=e.neighbors[t],e.collapseCost=r,e.minCost=r,e.totalCost=0,e.costCount=0),e.costCount++,e.totalCost+=r,r<e.minCost&&(e.collapseNeighbor=e.neighbors[t],e.minCost=r)}e.collapseCost=e.totalCost/e.costCount}function h(e,t){for(console.assert(0===e.faces.length);e.neighbors.length;){a(e.neighbors.pop().neighbors,e)}a(t,e)}function p(e,t){a(t,e),e.v1&&a(e.v1.faces,e),e.v2&&a(e.v2.faces,e),e.v3&&a(e.v3.faces,e);for(var r,i,n=[this.v1,this.v2,this.v3],o=0;o<3;o++)i=n[(o+1)%3],(r=n[o])&&i&&(r.removeIfNonNeighbor(i),i.removeIfNonNeighbor(r))}function g(e,t,r,i){if(i){var n=[];for(s=0;s<r.neighbors.length;s++)n.push(r.neighbors[s]);for(var o=[],a=r.faces.length,s=0;s<a;s++){(l=r.faces[s]).hasVertex(i)&&o.push(l)}for(s=0;s<a;s++){var l;if(!(l=r.faces[s]).hasVertex(i))for(var c=0;c<o.length;c++){var u=o[c];if(l.uvAt(r).equals(u.uvAt(r))){l.setUV(r,u.uvAt(i));break}o.length}}for(s=r.faces.length-1;0<=s;s--)r.faces[s].hasVertex(i)&&p(r.faces[s],t);for(s=r.faces.length-1;0<=s;s--)r.faces[s].replaceVertex(r,i);for(h(r,e),s=0;s<n.length;s++)m(n[s])}else h(r,e)}function v(e){for(var t=e[0],r=0;r<e.length;r++)e[r].collapseCost<t.collapseCost&&(t=e[r]);return t}function y(e,t,r,i,n,o,a,s,l){this.a=i,this.b=n,this.c=o,this.v1=e,this.v2=t,this.v3=r,this.uv1=a,this.uv2=s,this.uv3=l,this.normal=new THREE.Vector3,this.computeNormal(),e.faces.push(this),e.addUniqueNeighbor(t),e.addUniqueNeighbor(r),t.faces.push(this),t.addUniqueNeighbor(e),t.addUniqueNeighbor(r),r.faces.push(this),r.addUniqueNeighbor(e),r.addUniqueNeighbor(t)}function b(e,t){this.position=e,this.id=t,this.faces=[],this.neighbors=[],this.collapseCost=0,this.collapseNeighbor=null}y.prototype.computeNormal=function(){var e=this.v1.position,t=this.v2.position,r=this.v3.position;i.subVectors(r,t),n.subVectors(e,t),i.cross(n).normalize(),this.normal.copy(i)},y.prototype.hasVertex=function(e){return e===this.v1||e===this.v2||e===this.v3},y.prototype.replaceVertex=function(e,t){e===this.v1?this.v1=t:e===this.v2?this.v2=t:e===this.v3&&(this.v3=t),a(e.faces,this),t.faces.push(this),e.removeIfNonNeighbor(this.v1),this.v1.removeIfNonNeighbor(e),e.removeIfNonNeighbor(this.v2),this.v2.removeIfNonNeighbor(e),e.removeIfNonNeighbor(this.v3),this.v3.removeIfNonNeighbor(e),this.v1.addUniqueNeighbor(this.v2),this.v1.addUniqueNeighbor(this.v3),this.v2.addUniqueNeighbor(this.v1),this.v2.addUniqueNeighbor(this.v3),this.v3.addUniqueNeighbor(this.v1),this.v3.addUniqueNeighbor(this.v2),this.computeNormal()},y.prototype.uvAt=function(i){var e=[this.v1,this.v2,this.v3].reduce(function(e,t,r){return!e.length&&i.position.equals(t)&&e.push(r),e},[])[0];return[this.uv1,this.uv2,this.uv3][e]},y.prototype.setUV=function(i,e){var t=[this.v1,this.v2,this.v3].reduce(function(e,t,r){return!e.length&&i.position.equals(t)&&e.push(r),e},[])[0];[this.uv1,this.uv2,this.uv3][t]=e},b.prototype.addUniqueNeighbor=function(e){var t,r;t=this.neighbors,r=e,-1===t.indexOf(r)&&t.push(r)},b.prototype.removeIfNonNeighbor=function(e){var t=this.neighbors,r=this.faces,i=t.indexOf(e);if(-1!==i){for(var n=0;n<r.length;n++)if(r[n].hasVertex(e))return;t.splice(i,1)}},b.prototype.isBorder=function(){for(var e=this.neighbors.length,t=0;t<e;t++){for(var r=0,i=this.faces.length,n=0;n<i;n++)this.faces[n].hasVertex(this.neighbors[t])&&r++;if(1===r)return!0}return!1},THREE.SimplifyModifier.prototype.modify=function(e,t){e instanceof THREE.BufferGeometry&&!e.vertices&&!e.faces&&(console.log("converting BufferGeometry to Geometry"),e=(new THREE.Geometry).fromBufferGeometry(e)),e.mergeVertices();var r,i,n=e.vertices,o=e.faces,a=e.faceVertexUvs[0],s=(new THREE.Geometry,new Array(n.length)),l=new Array(o.length);new Array(a.length);for(r=0,i=n.length;r<i;r++)s[r]=new b(n[r],r);for(r=0,i=o.length;r<i;r++)f=o[r],a[r],l[r]=new y(s[f.a],s[f.b],s[f.c],f.a,f.b,f.c,a[r][0],a[r][1],a[r][2]);for(r=0,i=s.length;r<i;r++)m(s[r]);new Array(s.length),new Array(s.length);for(var c,u=t;u--;){if(!(c=v(s))){console.log("no next vertex");break}g(s,l,c,c.collapseNeighbor)}var h=new THREE.Geometry;for(r=0;r<s.length;r++){var p=s[r];h.vertices.push(p.position)}for(r=0;r<l.length;r++){var d=l[r],f=new THREE.Face3(s.indexOf(d.v1),s.indexOf(d.v2),s.indexOf(d.v3),d.normal);h.faces.push(f),h.faceVertexUvs[0].push([d.uv1,d.uv2,d.uv3])}return h}}(),THREE.Sky=function(){var e=THREE.Sky.SkyShader,t=new THREE.ShaderMaterial({fragmentShader:e.fragmentShader,vertexShader:e.vertexShader,uniforms:THREE.UniformsUtils.clone(e.uniforms),side:THREE.BackSide});THREE.Mesh.call(this,new THREE.BoxBufferGeometry(1,1,1),t)},THREE.Sky.prototype=Object.assign(Object.create(THREE.Mesh.prototype),{constructor:THREE.Sky,isSky:!0}),THREE.Sky.SkyShader={uniforms:{luminance:{value:1},turbidity:{value:2},rayleigh:{value:1},mieCoefficient:{value:.005},mieDirectionalG:{value:.8},sunPosition:{value:new THREE.Vector3}},vertexShader:["uniform vec3 sunPosition;","uniform float rayleigh;","uniform float turbidity;","uniform float mieCoefficient;","varying vec3 vWorldPosition;","varying vec3 vSunDirection;","varying float vSunfade;","varying vec3 vBetaR;","varying vec3 vBetaM;","varying float vSunE;","const vec3 up = vec3( 0.0, 1.0, 0.0 );","const float e = 2.71828182845904523536028747135266249775724709369995957;","const float pi = 3.141592653589793238462643383279502884197169;","const vec3 lambda = vec3( 680E-9, 550E-9, 450E-9 );","const vec3 totalRayleigh = vec3( 5.804542996261093E-6, 1.3562911419845635E-5, 3.0265902468824876E-5 );","const float v = 4.0;","const vec3 K = vec3( 0.686, 0.678, 0.666 );","const vec3 MieConst = vec3( 1.8399918514433978E14, 2.7798023919660528E14, 4.0790479543861094E14 );","const float cutoffAngle = 1.6110731556870734;","const float steepness = 1.5;","const float EE = 1000.0;","float sunIntensity( float zenithAngleCos ) {","\tzenithAngleCos = clamp( zenithAngleCos, -1.0, 1.0 );","\treturn EE * max( 0.0, 1.0 - pow( e, -( ( cutoffAngle - acos( zenithAngleCos ) ) / steepness ) ) );","}","vec3 totalMie( float T ) {","\tfloat c = ( 0.2 * T ) * 10E-18;","\treturn 0.434 * c * MieConst;","}","void main() {","\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );","\tvWorldPosition = worldPosition.xyz;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","\tgl_Position.z = gl_Position.w;","\tvSunDirection = normalize( sunPosition );","\tvSunE = sunIntensity( dot( vSunDirection, up ) );","\tvSunfade = 1.0 - clamp( 1.0 - exp( ( sunPosition.y / 450000.0 ) ), 0.0, 1.0 );","\tfloat rayleighCoefficient = rayleigh - ( 1.0 * ( 1.0 - vSunfade ) );","\tvBetaR = totalRayleigh * rayleighCoefficient;","\tvBetaM = totalMie( turbidity ) * mieCoefficient;","}"].join("\n"),fragmentShader:["varying vec3 vWorldPosition;","varying vec3 vSunDirection;","varying float vSunfade;","varying vec3 vBetaR;","varying vec3 vBetaM;","varying float vSunE;","uniform float luminance;","uniform float mieDirectionalG;","const vec3 cameraPos = vec3( 0.0, 0.0, 0.0 );","const float pi = 3.141592653589793238462643383279502884197169;","const float n = 1.0003;","const float N = 2.545E25;","const float rayleighZenithLength = 8.4E3;","const float mieZenithLength = 1.25E3;","const vec3 up = vec3( 0.0, 1.0, 0.0 );","const float sunAngularDiameterCos = 0.999956676946448443553574619906976478926848692873900859324;","const float THREE_OVER_SIXTEENPI = 0.05968310365946075;","const float ONE_OVER_FOURPI = 0.07957747154594767;","float rayleighPhase( float cosTheta ) {","\treturn THREE_OVER_SIXTEENPI * ( 1.0 + pow( cosTheta, 2.0 ) );","}","float hgPhase( float cosTheta, float g ) {","\tfloat g2 = pow( g, 2.0 );","\tfloat inverse = 1.0 / pow( 1.0 - 2.0 * g * cosTheta + g2, 1.5 );","\treturn ONE_OVER_FOURPI * ( ( 1.0 - g2 ) * inverse );","}","const float A = 0.15;","const float B = 0.50;","const float C = 0.10;","const float D = 0.20;","const float E = 0.02;","const float F = 0.30;","const float whiteScale = 1.0748724675633854;","vec3 Uncharted2Tonemap( vec3 x ) {","\treturn ( ( x * ( A * x + C * B ) + D * E ) / ( x * ( A * x + B ) + D * F ) ) - E / F;","}","void main() {","\tfloat zenithAngle = acos( max( 0.0, dot( up, normalize( vWorldPosition - cameraPos ) ) ) );","\tfloat inverse = 1.0 / ( cos( zenithAngle ) + 0.15 * pow( 93.885 - ( ( zenithAngle * 180.0 ) / pi ), -1.253 ) );","\tfloat sR = rayleighZenithLength * inverse;","\tfloat sM = mieZenithLength * inverse;","\tvec3 Fex = exp( -( vBetaR * sR + vBetaM * sM ) );","\tfloat cosTheta = dot( normalize( vWorldPosition - cameraPos ), vSunDirection );","\tfloat rPhase = rayleighPhase( cosTheta * 0.5 + 0.5 );","\tvec3 betaRTheta = vBetaR * rPhase;","\tfloat mPhase = hgPhase( cosTheta, mieDirectionalG );","\tvec3 betaMTheta = vBetaM * mPhase;","\tvec3 Lin = pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * ( 1.0 - Fex ), vec3( 1.5 ) );","\tLin *= mix( vec3( 1.0 ), pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * Fex, vec3( 1.0 / 2.0 ) ), clamp( pow( 1.0 - dot( up, vSunDirection ), 5.0 ), 0.0, 1.0 ) );","\tvec3 direction = normalize( vWorldPosition - cameraPos );","\tfloat theta = acos( direction.y ); // elevation --\x3e y-axis, [-pi/2, pi/2]","\tfloat phi = atan( direction.z, direction.x ); // azimuth --\x3e x-axis [-pi/2, pi/2]","\tvec2 uv = vec2( phi, theta ) / vec2( 2.0 * pi, pi ) + vec2( 0.5, 0.0 );","\tvec3 L0 = vec3( 0.1 ) * Fex;","\tfloat sundisk = smoothstep( sunAngularDiameterCos, sunAngularDiameterCos + 0.00002, cosTheta );","\tL0 += ( vSunE * 19000.0 * Fex ) * sundisk;","\tvec3 texColor = ( Lin + L0 ) * 0.04 + vec3( 0.0, 0.0003, 0.00075 );","\tvec3 curr = Uncharted2Tonemap( ( log2( 2.0 / pow( luminance, 4.0 ) ) ) * texColor );","\tvec3 color = curr * whiteScale;","\tvec3 retColor = pow( color, vec3( 1.0 / ( 1.2 + ( 1.2 * vSunfade ) ) ) );","\tgl_FragColor = vec4( retColor, 1.0 );","}"].join("\n")},THREE.SubdivisionModifier=function(e){this.subdivisions=void 0===e?1:e},THREE.SubdivisionModifier.prototype.modify=function(e){for(var t=this.subdivisions;0<t--;)this.smooth(e);e.computeFaceNormals(),e.computeVertexNormals()},function(){var z=["a","b","c"];function q(e,t,r){return r[Math.min(e,t)+"_"+Math.max(e,t)]}function G(e,t,r,i,n,o){var a,s=Math.min(e,t),l=Math.max(e,t),c=s+"_"+l;c in i?a=i[c]:(a={a:r[s],b:r[l],newEdge:null,faces:[]},i[c]=a);a.faces.push(n),o[e].edges.push(a),o[t].edges.push(a)}function W(e,t,r,i,n){e.push(new THREE.Face3(t,r,i,void 0,void 0,n))}function X(e,t){return Math.abs(t-e)/2+Math.min(e,t)}function Y(e,t,r,i){e.push([t.clone(),r.clone(),i.clone()])}THREE.SubdivisionModifier.prototype.smooth=function(e){var t,r,i,n,o,a,s,l,c,u,h,p,d,f,m=new THREE.Vector3,g=[];t=e.vertices,r=e.faces;var v,y,b,x,E,_,w,T,M,S,R,P,A,C,L=void 0!==(i=e.faceVertexUvs[0])&&0<i.length;for(s in function(e,t,r,i){var n,o,a;for(n=0,o=e.length;n<o;n++)r[n]={edges:[]};for(n=0,o=t.length;n<o;n++)G((a=t[n]).a,a.b,e,i,a,r),G(a.b,a.c,e,i,a,r),G(a.c,a.a,e,i,a,r)}(t,r,h=new Array(t.length),p={}),d=[],p){for(y=p[s],b=new THREE.Vector3,E=3/8,_=1/8,2!=(w=y.faces.length)&&(E=.5,_=0),b.addVectors(y.a,y.b).multiplyScalar(E),m.set(0,0,0),c=0;c<w;c++){for(x=y.faces[c],u=0;u<3&&((v=t[x[z[u]]])===y.a||v===y.b);u++);m.add(v)}m.multiplyScalar(_),b.add(m),y.newEdge=d.length,d.push(b)}for(f=[],s=0,l=t.length;s<l;s++){for(A=t[s],3==(a=(P=h[s].edges).length)?T=3/16:3<a&&(T=3/(8*a)),M=1-a*T,S=T,a<=2&&2==a&&(M=.75,S=1/8),C=A.clone().multiplyScalar(M),m.set(0,0,0),c=0;c<a;c++)v=(R=P[c]).a!==A?R.a:R.b,m.add(v);m.multiplyScalar(S),C.add(m),f.push(C)}n=f.concat(d);var O,H,F,k,I,j,N,D=f.length;o=[];var U=new THREE.Vector2,V=new THREE.Vector2,B=new THREE.Vector2;for(s=0,l=r.length;s<l;s++)W(o,O=q((x=r[s]).a,x.b,p).newEdge+D,H=q(x.b,x.c,p).newEdge+D,F=q(x.c,x.a,p).newEdge+D,x.materialIndex),W(o,x.a,O,F,x.materialIndex),W(o,x.b,H,O,x.materialIndex),W(o,x.c,F,H,x.materialIndex),L&&(I=(k=i[s])[0],j=k[1],N=k[2],U.set(X(I.x,j.x),X(I.y,j.y)),V.set(X(j.x,N.x),X(j.y,N.y)),B.set(X(I.x,N.x),X(I.y,N.y)),Y(g,U,V,B),Y(g,I,U,B),Y(g,j,V,U),Y(g,N,B,V));e.vertices=n,e.faces=o,L&&(e.faceVertexUvs[0]=g)}}();var THREEx=THREEx||{};THREEx.HtmlMixer=THREEx.HtmlMixer||{},THREEx.HtmlMixer.Context=function(e,t,r){var i=[];this.update=function(){i.forEach(function(e){e()})};this.cssFactor=1e3;var n=new THREE.CSS3DRenderer;this.rendererCss=n,this.rendererWebgl=e;var o=new THREE.PerspectiveCamera(r.fov,r.aspect,1e3*r.near,1e3*r.far);i.push(function(){o.quaternion.copy(r.quaternion),o.position.copy(r.position).multiplyScalar(1e3)});var a=new THREE.Scene;this.cssScene=a,this.autoUpdateObjects=!0,i.push(function(){!0===this.autoUpdateObjects&&a.traverse(function(e){if(e instanceof THREE.Scene!=!0){var t=e.userData.mixerPlane;void 0!==t&&t.update()}})}.bind(this)),i.push(function(e,t){a.length&&n.render(a,o)})},THREEx.HtmlMixer.Plane=function(l,r,e){(e=e||{}).elementW=void 0!==e.elementW?e.elementW:768,e.planeW=void 0!==e.planeW?e.planeW:1,e.planeH=void 0!==e.planeH?e.planeH:.75,e.object3d=void 0!==e.object3d?e.object3d:null,this.domElement=r;var t=[];this.update=function(){t.forEach(function(e){e()})};var i=e.planeW,n=e.planeH;if(null===e.object3d)var o=new THREE.MeshBasicMaterial({opacity:0,color:new THREE.Color("black"),blending:THREE.NoBlending,side:THREE.DoubleSide}),a=new THREE.PlaneGeometry(1,1),c=new THREE.Mesh(a,o);else c=e.object3d;this.object3d=c;var s=n/i,u=e.elementW,h=u*s;function p(){r.style.width=u+"px",r.style.height=h+"px"}this.setDomElement=function(e){var t=r;t.parentNode&&t.parentNode.removeChild(t),this.domElement=r=e,d.element=r,p()},p();var d=new THREE.CSS3DObject(r);(this.cssObject=d).scale.set(i,n,1),d.userData.mixerPlane=this,c.addEventListener("added",function(e){l.cssScene.add(d)}),c.addEventListener("removed",function(e){l.cssScene.remove(d)}),t.push(function(){c.updateMatrixWorld();var e=c.matrixWorld,t=new THREE.Vector3,r=new THREE.Vector3,i=new THREE.Quaternion;e.decompose(t,i,r),d.quaternion.copy(i),d.position.copy(t).multiplyScalar(l.cssFactor);var n=l.cssFactor/1e3,o=c.geometry.parameters,a=l.cssFactor/(u/(o.width*r.x)),s=l.cssFactor/(h/(o.height*r.y));d.scale.set(a*n,s*n,1)})},THREE.TransformControls=function(e,i){THREE.Object3D.call(this),i=void 0!==i?i:document,this.visible=!1;var n=new THREE.TransformControlsGizmo;this._gizmo=n,this.add(n);var u=new THREE.TransformControlsPlane;this._plane=u,this.add(u);var o=this;I("camera",e),I("object",void 0),I("enabled",!0),I("axis",null),I("mode","translate"),I("translationSnap",null),I("rotationSnap",null),I("space","world"),I("size",1),I("dragging",!1),I("showX",!0),I("showY",!0),I("showZ",!0);var h={type:"change"},a={type:"mouseDown"},t={type:"mouseUp",mode:o.mode},p={type:"objectChange"},d=new THREE.Raycaster,f=new THREE.Vector3,m=new THREE.Vector3,g=new THREE.Quaternion,v={X:new THREE.Vector3(1,0,0),Y:new THREE.Vector3(0,1,0),Z:new THREE.Vector3(0,0,1)},y=new THREE.Quaternion,b=new THREE.Vector3,x=new THREE.Vector3,E=new THREE.Vector3,_=new THREE.Vector3,w=0,r=new THREE.Vector3,s=new THREE.Quaternion,l=new THREE.Vector3,c=new THREE.Vector3,T=new THREE.Quaternion,M=new THREE.Vector3,S=new THREE.Vector3,R=new THREE.Quaternion,P=new THREE.Vector3,A=new THREE.Vector3,C=new THREE.Quaternion,L=new THREE.Vector3,O=new THREE.Vector3,H=new THREE.Vector3,F=new THREE.Quaternion,k=new THREE.Vector3;function I(t,e){var r=e;Object.defineProperty(o,t,{get:function(){return void 0!==r?r:e},set:function(e){r!==e&&(r=e,u[t]=e,n[t]=e,o.dispatchEvent({type:t+"-changed",value:e}),o.dispatchEvent(h))}}),o[t]=e,u[t]=e,n[t]=e}function j(e){var t=e.changedTouches?e.changedTouches[0]:e,r=i.getBoundingClientRect();return{x:(t.clientX-r.left)/r.width*2-1,y:-(t.clientY-r.top)/r.height*2+1,button:e.button}}function N(e){e.preventDefault()}function D(e){o.enabled&&o.pointerHover(j(e))}function U(e){o.enabled&&(e.preventDefault(),document.addEventListener("mousemove",V,!1),o.pointerHover(j(e)),o.pointerDown(j(e)))}function V(e){o.enabled&&(e.preventDefault(),o.pointerMove(j(e)))}function B(e){o.enabled&&(e.preventDefault(),document.removeEventListener("mousemove",V,!1),o.pointerUp(j(e)))}I("parentQuaternion",T),I("worldPosition",A),I("worldPositionStart",S),I("worldQuaternion",C),I("worldQuaternionStart",R),I("cameraPosition",r),I("cameraQuaternion",s),I("pointStart",x),I("pointEnd",E),I("rotationAxis",_),I("rotationAngle",w),I("eye",O),i.addEventListener("mousedown",U,!1),i.addEventListener("touchstart",U,!1),i.addEventListener("mousemove",D,!1),i.addEventListener("touchmove",D,!1),i.addEventListener("touchmove",V,!1),document.addEventListener("mouseup",B,!1),i.addEventListener("touchend",B,!1),i.addEventListener("touchcancel",B,!1),i.addEventListener("touchleave",B,!1),i.addEventListener("contextmenu",N,!1),this.dispose=function(){i.removeEventListener("mousedown",U),i.removeEventListener("touchstart",U),i.removeEventListener("mousemove",D),i.removeEventListener("touchmove",D),i.removeEventListener("touchmove",V),document.removeEventListener("mouseup",B),i.removeEventListener("touchend",B),i.removeEventListener("touchcancel",B),i.removeEventListener("touchleave",B),i.removeEventListener("contextmenu",N)},this.attach=function(e){this.object=e,this.visible=!0},this.detach=function(){this.object=void 0,this.visible=!1,this.axis=null},this.updateMatrixWorld=function(){void 0!==this.object&&(this.object.updateMatrixWorld(),this.object.parent.matrixWorld.decompose(c,T,M),this.object.matrixWorld.decompose(A,C,L)),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(r,s,l),this.camera.isPerspectiveCamera?O.copy(r).sub(A).normalize():this.camera.isOrthographicCamera&&O.copy(r).normalize(),THREE.Object3D.prototype.updateMatrixWorld.call(this)},this.pointerHover=function(e){if(void 0!==this.object&&!0!==this.dragging&&(void 0===e.button||0===e.button)){d.setFromCamera(e,this.camera);var t=d.intersectObjects(n.picker[this.mode].children,!0)[0]||!1;this.axis=t?t.object.name:null}},this.pointerDown=function(e){if(!(void 0===this.object||!0===this.dragging||void 0!==e.button&&0!==e.button||0!==e.button&&void 0!==e.button||null===this.axis)){d.setFromCamera(e,this.camera);var t=d.intersectObjects([u],!0)[0]||!1;if(t){var r=this.space;if("scale"===this.mode?r="local":"E"!==this.axis&&"XYZE"!==this.axis&&"XYZ"!==this.axis||(r="world"),"local"===r&&"rotate"===this.mode){var i=this.rotationSnap;"X"===this.axis&&i&&(this.object.rotation.x=Math.round(this.object.rotation.x/i)*i),"Y"===this.axis&&i&&(this.object.rotation.y=Math.round(this.object.rotation.y/i)*i),"Z"===this.axis&&i&&(this.object.rotation.z=Math.round(this.object.rotation.z/i)*i)}this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),H.copy(this.object.position),F.copy(this.object.quaternion),k.copy(this.object.scale),this.object.matrixWorld.decompose(S,R,P),x.copy(t.point).sub(S),"local"===r&&x.applyQuaternion(R.clone().inverse())}this.dragging=!0,a.mode=this.mode,this.dispatchEvent(a)}},this.pointerMove=function(e){var t=this.axis,r=this.mode,i=this.object,n=this.space;if("scale"===r?n="local":"E"!==t&&"XYZE"!==t&&"XYZ"!==t||(n="world"),void 0!==i&&null!==t&&!1!==this.dragging&&(void 0===e.button||0===e.button)){d.setFromCamera(e,this.camera);var o=d.intersectObjects([u],!0)[0]||!1;if(!1!==o){if(E.copy(o.point).sub(S),"local"===n&&E.applyQuaternion(R.clone().inverse()),"translate"===r)-1===t.search("X")&&(E.x=x.x),-1===t.search("Y")&&(E.y=x.y),-1===t.search("Z")&&(E.z=x.z),"local"===n?i.position.copy(E).sub(x).applyQuaternion(F):i.position.copy(E).sub(x),i.position.add(H),this.translationSnap&&("local"===n&&(i.position.applyQuaternion(g.copy(F).inverse()),-1!==t.search("X")&&(i.position.x=Math.round(i.position.x/this.translationSnap)*this.translationSnap),-1!==t.search("Y")&&(i.position.y=Math.round(i.position.y/this.translationSnap)*this.translationSnap),-1!==t.search("Z")&&(i.position.z=Math.round(i.position.z/this.translationSnap)*this.translationSnap),i.position.applyQuaternion(F)),"world"===n&&(i.parent&&i.position.add(f.setFromMatrixPosition(i.parent.matrixWorld)),-1!==t.search("X")&&(i.position.x=Math.round(i.position.x/this.translationSnap)*this.translationSnap),-1!==t.search("Y")&&(i.position.y=Math.round(i.position.y/this.translationSnap)*this.translationSnap),-1!==t.search("Z")&&(i.position.z=Math.round(i.position.z/this.translationSnap)*this.translationSnap),i.parent&&i.position.sub(f.setFromMatrixPosition(i.parent.matrixWorld))));else if("scale"===r){if(-1!==t.search("XYZ")){var a=E.length()/x.length();E.dot(x)<0&&(a*=-1),f.set(a,a,a)}else f.copy(E).divide(x),-1===t.search("X")&&(f.x=1),-1===t.search("Y")&&(f.y=1),-1===t.search("Z")&&(f.z=1);i.scale.copy(k).multiply(f)}else if("rotate"===r){var s=20/A.distanceTo(f.setFromMatrixPosition(this.camera.matrixWorld)),l="local"===this.space?C:y,c=v[t];"E"===t?(f.copy(E).cross(x),_.copy(O),w=E.angleTo(x)*(f.dot(O)<0?1:-1)):"XYZE"===t?(f.copy(E).sub(x).cross(O).normalize(),_.copy(f),w=E.sub(x).dot(f.cross(O))*s):"X"!==t&&"Y"!==t&&"Z"!==t||(b.copy(c).applyQuaternion(l),_.copy(c),f=c.clone(),m=E.clone().sub(x),"local"===n&&(f.applyQuaternion(l),m.applyQuaternion(R)),w=m.dot(f.cross(O).normalize())*s),this.rotationSnap&&(w=Math.round(w/this.rotationSnap)*this.rotationSnap),this.rotationAngle=w,"local"===n?(i.quaternion.copy(F),i.quaternion.multiply(g.setFromAxisAngle(_,w))):(i.quaternion.copy(g.setFromAxisAngle(_,w)),i.quaternion.multiply(F))}this.dispatchEvent(h),this.dispatchEvent(p)}}},this.pointerUp=function(e){void 0!==e.button&&0!==e.button||(this.dragging&&null!==this.axis&&(t.mode=this.mode,this.dispatchEvent(t)),this.dragging=!1,void 0===e.button&&(this.axis=null))},this.getMode=function(){return o.mode},this.setMode=function(e){o.mode=e},this.setTranslationSnap=function(e){o.translationSnap=e},this.setRotationSnap=function(e){o.rotationSnap=e},this.setSize=function(e){o.size=e},this.setSpace=function(e){o.space=e},this.update=function(){console.warn("THREE.TransformControls: update function has been depricated.")}},THREE.TransformControls.prototype=Object.assign(Object.create(THREE.Object3D.prototype),{constructor:THREE.TransformControls,isTransformControls:!0}),THREE.TransformControlsGizmo=function(){"use strict";THREE.Object3D.call(this),this.type="TransformControlsGizmo";var e=new THREE.MeshBasicMaterial({depthTest:!1,depthWrite:!1,transparent:!0,side:THREE.DoubleSide,fog:!1}),t=new THREE.LineBasicMaterial({depthTest:!1,depthWrite:!1,transparent:!0,linewidth:1,fog:!1}),r=e.clone();r.opacity=.15;var i=e.clone();i.opacity=.33;var n=e.clone();n.color.set(16711680);var o=e.clone();o.color.set(65280);var a=e.clone();a.color.set(255);var s=e.clone();s.opacity=.25;var l=s.clone();l.color.set(16776960);var c=s.clone();c.color.set(65535);var u=s.clone();u.color.set(16711935),e.clone().color.set(16776960);var h=t.clone();h.color.set(16711680);var p=t.clone();p.color.set(65280);var d=t.clone();d.color.set(255);var f=t.clone();f.color.set(65535);var m=t.clone();m.color.set(16711935);var g=t.clone();g.color.set(16776960);var v=t.clone();v.color.set(7895160);var y=g.clone();y.opacity=.25;var b=new THREE.CylinderBufferGeometry(0,.05,.2,12,1,!1),x=new THREE.BoxBufferGeometry(.125,.125,.125),E=new THREE.BufferGeometry;E.addAttribute("position",new THREE.Float32BufferAttribute([0,0,0,1,0,0],3));var _,w=function(e,t){for(var r=new THREE.BufferGeometry,i=[],n=0;n<=64*t;++n)i.push(0,Math.cos(n/32*Math.PI)*e,Math.sin(n/32*Math.PI)*e);return r.addAttribute("position",new THREE.Float32BufferAttribute(i,3)),r},T={X:[[new THREE.Mesh(b,n),[1,0,0],[0,0,-Math.PI/2],null,"fwd"],[new THREE.Mesh(b,n),[1,0,0],[0,0,Math.PI/2],null,"bwd"],[new THREE.Line(E,h)]],Y:[[new THREE.Mesh(b,o),[0,1,0],null,null,"fwd"],[new THREE.Mesh(b,o),[0,1,0],[Math.PI,0,0],null,"bwd"],[new THREE.Line(E,p),null,[0,0,Math.PI/2]]],Z:[[new THREE.Mesh(b,a),[0,0,1],[Math.PI/2,0,0],null,"fwd"],[new THREE.Mesh(b,a),[0,0,1],[-Math.PI/2,0,0],null,"bwd"],[new THREE.Line(E,d),null,[0,-Math.PI/2,0]]],XYZ:[[new THREE.Mesh(new THREE.OctahedronBufferGeometry(.1,0),s),[0,0,0],[0,0,0]]],XY:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.295,.295),l),[.15,.15,0]],[new THREE.Line(E,g),[.18,.3,0],null,[.125,1,1]],[new THREE.Line(E,g),[.3,.18,0],[0,0,Math.PI/2],[.125,1,1]]],YZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.295,.295),c),[0,.15,.15],[0,Math.PI/2,0]],[new THREE.Line(E,f),[0,.18,.3],[0,0,Math.PI/2],[.125,1,1]],[new THREE.Line(E,f),[0,.3,.18],[0,-Math.PI/2,0],[.125,1,1]]],XZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.295,.295),u),[.15,0,.15],[-Math.PI/2,0,0]],[new THREE.Line(E,m),[.18,0,.3],null,[.125,1,1]],[new THREE.Line(E,m),[.3,0,.18],[0,-Math.PI/2,0],[.125,1,1]]]},M={X:[[new THREE.Mesh(new THREE.CylinderBufferGeometry(.2,0,1,4,1,!1),r),[.6,0,0],[0,0,-Math.PI/2]]],Y:[[new THREE.Mesh(new THREE.CylinderBufferGeometry(.2,0,1,4,1,!1),r),[0,.6,0]]],Z:[[new THREE.Mesh(new THREE.CylinderBufferGeometry(.2,0,1,4,1,!1),r),[0,0,.6],[Math.PI/2,0,0]]],XYZ:[[new THREE.Mesh(new THREE.OctahedronBufferGeometry(.2,0),r)]],XY:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.4,.4),r),[.2,.2,0]]],YZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.4,.4),r),[0,.2,.2],[0,Math.PI/2,0]]],XZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.4,.4),r),[.2,0,.2],[-Math.PI/2,0,0]]]},S={START:[[new THREE.Mesh(new THREE.OctahedronBufferGeometry(.01,2),i),null,null,null,"helper"]],END:[[new THREE.Mesh(new THREE.OctahedronBufferGeometry(.01,2),i),null,null,null,"helper"]],DELTA:[[new THREE.Line((_=new THREE.BufferGeometry,_.addAttribute("position",new THREE.Float32BufferAttribute([0,0,0,1,1,1],3)),_),i),null,null,null,"helper"]],X:[[new THREE.Line(E,i.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new THREE.Line(E,i.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new THREE.Line(E,i.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},R={X:[[new THREE.Line(w(1,.5),h)],[new THREE.Mesh(new THREE.OctahedronBufferGeometry(.04,0),n),[0,0,.99],null,[1,3,1]]],Y:[[new THREE.Line(w(1,.5),p),null,[0,0,-Math.PI/2]],[new THREE.Mesh(new THREE.OctahedronBufferGeometry(.04,0),o),[0,0,.99],null,[3,1,1]]],Z:[[new THREE.Line(w(1,.5),d),null,[0,Math.PI/2,0]],[new THREE.Mesh(new THREE.OctahedronBufferGeometry(.04,0),a),[.99,0,0],null,[1,3,1]]],E:[[new THREE.Line(w(1.25,1),y),null,[0,Math.PI/2,0]],[new THREE.Mesh(new THREE.CylinderBufferGeometry(.03,0,.15,4,1,!1),y),[1.17,0,0],[0,0,-Math.PI/2],[1,1,.001]],[new THREE.Mesh(new THREE.CylinderBufferGeometry(.03,0,.15,4,1,!1),y),[-1.17,0,0],[0,0,Math.PI/2],[1,1,.001]],[new THREE.Mesh(new THREE.CylinderBufferGeometry(.03,0,.15,4,1,!1),y),[0,-1.17,0],[Math.PI,0,0],[1,1,.001]],[new THREE.Mesh(new THREE.CylinderBufferGeometry(.03,0,.15,4,1,!1),y),[0,1.17,0],[0,0,0],[1,1,.001]]],XYZE:[[new THREE.Line(w(1,1),v),null,[0,Math.PI/2,0]]]},P={AXIS:[[new THREE.Line(E,i.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},A={X:[[new THREE.Mesh(new THREE.TorusBufferGeometry(1,.1,4,24),r),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new THREE.Mesh(new THREE.TorusBufferGeometry(1,.1,4,24),r),[0,0,0],[Math.PI/2,0,0]]],Z:[[new THREE.Mesh(new THREE.TorusBufferGeometry(1,.1,4,24),r),[0,0,0],[0,0,-Math.PI/2]]],E:[[new THREE.Mesh(new THREE.TorusBufferGeometry(1.25,.1,2,24),r)]],XYZE:[[new THREE.Mesh(new THREE.SphereBufferGeometry(.7,10,8),r)]]},C={X:[[new THREE.Mesh(x,n),[.8,0,0],[0,0,-Math.PI/2]],[new THREE.Line(E,h),null,null,[.8,1,1]]],Y:[[new THREE.Mesh(x,o),[0,.8,0]],[new THREE.Line(E,p),null,[0,0,Math.PI/2],[.8,1,1]]],Z:[[new THREE.Mesh(x,a),[0,0,.8],[Math.PI/2,0,0]],[new THREE.Line(E,d),null,[0,-Math.PI/2,0],[.8,1,1]]],XY:[[new THREE.Mesh(x,l),[.85,.85,0],null,[2,2,.2]],[new THREE.Line(E,g),[.855,.98,0],null,[.125,1,1]],[new THREE.Line(E,g),[.98,.855,0],[0,0,Math.PI/2],[.125,1,1]]],YZ:[[new THREE.Mesh(x,c),[0,.85,.85],null,[.2,2,2]],[new THREE.Line(E,f),[0,.855,.98],[0,0,Math.PI/2],[.125,1,1]],[new THREE.Line(E,f),[0,.98,.855],[0,-Math.PI/2,0],[.125,1,1]]],XZ:[[new THREE.Mesh(x,u),[.85,0,.85],null,[2,.2,2]],[new THREE.Line(E,m),[.855,0,.98],null,[.125,1,1]],[new THREE.Line(E,m),[.98,0,.855],[0,-Math.PI/2,0],[.125,1,1]]],XYZX:[[new THREE.Mesh(new THREE.BoxBufferGeometry(.125,.125,.125),s),[1.1,0,0]]],XYZY:[[new THREE.Mesh(new THREE.BoxBufferGeometry(.125,.125,.125),s),[0,1.1,0]]],XYZZ:[[new THREE.Mesh(new THREE.BoxBufferGeometry(.125,.125,.125),s),[0,0,1.1]]]},L={X:[[new THREE.Mesh(new THREE.CylinderBufferGeometry(.2,0,.8,4,1,!1),r),[.5,0,0],[0,0,-Math.PI/2]]],Y:[[new THREE.Mesh(new THREE.CylinderBufferGeometry(.2,0,.8,4,1,!1),r),[0,.5,0]]],Z:[[new THREE.Mesh(new THREE.CylinderBufferGeometry(.2,0,.8,4,1,!1),r),[0,0,.5],[Math.PI/2,0,0]]],XY:[[new THREE.Mesh(x,r),[.85,.85,0],null,[3,3,.2]]],YZ:[[new THREE.Mesh(x,r),[0,.85,.85],null,[.2,3,3]]],XZ:[[new THREE.Mesh(x,r),[.85,0,.85],null,[3,.2,3]]],XYZX:[[new THREE.Mesh(new THREE.BoxBufferGeometry(.2,.2,.2),r),[1.1,0,0]]],XYZY:[[new THREE.Mesh(new THREE.BoxBufferGeometry(.2,.2,.2),r),[0,1.1,0]]],XYZZ:[[new THREE.Mesh(new THREE.BoxBufferGeometry(.2,.2,.2),r),[0,0,1.1]]]},O={X:[[new THREE.Line(E,i.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new THREE.Line(E,i.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new THREE.Line(E,i.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},H=function(e){var t=new THREE.Object3D;for(var r in e)for(var i=e[r].length;i--;){var n=e[r][i][0].clone(),o=e[r][i][1],a=e[r][i][2],s=e[r][i][3],l=e[r][i][4];n.name=r,n.tag=l,o&&n.position.set(o[0],o[1],o[2]),a&&n.rotation.set(a[0],a[1],a[2]),s&&n.scale.set(s[0],s[1],s[2]),n.updateMatrix();var c=n.geometry.clone();c.applyMatrix(n.matrix),n.geometry=c,n.position.set(0,0,0),n.rotation.set(0,0,0),n.scale.set(1,1,1),t.add(n)}return t},F=new THREE.Vector3(0,0,0),k=new THREE.Euler,I=new THREE.Vector3(0,1,0),j=new THREE.Vector3(0,0,0),N=new THREE.Matrix4,D=new THREE.Quaternion,U=new THREE.Quaternion,V=new THREE.Quaternion,B=new THREE.Vector3(1,0,0),z=new THREE.Vector3(0,1,0),q=new THREE.Vector3(0,0,1);this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=H(T)),this.add(this.gizmo.rotate=H(R)),this.add(this.gizmo.scale=H(C)),this.add(this.picker.translate=H(M)),this.add(this.picker.rotate=H(A)),this.add(this.picker.scale=H(L)),this.add(this.helper.translate=H(S)),this.add(this.helper.rotate=H(P)),this.add(this.helper.scale=H(O)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1,this.updateMatrixWorld=function(){var e=this.space;"scale"===this.mode&&(e="local");var t="local"===e?this.worldQuaternion:V;this.gizmo.translate.visible="translate"===this.mode,this.gizmo.rotate.visible="rotate"===this.mode,this.gizmo.scale.visible="scale"===this.mode,this.helper.translate.visible="translate"===this.mode,this.helper.rotate.visible="rotate"===this.mode,this.helper.scale.visible="scale"===this.mode;var r=[];r=(r=(r=r.concat(this.picker[this.mode].children)).concat(this.gizmo[this.mode].children)).concat(this.helper[this.mode].children);for(var i=0;i<r.length;i++){var n=r[i];n.visible=!0,n.rotation.set(0,0,0),n.position.copy(this.worldPosition);var o=this.worldPosition.distanceTo(this.cameraPosition);if(n.scale.set(1,1,1).multiplyScalar(o*this.size/7),"helper"!==n.tag){if(n.quaternion.copy(t),"translate"===this.mode||"scale"===this.mode){"X"!==n.name&&"XYZX"!==n.name||.99<Math.abs(I.copy(B).applyQuaternion(t).dot(this.eye))&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),"Y"!==n.name&&"XYZY"!==n.name||.99<Math.abs(I.copy(z).applyQuaternion(t).dot(this.eye))&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),"Z"!==n.name&&"XYZZ"!==n.name||.99<Math.abs(I.copy(q).applyQuaternion(t).dot(this.eye))&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),"XY"===n.name&&Math.abs(I.copy(q).applyQuaternion(t).dot(this.eye))<.2&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),"YZ"===n.name&&Math.abs(I.copy(B).applyQuaternion(t).dot(this.eye))<.2&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),"XZ"===n.name&&Math.abs(I.copy(z).applyQuaternion(t).dot(this.eye))<.2&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),-1!==n.name.search("X")&&(I.copy(B).applyQuaternion(t).dot(this.eye)<-.4?"fwd"===n.tag?n.visible=!1:n.scale.x*=-1:"bwd"===n.tag&&(n.visible=!1)),-1!==n.name.search("Y")&&(I.copy(z).applyQuaternion(t).dot(this.eye)<-.4?"fwd"===n.tag?n.visible=!1:n.scale.y*=-1:"bwd"===n.tag&&(n.visible=!1)),-1!==n.name.search("Z")&&(I.copy(q).applyQuaternion(t).dot(this.eye)<-.4?"fwd"===n.tag?n.visible=!1:n.scale.z*=-1:"bwd"===n.tag&&(n.visible=!1))}else"rotate"===this.mode&&(U.copy(t),I.copy(this.eye).applyQuaternion(D.copy(t).inverse()),-1!==n.name.search("E")&&n.quaternion.setFromRotationMatrix(N.lookAt(this.eye,j,z)),"X"===n.name&&(D.setFromAxisAngle(B,Math.atan2(-I.y,I.z)),D.multiplyQuaternions(U,D),n.quaternion.copy(D)),"Y"===n.name&&(D.setFromAxisAngle(z,Math.atan2(I.x,I.z)),D.multiplyQuaternions(U,D),n.quaternion.copy(D)),"Z"===n.name&&(D.setFromAxisAngle(q,Math.atan2(I.y,I.x)),D.multiplyQuaternions(U,D),n.quaternion.copy(D)));n.visible=n.visible&&(-1===n.name.indexOf("X")||this.showX),n.visible=n.visible&&(-1===n.name.indexOf("Y")||this.showY),n.visible=n.visible&&(-1===n.name.indexOf("Z")||this.showZ),n.visible=n.visible&&(-1===n.name.indexOf("E")||this.showX&&this.showY&&this.showZ),n.material._opacity=n.material._opacity||n.material.opacity,n.material._color=n.material._color||n.material.color.clone(),n.material.color.copy(n.material._color),n.material.opacity=n.material._opacity,this.enabled?this.axis&&(n.name===this.axis?n.material.opacity=1:this.axis.split("").some(function(e){return n.name===e})?n.material.opacity=1:n.material.opacity*=.25,n.material.color.lerp(new THREE.Color(1,1,1),.5)):(n.material.opacity*=.5,n.material.color.lerp(new THREE.Color(1,1,1),.5))}else n.visible=!1,"AXIS"===n.name?(n.position.copy(this.worldPositionStart),n.visible=!!this.axis,"X"===this.axis&&(D.setFromEuler(k.set(0,0,0)),n.quaternion.copy(t).multiply(D),.9<Math.abs(I.copy(B).applyQuaternion(t).dot(this.eye))&&(n.visible=!1)),"Y"===this.axis&&(D.setFromEuler(k.set(0,0,Math.PI/2)),n.quaternion.copy(t).multiply(D),.9<Math.abs(I.copy(z).applyQuaternion(t).dot(this.eye))&&(n.visible=!1)),"Z"===this.axis&&(D.setFromEuler(k.set(0,Math.PI/2,0)),n.quaternion.copy(t).multiply(D),.9<Math.abs(I.copy(q).applyQuaternion(t).dot(this.eye))&&(n.visible=!1)),"XYZE"===this.axis&&(D.setFromEuler(k.set(0,Math.PI/2,0)),I.copy(this.rotationAxis),n.quaternion.setFromRotationMatrix(N.lookAt(j,I,z)),n.quaternion.multiply(D),n.visible=this.dragging),"E"===this.axis&&(n.visible=!1)):"START"===n.name?(n.position.copy(this.worldPositionStart),n.visible=this.dragging):"END"===n.name?(n.position.copy(this.worldPosition),n.visible=this.dragging):"DELTA"===n.name?(n.position.copy(this.worldPositionStart),n.quaternion.copy(this.worldQuaternionStart),F.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),F.applyQuaternion(this.worldQuaternionStart.clone().inverse()),n.scale.copy(F),n.visible=this.dragging):(n.quaternion.copy(t),this.dragging?n.position.copy(this.worldPositionStart):n.position.copy(this.worldPosition),this.axis&&(n.visible=-1!==this.axis.search(n.name)))}THREE.Object3D.prototype.updateMatrixWorld.call(this)}},THREE.TransformControlsGizmo.prototype=Object.assign(Object.create(THREE.Object3D.prototype),{constructor:THREE.TransformControlsGizmo,isTransformControlsGizmo:!0}),THREE.TransformControlsPlane=function(){"use strict";THREE.Mesh.call(this,new THREE.PlaneBufferGeometry(1e5,1e5,2,2),new THREE.MeshBasicMaterial({visible:!1,wireframe:!0,side:THREE.DoubleSide,transparent:!0,opacity:.1})),this.type="TransformControlsPlane";var t=new THREE.Vector3(1,0,0),r=new THREE.Vector3(0,1,0),i=new THREE.Vector3(0,0,1),n=new THREE.Vector3,o=new THREE.Vector3,a=new THREE.Vector3,s=new THREE.Matrix4,l=new THREE.Quaternion;this.updateMatrixWorld=function(){var e=this.space;switch(this.position.copy(this.worldPosition),"scale"===this.mode&&(e="local"),t.set(1,0,0).applyQuaternion("local"===e?this.worldQuaternion:l),r.set(0,1,0).applyQuaternion("local"===e?this.worldQuaternion:l),i.set(0,0,1).applyQuaternion("local"===e?this.worldQuaternion:l),a.copy(r),this.mode){case"translate":case"scale":switch(this.axis){case"X":a.copy(this.eye).cross(t),o.copy(t).cross(a);break;case"Y":a.copy(this.eye).cross(r),o.copy(r).cross(a);break;case"Z":a.copy(this.eye).cross(i),o.copy(i).cross(a);break;case"XY":o.copy(i);break;case"YZ":o.copy(t);break;case"XZ":a.copy(i),o.copy(r);break;case"XYZ":case"E":o.set(0,0,0)}break;case"rotate":default:o.set(0,0,0)}0===o.length()?this.quaternion.copy(this.cameraQuaternion):(s.lookAt(n.set(0,0,0),o,a),this.quaternion.setFromRotationMatrix(s)),THREE.Object3D.prototype.updateMatrixWorld.call(this)}},THREE.TransformControlsPlane.prototype=Object.assign(Object.create(THREE.Mesh.prototype),{constructor:THREE.TransformControlsPlane,isTransformControlsPlane:!0}),THREE.Water=function(e,t){THREE.Mesh.call(this,e),this.type="Water";var a=this,r=void 0!==(t=t||{}).color?new THREE.Color(t.color):new THREE.Color(16777215),i=t.textureWidth||512,n=t.textureHeight||512,o=t.clipBias||0,s=t.flowDirection||new THREE.Vector2(1,0),l=t.flowSpeed||.03,c=t.reflectivity||.02,u=t.scale||1,h=t.shader||THREE.Water.WaterShader,p=new THREE.TextureLoader,d=t.flowMap||void 0,f=t.normalMap0||p.load("textures/water/Water_1_M_Normal.jpg"),m=t.normalMap1||p.load("textures/water/Water_2_M_Normal.jpg"),g=.15,v=.5*g,y=new THREE.Matrix4,b=new THREE.Clock;if(void 0!==THREE.Reflector)if(void 0!==THREE.Refractor){var x=new THREE.Reflector(e,{textureWidth:i,textureHeight:n,clipBias:o}),E=new THREE.Refractor(e,{textureWidth:i,textureHeight:n,clipBias:o});x.matrixAutoUpdate=!1,E.matrixAutoUpdate=!1,this.material=new THREE.ShaderMaterial({uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.fog,h.uniforms]),vertexShader:h.vertexShader,fragmentShader:h.fragmentShader,transparent:!0,fog:!0}),void 0!==d?(this.material.defines.USE_FLOWMAP="",this.material.uniforms.tFlowMap={type:"t",value:d}):this.material.uniforms.flowDirection={type:"v2",value:s},f.wrapS=f.wrapT=THREE.RepeatWrapping,m.wrapS=m.wrapT=THREE.RepeatWrapping,this.material.uniforms.tReflectionMap.value=x.getRenderTarget().texture,this.material.uniforms.tRefractionMap.value=E.getRenderTarget().texture,this.material.uniforms.tNormalMap0.value=f,this.material.uniforms.tNormalMap1.value=m,this.material.uniforms.color.value=r,this.material.uniforms.reflectivity.value=c,this.material.uniforms.textureMatrix.value=y,this.material.uniforms.config.value.x=0,this.material.uniforms.config.value.y=v,this.material.uniforms.config.value.z=v,this.material.uniforms.config.value.w=u,this.addBeforeRenderFunction("THREE.Water",function(e,t,r){var i,n,o;i=r,y.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),y.multiply(i.projectionMatrix),y.multiply(i.matrixWorldInverse),y.multiply(a.matrixWorld),n=b.getDelta(),(o=a.material.uniforms.config).value.x+=l*n,o.value.y=o.value.x+v,o.value.x>=g?(o.value.x=0,o.value.y=v):o.value.y>=g&&(o.value.y=o.value.y-g),a.visible=!1,x.matrixWorld.copy(a.matrixWorld),E.matrixWorld.copy(a.matrixWorld),x.onBeforeRender(e,t,r),E.onBeforeRender(e,t,r),a.visible=!0})}else console.error("THREE.Water: Required component THREE.Refractor not found.");else console.error("THREE.Water: Required component THREE.Reflector not found.")},THREE.Water.prototype=Object.create(THREE.Mesh.prototype),THREE.Water.prototype.constructor=THREE.Water,THREE.Water.WaterShader={uniforms:{color:{type:"c",value:null},reflectivity:{type:"f",value:0},tReflectionMap:{type:"t",value:null},tRefractionMap:{type:"t",value:null},tNormalMap0:{type:"t",value:null},tNormalMap1:{type:"t",value:null},textureMatrix:{type:"m4",value:null},config:{type:"v4",value:new THREE.Vector4}},vertexShader:["#include <fog_pars_vertex>","uniform mat4 textureMatrix;","varying vec4 vCoord;","varying vec2 vUv;","varying vec3 vToEye;","void main() {","\tvUv = uv;","\tvCoord = textureMatrix * vec4( position, 1.0 );","\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );","\tvToEye = cameraPosition - worldPosition.xyz;","\tvec4 mvPosition =  viewMatrix * worldPosition;","\tgl_Position = projectionMatrix * mvPosition;","\t#include <fog_vertex>","}"].join("\n"),fragmentShader:["#include <fog_pars_fragment>","uniform sampler2D tReflectionMap;","uniform sampler2D tRefractionMap;","uniform sampler2D tNormalMap0;","uniform sampler2D tNormalMap1;","#ifdef USE_FLOWMAP","\tuniform sampler2D tFlowMap;","#else","\tuniform vec2 flowDirection;","#endif","uniform vec3 color;","uniform float reflectivity;","uniform vec4 config;","varying vec4 vCoord;","varying vec2 vUv;","varying vec3 vToEye;","void main() {","\tfloat flowMapOffset0 = config.x;","\tfloat flowMapOffset1 = config.y;","\tfloat halfCycle = config.z;","\tfloat scale = config.w;","\tvec3 toEye = normalize( vToEye );","\tvec2 flow;","\t#ifdef USE_FLOWMAP","\t\tflow = texture2D( tFlowMap, vUv ).rg * 2.0 - 1.0;","\t#else","\t\tflow = flowDirection;","\t#endif","\tflow.x *= - 1.0;","\tvec4 normalColor0 = texture2D( tNormalMap0, ( vUv * scale ) + flow * flowMapOffset0 );","\tvec4 normalColor1 = texture2D( tNormalMap1, ( vUv * scale ) + flow * flowMapOffset1 );","\tfloat flowLerp = abs( halfCycle - flowMapOffset0 ) / halfCycle;","\tvec4 normalColor = mix( normalColor0, normalColor1, flowLerp );","\tvec3 normal = normalize( vec3( normalColor.r * 2.0 - 1.0, normalColor.b,  normalColor.g * 2.0 - 1.0 ) );","\tfloat theta = max( dot( toEye, normal ), 0.0 );","\tfloat reflectance = reflectivity + ( 1.0 - reflectivity ) * pow( ( 1.0 - theta ), 5.0 );","\tvec3 coord = vCoord.xyz / vCoord.w;","\tvec2 uv = coord.xy + coord.z * normal.xz * 0.05;","\tvec4 reflectColor = texture2D( tReflectionMap, vec2( 1.0 - uv.x, uv.y ) );","\tvec4 refractColor = texture2D( tRefractionMap, uv );","\tgl_FragColor = vec4( color, 1.0 ) * mix( refractColor, reflectColor, reflectance );","\t#include <tonemapping_fragment>","\t#include <encodings_fragment>","\t#include <fog_fragment>","}"].join("\n")},function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.combine={})}(this,function(e){"use strict";var t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function r(e,t){return e(t={exports:{}},t.exports),t.exports}var qe=r(function(e){var t=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=t)}),m=r(function(e){var t=e.exports={version:"2.6.5"};"number"==typeof __e&&(__e=t)}),Ge=function(e){return"object"==typeof e?null!==e:"function"==typeof e},T=function(e){if(!Ge(e))throw TypeError(e+" is not an object!");return e},We=function(e){try{return!!e()}catch(e){return!0}},Xe=!We(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}),i=qe.document,n=Ge(i)&&Ge(i.createElement),o=function(e){return n?i.createElement(e):{}},a=!Xe&&!We(function(){return 7!=Object.defineProperty(o("div"),"a",{get:function(){return 7}}).a}),Ye=function(e,t){if(!Ge(e))return e;var r,i;if(t&&"function"==typeof(r=e.toString)&&!Ge(i=r.call(e)))return i;if("function"==typeof(r=e.valueOf)&&!Ge(i=r.call(e)))return i;if(!t&&"function"==typeof(r=e.toString)&&!Ge(i=r.call(e)))return i;throw TypeError("Can't convert object to primitive value")},s=Object.defineProperty,Qe={f:Xe?Object.defineProperty:function(e,t,r){if(T(e),t=Ye(t,!0),T(r),a)try{return s(e,t,r)}catch(e){}if("get"in r||"set"in r)throw TypeError("Accessors not supported!");return"value"in r&&(e[t]=r.value),e}},Je=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},Ze=Xe?function(e,t,r){return Qe.f(e,t,Je(1,r))}:function(e,t,r){return e[t]=r,e},l={}.hasOwnProperty,Ke=function(e,t){return l.call(e,t)},c=0,u=Math.random(),$e=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++c+u).toString(36))},h=r(function(e){var t="__core-js_shared__",r=qe[t]||(qe[t]={});(e.exports=function(e,t){return r[e]||(r[e]=void 0!==t?t:{})})("versions",[]).push({version:m.version,mode:"global",copyright:" 2019 Denis Pushkarev (zloirock.ru)"})}),p=h("native-function-to-string",Function.toString),_=r(function(e){var o=$e("src"),a=(""+p).split("toString");m.inspectSource=function(e){return p.call(e)},(e.exports=function(e,t,r,i){var n="function"==typeof r;n&&(Ke(r,"name")||Ze(r,"name",t)),e[t]!==r&&(n&&(Ke(r,o)||Ze(r,o,e[t]?""+e[t]:a.join(String(t)))),e===qe?e[t]=r:i?e[t]?e[t]=r:Ze(e,t,r):(delete e[t],Ze(e,t,r)))})(Function.prototype,"toString",function(){return"function"==typeof this&&this[o]||p.call(this)})}),d=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e},et=function(i,n,e){if(d(i),void 0===n)return i;switch(e){case 1:return function(e){return i.call(n,e)};case 2:return function(e,t){return i.call(n,e,t)};case 3:return function(e,t,r){return i.call(n,e,t,r)}}return function(){return i.apply(n,arguments)}},g="prototype",v=function(e,t,r){var i,n,o,a,s=e&v.F,l=e&v.G,c=e&v.S,u=e&v.P,h=e&v.B,p=l?qe:c?qe[t]||(qe[t]={}):(qe[t]||{})[g],d=l?m:m[t]||(m[t]={}),f=d[g]||(d[g]={});for(i in l&&(r=t),r)o=((n=!s&&p&&void 0!==p[i])?p:r)[i],a=h&&n?et(o,qe):u&&"function"==typeof o?et(Function.call,o):o,p&&_(p,i,o,e&v.U),d[i]!=o&&Ze(d,i,a),u&&f[i]!=o&&(f[i]=o)};qe.core=m,v.F=1,v.G=2,v.S=4,v.P=8,v.B=16,v.W=32,v.U=64,v.R=128;for(var f,tt=v,y=$e("typed_array"),b=$e("view"),x=!(!qe.ArrayBuffer||!qe.DataView),E=x,w=0,M="Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array".split(",");w<9;)(f=qe[M[w++]])?(Ze(f.prototype,y,!0),Ze(f.prototype,b,!0)):E=!1;var rt={ABV:x,CONSTR:E,TYPED:y,VIEW:b},it=function(e,t,r){for(var i in t)_(e,i,t[i],r);return e},nt=function(e,t,r,i){if(!(e instanceof t)||void 0!==i&&i in e)throw TypeError(r+": incorrect invocation!");return e},S=Math.ceil,R=Math.floor,ot=function(e){return isNaN(e=+e)?0:(0<e?R:S)(e)},P=Math.min,at=function(e){return 0<e?P(ot(e),9007199254740991):0},st=function(e){if(void 0===e)return 0;var t=ot(e),r=at(t);if(t!==r)throw RangeError("Wrong length!");return r},A={}.toString,C=function(e){return A.call(e).slice(8,-1)},L=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==C(e)?e.split(""):Object(e)},O=function(e){if(null==e)throw TypeError("Can't call method on  "+e);return e},H=function(e){return L(O(e))},F=Math.max,k=Math.min,lt=function(e,t){return(e=ot(e))<0?F(e+t,0):k(e,t)},ct=function(s){return function(e,t,r){var i,n=H(e),o=at(n.length),a=lt(r,o);if(s&&t!=t){for(;a<o;)if((i=n[a++])!=i)return!0}else for(;a<o;a++)if((s||a in n)&&n[a]===t)return s||a||0;return!s&&-1}},I=h("keys"),j=function(e){return I[e]||(I[e]=$e(e))},N=ct(!1),D=j("IE_PROTO"),U=function(e,t){var r,i=H(e),n=0,o=[];for(r in i)r!=D&&Ke(i,r)&&o.push(r);for(;t.length>n;)Ke(i,r=t[n++])&&(~N(o,r)||o.push(r));return o},V="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(","),B=V.concat("length","prototype"),ut={f:Object.getOwnPropertyNames||function(e){return U(e,B)}},ht=function(e){return Object(O(e))},pt=function(e){for(var t=ht(this),r=at(t.length),i=arguments.length,n=lt(1<i?arguments[1]:void 0,r),o=2<i?arguments[2]:void 0,a=void 0===o?r:lt(o,r);n<a;)t[n++]=e;return t},dt=r(function(e){var t=h("wks"),r=qe.Symbol,i="function"==typeof r;(e.exports=function(e){return t[e]||(t[e]=i&&r[e]||(i?r:$e)("Symbol."+e))}).store=t}),z=Qe.f,q=dt("toStringTag"),G=function(e,t,r){e&&!Ke(e=r?e:e.prototype,q)&&z(e,q,{configurable:!0,value:t})},ft=r(function(e,t){var r=ut.f,i=Qe.f,n="ArrayBuffer",o="DataView",a="prototype",h="Wrong index!",s=qe[n],l=qe[o],c=qe.Math,p=qe.RangeError,d=qe.Infinity,u=s,f=c.abs,m=c.pow,g=c.floor,v=c.log,y=c.LN2,b="byteLength",x="byteOffset",E=Xe?"_b":"buffer",_=Xe?"_l":b,w=Xe?"_o":x;function T(e,t,r){var i,n,o,a=new Array(r),s=8*r-t-1,l=(1<<s)-1,c=l>>1,u=23===t?m(2,-24)-m(2,-77):0,h=0,p=e<0||0===e&&1/e<0?1:0;for((e=f(e))!=e||e===d?(n=e!=e?1:0,i=l):(i=g(v(e)/y),e*(o=m(2,-i))<1&&(i--,o*=2),2<=(e+=1<=i+c?u/o:u*m(2,1-c))*o&&(i++,o/=2),l<=i+c?(n=0,i=l):1<=i+c?(n=(e*o-1)*m(2,t),i+=c):(n=e*m(2,c-1)*m(2,t),i=0));8<=t;a[h++]=255&n,n/=256,t-=8);for(i=i<<t|n,s+=t;0<s;a[h++]=255&i,i/=256,s-=8);return a[--h]|=128*p,a}function M(e,t,r){var i,n=8*r-t-1,o=(1<<n)-1,a=o>>1,s=n-7,l=r-1,c=e[l--],u=127&c;for(c>>=7;0<s;u=256*u+e[l],l--,s-=8);for(i=u&(1<<-s)-1,u>>=-s,s+=t;0<s;i=256*i+e[l],l--,s-=8);if(0===u)u=1-a;else{if(u===o)return i?NaN:c?-d:d;i+=m(2,t),u-=a}return(c?-1:1)*i*m(2,u-t)}function S(e){return e[3]<<24|e[2]<<16|e[1]<<8|e[0]}function R(e){return[255&e]}function P(e){return[255&e,e>>8&255]}function A(e){return[255&e,e>>8&255,e>>16&255,e>>24&255]}function C(e){return T(e,52,8)}function L(e){return T(e,23,4)}function O(e,t,r){i(e[a],t,{get:function(){return this[r]}})}function H(e,t,r,i){var n=st(+r);if(n+t>e[_])throw p(h);var o=e[E]._b,a=n+e[w],s=o.slice(a,a+t);return i?s:s.reverse()}function F(e,t,r,i,n,o){var a=st(+r);if(a+t>e[_])throw p(h);for(var s=e[E]._b,l=a+e[w],c=i(+n),u=0;u<t;u++)s[l+u]=c[o?u:t-u-1]}if(rt.ABV){if(!We(function(){s(1)})||!We(function(){new s(-1)})||We(function(){return new s,new s(1.5),new s(NaN),s.name!=n})){for(var k,I=(s=function(e){return nt(this,s),new u(st(e))})[a]=u[a],j=r(u),N=0;j.length>N;)(k=j[N++])in s||Ze(s,k,u[k]);I.constructor=s}var D=new l(new s(2)),U=l[a].setInt8;D.setInt8(0,2147483648),D.setInt8(1,2147483649),!D.getInt8(0)&&D.getInt8(1)||it(l[a],{setInt8:function(e,t){U.call(this,e,t<<24>>24)},setUint8:function(e,t){U.call(this,e,t<<24>>24)}},!0)}else s=function(e){nt(this,s,n);var t=st(e);this._b=pt.call(new Array(t),0),this[_]=t},l=function(e,t,r){nt(this,l,o),nt(e,s,o);var i=e[_],n=ot(t);if(n<0||i<n)throw p("Wrong offset!");if(i<n+(r=void 0===r?i-n:at(r)))throw p("Wrong length!");this[E]=e,this[w]=n,this[_]=r},Xe&&(O(s,b,"_l"),O(l,"buffer","_b"),O(l,b,"_l"),O(l,x,"_o")),it(l[a],{getInt8:function(e){return H(this,1,e)[0]<<24>>24},getUint8:function(e){return H(this,1,e)[0]},getInt16:function(e){var t=H(this,2,e,arguments[1]);return(t[1]<<8|t[0])<<16>>16},getUint16:function(e){var t=H(this,2,e,arguments[1]);return t[1]<<8|t[0]},getInt32:function(e){return S(H(this,4,e,arguments[1]))},getUint32:function(e){return S(H(this,4,e,arguments[1]))>>>0},getFloat32:function(e){return M(H(this,4,e,arguments[1]),23,4)},getFloat64:function(e){return M(H(this,8,e,arguments[1]),52,8)},setInt8:function(e,t){F(this,1,e,R,t)},setUint8:function(e,t){F(this,1,e,R,t)},setInt16:function(e,t){F(this,2,e,P,t,arguments[2])},setUint16:function(e,t){F(this,2,e,P,t,arguments[2])},setInt32:function(e,t){F(this,4,e,A,t,arguments[2])},setUint32:function(e,t){F(this,4,e,A,t,arguments[2])},setFloat32:function(e,t){F(this,4,e,L,t,arguments[2])},setFloat64:function(e,t){F(this,8,e,C,t,arguments[2])}});G(s,n),G(l,o),Ze(l[a],rt.VIEW,!0),t[n]=s,t[o]=l}),W=dt("species"),mt=function(e,t){var r,i=T(e).constructor;return void 0===i||null==(r=T(i)[W])?t:d(r)},X=dt("species"),gt=function(e){var t=qe[e];Xe&&t&&!t[X]&&Qe.f(t,X,{configurable:!0,get:function(){return this}})},Y=qe.ArrayBuffer,Q=ft.ArrayBuffer,J=ft.DataView,Z=rt.ABV&&Y.isView,K=Q.prototype.slice,$=rt.VIEW,ee="ArrayBuffer";tt(tt.G+tt.W+tt.F*(Y!==Q),{ArrayBuffer:Q}),tt(tt.S+tt.F*!rt.CONSTR,ee,{isView:function(e){return Z&&Z(e)||Ge(e)&&$ in e}}),tt(tt.P+tt.U+tt.F*We(function(){return!new Q(2).slice(1,void 0).byteLength}),ee,{slice:function(e,t){if(void 0!==K&&void 0===t)return K.call(T(this),e);for(var r=T(this).byteLength,i=lt(e,r),n=lt(void 0===t?r:t,r),o=new(mt(this,Q))(at(n-i)),a=new J(this),s=new J(o),l=0;i<n;)s.setUint8(l++,a.getUint8(i++));return o}}),gt(ee);var te=dt("toStringTag"),re="Arguments"==C(function(){return arguments}()),vt=function(e){var t,r,i;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(r=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),te))?r:re?C(t):"Object"==(i=C(t))&&"function"==typeof t.callee?"Arguments":i},yt={},ie=dt("iterator"),ne=Array.prototype,bt=function(e){return void 0!==e&&(yt.Array===e||ne[ie]===e)},oe=Object.keys||function(e){return U(e,V)},ae=Xe?Object.defineProperties:function(e,t){T(e);for(var r,i=oe(t),n=i.length,o=0;o<n;)Qe.f(e,r=i[o++],t[r]);return e},se=qe.document,le=se&&se.documentElement,ce=j("IE_PROTO"),ue=function(){},he="prototype",pe=function(){var e,t=o("iframe"),r=V.length;for(t.style.display="none",le.appendChild(t),t.src="javascript:",(e=t.contentWindow.document).open(),e.write("<script>document.F=Object<\/script>"),e.close(),pe=e.F;r--;)delete pe[he][V[r]];return pe()},xt=Object.create||function(e,t){var r;return null!==e?(ue[he]=T(e),r=new ue,ue[he]=null,r[ce]=e):r=pe(),void 0===t?r:ae(r,t)},de=j("IE_PROTO"),fe=Object.prototype,Et=Object.getPrototypeOf||function(e){return e=ht(e),Ke(e,de)?e[de]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?fe:null},me=dt("iterator"),_t=m.getIteratorMethod=function(e){if(null!=e)return e[me]||e["@@iterator"]||yt[vt(e)]},ge=Array.isArray||function(e){return"Array"==C(e)},ve=dt("species"),ye=function(e,t){return ge(r=e)&&("function"!=typeof(i=r.constructor)||i!==Array&&!ge(i.prototype)||(i=void 0),Ge(i)&&null===(i=i[ve])&&(i=void 0)),new(void 0===i?Array:i)(t);var r,i},wt=function(h,e){var p=1==h,d=2==h,f=3==h,m=4==h,g=6==h,v=5==h||g,y=e||ye;return function(e,t,r){for(var i,n,o=ht(e),a=L(o),s=et(t,r,3),l=at(a.length),c=0,u=p?y(e,l):d?y(e,0):void 0;c<l;c++)if((v||c in a)&&(n=s(i=a[c],c,o),h))if(p)u[c]=n;else if(n)switch(h){case 3:return!0;case 5:return i;case 6:return c;case 2:u.push(i)}else if(m)return!1;return g?-1:f||m?m:u}},be=dt("unscopables"),xe=Array.prototype;null==xe[be]&&Ze(xe,be,{});var Ee=function(e){xe[be][e]=!0},_e=function(e,t){return{value:t,done:!!e}},we={};Ze(we,dt("iterator"),function(){return this});var Te=dt("iterator"),Me=!([].keys&&"next"in[].keys()),Se="values",Re=function(){return this},Pe=function(e,t,r,i,n,o,a){var s,l,c;l=t,c=i,(s=r).prototype=xt(we,{next:Je(1,c)}),G(s,l+" Iterator");var u,h,p,d=function(e){if(!Me&&e in v)return v[e];switch(e){case"keys":case Se:return function(){return new r(this,e)}}return function(){return new r(this,e)}},f=t+" Iterator",m=n==Se,g=!1,v=e.prototype,y=v[Te]||v["@@iterator"]||n&&v[n],b=y||d(n),x=n?m?d("entries"):b:void 0,E="Array"==t&&v.entries||y;if(E&&(p=Et(E.call(new e)))!==Object.prototype&&p.next&&(G(p,f,!0),"function"!=typeof p[Te]&&Ze(p,Te,Re)),m&&y&&y.name!==Se&&(g=!0,b=function(){return y.call(this)}),(Me||g||!v[Te])&&Ze(v,Te,b),yt[t]=b,yt[f]=Re,n)if(u={values:m?b:d(Se),keys:o?b:d("keys"),entries:x},a)for(h in u)h in v||_(v,h,u[h]);else tt(tt.P+tt.F*(Me||g),t,u);return u},Tt=Pe(Array,"Array",function(e,t){this._t=H(e),this._i=0,this._k=t},function(){var e=this._t,t=this._k,r=this._i++;return!e||r>=e.length?(this._t=void 0,_e(1)):_e(0,"keys"==t?r:"values"==t?e[r]:[r,e[r]])},"values");yt.Arguments=yt.Array,Ee("keys"),Ee("values"),Ee("entries");var Ae=dt("iterator"),Ce=!1;try{var Le=[7][Ae]();Le.return=function(){Ce=!0},Array.from(Le,function(){throw 2})}catch(e){}var Mt=function(e,t){if(!t&&!Ce)return!1;var r=!1;try{var i=[7],n=i[Ae]();n.next=function(){return{done:r=!0}},i[Ae]=function(){return n},e(i)}catch(e){}return r},St=[].copyWithin||function(e,t){var r=ht(this),i=at(r.length),n=lt(e,i),o=lt(t,i),a=2<arguments.length?arguments[2]:void 0,s=Math.min((void 0===a?i:lt(a,i))-o,i-n),l=1;for(o<n&&n<o+s&&(l=-1,o+=s-1,n+=s-1);0<s--;)o in r?r[n]=r[o]:delete r[n],n+=l,o+=l;return r},Oe={f:{}.propertyIsEnumerable},He=Object.getOwnPropertyDescriptor,Rt={f:Xe?He:function(e,t){if(e=H(e),t=Ye(t,!0),a)try{return He(e,t)}catch(e){}if(Ke(e,t))return Je(!Oe.f.call(e,t),e[t])}},Fe=r(function(e){if(Xe){var v=qe,y=We,b=tt,x=rt,t=ft,p=et,E=nt,r=Je,_=Ze,i=it,n=ot,w=at,T=st,o=lt,a=Ye,s=Ke,M=vt,S=Ge,d=ht,f=bt,R=xt,P=Et,A=ut.f,m=_t,l=$e,c=dt,u=wt,h=ct,g=mt,C=Tt,L=yt,O=Mt,H=gt,F=pt,k=St,I=Qe,j=Rt,N=I.f,D=j.f,U=v.RangeError,V=v.TypeError,B=v.Uint8Array,z="ArrayBuffer",q="Shared"+z,G="BYTES_PER_ELEMENT",W="prototype",X=Array[W],Y=t.ArrayBuffer,Q=t.DataView,J=u(0),Z=u(2),K=u(3),$=u(4),ee=u(5),te=u(6),re=h(!0),ie=h(!1),ne=C.values,oe=C.keys,ae=C.entries,se=X.lastIndexOf,le=X.reduce,ce=X.reduceRight,ue=X.join,he=X.sort,pe=X.slice,de=X.toString,fe=X.toLocaleString,me=c("iterator"),ge=c("toStringTag"),ve=l("typed_constructor"),ye=l("def_constructor"),be=x.CONSTR,xe=x.TYPED,Ee=x.VIEW,_e="Wrong length!",we=u(1,function(e,t){return Pe(g(e,e[ye]),t)}),Te=y(function(){return 1===new B(new Uint16Array([1]).buffer)[0]}),Me=!!B&&!!B[W].set&&y(function(){new B(1).set({})}),Se=function(e,t){var r=n(e);if(r<0||r%t)throw U("Wrong offset!");return r},Re=function(e){if(S(e)&&xe in e)return e;throw V(e+" is not a typed array!")},Pe=function(e,t){if(!(S(e)&&ve in e))throw V("It is not a typed array constructor!");return new e(t)},Ae=function(e,t){return Ce(g(e,e[ye]),t)},Ce=function(e,t){for(var r=0,i=t.length,n=Pe(e,i);r<i;)n[r]=t[r++];return n},Le=function(e,t,r){N(e,t,{get:function(){return this._d[r]}})},Oe=function(e){var t,r,i,n,o,a,s=d(e),l=arguments.length,c=1<l?arguments[1]:void 0,u=void 0!==c,h=m(s);if(null!=h&&!f(h)){for(a=h.call(s),i=[],t=0;!(o=a.next()).done;t++)i.push(o.value);s=i}for(u&&2<l&&(c=p(c,arguments[2],2)),t=0,r=w(s.length),n=Pe(this,r);t<r;t++)n[t]=u?c(s[t],t):s[t];return n},He=function(){for(var e=0,t=arguments.length,r=Pe(this,t);e<t;)r[e]=arguments[e++];return r},Fe=!!B&&y(function(){fe.call(new B(1))}),ke=function(){return fe.apply(Fe?pe.call(Re(this)):Re(this),arguments)},Ie={copyWithin:function(e,t){return k.call(Re(this),e,t,2<arguments.length?arguments[2]:void 0)},every:function(e){return $(Re(this),e,1<arguments.length?arguments[1]:void 0)},fill:function(e){return F.apply(Re(this),arguments)},filter:function(e){return Ae(this,Z(Re(this),e,1<arguments.length?arguments[1]:void 0))},find:function(e){return ee(Re(this),e,1<arguments.length?arguments[1]:void 0)},findIndex:function(e){return te(Re(this),e,1<arguments.length?arguments[1]:void 0)},forEach:function(e){J(Re(this),e,1<arguments.length?arguments[1]:void 0)},indexOf:function(e){return ie(Re(this),e,1<arguments.length?arguments[1]:void 0)},includes:function(e){return re(Re(this),e,1<arguments.length?arguments[1]:void 0)},join:function(e){return ue.apply(Re(this),arguments)},lastIndexOf:function(e){return se.apply(Re(this),arguments)},map:function(e){return we(Re(this),e,1<arguments.length?arguments[1]:void 0)},reduce:function(e){return le.apply(Re(this),arguments)},reduceRight:function(e){return ce.apply(Re(this),arguments)},reverse:function(){for(var e,t=Re(this).length,r=Math.floor(t/2),i=0;i<r;)e=this[i],this[i++]=this[--t],this[t]=e;return this},some:function(e){return K(Re(this),e,1<arguments.length?arguments[1]:void 0)},sort:function(e){return he.call(Re(this),e)},subarray:function(e,t){var r=Re(this),i=r.length,n=o(e,i);return new(g(r,r[ye]))(r.buffer,r.byteOffset+n*r.BYTES_PER_ELEMENT,w((void 0===t?i:o(t,i))-n))}},je=function(e,t){return Ae(this,pe.call(Re(this),e,t))},Ne=function(e){Re(this);var t=Se(arguments[1],1),r=this.length,i=d(e),n=w(i.length),o=0;if(r<n+t)throw U(_e);for(;o<n;)this[t+o]=i[o++]},De={entries:function(){return ae.call(Re(this))},keys:function(){return oe.call(Re(this))},values:function(){return ne.call(Re(this))}},Ue=function(e,t){return S(e)&&e[xe]&&"symbol"!=typeof t&&t in e&&String(+t)==String(t)},Ve=function(e,t){return Ue(e,t=a(t,!0))?r(2,e[t]):D(e,t)},Be=function(e,t,r){return!(Ue(e,t=a(t,!0))&&S(r)&&s(r,"value"))||s(r,"get")||s(r,"set")||r.configurable||s(r,"writable")&&!r.writable||s(r,"enumerable")&&!r.enumerable?N(e,t,r):(e[t]=r.value,e)};be||(j.f=Ve,I.f=Be),b(b.S+b.F*!be,"Object",{getOwnPropertyDescriptor:Ve,defineProperty:Be}),y(function(){de.call({})})&&(de=fe=function(){return ue.call(this)});var ze=i({},Ie);i(ze,De),_(ze,me,De.values),i(ze,{slice:je,set:Ne,constructor:function(){},toString:de,toLocaleString:ke}),Le(ze,"buffer","b"),Le(ze,"byteOffset","o"),Le(ze,"byteLength","l"),Le(ze,"length","e"),N(ze,ge,{get:function(){return this[xe]}}),e.exports=function(e,h,t,o){var p=e+((o=!!o)?"Clamped":"")+"Array",r="get"+e,a="set"+e,d=v[p],s=d||{},i=d&&P(d),n=!d||!x.ABV,l={},c=d&&d[W],f=function(e,n){N(e,n,{get:function(){return e=n,(t=this._d).v[r](e*h+t.o,Te);var e,t},set:function(e){return t=n,r=e,i=this._d,o&&(r=(r=Math.round(r))<0?0:255<r?255:255&r),void i.v[a](t*h+i.o,r,Te);var t,r,i},enumerable:!0})};n?(d=t(function(e,t,r,i){E(e,d,p,"_d");var n,o,a,s,l=0,c=0;if(S(t)){if(!(t instanceof Y||(s=M(t))==z||s==q))return xe in t?Ce(d,t):Oe.call(d,t);n=t,c=Se(r,h);var u=t.byteLength;if(void 0===i){if(u%h)throw U(_e);if((o=u-c)<0)throw U(_e)}else if(u<(o=w(i)*h)+c)throw U(_e);a=o/h}else a=T(t),n=new Y(o=a*h);for(_(e,"_d",{b:n,o:c,l:o,e:a,v:new Q(n)});l<a;)f(e,l++)}),c=d[W]=R(ze),_(c,"constructor",d)):y(function(){d(1)})&&y(function(){new d(-1)})&&O(function(e){new d,new d(null),new d(1.5),new d(e)},!0)||(d=t(function(e,t,r,i){var n;return E(e,d,p),S(t)?t instanceof Y||(n=M(t))==z||n==q?void 0!==i?new s(t,Se(r,h),i):void 0!==r?new s(t,Se(r,h)):new s(t):xe in t?Ce(d,t):Oe.call(d,t):new s(T(t))}),J(i!==Function.prototype?A(s).concat(A(i)):A(s),function(e){e in d||_(d,e,s[e])}),(d[W]=c).constructor=d);var u=c[me],m=!!u&&("values"==u.name||null==u.name),g=De.values;_(d,ve,!0),_(c,xe,p),_(c,Ee,!0),_(c,ye,d),(o?new d(1)[ge]==p:ge in c)||N(c,ge,{get:function(){return p}}),l[p]=d,b(b.G+b.W+b.F*(d!=s),l),b(b.S,p,{BYTES_PER_ELEMENT:h}),b(b.S+b.F*y(function(){s.of.call(d,1)}),p,{from:Oe,of:He}),G in c||_(c,G,h),b(b.P,p,Ie),H(p),b(b.P+b.F*Me,p,{set:Ne}),b(b.P+b.F*!m,p,De),c.toString!=de&&(c.toString=de),b(b.P+b.F*y(function(){new d(1).slice()}),p,{slice:je}),b(b.P+b.F*(y(function(){return[1,2].toLocaleString()!=new d([1,2]).toLocaleString()})||!y(function(){c.toLocaleString.call([1,2])})),p,{toLocaleString:ke}),L[p]=m?u:g,m||_(c,me,g)}}else e.exports=function(){}});Fe("Int8",1,function(i){return function(e,t,r){return i(this,e,t,r)}}),Fe("Uint8",1,function(i){return function(e,t,r){return i(this,e,t,r)}}),Fe("Uint8",1,function(i){return function(e,t,r){return i(this,e,t,r)}},!0),Fe("Int16",2,function(i){return function(e,t,r){return i(this,e,t,r)}}),Fe("Uint16",2,function(i){return function(e,t,r){return i(this,e,t,r)}}),Fe("Int32",4,function(i){return function(e,t,r){return i(this,e,t,r)}}),Fe("Uint32",4,function(i){return function(e,t,r){return i(this,e,t,r)}}),Fe("Float32",4,function(i){return function(e,t,r){return i(this,e,t,r)}}),Fe("Float64",8,function(i){return function(e,t,r){return i(this,e,t,r)}});var ke=function(t,e,r,i){try{return i?e(T(r)[0],r[1]):e(r)}catch(e){var n=t.return;throw void 0!==n&&T(n.call(t)),e}},Ie=r(function(e){var p={},d={},t=e.exports=function(e,t,r,i,n){var o,a,s,l,c=n?function(){return e}:_t(e),u=et(r,i,t?2:1),h=0;if("function"!=typeof c)throw TypeError(e+" is not iterable!");if(bt(c)){for(o=at(e.length);h<o;h++)if((l=t?u(T(a=e[h])[0],a[1]):u(e[h]))===p||l===d)return l}else for(s=c.call(e);!(a=s.next()).done;)if((l=ke(s,u,a.value,t))===p||l===d)return l};t.BREAK=p,t.RETURN=d}),je=r(function(e){var r=$e("meta"),t=Qe.f,i=0,n=Object.isExtensible||function(){return!0},o=!We(function(){return n(Object.preventExtensions({}))}),a=function(e){t(e,r,{value:{i:"O"+ ++i,w:{}}})},s=e.exports={KEY:r,NEED:!1,fastKey:function(e,t){if(!Ge(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!Ke(e,r)){if(!n(e))return"F";if(!t)return"E";a(e)}return e[r].i},getWeak:function(e,t){if(!Ke(e,r)){if(!n(e))return!0;if(!t)return!1;a(e)}return e[r].w},onFreeze:function(e){return o&&s.NEED&&n(e)&&!Ke(e,r)&&a(e),e}}}),Ne=function(e,t){if(!Ge(e)||e._t!==t)throw TypeError("Incompatible receiver, "+t+" required!");return e},De=Qe.f,Ue=je.fastKey,Ve=Xe?"_s":"size",Be=function(e,t){var r,i=Ue(t);if("F"!==i)return e._i[i];for(r=e._f;r;r=r.n)if(r.k==t)return r},ze={getConstructor:function(e,o,r,i){var n=e(function(e,t){nt(e,n,o,"_i"),e._t=o,e._i=xt(null),e._f=void 0,e._l=void 0,e[Ve]=0,null!=t&&Ie(t,r,e[i],e)});return it(n.prototype,{clear:function(){for(var e=Ne(this,o),t=e._i,r=e._f;r;r=r.n)r.r=!0,r.p&&(r.p=r.p.n=void 0),delete t[r.i];e._f=e._l=void 0,e[Ve]=0},delete:function(e){var t=Ne(this,o),r=Be(t,e);if(r){var i=r.n,n=r.p;delete t._i[r.i],r.r=!0,n&&(n.n=i),i&&(i.p=n),t._f==r&&(t._f=i),t._l==r&&(t._l=n),t[Ve]--}return!!r},forEach:function(e){Ne(this,o);for(var t,r=et(e,1<arguments.length?arguments[1]:void 0,3);t=t?t.n:this._f;)for(r(t.v,t.k,this);t&&t.r;)t=t.p},has:function(e){return!!Be(Ne(this,o),e)}}),Xe&&De(n.prototype,"size",{get:function(){return Ne(this,o)[Ve]}}),n},def:function(e,t,r){var i,n,o=Be(e,t);return o?o.v=r:(e._l=o={i:n=Ue(t,!0),k:t,v:r,p:i=e._l,n:void 0,r:!1},e._f||(e._f=o),i&&(i.n=o),e[Ve]++,"F"!==n&&(e._i[n]=o)),e},getEntry:Be,setStrong:function(e,r,t){Pe(e,r,function(e,t){this._t=Ne(e,r),this._k=t,this._l=void 0},function(){for(var e=this._k,t=this._l;t&&t.r;)t=t.p;return this._t&&(this._l=t=t?t.n:this._t._f)?_e(0,"keys"==e?t.k:"values"==e?t.v:[t.k,t.v]):(this._t=void 0,_e(1))},t?"entries":"values",!t,!0),gt(r)}},Pt=function(e,t){if(T(e),!Ge(t)&&null!==t)throw TypeError(t+": can't set as prototype!")},At={set:Object.setPrototypeOf||("__proto__"in{}?function(e,r,i){try{(i=et(Function.call,Rt.f(Object.prototype,"__proto__").set,2))(e,[]),r=!(e instanceof Array)}catch(e){r=!0}return function(e,t){return Pt(e,t),r?e.__proto__=t:i(e,t),e}}({},!1):void 0),check:Pt},Ct=At.set,Lt=function(s,e,t,r,l,i){var c=qe[s],u=c,h=l?"set":"add",n=u&&u.prototype,o={},a=function(e){var r=n[e];_(n,e,"delete"==e?function(e){return!(i&&!Ge(e))&&r.call(this,0===e?0:e)}:"has"==e?function(e){return!(i&&!Ge(e))&&r.call(this,0===e?0:e)}:"get"==e?function(e){return i&&!Ge(e)?void 0:r.call(this,0===e?0:e)}:"add"==e?function(e){return r.call(this,0===e?0:e),this}:function(e,t){return r.call(this,0===e?0:e,t),this})};if("function"==typeof u&&(i||n.forEach&&!We(function(){(new u).entries().next()}))){var p=new u,d=p[h](i?{}:-0,1)!=p,f=We(function(){p.has(1)}),m=Mt(function(e){new u(e)}),g=!i&&We(function(){for(var e=new u,t=5;t--;)e[h](t,t);return!e.has(-0)});m||(((u=e(function(e,t){nt(e,u,s);var r,i,n,o,a=(r=new c,i=u,(o=e.constructor)!==i&&"function"==typeof o&&(n=o.prototype)!==i.prototype&&Ge(n)&&Ct&&Ct(r,n),r);return null!=t&&Ie(t,l,a[h],a),a})).prototype=n).constructor=u),(f||g)&&(a("delete"),a("has"),l&&a("get")),(g||d)&&a(h),i&&n.clear&&delete n.clear}else u=r.getConstructor(e,s,l,h),it(u.prototype,t),je.NEED=!0;return G(u,s),o[s]=u,tt(tt.G+tt.W+tt.F*(u!=c),o),i||r.setStrong(u,s,l),u},Ot=(Lt("Map",function(e){return function(){return e(this,0<arguments.length?arguments[0]:void 0)}},{get:function(e){var t=ze.getEntry(Ne(this,"Map"),e);return t&&t.v},set:function(e,t){return ze.def(Ne(this,"Map"),0===e?0:e,t)}},ze,!0),Lt("Set",function(e){return function(){return e(this,0<arguments.length?arguments[0]:void 0)}},{add:function(e){return ze.def(Ne(this,"Set"),e=0===e?0:e,e)}},ze),{f:Object.getOwnPropertySymbols}),Ht=Object.assign,Ft=!Ht||We(function(){var e={},t={},r=Symbol(),i="abcdefghijklmnopqrst";return e[r]=7,i.split("").forEach(function(e){t[e]=e}),7!=Ht({},e)[r]||Object.keys(Ht({},t)).join("")!=i})?function(e,t){for(var r=ht(e),i=arguments.length,n=1,o=Ot.f,a=Oe.f;n<i;)for(var s,l=L(arguments[n++]),c=o?oe(l).concat(o(l)):oe(l),u=c.length,h=0;h<u;)a.call(l,s=c[h++])&&(r[s]=l[s]);return r}:Ht,kt=je.getWeak,It=wt(5),jt=wt(6),Nt=0,Dt=function(e){return e._l||(e._l=new Ut)},Ut=function(){this.a=[]},Vt=function(e,t){return It(e.a,function(e){return e[0]===t})};Ut.prototype={get:function(e){var t=Vt(this,e);if(t)return t[1]},has:function(e){return!!Vt(this,e)},set:function(e,t){var r=Vt(this,e);r?r[1]=t:this.a.push([e,t])},delete:function(t){var e=jt(this.a,function(e){return e[0]===t});return~e&&this.a.splice(e,1),!!~e}};var Bt={getConstructor:function(e,r,i,n){var o=e(function(e,t){nt(e,o,r,"_i"),e._t=r,e._i=Nt++,e._l=void 0,null!=t&&Ie(t,i,e[n],e)});return it(o.prototype,{delete:function(e){if(!Ge(e))return!1;var t=kt(e);return!0===t?Dt(Ne(this,r)).delete(e):t&&Ke(t,this._i)&&delete t[this._i]},has:function(e){if(!Ge(e))return!1;var t=kt(e);return!0===t?Dt(Ne(this,r)).has(e):t&&Ke(t,this._i)}}),o},def:function(e,t,r){var i=kt(T(t),!0);return!0===i?Dt(e).set(t,r):i[e._i]=r,e},ufstore:Dt};r(function(e){var o,t=wt(0),r=!qe.ActiveXObject&&"ActiveXObject"in qe,i="WeakMap",n=je.getWeak,a=Object.isExtensible,s=Bt.ufstore,l=function(e){return function(){return e(this,0<arguments.length?arguments[0]:void 0)}},c={get:function(e){if(Ge(e)){var t=n(e);return!0===t?s(Ne(this,i)).get(e):t?t[this._i]:void 0}},set:function(e,t){return Bt.def(Ne(this,i),e,t)}},u=e.exports=Lt(i,l,c,Bt,!0,!0);r&&(o=Bt.getConstructor(l,i),Ft(o.prototype,c),je.NEED=!0,t(["delete","has","get","set"],function(i){var e=u.prototype,n=e[i];_(e,i,function(e,t){if(!Ge(e)||a(e))return n.call(this,e,t);this._f||(this._f=new o);var r=this._f[i](e,t);return"set"==i?this:r})}))});Lt("WeakSet",function(e){return function(){return e(this,0<arguments.length?arguments[0]:void 0)}},{add:function(e){return Bt.def(Ne(this,"WeakSet"),e,!0)}},Bt,!1,!0);var zt=(qe.Reflect||{}).apply,qt=Function.apply;tt(tt.S+tt.F*!We(function(){zt(function(){})}),"Reflect",{apply:function(e,t,r){var i=d(e),n=T(r);return zt?zt(i,t,n):qt.call(i,t,n)}});var Gt=function(e,t,r){var i=void 0===r;switch(t.length){case 0:return i?e():e.call(r);case 1:return i?e(t[0]):e.call(r,t[0]);case 2:return i?e(t[0],t[1]):e.call(r,t[0],t[1]);case 3:return i?e(t[0],t[1],t[2]):e.call(r,t[0],t[1],t[2]);case 4:return i?e(t[0],t[1],t[2],t[3]):e.call(r,t[0],t[1],t[2],t[3])}return e.apply(r,t)},Wt=[].slice,Xt={},Yt=Function.bind||function(t){var r=d(this),i=Wt.call(arguments,1),n=function(){var e=i.concat(Wt.call(arguments));return this instanceof n?function(e,t,r){if(!(t in Xt)){for(var i=[],n=0;n<t;n++)i[n]="a["+n+"]";Xt[t]=Function("F,a","return new F("+i.join(",")+")")}return Xt[t](e,r)}(r,e.length,e):Gt(r,e,t)};return Ge(r.prototype)&&(n.prototype=r.prototype),n},Qt=(qe.Reflect||{}).construct,Jt=We(function(){function e(){}return!(Qt(function(){},[],e)instanceof e)}),Zt=!We(function(){Qt(function(){})});tt(tt.S+tt.F*(Jt||Zt),"Reflect",{construct:function(e,t){d(e),T(t);var r=arguments.length<3?e:d(arguments[2]);if(Zt&&!Jt)return Qt(e,t,r);if(e==r){switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3])}var i=[null];return i.push.apply(i,t),new(Yt.apply(e,i))}var n=r.prototype,o=xt(Ge(n)?n:Object.prototype),a=Function.apply.call(e,o,t);return Ge(a)?a:o}}),tt(tt.S+tt.F*We(function(){Reflect.defineProperty(Qe.f({},1,{value:1}),1,{value:2})}),"Reflect",{defineProperty:function(e,t,r){T(e),t=Ye(t,!0),T(r);try{return Qe.f(e,t,r),!0}catch(e){return!1}}});var Kt=Rt.f;tt(tt.S,"Reflect",{deleteProperty:function(e,t){var r=Kt(T(e),t);return!(r&&!r.configurable)&&delete e[t]}}),tt(tt.S,"Reflect",{get:function e(t,r){var i,n,o=arguments.length<3?t:arguments[2];return T(t)===o?t[r]:(i=Rt.f(t,r))?Ke(i,"value")?i.value:void 0!==i.get?i.get.call(o):void 0:Ge(n=Et(t))?e(n,r,o):void 0}}),tt(tt.S,"Reflect",{getOwnPropertyDescriptor:function(e,t){return Rt.f(T(e),t)}}),tt(tt.S,"Reflect",{getPrototypeOf:function(e){return Et(T(e))}}),tt(tt.S,"Reflect",{has:function(e,t){return t in e}});var $t=Object.isExtensible;tt(tt.S,"Reflect",{isExtensible:function(e){return T(e),!$t||$t(e)}});var er=qe.Reflect,tr=er&&er.ownKeys||function(e){var t=ut.f(T(e)),r=Ot.f;return r?t.concat(r(e)):t};tt(tt.S,"Reflect",{ownKeys:tr});var rr=Object.preventExtensions;tt(tt.S,"Reflect",{preventExtensions:function(e){T(e);try{return rr&&rr(e),!0}catch(e){return!1}}}),tt(tt.S,"Reflect",{set:function e(t,r,i){var n,o,a=arguments.length<4?t:arguments[3],s=Rt.f(T(t),r);if(!s){if(Ge(o=Et(t)))return e(o,r,i,a);s=Je(0)}if(Ke(s,"value")){if(!1===s.writable||!Ge(a))return!1;if(n=Rt.f(a,r)){if(n.get||n.set||!1===n.writable)return!1;n.value=i,Qe.f(a,r,n)}else Qe.f(a,r,Je(0,i));return!0}return void 0!==s.set&&(s.set.call(a,i),!0)}}),At&&tt(tt.S,"Reflect",{setPrototypeOf:function(e,t){At.check(e,t);try{return At.set(e,t),!0}catch(e){return!1}}});var ir,nr,or,ar=qe.process,sr=qe.setImmediate,lr=qe.clearImmediate,cr=qe.MessageChannel,ur=qe.Dispatch,hr=0,pr={},dr="onreadystatechange",fr=function(){var e=+this;if(pr.hasOwnProperty(e)){var t=pr[e];delete pr[e],t()}},mr=function(e){fr.call(e.data)};sr&&lr||(sr=function(e){for(var t=[],r=1;arguments.length>r;)t.push(arguments[r++]);return pr[++hr]=function(){Gt("function"==typeof e?e:Function(e),t)},ir(hr),hr},lr=function(e){delete pr[e]},"process"==C(ar)?ir=function(e){ar.nextTick(et(fr,e,1))}:ur&&ur.now?ir=function(e){ur.now(et(fr,e,1))}:cr?(or=(nr=new cr).port2,nr.port1.onmessage=mr,ir=et(or.postMessage,or,1)):qe.addEventListener&&"function"==typeof postMessage&&!qe.importScripts?(ir=function(e){qe.postMessage(e+"","*")},qe.addEventListener("message",mr,!1)):ir=dr in o("script")?function(e){le.appendChild(o("script"))[dr]=function(){le.removeChild(this),fr.call(e)}}:function(e){setTimeout(et(fr,e,1),0)});var gr={set:sr,clear:lr},vr=gr.set,yr=qe.MutationObserver||qe.WebKitMutationObserver,br=qe.process,xr=qe.Promise,Er="process"==C(br);function _r(e){var r,i;this.promise=new e(function(e,t){if(void 0!==r||void 0!==i)throw TypeError("Bad Promise constructor");r=e,i=t}),this.resolve=d(r),this.reject=d(i)}var wr,Tr,Mr,Sr,Rr={f:function(e){return new _r(e)}},Pr=function(e){try{return{e:!1,v:e()}}catch(e){return{e:!0,v:e}}},Ar=qe.navigator,Cr=Ar&&Ar.userAgent||"",Lr=gr.set,Or=function(){var r,i,n,e=function(){var e,t;for(Er&&(e=br.domain)&&e.exit();r;){t=r.fn,r=r.next;try{t()}catch(e){throw r?n():i=void 0,e}}i=void 0,e&&e.enter()};if(Er)n=function(){br.nextTick(e)};else if(!yr||qe.navigator&&qe.navigator.standalone)if(xr&&xr.resolve){var t=xr.resolve(void 0);n=function(){t.then(e)}}else n=function(){vr.call(qe,e)};else{var o=!0,a=document.createTextNode("");new yr(e).observe(a,{characterData:!0}),n=function(){a.data=o=!o}}return function(e){var t={fn:e,next:void 0};i&&(i.next=t),r||(r=t,n()),i=t}}(),Hr="Promise",Fr=qe.TypeError,kr=qe.process,Ir=kr&&kr.versions,jr=Ir&&Ir.v8||"",Nr=qe[Hr],Dr="process"==vt(kr),Ur=function(){},Vr=Tr=Rr.f,Br=!!function(){try{var e=Nr.resolve(1),t=(e.constructor={})[dt("species")]=function(e){e(Ur,Ur)};return(Dr||"function"==typeof PromiseRejectionEvent)&&e.then(Ur)instanceof t&&0!==jr.indexOf("6.6")&&-1===Cr.indexOf("Chrome/66")}catch(e){}}(),zr=function(e){var t;return!(!Ge(e)||"function"!=typeof(t=e.then))&&t},qr=function(u,r){if(!u._n){u._n=!0;var i=u._c;Or(function(){for(var l=u._v,c=1==u._s,e=0,t=function(e){var t,r,i,n=c?e.ok:e.fail,o=e.resolve,a=e.reject,s=e.domain;try{n?(c||(2==u._h&&Xr(u),u._h=1),!0===n?t=l:(s&&s.enter(),t=n(l),s&&(s.exit(),i=!0)),t===e.promise?a(Fr("Promise-chain cycle")):(r=zr(t))?r.call(t,o,a):o(t)):a(l)}catch(e){s&&!i&&s.exit(),a(e)}};i.length>e;)t(i[e++]);u._c=[],u._n=!1,r&&!u._h&&Gr(u)})}},Gr=function(o){Lr.call(qe,function(){var e,t,r,i=o._v,n=Wr(o);if(n&&(e=Pr(function(){Dr?kr.emit("unhandledRejection",i,o):(t=qe.onunhandledrejection)?t({promise:o,reason:i}):(r=qe.console)&&r.error&&r.error("Unhandled promise rejection",i)}),o._h=Dr||Wr(o)?2:1),o._a=void 0,n&&e.e)throw e.v})},Wr=function(e){return 1!==e._h&&0===(e._a||e._c).length},Xr=function(t){Lr.call(qe,function(){var e;Dr?kr.emit("rejectionHandled",t):(e=qe.onrejectionhandled)&&e({promise:t,reason:t._v})})},Yr=function(e){var t=this;t._d||(t._d=!0,(t=t._w||t)._v=e,t._s=2,t._a||(t._a=t._c.slice()),qr(t,!0))},Qr=function(e){var r,i=this;if(!i._d){i._d=!0,i=i._w||i;try{if(i===e)throw Fr("Promise can't be resolved itself");(r=zr(e))?Or(function(){var t={_w:i,_d:!1};try{r.call(e,et(Qr,t,1),et(Yr,t,1))}catch(e){Yr.call(t,e)}}):(i._v=e,i._s=1,qr(i,!1))}catch(e){Yr.call({_w:i,_d:!1},e)}}};Br||(Nr=function(e){nt(this,Nr,Hr,"_h"),d(e),wr.call(this);try{e(et(Qr,this,1),et(Yr,this,1))}catch(e){Yr.call(this,e)}},(wr=function(e){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1}).prototype=it(Nr.prototype,{then:function(e,t){var r=Vr(mt(this,Nr));return r.ok="function"!=typeof e||e,r.fail="function"==typeof t&&t,r.domain=Dr?kr.domain:void 0,this._c.push(r),this._a&&this._a.push(r),this._s&&qr(this,!1),r.promise},catch:function(e){return this.then(void 0,e)}}),Mr=function(){var e=new wr;this.promise=e,this.resolve=et(Qr,e,1),this.reject=et(Yr,e,1)},Rr.f=Vr=function(e){return e===Nr||e===Sr?new Mr(e):Tr(e)}),tt(tt.G+tt.W+tt.F*!Br,{Promise:Nr}),G(Nr,Hr),gt(Hr),Sr=m[Hr],tt(tt.S+tt.F*!Br,Hr,{reject:function(e){var t=Vr(this);return(0,t.reject)(e),t.promise}}),tt(tt.S+tt.F*!Br,Hr,{resolve:function(e){return function(e,t){if(T(e),Ge(t)&&t.constructor===e)return t;var r=Rr.f(e);return(0,r.resolve)(t),r.promise}(this,e)}}),tt(tt.S+tt.F*!(Br&&Mt(function(e){Nr.all(e).catch(Ur)})),Hr,{all:function(e){var a=this,t=Vr(a),s=t.resolve,l=t.reject,r=Pr(function(){var i=[],n=0,o=1;Ie(e,!1,function(e){var t=n++,r=!1;i.push(void 0),o++,a.resolve(e).then(function(e){r||(r=!0,i[t]=e,--o||s(i))},l)}),--o||s(i)});return r.e&&l(r.v),t.promise},race:function(e){var t=this,r=Vr(t),i=r.reject,n=Pr(function(){Ie(e,!1,function(e){t.resolve(e).then(r.resolve,i)})});return n.e&&i(n.v),r.promise}});var Jr,Zr,Kr={f:dt},$r=Qe.f,ei=ut.f,ti={}.toString,ri="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],ii={f:function(e){return ri&&"[object Window]"==ti.call(e)?function(e){try{return ei(e)}catch(e){return ri.slice()}}(e):ei(H(e))}},ni=je.KEY,oi=Rt.f,ai=Qe.f,si=ii.f,li=qe.Symbol,ci=qe.JSON,ui=ci&&ci.stringify,hi="prototype",pi=dt("_hidden"),di=dt("toPrimitive"),fi={}.propertyIsEnumerable,mi=h("symbol-registry"),gi=h("symbols"),vi=h("op-symbols"),yi=Object[hi],bi="function"==typeof li,xi=qe.QObject,Ei=!xi||!xi[hi]||!xi[hi].findChild,_i=Xe&&We(function(){return 7!=xt(ai({},"a",{get:function(){return ai(this,"a",{value:7}).a}})).a})?function(e,t,r){var i=oi(yi,t);i&&delete yi[t],ai(e,t,r),i&&e!==yi&&ai(yi,t,i)}:ai,wi=function(e){var t=gi[e]=xt(li[hi]);return t._k=e,t},Ti=bi&&"symbol"==typeof li.iterator?function(e){return"symbol"==typeof e}:function(e){return e instanceof li},Mi=function(e,t,r){return e===yi&&Mi(vi,t,r),T(e),t=Ye(t,!0),T(r),Ke(gi,t)?(r.enumerable?(Ke(e,pi)&&e[pi][t]&&(e[pi][t]=!1),r=xt(r,{enumerable:Je(0,!1)})):(Ke(e,pi)||ai(e,pi,Je(1,{})),e[pi][t]=!0),_i(e,t,r)):ai(e,t,r)},Si=function(e,t){T(e);for(var r,i=function(e){var t=oe(e),r=Ot.f;if(r)for(var i,n=r(e),o=Oe.f,a=0;n.length>a;)o.call(e,i=n[a++])&&t.push(i);return t}(t=H(t)),n=0,o=i.length;n<o;)Mi(e,r=i[n++],t[r]);return e},Ri=function(e){var t=fi.call(this,e=Ye(e,!0));return!(this===yi&&Ke(gi,e)&&!Ke(vi,e))&&(!(t||!Ke(this,e)||!Ke(gi,e)||Ke(this,pi)&&this[pi][e])||t)},Pi=function(e,t){if(e=H(e),t=Ye(t,!0),e!==yi||!Ke(gi,t)||Ke(vi,t)){var r=oi(e,t);return!r||!Ke(gi,t)||Ke(e,pi)&&e[pi][t]||(r.enumerable=!0),r}},Ai=function(e){for(var t,r=si(H(e)),i=[],n=0;r.length>n;)Ke(gi,t=r[n++])||t==pi||t==ni||i.push(t);return i},Ci=function(e){for(var t,r=e===yi,i=si(r?vi:H(e)),n=[],o=0;i.length>o;)!Ke(gi,t=i[o++])||r&&!Ke(yi,t)||n.push(gi[t]);return n};bi||(_((li=function(){if(this instanceof li)throw TypeError("Symbol is not a constructor!");var t=$e(0<arguments.length?arguments[0]:void 0),r=function(e){this===yi&&r.call(vi,e),Ke(this,pi)&&Ke(this[pi],t)&&(this[pi][t]=!1),_i(this,t,Je(1,e))};return Xe&&Ei&&_i(yi,t,{configurable:!0,set:r}),wi(t)})[hi],"toString",function(){return this._k}),Rt.f=Pi,Qe.f=Mi,ut.f=ii.f=Ai,Oe.f=Ri,Ot.f=Ci,Xe&&_(yi,"propertyIsEnumerable",Ri,!0),Kr.f=function(e){return wi(dt(e))}),tt(tt.G+tt.W+tt.F*!bi,{Symbol:li});for(var Li="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),Oi=0;Li.length>Oi;)dt(Li[Oi++]);for(var Hi=oe(dt.store),Fi=0;Hi.length>Fi;)Jr=Hi[Fi++],void 0,Zr=m.Symbol||(m.Symbol=qe.Symbol||{}),"_"==Jr.charAt(0)||Jr in Zr||$r(Zr,Jr,{value:Kr.f(Jr)});tt(tt.S+tt.F*!bi,"Symbol",{for:function(e){return Ke(mi,e+="")?mi[e]:mi[e]=li(e)},keyFor:function(e){if(!Ti(e))throw TypeError(e+" is not a symbol!");for(var t in mi)if(mi[t]===e)return t},useSetter:function(){Ei=!0},useSimple:function(){Ei=!1}}),tt(tt.S+tt.F*!bi,"Object",{create:function(e,t){return void 0===t?xt(e):Si(xt(e),t)},defineProperty:Mi,defineProperties:Si,getOwnPropertyDescriptor:Pi,getOwnPropertyNames:Ai,getOwnPropertySymbols:Ci}),ci&&tt(tt.S+tt.F*(!bi||We(function(){var e=li();return"[null]"!=ui([e])||"{}"!=ui({a:e})||"{}"!=ui(Object(e))})),"JSON",{stringify:function(e){for(var t,r,i=[e],n=1;arguments.length>n;)i.push(arguments[n++]);if(r=t=i[1],(Ge(t)||void 0!==e)&&!Ti(e))return ge(t)||(t=function(e,t){if("function"==typeof r&&(t=r.call(this,e,t)),!Ti(t))return t}),i[1]=t,ui.apply(ci,i)}}),li[hi][di]||Ze(li[hi],di,li[hi].valueOf),G(li,"Symbol"),G(Math,"Math",!0),G(qe.JSON,"JSON",!0);var ki=function(e,t){var r=(m.Object||{})[e]||Object[e],i={};i[e]=t(r),tt(tt.S+tt.F*We(function(){r(1)}),"Object",i)},Ii=je.onFreeze;ki("freeze",function(t){return function(e){return t&&Ge(e)?t(Ii(e)):e}});var ji=je.onFreeze;ki("seal",function(t){return function(e){return t&&Ge(e)?t(ji(e)):e}});var Ni=je.onFreeze;ki("preventExtensions",function(t){return function(e){return t&&Ge(e)?t(Ni(e)):e}}),ki("isFrozen",function(t){return function(e){return!Ge(e)||!!t&&t(e)}}),ki("isSealed",function(t){return function(e){return!Ge(e)||!!t&&t(e)}}),ki("isExtensible",function(t){return function(e){return!!Ge(e)&&(!t||t(e))}});var Di=Rt.f;ki("getOwnPropertyDescriptor",function(){return function(e,t){return Di(H(e),t)}}),ki("getPrototypeOf",function(){return function(e){return Et(ht(e))}}),ki("keys",function(){return function(e){return oe(ht(e))}}),ki("getOwnPropertyNames",function(){return ii.f}),tt(tt.S+tt.F,"Object",{assign:Ft});var Ui=Object.is||function(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t};tt(tt.S,"Object",{is:Ui}),tt(tt.S,"Object",{setPrototypeOf:At.set});var Vi=Qe.f,Bi=Function.prototype,zi=/^\s*function ([^ (]*)/;"name"in Bi||Xe&&Vi(Bi,"name",{configurable:!0,get:function(){try{return(""+this).match(zi)[1]}catch(e){return""}}}),tt(tt.S,"String",{raw:function(e){for(var t=H(e.raw),r=at(t.length),i=arguments.length,n=[],o=0;o<r;)n.push(String(t[o++])),o<i&&n.push(String(arguments[o]));return n.join("")}});var qi=String.fromCharCode,Gi=String.fromCodePoint;tt(tt.S+tt.F*(!!Gi&&1!=Gi.length),"String",{fromCodePoint:function(e){for(var t,r=[],i=arguments.length,n=0;n<i;){if(t=+arguments[n++],lt(t,1114111)!==t)throw RangeError(t+" is not a valid code point");r.push(t<65536?qi(t):qi(55296+((t-=65536)>>10),t%1024+56320))}return r.join("")}});var Wi=function(s){return function(e,t){var r,i,n=String(O(e)),o=ot(t),a=n.length;return o<0||a<=o?s?"":void 0:(r=n.charCodeAt(o))<55296||56319<r||o+1===a||(i=n.charCodeAt(o+1))<56320||57343<i?s?n.charAt(o):r:s?n.slice(o,o+2):i-56320+(r-55296<<10)+65536}},Xi=Wi(!1);tt(tt.P,"String",{codePointAt:function(e){return Xi(this,e)}});var Yi=function(e){var t=String(O(this)),r="",i=ot(e);if(i<0||i==1/0)throw RangeError("Count can't be negative");for(;0<i;(i>>>=1)&&(t+=t))1&i&&(r+=t);return r};tt(tt.P,"String",{repeat:Yi});var Qi=dt("match"),Ji=function(e){var t;return Ge(e)&&(void 0!==(t=e[Qi])?!!t:"RegExp"==C(e))},Zi=function(e,t,r){if(Ji(t))throw TypeError("String#"+r+" doesn't accept regex!");return String(O(e))},Ki=dt("match"),$i=function(t){var r=/./;try{"/./"[t](r)}catch(e){try{return r[Ki]=!1,!"/./"[t](r)}catch(e){}}return!0},en="startsWith",tn=""[en];tt(tt.P+tt.F*$i(en),"String",{startsWith:function(e){var t=Zi(this,e,en),r=at(Math.min(1<arguments.length?arguments[1]:void 0,t.length)),i=String(e);return tn?tn.call(t,i,r):t.slice(r,r+i.length)===i}});var rn="endsWith",nn=""[rn];tt(tt.P+tt.F*$i(rn),"String",{endsWith:function(e){var t=Zi(this,e,rn),r=1<arguments.length?arguments[1]:void 0,i=at(t.length),n=void 0===r?i:Math.min(at(r),i),o=String(e);return nn?nn.call(t,o,n):t.slice(n-o.length,n)===o}});tt(tt.P+tt.F*$i("includes"),"String",{includes:function(e){return!!~Zi(this,e,"includes").indexOf(e,1<arguments.length?arguments[1]:void 0)}});var on=function(){var e=T(this),t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.unicode&&(t+="u"),e.sticky&&(t+="y"),t};Xe&&"g"!=/./g.flags&&Qe.f(RegExp.prototype,"flags",{configurable:!0,get:on});var an,sn,ln=Wi(!0),cn=function(e,t,r){return t+(r?ln(e,t).length:1)},un=RegExp.prototype.exec,hn=function(e,t){var r=e.exec;if("function"==typeof r){var i=r.call(e,t);if("object"!=typeof i)throw new TypeError("RegExp exec method returned something other than an Object or null");return i}if("RegExp"!==vt(e))throw new TypeError("RegExp#exec called on incompatible receiver");return un.call(e,t)},pn=RegExp.prototype.exec,dn=String.prototype.replace,fn=pn,mn="lastIndex",gn=(an=/a/,sn=/b*/g,pn.call(an,"a"),pn.call(sn,"a"),0!==an[mn]||0!==sn[mn]),vn=void 0!==/()??/.exec("")[1];(gn||vn)&&(fn=function(e){var t,r,i,n;return vn&&(r=new RegExp("^"+this.source+"$(?!\\s)",on.call(this))),gn&&(t=this[mn]),i=pn.call(this,e),gn&&i&&(this[mn]=this.global?i.index+i[0].length:t),vn&&i&&1<i.length&&dn.call(i[0],r,function(){for(n=1;n<arguments.length-2;n++)void 0===arguments[n]&&(i[n]=void 0)}),i});var yn=fn;tt({target:"RegExp",proto:!0,forced:yn!==/./.exec},{exec:yn});var bn=dt("species"),xn=!We(function(){var e=/./;return e.exec=function(){var e=[];return e.groups={a:"7"},e},"7"!=="".replace(e,"$<a>")}),En=function(){var e=/(?:)/,t=e.exec;e.exec=function(){return t.apply(this,arguments)};var r="ab".split(e);return 2===r.length&&"a"===r[0]&&"b"===r[1]}(),_n=function(r,e,t){var i=dt(r),o=!We(function(){var e={};return e[i]=function(){return 7},7!=""[r](e)}),n=o?!We(function(){var e=!1,t=/a/;return t.exec=function(){return e=!0,null},"split"===r&&(t.constructor={},t.constructor[bn]=function(){return t}),t[i](""),!e}):void 0;if(!o||!n||"replace"===r&&!xn||"split"===r&&!En){var a=/./[i],s=t(O,i,""[r],function(e,t,r,i,n){return t.exec===yn?o&&!n?{done:!0,value:a.call(t,r,i)}:{done:!0,value:e.call(r,t,i)}:{done:!1}}),l=s[0],c=s[1];_(String.prototype,r,l),Ze(RegExp.prototype,i,2==e?function(e,t){return c.call(e,this,t)}:function(e){return c.call(e,this)})}};_n("match",1,function(i,n,c,u){return[function(e){var t=i(this),r=null==e?void 0:e[n];return void 0!==r?r.call(e,t):new RegExp(e)[n](String(t))},function(e){var t=u(c,e,this);if(t.done)return t.value;var r=T(e),i=String(this);if(!r.global)return hn(r,i);for(var n,o=r.unicode,a=[],s=r.lastIndex=0;null!==(n=hn(r,i));){var l=String(n[0]);""===(a[s]=l)&&(r.lastIndex=cn(i,at(r.lastIndex),o)),s++}return 0===s?null:a}]});var wn=Math.max,Tn=Math.min,Mn=Math.floor,Sn=/\$([$&`']|\d\d?|<[^>]*>)/g,Rn=/\$([$&`']|\d\d?)/g;_n("replace",2,function(n,o,E,_){return[function(e,t){var r=n(this),i=null==e?void 0:e[o];return void 0!==i?i.call(e,r,t):E.call(String(r),e,t)},function(e,t){var r=_(E,e,this,t);if(r.done)return r.value;var i=T(e),n=String(this),o="function"==typeof t;o||(t=String(t));var a=i.global;if(a){var s=i.unicode;i.lastIndex=0}for(var l=[];;){var c=hn(i,n);if(null===c)break;if(l.push(c),!a)break;""===String(c[0])&&(i.lastIndex=cn(n,at(i.lastIndex),s))}for(var u,h="",p=0,d=0;d<l.length;d++){c=l[d];for(var f=String(c[0]),m=wn(Tn(ot(c.index),n.length),0),g=[],v=1;v<c.length;v++)g.push(void 0===(u=c[v])?u:String(u));var y=c.groups;if(o){var b=[f].concat(g,m,n);void 0!==y&&b.push(y);var x=String(t.apply(void 0,b))}else x=w(f,n,m,g,y,t);p<=m&&(h+=n.slice(p,m)+x,p=m+f.length)}return h+n.slice(p)}];function w(o,a,s,l,c,e){var u=s+o.length,h=l.length,t=Rn;return void 0!==c&&(c=ht(c),t=Sn),E.call(e,t,function(e,t){var r;switch(t.charAt(0)){case"$":return"$";case"&":return o;case"`":return a.slice(0,s);case"'":return a.slice(u);case"<":r=c[t.slice(1,-1)];break;default:var i=+t;if(0===i)return e;if(h<i){var n=Mn(i/10);return 0===n?e:n<=h?void 0===l[n-1]?t.charAt(1):l[n-1]+t.charAt(1):e}r=l[i-1]}return void 0===r?"":r})}});var Pn=Math.min,An=[].push,Cn="split",Ln="length",On="lastIndex",Hn=4294967295,Fn=!We(function(){RegExp(Hn,"y")});_n("split",2,function(n,o,g,v){var y;return y="c"=="abbc"[Cn](/(b)*/)[1]||4!="test"[Cn](/(?:)/,-1)[Ln]||2!="ab"[Cn](/(?:ab)*/)[Ln]||4!="."[Cn](/(.?)(.?)/)[Ln]||1<"."[Cn](/()()/)[Ln]||""[Cn](/.?/)[Ln]?function(e,t){var r=String(this);if(void 0===e&&0===t)return[];if(!Ji(e))return g.call(r,e,t);for(var i,n,o,a=[],s=(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.unicode?"u":"")+(e.sticky?"y":""),l=0,c=void 0===t?Hn:t>>>0,u=new RegExp(e.source,s+"g");(i=yn.call(u,r))&&!(l<(n=u[On])&&(a.push(r.slice(l,i.index)),1<i[Ln]&&i.index<r[Ln]&&An.apply(a,i.slice(1)),o=i[0][Ln],l=n,a[Ln]>=c));)u[On]===i.index&&u[On]++;return l===r[Ln]?!o&&u.test("")||a.push(""):a.push(r.slice(l)),a[Ln]>c?a.slice(0,c):a}:"0"[Cn](void 0,0)[Ln]?function(e,t){return void 0===e&&0===t?[]:g.call(this,e,t)}:g,[function(e,t){var r=n(this),i=null==e?void 0:e[o];return void 0!==i?i.call(e,r,t):y.call(String(r),e,t)},function(e,t){var r=v(y,e,this,t,y!==g);if(r.done)return r.value;var i=T(e),n=String(this),o=mt(i,RegExp),a=i.unicode,s=(i.ignoreCase?"i":"")+(i.multiline?"m":"")+(i.unicode?"u":"")+(Fn?"y":"g"),l=new o(Fn?i:"^(?:"+i.source+")",s),c=void 0===t?Hn:t>>>0;if(0===c)return[];if(0===n.length)return null===hn(l,n)?[n]:[];for(var u=0,h=0,p=[];h<n.length;){l.lastIndex=Fn?h:0;var d,f=hn(l,Fn?n:n.slice(h));if(null===f||(d=Pn(at(l.lastIndex+(Fn?0:h)),n.length))===u)h=cn(n,h,a);else{if(p.push(n.slice(u,h)),p.length===c)return p;for(var m=1;m<=f.length-1;m++)if(p.push(f[m]),p.length===c)return p;h=u=d}}return p.push(n.slice(u)),p}]}),_n("search",1,function(i,n,a,s){return[function(e){var t=i(this),r=null==e?void 0:e[n];return void 0!==r?r.call(e,t):new RegExp(e)[n](String(t))},function(e){var t=s(a,e,this);if(t.done)return t.value;var r=T(e),i=String(this),n=r.lastIndex;Ui(n,0)||(r.lastIndex=0);var o=hn(r,i);return Ui(r.lastIndex,n)||(r.lastIndex=n),null===o?-1:o.index}]});var kn=function(e,t,r){t in e?Qe.f(e,t,Je(0,r)):e[t]=r};tt(tt.S+tt.F*!Mt(function(e){Array.from(e)}),"Array",{from:function(e){var t,r,i,n,o=ht(e),a="function"==typeof this?this:Array,s=arguments.length,l=1<s?arguments[1]:void 0,c=void 0!==l,u=0,h=_t(o);if(c&&(l=et(l,2<s?arguments[2]:void 0,2)),null==h||a==Array&&bt(h))for(r=new a(t=at(o.length));u<t;u++)kn(r,u,c?l(o[u],u):o[u]);else for(n=h.call(o),r=new a;!(i=n.next()).done;u++)kn(r,u,c?ke(n,l,[i.value,u],!0):i.value);return r.length=u,r}}),tt(tt.S+tt.F*We(function(){function e(){}return!(Array.of.call(e)instanceof e)}),"Array",{of:function(){for(var e=0,t=arguments.length,r=new("function"==typeof this?this:Array)(t);e<t;)kn(r,e,arguments[e++]);return r.length=t,r}}),tt(tt.P,"Array",{copyWithin:St}),Ee("copyWithin");var In=wt(5),jn=!0;"find"in[]&&Array(1).find(function(){jn=!1}),tt(tt.P+tt.F*jn,"Array",{find:function(e){return In(this,e,1<arguments.length?arguments[1]:void 0)}}),Ee("find");var Nn=wt(6),Dn="findIndex",Un=!0;Dn in[]&&Array(1)[Dn](function(){Un=!1}),tt(tt.P+tt.F*Un,"Array",{findIndex:function(e){return Nn(this,e,1<arguments.length?arguments[1]:void 0)}}),Ee(Dn),tt(tt.P,"Array",{fill:pt}),Ee("fill");var Vn=qe.isFinite;tt(tt.S,"Number",{isFinite:function(e){return"number"==typeof e&&Vn(e)}});var Bn=Math.floor,zn=function(e){return!Ge(e)&&isFinite(e)&&Bn(e)===e};tt(tt.S,"Number",{isInteger:zn});var qn=Math.abs;tt(tt.S,"Number",{isSafeInteger:function(e){return zn(e)&&qn(e)<=9007199254740991}}),tt(tt.S,"Number",{isNaN:function(e){return e!=e}}),tt(tt.S,"Number",{EPSILON:Math.pow(2,-52)}),tt(tt.S,"Number",{MIN_SAFE_INTEGER:-9007199254740991}),tt(tt.S,"Number",{MAX_SAFE_INTEGER:9007199254740991});var Gn=Math.log1p||function(e){return-1e-8<(e=+e)&&e<1e-8?e-e*e/2:Math.log(1+e)},Wn=Math.sqrt,Xn=Math.acosh;tt(tt.S+tt.F*!(Xn&&710==Math.floor(Xn(Number.MAX_VALUE))&&Xn(1/0)==1/0),"Math",{acosh:function(e){return(e=+e)<1?NaN:94906265.62425156<e?Math.log(e)+Math.LN2:Gn(e-1+Wn(e-1)*Wn(e+1))}});var Yn=Math.asinh;tt(tt.S+tt.F*!(Yn&&0<1/Yn(0)),"Math",{asinh:function e(t){return isFinite(t=+t)&&0!=t?t<0?-e(-t):Math.log(t+Math.sqrt(t*t+1)):t}});var Qn=Math.atanh;tt(tt.S+tt.F*!(Qn&&1/Qn(-0)<0),"Math",{atanh:function(e){return 0==(e=+e)?e:Math.log((1+e)/(1-e))/2}});var Jn=Math.sign||function(e){return 0==(e=+e)||e!=e?e:e<0?-1:1};tt(tt.S,"Math",{cbrt:function(e){return Jn(e=+e)*Math.pow(Math.abs(e),1/3)}}),tt(tt.S,"Math",{clz32:function(e){return(e>>>=0)?31-Math.floor(Math.log(e+.5)*Math.LOG2E):32}});var Zn=Math.exp;tt(tt.S,"Math",{cosh:function(e){return(Zn(e=+e)+Zn(-e))/2}});var Kn=Math.expm1,$n=!Kn||22025.465794806718<Kn(10)||Kn(10)<22025.465794806718||-2e-17!=Kn(-2e-17)?function(e){return 0==(e=+e)?e:-1e-6<e&&e<1e-6?e+e*e/2:Math.exp(e)-1}:Kn;tt(tt.S+tt.F*($n!=Math.expm1),"Math",{expm1:$n});var eo=Math.pow,to=eo(2,-52),ro=eo(2,-23),io=eo(2,127)*(2-ro),no=eo(2,-126),oo=Math.fround||function(e){var t,r,i=Math.abs(e),n=Jn(e);return i<no?n*(i/no/ro+1/to-1/to)*no*ro:io<(r=(t=(1+ro/to)*i)-(t-i))||r!=r?n*(1/0):n*r};tt(tt.S,"Math",{fround:oo});var ao=Math.abs;tt(tt.S,"Math",{hypot:function(e,t){for(var r,i,n=0,o=0,a=arguments.length,s=0;o<a;)s<(r=ao(arguments[o++]))?(n=n*(i=s/r)*i+1,s=r):n+=0<r?(i=r/s)*i:r;return s===1/0?1/0:s*Math.sqrt(n)}});var so=Math.imul;tt(tt.S+tt.F*We(function(){return-5!=so(4294967295,5)||2!=so.length}),"Math",{imul:function(e,t){var r=+e,i=+t,n=65535&r,o=65535&i;return 0|n*o+((65535&r>>>16)*o+n*(65535&i>>>16)<<16>>>0)}}),tt(tt.S,"Math",{log1p:Gn}),tt(tt.S,"Math",{log10:function(e){return Math.log(e)*Math.LOG10E}}),tt(tt.S,"Math",{log2:function(e){return Math.log(e)/Math.LN2}}),tt(tt.S,"Math",{sign:Jn});var lo=Math.exp;tt(tt.S+tt.F*We(function(){return-2e-17!=!Math.sinh(-2e-17)}),"Math",{sinh:function(e){return Math.abs(e=+e)<1?($n(e)-$n(-e))/2:(lo(e-1)-lo(-e-1))*(Math.E/2)}});var co=Math.exp;tt(tt.S,"Math",{tanh:function(e){var t=$n(e=+e),r=$n(-e);return t==1/0?1:r==1/0?-1:(t-r)/(co(e)+co(-e))}}),tt(tt.S,"Math",{trunc:function(e){return(0<e?Math.floor:Math.ceil)(e)}});var uo=ct(!0);tt(tt.P,"Array",{includes:function(e){return uo(this,e,1<arguments.length?arguments[1]:void 0)}}),Ee("includes");var ho=Oe.f,po=function(s){return function(e){for(var t,r=H(e),i=oe(r),n=i.length,o=0,a=[];o<n;)ho.call(r,t=i[o++])&&a.push(s?[t,r[t]]:r[t]);return a}},fo=po(!1);tt(tt.S,"Object",{values:function(e){return fo(e)}});var mo=po(!0);tt(tt.S,"Object",{entries:function(e){return mo(e)}}),tt(tt.S,"Object",{getOwnPropertyDescriptors:function(e){for(var t,r,i=H(e),n=Rt.f,o=tr(i),a={},s=0;o.length>s;)void 0!==(r=n(i,t=o[s++]))&&kn(a,t,r);return a}});var go=function(e,t,r,i){var n=String(O(e)),o=n.length,a=void 0===r?" ":String(r),s=at(t);if(s<=o||""==a)return n;var l=s-o,c=Yi.call(a,Math.ceil(l/a.length));return c.length>l&&(c=c.slice(0,l)),i?c+n:n+c},vo=/Version\/10\.\d+(\.\d+)?( Mobile\/\w+)? Safari\//.test(Cr);tt(tt.P+tt.F*vo,"String",{padStart:function(e){return go(this,e,1<arguments.length?arguments[1]:void 0,!0)}});var yo=/Version\/10\.\d+(\.\d+)?( Mobile\/\w+)? Safari\//.test(Cr);tt(tt.P+tt.F*yo,"String",{padEnd:function(e){return go(this,e,1<arguments.length?arguments[1]:void 0,!1)}});var bo=[].slice,xo=/MSIE .\./.test(Cr),Eo=function(n){return function(e,t){var r=2<arguments.length,i=!!r&&bo.call(arguments,2);return n(r?function(){("function"==typeof e?e:Function(e)).apply(this,i)}:e,t)}};tt(tt.G+tt.B+tt.F*xo,{setTimeout:Eo(qe.setTimeout),setInterval:Eo(qe.setInterval)}),tt(tt.G+tt.B,{setImmediate:gr.set,clearImmediate:gr.clear});for(var _o=dt("iterator"),wo=dt("toStringTag"),To=yt.Array,Mo={CSSRuleList:!0,CSSStyleDeclaration:!1,CSSValueList:!1,ClientRectList:!1,DOMRectList:!1,DOMStringList:!1,DOMTokenList:!0,DataTransferItemList:!1,FileList:!1,HTMLAllCollection:!1,HTMLCollection:!1,HTMLFormElement:!1,HTMLSelectElement:!1,MediaList:!0,MimeTypeArray:!1,NamedNodeMap:!1,NodeList:!0,PaintRequestList:!1,Plugin:!1,PluginArray:!1,SVGLengthList:!1,SVGNumberList:!1,SVGPathSegList:!1,SVGPointList:!1,SVGStringList:!1,SVGTransformList:!1,SourceBufferList:!1,StyleSheetList:!0,TextTrackCueList:!1,TextTrackList:!1,TouchList:!1},So=oe(Mo),Ro=0;Ro<So.length;Ro++){var Po,Ao=So[Ro],Co=Mo[Ao],Lo=qe[Ao],Oo=Lo&&Lo.prototype;if(Oo&&(Oo[_o]||Ze(Oo,_o,To),Oo[wo]||Ze(Oo,wo,Ao),yt[Ao]=To,Co))for(Po in Tt)Oo[Po]||_(Oo,Po,Tt[Po],!0)}r(function(L){!function(e){var l,t=Object.prototype,c=t.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",i=r.asyncIterator||"@@asyncIterator",o=r.toStringTag||"@@toStringTag",a=e.regeneratorRuntime;if(a)L.exports=a;else{(a=e.regeneratorRuntime=L.exports).wrap=y;var h="suspendedStart",p="suspendedYield",d="executing",f="completed",m={},s={};s[n]=function(){return this};var u=Object.getPrototypeOf,g=u&&u(u(A([])));g&&g!==t&&c.call(g,n)&&(s=g);var v=_.prototype=x.prototype=Object.create(s);E.prototype=v.constructor=_,_.constructor=E,_[o]=E.displayName="GeneratorFunction",a.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===E||"GeneratorFunction"===(t.displayName||t.name))},a.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,_):(e.__proto__=_,o in e||(e[o]="GeneratorFunction")),e.prototype=Object.create(v),e},a.awrap=function(e){return{__await:e}},w(T.prototype),T.prototype[i]=function(){return this},a.AsyncIterator=T,a.async=function(e,t,r,i){var n=new T(y(e,t,r,i));return a.isGeneratorFunction(t)?n:n.next().then(function(e){return e.done?e.value:n.next()})},w(v),v[o]="Generator",v[n]=function(){return this},v.toString=function(){return"[object Generator]"},a.keys=function(r){var i=[];for(var e in r)i.push(e);return i.reverse(),function e(){for(;i.length;){var t=i.pop();if(t in r)return e.value=t,e.done=!1,e}return e.done=!0,e}},a.values=A,P.prototype={constructor:P,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=l,this.done=!1,this.delegate=null,this.method="next",this.arg=l,this.tryEntries.forEach(R),!e)for(var t in this)"t"===t.charAt(0)&&c.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=l)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(r){if(this.done)throw r;var i=this;function e(e,t){return o.type="throw",o.arg=r,i.next=e,t&&(i.method="next",i.arg=l),!!t}for(var t=this.tryEntries.length-1;0<=t;--t){var n=this.tryEntries[t],o=n.completion;if("root"===n.tryLoc)return e("end");if(n.tryLoc<=this.prev){var a=c.call(n,"catchLoc"),s=c.call(n,"finallyLoc");if(a&&s){if(this.prev<n.catchLoc)return e(n.catchLoc,!0);if(this.prev<n.finallyLoc)return e(n.finallyLoc)}else if(a){if(this.prev<n.catchLoc)return e(n.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<n.finallyLoc)return e(n.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;0<=r;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&c.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var n=i;break}}n&&("break"===e||"continue"===e)&&n.tryLoc<=t&&t<=n.finallyLoc&&(n=null);var o=n?n.completion:{};return o.type=e,o.arg=t,n?(this.method="next",this.next=n.finallyLoc,m):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),R(r),m}},catch:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var i=r.completion;if("throw"===i.type){var n=i.arg;R(r)}return n}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:A(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=l),m}}}function y(e,t,r,i){var o,a,s,l,n=t&&t.prototype instanceof x?t:x,c=Object.create(n.prototype),u=new P(i||[]);return c._invoke=(o=e,a=r,s=u,l=h,function(e,t){if(l===d)throw new Error("Generator is already running");if(l===f){if("throw"===e)throw t;return C()}for(s.method=e,s.arg=t;;){var r=s.delegate;if(r){var i=M(r,s);if(i){if(i===m)continue;return i}}if("next"===s.method)s.sent=s._sent=s.arg;else if("throw"===s.method){if(l===h)throw l=f,s.arg;s.dispatchException(s.arg)}else"return"===s.method&&s.abrupt("return",s.arg);l=d;var n=b(o,a,s);if("normal"===n.type){if(l=s.done?f:p,n.arg===m)continue;return{value:n.arg,done:s.done}}"throw"===n.type&&(l=f,s.method="throw",s.arg=n.arg)}}),c}function b(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}function x(){}function E(){}function _(){}function w(e){["next","throw","return"].forEach(function(t){e[t]=function(e){return this._invoke(t,e)}})}function T(s){function l(e,t,r,i){var n=b(s[e],s,t);if("throw"!==n.type){var o=n.arg,a=o.value;return a&&"object"==typeof a&&c.call(a,"__await")?Promise.resolve(a.__await).then(function(e){l("next",e,r,i)},function(e){l("throw",e,r,i)}):Promise.resolve(a).then(function(e){o.value=e,r(o)},i)}i(n.arg)}var t;"object"==typeof e.process&&e.process.domain&&(l=e.process.domain.bind(l)),this._invoke=function(r,i){function e(){return new Promise(function(e,t){l(r,i,e,t)})}return t=t?t.then(e,e):e()}}function M(e,t){var r=e.iterator[t.method];if(r===l){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=l,M(e,t),"throw"===t.method))return m;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return m}var i=b(r,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,m;var n=i.arg;return n?n.done?(t[e.resultName]=n.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=l),t.delegate=null,m):n:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,m)}function S(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function R(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function P(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(S,this),this.reset(!0)}function A(t){if(t){var e=t[n];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,i=function e(){for(;++r<t.length;)if(c.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=l,e.done=!0,e};return i.next=i}}return{next:C}}function C(){return{value:l,done:!0}}}("object"==typeof t?t:"object"==typeof window?window:"object"==typeof self?self:t)});var Ho=r(function(L){!function(e){var l,t=Object.prototype,c=t.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",i=r.asyncIterator||"@@asyncIterator",o=r.toStringTag||"@@toStringTag",a=e.regeneratorRuntime;if(a)L.exports=a;else{(a=e.regeneratorRuntime=L.exports).wrap=y;var h="suspendedStart",p="suspendedYield",d="executing",f="completed",m={},s={};s[n]=function(){return this};var u=Object.getPrototypeOf,g=u&&u(u(A([])));g&&g!==t&&c.call(g,n)&&(s=g);var v=_.prototype=x.prototype=Object.create(s);E.prototype=v.constructor=_,_.constructor=E,_[o]=E.displayName="GeneratorFunction",a.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===E||"GeneratorFunction"===(t.displayName||t.name))},a.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,_):(e.__proto__=_,o in e||(e[o]="GeneratorFunction")),e.prototype=Object.create(v),e},a.awrap=function(e){return{__await:e}},w(T.prototype),T.prototype[i]=function(){return this},a.AsyncIterator=T,a.async=function(e,t,r,i){var n=new T(y(e,t,r,i));return a.isGeneratorFunction(t)?n:n.next().then(function(e){return e.done?e.value:n.next()})},w(v),v[o]="Generator",v[n]=function(){return this},v.toString=function(){return"[object Generator]"},a.keys=function(r){var i=[];for(var e in r)i.push(e);return i.reverse(),function e(){for(;i.length;){var t=i.pop();if(t in r)return e.value=t,e.done=!1,e}return e.done=!0,e}},a.values=A,P.prototype={constructor:P,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=l,this.done=!1,this.delegate=null,this.method="next",this.arg=l,this.tryEntries.forEach(R),!e)for(var t in this)"t"===t.charAt(0)&&c.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=l)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(r){if(this.done)throw r;var i=this;function e(e,t){return o.type="throw",o.arg=r,i.next=e,t&&(i.method="next",i.arg=l),!!t}for(var t=this.tryEntries.length-1;0<=t;--t){var n=this.tryEntries[t],o=n.completion;if("root"===n.tryLoc)return e("end");if(n.tryLoc<=this.prev){var a=c.call(n,"catchLoc"),s=c.call(n,"finallyLoc");if(a&&s){if(this.prev<n.catchLoc)return e(n.catchLoc,!0);if(this.prev<n.finallyLoc)return e(n.finallyLoc)}else if(a){if(this.prev<n.catchLoc)return e(n.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<n.finallyLoc)return e(n.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;0<=r;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&c.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var n=i;break}}n&&("break"===e||"continue"===e)&&n.tryLoc<=t&&t<=n.finallyLoc&&(n=null);var o=n?n.completion:{};return o.type=e,o.arg=t,n?(this.method="next",this.next=n.finallyLoc,m):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),R(r),m}},catch:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var i=r.completion;if("throw"===i.type){var n=i.arg;R(r)}return n}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:A(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=l),m}}}function y(e,t,r,i){var o,a,s,l,n=t&&t.prototype instanceof x?t:x,c=Object.create(n.prototype),u=new P(i||[]);return c._invoke=(o=e,a=r,s=u,l=h,function(e,t){if(l===d)throw new Error("Generator is already running");if(l===f){if("throw"===e)throw t;return C()}for(s.method=e,s.arg=t;;){var r=s.delegate;if(r){var i=M(r,s);if(i){if(i===m)continue;return i}}if("next"===s.method)s.sent=s._sent=s.arg;else if("throw"===s.method){if(l===h)throw l=f,s.arg;s.dispatchException(s.arg)}else"return"===s.method&&s.abrupt("return",s.arg);l=d;var n=b(o,a,s);if("normal"===n.type){if(l=s.done?f:p,n.arg===m)continue;return{value:n.arg,done:s.done}}"throw"===n.type&&(l=f,s.method="throw",s.arg=n.arg)}}),c}function b(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}function x(){}function E(){}function _(){}function w(e){["next","throw","return"].forEach(function(t){e[t]=function(e){return this._invoke(t,e)}})}function T(l){var t;this._invoke=function(r,i){function e(){return new Promise(function(e,t){!function t(e,r,i,n){var o=b(l[e],l,r);if("throw"!==o.type){var a=o.arg,s=a.value;return s&&"object"==typeof s&&c.call(s,"__await")?Promise.resolve(s.__await).then(function(e){t("next",e,i,n)},function(e){t("throw",e,i,n)}):Promise.resolve(s).then(function(e){a.value=e,i(a)},n)}n(o.arg)}(r,i,e,t)})}return t=t?t.then(e,e):e()}}function M(e,t){var r=e.iterator[t.method];if(r===l){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=l,M(e,t),"throw"===t.method))return m;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return m}var i=b(r,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,m;var n=i.arg;return n?n.done?(t[e.resultName]=n.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=l),t.delegate=null,m):n:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,m)}function S(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function R(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function P(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(S,this),this.reset(!0)}function A(t){if(t){var e=t[n];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,i=function e(){for(;++r<t.length;)if(c.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=l,e.done=!0,e};return i.next=i}}return{next:C}}function C(){return{value:l,done:!0}}}(function(){return this}()||Function("return this")())}),Fo=function(){return this}()||Function("return this")(),ko=Fo.regeneratorRuntime&&0<=Object.getOwnPropertyNames(Fo).indexOf("regeneratorRuntime"),Io=ko&&Fo.regeneratorRuntime;Fo.regeneratorRuntime=void 0;var jo=Ho;if(ko)Fo.regeneratorRuntime=Io;else try{delete Fo.regeneratorRuntime}catch(e){Fo.regeneratorRuntime=void 0}var No=jo,Do="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Uo=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},Vo=function e(t,r,i,n){Uo(this,e),this.positionArray=t.geometry.getAttribute("position").array.slice();var o=t.geometry.getAttribute("normal");o?this.normalArray=o.array.slice():console.warn("not has normal");var a=t.geometry.getAttribute("uv");a&&(this.uvArray=a.array);var s=t.geometry.getAttribute("uv2");s&&(this.uv2Array=s.array);var l=t.geometry.getAttribute("uv3");l&&(this.uv3Array=l.array);var c=t.geometry.getAttribute("color");c&&(this.colorArray=c.array),this.indexArray=t.geometry.index.array,this.material=t.material;for(var u=this.positionArray,h=this.normalArray,p=0;p<u.length;){for(var d=n.length-1;-1<d;d--){var f=r[d],m=i[d],g=n[d];u[p]*=f.x,u[p+1]*=f.y,u[p+2]*=f.z;var v=new THREE.Vector3(u[p],u[p+1],u[p+2]);if((v=v.applyQuaternion(m)).x+=g.x,v.y+=g.y,v.z+=g.z,u[p]=v.x,u[p+1]=v.y,u[p+2]=v.z,h){var y=new THREE.Vector3(h[p],h[p+1],h[p+2]);y=y.applyQuaternion(m),h[p]=y.x,h[p+1]=y.y,h[p+2]=y.z}}p+=3}this.vertexCount=this.positionArray.length/3,this.indexCount=this.indexArray.length,this.groups=t.geometry.groups},Bo=function(){function t(e){Uo(this,t),this.bundeObj=e,this.materialMap=new Map,this.combineBundleMeshs=[]}return t.prototype.combine=function(){this._combine(this.bundeObj,[],[],[])},t.prototype._combine=function(e,t,r,i){if(t.push(e.scale),i.push(e.position),r.push(e.quaternion),e instanceof THREE.Mesh){var n=new Vo(e,t,r,i);this.combineBundleMeshs.push(n),void 0===this.materialMap.get(n.material)&&this.materialMap.set(n.material,[]),this.materialMap.get(n.material).push(n)}if(0!=e.children.length)for(var o=0;o<e.children.length;o++){var a=r.slice(),s=t.slice(),l=i.slice();this._combine(e.children[o],s,a,l)}},t}(),zo=function e(){Uo(this,e),this.positions=[],this.scales=[],this.quaternions=[]},qo=function(){function i(){Uo(this,i)}return i.equalVectorZero=function(e){return 0===e.x&&0===e.y&&0===e.z},i.clone=function(e){var t=e.clone(),r={};e.traverse(function(e){e.isSkinnedMesh&&(r[e.name]=e)});var i={},n={};t.traverse(function(e){e.isBone&&(i[e.name]=e),e.isSkinnedMesh&&(n[e.name]=e)});var o=!1;for(var a in r){o=!0;for(var s=r[a].skeleton,l=n[a],c=[],u=0;u<s.bones.length;++u){var h=i[s.bones[u].name];c.push(h)}l.bind(new THREE.Skeleton(c,s.boneInverses),l.matrixWorld)}return t.hasSkin=!!o,t},i.cloneJSObject=function(e){if(null===e||"object"!==(void 0===e?"undefined":Do(e)))return e;if(e instanceof Date)return(t=new Date).setTime(e.getTime()),t;if(e instanceof Array|e instanceof Object){var t=e instanceof Array?[]:{};for(var r in e)e.hasOwnProperty(r)&&(t[r]=i.cloneJSObject(e[r]));return t}throw new Error("Unable to clone obj! Its type isn't supported.")},i}(),Go=function(){function t(e){Uo(this,t),this.vertexCount=0,this.indexCount=0,this.material=e,this.bundeMeshs=[],this.transformations=[],this.maxCount=6e4,this.combineMesh=null}return t.prototype.cloneGroups=function(e){for(var t=[],r=0;r<e.length;r++){var i=e[r];t.push(qo.cloneJSObject(i))}return t},t.prototype.isExceed=function(e){return this.vertexCount+e>this.maxCount},t.prototype.add=function(e,t){if(this.isExceed(e.vertexCount))return console.error("combine exceed vertex count "),!1;this.vertexCount+=e.vertexCount,this.indexCount+=e.indexCount,this.bundeMeshs.push(e),this.transformations.push(t)},t.prototype.build=function(){for(var e=this.bundeMeshs,t=this.indexCount,r=this.vertexCount,i=[],n=new Float32Array(3*r),o=new Float32Array(3*r),a=new Float32Array(2*r),s=new Float32Array(4*r),l=new Float32Array(2*r),c=new Uint16Array(t),u=0,h=0,p=0,d=0,f=0,m=new THREE.BufferGeometry,g=0,v=0;v<e.length;v++){var y=e[v],b=this.transformations[v],x=b.positions,E=b.scales,_=b.quaternions,w=y.indexArray;if(0<y.groups.length){var T=this.cloneGroups(y.groups);T.forEach(function(e){e.start+=g}),i=i.concat(T)}g+=w.length;for(var M=0;M<w.length;M++)c[M+d]=u/3+w[M];d+=w.length;var S=y.positionArray;for(M=0;M<S.length;){for(var R=new THREE.Vector3(S[M],S[M+1],S[M+2]),P=x.length-1;-1<P;P--){var A=x[P],C=E[P],L=_[P];R.x*=C.x,R.y*=C.y,R.z*=C.z,(R=R.applyQuaternion(L)).x+=A.x,R.y+=A.y,R.z+=A.z}n[M+u]=R.x,n[M+u+1]=R.y,n[M+u+2]=R.z,M+=3}u+=S.length;var O=y.normalArray;for(M=0;M<O.length;M++)o[M+h]=O[M];h+=O.length;var H=y.uvArray;if(H)for(M=0;M<H.length;M++)a[M+p]=H[M];var F=y.uv2Array;if(F)for(M=0;M<F.length;M++)l[M+p]=F[M];H&&(p+=H.length);var k=y.colorArray;if(k){for(M=0;M<k.length;M++)s[M+f]=k[M];f+=k.length}}m.addAttribute("position",new THREE.BufferAttribute(n,3)),m.addAttribute("normal",new THREE.BufferAttribute(o,3)),m.addAttribute("uv",new THREE.BufferAttribute(a,2)),0!==l.length&&m.addAttribute("uv2",new THREE.BufferAttribute(l,2)),0!==s.length&&m.addAttribute("color",new THREE.BufferAttribute(s,4)),m.setIndex(new THREE.BufferAttribute(c,1)),m.groups=i;var I=new THREE.Mesh(m,this.material);I.name="combine",this.combineMesh=I},t}(),Wo=function(){function e(){Uo(this,e),this.combineBundleObjectMap={},this.processorMap=new Map,this.packageMaterialMap=new Map,this.processors=[],this.defaultKey="default",this.loadSpeed=.1,this.combineMeshs=[]}return e.prototype.generateUUID=function(){var t,r="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),i=new Array(36),n=0;return function(){for(var e=0;e<36;e++)i[e]=8===e||13===e||18===e||23===e?"-":14===e?"4":(n<=2&&(n=33554432+16777216*Math.random()|0),t=15&n,n>>=4,r[19===e?3&t|8:t]);return i.join("")}()},e.prototype.combineModel=function(e,t){if(!this.combineBundleObjectMap[e]){var r=t.position.clone(),i=t.scale.clone(),n=t.quaternion.clone();t.position.set(0,0,0),t.scale.set(1,1,1),t.quaternion.set(0,0,0,1);var o=new Bo(t);(this.combineBundleObjectMap[e]=o).combine(),t.position.set(r.x,r.y,r.z),t.scale.set(i.x,i.y,i.z),t.quaternion.set(n.x,n.y,n.z,n.w)}},e.prototype._nestingLoopYield=function(t,r,i){var n=this,e=t.next();if(e.done)return r&&r(),e.value;var o=e.value;e.done;o instanceof Promise?o.then(function(e){return n._nestingLoopYield(t,r,i)}).catch(function(e){i(e)}):this._nestingLoopYield(t,r,i)},e.prototype.delayBuild=function(h){var e=No.mark(i),p=this;function i(t){var o,a,r,i,n,s,l,c,u;return No.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:o=p.loadSpeed,a=10,r=t.keys(),i=Array.isArray(r),n=0,r=i?r:r[Symbol.iterator]();case 3:if(!i){e.next=9;break}if(n>=r.length)return e.abrupt("break",24);e.next=6;break;case 6:s=r[n++],e.next=13;break;case 9:if((n=r.next()).done)return e.abrupt("break",24);e.next=12;break;case 12:s=n.value;case 13:l=s,c=t.get(l),u=0;case 16:if(u<c.length)return e.next=19,new Promise(function(e,t){var r=performance.now();c[u].build();var i=c[u].combineMesh;h&&h(i),p.combineMeshs.push(i);var n=performance.now()-r;o<n?setTimeout(function(){e()},a):e()});e.next=22;break;case 19:u++,e.next=16;break;case 22:e.next=3;break;case 24:case"end":return e.stop()}},e,this)}return new Promise(function(e,t){var r=i(p.processorMap);r?p._nestingLoopYield(r,function(){e()},function(e){t(e)}):e()})},e.prototype.build=function(){var e=this.processorMap.keys(),t=Array.isArray(e),r=0;for(e=t?e:e[Symbol.iterator]();;){var i;if(t){if(r>=e.length)break;i=e[r++]}else{if((r=e.next()).done)break;i=r.value}for(var n=i,o=this.processorMap.get(n),a=0;a<o.length;a++)o[a].build(),this.combineMeshs.push(o[a].combineMesh)}},e.prototype.addModel=function(e,t){var r=null,i=this.defaultKey;t&&(t.modelLibID&&(r=t.modelLibID),t.packageKey&&(i=t.packageKey)),r||(r=this.generateUUID()),this.combineModel(r,e);var l=this.packageMaterialMap.get(i);l||(l=new Map,this.packageMaterialMap.set(i,l));var c=this.processorMap.get(i);c||(this.processorMap.set(i,[]),c=this.processorMap.get(i));var u=new zo;u.positions=[e.position],u.scales=[e.scale],u.quaternions=[e.quaternion],this.combineBundleObjectMap[r].materialMap.forEach(function(e,t,r){for(var i=e,n=t,o=0;o<i.length;o++){var a=i[o],s=l.get(n);s&&!s.isExceed(a.vertexCount)||(s=new Go(n),l.set(n,s),c.push(s)),s.add(a,u)}})},e}();e.Processor=Wo,Object.defineProperty(e,"__esModule",{value:!0})}),function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).EarCut=e()}}(function(){return function o(a,s,l){function c(t,e){if(!s[t]){if(!a[t]){var r="function"==typeof require&&require;if(!e&&r)return r(t,!0);if(u)return u(t,!0);var i=new Error("Cannot find module '"+t+"'");throw i.code="MODULE_NOT_FOUND",i}var n=s[t]={exports:{}};a[t][0].call(n.exports,function(e){return c(a[t][1][e]||e)},n,n.exports,o,a,s,l)}return s[t].exports}for(var u="function"==typeof require&&require,e=0;e<l.length;e++)c(l[e]);return c}({1:[function(e,t,r){"use strict";function i(e,t,r){r=r||2;var i,n,o,a,s,l,c,u=t&&t.length,h=u?t[0]*r:e.length,p=m(e,0,h,r,!0),d=[];if(!p||p.next===p.prev)return d;if(u&&(p=function(e,t,r,i){var n,o,a,s,l,c=[];for(n=0,o=t.length;n<o;n++)a=t[n]*i,s=n<o-1?t[n+1]*i:e.length,(l=m(e,a,s,i,!1))===l.next&&(l.steiner=!0),c.push(E(l));for(c.sort(y),n=0;n<c.length;n++)b(c[n],r),r=g(r,r.next);return r}(e,t,p,r)),e.length>80*r){i=o=e[0],n=a=e[1];for(var f=r;f<h;f+=r)(s=e[f])<i&&(i=s),(l=e[f+1])<n&&(n=l),o<s&&(o=s),a<l&&(a=l);c=0!==(c=Math.max(o-i,a-n))?1/c:0}return v(p,d,r,i,n,c),d}function m(e,t,r,i,n){var o,a;if(n===0<R(e,t,r,i))for(o=t;o<r;o+=i)a=l(o,e[o],e[o+1],a);else for(o=r-i;t<=o;o-=i)a=l(o,e[o],e[o+1],a);return a&&s(a,a.next)&&(S(a),a=a.next),a}function g(e,t){if(!e)return e;t||(t=e);var r,i=e;do{if(r=!1,i.steiner||!s(i,i.next)&&0!==w(i.prev,i,i.next))i=i.next;else{if(S(i),(i=t=i.prev)===i.next)break;r=!0}}while(r||i!==t);return t}function v(e,t,r,i,n,o,a){if(e){!a&&o&&function(e,t,r,i){var n=e;for(;null===n.z&&(n.z=x(n.x,n.y,t,r,i)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next,n!==e;);n.prevZ.nextZ=null,n.prevZ=null,function(e){var t,r,i,n,o,a,s,l,c=1;do{for(r=e,o=e=null,a=0;r;){for(a++,i=r,t=s=0;t<c&&(s++,i=i.nextZ);t++);for(l=c;0<s||0<l&&i;)0!==s&&(0===l||!i||r.z<=i.z)?(r=(n=r).nextZ,s--):(i=(n=i).nextZ,l--),o?o.nextZ=n:e=n,n.prevZ=o,o=n;r=i}o.nextZ=null,c*=2}while(1<a)}(n)}(e,i,n,o);for(var s,l,c=e;e.prev!==e.next;)if(s=e.prev,l=e.next,o?h(e,i,n,o):u(e))t.push(s.i/r),t.push(e.i/r),t.push(l.i/r),S(e),e=l.next,c=l.next;else if((e=l)===c){a?1===a?v(e=p(e,t,r),t,r,i,n,o,2):2===a&&d(e,t,r,i,n,o):v(g(e),t,r,i,n,o,1);break}}}function u(e){var t=e.prev,r=e,i=e.next;if(0<=w(t,r,i))return!1;for(var n=e.next.next;n!==e.prev;){if(_(t.x,t.y,r.x,r.y,i.x,i.y,n.x,n.y)&&0<=w(n.prev,n,n.next))return!1;n=n.next}return!0}function h(e,t,r,i){var n=e.prev,o=e,a=e.next;if(0<=w(n,o,a))return!1;for(var s=n.x<o.x?n.x<a.x?n.x:a.x:o.x<a.x?o.x:a.x,l=n.y<o.y?n.y<a.y?n.y:a.y:o.y<a.y?o.y:a.y,c=n.x>o.x?n.x>a.x?n.x:a.x:o.x>a.x?o.x:a.x,u=n.y>o.y?n.y>a.y?n.y:a.y:o.y>a.y?o.y:a.y,h=x(s,l,t,r,i),p=x(c,u,t,r,i),d=e.prevZ,f=e.nextZ;d&&d.z>=h&&f&&f.z<=p;){if(d!==e.prev&&d!==e.next&&_(n.x,n.y,o.x,o.y,a.x,a.y,d.x,d.y)&&0<=w(d.prev,d,d.next))return!1;if(d=d.prevZ,f!==e.prev&&f!==e.next&&_(n.x,n.y,o.x,o.y,a.x,a.y,f.x,f.y)&&0<=w(f.prev,f,f.next))return!1;f=f.nextZ}for(;d&&d.z>=h;){if(d!==e.prev&&d!==e.next&&_(n.x,n.y,o.x,o.y,a.x,a.y,d.x,d.y)&&0<=w(d.prev,d,d.next))return!1;d=d.prevZ}for(;f&&f.z<=p;){if(f!==e.prev&&f!==e.next&&_(n.x,n.y,o.x,o.y,a.x,a.y,f.x,f.y)&&0<=w(f.prev,f,f.next))return!1;f=f.nextZ}return!0}function p(e,t,r){var i=e;do{var n=i.prev,o=i.next.next;!s(n,o)&&f(n,i,i.next,o)&&T(n,o)&&T(o,n)&&(t.push(n.i/r),t.push(i.i/r),t.push(o.i/r),S(i),S(i.next),i=e=o),i=i.next}while(i!==e);return i}function d(e,t,r,i,n,o){var a,s,l=e;do{for(var c=l.next.next;c!==l.prev;){if(l.i!==c.i&&(s=c,(a=l).next.i!==s.i&&a.prev.i!==s.i&&!function(e,t){var r=e;do{if(r.i!==e.i&&r.next.i!==e.i&&r.i!==t.i&&r.next.i!==t.i&&f(r,r.next,e,t))return!0;r=r.next}while(r!==e);return!1}(a,s)&&T(a,s)&&T(s,a)&&function(e,t){var r=e,i=!1,n=(e.x+t.x)/2,o=(e.y+t.y)/2;for(;r.y>o!=r.next.y>o&&r.next.y!==r.y&&n<(r.next.x-r.x)*(o-r.y)/(r.next.y-r.y)+r.x&&(i=!i),r=r.next,r!==e;);return i}(a,s))){var u=M(l,c);return l=g(l,l.next),u=g(u,u.next),v(l,t,r,i,n,o),void v(u,t,r,i,n,o)}c=c.next}l=l.next}while(l!==e)}function y(e,t){return e.x-t.x}function b(e,t){if(t=function(e,t){var r,i=t,n=e.x,o=e.y,a=-1/0;do{if(o<=i.y&&o>=i.next.y&&i.next.y!==i.y){var s=i.x+(o-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(s<=n&&a<s){if((a=s)===n){if(o===i.y)return i;if(o===i.next.y)return i.next}r=i.x<i.next.x?i:i.next}}i=i.next}while(i!==t);if(!r)return null;if(n===a)return r.prev;var l,c=r,u=r.x,h=r.y,p=1/0;i=r.next;for(;i!==c;)n>=i.x&&i.x>=u&&n!==i.x&&_(o<h?n:a,o,u,h,o<h?a:n,o,i.x,i.y)&&((l=Math.abs(o-i.y)/(n-i.x))<p||l===p&&i.x>r.x)&&T(i,e)&&(r=i,p=l),i=i.next;return r}(e,t)){var r=M(t,e);g(r,r.next)}}function x(e,t,r,i,n){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*n)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*n)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function E(e){for(var t=e,r=e;(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),(t=t.next)!==e;);return r}function _(e,t,r,i,n,o,a,s){return 0<=(n-a)*(t-s)-(e-a)*(o-s)&&0<=(e-a)*(i-s)-(r-a)*(t-s)&&0<=(r-a)*(o-s)-(n-a)*(i-s)}function w(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function s(e,t){return e.x===t.x&&e.y===t.y}function f(e,t,r,i){return!!(s(e,r)&&s(t,i)||s(e,i)&&s(r,t))||0<w(e,t,r)!=0<w(e,t,i)&&0<w(r,i,e)!=0<w(r,i,t)}function T(e,t){return w(e.prev,e,e.next)<0?0<=w(e,t,e.next)&&0<=w(e,e.prev,t):w(e,t,e.prev)<0||w(e,e.next,t)<0}function M(e,t){var r=new a(e.i,e.x,e.y),i=new a(t.i,t.x,t.y),n=e.next,o=t.prev;return(e.next=t).prev=e,(r.next=n).prev=r,(i.next=r).prev=i,(o.next=i).prev=o,i}function l(e,t,r,i){var n=new a(e,t,r);return i?(n.next=i.next,(n.prev=i).next.prev=n,i.next=n):(n.prev=n).next=n,n}function S(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function a(e,t,r){this.i=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function R(e,t,r,i){for(var n=0,o=t,a=r-i;o<r;o+=i)n+=(e[a]-e[o])*(e[o+1]+e[a+1]),a=o;return n}t.exports=i,(t.exports.default=i).deviation=function(e,t,r,i){var n=t&&t.length,o=n?t[0]*r:e.length,a=Math.abs(R(e,0,o,r));if(n)for(var s=0,l=t.length;s<l;s++){var c=t[s]*r,u=s<l-1?t[s+1]*r:e.length;a-=Math.abs(R(e,c,u,r))}var h=0;for(s=0;s<i.length;s+=3){var p=i[s]*r,d=i[s+1]*r,f=i[s+2]*r;h+=Math.abs((e[p]-e[f])*(e[d+1]-e[p+1])-(e[p]-e[d])*(e[f+1]-e[p+1]))}return 0===a&&0===h?0:Math.abs((h-a)/a)},i.flatten=function(e){for(var t=e[0][0].length,r={vertices:[],holes:[],dimensions:t},i=0,n=0;n<e.length;n++){for(var o=0;o<e[n].length;o++)for(var a=0;a<t;a++)r.vertices.push(e[n][o][a]);0<n&&(i+=e[n-1].length,r.holes.push(i))}return r}},{}]},{},[1])(1)});var Graph=function(e){var y=function(e){var t,r=[];for(t in e)Object.prototype.hasOwnProperty.call(e,t)&&r.push(t);return r},b=function(e,t){return parseFloat(e)-parseFloat(t)},s=function(e,t,r,i){i=i||1/0;var n,o,a,s={},l={0:[t]},c={};for(s[t]=0;l&&(n=y(l)).length;){n.sort(b);var u=n[0],h=l[u],p=h.shift(),d=parseFloat(u),f=e[p]||{};for(var m in h.length||delete l[u],f)if(Object.prototype.hasOwnProperty.call(f,m)){var g=f[m]+d,v=s[m];(void 0===v||g<v)&&(s[m]=g,o=m,void 0,l[a=""+g]||(l[a]=[]),l[a].push(o),c[m]=p)}}return void 0===s[r]?null:c},l=function(e,t){for(var r=[],i=t;void 0!==i;)r.push(i),i=e[i];return r.reverse(),r},i=function(e,t){for(var r,i,n,o=t.shift(),a=[];t.length;){if(r=t.shift(),!(i=s(e,o,r)))return null;if(n=l(i,r),!t.length)return a.concat(n);a.push.apply(a,n.slice(0,-1)),o=r}},n=function(t,r){try{return Array.prototype.slice.call(t,r)}catch(e){for(var i=[],n=r||0,o=t.length;n<o;++n)i.push(t[n]);return i}},t=function(e){this.map=e};return t.prototype.findShortestPath=function(e,t){return"[object Array]"===Object.prototype.toString.call(e)?i(this.map,e):2===arguments.length?i(this.map,[e,t]):i(this.map,n(arguments))},t.findShortestPath=function(e,t,r){return"[object Array]"===Object.prototype.toString.call(t)?i(e,t):3===arguments.length?i(e,[t,r]):i(e,n(arguments,1))},t}(),MSPE={distributions:{BOX:1,SPHERE:2,DISC:3},valueOverLifetimeLength:4};function SimpleHeatmap(e){this._canvas="string"==typeof e?document.getElementById(e):e,void 0===this._canvas&&(this._canvas=document.createElement("canvas"),this._canvas.width=128,this._canvas.height=128),this._ctx=this._canvas.getContext("2d"),this._max=1,this._min=0,this._dataDirty=!0,this._data=[],this._transformedData=[],this._canvasWidth=this._areaWidth=this._canvas.width,this._canvasHeight=this._areaHeight=this._canvas.height,this._alpha=!1,this._grad={};var t=this._createCanvas();t.width=1,t.height=256,this._gradCtx=t.getContext("2d"),this._gradCache={},this._gradData=null,this._r=0,this._radius=0,this._blur=0,this._circle=this._createCanvas(),this._cirCtx=this._circle.getContext("2d")}"function"==typeof define&&define.amd?define("spe",MSPE):"undefined"!=typeof exports&&"undefined"!=typeof module&&(module.exports=MSPE),MSPE.shaderChunks={defines:[].join("\n"),uniforms:["uniform sampler2D tex;"].join("\n"),attributes:["attribute vec3 mcol0;","attribute vec3 mcol1;","attribute vec3 mcol2;","attribute vec3 mcol3;","attribute vec4 color;"].join("\n"),varyings:["varying vec2 vUv;","varying vec4 varyColor;"].join("\n")},MSPE.shaders={vertex:[MSPE.shaderChunks.uniforms,MSPE.shaderChunks.attributes,MSPE.shaderChunks.varyings,"void main()","{","\tmat4 matrix = mat4(","\t\tvec4( mcol0, 0 ),","\t\tvec4( mcol1, 0 ),","\t\tvec4( mcol2, 0 ),","\t\tvec4( mcol3, 1 )","\t);","\tvaryColor = color;","\tvec3 positionEye = ( modelViewMatrix * matrix * vec4( position, 1.0 ) ).xyz;","   vUv = vec2( uv.x, uv.y );","\tgl_Position = projectionMatrix * vec4( positionEye, 1.0 );","}"].join("\n"),fragment:[MSPE.shaderChunks.uniforms,MSPE.shaderChunks.varyings,"void main() {","    gl_FragColor = varyColor * texture2D(tex, vUv);",THREE.ShaderChunk.fog_fragment,"}"].join("\n")},MSPE.utils={types:{BOOLEAN:"boolean",STRING:"string",NUMBER:"number",OBJECT:"object"},ensureTypedArg:function(e,t,r){"use strict";return typeof e===t?e:r},ensureArrayTypedArg:function(e,t,r){"use strict";if(Array.isArray(e)){for(var i=e.length-1;0<=i;--i)if(typeof e[i]!==t)return r;return e}return this.ensureTypedArg(e,t,r)},ensureInstanceOf:function(e,t,r){"use strict";return void 0!==t&&e instanceof t?e:r},ensureArrayInstanceOf:function(e,t,r){"use strict";if(Array.isArray(e)){for(var i=e.length-1;0<=i;--i)if(void 0!==t&&e[i]instanceof t==!1)return r;return e}return this.ensureInstanceOf(e,t,r)},ensureValueOverLifetimeCompliance:function(e,t,r){"use strict";t=t||3,r=r||3,!1===Array.isArray(e._value)&&(e._value=[e._value]),!1===Array.isArray(e._spread)&&(e._spread=[e._spread]);var i=this.clamp(e._value.length,t,r),n=this.clamp(e._spread.length,t,r),o=Math.max(i,n);e._value.length!==o&&(e._value=this.interpolateArray(e._value,o)),e._spread.length!==o&&(e._spread=this.interpolateArray(e._spread,o))},interpolateArray:function(e,t){"use strict";for(var r=e.length,i=["function"==typeof e[0].clone?e[0].clone():e[0]],n=(r-1)/(t-1),o=1;o<t-1;++o){var a=o*n,s=Math.floor(a),l=Math.ceil(a),c=a-s;i[o]=this.lerpTypeAgnostic(e[s],e[l],c)}return i.push("function"==typeof e[r-1].clone?e[r-1].clone():e[r-1]),i},clamp:function(e,t,r){"use strict";return Math.max(t,Math.min(e,r))},zeroToEpsilon:function(e,t){"use strict";var r=e;return r=t?1e-5*Math.random()*10:1e-5,e<0&&-1e-5<e&&(r=-r),r},lerpTypeAgnostic:function(e,t,r){"use strict";var i,n=this.types;return typeof e==n.NUMBER&&typeof t==n.NUMBER?e+(t-e)*r:e instanceof THREE.Vector2&&t instanceof THREE.Vector2||typeof e.x==n.NUMBER&&typeof e.y==n.NUMBER&&null==e.z&&null==e.z&&typeof t.x==n.NUMBER&&typeof t.y==n.NUMBER&&null==t.z&&null==t.z?(e instanceof THREE.Vector2?i=e.clone():((i={}).x=e.x,i.y=e.y),i.x=this.lerp(e.x,t.x,r),i.y=this.lerp(e.y,t.y,r),i):e instanceof THREE.Vector3&&t instanceof THREE.Vector3||typeof e.x==n.NUMBER&&typeof e.y==n.NUMBER&&typeof e.z==n.NUMBER&&null==e.w&&null==e.w&&typeof t.x==n.NUMBER&&typeof t.y==n.NUMBER&&typeof t.z==n.NUMBER&&null==t.w&&null==t.w?(e instanceof THREE.Vector3?i=e.clone():((i={}).x=e.x,i.y=e.y,i.z=e.z),i.x=this.lerp(e.x,t.x,r),i.y=this.lerp(e.y,t.y,r),i.z=this.lerp(e.z,t.z,r),i):e instanceof THREE.Vector4&&t instanceof THREE.Vector4||typeof e.x==n.NUMBER&&typeof e.y==n.NUMBER&&typeof e.z==n.NUMBER&&typeof e.w==n.NUMBER&&typeof t.x==n.NUMBER&&typeof t.y==n.NUMBER&&typeof t.z==n.NUMBER&&typeof t.w==n.NUMBER?(e instanceof THREE.Vector4?i=e.clone():((i={}).x=e.x,i.y=e.y,i.z=e.z,i.w=e.w),i.x=this.lerp(e.x,t.x,r),i.y=this.lerp(e.y,t.y,r),i.z=this.lerp(e.z,t.z,r),i.w=this.lerp(e.w,t.w,r),i):e instanceof THREE.Color&&t instanceof THREE.Color||typeof e.r==n.NUMBER&&typeof e.g==n.NUMBER&&typeof e.b==n.NUMBER&&typeof t.r==n.NUMBER&&typeof t.g==n.NUMBER&&typeof t.b==n.NUMBER?(e instanceof THREE.Color?i=e.clone():((i={}).r=e.r,i.g=e.g,i.b=e.b),i.r=this.lerp(e.r,t.r,r),i.g=this.lerp(e.g,t.g,r),i.b=this.lerp(e.b,t.b,r),i):void console.warn("Invalid argument types, or argument types do not match:",e,t)},lerp:function(e,t,r){"use strict";return e+(t-e)*r},roundToNearestMultiple:function(e,t){"use strict";var r;return 0===t?e:0===(r=Math.abs(e)%t)?e:e<0?-(Math.abs(e)-r):e+t-r},arrayValuesAreEqual:function(e){"use strict";for(var t=0;t<e.length-1;++t)if(e[t]!==e[t+1])return!1;return!0},randomFloat:function(e,t){"use strict";return e+t*(Math.random()-.5)},randomVector3:function(e,t,r,i,n){"use strict";var o=r.x+(Math.random()*i.x-.5*i.x),a=r.y+(Math.random()*i.y-.5*i.y),s=r.z+(Math.random()*i.z-.5*i.z);n&&(o=.5*-n.x+this.roundToNearestMultiple(o,n.x),a=.5*-n.y+this.roundToNearestMultiple(a,n.y),s=.5*-n.z+this.roundToNearestMultiple(s,n.z)),e.typedArray.setVec3Components(t,o,a,s)},getRandomVector3:function(e,t,r){"use strict";var i=e.x+(Math.random()*t.x-.5*t.x),n=e.y+(Math.random()*t.y-.5*t.y),o=e.z+(Math.random()*t.z-.5*t.z);return r&&(i=.5*-r.x+this.roundToNearestMultiple(i,r.x),n=.5*-r.y+this.roundToNearestMultiple(n,r.y),o=.5*-r.z+this.roundToNearestMultiple(o,r.z)),new THREE.Vector3(i,n,o)},randomColor:function(e,t,r,i){"use strict";var n=r.r+Math.random()*i.x,o=r.g+Math.random()*i.y,a=r.b+Math.random()*i.z;n=this.clamp(n,0,1),o=this.clamp(o,0,1),a=this.clamp(a,0,1),e.typedArray.setVec3Components(t,n,o,a)},randomColorAsHex:function(){"use strict";var l=new THREE.Color;return function(e,t,r,i){for(var n=r.length,o=[],a=0;a<n;++a){var s=i[a];l.copy(r[a]),l.r+=Math.random()*s.x-.5*s.x,l.g+=Math.random()*s.y-.5*s.y,l.b+=Math.random()*s.z-.5*s.z,l.r=this.clamp(l.r,0,1),l.g=this.clamp(l.g,0,1),l.b=this.clamp(l.b,0,1),o.push(l.getHex())}e.typedArray.setVec4Components(t,o[0],o[1],o[2],o[3])}}(),getRandomColor:function(e,t){"use strict";for(var r=e.length,i=[],n=0;n<r;++n){var o=t[n],a=new THREE.Color;a.copy(e[n]),a.r+=Math.random()*o.x-.5*o.x,a.g+=Math.random()*o.y-.5*o.y,a.b+=Math.random()*o.z-.5*o.z,a.r=this.clamp(a.r,0,1),a.g=this.clamp(a.g,0,1),a.b=this.clamp(a.b,0,1),i.push(a)}return i},randomVector3OnSphere:function(e,t,r,i,n,o,a,s){"use strict";var l=2*Math.random()-1,c=6.2832*Math.random(),u=Math.sqrt(1-l*l),h=this.randomFloat(i,n),p=0,d=0,f=0;a&&(h=Math.round(h/a)*a),p=u*Math.cos(c)*h,d=u*Math.sin(c)*h,f=l*h,p*=o.x,d*=o.y,f*=o.z,p+=r.x,d+=r.y,f+=r.z,e.typedArray.setVec3Components(t,p,d,f)},getRandomVector3OnSphere:function(e,t,r,i,n,o){"use strict";var a=2*Math.random()-1,s=6.2832*Math.random(),l=Math.sqrt(1-a*a),c=this.randomFloat(t,r),u=0,h=0,p=0;return n&&(c=Math.round(c/n)*n),u=l*Math.cos(s)*c,h=l*Math.sin(s)*c,p=a*c,u*=i.x,h*=i.y,p*=i.z,u+=e.x,h+=e.y,p+=e.z,new THREE.Vector3(u,h,p)},seededRandom:function(e){var t=1e4*Math.sin(e);return t-(0|t)},randomVector3OnDisc:function(e,t,r,i,n,o,a){"use strict";var s=6.2832*Math.random(),l=Math.abs(this.randomFloat(i,n)),c=0,u=0,h=0;a&&(l=Math.round(l/a)*a),c=Math.cos(s)*l,u=Math.sin(s)*l,c*=o.x,u*=o.y,c+=r.x,u+=r.y,h+=r.z,e.typedArray.setVec3Components(t,c,u,h)},getRandomVector3OnDisc:function(e,t,r,i,n){"use strict";var o=6.2832*Math.random(),a=Math.abs(this.randomFloat(t,r)),s=0,l=0,c=0;return n&&(a=Math.round(a/n)*n),s=Math.cos(o)*a,l=Math.sin(o)*a,s*=i.x,l*=i.y,s+=e.x,l+=e.y,c+=e.z,new THREE.Vector3(s,l,c)},randomDirectionVector3OnSphere:function(){"use strict";var l=new THREE.Vector3;return function(e,t,r,i,n,o,a,s){l.copy(o),l.x-=r,l.y-=i,l.z-=n,l.normalize().multiplyScalar(-this.randomFloat(a,s)),e.typedArray.setVec3Components(t,l.x,l.y,l.z)}}(),getRandomDirectionVector3OnSphere:function(e,t,r){"use strict";var i=new THREE.Vector3;return i.copy(e),i.x-=this.randomFloat(0,1),i.y-=this.randomFloat(0,1),i.z-=this.randomFloat(0,1),i.normalize().multiplyScalar(-this.randomFloat(t,r)),i},getDirectionVector3OnSphere:function(e,t,r,i,n,o){"use strict";var a=new THREE.Vector3;a.copy(e),a.normalize().multiplyScalar(this.randomFloat(r,i));var s=this.getRandomVector3(n,o);return a.add(s),a},randomDirectionVector3OnDisc:function(){"use strict";var l=new THREE.Vector3;return function(e,t,r,i,n,o,a,s){l.copy(o),l.x-=r,l.y-=i,l.z-=n,l.normalize().multiplyScalar(-this.randomFloat(a,s)),e.typedArray.setVec3Components(t,l.x,l.y,0)}}(),getPackedRotationAxis:function(){"use strict";var r=new THREE.Vector3,i=new THREE.Vector3,n=new THREE.Color,o=new THREE.Vector3(1,1,1);return function(e,t){return r.copy(e).normalize(),i.copy(t).normalize(),r.x+=.5*-t.x+Math.random()*t.x,r.y+=.5*-t.y+Math.random()*t.y,r.z+=.5*-t.z+Math.random()*t.z,r.normalize().add(o).multiplyScalar(.5),n.setRGB(r.x,r.y,r.z),n.getHex()}}(),getRotationAxis:function(){"use strict";var r=new THREE.Vector3,i=new THREE.Vector3,n=(new THREE.Color,new THREE.Vector3(1,1,1));return function(e,t){return r.copy(e).normalize(),i.copy(t).normalize(),r.x+=.5*-t.x+Math.random()*t.x,r.y+=.5*-t.y+Math.random()*t.y,r.z+=.5*-t.z+Math.random()*t.z,r.normalize().add(n).multiplyScalar(.5),r}}(),setMatrix:function(){var n=new THREE.Quaternion;return function(e,t,r,i){n.setFromEuler(t,!1),i.compose(e,n,r)}}(),clock:function(){var e=new THREE.Clock;return function(){return e}}()},MSPE.Group=function(e){"use strict";var t=MSPE.utils,r=t.types;if((e=t.ensureTypedArg(e,r.OBJECT,{})).texture=t.ensureTypedArg(e.texture,r.OBJECT,{}),this.uuid=THREE.Math.generateUUID(),this.fixedTimeStep=t.ensureTypedArg(e.fixedTimeStep,r.NUMBER,.016),this.texture=t.ensureInstanceOf(e.texture.value,THREE.Texture,null),this.hasPerspective=t.ensureTypedArg(e.hasPerspective,r.BOOLEAN,!0),this.colorize=t.ensureTypedArg(e.colorize,r.BOOLEAN,!0),this.maxParticleCount=t.ensureTypedArg(e.maxParticleCount,r.NUMBER,1e3),this.vec4Quaternion=t.ensureInstanceOf(e.vec4Quaternion,THREE.Vector4,new THREE.Vector4(0,0,0,1)),this.vec4Quaternion=this.vec4Quaternion.normalize(),null==e.bufferGeometry||null==e.bufferGeometry||!(e.bufferGeometry instanceof THREE.BufferGeometry))return console.error("[MSPE.js] : [MSPE.Group] : error options.bufferGeometry!"),null;this.instancedBufferGeometry=null,this.mesh=null,this.materialList=[],this.geometryList=[],this.bufferGeometry=e.bufferGeometry,this.bufferGeometry=this.bufferGeometry.toNonIndexed(),this.bufferGeometry.computeBoundingBox(),this.geometryList.push(this.bufferGeometry),this.instancedBufferGeometry=new THREE.InstancedBufferGeometry,this.geometryList.push(this.instancedBufferGeometry);var i=this.bufferGeometry.attributes.position.clone();if(this.instancedBufferGeometry.addAttribute("position",i),null!=this.bufferGeometry.attributes.uv&&null!=this.bufferGeometry.attributes.uv){var n=this.bufferGeometry.attributes.uv.clone();this.instancedBufferGeometry.addAttribute("uv",n)}this.instanceBuffer=new THREE.InstancedInterleavedBuffer(new Float32Array(16*this.maxParticleCount),16,1).setDynamic(!0),this.mcol0=new THREE.InterleavedBufferAttribute(this.instanceBuffer,3,0),this.mcol1=new THREE.InterleavedBufferAttribute(this.instanceBuffer,3,3),this.mcol2=new THREE.InterleavedBufferAttribute(this.instanceBuffer,3,6),this.mcol3=new THREE.InterleavedBufferAttribute(this.instanceBuffer,3,9),this.colors=new THREE.InterleavedBufferAttribute(this.instanceBuffer,4,12);o=new THREE.Vector3(0,0,0),a=new THREE.Euler(0,0,0),s=new THREE.Quaternion,l=new THREE.Vector3(1,1,1);for(var o,a,s,l,c=new THREE.Matrix4,u=c.elements,h=0,p=this.mcol0.count;h<p;h++){var d=new THREE.Vector3(0,0,0),f=new THREE.Euler(0,0,0),m=new THREE.Vector3(0,0,0);t.setMatrix(d,f,m,c),this.mcol0.setXYZ(h,u[0],u[1],u[2]),this.mcol1.setXYZ(h,u[4],u[5],u[6]),this.mcol2.setXYZ(h,u[8],u[9],u[10]),this.mcol3.setXYZ(h,u[12],u[13],u[14]),this.colors.setXYZW(h,1,1,1,1)}this.instancedBufferGeometry.addAttribute("mcol0",this.mcol0),this.instancedBufferGeometry.addAttribute("mcol1",this.mcol1),this.instancedBufferGeometry.addAttribute("mcol2",this.mcol2),this.instancedBufferGeometry.addAttribute("mcol3",this.mcol3),this.instancedBufferGeometry.addAttribute("color",this.colors),this.blending=t.ensureTypedArg(e.blending,r.NUMBER,THREE.AdditiveBlending),this.transparent=t.ensureTypedArg(e.transparent,r.BOOLEAN,!0),this.alphaTest=parseFloat(t.ensureTypedArg(e.alphaTest,r.NUMBER,0)),this.depthWrite=t.ensureTypedArg(e.depthWrite,r.BOOLEAN,!1),this.depthTest=t.ensureTypedArg(e.depthTest,r.BOOLEAN,!0),this.fog=t.ensureTypedArg(e.fog,r.BOOLEAN,!0),this.scale=t.ensureTypedArg(e.scale,r.NUMBER,300),this.emitters=[],this.emitterIDs=[],this.particleCount=0,this.uniforms={tex:{type:"t",value:this.texture}},this.material=new THREE.ShaderMaterial({uniforms:this.uniforms,vertexShader:MSPE.shaders.vertex,fragmentShader:MSPE.shaders.fragment,blending:this.blending,transparent:this.transparent,alphaTest:this.alphaTest,depthWrite:this.depthWrite,depthTest:this.depthTest,fog:this.fog}),this.materialList.push(this.material),this.mesh=new THREE.Mesh(this.instancedBufferGeometry,this.material),this.bEnableTrail=t.ensureTypedArg(e.bEnableTrail,r.BOOLEAN,!1),this.bEnableTrail&&(this.textureTrail=t.ensureInstanceOf(e.textureTrail,THREE.Texture,null),null!=this.textureTrail&&null!=this.textureTrail||(console.error("[MSPE.js] : [MSPE.Group] : error options.textureTrail!"),this.textureTrail=this.texture),this.fTrailLife=parseFloat(t.ensureTypedArg(e.fTrailLife,r.NUMBER,1)),this.fTrailWidthStart=parseFloat(t.ensureTypedArg(e.fTrailWidthStart,r.NUMBER,1)),this.fTrailWidthEnd=parseFloat(t.ensureTypedArg(e.fTrailWidthEnd,r.NUMBER,1)))},MSPE.Group.constructor=MSPE.Group,MSPE.Group.prototype._updateDefines=function(){},MSPE.Group.prototype.addEmitter=function(e){"use strict";if(e instanceof MSPE.Emitter!=!1)if(-1<this.emitterIDs.indexOf(e.uuid))console.error("[MSPE.js] : [MSPE.Group] : [addEmitter] : Emitter already exists in this group. Will not add again.");else{if(null===e.group){var t,r=this.particleCount;return t=Math.min(r+e.particleCount,this.maxParticleCount),this.particleCount=t,e.particleCount=t-r,e.activationStart=r,e.activationEnd=e.activationStart+e.particleCount,e._calculatePPSValue(e.maxAge._value+e.maxAge._spread),e.attach(this),this.emitters.push(e),this.emitterIDs.push(e.uuid),this.material.needsUpdate=!0,this.instanceBuffer.needsUpdate=!0,this}console.error("[MSPE.js] : [MSPE.Group] : [addEmitter] : Emitter already belongs to another group. Will not add to requested group.")}else console.error("[MSPE.js] : [MSPE.Group] : [addEmitter] : emitter argument must be instance of MSPE.Emitter;")},MSPE.Group.prototype.removeEmitter=function(e){"use strict";var t=this.emitterIDs.indexOf(e.uuid);e instanceof MSPE.Emitter!=!1?-1!==t?(this.emitters[t].dispose(),this.emitters.splice(t,1),this.emitterIDs.splice(t,1),this.particleCount-=e.particleCount,this.material.needsUpdate=!0,this.instanceBuffer.needsUpdate=!0,e.group=null):console.error("[MSPE.js] : [MSPE.Group] : [removeEmitter] : Emitter does not exist in this group. Will not remove."):console.error("[MSPE.js] : [MSPE.Group] : [removeEmitter] : emitter argument must be instance of MSPE.Emitter;")},MSPE.Group.prototype.tick=function(e,t){"use strict";var r=this.emitters,i=r.length,n=e||this.fixedTimeStep;if(0!==i){for(var o=0;o<i;++o)r[o].tick(n,t);this.instanceBuffer.needsUpdate=!0}},MSPE.Group.prototype.dispose=function(){"use strict";return this.materialList.forEach(function(e){e.dispose()}),this.geometryList.forEach(function(e){e.dispose()}),this.materialList=[],this.geometryList=[],this},MSPE.Emitter=function(e){"use strict";var t=MSPE.utils,r=t.types,i=MSPE.valueOverLifetimeLength;for(var n in(e=t.ensureTypedArg(e,r.OBJECT,{})).position=t.ensureTypedArg(e.position,r.OBJECT,{}),e.velocity=t.ensureTypedArg(e.velocity,r.OBJECT,{}),e.acceleration=t.ensureTypedArg(e.acceleration,r.OBJECT,{}),e.radius=t.ensureTypedArg(e.radius,r.OBJECT,{}),e.drag=t.ensureTypedArg(e.drag,r.OBJECT,{}),e.rotation=t.ensureTypedArg(e.rotation,r.OBJECT,{}),e.color=t.ensureTypedArg(e.color,r.OBJECT,{}),e.opacity=t.ensureTypedArg(e.opacity,r.OBJECT,{}),e.size=t.ensureTypedArg(e.size,r.OBJECT,{}),e.angle=t.ensureTypedArg(e.angle,r.OBJECT,{}),e.wiggle=t.ensureTypedArg(e.wiggle,r.OBJECT,{}),e.maxAge=t.ensureTypedArg(e.maxAge,r.OBJECT,{}),this.uuid=THREE.Math.generateUUID(),this.type=t.ensureTypedArg(e.type,r.NUMBER,SPE.distributions.BOX),this.position={_value:t.ensureInstanceOf(e.position.value,THREE.Vector3,new THREE.Vector3),_spread:t.ensureInstanceOf(e.position.spread,THREE.Vector3,new THREE.Vector3),_spreadClamp:t.ensureInstanceOf(e.position.spreadClamp,THREE.Vector3,new THREE.Vector3),_distribution:t.ensureTypedArg(e.position.distribution,r.NUMBER,this.type),_randomise:t.ensureTypedArg(e.position.randomise,r.BOOLEAN,!1),_radius:t.ensureTypedArg(e.position.radius,r.NUMBER,10),_radiusScale:t.ensureInstanceOf(e.position.radiusScale,THREE.Vector3,new THREE.Vector3(1,1,1)),_distributionClamp:t.ensureTypedArg(e.position.distributionClamp,r.NUMBER,0)},this.velocity={_value:t.ensureInstanceOf(e.velocity.value,THREE.Vector3,new THREE.Vector3),_spread:t.ensureInstanceOf(e.velocity.spread,THREE.Vector3,new THREE.Vector3),_spreadClamp:t.ensureInstanceOf(e.velocity.spreadClamp,THREE.Vector3,new THREE.Vector3),_distribution:t.ensureTypedArg(e.velocity.distribution,r.NUMBER,this.type),_randomise:t.ensureTypedArg(e.velocity.randomise,r.BOOLEAN,!1),_radius:t.ensureTypedArg(e.velocity.radius,r.NUMBER,10),_radiusScale:t.ensureInstanceOf(e.velocity.radiusScale,THREE.Vector3,new THREE.Vector3(1,1,1)),_distributionClamp:t.ensureTypedArg(e.velocity.distributionClamp,r.NUMBER,0)},this.acceleration={_value:t.ensureInstanceOf(e.acceleration.value,THREE.Vector3,new THREE.Vector3),_spread:t.ensureInstanceOf(e.acceleration.spread,THREE.Vector3,new THREE.Vector3),_spreadClamp:t.ensureInstanceOf(e.acceleration.spreadClamp,THREE.Vector3,new THREE.Vector3),_distribution:t.ensureTypedArg(e.acceleration.distribution,r.NUMBER,this.type),_randomise:t.ensureTypedArg(e.acceleration.randomise,r.BOOLEAN,!1),_radius:t.ensureTypedArg(e.acceleration.radius,r.NUMBER,10),_radiusScale:t.ensureInstanceOf(e.acceleration.radiusScale,THREE.Vector3,new THREE.Vector3(1,1,1)),_distributionClamp:t.ensureTypedArg(e.acceleration.distributionClamp,r.NUMBER,0)},this.drag={_value:t.ensureTypedArg(e.drag.value,r.NUMBER,0),_spread:t.ensureTypedArg(e.drag.spread,r.NUMBER,0),_randomise:t.ensureTypedArg(e.drag.randomise,r.BOOLEAN,!1)},this.wiggle={_value:t.ensureTypedArg(e.wiggle.value,r.NUMBER,0),_spread:t.ensureTypedArg(e.wiggle.spread,r.NUMBER,0)},this.rotation={_axis:t.ensureInstanceOf(e.rotation.axis,THREE.Vector3,new THREE.Vector3(0,1,0)),_axisSpread:t.ensureInstanceOf(e.rotation.axisSpread,THREE.Vector3,new THREE.Vector3),_angle:t.ensureTypedArg(e.rotation.angle,r.NUMBER,0),_angleSpread:t.ensureTypedArg(e.rotation.angleSpread,r.NUMBER,0),_static:t.ensureTypedArg(e.rotation.static,r.BOOLEAN,!1),_center:t.ensureInstanceOf(e.rotation.center,THREE.Vector3,this.position._value.clone()),_randomise:t.ensureTypedArg(e.rotation.randomise,r.BOOLEAN,!1)},this.maxAge={_value:t.ensureTypedArg(e.maxAge.value,r.NUMBER,2),_spread:t.ensureTypedArg(e.maxAge.spread,r.NUMBER,0)},this.color={_value:t.ensureArrayInstanceOf(e.color.value,THREE.Color,new THREE.Color),_spread:t.ensureArrayInstanceOf(e.color.spread,THREE.Vector3,new THREE.Vector3),_randomise:t.ensureTypedArg(e.position.randomise,r.BOOLEAN,!1)},this.opacity={_value:t.ensureArrayTypedArg(e.opacity.value,r.NUMBER,1),_spread:t.ensureArrayTypedArg(e.opacity.spread,r.NUMBER,0),_randomise:t.ensureTypedArg(e.position.randomise,r.BOOLEAN,!1)},this.size={_value:t.ensureArrayTypedArg(e.size.value,r.NUMBER,1),_spread:t.ensureArrayTypedArg(e.size.spread,r.NUMBER,0),_randomise:t.ensureTypedArg(e.position.randomise,r.BOOLEAN,!1)},this.angle={_value:t.ensureArrayTypedArg(e.angle.value,r.NUMBER,0),_spread:t.ensureArrayTypedArg(e.angle.spread,r.NUMBER,0),_randomise:t.ensureTypedArg(e.position.randomise,r.BOOLEAN,!1)},this.SHOULD_DRAG_PARTICLES=!!Math.max(this.drag._value,this.drag._spread),this.SHOULD_WIGGLE_PARTICLES=!!Math.max(this.wiggle._value,this.wiggle._spread),this.SHOULD_ROTATE_PARTICLES=!!Math.max(this.rotation._angle,this.rotation._angleSpread),this.SHOULD_COLORIZE_PARTICLES=!0,this.SHOULD_SIZE_PARTICLES=!0,this.SHOULD_ANGLE_PARTICLES=!0,this.particleCount=t.ensureTypedArg(e.particleCount,r.NUMBER,100),this.objPool=new MSPE.BufferAttributeObjPool({iCount:this.particleCount}),this.duration=t.ensureTypedArg(e.duration,r.NUMBER,null),this.isStatic=t.ensureTypedArg(e.isStatic,r.BOOLEAN,!1),this.isLookAtCamera=t.ensureTypedArg(e.isLookAtCamera,r.BOOLEAN,!1),this.isLookAtCameraOnlyY=t.ensureTypedArg(e.isLookAtCameraOnlyY,r.BOOLEAN,!1),this.activeMultiplier=t.ensureTypedArg(e.activeMultiplier,r.NUMBER,1),this.direction=t.ensureTypedArg(e.direction,r.NUMBER,1),this.alive=t.ensureTypedArg(e.alive,r.BOOLEAN,!0),this.particlesPerSecond=0,this.age=0,this.activationStart=t.ensureTypedArg(e.activationStart,r.NUMBER,0),this.activationEnd=this.activationStart+this.particleCount,this._calculatePPSValue(this.maxAge._value+this.maxAge._spread),this.arrayParticles=new Array,this.group=null,this.bInitSpeed=!1,this.bInitSpeedAcc=!1,this.resetFlags={position:t.ensureTypedArg(e.position.randomise,r.BOOLEAN,!1)||t.ensureTypedArg(e.radius.randomise,r.BOOLEAN,!1),velocity:t.ensureTypedArg(e.velocity.randomise,r.BOOLEAN,!1),acceleration:t.ensureTypedArg(e.acceleration.randomise,r.BOOLEAN,!1)||t.ensureTypedArg(e.drag.randomise,r.BOOLEAN,!1),rotation:t.ensureTypedArg(e.rotation.randomise,r.BOOLEAN,!1),rotationCenter:t.ensureTypedArg(e.rotation.randomise,r.BOOLEAN,!1),size:t.ensureTypedArg(e.size.randomise,r.BOOLEAN,!1),color:t.ensureTypedArg(e.color.randomise,r.BOOLEAN,!1),opacity:t.ensureTypedArg(e.opacity.randomise,r.BOOLEAN,!1),angle:t.ensureTypedArg(e.angle.randomise,r.BOOLEAN,!1)},this.updateFlags={},this.updateCounts={},this.updateMap={maxAge:"params",position:"position",velocity:"velocity",acceleration:"acceleration",drag:"acceleration",wiggle:"params",rotation:"rotation",size:"size",color:"color",opacity:"opacity",angle:"angle"},this.updateMap)this.updateMap.hasOwnProperty(n)&&(this.updateCounts[this.updateMap[n]]=0,this.updateFlags[this.updateMap[n]]=!1,this._createGetterSetters(this[n],n));t.ensureValueOverLifetimeCompliance(this.color,i,i),t.ensureValueOverLifetimeCompliance(this.opacity,i,i),t.ensureValueOverLifetimeCompliance(this.size,i,i),t.ensureValueOverLifetimeCompliance(this.angle,i,i)},MSPE.Emitter.constructor=MSPE.Emitter,MSPE.Emitter.prototype._createGetterSetters=function(e,o){"use strict";var a=this;for(var t in e)if(e.hasOwnProperty(t)){var r=t.replace("_","");Object.defineProperty(e,r,{get:function(e){return function(){return this[e]}}(t),set:function(n){return function(e){var t=a.updateMap[o],r=this[n],i=MSPE.valueOverLifetimeLength;"_rotationCenter"===n?(a.updateFlags.rotationCenter=!0,a.updateCounts.rotationCenter=0):"_randomise"===n?a.resetFlags[t]=e:(a.updateFlags[t]=!0,a.updateCounts[t]=0),this[n]=e,Array.isArray(r)&&MSPE.utils.ensureValueOverLifetimeCompliance(a[o],i,i)}}(t)})}},MSPE.Emitter.prototype.attach=function(e){this.group=e},MSPE.Emitter.prototype._calculatePPSValue=function(e){"use strict";var t=this.particleCount;this.duration?this.particlesPerSecond=t/(e<this.duration?e:this.duration):this.particlesPerSecond=t/e},MSPE.Emitter.prototype._activateParticles=function(e,t){"use strict";this.direction;for(var r=0;r<e;++r){var i=new MSPE.Particle({emitter:this});null!=i&&null!=i&&this.arrayParticles.push(i)}},MSPE.Emitter.prototype.tick=function(e,t){"use strict";if(!this.isStatic)if(!1!==this.alive)if(null!==this.duration&&this.age>this.duration){for(var r=0,i=this.arrayParticles.length;r<i;++r)this.arrayParticles[r].tick(e,t),this.arrayParticles[r].alive||(this.arrayParticles[r].dispose(),this.arrayParticles.splice(r,1),i=this.arrayParticles.length,r--);this.arrayParticles.length<=0&&(this.alive=!1,this.age=0)}else{if(this.activationIndex=this.arrayParticles.length,this.activationIndex<this.particleCount){var n=this.activationIndex,o=this.particlesPerSecond*this.activeMultiplier*e,a=1===this.particleCount?n:0|n,s=Math.min(a+o,this.activationEnd)-a;s=Math.min(this.particleCount-this.activationIndex,s),this._activateParticles(s)}for(r=0,i=this.arrayParticles.length;r<i;++r)this.arrayParticles[r].tick(e,t),this.arrayParticles[r].alive||(this.arrayParticles[r].dispose(),this.arrayParticles.splice(r,1),i=this.arrayParticles.length,r--);this.age+=e}else this.age=0},MSPE.Emitter.prototype.dispose=function(){"use strict";for(var e=0,t=this.arrayParticles.length;e<t;++e)this.arrayParticles[e].dispose();this.particlesPerSecond=0,this.activationIndex=0,this.activeParticleCount=0,this.group=null,this.age=0,this.objPool.dispose()},MSPE.Particle=function(e){"use strict";var t=MSPE.utils,r=t.types;if(null!=(e=t.ensureTypedArg(e,r.OBJECT,{})).emitter&&null!=e.emitter&&e.emitter instanceof MSPE.Emitter){if(this.emitter=e.emitter,this.position={_value:e.emitter.position.value,_spread:e.emitter.position.spread,_spreadClamp:e.emitter.position.spreadClamp,_distribution:e.emitter.position.distribution,_randomise:e.emitter.position.randomise,_radius:e.emitter.position.radius,_radiusScale:e.emitter.position.radiusScale,_distributionClamp:e.emitter.position.distributionClamp},this.velocity={_value:e.emitter.velocity.value,_spread:e.emitter.velocity.spread,_spreadClamp:e.emitter.velocity.spreadClamp,_distribution:e.emitter.velocity.distribution,_randomise:e.emitter.velocity.randomise,_radius:e.emitter.velocity.radius,_radiusScale:e.emitter.velocity.radiusScale,_distributionClamp:e.emitter.velocity.distributionClamp},this.acceleration={_value:e.emitter.acceleration.value,_spread:e.emitter.acceleration.spread,_spreadClamp:e.emitter.acceleration.spreadClamp,_distribution:e.emitter.acceleration.distribution,_randomise:e.emitter.acceleration.randomise,_radius:e.emitter.acceleration.radius,_radiusScale:e.emitter.acceleration.radiusScale,_distributionClamp:e.emitter.acceleration.distributionClamp},this.drag={_value:e.emitter.drag.value,_spread:e.emitter.drag.spread,_randomise:e.emitter.position.randomise},this.wiggle={_value:e.emitter.wiggle.value,_spread:e.emitter.wiggle.spread},this.rotation={_axis:e.emitter.rotation.axis,_axisSpread:e.emitter.rotation.axisSpread,_angle:e.emitter.rotation.angle,_angleSpread:e.emitter.rotation.angleSpread,_static:e.emitter.rotation.static,_center:e.emitter.rotation.center,_randomise:e.emitter.position.randomise},this.maxAge={_value:e.emitter.maxAge.value,_spread:e.emitter.maxAge.spread},this.color={_value:e.emitter.color.value,_spread:e.emitter.color.spread,_randomise:e.emitter.position.randomise},this.opacity={_value:e.emitter.opacity.value,_spread:e.emitter.opacity.spread,_randomise:e.emitter.position.randomise},this.size={_value:e.emitter.size.value,_spread:e.emitter.size.spread,_randomise:e.emitter.position.randomise},this.angle={_value:e.emitter.angle.value,_spread:e.emitter.angle.spread,_randomise:e.emitter.position.randomise},this.alive=e.emitter.alive,this.age=0,this.vec3RealPosition=this._assignPositionValue(),this.vec3RealVelocity=this._assignVelocityValue(),this.vec3RealAcceleration=this._assignAccelerationValue(),this.arrayRealColor=this._assignColorValue(),this.arrayRealOpacity=this._assignOpacityAbsLifetimeValue(),this.arrayRealSize=this._assignSizeAbsLifetimeValue(),this.arrayRealAngle=this._assignAngleValue(),this.fRealDrag=t.clamp(t.randomFloat(this.drag._value,this.drag._spread),0,1),this.fRealWiggle=t.randomFloat(this.wiggle._value,this.wiggle._spread),this.fRealMaxAge=MSPE.utils.randomFloat(this.maxAge._value,this.maxAge._spread),this.vec3RealRotationAxis=MSPE.utils.getRotationAxis(this.rotation._axis,this.rotation._axisSpread),this.fRealRotationAngle=MSPE.utils.randomFloat(this.rotation._angle,this.rotation._angleSpread),this.uuidTrial="",this.obj=this.emitter.objPool.takeAnObj(),null==this.obj||null==this.obj)return this.alive=!1,this.dispose(),null;for(var i in this.matrix=new THREE.Matrix4,this.matrixElements=this.matrix.elements,this.vec3Position=new THREE.Vector3(0,0,0),this.vec3Rotation=new THREE.Euler(0,0,0),this.vec3Scale=new THREE.Vector3(.1,.1,.1),this.obj.setUse(!0),this.iBufferIndex=this.obj.iIndex+this.emitter.activationStart,this.updateFlags={},this.updateCounts={},this.updateMap={maxAge:"params",position:"position",velocity:"velocity",acceleration:"acceleration",drag:"acceleration",wiggle:"params",rotation:"rotation",size:"size",color:"color",opacity:"opacity",angle:"angle"},this.updateMap)this.updateMap.hasOwnProperty(i)&&(this.updateCounts[this.updateMap[i]]=0,this.updateFlags[this.updateMap[i]]=!1,this._createGetterSetters(this[i],i));return this.emitter.group.bEnableTrail&&(this.trailRenderHelper=new TrailRenderHelper,this.trailRenderHelper.onTriggerMeshInited=this.onTriggerMeshInited,this.trailRenderHelper.init({fTimeLong:this.emitter.group.fTrailLife,fTimeStart:MSPE.utils.clock().getElapsedTime(),iStep:0,fWidthStart:this.emitter.group.fTrailWidthStart,fWidthEnd:this.emitter.group.fTrailWidthEnd,shaderColor:new THREE.Vector4(1,1,1,1),shaderTexture:this.emitter.group.textureTrail,shaderTexMode:"Stretch",shaderBlending:this.emitter.group.blending,shaderTransparent:this.emitter.group.transparent,shaderAlphaTest:this.emitter.group.alphaTest,shaderDepthWrite:this.emitter.group.depthWrite,shaderDepthTest:this.emitter.group.depthTest},function(){}),this.uuidTrial=this.trailRenderHelper.attach(function(e){})),this}console.error("[MSPE.js] : [MSPE.Particle] : error options.emitter;")},MSPE.Particle.constructor=MSPE.Particle,MSPE.Particle.prototype.onTriggerMeshInited=function(e){this.meshTrial=e},MSPE.Particle.prototype._createGetterSetters=function(e,o){"use strict";var a=this;for(var t in e)if(e.hasOwnProperty(t)){var r=t.replace("_","");Object.defineProperty(e,r,{get:function(e){return function(){return this[e]}}(t),set:function(n){return function(e){var t=a.updateMap[o],r=this[n],i=MSPE.valueOverLifetimeLength;"_rotationCenter"===n?(a.updateFlags.rotationCenter=!0,a.updateCounts.rotationCenter=0):"_randomise"===n?a.resetFlags[t]=e:(a.updateFlags[t]=!0,a.updateCounts[t]=0),this[n]=e,Array.isArray(r)&&MSPE.utils.ensureValueOverLifetimeCompliance(a[o],i,i)}}(t)})}},MSPE.Particle.prototype.tick=function(e,t){"use strict";if(!this.emitter.isStatic){if(!1!==this.emitter.alive&&!1!==this.alive)return null!==this.emitter.duration&&this.age>this.emitter.duration?(this.alive=!1,void(this.age=0)):(this.age+=e,this.running(t),this.age>this.fRealMaxAge?(this.alive=!1,void(this.age=0)):void 0);this.age=0}},MSPE.Particle.prototype._assignPositionValue=function(){"use strict";var e=MSPE.distributions,t=MSPE.utils,r=this.position,i=r._value,n=r._spread,o=this.emitter.type,a=new THREE.Vector3(0,0,0);switch(o){case e.BOX:a=t.getRandomVector3(i,n,r._spreadClamp);break;case e.SPHERE:a=t.getRandomVector3OnSphere(i,r._radius,r._spread.x,r._radiusScale,r._spreadClamp.x,r._distributionClamp||this.particleCount);break;case e.DISC:a=t.getRandomVector3OnDisc(i,r._radius,r._spread.x,r._radiusScale,r._spreadClamp.x)}return a},MSPE.Particle.prototype._assignVelocityValue=function(){"use strict";var e=this.emitter.group.vec4Quaternion.clone();e=e.normalize();var t=MSPE.distributions,r=MSPE.utils,i=this.velocity,n=i._value,o=i._spread,a=this.emitter.type;this.emitter.bInitSpeed||(n=n.applyQuaternion(e),o=o.applyQuaternion(e),this.emitter.bInitSpeed=!0);var s=new THREE.Vector3(0,0,0);switch(a){case t.BOX:s=r.getRandomVector3(n,o);break;case t.SPHERE:s=r.getRandomDirectionVector3OnSphere(this.emitter.position.value,n.x,o.x);break;case t.DISC:s=r.getRandomVector3OnDisc(n,i._radius,i._spread.x,i._radiusScale,i._spreadClamp.x)}return s},MSPE.Particle.prototype._assignAccelerationValue=function(){"use strict";var e=this.emitter.group.vec4Quaternion.clone();e=e.normalize();var t=MSPE.distributions,r=MSPE.utils,i=this.acceleration,n=i._value,o=i._spread,a=this.emitter.type;this.emitter.bInitSpeedAcc||(n=n.applyQuaternion(e),o=o.applyQuaternion(e),this.emitter.bInitSpeedAcc=!0);var s=new THREE.Vector3(0,0,0);switch(a){case t.BOX:s=r.getRandomVector3(n,o);break;case t.SPHERE:s=r.getDirectionVector3OnSphere(this.vec3RealVelocity,this.emitter.position.value,this.emitter.velocity.value.y,this.emitter.velocity.spread.y,n,o);break;case t.DISC:s=r.getRandomVector3OnDisc(n,i._radius,i._spread.x,i._radiusScale,i._spreadClamp.x)}return s},MSPE.Particle.prototype._assignColorValue=function(){"use strict";return MSPE.utils.getRandomColor(this.color._value,this.color._spread)},MSPE.Particle.prototype._assignOpacityAbsLifetimeValue=function(){"use strict";var e,t,r=this.opacity,i=MSPE.utils;return t=new Array,i.arrayValuesAreEqual(r._value)&&i.arrayValuesAreEqual(r._spread)?(e=Math.abs(i.randomFloat(r._value[0],r._spread[0])),t.push(e),t.push(e),t.push(e)):(e=Math.abs(i.randomFloat(r._value[0],r._spread[0])),t.push(e),e=Math.abs(i.randomFloat(r._value[1],r._spread[1])),t.push(e),e=Math.abs(i.randomFloat(r._value[2],r._spread[2])),t.push(e),e=Math.abs(i.randomFloat(r._value[3],r._spread[3]))),t.push(e),t},MSPE.Particle.prototype._assignSizeAbsLifetimeValue=function(){"use strict";var e,t,r=this.size,i=MSPE.utils;return t=new Array,i.arrayValuesAreEqual(r._value)&&i.arrayValuesAreEqual(r._spread)?(e=Math.abs(i.randomFloat(r._value[0],r._spread[0])),t.push(e),t.push(e),t.push(e)):(e=Math.abs(i.randomFloat(r._value[0],r._spread[0])),t.push(e),e=Math.abs(i.randomFloat(r._value[1],r._spread[1])),t.push(e),e=Math.abs(i.randomFloat(r._value[2],r._spread[2])),t.push(e),e=Math.abs(i.randomFloat(r._value[3],r._spread[3]))),t.push(e),t},MSPE.Particle.prototype._assignAngleValue=function(){"use strict";var e,t=new Array,r=this.angle,i=MSPE.utils;return i.arrayValuesAreEqual(r._value)&&i.arrayValuesAreEqual(r._spread)?(e=i.randomFloat(r._value[0],r._spread[0]),t.push(e),t.push(e),t.push(e)):(e=i.randomFloat(r._value[0],r._spread[0]),t.push(e),e=i.randomFloat(r._value[1],r._spread[1]),t.push(e),e=i.randomFloat(r._value[2],r._spread[2]),t.push(e),e=i.randomFloat(r._value[3],r._spread[3])),t.push(e),t},MSPE.Particle.prototype.getRotationMatrix=function(e,t){e=e.normalize();var r=Math.sin(t),i=Math.cos(t),n=1-i;return(new THREE.Matrix4).set(n*e.x*e.x+i,n*e.x*e.y-e.z*r,n*e.z*e.x+e.y*r,0,n*e.x*e.y+e.z*r,n*e.y*e.y+i,n*e.y*e.z-e.x*r,0,n*e.z*e.x-e.y*r,n*e.y*e.z+e.x*r,n*e.z*e.z+i,0,0,0,0,1)},MSPE.Particle.prototype.when_gt=function(e,t){return Math.max(Math.sign(e-t),0)},MSPE.Particle.prototype.when_lt=function(e,t){return Math.min(Math.max(1-Math.sign(e-t),0),1)},MSPE.Particle.prototype.when_eq=function(e,t){return 1-Math.abs(Math.sign(e-t))},MSPE.Particle.prototype.when_ge=function(e,t){return 1-this.when_lt(e,t)},MSPE.Particle.prototype.when_le=function(e,t){return 1-this.when_gt(e,t)},MSPE.Particle.prototype.and=function(e,t){return e*t},MSPE.Particle.prototype.or=function(e,t){return Math.min(e+t,1)},MSPE.Particle.prototype.getFloatOverLifetime=function(e,t){var r=0,i=e*(MSPE.valueOverLifetimeLength-1),n=0;r+=t[0]*this.when_eq(i,0);for(var o=0;o<MSPE.valueOverLifetimeLength-1;++o)n=o,r+=this.and(this.when_gt(i,n),this.when_le(i,n+1))*MSPE.utils.lerp(t[o],t[o+1],i-n);return r},MSPE.Particle.prototype.getColorOverLifetime=function(e,t,r,i,n){var o=new THREE.Vector3(0,0,0),a=new Array;a.push(t.r),a.push(r.r),a.push(i.r),a.push(n.r);var s=new Array;s.push(t.g),s.push(r.g),s.push(i.g),s.push(n.g);var l=new Array;return l.push(t.b),l.push(r.b),l.push(i.b),l.push(n.b),o.x=this.getFloatOverLifetime(e,a),o.y=this.getFloatOverLifetime(e,s),o.z=this.getFloatOverLifetime(e,l),o},MSPE.Particle.prototype.getRotation=function(e,t){if(0==this.fRealRotationAngle)return e;var r,i,n=new THREE.Vector3(this.vec3RealRotationAxis.x,this.vec3RealRotationAxis.y,this.vec3RealRotationAxis.z),o=new THREE.Vector3(this.rotation._center.x,this.rotation._center.y,this.rotation._center.z),a=0;a+=this.when_eq(this.rotation._static?0:1,0)*this.fRealRotationAngle,a+=this.when_gt(this.rotation._static?0:1,0)*MSPE.utils.lerp(0,this.fRealRotationAngle,t),r=o.sub(e),i=this.getRotationMatrix(n,a);var s=new THREE.Vector4(r.x,r.y,r.z,0);s.applyMatrix4(i);var l=new THREE.Vector3(s.x,s.y,s.z);return o.sub(l)},MSPE.Particle.prototype.running=function(e){var t=this.age,r=this.age/this.fRealMaxAge,i=new THREE.Vector3(this.vec3RealPosition.x,this.vec3RealPosition.y,this.vec3RealPosition.z),n=new THREE.Vector3(this.vec3RealVelocity.x,this.vec3RealVelocity.y,this.vec3RealVelocity.z),o=new THREE.Vector3(this.vec3RealAcceleration.x,this.vec3RealAcceleration.y,this.vec3RealAcceleration.z);if(this.emitter.SHOULD_DRAG_PARTICLES){var a=1-.5*r*this.fRealDrag;o=o.multiplyScalar(a)}var s=new THREE.Vector3;s.copy(n),s.multiplyScalar(t);var l=new THREE.Vector3;l.copy(o),l.multiplyScalar(t*t*.5);var c=new THREE.Vector3;if(c.copy(i),c.add(s.add(l)),this.emitter.SHOULD_WIGGLE_PARTICLES){var u=r*this.fRealWiggle*Math.PI,h=Math.sin(u),p=Math.cos(u);c.x+=h,c.y+=p,c.z+=h}if(this.emitter.SHOULD_ROTATE_PARTICLES&&(c=this.getRotation(c,r)),this.vec3Position=c,this.emitter.SHOULD_SIZE_PARTICLES){var d=this.getFloatOverLifetime(r,this.arrayRealSize);this.vec3Scale=new THREE.Vector3(d,d,d)}if(this.emitter.isLookAtCamera||this.emitter.isLookAtCameraOnlyY){if(this.emitter.isLookAtCamera)f=(f=new THREE.Euler).setFromQuaternion(e.quaternion),this.vec3Rotation=f;else if(this.emitter.isLookAtCameraOnlyY){var f;f=(f=new THREE.Euler).setFromQuaternion(e.quaternion),this.vec3Rotation=new THREE.Euler(0,f.z,0,"XYZ")}}else if(this.emitter.SHOULD_ANGLE_PARTICLES){var m=this.getFloatOverLifetime(r,this.arrayRealAngle);this.vec3Rotation=new THREE.Euler(m,m,m)}if(this.emitter.group.bEnableTrail){var g=MSPE.utils.clock().getElapsedTime();this.trailRenderHelper.tick({uuid:this.uuidTrial,timeNow:g,position:this.vec3Position,rotation:this.vec3Rotation})}if(MSPE.utils.setMatrix(this.vec3Position,this.vec3Rotation,this.vec3Scale,this.matrix),this.emitter.group.mcol0.setXYZ(this.iBufferIndex,this.matrixElements[0],this.matrixElements[1],this.matrixElements[2]),this.emitter.group.mcol1.setXYZ(this.iBufferIndex,this.matrixElements[4],this.matrixElements[5],this.matrixElements[6]),this.emitter.group.mcol2.setXYZ(this.iBufferIndex,this.matrixElements[8],this.matrixElements[9],this.matrixElements[10]),this.emitter.group.mcol3.setXYZ(this.iBufferIndex,this.matrixElements[12],this.matrixElements[13],this.matrixElements[14]),this.emitter.SHOULD_COLORIZE_PARTICLES){var v=this.getColorOverLifetime(r,this.arrayRealColor[0],this.arrayRealColor[1],this.arrayRealColor[2],this.arrayRealColor[3]),y=this.getFloatOverLifetime(r,this.arrayRealOpacity);this.emitter.group.bEnableTrail&&null!=this.trailRenderHelper&&null!=this.trailRenderHelper&&this.trailRenderHelper.updateColor({r:v.x,g:v.y,b:v.z,a:y}),this.emitter.group.colors.setXYZW(this.iBufferIndex,v.x,v.y,v.z,y)}},MSPE.Particle.prototype.dispose=function(){"use strict";this.emitter.group.bEnableTrail&&(this.trailRenderHelper.detach(this.uuidTrial),this.trailRenderHelper.dispose(),this.meshTrial&&this.meshTrial.parent&&this.meshTrial.parent.remove(this.meshTrial)),null!=this.obj&&null!=this.obj&&this.obj.setUse(!1)},MSPE.BufferAttributeObjPool=function(e){"use strict";var t=MSPE.utils,r=t.types;if(null!=(e=t.ensureTypedArg(e,r.OBJECT,{})).iCount&&null!=e.iCount&&"number"==typeof e.iCount){this.iCount=e.iCount,this.objPool=new Array;for(var i=0;i<this.iCount;i++){var n=new MSPE.BufferAttributeObj({iIndex:i});this.objPool.push(n)}}else console.error("[MSPE] : [BufferAttributeObjPool] : error options.iCount;")},MSPE.BufferAttributeObjPool.constructor=MSPE.BufferAttributeObjPool,MSPE.BufferAttributeObjPool.prototype.setUse=function(e,t){"use strict";null!=e&&null!=e&&"number"==typeof e?e+1>this.objPool.length?console.error("[MSPE] : [BufferAttributeObjPool] : [setUse] : error iIndex; iIndex = "+e+"; while this.objPool.length = "+this.objPool.length):null!=t&&null!=t&&"boolean"==typeof t?this.objPool[e].setUse(t):console.error("[MSPE] : [BufferAttributeObjPool] : [setUse] : error bU;"):console.error("[MSPE] : [BufferAttributeObjPool] : [setUse] : error iIndex;")},MSPE.BufferAttributeObjPool.prototype.getUse=function(e){"use strict";if(null!=e&&null!=e&&"number"==typeof e){if(!(e+1>this.objPool.length))return this.objPool[e].getUse();console.error("[MSPE] : [BufferAttributeObjPool] : [getUse] : error iIndex; iIndex = "+e+"; while this.objPool.length = "+this.objPool.length)}else console.error("[MSPE] : [BufferAttributeObjPool] : [getUse] : error iIndex;")},MSPE.BufferAttributeObjPool.prototype.takeAnObj=function(){"use strict";for(var e=0,t=this.objPool.length;e<t;e++)if(!this.objPool[e].getUse())return this.objPool[e];return null},MSPE.BufferAttributeObjPool.prototype.reset=function(){"use strict";for(var e=0,t=this.objPool.length;e<t;e++)this.objPool[e].setUse(!1)},MSPE.BufferAttributeObjPool.prototype.dispose=function(){"use strict";for(var e=0,t=this.objPool.length;e<t;e++)this.objPool[e].dispose()},MSPE.BufferAttributeObj=function(e){"use strict";var t=MSPE.utils,r=t.types;null!=(e=t.ensureTypedArg(e,r.OBJECT,{})).iIndex&&null!=e.iIndex&&"number"==typeof e.iIndex?(this.iIndex=e.iIndex,this.bUsed=!1):console.error("[MSPE] : [BufferAttributeObj] : error options.iIndex;")},MSPE.BufferAttributeObj.constructor=MSPE.BufferAttributeObj,MSPE.BufferAttributeObj.prototype.setUse=function(e){"use strict";this.bUsed=e},MSPE.BufferAttributeObj.prototype.getUse=function(){"use strict";return this.bUsed},MSPE.BufferAttributeObj.prototype.dispose=function(){},function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).poly2tri=e()}}(function(){return function o(a,s,l){function c(t,e){if(!s[t]){if(!a[t]){var r="function"==typeof require&&require;if(!e&&r)return r(t,!0);if(u)return u(t,!0);var i=new Error("Cannot find module '"+t+"'");throw i.code="MODULE_NOT_FOUND",i}var n=s[t]={exports:{}};a[t][0].call(n.exports,function(e){return c(a[t][1][e]||e)},n,n.exports,o,a,s,l)}return s[t].exports}for(var u="function"==typeof require&&require,e=0;e<l.length;e++)c(l[e]);return c}({1:[function(e,t,r){t.exports={version:"1.5.0"}},{}],2:[function(e,t,r){"use strict";var i=function(e,t){this.head_=e,this.tail_=t,this.search_node_=e};i.prototype.head=function(){return this.head_},i.prototype.setHead=function(e){this.head_=e},i.prototype.tail=function(){return this.tail_},i.prototype.setTail=function(e){this.tail_=e},i.prototype.search=function(){return this.search_node_},i.prototype.setSearch=function(e){this.search_node_=e},i.prototype.findSearchNode=function(){return this.search_node_},i.prototype.locateNode=function(e){var t=this.search_node_;if(e<t.value){for(;t=t.prev;)if(e>=t.value)return this.search_node_=t}else for(;t=t.next;)if(e<t.value)return this.search_node_=t.prev,t.prev;return null},i.prototype.locatePoint=function(e){var t=e.x,r=this.findSearchNode(t),i=r.point.x;if(t===i){if(e!==r.point)if(e===r.prev.point)r=r.prev;else{if(e!==r.next.point)throw new Error("poly2tri Invalid AdvancingFront.locatePoint() call");r=r.next}}else if(t<i)for(;(r=r.prev)&&e!==r.point;);else for(;(r=r.next)&&e!==r.point;);return r&&(this.search_node_=r),r},t.exports=i,t.exports.Node=function(e,t){this.point=e,this.triangle=t||null,this.next=null,this.prev=null,this.value=e.x}},{}],3:[function(e,t,r){"use strict";t.exports=function(e,t){if(!e)throw new Error(t||"Assert Failed")}},{}],4:[function(e,t,r){"use strict";var i=e("./xy"),n=function(e,t){this.x=+e||0,this.y=+t||0,this._p2t_edge_list=null};n.prototype.toString=function(){return i.toStringBase(this)},n.prototype.toJSON=function(){return{x:this.x,y:this.y}},n.prototype.clone=function(){return new n(this.x,this.y)},n.prototype.set_zero=function(){return this.x=0,this.y=0,this},n.prototype.set=function(e,t){return this.x=+e||0,this.y=+t||0,this},n.prototype.negate=function(){return this.x=-this.x,this.y=-this.y,this},n.prototype.add=function(e){return this.x+=e.x,this.y+=e.y,this},n.prototype.sub=function(e){return this.x-=e.x,this.y-=e.y,this},n.prototype.mul=function(e){return this.x*=e,this.y*=e,this},n.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},n.prototype.normalize=function(){var e=this.length();return this.x/=e,this.y/=e,e},n.prototype.equals=function(e){return this.x===e.x&&this.y===e.y},n.negate=function(e){return new n(-e.x,-e.y)},n.add=function(e,t){return new n(e.x+t.x,e.y+t.y)},n.sub=function(e,t){return new n(e.x-t.x,e.y-t.y)},n.mul=function(e,t){return new n(e*t.x,e*t.y)},n.cross=function(e,t){return"number"==typeof e?"number"==typeof t?e*t:new n(-e*t.y,e*t.x):"number"==typeof t?new n(t*e.y,-t*e.x):e.x*t.y-e.y*t.x},n.toString=i.toString,n.compare=i.compare,n.cmp=i.compare,n.equals=i.equals,n.dot=function(e,t){return e.x*t.x+e.y*t.y},t.exports=n},{"./xy":11}],5:[function(e,t,r){"use strict";var i=e("./xy"),n=function(e,t){this.name="PointError",this.points=t=t||[],this.message=e||"Invalid Points!";for(var r=0;r<t.length;r++)this.message+=" "+i.toString(t[r])};(n.prototype=new Error).constructor=n,t.exports=n},{"./xy":11}],6:[function(i,e,n){(function(e){"use strict";var t=e.poly2tri;n.noConflict=function(){return e.poly2tri=t,n},n.VERSION=i("../dist/version.json").version,n.PointError=i("./pointerror"),n.Point=i("./point"),n.Triangle=i("./triangle"),n.SweepContext=i("./sweepcontext");var r=i("./sweep");n.triangulate=r.triangulate,n.sweep={Triangulate:r.triangulate}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../dist/version.json":1,"./point":4,"./pointerror":5,"./sweep":7,"./sweepcontext":8,"./triangle":9}],7:[function(e,t,r){"use strict";function v(e,t,r,i,n){if(!y(i,t,r)){var o=i.pointCCW(n),a=C(r,o,t);if(a===A.COLLINEAR)throw new M("poly2tri EdgeEvent: Collinear not supported!",[r,o,t]);var s=i.pointCW(n),l=C(r,s,t);if(l===A.COLLINEAR)throw new M("poly2tri EdgeEvent: Collinear not supported!",[r,s,t]);a===l?v(e,t,r,i=a===A.CW?i.neighborCCW(n):i.neighborCW(n),n):g(e,t,r,i,n)}}function y(e,t,r){var i=e.edgeIndex(t,r);if(-1===i)return!1;e.markConstrainedEdgeByIndex(i);var n=e.getNeighbor(i);return n&&n.markConstrainedEdgeByPoints(t,r),!0}function b(e,t){var r=new S(t.prev.point,t.point,t.next.point);r.markNeighbor(t.prev.triangle),r.markNeighbor(t.triangle),e.addToMap(r),t.prev.next=t.next,t.next.prev=t.prev,x(e,r)||e.mapTriangleToNodes(r)}function x(e,t){for(var r=0;r<3;++r)if(!t.delaunay_edge[r]){var i=t.getNeighbor(r);if(i){var n=t.getPoint(r),o=i.oppositePoint(t,n),a=i.index(o);if(i.constrained_edge[a]||i.delaunay_edge[a]){t.constrained_edge[r]=i.constrained_edge[a];continue}if(l(n,t.pointCCW(n),t.pointCW(n),o)){t.delaunay_edge[r]=!0,i.delaunay_edge[a]=!0,m(t,n,i,o);var s=!x(e,t);return s&&e.mapTriangleToNodes(t),(s=!x(e,i))&&e.mapTriangleToNodes(i),t.delaunay_edge[r]=!1,!(i.delaunay_edge[a]=!1)}}}return!1}function l(e,t,r,i){var n=e.x-i.x,o=e.y-i.y,a=t.x-i.x,s=t.y-i.y,l=n*s-a*o;if(l<=0)return!1;var c=r.x-i.x,u=r.y-i.y,h=c*o-n*u;return!(h<=0)&&0<(n*n+o*o)*(a*u-c*s)+(a*a+s*s)*h+(c*c+u*u)*l}function m(e,t,r,i){var n,o,a,s,l,c,u,h,p,d,f,m;n=e.neighborCCW(t),o=e.neighborCW(t),a=r.neighborCCW(i),s=r.neighborCW(i),l=e.getConstrainedEdgeCCW(t),c=e.getConstrainedEdgeCW(t),u=r.getConstrainedEdgeCCW(i),h=r.getConstrainedEdgeCW(i),p=e.getDelaunayEdgeCCW(t),d=e.getDelaunayEdgeCW(t),f=r.getDelaunayEdgeCCW(i),m=r.getDelaunayEdgeCW(i),e.legalize(t,i),r.legalize(i,t),r.setDelaunayEdgeCCW(t,p),e.setDelaunayEdgeCW(t,d),e.setDelaunayEdgeCCW(i,f),r.setDelaunayEdgeCW(i,m),r.setConstrainedEdgeCCW(t,l),e.setConstrainedEdgeCW(t,c),e.setConstrainedEdgeCCW(i,u),r.setConstrainedEdgeCW(i,h),e.clearNeighbors(),r.clearNeighbors(),n&&r.markNeighbor(n),o&&e.markNeighbor(o),a&&e.markNeighbor(a),s&&r.markNeighbor(s),e.markNeighbor(r)}function E(e,t,r){r.point.x<t.p.x&&(C(r.point,r.next.point,r.next.next.point)===A.CCW?n(e,t,r):(function e(t,r,i){C(i.next.point,i.next.next.point,i.next.next.next.point)===A.CCW?n(t,r,i.next):C(r.q,i.next.next.point,r.p)===A.CCW&&e(t,r,i.next)}(e,t,r),E(e,t,r)))}function n(e,t,r){b(e,r.next),r.next.point!==t.p&&C(t.q,r.next.point,t.p)===A.CCW&&C(r.point,r.next.point,r.next.next.point)===A.CCW&&n(e,t,r)}function _(e,t,r){r.point.x>t.p.x&&(C(r.point,r.prev.point,r.prev.prev.point)===A.CW?o(e,t,r):(function e(t,r,i){C(i.prev.point,i.prev.prev.point,i.prev.prev.prev.point)===A.CW?o(t,r,i.prev):C(r.q,i.prev.prev.point,r.p)===A.CW&&e(t,r,i.prev)}(e,t,r),_(e,t,r)))}function o(e,t,r){b(e,r.prev),r.prev.point!==t.p&&C(t.q,r.prev.point,t.p)===A.CW&&C(r.point,r.prev.point,r.prev.prev.point)===A.CW&&o(e,t,r)}function g(e,t,r,i,n){var o=i.neighborAcross(n);T(o,"FLIP failed due to missing triangle!");var a,s,l,c,u,h,p=o.oppositePoint(i,n);if(i.getConstrainedEdgeAcross(n)){var d=i.index(n);throw new M("poly2tri Intersecting Constraints",[n,p,i.getPoint((d+1)%3),i.getPoint((d+2)%3)])}if(L(n,i.pointCCW(n),i.pointCW(n),p))if(m(i,n,o,p),e.mapTriangleToNodes(i),e.mapTriangleToNodes(o),n===r&&p===t)r===e.edge_event.constrained_edge.q&&t===e.edge_event.constrained_edge.p&&(i.markConstrainedEdgeByPoints(t,r),o.markConstrainedEdgeByPoints(t,r),x(e,i),x(e,o));else{var f=C(r,p,t);s=i,l=o,c=n,u=p,g(a=e,t,r,i=f===A.CCW?(h=l.edgeIndex(c,u),l.delaunay_edge[h]=!0,x(a,l),l.clearDelaunayEdges(),s):(h=s.edgeIndex(c,u),s.delaunay_edge[h]=!0,x(a,s),s.clearDelaunayEdges(),l),n)}else(function e(t,r,i,n,o,a){var s=o.neighborAcross(a);T(s,"FLIP failed due to missing triangle");var l=s.oppositePoint(o,a);L(i,n.pointCCW(i),n.pointCW(i),l)?g(t,i,l,s,l):e(t,r,i,n,s,w(r,i,s,l))})(e,t,r,i,o,w(t,r,o,p)),v(e,t,r,i,n)}function w(e,t,r,i){var n=C(t,i,e);if(n===A.CW)return r.pointCCW(i);if(n===A.CCW)return r.pointCW(i);throw new M("poly2tri [Unsupported] nextFlipPoint: opposing point on constrained edge!",[t,i,e])}var T=e("./assert"),M=e("./pointerror"),S=e("./triangle"),R=e("./advancingfront").Node,i=e("./utils"),P=i.EPSILON,A=i.Orientation,C=i.orient2d,L=i.inScanArea,O=i.isAngleObtuse;r.triangulate=function(e){e.initTriangulation(),e.createAdvancingFront(),function(e){var t,r,i,n,o,a,s,l,c,u,h,p=e.pointCount();for(t=1;t<p;++t)for(var d=e.getPoint(t),f=(c=d,u=(l=e).locateNode(c),h=function(e,t,r){var i=new S(t,r.point,r.next.point);i.markNeighbor(r.triangle),e.addToMap(i);var n=new R(t);return n.next=r.next,(n.prev=r).next.prev=n,r.next=n,x(e,i)||e.mapTriangleToNodes(i),n}(l,c,u),c.x<=u.point.x+P&&b(l,u),function(e,t){for(var r=t.next;r.next&&!O(r.point,r.next.point,r.prev.point);)b(e,r),r=r.next;for(r=t.prev;r.prev&&!O(r.point,r.next.point,r.prev.point);)b(e,r),r=r.prev;var i,n,o;t.next&&t.next.next&&(n=(i=t).point.x-i.next.next.point.x,o=i.point.y-i.next.next.point.y,T(0<=o,"unordered y"),0<=n||Math.abs(n)<o)&&function(e,t){for(C(t.point,t.next.point,t.next.next.point)===A.CCW?e.basin.left_node=t.next.next:e.basin.left_node=t.next,e.basin.bottom_node=e.basin.left_node;e.basin.bottom_node.next&&e.basin.bottom_node.point.y>=e.basin.bottom_node.next.point.y;)e.basin.bottom_node=e.basin.bottom_node.next;if(e.basin.bottom_node!==e.basin.left_node){for(e.basin.right_node=e.basin.bottom_node;e.basin.right_node.next&&e.basin.right_node.point.y<e.basin.right_node.next.point.y;)e.basin.right_node=e.basin.right_node.next;e.basin.right_node!==e.basin.bottom_node&&(e.basin.width=e.basin.right_node.point.x-e.basin.left_node.point.x,e.basin.left_highest=e.basin.left_node.point.y>e.basin.right_node.point.y,function e(t,r){if(n=r,o=(i=t).basin.left_highest?i.basin.left_node.point.y-n.point.y:i.basin.right_node.point.y-n.point.y,!(i.basin.width>o)&&(b(t,r),r.prev!==t.basin.left_node||r.next!==t.basin.right_node)){if(r.prev===t.basin.left_node){if(C(r.point,r.next.point,r.next.next.point)===A.CW)return;r=r.next}else if(r.next===t.basin.right_node){if(C(r.point,r.prev.point,r.prev.prev.point)===A.CCW)return;r=r.prev}else r=r.prev.point.y<r.next.point.y?r.prev:r.next;e(t,r)}var i,n,o}(e,e.basin.bottom_node))}}(e,t)}(l,h),h),m=d._p2t_edge_list,g=0;m&&g<m.length;++g)o=e,a=m[g],s=f,o.edge_event.constrained_edge=a,o.edge_event.right=a.p.x>a.q.x,y(s.triangle,a.p,a.q)||(i=a,n=s,(r=o).edge_event.right?function(e,t,r){for(;r.next.point.x<t.p.x;)C(t.q,r.next.point,t.p)===A.CCW?E(e,t,r):r=r.next}(r,i,n):function(e,t,r){for(;r.prev.point.x>t.p.x;)C(t.q,r.prev.point,t.p)===A.CW?_(e,t,r):r=r.prev}(r,i,n),v(o,a.p,a.q,s.triangle,a.q))}(e),function(e){for(var t=e.front().head().next.triangle,r=e.front().head().next.point;!t.getConstrainedEdgeCW(r);)t=t.neighborCCW(r);e.meshClean(t)}(e)}},{"./advancingfront":2,"./assert":3,"./pointerror":5,"./triangle":9,"./utils":10}],8:[function(e,t,r){"use strict";var i=e("./pointerror"),c=e("./point"),n=e("./triangle"),o=e("./sweep"),a=e("./advancingfront"),s=a.Node,l=function(e,t){if(this.p=e,this.q=t,e.y>t.y)this.q=e,this.p=t;else if(e.y===t.y)if(e.x>t.x)this.q=e,this.p=t;else if(e.x===t.x)throw new i("poly2tri Invalid Edge constructor: repeated points!",[e]);this.q._p2t_edge_list||(this.q._p2t_edge_list=[]),this.q._p2t_edge_list.push(this)},u=function(){this.left_node=null,this.bottom_node=null,this.right_node=null,this.width=0,this.left_highest=!1};u.prototype.clear=function(){this.left_node=null,this.bottom_node=null,this.right_node=null,this.width=0,this.left_highest=!1};var h=function(){this.constrained_edge=null,this.right=!1},p=function(e,t){t=t||{},this.triangles_=[],this.map_=[],this.points_=t.cloneArrays?e.slice(0):e,this.edge_list=[],this.pmin_=this.pmax_=null,this.front_=null,this.head_=null,this.tail_=null,this.af_head_=null,this.af_middle_=null,this.af_tail_=null,this.basin=new u,this.edge_event=new h,this.initEdges(this.points_)};p.prototype.AddHole=p.prototype.addHole=function(e){this.initEdges(e);var t,r=e.length;for(t=0;t<r;t++)this.points_.push(e[t]);return this},p.prototype.addHoles=function(e){var t,r=e.length;for(t=0;t<r;t++)this.initEdges(e[t]);return this.points_=this.points_.concat.apply(this.points_,e),this},p.prototype.AddPoint=p.prototype.addPoint=function(e){return this.points_.push(e),this},p.prototype.addPoints=function(e){return this.points_=this.points_.concat(e),this},p.prototype.triangulate=function(){return o.triangulate(this),this},p.prototype.getBoundingBox=function(){return{min:this.pmin_,max:this.pmax_}},p.prototype.GetTriangles=p.prototype.getTriangles=function(){return this.triangles_},p.prototype.front=function(){return this.front_},p.prototype.pointCount=function(){return this.points_.length},p.prototype.head=function(){return this.head_},p.prototype.setHead=function(e){this.head_=e},p.prototype.tail=function(){return this.tail_},p.prototype.setTail=function(e){this.tail_=e},p.prototype.getMap=function(){return this.map_},p.prototype.initTriangulation=function(){var e,t=this.points_[0].x,r=this.points_[0].x,i=this.points_[0].y,n=this.points_[0].y,o=this.points_.length;for(e=1;e<o;e++){var a=this.points_[e];a.x>t&&(t=a.x),a.x<r&&(r=a.x),a.y>i&&(i=a.y),a.y<n&&(n=a.y)}this.pmin_=new c(r,n),this.pmax_=new c(t,i);var s=.3*(t-r),l=.3*(i-n);this.head_=new c(t+s,n-l),this.tail_=new c(r-s,n-l),this.points_.sort(c.compare)},p.prototype.initEdges=function(e){var t,r=e.length;for(t=0;t<r;++t)this.edge_list.push(new l(e[t],e[(t+1)%r]))},p.prototype.getPoint=function(e){return this.points_[e]},p.prototype.addToMap=function(e){this.map_.push(e)},p.prototype.locateNode=function(e){return this.front_.locateNode(e.x)},p.prototype.createAdvancingFront=function(){var e,t,r,i=new n(this.points_[0],this.tail_,this.head_);this.map_.push(i),e=new s(i.getPoint(1),i),t=new s(i.getPoint(0),i),r=new s(i.getPoint(2)),this.front_=new a(e,r),(e.next=t).next=r,t.prev=e,r.prev=t},p.prototype.removeNode=function(e){},p.prototype.mapTriangleToNodes=function(e){for(var t=0;t<3;++t)if(!e.getNeighbor(t)){var r=this.front_.locatePoint(e.pointCW(e.getPoint(t)));r&&(r.triangle=e)}},p.prototype.removeFromMap=function(e){var t,r=this.map_,i=r.length;for(t=0;t<i;t++)if(r[t]===e){r.splice(t,1);break}},p.prototype.meshClean=function(e){for(var t,r,i=[e];t=i.pop();)if(!t.isInterior())for(t.setInterior(!0),this.triangles_.push(t),r=0;r<3;r++)t.constrained_edge[r]||i.push(t.getNeighbor(r))},t.exports=p},{"./advancingfront":2,"./point":4,"./pointerror":5,"./sweep":7,"./triangle":9}],9:[function(e,t,r){"use strict";var i=function(e,t,r){this.points_=[e,t,r],this.neighbors_=[null,null,null],this.interior_=!1,this.constrained_edge=[!1,!1,!1],this.delaunay_edge=[!1,!1,!1]},n=e("./xy").toString;i.prototype.toString=function(){return"["+n(this.points_[0])+n(this.points_[1])+n(this.points_[2])+"]"},i.prototype.GetPoint=i.prototype.getPoint=function(e){return this.points_[e]},i.prototype.getPoints=function(){return this.points_},i.prototype.getNeighbor=function(e){return this.neighbors_[e]},i.prototype.containsPoint=function(e){var t=this.points_;return e===t[0]||e===t[1]||e===t[2]},i.prototype.containsEdge=function(e){return this.containsPoint(e.p)&&this.containsPoint(e.q)},i.prototype.containsPoints=function(e,t){return this.containsPoint(e)&&this.containsPoint(t)},i.prototype.isInterior=function(){return this.interior_},i.prototype.setInterior=function(e){return this.interior_=e,this},i.prototype.markNeighborPointers=function(e,t,r){var i=this.points_;if(e===i[2]&&t===i[1]||e===i[1]&&t===i[2])this.neighbors_[0]=r;else if(e===i[0]&&t===i[2]||e===i[2]&&t===i[0])this.neighbors_[1]=r;else{if(!(e===i[0]&&t===i[1]||e===i[1]&&t===i[0]))throw new Error("poly2tri Invalid Triangle.markNeighborPointers() call");this.neighbors_[2]=r}},i.prototype.markNeighbor=function(e){var t=this.points_;e.containsPoints(t[1],t[2])?(this.neighbors_[0]=e).markNeighborPointers(t[1],t[2],this):e.containsPoints(t[0],t[2])?(this.neighbors_[1]=e).markNeighborPointers(t[0],t[2],this):e.containsPoints(t[0],t[1])&&(this.neighbors_[2]=e).markNeighborPointers(t[0],t[1],this)},i.prototype.clearNeighbors=function(){this.neighbors_[0]=null,this.neighbors_[1]=null,this.neighbors_[2]=null},i.prototype.clearDelaunayEdges=function(){this.delaunay_edge[0]=!1,this.delaunay_edge[1]=!1,this.delaunay_edge[2]=!1},i.prototype.pointCW=function(e){var t=this.points_;return e===t[0]?t[2]:e===t[1]?t[0]:e===t[2]?t[1]:null},i.prototype.pointCCW=function(e){var t=this.points_;return e===t[0]?t[1]:e===t[1]?t[2]:e===t[2]?t[0]:null},i.prototype.neighborCW=function(e){return e===this.points_[0]?this.neighbors_[1]:e===this.points_[1]?this.neighbors_[2]:this.neighbors_[0]},i.prototype.neighborCCW=function(e){return e===this.points_[0]?this.neighbors_[2]:e===this.points_[1]?this.neighbors_[0]:this.neighbors_[1]},i.prototype.getConstrainedEdgeCW=function(e){return e===this.points_[0]?this.constrained_edge[1]:e===this.points_[1]?this.constrained_edge[2]:this.constrained_edge[0]},i.prototype.getConstrainedEdgeCCW=function(e){return e===this.points_[0]?this.constrained_edge[2]:e===this.points_[1]?this.constrained_edge[0]:this.constrained_edge[1]},i.prototype.getConstrainedEdgeAcross=function(e){return e===this.points_[0]?this.constrained_edge[0]:e===this.points_[1]?this.constrained_edge[1]:this.constrained_edge[2]},i.prototype.setConstrainedEdgeCW=function(e,t){e===this.points_[0]?this.constrained_edge[1]=t:e===this.points_[1]?this.constrained_edge[2]=t:this.constrained_edge[0]=t},i.prototype.setConstrainedEdgeCCW=function(e,t){e===this.points_[0]?this.constrained_edge[2]=t:e===this.points_[1]?this.constrained_edge[0]=t:this.constrained_edge[1]=t},i.prototype.getDelaunayEdgeCW=function(e){return e===this.points_[0]?this.delaunay_edge[1]:e===this.points_[1]?this.delaunay_edge[2]:this.delaunay_edge[0]},i.prototype.getDelaunayEdgeCCW=function(e){return e===this.points_[0]?this.delaunay_edge[2]:e===this.points_[1]?this.delaunay_edge[0]:this.delaunay_edge[1]},i.prototype.setDelaunayEdgeCW=function(e,t){e===this.points_[0]?this.delaunay_edge[1]=t:e===this.points_[1]?this.delaunay_edge[2]=t:this.delaunay_edge[0]=t},i.prototype.setDelaunayEdgeCCW=function(e,t){e===this.points_[0]?this.delaunay_edge[2]=t:e===this.points_[1]?this.delaunay_edge[0]=t:this.delaunay_edge[1]=t},i.prototype.neighborAcross=function(e){return e===this.points_[0]?this.neighbors_[0]:e===this.points_[1]?this.neighbors_[1]:this.neighbors_[2]},i.prototype.oppositePoint=function(e,t){var r=e.pointCW(t);return this.pointCW(r)},i.prototype.legalize=function(e,t){var r=this.points_;if(e===r[0])r[1]=r[0],r[0]=r[2],r[2]=t;else if(e===r[1])r[2]=r[1],r[1]=r[0],r[0]=t;else{if(e!==r[2])throw new Error("poly2tri Invalid Triangle.legalize() call");r[0]=r[2],r[2]=r[1],r[1]=t}},i.prototype.index=function(e){var t=this.points_;if(e===t[0])return 0;if(e===t[1])return 1;if(e===t[2])return 2;throw new Error("poly2tri Invalid Triangle.index() call")},i.prototype.edgeIndex=function(e,t){var r=this.points_;if(e===r[0]){if(t===r[1])return 2;if(t===r[2])return 1}else if(e===r[1]){if(t===r[2])return 0;if(t===r[0])return 2}else if(e===r[2]){if(t===r[0])return 1;if(t===r[1])return 0}return-1},i.prototype.markConstrainedEdgeByIndex=function(e){this.constrained_edge[e]=!0},i.prototype.markConstrainedEdgeByEdge=function(e){this.markConstrainedEdgeByPoints(e.p,e.q)},i.prototype.markConstrainedEdgeByPoints=function(e,t){var r=this.points_;t===r[0]&&e===r[1]||t===r[1]&&e===r[0]?this.constrained_edge[2]=!0:t===r[0]&&e===r[2]||t===r[2]&&e===r[0]?this.constrained_edge[1]=!0:(t===r[1]&&e===r[2]||t===r[2]&&e===r[1])&&(this.constrained_edge[0]=!0)},t.exports=i},{"./xy":11}],10:[function(e,t,r){"use strict";r.EPSILON=1e-12;var n={CW:1,CCW:-1,COLLINEAR:0};r.Orientation=n,r.orient2d=function(e,t,r){var i=(e.x-r.x)*(t.y-r.y)-(e.y-r.y)*(t.x-r.x);return-1e-12<i&&i<1e-12?n.COLLINEAR:0<i?n.CCW:n.CW},r.inScanArea=function(e,t,r,i){return!(-1e-12<=(e.x-t.x)*(i.y-t.y)-(i.x-t.x)*(e.y-t.y)||(e.x-r.x)*(i.y-r.y)-(i.x-r.x)*(e.y-r.y)<=1e-12)},r.isAngleObtuse=function(e,t,r){var i=t.x-e.x,n=t.y-e.y;return i*(r.x-e.x)+n*(r.y-e.y)<0}},{}],11:[function(e,t,r){"use strict";function i(e){return"("+e.x+";"+e.y+")"}t.exports={toString:function(e){var t=e.toString();return"[object Object]"===t?i(e):t},toStringBase:i,compare:function(e,t){return e.y===t.y?e.x-t.x:e.y-t.y},equals:function(e,t){return e.x===t.x&&e.y===t.y}}},{}]},{},[6])(6)}),function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).polylabel=e()}}(function(){return function o(a,s,l){function c(r,e){if(!s[r]){if(!a[r]){var t="function"==typeof require&&require;if(!e&&t)return t(r,!0);if(u)return u(r,!0);var i=new Error("Cannot find module '"+r+"'");throw i.code="MODULE_NOT_FOUND",i}var n=s[r]={exports:{}};a[r][0].call(n.exports,function(e){var t=a[r][1][e];return c(t||e)},n,n.exports,o,a,s,l)}return s[r].exports}for(var u="function"==typeof require&&require,e=0;e<l.length;e++)c(l[e]);return c}({1:[function(e,t,r){"use strict";var x=e("tinyqueue");function i(e,t,r){var i,n,o,a;t=t||1;for(var s=0;s<e[0].length;s++){var l=e[0][s];(!s||l[0]<i)&&(i=l[0]),(!s||l[1]<n)&&(n=l[1]),(!s||l[0]>o)&&(o=l[0]),(!s||l[1]>a)&&(a=l[1])}var c=o-i,u=a-n,h=Math.min(c,u),p=h/2,d=new x(null,E);if(0===h)return[i,n];for(var f=i;f<o;f+=h)for(var m=n;m<a;m+=h)d.push(new _(f+p,m+p,p,e));var g=function(e){for(var t=0,r=0,i=0,n=e[0],o=0,a=n.length,s=a-1;o<a;s=o++){var l=n[o],c=n[s],u=l[0]*c[1]-c[0]*l[1];r+=(l[0]+c[0])*u,i+=(l[1]+c[1])*u,t+=3*u}return 0===t?new _(n[0][0],n[0][1],0,e):new _(r/t,i/t,0,e)}(e),v=new _(i+c/2,n+u/2,0,e);v.d>g.d&&(g=v);for(var y=d.length;d.length;){var b=d.pop();b.d>g.d&&(g=b,r&&console.log("found best %d after %d probes",Math.round(1e4*b.d)/1e4,y)),b.max-g.d<=t||(p=b.h/2,d.push(new _(b.x-p,b.y-p,p,e)),d.push(new _(b.x+p,b.y-p,p,e)),d.push(new _(b.x-p,b.y+p,p,e)),d.push(new _(b.x+p,b.y+p,p,e)),y+=4)}return r&&(console.log("num probes: "+y),console.log("best distance: "+g.d)),[g.x,g.y]}function E(e,t){return t.max-e.max}function _(e,t,r,i){this.x=e,this.y=t,this.h=r,this.d=function(e,t,r){for(var i=!1,n=1/0,o=0;o<r.length;o++)for(var a=r[o],s=0,l=a.length,c=l-1;s<l;c=s++){var u=a[s],h=a[c];u[1]>t!=h[1]>t&&e<(h[0]-u[0])*(t-u[1])/(h[1]-u[1])+u[0]&&(i=!i),n=Math.min(n,p(e,t,u,h))}return(i?1:-1)*Math.sqrt(n)}(e,t,i),this.max=this.d+this.h*Math.SQRT2}function p(e,t,r,i){var n=r[0],o=r[1],a=i[0]-n,s=i[1]-o;if(0!==a||0!==s){var l=((e-n)*a+(t-o)*s)/(a*a+s*s);1<l?(n=i[0],o=i[1]):0<l&&(n+=a*l,o+=s*l)}return(a=e-n)*a+(s=t-o)*s}t.exports=i,t.exports.default=i},{tinyqueue:2}],2:[function(e,t,r){"use strict";function i(e,t){if(!(this instanceof i))return new i(e,t);if(this.data=e||[],this.length=this.data.length,this.compare=t||n,0<this.length)for(var r=(this.length>>1)-1;0<=r;r--)this._down(r)}function n(e,t){return e<t?-1:t<e?1:0}t.exports=i,(t.exports.default=i).prototype={push:function(e){this.data.push(e),this.length++,this._up(this.length-1)},pop:function(){if(0!==this.length){var e=this.data[0];return this.length--,0<this.length&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),e}},peek:function(){return this.data[0]},_up:function(e){for(var t=this.data,r=this.compare,i=t[e];0<e;){var n=e-1>>1,o=t[n];if(0<=r(i,o))break;t[e]=o,e=n}t[e]=i},_down:function(e){for(var t=this.data,r=this.compare,i=this.length>>1,n=t[e];e<i;){var o=1+(e<<1),a=o+1,s=t[o];if(a<this.length&&r(t[a],s)<0&&(s=t[o=a]),0<=r(s,n))break;t[e]=s,e=o}t[e]=n}}},{}]},{},[1])(1)}),SimpleHeatmap.prototype=Object.assign(Object.create({}),{constructor:SimpleHeatmap,defaultRadius:25,defaultGradient:{.4:"blue",.6:"cyan",.7:"lime",.8:"yellow",1:"red"},canvas:function(){return this._canvas},data:function(e){return this._data=e,this._dataDirty=!0,this},add:function(e){return this._data.push(e),this._dataDirty=!0,this},clear:function(){return this._data=[],this._dataDirty=!0,this},max:function(e){return this._max!==e&&(this._max=e,this._dataDirty=!0),this},min:function(e){return this._min!==e&&(this._min=e,this._dataDirty=!0),this},setCanvasSize:function(e,t){return this._canvasWidth===e&&this._canvasHeight===t||(this._canvasWidth=this._canvas.width=e,this._canvasHeight=this._canvas.height=t,this._dataDirty=!0),this},setAreaSize:function(e,t){return this._areaWidth===e&&this._areaHeight===t||(this._areaWidth=e,this._areaHeight=t,this._dataDirty=!0),this},alpha:function(e){return this._alpha=e,this},radius:function(e,t){if(t=void 0!==t?t:15,e===this._radius&&t===this._blur)return this;this._radius=e,this._blur=t,this._r=this._radius+this._blur;var r=this._circle,i=this._cirCtx;return r.width=r.height=2*this._r,i.shadowOffsetX=i.shadowOffsetY=2*this._r,i.shadowBlur=t,i.shadowColor="black",i.beginPath(),i.arc(-this._r,-this._r,e,0,2*Math.PI,!0),i.closePath(),i.fill(),this},gradient:function(e){var t=this._getGradientCode(this._grad),r=this._getGradientCode(e);if(t===r)return this;if(this._grad=Object.assign({},e),this._gradCache[r])return this._gradData=this._gradCache[r],this;var i=this._gradCtx.createLinearGradient(0,0,0,256);for(var n in e)i.addColorStop(+n,e[n]);return this._gradCtx.fillStyle=i,this._gradCtx.fillRect(0,0,1,256),this._gradData=this._gradCtx.getImageData(0,0,1,256).data,this._gradCache[r]=this._gradData,this},draw:function(){0===this._r&&this.radius(this.defaultRadius),this._gradData||this.gradient(this.defaultGradient),this._dataDirty&&this._transformData();var e=this._ctx;e.clearRect(0,0,this._canvasWidth,this._canvasHeight);for(var t,r=0,i=this._transformedData.length;r<i;r++)t=this._transformedData[r],e.globalAlpha=t[2],e.drawImage(this._circle,t[0]-this._r,t[1]-this._r);var n=e.getImageData(0,0,this._canvasWidth,this._canvasHeight);return this._colorize(n.data,this._gradData,this._alpha),e.putImageData(n,0,0),this},_transformData:function(){this._transformedData=[];var n=this._canvasWidth/this._areaWidth,o=this._canvasHeight/this._areaHeight,a=this;this._data.map(function(e){var t=e[0],r=e[1];t=t*n+a._canvasWidth/2,r=r*o+a._canvasHeight/2;var i=Math.min(Math.max((e[2]-a._min)/(a._max-a._min),.05),1);a._transformedData.push([t,r,i])})},_colorize:function(e,t,r){for(var i,n=0,o=e.length;n<o;n+=4)i=4*e[n+3],r&&0===i||(e[n]=t[i],e[n+1]=t[i+1],e[n+2]=t[i+2],r||(e[n+3]=255))},_getGradientCode:function(e){var t="grad:(";for(var r in e)t+=r+":"+e[r]+",";return t+=")"},_createCanvas:function(){return"undefined"!=typeof document?document.createElement("canvas"):new this._canvas.constructor}}),function(e){if("object"==typeof exports)module.exports=e();else if("function"==typeof define&&define.amd)define(e);else{var t;try{t=window}catch(e){t=self}t.SparkMD5=e()}}(function(u){"use strict";var i=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function c(e,t){var r=e[0],i=e[1],n=e[2],o=e[3];i=((i+=((n=((n+=((o=((o+=((r=((r+=(i&n|~i&o)+t[0]-680876936|0)<<7|r>>>25)+i|0)&i|~r&n)+t[1]-389564586|0)<<12|o>>>20)+r|0)&r|~o&i)+t[2]+606105819|0)<<17|n>>>15)+o|0)&o|~n&r)+t[3]-1044525330|0)<<22|i>>>10)+n|0,i=((i+=((n=((n+=((o=((o+=((r=((r+=(i&n|~i&o)+t[4]-176418897|0)<<7|r>>>25)+i|0)&i|~r&n)+t[5]+1200080426|0)<<12|o>>>20)+r|0)&r|~o&i)+t[6]-1473231341|0)<<17|n>>>15)+o|0)&o|~n&r)+t[7]-45705983|0)<<22|i>>>10)+n|0,i=((i+=((n=((n+=((o=((o+=((r=((r+=(i&n|~i&o)+t[8]+1770035416|0)<<7|r>>>25)+i|0)&i|~r&n)+t[9]-1958414417|0)<<12|o>>>20)+r|0)&r|~o&i)+t[10]-42063|0)<<17|n>>>15)+o|0)&o|~n&r)+t[11]-1990404162|0)<<22|i>>>10)+n|0,i=((i+=((n=((n+=((o=((o+=((r=((r+=(i&n|~i&o)+t[12]+1804603682|0)<<7|r>>>25)+i|0)&i|~r&n)+t[13]-40341101|0)<<12|o>>>20)+r|0)&r|~o&i)+t[14]-1502002290|0)<<17|n>>>15)+o|0)&o|~n&r)+t[15]+1236535329|0)<<22|i>>>10)+n|0,i=((i+=((n=((n+=((o=((o+=((r=((r+=(i&o|n&~o)+t[1]-165796510|0)<<5|r>>>27)+i|0)&n|i&~n)+t[6]-1069501632|0)<<9|o>>>23)+r|0)&i|r&~i)+t[11]+643717713|0)<<14|n>>>18)+o|0)&r|o&~r)+t[0]-373897302|0)<<20|i>>>12)+n|0,i=((i+=((n=((n+=((o=((o+=((r=((r+=(i&o|n&~o)+t[5]-701558691|0)<<5|r>>>27)+i|0)&n|i&~n)+t[10]+38016083|0)<<9|o>>>23)+r|0)&i|r&~i)+t[15]-660478335|0)<<14|n>>>18)+o|0)&r|o&~r)+t[4]-405537848|0)<<20|i>>>12)+n|0,i=((i+=((n=((n+=((o=((o+=((r=((r+=(i&o|n&~o)+t[9]+568446438|0)<<5|r>>>27)+i|0)&n|i&~n)+t[14]-1019803690|0)<<9|o>>>23)+r|0)&i|r&~i)+t[3]-187363961|0)<<14|n>>>18)+o|0)&r|o&~r)+t[8]+1163531501|0)<<20|i>>>12)+n|0,i=((i+=((n=((n+=((o=((o+=((r=((r+=(i&o|n&~o)+t[13]-1444681467|0)<<5|r>>>27)+i|0)&n|i&~n)+t[2]-51403784|0)<<9|o>>>23)+r|0)&i|r&~i)+t[7]+1735328473|0)<<14|n>>>18)+o|0)&r|o&~r)+t[12]-1926607734|0)<<20|i>>>12)+n|0,i=((i+=((n=((n+=((o=((o+=((r=((r+=(i^n^o)+t[5]-378558|0)<<4|r>>>28)+i|0)^i^n)+t[8]-2022574463|0)<<11|o>>>21)+r|0)^r^i)+t[11]+1839030562|0)<<16|n>>>16)+o|0)^o^r)+t[14]-35309556|0)<<23|i>>>9)+n|0,i=((i+=((n=((n+=((o=((o+=((r=((r+=(i^n^o)+t[1]-1530992060|0)<<4|r>>>28)+i|0)^i^n)+t[4]+1272893353|0)<<11|o>>>21)+r|0)^r^i)+t[7]-155497632|0)<<16|n>>>16)+o|0)^o^r)+t[10]-1094730640|0)<<23|i>>>9)+n|0,i=((i+=((n=((n+=((o=((o+=((r=((r+=(i^n^o)+t[13]+681279174|0)<<4|r>>>28)+i|0)^i^n)+t[0]-358537222|0)<<11|o>>>21)+r|0)^r^i)+t[3]-722521979|0)<<16|n>>>16)+o|0)^o^r)+t[6]+76029189|0)<<23|i>>>9)+n|0,i=((i+=((n=((n+=((o=((o+=((r=((r+=(i^n^o)+t[9]-640364487|0)<<4|r>>>28)+i|0)^i^n)+t[12]-421815835|0)<<11|o>>>21)+r|0)^r^i)+t[15]+530742520|0)<<16|n>>>16)+o|0)^o^r)+t[2]-995338651|0)<<23|i>>>9)+n|0,i=((i+=((o=((o+=(i^((r=((r+=(n^(i|~o))+t[0]-198630844|0)<<6|r>>>26)+i|0)|~n))+t[7]+1126891415|0)<<10|o>>>22)+r|0)^((n=((n+=(r^(o|~i))+t[14]-1416354905|0)<<15|n>>>17)+o|0)|~r))+t[5]-57434055|0)<<21|i>>>11)+n|0,i=((i+=((o=((o+=(i^((r=((r+=(n^(i|~o))+t[12]+1700485571|0)<<6|r>>>26)+i|0)|~n))+t[3]-1894986606|0)<<10|o>>>22)+r|0)^((n=((n+=(r^(o|~i))+t[10]-1051523|0)<<15|n>>>17)+o|0)|~r))+t[1]-2054922799|0)<<21|i>>>11)+n|0,i=((i+=((o=((o+=(i^((r=((r+=(n^(i|~o))+t[8]+1873313359|0)<<6|r>>>26)+i|0)|~n))+t[15]-30611744|0)<<10|o>>>22)+r|0)^((n=((n+=(r^(o|~i))+t[6]-1560198380|0)<<15|n>>>17)+o|0)|~r))+t[13]+1309151649|0)<<21|i>>>11)+n|0,i=((i+=((o=((o+=(i^((r=((r+=(n^(i|~o))+t[4]-145523070|0)<<6|r>>>26)+i|0)|~n))+t[11]-1120210379|0)<<10|o>>>22)+r|0)^((n=((n+=(r^(o|~i))+t[2]+718787259|0)<<15|n>>>17)+o|0)|~r))+t[9]-343485551|0)<<21|i>>>11)+n|0,e[0]=r+e[0]|0,e[1]=i+e[1]|0,e[2]=n+e[2]|0,e[3]=o+e[3]|0}function h(e){var t,r=[];for(t=0;t<64;t+=4)r[t>>2]=e.charCodeAt(t)+(e.charCodeAt(t+1)<<8)+(e.charCodeAt(t+2)<<16)+(e.charCodeAt(t+3)<<24);return r}function p(e){var t,r=[];for(t=0;t<64;t+=4)r[t>>2]=e[t]+(e[t+1]<<8)+(e[t+2]<<16)+(e[t+3]<<24);return r}function n(e){var t,r,i,n,o,a,s=e.length,l=[1732584193,-271733879,-1732584194,271733878];for(t=64;t<=s;t+=64)c(l,h(e.substring(t-64,t)));for(r=(e=e.substring(t-64)).length,i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],t=0;t<r;t+=1)i[t>>2]|=e.charCodeAt(t)<<(t%4<<3);if(i[t>>2]|=128<<(t%4<<3),55<t)for(c(l,i),t=0;t<16;t+=1)i[t]=0;return n=(n=8*s).toString(16).match(/(.*?)(.{0,8})$/),o=parseInt(n[2],16),a=parseInt(n[1],16)||0,i[14]=o,i[15]=a,c(l,i),l}function r(e){var t,r="";for(t=0;t<4;t+=1)r+=i[e>>8*t+4&15]+i[e>>8*t&15];return r}function a(e){var t;for(t=0;t<e.length;t+=1)e[t]=r(e[t]);return e.join("")}function o(e){return/[\u0080-\uFFFF]/.test(e)&&(e=unescape(encodeURIComponent(e))),e}function s(e){var t,r=[],i=e.length;for(t=0;t<i-1;t+=2)r.push(parseInt(e.substr(t,2),16));return String.fromCharCode.apply(String,r)}function l(){this.reset()}return"5d41402abc4b2a76b9719d911017c592"!==a(n("hello"))&&function(e,t){var r=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(r>>16)<<16|65535&r},"undefined"==typeof ArrayBuffer||ArrayBuffer.prototype.slice||function(){function c(e,t){return(e=0|e||0)<0?Math.max(e+t,0):Math.min(e,t)}ArrayBuffer.prototype.slice=function(e,t){var r,i,n,o,a=this.byteLength,s=c(e,a),l=a;return t!==u&&(l=c(t,a)),l<s?new ArrayBuffer(0):(r=l-s,i=new ArrayBuffer(r),n=new Uint8Array(i),o=new Uint8Array(this,s,r),n.set(o),i)}}(),l.prototype.append=function(e){return this.appendBinary(o(e)),this},l.prototype.appendBinary=function(e){this._buff+=e,this._length+=e.length;var t,r=this._buff.length;for(t=64;t<=r;t+=64)c(this._hash,h(this._buff.substring(t-64,t)));return this._buff=this._buff.substring(t-64),this},l.prototype.end=function(e){var t,r,i=this._buff,n=i.length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<n;t+=1)o[t>>2]|=i.charCodeAt(t)<<(t%4<<3);return this._finish(o,n),r=a(this._hash),e&&(r=s(r)),this.reset(),r},l.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},l.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash}},l.prototype.setState=function(e){return this._buff=e.buff,this._length=e.length,this._hash=e.hash,this},l.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},l.prototype._finish=function(e,t){var r,i,n,o=t;if(e[o>>2]|=128<<(o%4<<3),55<o)for(c(this._hash,e),o=0;o<16;o+=1)e[o]=0;r=(r=8*this._length).toString(16).match(/(.*?)(.{0,8})$/),i=parseInt(r[2],16),n=parseInt(r[1],16)||0,e[14]=i,e[15]=n,c(this._hash,e)},l.hash=function(e,t){return l.hashBinary(o(e),t)},l.hashBinary=function(e,t){var r=a(n(e));return t?s(r):r},(l.ArrayBuffer=function(){this.reset()}).prototype.append=function(e){var t,r,i,n,o,a=(r=this._buff.buffer,i=e,n=!0,(o=new Uint8Array(r.byteLength+i.byteLength)).set(new Uint8Array(r)),o.set(new Uint8Array(i),r.byteLength),n?o:o.buffer),s=a.length;for(this._length+=e.byteLength,t=64;t<=s;t+=64)c(this._hash,p(a.subarray(t-64,t)));return this._buff=t-64<s?new Uint8Array(a.buffer.slice(t-64)):new Uint8Array(0),this},l.ArrayBuffer.prototype.end=function(e){var t,r,i=this._buff,n=i.length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<n;t+=1)o[t>>2]|=i[t]<<(t%4<<3);return this._finish(o,n),r=a(this._hash),e&&(r=s(r)),this.reset(),r},l.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},l.ArrayBuffer.prototype.getState=function(){var e,t=l.prototype.getState.call(this);return t.buff=(e=t.buff,String.fromCharCode.apply(null,new Uint8Array(e))),t},l.ArrayBuffer.prototype.setState=function(e){return e.buff=function(e,t){var r,i=e.length,n=new ArrayBuffer(i),o=new Uint8Array(n);for(r=0;r<i;r+=1)o[r]=e.charCodeAt(r);return t?o:n}(e.buff,!0),l.prototype.setState.call(this,e)},l.ArrayBuffer.prototype.destroy=l.prototype.destroy,l.ArrayBuffer.prototype._finish=l.prototype._finish,l.ArrayBuffer.hash=function(e,t){var r=a(function(e){var t,r,i,n,o,a,s=e.length,l=[1732584193,-271733879,-1732584194,271733878];for(t=64;t<=s;t+=64)c(l,p(e.subarray(t-64,t)));for(r=(e=t-64<s?e.subarray(t-64):new Uint8Array(0)).length,i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],t=0;t<r;t+=1)i[t>>2]|=e[t]<<(t%4<<3);if(i[t>>2]|=128<<(t%4<<3),55<t)for(c(l,i),t=0;t<16;t+=1)i[t]=0;return n=(n=8*s).toString(16).match(/(.*?)(.{0,8})$/),o=parseInt(n[2],16),a=parseInt(n[1],16)||0,i[14]=o,i[15]=a,c(l,i),l}(new Uint8Array(e)));return t?s(r):r},l});var SPE={distributions:{BOX:1,SPHERE:2,DISC:3},valueOverLifetimeLength:4};function TextEncoderLite(){}function TextDecoderLite(){}"function"==typeof define&&define.amd?define("spe",SPE):"undefined"!=typeof exports&&"undefined"!=typeof module&&(module.exports=SPE),SPE.TypedArrayHelper=function(e,t,r,i){"use strict";this.componentSize=r||1,this.size=t||1,this.TypedArrayConstructor=e||Float32Array,this.array=new e(t*this.componentSize),this.indexOffset=i||0},SPE.TypedArrayHelper.constructor=SPE.TypedArrayHelper,SPE.TypedArrayHelper.prototype.setSize=function(e,t){"use strict";var r=this.array.length;return t||(e*=this.componentSize),e<r?this.shrink(e):r<e?this.grow(e):void console.info("TypedArray is already of size:",e+".","Will not resize.")},SPE.TypedArrayHelper.prototype.shrink=function(e){"use strict";return this.array=this.array.subarray(0,e),this.size=e,this},SPE.TypedArrayHelper.prototype.grow=function(e){"use strict";var t=this.array,r=new this.TypedArrayConstructor(e);return r.set(t),this.array=r,this.size=e,this},SPE.TypedArrayHelper.prototype.splice=function(e,t){"use strict";e*=this.componentSize,t*=this.componentSize;for(var r=[],i=this.array,n=i.length,o=0;o<n;++o)(o<e||t<=o)&&r.push(i[o]);return this.setFromArray(0,r),this},SPE.TypedArrayHelper.prototype.setFromArray=function(e,t){"use strict";var r=e+t.length;return r>this.array.length?this.grow(r):r<this.array.length&&this.shrink(r),this.array.set(t,this.indexOffset+e),this},SPE.TypedArrayHelper.prototype.setVec2=function(e,t){"use strict";return this.setVec2Components(e,t.x,t.y)},SPE.TypedArrayHelper.prototype.setVec2Components=function(e,t,r){"use strict";var i=this.array,n=this.indexOffset+e*this.componentSize;return i[n]=t,i[n+1]=r,this},SPE.TypedArrayHelper.prototype.setVec3=function(e,t){"use strict";return this.setVec3Components(e,t.x,t.y,t.z)},SPE.TypedArrayHelper.prototype.setVec3Components=function(e,t,r,i){"use strict";var n=this.array,o=this.indexOffset+e*this.componentSize;return n[o]=t,n[o+1]=r,n[o+2]=i,this},SPE.TypedArrayHelper.prototype.setVec4=function(e,t){"use strict";return this.setVec4Components(e,t.x,t.y,t.z,t.w)},SPE.TypedArrayHelper.prototype.setVec4Components=function(e,t,r,i,n){"use strict";var o=this.array,a=this.indexOffset+e*this.componentSize;return o[a]=t,o[a+1]=r,o[a+2]=i,o[a+3]=n,this},SPE.TypedArrayHelper.prototype.setMat3=function(e,t){"use strict";return this.setFromArray(this.indexOffset+e*this.componentSize,t.elements)},SPE.TypedArrayHelper.prototype.setMat4=function(e,t){"use strict";return this.setFromArray(this.indexOffset+e*this.componentSize,t.elements)},SPE.TypedArrayHelper.prototype.setColor=function(e,t){"use strict";return this.setVec3Components(e,t.r,t.g,t.b)},SPE.TypedArrayHelper.prototype.setNumber=function(e,t){"use strict";return this.array[this.indexOffset+e*this.componentSize]=t,this},SPE.TypedArrayHelper.prototype.getValueAtIndex=function(e){"use strict";return this.array[this.indexOffset+e]},SPE.TypedArrayHelper.prototype.getComponentValueAtIndex=function(e){"use strict";return this.array.subarray(this.indexOffset+e*this.componentSize)},SPE.ShaderAttribute=function(e,t,r){"use strict";var i=SPE.ShaderAttribute.typeSizeMap;this.type="string"==typeof e&&i.hasOwnProperty(e)?e:"f",this.componentSize=i[this.type],this.arrayType=r||Float32Array,this.typedArray=null,this.bufferAttribute=null,this.dynamicBuffer=!!t,this.updateMin=0,this.updateMax=0},SPE.ShaderAttribute.constructor=SPE.ShaderAttribute,SPE.ShaderAttribute.typeSizeMap={f:1,v2:2,v3:3,v4:4,c:3,m3:9,m4:16},SPE.ShaderAttribute.prototype.setUpdateRange=function(e,t){"use strict";this.updateMin=Math.min(e*this.componentSize,this.updateMin*this.componentSize),this.updateMax=Math.max(t*this.componentSize,this.updateMax*this.componentSize)},SPE.ShaderAttribute.prototype.flagUpdate=function(){"use strict";var e=this.bufferAttribute,t=e.updateRange;t.offset=this.updateMin,t.count=Math.min(this.updateMax-this.updateMin+this.componentSize,this.typedArray.array.length),e.needsUpdate=!0},SPE.ShaderAttribute.prototype.resetUpdateRange=function(){"use strict";this.updateMin=0,this.updateMax=0},SPE.ShaderAttribute.prototype.resetDynamic=function(){"use strict";this.bufferAttribute.dynamic=this.dynamicBuffer},SPE.ShaderAttribute.prototype.splice=function(e,t){"use strict";this.typedArray.splice(e,t),this.forceUpdateAll()},SPE.ShaderAttribute.prototype.forceUpdateAll=function(){"use strict";this.bufferAttribute.array=this.typedArray.array,this.bufferAttribute.updateRange.offset=0,this.bufferAttribute.updateRange.count=-1,this.bufferAttribute.dynamic=!1,this.bufferAttribute.needsUpdate=!0},SPE.ShaderAttribute.prototype._ensureTypedArray=function(e){"use strict";null!==this.typedArray&&this.typedArray.size===e*this.componentSize||(null!==this.typedArray&&this.typedArray.size!==e?this.typedArray.setSize(e):null===this.typedArray&&(this.typedArray=new SPE.TypedArrayHelper(this.arrayType,e,this.componentSize)))},SPE.ShaderAttribute.prototype._createBufferAttribute=function(e){"use strict";if(this._ensureTypedArray(e),null!==this.bufferAttribute)return this.bufferAttribute.array=this.typedArray.array,81<=parseFloat(THREE.REVISION)&&(this.bufferAttribute.count=this.bufferAttribute.array.length/this.bufferAttribute.itemSize),void(this.bufferAttribute.needsUpdate=!0);this.bufferAttribute=new THREE.BufferAttribute(this.typedArray.array,this.componentSize),this.bufferAttribute.dynamic=this.dynamicBuffer},SPE.ShaderAttribute.prototype.getLength=function(){"use strict";return null===this.typedArray?0:this.typedArray.array.length},SPE.shaderChunks={defines:["#define PACKED_COLOR_SIZE 256.0","#define PACKED_COLOR_DIVISOR 255.0"].join("\n"),uniforms:["uniform float deltaTime;","uniform float runTime;","uniform sampler2D tex;","uniform vec4 textureAnimation;","uniform float scale;"].join("\n"),attributes:["attribute vec4 acceleration;","attribute vec3 velocity;","attribute vec4 rotation;","attribute vec3 rotationCenter;","attribute vec4 params;","attribute vec4 size;","attribute vec4 angle;","attribute vec4 color;","attribute vec4 opacity;","attribute vec4 trail;"].join("\n"),varyings:["varying vec4 vColor;","//#ifdef SHOULD_ROTATE_TEXTURE","    varying float vAngle;","//#endif","#ifdef SHOULD_CALCULATE_SPRITE","    varying vec4 vSpriteSheet;","#endif","#ifdef SHOULD_TRAIL_PARTICLES","    varying float fTrailSpeed;","    varying vec4 vec4Path_0;","    varying vec4 vec4Path_1;","    varying vec4 vec4Path_2;","    varying vec4 vec4Path_3;","    varying vec4 vec4Path_4;","    varying vec4 vec4Path_5;","    varying vec4 vec4Path_6;","    varying vec4 vec4Path_7;","    varying vec4 vec4Path_8;","    varying vec4 vec4Path_9;","#endif"].join("\n"),branchAvoidanceFunctions:["float when_gt(float x, float y) {","    return max(sign(x - y), 0.0);","}","float when_lt(float x, float y) {","    return min( max(1.0 - sign(x - y), 0.0), 1.0 );","}","float when_eq( float x, float y ) {","    return 1.0 - abs( sign( x - y ) );","}","float when_ge(float x, float y) {","  return 1.0 - when_lt(x, y);","}","float when_le(float x, float y) {","  return 1.0 - when_gt(x, y);","}","float and(float a, float b) {","    return a * b;","}","float or(float a, float b) {","    return min(a + b, 1.0);","}"].join("\n"),unpackColor:["vec3 unpackColor( in float hex ) {","   vec3 c = vec3( 0.0 );","   float r = mod( (hex / PACKED_COLOR_SIZE / PACKED_COLOR_SIZE), PACKED_COLOR_SIZE );","   float g = mod( (hex / PACKED_COLOR_SIZE), PACKED_COLOR_SIZE );","   float b = mod( hex, PACKED_COLOR_SIZE );","   c.r = r / PACKED_COLOR_DIVISOR;","   c.g = g / PACKED_COLOR_DIVISOR;","   c.b = b / PACKED_COLOR_DIVISOR;","   return c;","}"].join("\n"),unpackRotationAxis:["vec3 unpackRotationAxis( in float hex ) {","   vec3 c = vec3( 0.0 );","   float r = mod( (hex / PACKED_COLOR_SIZE / PACKED_COLOR_SIZE), PACKED_COLOR_SIZE );","   float g = mod( (hex / PACKED_COLOR_SIZE), PACKED_COLOR_SIZE );","   float b = mod( hex, PACKED_COLOR_SIZE );","   c.r = r / PACKED_COLOR_DIVISOR;","   c.g = g / PACKED_COLOR_DIVISOR;","   c.b = b / PACKED_COLOR_DIVISOR;","   c *= vec3( 2.0 );","   c -= vec3( 1.0 );","   return c;","}"].join("\n"),floatOverLifetime:["float getFloatOverLifetime( in float positionInTime, in vec4 attr ) {","    highp float value = 0.0;","    float deltaAge = positionInTime * float( VALUE_OVER_LIFETIME_LENGTH - 1 );","    float fIndex = 0.0;","    float shouldApplyValue = 0.0;","    value += attr[ 0 ] * when_eq( deltaAge, 0.0 );","","    for( int i = 0; i < VALUE_OVER_LIFETIME_LENGTH - 1; ++i ) {","       fIndex = float( i );","       shouldApplyValue = and( when_gt( deltaAge, fIndex ), when_le( deltaAge, fIndex + 1.0 ) );","       value += shouldApplyValue * mix( attr[ i ], attr[ i + 1 ], deltaAge - fIndex );","    }","","    return value;","}"].join("\n"),colorOverLifetime:["vec3 getColorOverLifetime( in float positionInTime, in vec3 color1, in vec3 color2, in vec3 color3, in vec3 color4 ) {","    vec3 value = vec3( 0.0 );","    value.x = getFloatOverLifetime( positionInTime, vec4( color1.x, color2.x, color3.x, color4.x ) );","    value.y = getFloatOverLifetime( positionInTime, vec4( color1.y, color2.y, color3.y, color4.y ) );","    value.z = getFloatOverLifetime( positionInTime, vec4( color1.z, color2.z, color3.z, color4.z ) );","    return value;","}"].join("\n"),paramFetchingFunctions:["float getAlive() {","   return params.x;","}","float getAge() {","   return params.y;","}","float getMaxAge() {","   return params.z;","}","float getWiggle() {","   return params.w;","}"].join("\n"),forceFetchingFunctions:["vec4 getPosition( in float age ) {","   return modelViewMatrix * vec4( position, 1.0 );","}","vec3 getVelocity( in float age ) {","   return velocity * age;","}","vec3 getAcceleration( in float age ) {","   return acceleration.xyz * age;","}"].join("\n"),rotationFunctions:["#ifdef SHOULD_ROTATE_PARTICLES","   mat4 getRotationMatrix( in vec3 axis, in float angle) {","       axis = normalize(axis);","       float s = sin(angle);","       float c = cos(angle);","       float oc = 1.0 - c;","","       return mat4(oc * axis.x * axis.x + c,           oc * axis.x * axis.y - axis.z * s,  oc * axis.z * axis.x + axis.y * s,  0.0,","                   oc * axis.x * axis.y + axis.z * s,  oc * axis.y * axis.y + c,           oc * axis.y * axis.z - axis.x * s,  0.0,","                   oc * axis.z * axis.x - axis.y * s,  oc * axis.y * axis.z + axis.x * s,  oc * axis.z * axis.z + c,           0.0,","                   0.0,                                0.0,                                0.0,                                1.0);","   }","","   vec3 getRotation( in vec3 pos, in float positionInTime ) {","      if( rotation.y == 0.0 ) {","           return pos;","      }","","      vec3 axis = unpackRotationAxis( rotation.x );","      vec3 center = rotationCenter;","      vec3 translated;","      mat4 rotationMatrix;","      float angle = 0.0;","      angle += when_eq( rotation.z, 0.0 ) * rotation.y;","      angle += when_gt( rotation.z, 0.0 ) * mix( 0.0, rotation.y, positionInTime );","      translated = rotationCenter - pos;","      rotationMatrix = getRotationMatrix( axis, angle );","      return center - vec3( rotationMatrix * vec4( translated, 0.0 ) );","   }","#endif"].join("\n"),rotateTexture:["    vec2 vUv = vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y );","","    #ifdef SHOULD_ROTATE_TEXTURE","       float x = gl_PointCoord.x - 0.5;","       float y = 1.0 - gl_PointCoord.y - 0.5;","       float c = cos( -vAngle );","       float s = sin( -vAngle );","       vUv = vec2( c * x + s * y + 0.5, c * y - s * x + 0.5 );","    #endif","","    #ifdef SHOULD_CALCULATE_SPRITE","        float framesX = vSpriteSheet.x;","        float framesY = vSpriteSheet.y;","        float columnNorm = vSpriteSheet.z;","        float rowNorm = vSpriteSheet.w;","        vUv.x = gl_PointCoord.x * framesX + columnNorm;","        vUv.y = 1.0 - (gl_PointCoord.y * framesY + rowNorm);","       if(vAngle != 0.0)","       {","           lowp float cos50 = cos(-vAngle);","           lowp float sin50 = sin(-vAngle);","           vec2 rotator50 = vUv;","           lowp float fWCeil = 1.0 / textureAnimation.x;","           lowp float fHCeil = 1.0 / textureAnimation.y;","           lowp float fHalfWCeil = fWCeil * 0.5;","           lowp float fHalfHCeil = fHCeil * 0.5;","           lowp float fXCenter = 0.0;","           lowp float fYCenter = 0.0;","           for(lowp float i = 0.0; i < 20.0; i+=1.0)","           {","               if(i >= textureAnimation.x) break;","               for(lowp float j = 0.0; j < 20.0; j+=1.0)","               {","                   if(j >= textureAnimation.y) break;","                   fXCenter = (i) * (fWCeil) + fHalfWCeil;","                   fYCenter = (j) * (fHCeil) + fHalfHCeil;","                   if(pow(((vUv.x - fXCenter)/(fHalfWCeil)), 2.0) + pow(((vUv.y - fYCenter)/(fHalfHCeil)), 2.0) <= 1.0)","                       rotator50 = (mat2( cos50 , -sin50 , sin50 , cos50 ) * (vUv - vec2( fXCenter,fYCenter ))) + vec2( fXCenter,fYCenter );","                   vUv = rotator50;","               }","           }","       }","      #else","       if(vAngle != 0.0)","       {","           lowp float cos50 = cos(-vAngle);","           lowp float sin50 = sin(-vAngle);","           vec2 rotator50 = vUv;","           lowp float fWCeil = 1.0 / textureAnimation.x;","           lowp float fHCeil = 1.0 / textureAnimation.y;","           lowp float fHalfWCeil = fWCeil * 0.5;","           lowp float fHalfHCeil = fHCeil * 0.5;","           lowp float fXCenter = 0.0;","           lowp float fYCenter = 0.0;","           for(lowp float i = 0.0; i < 20.0; i+=1.0)","           {","               if(i >= textureAnimation.x) break;","               for(lowp float j = 0.0; j < 20.0; j+=1.0)","               {","                   if(j >= textureAnimation.y) break;","                   fXCenter = (i) * (fWCeil) + fHalfWCeil;","                   fYCenter = (j) * (fHCeil) + fHalfHCeil;","                   if(pow(((vUv.x - fXCenter)/(fHalfWCeil)), 2.0) + pow(((vUv.y - fYCenter)/(fHalfHCeil)), 2.0) <= 1.0)","                       rotator50 = (mat2( cos50 , -sin50 , sin50 , cos50 ) * (vUv - vec2( fXCenter,fYCenter ))) + vec2( fXCenter,fYCenter );","                   vUv = rotator50;","               }","           }","       }","    #endif","","    vec4 rotatedTexture = texture2D( tex, vUv );","    #ifdef SHOULD_TRAIL_PARTICLES","\t    float fVelocityScale = fTrailSpeed;","\t    vec2 a_0 = (vec4Path_1.xy / vec4Path_1.w) * 0.5 + 0.5;","\t    vec2 b_0 = (vec4Path_0.xy / vec4Path_0.w) * 0.5 + 0.5;","\t    vec2 velocity_0 = fVelocityScale * (a_0 - b_0);","\t    vec2 a_1 = (vec4Path_2.xy / vec4Path_2.w) * 0.5 + 0.5;","\t    vec2 b_1 = (vec4Path_1.xy / vec4Path_1.w) * 0.5 + 0.5;","\t    vec2 velocity_1 = fVelocityScale * (a_1 - b_0);","\t    vec2 a_2 = (vec4Path_3.xy / vec4Path_3.w) * 0.5 + 0.5;","\t    vec2 b_2 = (vec4Path_2.xy / vec4Path_2.w) * 0.5 + 0.5;","\t    vec2 velocity_2 = fVelocityScale * (a_2 - b_0);","\t    vec2 a_3 = (vec4Path_4.xy / vec4Path_4.w) * 0.5 + 0.5;","\t    vec2 b_3 = (vec4Path_3.xy / vec4Path_3.w) * 0.5 + 0.5;","\t    vec2 velocity_3 = fVelocityScale * (a_3 - b_0);","\t    vec2 a_4 = (vec4Path_5.xy / vec4Path_5.w) * 0.5 + 0.5;","\t    vec2 b_4 = (vec4Path_4.xy / vec4Path_4.w) * 0.5 + 0.5;","\t    vec2 velocity_4 = fVelocityScale * (a_4 - b_0);","\t    vec2 a_5 = (vec4Path_6.xy / vec4Path_6.w) * 0.5 + 0.5;","\t    vec2 b_5 = (vec4Path_5.xy / vec4Path_5.w) * 0.5 + 0.5;","\t    vec2 velocity_5 = fVelocityScale * (a_5 - b_0);","\t    vec2 a_6 = (vec4Path_7.xy / vec4Path_7.w) * 0.5 + 0.5;","\t    vec2 b_6 = (vec4Path_6.xy / vec4Path_6.w) * 0.5 + 0.5;","\t    vec2 velocity_6 = fVelocityScale * (a_6 - b_0);","\t    vec2 a_7 = (vec4Path_8.xy / vec4Path_8.w) * 0.5 + 0.5;","\t    vec2 b_7 = (vec4Path_7.xy / vec4Path_7.w) * 0.5 + 0.5;","\t    vec2 velocity_7 = fVelocityScale * (a_7 - b_0);","\t    vec2 a_8 = (vec4Path_9.xy / vec4Path_9.w) * 0.5 + 0.5;","\t    vec2 b_8 = (vec4Path_8.xy / vec4Path_8.w) * 0.5 + 0.5;","\t    vec2 velocity_8 = fVelocityScale * (a_8 - b_0);","\t    vec4 oResult;","\t    oResult = texture2D(tex, vUv);","\t    vec2 offset_0 = velocity_0 * (float(1) / float(9) - 0.5);","\t    vec2 offset_1 = velocity_1 * (float(2) / float(9) - 0.5);","\t    vec2 offset_2 = velocity_2 * (float(3) / float(9) - 0.5);","\t    vec2 offset_3 = velocity_3 * (float(4) / float(9) - 0.5);","\t    vec2 offset_4 = velocity_4 * (float(5) / float(9) - 0.5);","\t    vec2 offset_5 = velocity_5 * (float(6) / float(9) - 0.5);","\t    vec2 offset_6 = velocity_6 * (float(7) / float(9) - 0.5);","\t    vec2 offset_7 = velocity_7 * (float(8) / float(9) - 0.5);","\t    vec2 offset_8 = velocity_8 * (float(9) / float(9) - 0.5);","\t    oResult += texture2D(tex, vUv + offset_0);","\t    oResult += texture2D(tex, vUv + offset_1);","\t    oResult += texture2D(tex, vUv + offset_2);","\t    oResult += texture2D(tex, vUv + offset_3);","\t    oResult += texture2D(tex, vUv + offset_4);","\t    oResult += texture2D(tex, vUv + offset_5);","\t    oResult += texture2D(tex, vUv + offset_6);","\t    oResult += texture2D(tex, vUv + offset_7);","\t    oResult += texture2D(tex, vUv + offset_8);","       rotatedTexture = oResult;","    #endif"].join("\n")},SPE.shaders={vertex:[SPE.shaderChunks.defines,SPE.shaderChunks.uniforms,SPE.shaderChunks.attributes,SPE.shaderChunks.varyings,THREE.ShaderChunk.common,THREE.ShaderChunk.logdepthbuf_pars_vertex,THREE.ShaderChunk.fog_pars_vertex,SPE.shaderChunks.branchAvoidanceFunctions,SPE.shaderChunks.unpackColor,SPE.shaderChunks.unpackRotationAxis,SPE.shaderChunks.floatOverLifetime,SPE.shaderChunks.colorOverLifetime,SPE.shaderChunks.paramFetchingFunctions,SPE.shaderChunks.forceFetchingFunctions,SPE.shaderChunks.rotationFunctions,"void main() {","    highp float age = getAge();","    highp float alive = getAlive();","    highp float maxAge = getMaxAge();","    highp float positionInTime = (age / maxAge);","    highp float isAlive = when_gt( alive, 0.0 );","    #ifdef SHOULD_WIGGLE_PARTICLES","        float wiggleAmount = positionInTime * getWiggle();","        float wiggleSin = isAlive * sin( wiggleAmount );","        float wiggleCos = isAlive * cos( wiggleAmount );","    #endif","    vec3 vel = getVelocity( age );","    vec3 accel = getAcceleration( age );","    vec3 force = vec3( 0.0 );","    vec3 pos = vec3( position );","    float drag = 1.0 - (positionInTime * 0.5) * acceleration.w;","    force += vel;","    force *= drag;","    force += accel * age;","    pos += force;","    #ifdef SHOULD_WIGGLE_PARTICLES","        pos.x += wiggleSin;","        pos.y += wiggleCos;","        pos.z += wiggleSin;","    #endif","    #ifdef SHOULD_ROTATE_PARTICLES","        pos = getRotation( pos, positionInTime );","    #endif","    vec4 mvPosition = modelViewMatrix * vec4( pos, 1.0 );","    #ifdef SHOULD_TRAIL_PARTICLES","    float fTimeStep = trail.x * trail.z;","    fTrailSpeed = trail.y;","    for(int i = 0; i < 10; i++)","    {","       highp float age_i = age - float(i) * fTimeStep;","       highp float positionInTime_i = (age_i / maxAge);","       #ifdef SHOULD_WIGGLE_PARTICLES","           float wiggleAmount_i = positionInTime_i * getWiggle();","           float wiggleSin_i = isAlive * sin( wiggleAmount_i );","           float wiggleCos_i = isAlive * cos( wiggleAmount_i );","       #endif","       vec3 vel_i = getVelocity( age_i );","       vec3 accel_i = getAcceleration( age_i );","       vec3 force_i = vec3( 0.0 );","       vec3 pos_i = vec3( position );","       float drag_i = 1.0 - (positionInTime_i * 0.5) * acceleration.w;","       force_i += vel_i;","       force_i *= drag_i;","       force_i += accel_i * age_i;","       pos_i += force_i;","       #ifdef SHOULD_WIGGLE_PARTICLES","           pos_i.x += wiggleSin_i;","           pos_i.y += wiggleCos_i;","           pos_i.z += wiggleSin_i;","       #endif","       #ifdef SHOULD_ROTATE_PARTICLES","           pos_i = getRotation( pos_i, positionInTime_i );","       #endif","       vec4 mvPosition_i = projectionMatrix * modelViewMatrix * vec4( pos_i, 1.0 );","       if(i == 0) vec4Path_0 = mvPosition_i;","       if(i == 1) vec4Path_1 = mvPosition_i;","       if(i == 2) vec4Path_2 = mvPosition_i;","       if(i == 3) vec4Path_3 = mvPosition_i;","       if(i == 4) vec4Path_4 = mvPosition_i;","       if(i == 5) vec4Path_5 = mvPosition_i;","       if(i == 6) vec4Path_6 = mvPosition_i;","       if(i == 7) vec4Path_7 = mvPosition_i;","       if(i == 8) vec4Path_8 = mvPosition_i;","       if(i == 9) vec4Path_9 = mvPosition_i;","    }","    #endif","    highp float pointSize = getFloatOverLifetime( positionInTime, size ) * isAlive;","    #ifdef HAS_PERSPECTIVE","        float perspective = scale / length( mvPosition.xyz );","    #else","        float perspective = 1.0;","    #endif","    float pointSizePerspective = pointSize * perspective;","    #ifdef COLORIZE","       vec3 c = isAlive * getColorOverLifetime(","           positionInTime,","           unpackColor( color.x ),","           unpackColor( color.y ),","           unpackColor( color.z ),","           unpackColor( color.w )","       );","    #else","       vec3 c = vec3(1.0);","    #endif","    float o = isAlive * getFloatOverLifetime( positionInTime, opacity );","    vColor = vec4( c, o );","    //#ifdef SHOULD_ROTATE_TEXTURE","        vAngle = isAlive * getFloatOverLifetime( positionInTime, angle );","    //#endif","    #ifdef SHOULD_CALCULATE_SPRITE","        float framesX = textureAnimation.x;","        float framesY = textureAnimation.y;","        float loopCount = textureAnimation.w;","        float totalFrames = textureAnimation.z;","        float frameNumber = mod( (positionInTime * loopCount) * totalFrames, totalFrames );","        float column = floor(mod( frameNumber, framesX ));","        float row = floor( (frameNumber - column) / framesX );","        float columnNorm = column / framesX;","        float rowNorm = row / framesY;","        vSpriteSheet.x = 1.0 / framesX;","        vSpriteSheet.y = 1.0 / framesY;","        vSpriteSheet.z = columnNorm;","        vSpriteSheet.w = rowNorm;","    #endif","    gl_PointSize = pointSizePerspective;","    gl_Position = projectionMatrix * mvPosition;",THREE.ShaderChunk.logdepthbuf_vertex,THREE.ShaderChunk.fog_vertex,"}"].join("\n"),fragment:[SPE.shaderChunks.uniforms,THREE.ShaderChunk.common,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.logdepthbuf_pars_fragment,SPE.shaderChunks.varyings,SPE.shaderChunks.branchAvoidanceFunctions,"void main() {","    vec3 outgoingLight = vColor.xyz;","    ","    #ifdef ALPHATEST","       if ( vColor.w < float(ALPHATEST) ) discard;","    #endif",SPE.shaderChunks.rotateTexture,THREE.ShaderChunk.logdepthbuf_fragment,"    outgoingLight = vColor.xyz * rotatedTexture.xyz;","    gl_FragColor = vec4( outgoingLight.xyz, rotatedTexture.w * vColor.w );",THREE.ShaderChunk.fog_fragment,"}"].join("\n")},SPE.utils={types:{BOOLEAN:"boolean",STRING:"string",NUMBER:"number",OBJECT:"object"},ensureTypedArg:function(e,t,r){"use strict";return typeof e===t?e:r},ensureArrayTypedArg:function(e,t,r){"use strict";if(Array.isArray(e)){for(var i=e.length-1;0<=i;--i)if(typeof e[i]!==t)return r;return e}return this.ensureTypedArg(e,t,r)},ensureInstanceOf:function(e,t,r){"use strict";return void 0!==t&&e instanceof t?e:r},ensureArrayInstanceOf:function(e,t,r){"use strict";if(Array.isArray(e)){for(var i=e.length-1;0<=i;--i)if(void 0!==t&&e[i]instanceof t==!1)return r;return e}return this.ensureInstanceOf(e,t,r)},ensureValueOverLifetimeCompliance:function(e,t,r){"use strict";t=t||3,r=r||3,!1===Array.isArray(e._value)&&(e._value=[e._value]),!1===Array.isArray(e._spread)&&(e._spread=[e._spread]);var i=this.clamp(e._value.length,t,r),n=this.clamp(e._spread.length,t,r),o=Math.max(i,n);e._value.length!==o&&(e._value=this.interpolateArray(e._value,o)),e._spread.length!==o&&(e._spread=this.interpolateArray(e._spread,o))},interpolateArray:function(e,t){"use strict";for(var r=e.length,i=["function"==typeof e[0].clone?e[0].clone():e[0]],n=(r-1)/(t-1),o=1;o<t-1;++o){var a=o*n,s=Math.floor(a),l=Math.ceil(a),c=a-s;i[o]=this.lerpTypeAgnostic(e[s],e[l],c)}return i.push("function"==typeof e[r-1].clone?e[r-1].clone():e[r-1]),i},clamp:function(e,t,r){"use strict";return Math.max(t,Math.min(e,r))},zeroToEpsilon:function(e,t){"use strict";var r=e;return r=t?1e-5*Math.random()*10:1e-5,e<0&&-1e-5<e&&(r=-r),r},lerpTypeAgnostic:function(e,t,r){"use strict";var i,n=this.types;return typeof e==n.NUMBER&&typeof t==n.NUMBER?e+(t-e)*r:e instanceof THREE.Vector2&&t instanceof THREE.Vector2||typeof e.x==n.NUMBER&&typeof e.y==n.NUMBER&&null==e.z&&null==e.z&&typeof t.x==n.NUMBER&&typeof t.y==n.NUMBER&&null==t.z&&null==t.z?(e instanceof THREE.Vector2?i=e.clone():((i={}).x=e.x,i.y=e.y),i.x=this.lerp(e.x,t.x,r),i.y=this.lerp(e.y,t.y,r),i):e instanceof THREE.Vector3&&t instanceof THREE.Vector3||typeof e.x==n.NUMBER&&typeof e.y==n.NUMBER&&typeof e.z==n.NUMBER&&null==e.w&&null==e.w&&typeof t.x==n.NUMBER&&typeof t.y==n.NUMBER&&typeof t.z==n.NUMBER&&null==t.w&&null==t.w?(e instanceof THREE.Vector3?i=e.clone():((i={}).x=e.x,i.y=e.y,i.z=e.z),i.x=this.lerp(e.x,t.x,r),i.y=this.lerp(e.y,t.y,r),i.z=this.lerp(e.z,t.z,r),i):e instanceof THREE.Vector4&&t instanceof THREE.Vector4||typeof e.x==n.NUMBER&&typeof e.y==n.NUMBER&&typeof e.z==n.NUMBER&&typeof e.w==n.NUMBER&&typeof t.x==n.NUMBER&&typeof t.y==n.NUMBER&&typeof t.z==n.NUMBER&&typeof t.w==n.NUMBER?(e instanceof THREE.Vector4?i=e.clone():((i={}).x=e.x,i.y=e.y,i.z=e.z,i.w=e.w),i.x=this.lerp(e.x,t.x,r),i.y=this.lerp(e.y,t.y,r),i.z=this.lerp(e.z,t.z,r),i.w=this.lerp(e.w,t.w,r),i):e instanceof THREE.Color&&t instanceof THREE.Color||typeof e.r==n.NUMBER&&typeof e.g==n.NUMBER&&typeof e.b==n.NUMBER&&typeof t.r==n.NUMBER&&typeof t.g==n.NUMBER&&typeof t.b==n.NUMBER?(e instanceof THREE.Color?i=e.clone():((i={}).r=e.r,i.g=e.g,i.b=e.b),i.r=this.lerp(e.r,t.r,r),i.g=this.lerp(e.g,t.g,r),i.b=this.lerp(e.b,t.b,r),i):void console.warn("Invalid argument types, or argument types do not match:",e,t)},lerp:function(e,t,r){"use strict";return e+(t-e)*r},roundToNearestMultiple:function(e,t){"use strict";var r;return 0===t?e:0===(r=Math.abs(e)%t)?e:e<0?-(Math.abs(e)-r):e+t-r},arrayValuesAreEqual:function(e){"use strict";for(var t=0;t<e.length-1;++t)if(e[t]!==e[t+1])return!1;return!0},randomFloat:function(e,t){"use strict";return e+t*(Math.random()-.5)},randomVector3:function(e,t,r,i,n){"use strict";var o=r.x+(Math.random()*i.x-.5*i.x),a=r.y+(Math.random()*i.y-.5*i.y),s=r.z+(Math.random()*i.z-.5*i.z);n&&(o=.5*-n.x+this.roundToNearestMultiple(o,n.x),a=.5*-n.y+this.roundToNearestMultiple(a,n.y),s=.5*-n.z+this.roundToNearestMultiple(s,n.z)),e.typedArray.setVec3Components(t,o,a,s)},getRandomVector3:function(e,t,r){"use strict";var i=e.x+(Math.random()*t.x-.5*t.x),n=e.y+(Math.random()*t.y-.5*t.y),o=e.z+(Math.random()*t.z-.5*t.z);return r&&(i=.5*-r.x+this.roundToNearestMultiple(i,r.x),n=.5*-r.y+this.roundToNearestMultiple(n,r.y),o=.5*-r.z+this.roundToNearestMultiple(o,r.z)),new THREE.Vector3(i,n,o)},randomColor:function(e,t,r,i){"use strict";var n=r.r+Math.random()*i.x,o=r.g+Math.random()*i.y,a=r.b+Math.random()*i.z;n=this.clamp(n,0,1),o=this.clamp(o,0,1),a=this.clamp(a,0,1),e.typedArray.setVec3Components(t,n,o,a)},randomColorAsHex:function(){"use strict";var l=new THREE.Color;return function(e,t,r,i){for(var n=r.length,o=[],a=0;a<n;++a){var s=i[a];l.copy(r[a]),l.r+=Math.random()*s.x-.5*s.x,l.g+=Math.random()*s.y-.5*s.y,l.b+=Math.random()*s.z-.5*s.z,l.r=this.clamp(l.r,0,1),l.g=this.clamp(l.g,0,1),l.b=this.clamp(l.b,0,1),o.push(l.getHex())}e.typedArray.setVec4Components(t,o[0],o[1],o[2],o[3])}}(),randomVector3OnSphere:function(e,t,r,i,n,o,a,s){"use strict";var l=2*Math.random()-1,c=6.2832*Math.random(),u=Math.sqrt(1-l*l),h=this.randomFloat(i,n),p=0,d=0,f=0;a&&(h=Math.round(h/a)*a),p=u*Math.cos(c)*h,d=u*Math.sin(c)*h,f=l*h,p*=o.x,d*=o.y,f*=o.z,p+=r.x,d+=r.y,f+=r.z,e.typedArray.setVec3Components(t,p,d,f)},seededRandom:function(e){var t=1e4*Math.sin(e);return t-(0|t)},randomVector3OnDisc:function(e,t,r,i,n,o,a){"use strict";var s=6.2832*Math.random(),l=Math.abs(this.randomFloat(i,n)),c=0,u=0,h=0;a&&(l=Math.round(l/a)*a),c=Math.cos(s)*l,u=Math.sin(s)*l,c*=o.x,u*=o.y,c+=r.x,u+=r.y,h+=r.z,e.typedArray.setVec3Components(t,c,u,h)},randomDirectionVector3OnSphere:function(){"use strict";var l=new THREE.Vector3;return function(e,t,r,i,n,o,a,s){l.copy(o),l.x-=r,l.y-=i,l.z-=n,l.normalize().multiplyScalar(-this.randomFloat(a,s)),e.typedArray.setVec3Components(t,l.x,l.y,l.z)}}(),directionVector3OnSphere:function(){"use strict";var h=new THREE.Vector3;return function(e,t,r,i,n,o,a,s,l,c){h.copy(o),h.x-=r,h.y-=i,h.z-=n,h.normalize().multiplyScalar(-this.randomFloat(a,s));var u=this.getRandomVector3(l,c);h.add(u),e.typedArray.setVec3Components(t,h.x,h.y,h.z)}}(),randomDirectionVector3OnDisc:function(){"use strict";var l=new THREE.Vector3;return function(e,t,r,i,n,o,a,s){l.copy(o),l.x-=r,l.y-=i,l.z-=n,l.normalize().multiplyScalar(-this.randomFloat(a,s)),e.typedArray.setVec3Components(t,l.x,l.y,0)}}(),getPackedRotationAxis:function(){"use strict";var r=new THREE.Vector3,i=new THREE.Vector3,n=new THREE.Color,o=new THREE.Vector3(1,1,1);return function(e,t){return r.copy(e).normalize(),i.copy(t).normalize(),r.x+=.5*-t.x+Math.random()*t.x,r.y+=.5*-t.y+Math.random()*t.y,r.z+=.5*-t.z+Math.random()*t.z,r.normalize().add(o).multiplyScalar(.5),n.setRGB(r.x,r.y,r.z),n.getHex()}}()},SPE.Group=function(e){"use strict";var t=SPE.utils,r=t.types;(e=t.ensureTypedArg(e,r.OBJECT,{})).texture=t.ensureTypedArg(e.texture,r.OBJECT,{}),this.uuid=THREE.Math.generateUUID(),this.fixedTimeStep=t.ensureTypedArg(e.fixedTimeStep,r.NUMBER,.016),null!=e.texture.frames&&null!=e.texture.frames&&(e.texture.frames.x=t.ensureTypedArg(e.texture.frames.x,r.NUMBER,1),e.texture.frames.y=t.ensureTypedArg(e.texture.frames.y,r.NUMBER,1)),this.texture=t.ensureInstanceOf(e.texture.value,THREE.Texture,null),this.textureFrames=t.ensureInstanceOf(new THREE.Vector2(e.texture.frames.x,e.texture.frames.y),THREE.Vector2,new THREE.Vector2(1,1)),this.textureFrameCount=t.ensureTypedArg(e.texture.frameCount,r.NUMBER,this.textureFrames.x*this.textureFrames.y),this.textureLoop=t.ensureTypedArg(e.texture.loop,r.NUMBER,1),this.textureFrames.max(new THREE.Vector2(1,1)),this.hasPerspective=t.ensureTypedArg(e.hasPerspective,r.BOOLEAN,!0),this.colorize=t.ensureTypedArg(e.colorize,r.BOOLEAN,!0),this.maxParticleCount=t.ensureTypedArg(e.maxParticleCount,r.NUMBER,null),this.vec4Quaternion=t.ensureInstanceOf(e.vec4Quaternion,THREE.Vector4,new THREE.Vector4(0,0,0,1)),this.vec4Quaternion=this.vec4Quaternion.normalize(),this.blending=t.ensureTypedArg(e.blending,r.NUMBER,THREE.AdditiveBlending),this.transparent=t.ensureTypedArg(e.transparent,r.BOOLEAN,!0),this.alphaTest=parseFloat(t.ensureTypedArg(e.alphaTest,r.NUMBER,0)),this.depthWrite=t.ensureTypedArg(e.depthWrite,r.BOOLEAN,!1),this.depthTest=t.ensureTypedArg(e.depthTest,r.BOOLEAN,!0),this.fog=t.ensureTypedArg(e.fog,r.BOOLEAN,!0),this.scale=t.ensureTypedArg(e.scale,r.NUMBER,300),this.emitters=[],this.emitterIDs=[],this._pool=[],this._poolCreationSettings=null,this._createNewWhenPoolEmpty=0,this._attributesNeedRefresh=!1,this._attributesNeedDynamicReset=!1,this.particleCount=0,this.uniforms={tex:{type:"t",value:this.texture},textureAnimation:{type:"v4",value:new THREE.Vector4(this.textureFrames.x,this.textureFrames.y,this.textureFrameCount,Math.max(Math.abs(this.textureLoop),1))},fogColor:{type:"c",value:null},fogNear:{type:"f",value:10},fogFar:{type:"f",value:200},fogDensity:{type:"f",value:.5},deltaTime:{type:"f",value:0},runTime:{type:"f",value:0},scale:{type:"f",value:this.scale}},this.defines={HAS_PERSPECTIVE:this.hasPerspective,COLORIZE:this.colorize,VALUE_OVER_LIFETIME_LENGTH:SPE.valueOverLifetimeLength,SHOULD_ROTATE_TEXTURE:!1,SHOULD_TRAIL_PARTICLES:!0,SHOULD_ROTATE_PARTICLES:!1,SHOULD_WIGGLE_PARTICLES:!1,SHOULD_CALCULATE_SPRITE:1<this.textureFrames.x||1<this.textureFrames.y},this.attributes={position:new SPE.ShaderAttribute("v3",!0),acceleration:new SPE.ShaderAttribute("v4",!0),velocity:new SPE.ShaderAttribute("v3",!0),rotation:new SPE.ShaderAttribute("v4",!0),rotationCenter:new SPE.ShaderAttribute("v3",!0),params:new SPE.ShaderAttribute("v4",!0),size:new SPE.ShaderAttribute("v4",!0),angle:new SPE.ShaderAttribute("v4",!0),color:new SPE.ShaderAttribute("v4",!0),opacity:new SPE.ShaderAttribute("v4",!0),trail:new SPE.ShaderAttribute("v4",!0)},this.attributeKeys=Object.keys(this.attributes),this.attributeCount=this.attributeKeys.length,this.material=new THREE.ShaderMaterial({uniforms:this.uniforms,vertexShader:SPE.shaders.vertex,fragmentShader:SPE.shaders.fragment,blending:this.blending,transparent:this.transparent,alphaTest:this.alphaTest,depthWrite:this.depthWrite,depthTest:this.depthTest,defines:this.defines,fog:this.fog}),this.geometry=new THREE.BufferGeometry,this.mesh=new THREE.Points(this.geometry,this.material),null===this.maxParticleCount&&console.warn("SPE.Group: No maxParticleCount specified. Adding emitters after rendering will probably cause errors.")},SPE.Group.constructor=SPE.Group,SPE.Group.prototype._updateDefines=function(){"use strict";for(var e,t=this.emitters,r=t.length-1,i=this.defines;0<=r;--r)e=t[r],i.SHOULD_CALCULATE_SPRITE||(i.SHOULD_ROTATE_TEXTURE=i.SHOULD_ROTATE_TEXTURE||!!Math.max(Math.max.apply(null,e.angle.value),Math.max.apply(null,e.angle.spread))),i.SHOULD_ROTATE_PARTICLES=i.SHOULD_ROTATE_PARTICLES||!!Math.max(e.rotation.angle,e.rotation.angleSpread),i.SHOULD_WIGGLE_PARTICLES=i.SHOULD_WIGGLE_PARTICLES||!!Math.max(e.wiggle.value,e.wiggle.spread),i.SHOULD_TRAIL_PARTICLES=i.SHOULD_TRAIL_PARTICLES||!!Math.max(e.trail.value,e.trail.spread);this.material.needsUpdate=!0},SPE.Group.prototype._applyAttributesToGeometry=function(){"use strict";var e,t,r=this.attributes,i=this.geometry,n=i.attributes;for(var o in r)r.hasOwnProperty(o)&&(e=r[o],(t=n[o])?t.array=e.typedArray.array:i.addAttribute(o,e.bufferAttribute),e.bufferAttribute.needsUpdate=!0);this.geometry.setDrawRange(0,this.particleCount)},SPE.Group.prototype.addEmitter=function(e){"use strict";if(e instanceof SPE.Emitter!=!1)if(-1<this.emitterIDs.indexOf(e.uuid))console.error("Emitter already exists in this group. Will not add again.");else{if(null===e.group){var t=this.attributes,r=this.particleCount,i=r+e.particleCount;for(var n in this.particleCount=i,null!==this.maxParticleCount&&this.particleCount>this.maxParticleCount&&console.warn("SPE.Group: maxParticleCount exceeded. Requesting",this.particleCount,"particles, can support only",this.maxParticleCount),e._calculatePPSValue(e.maxAge._value+e.maxAge._spread),e._setBufferUpdateRanges(this.attributeKeys),e._setAttributeOffset(r),e.group=this,e.attributes=this.attributes,t)t.hasOwnProperty(n)&&t[n]._createBufferAttribute(null!==this.maxParticleCount?this.maxParticleCount:this.particleCount);for(var o=r;o<i;++o)e._assignPositionValue(o),e._assignForceValue(o,"velocity"),e._assignAccForceValue(o,"acceleration"),e._assignAbsLifetimeValue(o,"opacity"),e._assignAbsLifetimeValue(o,"size"),e._assignAngleValue(o),e._assignRotationValue(o),e._assignParamsValue(o),e._assignColorValue(o),e._assignTrailValue(o);return this._applyAttributesToGeometry(),this.emitters.push(e),this.emitterIDs.push(e.uuid),this._updateDefines(e),this.material.needsUpdate=!0,this.geometry.needsUpdate=!0,this._attributesNeedRefresh=!0,this}console.error("Emitter already belongs to another group. Will not add to requested group.")}else console.error("`emitter` argument must be instance of SPE.Emitter. Was provided with:",e)},SPE.Group.prototype.removeEmitter=function(e){"use strict";var t=this.emitterIDs.indexOf(e.uuid);if(e instanceof SPE.Emitter!=!1)if(-1!==t){for(var r=e.attributeOffset,i=r+e.particleCount,n=this.attributes.params.typedArray,o=r;o<i;++o)n.array[4*o]=0,n.array[4*o+1]=0;for(var a in this.emitters.splice(t,1),this.emitterIDs.splice(t,1),this.attributes)this.attributes.hasOwnProperty(a)&&this.attributes[a].splice(r,i);this.particleCount-=e.particleCount,e._onRemove(),this._attributesNeedRefresh=!0}else console.error("Emitter does not exist in this group. Will not remove.");else console.error("`emitter` argument must be instance of SPE.Emitter. Was provided with:",e)},SPE.Group.prototype.getFromPool=function(){"use strict";var e=this._pool,t=this._createNewWhenPoolEmpty;if(e.length)return e.pop();if(t){var r=new SPE.Emitter(this._poolCreationSettings);return this.addEmitter(r),r}return null},SPE.Group.prototype.releaseIntoPool=function(e){"use strict";if(e instanceof SPE.Emitter!=!1)return e.reset(),this._pool.unshift(e),this;console.error("Argument is not instanceof SPE.Emitter:",e)},SPE.Group.prototype.getPool=function(){"use strict";return this._pool},SPE.Group.prototype.addPool=function(e,t,r){"use strict";var i;this._poolCreationSettings=t,this._createNewWhenPoolEmpty=!!r;for(var n=0;n<e;++n)i=Array.isArray(t)?new SPE.Emitter(t[n]):new SPE.Emitter(t),this.addEmitter(i),this.releaseIntoPool(i);return this},SPE.Group.prototype._triggerSingleEmitter=function(e){"use strict";var t=this.getFromPool(),r=this;if(null!==t)return e instanceof THREE.Vector3&&(t.position.value.copy(e),t.position.value=t.position.value),t.enable(),setTimeout(function(){t.disable(),r.releaseIntoPool(t)},1e3*Math.max(t.duration,t.maxAge.value+t.maxAge.spread)),this;console.log("SPE.Group pool ran out.")},SPE.Group.prototype.triggerPoolEmitter=function(e,t){"use strict";if("number"==typeof e&&1<e)for(var r=0;r<e;++r)this._triggerSingleEmitter(t);else this._triggerSingleEmitter(t);return this},SPE.Group.prototype._updateUniforms=function(e){"use strict";this.uniforms.runTime.value+=e,this.uniforms.deltaTime.value=e},SPE.Group.prototype._resetBufferRanges=function(){"use strict";for(var e=this.attributeKeys,t=this.attributeCount-1,r=this.attributes;0<=t;--t)r[e[t]].resetUpdateRange()},SPE.Group.prototype._updateBuffers=function(e){"use strict";for(var t,r,i,n=this.attributeKeys,o=this.attributeCount-1,a=this.attributes,s=e.bufferUpdateRanges;0<=o;--o)r=s[t=n[o]],(i=a[t]).setUpdateRange(r.min,r.max),i.flagUpdate()},SPE.Group.prototype.tick=function(e){"use strict";var t=this.emitters,r=t.length,i=e||this.fixedTimeStep,n=this.attributeKeys,o=this.attributes;if(this._updateUniforms(i),this._resetBufferRanges(),0!==r||!1!==this._attributesNeedRefresh||!1!==this._attributesNeedDynamicReset){for(var a,s=0;s<r;++s)(a=t[s]).tick(i),this._updateBuffers(a);if(!0===this._attributesNeedDynamicReset){for(s=this.attributeCount-1;0<=s;--s)o[n[s]].resetDynamic();this._attributesNeedDynamicReset=!1}if(!0===this._attributesNeedRefresh){for(s=this.attributeCount-1;0<=s;--s)o[n[s]].forceUpdateAll();this._attributesNeedRefresh=!1,this._attributesNeedDynamicReset=!0}}},SPE.Group.prototype.dispose=function(){"use strict";return this.geometry.dispose(),this.material.dispose(),this},SPE.Emitter=function(e){"use strict";var t=SPE.utils,r=t.types,i=SPE.valueOverLifetimeLength;for(var n in(e=t.ensureTypedArg(e,r.OBJECT,{})).position=t.ensureTypedArg(e.position,r.OBJECT,{}),e.velocity=t.ensureTypedArg(e.velocity,r.OBJECT,{}),e.acceleration=t.ensureTypedArg(e.acceleration,r.OBJECT,{}),e.radius=t.ensureTypedArg(e.radius,r.OBJECT,{}),e.drag=t.ensureTypedArg(e.drag,r.OBJECT,{}),e.rotation=t.ensureTypedArg(e.rotation,r.OBJECT,{}),e.color=t.ensureTypedArg(e.color,r.OBJECT,{}),e.opacity=t.ensureTypedArg(e.opacity,r.OBJECT,{}),e.size=t.ensureTypedArg(e.size,r.OBJECT,{}),e.angle=t.ensureTypedArg(e.angle,r.OBJECT,{}),e.wiggle=t.ensureTypedArg(e.wiggle,r.OBJECT,{}),e.trail=t.ensureTypedArg(e.trail,r.OBJECT,{}),e.maxAge=t.ensureTypedArg(e.maxAge,r.OBJECT,{}),e.onParticleSpawn&&console.warn("onParticleSpawn has been removed. Please set properties directly to alter values at runtime."),this.uuid=THREE.Math.generateUUID(),this.type=t.ensureTypedArg(e.type,r.NUMBER,SPE.distributions.BOX),this.position={_value:t.ensureInstanceOf(e.position.value,THREE.Vector3,new THREE.Vector3),_spread:t.ensureInstanceOf(e.position.spread,THREE.Vector3,new THREE.Vector3),_spreadClamp:t.ensureInstanceOf(e.position.spreadClamp,THREE.Vector3,new THREE.Vector3),_distribution:t.ensureTypedArg(e.position.distribution,r.NUMBER,this.type),_randomise:t.ensureTypedArg(e.position.randomise,r.BOOLEAN,!1),_radius:t.ensureTypedArg(e.position.radius,r.NUMBER,10),_radiusScale:t.ensureInstanceOf(e.position.radiusScale,THREE.Vector3,new THREE.Vector3(1,1,1)),_distributionClamp:t.ensureTypedArg(e.position.distributionClamp,r.NUMBER,0)},this.velocity={_value:t.ensureInstanceOf(e.velocity.value,THREE.Vector3,new THREE.Vector3),_spread:t.ensureInstanceOf(e.velocity.spread,THREE.Vector3,new THREE.Vector3),_distribution:t.ensureTypedArg(e.velocity.distribution,r.NUMBER,this.type),_randomise:t.ensureTypedArg(e.position.randomise,r.BOOLEAN,!1)},this.acceleration={_value:t.ensureInstanceOf(e.acceleration.value,THREE.Vector3,new THREE.Vector3),_spread:t.ensureInstanceOf(e.acceleration.spread,THREE.Vector3,new THREE.Vector3),_distribution:t.ensureTypedArg(e.acceleration.distribution,r.NUMBER,this.type),_randomise:t.ensureTypedArg(e.position.randomise,r.BOOLEAN,!1)},this.drag={_value:t.ensureTypedArg(e.drag.value,r.NUMBER,0),_spread:t.ensureTypedArg(e.drag.spread,r.NUMBER,0),_randomise:t.ensureTypedArg(e.position.randomise,r.BOOLEAN,!1)},this.wiggle={_value:t.ensureTypedArg(e.wiggle.value,r.NUMBER,0),_spread:t.ensureTypedArg(e.wiggle.spread,r.NUMBER,0)},this.rotation={_axis:t.ensureInstanceOf(e.rotation.axis,THREE.Vector3,new THREE.Vector3(0,1,0)),_axisSpread:t.ensureInstanceOf(e.rotation.axisSpread,THREE.Vector3,new THREE.Vector3),_angle:t.ensureTypedArg(e.rotation.angle,r.NUMBER,0),_angleSpread:t.ensureTypedArg(e.rotation.angleSpread,r.NUMBER,0),_static:t.ensureTypedArg(e.rotation.static,r.BOOLEAN,!1),_center:t.ensureInstanceOf(e.rotation.center,THREE.Vector3,this.position._value.clone()),_randomise:t.ensureTypedArg(e.position.randomise,r.BOOLEAN,!1)},this.maxAge={_value:t.ensureTypedArg(e.maxAge.value,r.NUMBER,2),_spread:t.ensureTypedArg(e.maxAge.spread,r.NUMBER,0)},this.color={_value:t.ensureArrayInstanceOf(e.color.value,THREE.Color,new THREE.Color),_spread:t.ensureArrayInstanceOf(e.color.spread,THREE.Vector3,new THREE.Vector3),_randomise:t.ensureTypedArg(e.position.randomise,r.BOOLEAN,!1)},this.opacity={_value:t.ensureArrayTypedArg(e.opacity.value,r.NUMBER,1),_spread:t.ensureArrayTypedArg(e.opacity.spread,r.NUMBER,0),_randomise:t.ensureTypedArg(e.position.randomise,r.BOOLEAN,!1)},this.size={_value:t.ensureArrayTypedArg(e.size.value,r.NUMBER,1),_spread:t.ensureArrayTypedArg(e.size.spread,r.NUMBER,0),_randomise:t.ensureTypedArg(e.position.randomise,r.BOOLEAN,!1)},this.angle={_value:t.ensureArrayTypedArg(e.angle.value,r.NUMBER,0),_spread:t.ensureArrayTypedArg(e.angle.spread,r.NUMBER,0),_randomise:t.ensureTypedArg(e.position.randomise,r.BOOLEAN,!1)},this.bInitSpeed=!1,this.bInitSpeedAcc=!1,this.particleCount=t.ensureTypedArg(e.particleCount,r.NUMBER,100),this.duration=t.ensureTypedArg(e.duration,r.NUMBER,null),this.isStatic=t.ensureTypedArg(e.isStatic,r.BOOLEAN,!1),this.activeMultiplier=t.ensureTypedArg(e.activeMultiplier,r.NUMBER,1),this.direction=t.ensureTypedArg(e.direction,r.NUMBER,1),this.trail={_value:t.ensureArrayTypedArg(e.trail.value,r.NUMBER,0),_spread:t.ensureArrayTypedArg(e.trail.spread,r.NUMBER,0),_step:t.ensureArrayTypedArg(e.trail.step,r.NUMBER,0),_stepSpread:t.ensureArrayTypedArg(e.trail.stepSpread,r.NUMBER,0),_direction:t.ensureArrayTypedArg(e.trail.direction,r.NUMBER,-1*this.direction)},this.alive=t.ensureTypedArg(e.alive,r.BOOLEAN,!0),this.particlesPerSecond=0,this.activationIndex=0,this.attributeOffset=0,this.attributeEnd=0,this.age=0,this.activeParticleCount=0,this.group=null,this.attributes=null,this.paramsArray=null,this.resetFlags={position:t.ensureTypedArg(e.position.randomise,r.BOOLEAN,!1)||t.ensureTypedArg(e.radius.randomise,r.BOOLEAN,!1),velocity:t.ensureTypedArg(e.velocity.randomise,r.BOOLEAN,!1),acceleration:t.ensureTypedArg(e.acceleration.randomise,r.BOOLEAN,!1)||t.ensureTypedArg(e.drag.randomise,r.BOOLEAN,!1),rotation:t.ensureTypedArg(e.rotation.randomise,r.BOOLEAN,!1),rotationCenter:t.ensureTypedArg(e.rotation.randomise,r.BOOLEAN,!1),size:t.ensureTypedArg(e.size.randomise,r.BOOLEAN,!1),color:t.ensureTypedArg(e.color.randomise,r.BOOLEAN,!1),opacity:t.ensureTypedArg(e.opacity.randomise,r.BOOLEAN,!1),angle:t.ensureTypedArg(e.angle.randomise,r.BOOLEAN,!1)},this.updateFlags={},this.updateCounts={},this.updateMap={maxAge:"params",position:"position",velocity:"velocity",acceleration:"acceleration",drag:"acceleration",wiggle:"params",rotation:"rotation",size:"size",color:"color",opacity:"opacity",angle:"angle",trail:"trail"},this.updateMap)this.updateMap.hasOwnProperty(n)&&(this.updateCounts[this.updateMap[n]]=0,this.updateFlags[this.updateMap[n]]=!1,this._createGetterSetters(this[n],n));this.bufferUpdateRanges={},this.attributeKeys=null,this.attributeCount=0,t.ensureValueOverLifetimeCompliance(this.color,i,i),t.ensureValueOverLifetimeCompliance(this.opacity,i,i),t.ensureValueOverLifetimeCompliance(this.size,i,i),t.ensureValueOverLifetimeCompliance(this.angle,i,i)},SPE.Emitter.constructor=SPE.Emitter,SPE.Emitter.prototype._createGetterSetters=function(e,o){"use strict";var a=this;for(var t in e)if(e.hasOwnProperty(t)){var r=t.replace("_","");Object.defineProperty(e,r,{get:function(e){return function(){return this[e]}}(t),set:function(n){return function(e){var t=a.updateMap[o],r=this[n],i=SPE.valueOverLifetimeLength;"_rotationCenter"===n?(a.updateFlags.rotationCenter=!0,a.updateCounts.rotationCenter=0):"_randomise"===n?a.resetFlags[t]=e:(a.updateFlags[t]=!0,a.updateCounts[t]=0),a.group._updateDefines(),this[n]=e,Array.isArray(r)&&SPE.utils.ensureValueOverLifetimeCompliance(a[o],i,i)}}(t)})}},SPE.Emitter.prototype._setBufferUpdateRanges=function(e){"use strict";this.attributeKeys=e,this.attributeCount=e.length;for(var t=this.attributeCount-1;0<=t;--t)this.bufferUpdateRanges[e[t]]={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY}},SPE.Emitter.prototype._calculatePPSValue=function(e){"use strict";var t=this.particleCount;this.duration?this.particlesPerSecond=t/(e<this.duration?e:this.duration):this.particlesPerSecond=t/e},SPE.Emitter.prototype._setAttributeOffset=function(e){this.attributeOffset=e,this.activationIndex=e,this.activationEnd=e+this.particleCount},SPE.Emitter.prototype._assignValue=function(e,t){"use strict";switch(e){case"position":this._assignPositionValue(t);break;case"velocity":this._assignForceValue(t,e);break;case"acceleration":this._assignAccForceValue(t,e);break;case"size":case"opacity":this._assignAbsLifetimeValue(t,e);break;case"angle":this._assignAngleValue(t);break;case"params":this._assignParamsValue(t);break;case"rotation":this._assignRotationValue(t);break;case"color":this._assignColorValue(t);break;case"trail":this._assignTrailValue(t)}},SPE.Emitter.prototype._assignPositionValue=function(e){"use strict";var t=SPE.distributions,r=SPE.utils,i=this.position,n=this.attributes.position,o=i._value,a=i._spread;switch(i._distribution){case t.BOX:r.randomVector3(n,e,o,a,i._spreadClamp);break;case t.SPHERE:r.randomVector3OnSphere(n,e,o,i._radius,i._spread.x,i._radiusScale,i._spreadClamp.x,i._distributionClamp||this.particleCount);break;case t.DISC:r.randomVector3OnDisc(n,e,o,i._radius,i._spread.x,i._radiusScale,i._spreadClamp.x)}},SPE.Emitter.prototype._assignTrailValue=function(e){"use strict";this.attributes.trail.typedArray.setVec4Components(e,this.trail._direction,SPE.utils.randomFloat(this.trail._value,this.trail._spread),SPE.utils.randomFloat(this.trail._step,this.trail._stepSpread))},SPE.Emitter.prototype._assignForceValue=function(e,t){"use strict";var r=this.group.vec4Quaternion.clone();r=r.normalize();var i,n,o,a,s,l=SPE.distributions,c=SPE.utils,u=this[t],h=u._value,p=u._spread,d=u._distribution;switch(this.bInitSpeed||(h=h.applyQuaternion(r),p=p.applyQuaternion(r),this.bInitSpeed=!0),d){case l.BOX:c.randomVector3(this.attributes[t],e,h,p);break;case l.SPHERE:n=(i=this.attributes.position.typedArray.array)[s=3*e],o=i[s+1],a=i[s+2],c.randomDirectionVector3OnSphere(this.attributes[t],e,n,o,a,this.position._value,u._value.x,u._spread.x);break;case l.DISC:n=(i=this.attributes.position.typedArray.array)[s=3*e],o=i[s+1],a=i[s+2],c.randomDirectionVector3OnDisc(this.attributes[t],e,n,o,a,this.position._value,u._value.x,u._spread.x)}if("acceleration"===t){var f=c.clamp(c.randomFloat(this.drag._value,this.drag._spread),0,2);this.attributes.acceleration.typedArray.array[4*e+3]=f}},SPE.Emitter.prototype._assignAccForceValue=function(e,t){"use strict";var r=this.group.vec4Quaternion.clone();r=r.normalize();var i,n,o,a,s,l=SPE.distributions,c=SPE.utils,u=this[t],h=this.velocity,p=u._value,d=u._spread,f=u._distribution;switch(this.bInitSpeedAcc||(p=p.applyQuaternion(r),d=d.applyQuaternion(r),this.bInitSpeedAcc=!0),f){case l.BOX:c.randomVector3(this.attributes[t],e,p,d);break;case l.SPHERE:n=(i=this.attributes.position.typedArray.array)[s=3*e],o=i[s+1],a=i[s+2],c.directionVector3OnSphere(this.attributes[t],e,n,o,a,this.position._value,h._value.y,h._spread.y,u._value,u._spread);break;case l.DISC:n=(i=this.attributes.position.typedArray.array)[s=3*e],o=i[s+1],a=i[s+2],c.randomDirectionVector3OnDisc(this.attributes[t],e,n,o,a,this.position._value,u._value.x,u._spread.x)}if("acceleration"===t){var m=c.clamp(c.randomFloat(this.drag._value,this.drag._spread),0,2);this.attributes.acceleration.typedArray.array[4*e+3]=m}},SPE.Emitter.prototype._assignAbsLifetimeValue=function(e,t){"use strict";var r,i=this.attributes[t].typedArray,n=this[t],o=SPE.utils;o.arrayValuesAreEqual(n._value)&&o.arrayValuesAreEqual(n._spread)?(r=Math.abs(o.randomFloat(n._value[0],n._spread[0])),i.setVec4Components(e,r,r,r,r)):i.setVec4Components(e,Math.abs(o.randomFloat(n._value[0],n._spread[0])),Math.abs(o.randomFloat(n._value[1],n._spread[1])),Math.abs(o.randomFloat(n._value[2],n._spread[2])),Math.abs(o.randomFloat(n._value[3],n._spread[3])))},SPE.Emitter.prototype._assignAngleValue=function(e){"use strict";var t,r=this.attributes.angle.typedArray,i=this.angle,n=SPE.utils;n.arrayValuesAreEqual(i._value)&&n.arrayValuesAreEqual(i._spread)?(t=n.randomFloat(i._value[0],i._spread[0]),r.setVec4Components(e,t,t,t,t)):r.setVec4Components(e,n.randomFloat(i._value[0],i._spread[0]),n.randomFloat(i._value[1],i._spread[1]),n.randomFloat(i._value[2],i._spread[2]),n.randomFloat(i._value[3],i._spread[3]))},SPE.Emitter.prototype._assignParamsValue=function(e){"use strict";this.attributes.params.typedArray.setVec4Components(e,this.isStatic?1:0,0,Math.abs(SPE.utils.randomFloat(this.maxAge._value,this.maxAge._spread)),SPE.utils.randomFloat(this.wiggle._value,this.wiggle._spread))},SPE.Emitter.prototype._assignRotationValue=function(e){"use strict";this.attributes.rotation.typedArray.setVec3Components(e,SPE.utils.getPackedRotationAxis(this.rotation._axis,this.rotation._axisSpread),SPE.utils.randomFloat(this.rotation._angle,this.rotation._angleSpread),this.rotation._static?0:1),this.attributes.rotationCenter.typedArray.setVec3(e,this.rotation._center)},SPE.Emitter.prototype._assignColorValue=function(e){"use strict";SPE.utils.randomColorAsHex(this.attributes.color,e,this.color._value,this.color._spread)},SPE.Emitter.prototype._resetParticle=function(e){"use strict";for(var t,r,i=this.resetFlags,n=this.updateFlags,o=this.updateCounts,a=this.attributeKeys,s=this.attributeCount-1;0<=s;--s)r=n[t=a[s]],!0!==i[t]&&!0!==r||(this._assignValue(t,e),this._updateAttributeUpdateRange(t,e),!0===r&&o[t]===this.particleCount?(n[t]=!1,o[t]=0):1==r&&++o[t])},SPE.Emitter.prototype._updateAttributeUpdateRange=function(e,t){"use strict";var r=this.bufferUpdateRanges[e];r.min=Math.min(t,r.min),r.max=Math.max(t,r.max)},SPE.Emitter.prototype._resetBufferRanges=function(){"use strict";for(var e,t=this.bufferUpdateRanges,r=this.bufferUpdateKeys,i=this.bufferUpdateCount-1;0<=i;--i)t[e=r[i]].min=Number.POSITIVE_INFINITY,t[e].max=Number.NEGATIVE_INFINITY},SPE.Emitter.prototype._onRemove=function(){"use strict";this.particlesPerSecond=0,this.attributeOffset=0,this.activationIndex=0,this.activeParticleCount=0,this.group=null,this.attributes=null,this.paramsArray=null,this.age=0},SPE.Emitter.prototype._decrementParticleCount=function(){"use strict";--this.activeParticleCount},SPE.Emitter.prototype._incrementParticleCount=function(){"use strict";++this.activeParticleCount},SPE.Emitter.prototype._checkParticleAges=function(e,t,r,i){"use strict";for(var n,o,a,s,l=t-1;e<=l;--l)0!==(s=r[n=4*l])&&(a=r[n+1],o=r[n+2],1===this.direction?o<=(a+=i)&&(s=a=0,this._decrementParticleCount()):(a-=i)<=0&&(a=o,s=0,this._decrementParticleCount()),r[n]=s,r[n+1]=a,this._updateAttributeUpdateRange("params",l))},SPE.Emitter.prototype._activateParticles=function(e,t,r,i){"use strict";for(var n,o,a=this.direction,s=e;s<t;++s)0!=r[n=4*s]&&1!==this.particleCount||(this._incrementParticleCount(),r[n]=1,this._resetParticle(s),o=i*(s-e),r[n+1]=-1===a?r[n+2]-o:o,this._updateAttributeUpdateRange("params",s))},SPE.Emitter.prototype.tick=function(e){"use strict";if(!this.isStatic){null===this.paramsArray&&(this.paramsArray=this.attributes.params.typedArray.array);var t=this.attributeOffset,r=t+this.particleCount,i=this.paramsArray,n=this.particlesPerSecond*this.activeMultiplier*e,o=this.activationIndex;if(this._resetBufferRanges(),this._checkParticleAges(t,r,i,e),!1!==this.alive){if(null!==this.duration&&this.age>this.duration)return this.alive=!1,void(this.age=0);var a=1===this.particleCount?o:0|o,s=Math.min(a+n,this.activationEnd),l=s-this.activationIndex|0,c=0<l?e/l:0;this._activateParticles(a,s,i,c),this.activationIndex+=n,this.activationIndex>r&&(this.activationIndex=t),this.age+=e}else this.age=0}},SPE.Emitter.prototype.reset=function(e){"use strict";if(this.age=0,!(this.alive=!1)===e){for(var t,r=this.attributeOffset,i=r+this.particleCount,n=this.paramsArray,o=this.attributes.params.bufferAttribute,a=i-1;r<=a;--a)n[t=4*a]=0,n[t+1]=0;o.updateRange.offset=0,o.updateRange.count=-1,o.needsUpdate=!0}return this},SPE.Emitter.prototype.enable=function(){"use strict";return this.alive=!0,this},SPE.Emitter.prototype.disable=function(){"use strict";return this.alive=!1,this},SPE.Emitter.prototype.remove=function(){"use strict";return null!==this.group?this.group.removeEmitter(this):console.error("Emitter does not belong to a group, cannot remove."),this},function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.Stats=t()}(this,function(){var u=function(){function e(e){return i.appendChild(e.dom),e}function t(e){for(var t=0;t<i.children.length;t++)i.children[t].style.display=t===e?"block":"none";r=e}var r=0,i=document.createElement("div");i.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",i.addEventListener("click",function(e){e.preventDefault(),t(++r%i.children.length)},!1);var n=(performance||Date).now(),o=n,a=0,s=e(new u.Panel("FPS","#0ff","#002")),l=e(new u.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var c=e(new u.Panel("MB","#f08","#201"));return t(0),{REVISION:16,dom:i,addPanel:e,showPanel:t,begin:function(){n=(performance||Date).now()},end:function(){a++;var e=(performance||Date).now();if(l.update(e-n,200),o+1e3<e&&(s.update(1e3*a/(e-o),100),o=e,a=0,c)){var t=performance.memory;c.update(t.usedJSHeapSize/1048576,t.jsHeapSizeLimit/1048576)}return e},update:function(){n=this.end()},domElement:i,setMode:t}};return u.Panel=function(r,i,n){var o=1/0,a=0,s=Math.round,l=s(window.devicePixelRatio||1),c=80*l,e=48*l,u=3*l,h=2*l,p=3*l,d=15*l,f=74*l,m=30*l,g=document.createElement("canvas");g.width=c,g.height=e,g.style.cssText="width:80px;height:48px";var v=g.getContext("2d");return v.font="bold "+9*l+"px Helvetica,Arial,sans-serif",v.textBaseline="top",v.fillStyle=n,v.fillRect(0,0,c,e),v.fillStyle=i,v.fillText(r,u,h),v.fillRect(p,d,f,m),v.fillStyle=n,v.globalAlpha=.9,v.fillRect(p,d,f,m),{dom:g,update:function(e,t){o=Math.min(o,e),a=Math.max(a,e),v.fillStyle=n,v.globalAlpha=1,v.fillRect(0,0,c,d),v.fillStyle=i,v.fillText(s(e)+" "+r+" ("+s(o)+"-"+s(a)+")",u,h),v.drawImage(g,p+l,d,f-l,m,p,d,f-l,m),v.fillRect(p+f-l,d,l,m),v.fillStyle=n,v.globalAlpha=.9,v.fillRect(p+f-l,d,l,s((1-e/t)*m))}}},u}),function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.thingjs={})}(this,function(e){"use strict";function h(e){return(h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function o(e,t,r){return t&&i(e.prototype,t),r&&i(e,r),e}function r(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager,this.dracoLoader=null}function a(){var r={};return{get:function(e){return r[e]},add:function(e,t){r[e]=t},remove:function(e){delete r[e]},removeAll:function(){r={}}}}r.prototype={constructor:r,crossOrigin:"anonymous",load:function(t,r,e,i){var n,o=this;n=void 0!==this.resourcePath?this.resourcePath:void 0!==this.path?this.path:THREE.LoaderUtils.extractUrlBase(t),o.manager.itemStart(t);var a=function(e){i?i(e):console.error(e),o.manager.itemError(t),o.manager.itemEnd(t)},s=new THREE.FileLoader(o.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.load(t,function(e){try{o.parse(e,n,function(e){r(e),o.manager.itemEnd(t)},a)}catch(e){a(e)}},e,a)},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(e){return this.path=e,this},setResourcePath:function(e){return this.resourcePath=e,this},setDRACOLoader:function(e){return this.dracoLoader=e,this},parse:function(e,t,s,r){var i,l={};if("string"==typeof e)i=e;else if(THREE.LoaderUtils.decodeText(new Uint8Array(e,0,4))===m){try{l[A.KHR_BINARY_GLTF]=new g(e)}catch(e){return void(r&&r(e))}i=l[A.KHR_BINARY_GLTF].content}else i=THREE.LoaderUtils.decodeText(new Uint8Array(e));var n=JSON.parseX(i,this);if(void 0===n.asset||n.asset.version[0]<2)r&&r(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported. Use LegacyGLTFLoader instead."));else{if(n.extensionsUsed)for(var o=0;o<n.extensionsUsed.length;++o){var a=n.extensionsUsed[o],c=n.extensionsRequired||[];switch(a){case A.KHR_LIGHTS_PUNCTUAL:l[a]=new d(n);break;case A.KHR_MATERIALS_UNLIT:l[a]=new f(n);break;case A.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:l[a]=new b(n);break;case A.KHR_DRACO_MESH_COMPRESSION:l[a]=new v(n,this.dracoLoader);break;case A.MSFT_TEXTURE_DDS:l[A.MSFT_TEXTURE_DDS]=new p(n);break;case A.KHR_TEXTURE_TRANSFORM:l[A.KHR_TEXTURE_TRANSFORM]=new y(n);break;default:0<=c.indexOf(a)&&console.warn('THREE.GLTFLoader: Unknown extension "'+a+'".')}}var u=new X(n,l,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,manager:this.manager});u.parse(function(r,i,n,o,a){u.getDependencies("material").then(function(e){var t={scene:r,scenes:i,cameras:n,animations:o,asset:a.asset,parser:u,userData:{},materials:e};V(l,t,a),s(t)})},r)}}};var A={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",MSFT_TEXTURE_DDS:"MSFT_texture_dds"};function p(){if(!THREE.DDSLoader)throw new Error("THREE.GLTFLoader: Attempting to load .dds texture without importing THREE.DDSLoader");this.name=A.MSFT_TEXTURE_DDS,this.ddsLoader=new THREE.DDSLoader}function d(e){this.name=A.KHR_LIGHTS_PUNCTUAL;var t=e.extensions&&e.extensions[A.KHR_LIGHTS_PUNCTUAL]||{};this.lightDefs=t.lights||[]}function f(e){this.name=A.KHR_MATERIALS_UNLIT}d.prototype.loadLight=function(e){var t,r=this.lightDefs[e],i=new THREE.Color(16777215);void 0!==r.color&&i.fromArray(r.color);var n=void 0!==r.range?r.range:0;switch(r.type){case"directional":(t=new THREE.DirectionalLight(i)).target.position.set(0,0,-1),t.add(t.target);break;case"point":(t=new THREE.PointLight(i)).distance=n;break;case"spot":(t=new THREE.SpotLight(i)).distance=n,r.spot=r.spot||{},r.spot.innerConeAngle=void 0!==r.spot.innerConeAngle?r.spot.innerConeAngle:0,r.spot.outerConeAngle=void 0!==r.spot.outerConeAngle?r.spot.outerConeAngle:Math.PI/4,t.angle=r.spot.outerConeAngle,t.penumbra=1-r.spot.innerConeAngle/r.spot.outerConeAngle,t.target.position.set(0,0,-1),t.add(t.target);break;default:throw new Error('THREE.GLTFLoader: Unexpected light type, "'+r.type+'".')}return t.decay=2,void 0!==r.intensity&&(t.intensity=r.intensity),t.name=r.name||"light_"+e,Promise.resolve(t)},f.prototype.getMaterialType=function(e){return THREE.MeshBasicMaterial},f.prototype.extendParams=function(e,t,r){var i=[];e.color=new THREE.Color(1,1,1),e.opacity=1;var n=t.pbrMetallicRoughness;if(n){if(Array.isArray(n.baseColorFactor)){var o=n.baseColorFactor;e.color.fromArray(o),e.opacity=o[3]}void 0!==n.baseColorTexture&&i.push(r.assignTexture(e,"map",n.baseColorTexture))}return Promise.all(i)};var m="glTF",l=12,c={JSON:1313821514,BIN:5130562};function g(e){this.name=A.KHR_BINARY_GLTF,this.content=null,this.body=null;var t=new DataView(e,0,l);if(this.header={magic:THREE.LoaderUtils.decodeText(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==m)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected. Use LegacyGLTFLoader instead.");for(var r=new DataView(e,l),i=0;i<r.byteLength;){var n=r.getUint32(i,!0);i+=4;var o=r.getUint32(i,!0);if(i+=4,o===c.JSON){var a=new Uint8Array(e,l+i,n);this.content=THREE.LoaderUtils.decodeText(a)}else if(o===c.BIN){var s=l+i;this.body=e.slice(s,s+n)}i+=n}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}function v(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=A.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,THREE.DRACOLoader.getDecoderModule()}function y(e){this.name=A.KHR_TEXTURE_TRANSFORM}function b(){return{name:A.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,specularGlossinessParams:["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"],getMaterialType:function(){return THREE.ShaderMaterial},extendParams:function(e,t,r){var i=t.extensions[this.name],n=THREE.ShaderLib.standard,o=THREE.UniformsUtils.clone(n.uniforms),a=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),s=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),l=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\ttexelSpecular = sRGBToLinear( texelSpecular );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),c=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),u=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb;","material.specularRoughness = clamp( 1.0 - glossinessFactor, 0.04, 1.0 );","material.specularColor = specularFactor.rgb;"].join("\n"),h=n.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",a).replace("#include <metalnessmap_pars_fragment>",s).replace("#include <roughnessmap_fragment>",l).replace("#include <metalnessmap_fragment>",c).replace("#include <lights_physical_fragment>",u);delete o.roughness,delete o.metalness,delete o.roughnessMap,delete o.metalnessMap,o.specular={value:(new THREE.Color).setHex(1118481)},o.glossiness={value:.5},o.specularMap={value:null},o.glossinessMap={value:null},e.vertexShader=n.vertexShader,e.fragmentShader=h,e.uniforms=o,e.defines={STANDARD:""},e.color=new THREE.Color(1,1,1),e.opacity=1;var p=[];if(Array.isArray(i.diffuseFactor)){var d=i.diffuseFactor;e.color.fromArray(d),e.opacity=d[3]}if(void 0!==i.diffuseTexture&&p.push(r.assignTexture(e,"map",i.diffuseTexture)),e.emissive=new THREE.Color(0,0,0),e.glossiness=void 0!==i.glossinessFactor?i.glossinessFactor:1,e.specular=new THREE.Color(1,1,1),Array.isArray(i.specularFactor)&&e.specular.fromArray(i.specularFactor),void 0!==i.specularGlossinessTexture){var f=i.specularGlossinessTexture;p.push(r.assignTexture(e,"glossinessMap",f)),p.push(r.assignTexture(e,"specularMap",f))}return Promise.all(p)},createMaterial:function(e){var t=new THREE.ShaderMaterial({defines:e.defines,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,uniforms:e.uniforms,fog:!0,lights:!0,opacity:e.opacity,transparent:e.transparent});return t.isGLTFSpecularGlossinessMaterial=!0,t.color=e.color,t.map=void 0===e.map?null:e.map,t.lightMap=null,t.lightMapIntensity=1,t.aoMap=void 0===e.aoMap?null:e.aoMap,t.aoMapIntensity=1,t.emissive=e.emissive,t.emissiveIntensity=1,t.emissiveMap=void 0===e.emissiveMap?null:e.emissiveMap,t.bumpMap=void 0===e.bumpMap?null:e.bumpMap,t.bumpScale=1,t.normalMap=void 0===e.normalMap?null:e.normalMap,e.normalScale&&(t.normalScale=e.normalScale),t.displacementMap=null,t.displacementScale=1,t.displacementBias=0,t.specularMap=void 0===e.specularMap?null:e.specularMap,t.specular=e.specular,t.glossinessMap=void 0===e.glossinessMap?null:e.glossinessMap,t.glossiness=e.glossiness,t.alphaMap=null,t.envMap=void 0===e.envMap?null:e.envMap,t.envMapIntensity=1,t.refractionRatio=.98,t.extensions.derivatives=!0,t},cloneMaterial:function(e){var t=e.clone();t.isGLTFSpecularGlossinessMaterial=!0;for(var r=this.specularGlossinessParams,i=0,n=r.length;i<n;i++)t[r[i]]=e[r[i]];return t},refreshUniforms:function(e,t,r,i,n,o){if(!0===n.isGLTFSpecularGlossinessMaterial){var a,s=n.uniforms,l=n.defines;s.opacity.value=n.opacity,s.diffuse.value.copy(n.color),s.emissive.value.copy(n.emissive).multiplyScalar(n.emissiveIntensity),s.map.value=n.map,s.specularMap.value=n.specularMap,s.alphaMap.value=n.alphaMap,s.lightMap.value=n.lightMap,s.lightMapIntensity.value=n.lightMapIntensity,s.aoMap.value=n.aoMap,s.aoMapIntensity.value=n.aoMapIntensity,n.map?a=n.map:n.specularMap?a=n.specularMap:n.displacementMap?a=n.displacementMap:n.normalMap?a=n.normalMap:n.bumpMap?a=n.bumpMap:n.glossinessMap?a=n.glossinessMap:n.alphaMap?a=n.alphaMap:n.emissiveMap&&(a=n.emissiveMap),void 0!==a&&(a.isWebGLRenderTarget&&(a=a.texture),!0===a.matrixAutoUpdate&&a.updateMatrix(),s.uvTransform.value.copy(a.matrix)),n.envMap&&(s.envMap.value=n.envMap,s.envMapIntensity.value=n.envMapIntensity,s.flipEnvMap.value=n.envMap.isCubeTexture?-1:1,s.reflectivity.value=n.reflectivity,s.refractionRatio.value=n.refractionRatio,s.maxMipLevel.value=e.properties.get(n.envMap).__maxMipLevel),s.specular.value.copy(n.specular),s.glossiness.value=n.glossiness,s.glossinessMap.value=n.glossinessMap,s.emissiveMap.value=n.emissiveMap,s.bumpMap.value=n.bumpMap,s.normalMap.value=n.normalMap,s.displacementMap.value=n.displacementMap,s.displacementScale.value=n.displacementScale,s.displacementBias.value=n.displacementBias,null!==s.glossinessMap.value&&void 0===l.USE_GLOSSINESSMAP&&(l.USE_GLOSSINESSMAP="",l.USE_ROUGHNESSMAP=""),null===s.glossinessMap.value&&void 0!==l.USE_GLOSSINESSMAP&&(delete l.USE_GLOSSINESSMAP,delete l.USE_ROUGHNESSMAP)}}}}function T(e,t,r,i){THREE.Interpolant.call(this,e,t,r,i)}v.prototype.decodePrimitive=function(e,t){var r=this.json,i=this.dracoLoader,n=e.extensions[this.name].bufferView,o=e.extensions[this.name].attributes,a={},s={},l={};for(var c in o)c in _&&(a[_[c]]=o[c]);for(c in e.attributes)if(void 0!==_[c]&&void 0!==o[c]){var u=r.accessors[e.attributes[c]],h=M[u.componentType];l[_[c]]=h,s[_[c]]=!0===u.normalized}return t.getDependency("bufferView",n).then(function(e){return new Promise(function(n){i.decodeDracoFile(e,function(e){for(var t in e.attributes){var r=e.attributes[t],i=s[t];void 0!==i&&(r.normalized=i)}n(e)},a,l)})})},y.prototype.extendTexture=function(e,t){return e=e.clone(),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),void 0!==t.texCoord&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),e.needsUpdate=!0,e},((T.prototype=Object.create(THREE.Interpolant.prototype)).constructor=T).prototype.beforeStart_=T.prototype.copySampleValue_=function(e){for(var t=this.resultBuffer,r=this.sampleValues,i=this.valueSize,n=e*i*3+i,o=0;o!==i;o++)t[o]=r[n+o];return t},T.prototype.afterEnd_=T.prototype.copySampleValue_,T.prototype.interpolate_=function(e,t,r,i){for(var n=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=2*a,l=3*a,c=i-t,u=(r-t)/c,h=u*u,p=h*u,d=e*l,f=d-l,m=-2*p+3*h,g=p-h,v=1-m,y=g-h+u,b=0;b!==a;b++){var x=o[f+b+a],E=o[f+b+s]*c,_=o[d+b+a],w=o[d+b]*c;n[b]=v*x+y*E+m*_+g*w}return n};var C=0,L=1,O=2,H=3,F=4,k=5,I=6,M=(Number,THREE.Matrix3,THREE.Matrix4,THREE.Vector2,THREE.Vector3,THREE.Vector4,THREE.Texture,{5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array}),x={9728:THREE.NearestFilter,9729:THREE.LinearFilter,9984:THREE.NearestMipMapNearestFilter,9985:THREE.LinearMipMapNearestFilter,9986:THREE.NearestMipMapLinearFilter,9987:THREE.LinearMipMapLinearFilter},E={33071:THREE.ClampToEdgeWrapping,33648:THREE.MirroredRepeatWrapping,10497:THREE.RepeatWrapping},S=(THREE.BackSide,THREE.FrontSide,THREE.NeverDepth,THREE.LessDepth,THREE.EqualDepth,THREE.LessEqualDepth,THREE.GreaterEqualDepth,THREE.NotEqualDepth,THREE.GreaterEqualDepth,THREE.AlwaysDepth,THREE.AddEquation,THREE.SubtractEquation,THREE.ReverseSubtractEquation,THREE.ZeroFactor,THREE.OneFactor,THREE.SrcColorFactor,THREE.OneMinusSrcColorFactor,THREE.SrcAlphaFactor,THREE.OneMinusSrcAlphaFactor,THREE.DstAlphaFactor,THREE.OneMinusDstAlphaFactor,THREE.DstColorFactor,THREE.OneMinusDstColorFactor,THREE.SrcAlphaSaturateFactor,{SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16}),_={POSITION:"position",NORMAL:"normal",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",TEXCOORD_2:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},R={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},P={CUBICSPLINE:THREE.InterpolateSmooth,LINEAR:THREE.InterpolateLinear,STEP:THREE.InterpolateDiscrete},w="OPAQUE",j="MASK",N="BLEND",D={"image/png":THREE.RGBAFormat,"image/jpeg":THREE.RGBFormat};function U(e,t){return"string"!=typeof e||""===e?"":/^(https?:)?\/\//i.test(e)?e:/^data:.*,.*$/i.test(e)?e:/^blob:.*$/i.test(e)?e:t+e}function V(e,t,r){for(var i in r.extensions)void 0===e[i]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[i]=r.extensions[i])}function B(e,t){void 0!==t.extras&&("object"===h(t.extras)?e.userData=t.extras:console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function z(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(var r=0,i=t.weights.length;r<i;r++)e.morphTargetInfluences[r]=t.weights[r];if(t.extras&&Array.isArray(t.extras.targetNames)){var n=t.extras.targetNames;if(e.morphTargetInfluences.length===n.length){e.morphTargetDictionary={};for(r=0,i=n.length;r<i;r++)e.morphTargetDictionary[n[r]]=r}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function q(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(var r in e)if(e[r]!==t[r])return!1;return!0}function G(e,t){if(e.length!==t.length)return!1;for(var r=0,i=e.length;r<i;r++)if(e[r]!==t[r])return!1;return!0}function W(e,t){for(var r=0,i=e.length;r<i;r++){var n=e[r];if(o=n.primitive,a=t,void 0,s=o.extensions?o.extensions[A.KHR_DRACO_MESH_COMPRESSION]:void 0,l=a.extensions?a.extensions[A.KHR_DRACO_MESH_COMPRESSION]:void 0,s&&l?s.bufferView===l.bufferView&&q(s.attributes,l.attributes):o.indices===a.indices&&q(o.attributes,a.attributes))return n.promise}var o,a,s,l;return null}function u(e){if(e.isInterleavedBufferAttribute){for(var t=e.count,r=e.itemSize,i=e.array.slice(0,t*r),n=0;n<t;++n)i[n]=e.getX(n),2<=r&&(i[n+1]=e.getY(n)),3<=r&&(i[n+2]=e.getZ(n)),4<=r&&(i[n+3]=e.getW(n));return new THREE.BufferAttribute(i,r,e.normalized)}return e.clone()}function X(e,t,r){this.json=e||{},this.extensions=t||{},this.options=r||{},this.cache=new a,this.primitiveCache=[],this.multiplePrimitivesCache=[],this.multiPassGeometryCache=[],this.textureLoader=new THREE.TextureLoader(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.fileLoader=new THREE.FileLoader(this.options.manager),this.fileLoader.setResponseType("arraybuffer")}function Y(r,e,i){var t=e.attributes,n=[];function o(e,t){return i.getDependency("accessor",e).then(function(e){r.addAttribute(t,e)})}for(var a in t){var s=_[a];s&&(s in r.attributes||n.push(o(t[a],s)))}if(void 0!==e.indices&&!r.index){var l=i.getDependency("accessor",e.indices).then(function(e){r.setIndex(e)});n.push(l)}return B(r,e),Promise.all(n).then(function(){return void 0!==e.targets?function(d,f,e){for(var m=!1,g=!1,t=0,r=f.length;t<r&&(void 0!==(o=f[t]).POSITION&&(m=!0),void 0!==o.NORMAL&&(g=!0),!m||!g);t++);if(!m&&!g)return Promise.resolve(d);var i=[],n=[];for(t=0,r=f.length;t<r;t++){var o=f[t];if(m){var a=void 0!==o.POSITION?e.getDependency("accessor",o.POSITION).then(function(e){return u(e)}):d.attributes.position;i.push(a)}g&&(a=void 0!==o.NORMAL?e.getDependency("accessor",o.NORMAL).then(function(e){return u(e)}):d.attributes.normal,n.push(a))}return Promise.all([Promise.all(i),Promise.all(n)]).then(function(e){for(var t=e[0],r=e[1],i=0,n=f.length;i<n;i++){var o=f[i],a="morphTarget"+i;if(m&&void 0!==o.POSITION){var s=t[i];s.name=a;for(var l=d.attributes.position,c=0,u=s.count;c<u;c++)s.setXYZ(c,s.getX(c)+l.getX(c),s.getY(c)+l.getY(c),s.getZ(c)+l.getZ(c))}if(g&&void 0!==o.NORMAL){var h=r[i];h.name=a;var p=d.attributes.normal;for(c=0,u=h.count;c<u;c++)h.setXYZ(c,h.getX(c)+p.getX(c),h.getY(c)+p.getY(c),h.getZ(c)+p.getZ(c))}}return m&&(d.morphAttributes.position=t),g&&(d.morphAttributes.normal=r),d})}(r,e.targets,i):r})}X.prototype.parse=function(o,e){var a=this.json;this.cache.removeAll(),this.markDefs(),this.getMultiDependencies(["scene","animation","camera"]).then(function(e){var t=e.scenes||[],r=t[a.scene||0],i=e.animations||[],n=e.cameras||[];o(r,t,n,i,a)}).catch(e)},X.prototype.markDefs=function(){for(var e=this.json.nodes||[],t=this.json.skins||[],r=this.json.meshes||[],i={},n={},o=0,a=t.length;o<a;o++)for(var s=t[o].joints,l=0,c=s.length;l<c;l++)e[s[l]].isBone=!0;for(var u=0,h=e.length;u<h;u++){var p=e[u];void 0!==p.mesh&&(void 0===i[p.mesh]&&(i[p.mesh]=n[p.mesh]=0),i[p.mesh]++,void 0!==p.skin&&(r[p.mesh].isSkinnedMesh=!0))}this.json.meshReferences=i,this.json.meshUses=n},X.prototype.getDependency=function(e,t){var r=e+":"+t,i=this.cache.get(r);if(!i){switch(e){case"scene":i=this.loadScene(t);break;case"node":i=this.loadNode(t);break;case"mesh":i=this.loadMesh(t);break;case"accessor":i=this.loadAccessor(t);break;case"bufferView":i=this.loadBufferView(t);break;case"buffer":i=this.loadBuffer(t);break;case"material":i=this.loadMaterial(t);break;case"texture":i=this.loadTexture(t);break;case"skin":i=this.loadSkin(t);break;case"animation":i=this.loadAnimation(t);break;case"camera":i=this.loadCamera(t);break;case"light":i=this.extensions[A.KHR_LIGHTS_PUNCTUAL].loadLight(t);break;default:throw new Error("Unknown type: "+e)}this.cache.add(r,i)}return i},X.prototype.getDependencies=function(r){var e=this.cache.get(r);if(!e){var i=this,t=this.json[r+("mesh"===r?"es":"s")]||[];e=Promise.all(t.map(function(e,t){return i.getDependency(r,t)})),this.cache.add(r,e)}return e},X.prototype.getMultiDependencies=function(e){for(var r={},t=[],i=0,n=e.length;i<n;i++){var o=e[i],a=this.getDependencies(o);a=a.then(function(e,t){r[e]=t}.bind(this,o+("mesh"===o?"es":"s"))),t.push(a)}return Promise.all(t).then(function(){return r})},X.prototype.loadBuffer=function(e){var r=this.json.buffers[e],i=this.fileLoader;if(r.type&&"arraybuffer"!==r.type)throw new Error("THREE.GLTFLoader: "+r.type+" buffer type is not supported.");if(void 0===r.uri&&0===e)return Promise.resolve(this.extensions[A.KHR_BINARY_GLTF].body);var n=this.options;return new Promise(function(e,t){i.load(U(r.uri,n.path),e,void 0,function(){t(new Error('THREE.GLTFLoader: Failed to load buffer "'+r.uri+'".'))})})},X.prototype.loadBufferView=function(e){var i=this.json.bufferViews[e];return this.getDependency("buffer",i.buffer).then(function(e){var t=i.byteLength||0,r=i.byteOffset||0;return e.slice(r,r+t)})},X.prototype.loadAccessor=function(e){var _=this,w=this.json,T=this.json.accessors[e];if(void 0===T.bufferView&&void 0===T.sparse)return Promise.resolve(null);var t=[];return void 0!==T.bufferView?t.push(this.getDependency("bufferView",T.bufferView)):t.push(null),void 0!==T.sparse&&(t.push(this.getDependency("bufferView",T.sparse.indices.bufferView)),t.push(this.getDependency("bufferView",T.sparse.values.bufferView))),Promise.all(t).then(function(e){var t,r,i=e[0],n=S[T.type],o=M[T.componentType],a=o.BYTES_PER_ELEMENT,s=a*n,l=T.byteOffset||0,c=void 0!==T.bufferView?w.bufferViews[T.bufferView].byteStride:void 0,u=!0===T.normalized;if(c&&c!==s){var h="InterleavedBuffer:"+T.bufferView+":"+T.componentType,p=_.cache.get(h);p||(t=new o(i),p=new THREE.InterleavedBuffer(t,c/a),_.cache.add(h,p)),r=new THREE.InterleavedBufferAttribute(p,n,l/a,u)}else t=null===i?new o(T.count*n):new o(i,l,T.count*n),r=new THREE.BufferAttribute(t,n,u);if(void 0!==T.sparse){var d=S.SCALAR,f=M[T.sparse.indices.componentType],m=T.sparse.indices.byteOffset||0,g=T.sparse.values.byteOffset||0,v=new f(e[1],m,T.sparse.count*d),y=new o(e[2],g,T.sparse.count*n);null!==i&&r.setArray(r.array.slice());for(var b=0,x=v.length;b<x;b++){var E=v[b];if(r.setX(E,y[b*n]),2<=n&&r.setY(E,y[b*n+1]),3<=n&&r.setZ(E,y[b*n+2]),4<=n&&r.setW(E,y[b*n+3]),5<=n)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return r})},X.prototype.loadTexture=function(e){var r,t=this,i=this.json,n=this.options,o=this.textureLoader,a=window.URL||window.webkitURL,s=i.textures[e],l=s.extensions||{},c=(r=l[A.MSFT_TEXTURE_DDS]?i.images[l[A.MSFT_TEXTURE_DDS].source]:i.images[s.source]).uri,u=!1;return void 0!==r.bufferView&&(c=t.getDependency("bufferView",r.bufferView).then(function(e){u=!0;var t=new Blob([e],{type:r.mimeType});return c=a.createObjectURL(t)})),Promise.resolve(c).then(function(r){var i=THREE.Loader.Handlers.get(r);return i||(i=l[A.MSFT_TEXTURE_DDS]?t.extensions[A.MSFT_TEXTURE_DDS].ddsLoader:o),new Promise(function(e,t){i.load(U(r,n.path),e,void 0,t)})}).then(function(e){!0===u&&a.revokeObjectURL(c),e.flipY=!1,void 0!==s.name&&(e.name=s.name),r.mimeType in D&&(e.format=D[r.mimeType]);var t=(i.samplers||{})[s.sampler]||{};return e.magFilter=x[t.magFilter]||THREE.LinearFilter,e.minFilter=x[t.minFilter]||THREE.LinearMipMapLinearFilter,e.wrapS=E[t.wrapS]||THREE.RepeatWrapping,e.wrapT=E[t.wrapT]||THREE.RepeatWrapping,e})},X.prototype.assignTexture=function(r,i,n){var o=this;return this.getDependency("texture",n.index).then(function(e){if(o.extensions[A.KHR_TEXTURE_TRANSFORM]){var t=void 0!==n.extensions?n.extensions[A.KHR_TEXTURE_TRANSFORM]:void 0;t&&(e=o.extensions[A.KHR_TEXTURE_TRANSFORM].extendTexture(e,t))}r[i]=e})},X.prototype.loadMaterial=function(e){var a,t=this.json,s=this.extensions,l=t.materials[e],c={},u=l.extensions||{},r=[];if(u[A.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){var i=s[A.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];a=i.getMaterialType(l),r.push(i.extendParams(c,l,this))}else if(u[A.KHR_MATERIALS_UNLIT]){var n=s[A.KHR_MATERIALS_UNLIT];a=n.getMaterialType(l),r.push(n.extendParams(c,l,this))}else{a=THREE.MeshStandardMaterial;var o=l.pbrMetallicRoughness||{};if(c.color=new THREE.Color(1,1,1),c.opacity=1,Array.isArray(o.baseColorFactor)){var h=o.baseColorFactor;c.color.fromArray(h),c.opacity=h[3]}void 0!==o.baseColorTexture&&(r.push(this.assignTexture(c,"map",o.baseColorTexture)),1==o.baseColorTexture.texCoord&&(c.__useDiffuseUV2=!0)),c.metalness=void 0!==o.metallicFactor?o.metallicFactor:1,c.roughness=void 0!==o.roughnessFactor?o.roughnessFactor:1,void 0!==o.metallicRoughnessTexture&&(r.push(this.assignTexture(c,"metalnessMap",o.metallicRoughnessTexture)),r.push(this.assignTexture(c,"roughnessMap",o.metallicRoughnessTexture)))}!0===l.doubleSided&&(c.side=THREE.DoubleSide);var p=l.alphaMode||w;p===N?c.transparent=!0:(c.transparent=!1,p===j&&(c.alphaTest=void 0!==l.alphaCutoff?l.alphaCutoff:.5)),void 0!==l.normalTexture&&a!==THREE.MeshBasicMaterial&&(r.push(this.assignTexture(c,"normalMap",l.normalTexture)),c.normalScale=new THREE.Vector2(1,1),void 0!==l.normalTexture.scale&&c.normalScale.set(l.normalTexture.scale,l.normalTexture.scale)),void 0!==l.occlusionTexture&&a!==THREE.MeshBasicMaterial&&(r.push(this.assignTexture(c,"aoMap",l.occlusionTexture)),void 0!==l.occlusionTexture.strength&&(c.aoMapIntensity=l.occlusionTexture.strength)),void 0!==l.emissiveFactor&&a!==THREE.MeshBasicMaterial&&(c.emissive=(new THREE.Color).fromArray(l.emissiveFactor)),void 0!==l.emissiveTexture&&a!==THREE.MeshBasicMaterial&&r.push(this.assignTexture(c,"emissiveMap",l.emissiveTexture));var d=[],f=u.blend;if(f)for(var m=0;m<f.length;m++)f[m].maskTexture&&r.push(this.assignTexture(d,m,f[m].maskTexture));return Promise.all(r).then(function(){var e,t=c.__useDiffuseUV2;for(var r in t&&delete c.__useDiffuseUV2,e=a===THREE.ShaderMaterial?s[A.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(c):new a(c),void 0!==l.name&&(e.name=l.name),e.normalScale&&(e.normalScale.y=-e.normalScale.y),e.map&&(e.map.encoding=THREE.sRGBEncoding),e.emissiveMap&&(e.emissiveMap.encoding=THREE.sRGBEncoding),e.specularMap&&(e.specularMap.encoding=THREE.sRGBEncoding),B(e,l),l.extensions&&V(s,e,l),u)void 0===s[r]&&("sceneBlend"===r?(e.transparent=!0,e.blending=void 0===THREE[u[r]+"Blending"]?1:THREE[u[r]+"Blending"]):"blend"===r&&(e.__texture=d));var i=l.pbrMetallicRoughness.baseColorTexture,n=l.emissiveTexture,o=l.normalTexture;return void 0===e.userData.gltfExtensions&&(e.userData.gltfExtensions={}),i&&i.extensions&&(e.userData.gltfExtensions.baseColorTexture=i.extensions),n&&n.extensions&&(e.userData.gltfExtensions.emissiveTexture=n.extensions),o&&o.extensions&&(e.userData.gltfExtensions.normalTexture=o.extensions),t&&(e.userData.gltfExtensions.useDiffuseUV2=!0),e})},X.prototype.loadGeometries=function(a){var h,s=this,e=this.extensions,t=this.primitiveCache,p=function(e){if(e.length<2)return!1;var t=e[0],r=t.targets||[];if(void 0===t.indices)return!1;for(var i=1,n=e.length;i<n;i++){var o=e[i];if(t.mode!==o.mode)return!1;if(void 0===o.indices)return!1;if(o.extensions&&o.extensions[A.KHR_DRACO_MESH_COMPRESSION])return!1;if(!q(t.attributes,o.attributes))return!1;var a=o.targets||[];if(r.length!==a.length)return!1;for(var s=0,l=r.length;s<l;s++)if(!q(r[s],a[s]))return!1}return!0}(a);function r(t){return e[A.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(t,s).then(function(e){return Y(e,t,s)})}p&&(a=[(h=a)[0]]);for(var i=[],n=0,o=a.length;n<o;n++){var l,c=a[n],u=W(t,c);if(u)i.push(u);else l=c.extensions&&c.extensions[A.KHR_DRACO_MESH_COMPRESSION]?r(c):Y(new THREE.BufferGeometry,c,s),t.push({primitive:c,promise:l}),i.push(l)}return Promise.all(i).then(function(e){if(e.forEach(function(e){var t=e.attributes.color;if(t&&4===t.itemSize){for(var r=t.count,i=new Float32Array(r),n=0;n<r;n++)i.set([t.getW(n)],n);var o=new THREE.BufferAttribute(i,1);e.addAttribute("alphaIndex",o)}}),p){var l=e[0];if(null!==(o=function(e,t,r){for(var i=0,n=e.length;i<n;i++){var o=e[i];if(t===o.baseGeometry&&G(r,o.primitives))return o.geometry}return null}(u=s.multiPassGeometryCache,l,h)))return[o.geometry];var c=new THREE.BufferGeometry;for(var t in c.name=l.name,c.userData=l.userData,l.attributes)c.addAttribute(t,l.attributes[t]);for(var t in l.morphAttributes)c.morphAttributes[t]=l.morphAttributes[t];for(var r=[],i=0,n=h.length;i<n;i++)r.push(s.getDependency("accessor",h[i].indices));return Promise.all(r).then(function(e){for(var t=[],r=0,i=0,n=h.length;i<n;i++){for(var o=e[i],a=0,s=o.count;a<s;a++)t.push(o.array[a]);c.addGroup(r,o.count,i),r+=o.count}return c.setIndex(t),u.push({geometry:c,baseGeometry:l,primitives:h}),[c]})}if(1<e.length&&void 0!==THREE.BufferGeometryUtils){for(i=1,n=a.length;i<n;i++)if(a[0].mode!==a[i].mode)return e;var u,o;if(o=function(e,t){for(var r=0,i=e.length;r<i;r++){var n=e[r];if(G(t,n.baseGeometries))return n.geometry}return null}(u=s.multiplePrimitivesCache,e)){if(null!==o.geometry)return[o.geometry]}else{c=THREE.BufferGeometryUtils.mergeBufferGeometries(e,!0);if(u.push({geometry:c,baseGeometries:e}),null!==c)return[c]}}return e})},X.prototype.loadMesh=function(T){for(var M=this,e=this.json,S=this.extensions,R=e.meshes[T],P=R.primitives,t=[],r=0,i=P.length;r<i;r++){var n=void 0===P[r].material?new THREE.MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:THREE.FrontSide}):this.getDependency("material",P[r].material);t.push(n)}return Promise.all(t).then(function(w){return M.loadGeometries(P).then(function(e){for(var t=1===e.length&&0<e[0].groups.length,r=[],i=0,n=e.length;i<n;i++){var o,a=e[i],s=P[i],l=t?w:w[i];if(s.mode===F||s.mode===k||s.mode===I||void 0===s.mode)!0===(o=!0===R.isSkinnedMesh?new THREE.SkinnedMesh(a,l):new THREE.Mesh(a,l)).isSkinnedMesh&&o.normalizeSkinWeights(),s.mode===k?o.drawMode=THREE.TriangleStripDrawMode:s.mode===I&&(o.drawMode=THREE.TriangleFanDrawMode);else if(s.mode===L)o=new THREE.LineSegments(a,l);else if(s.mode===H)o=new THREE.Line(a,l);else if(s.mode===O)o=new THREE.LineLoop(a,l);else{if(s.mode!==C)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+s.mode);o=new THREE.Points(a,l)}0<Object.keys(o.geometry.morphAttributes).length&&z(o,R),o.name=R.name||"mesh_"+T,1<e.length&&(o.name+="_"+i),B(o,R),r.push(o);for(var c=t?o.material:[o.material],u=void 0!==a.attributes.color,h=void 0!==a.attributes.alphaIndex,p=void 0===a.attributes.normal,d=!0===o.isSkinnedMesh,f=0<Object.keys(a.morphAttributes).length,m=f&&void 0!==a.morphAttributes.normal,g=0,v=c.length;g<v;g++){l=c[g];if(o.isPoints){var y="PointsMaterial:"+l.uuid,b=M.cache.get(y);b||(b=new THREE.PointsMaterial,THREE.Material.prototype.copy.call(b,l),b.color.copy(l.color),b.map=l.map,b.lights=!1,M.cache.add(y,b)),l=b}else if(o.isLine){y="LineBasicMaterial:"+l.uuid;var x=M.cache.get(y);x||(x=new THREE.LineBasicMaterial,THREE.Material.prototype.copy.call(x,l),x.color.copy(l.color),x.lights=!1,M.cache.add(y,x)),l=x}if(u||h||p||d||f){y="ClonedMaterial:"+l.uuid+":";l.isGLTFSpecularGlossinessMaterial&&(y+="specular-glossiness:"),d&&(y+="skinning:"),u&&(y+="vertex-colors:"),h&&(y+="vertex-alpha:"),p&&(y+="flat-shading:"),f&&(y+="morph-targets:"),m&&(y+="morph-normals:");var E=M.cache.get(y);E||(E=l.isGLTFSpecularGlossinessMaterial?S[A.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].cloneMaterial(l):l.clone(),d&&(E.skinning=!0),u&&(E.vertexColors=THREE.VertexColors),h&&(E.defines=E.defines||{},E.defines.USE_ALPHAINDEX=!0),p&&(E.flatShading=!0),f&&(E.morphTargets=!0),m&&(E.morphNormals=!0),M.cache.add(y,E)),l=E}(c[g]=l).aoMap&&void 0===a.attributes.uv2&&void 0!==a.attributes.uv&&(console.log("THREE.GLTFLoader: Duplicating UVs to support aoMap."),a.addAttribute("uv2",new THREE.BufferAttribute(a.attributes.uv.array,2))),l.isGLTFSpecularGlossinessMaterial&&(o.onBeforeRender=S[A.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].refreshUniforms)}o.material=t?c:c[0]}if(1===r.length)return r[0];var _=new THREE.Group;for(i=0,n=r.length;i<n;i++)_.add(r[i]);return _})})},X.prototype.loadCamera=function(e){var t,r=this.json.cameras[e],i=r[r.type];if(i)return"perspective"===r.type?t=new THREE.PerspectiveCamera(THREE.Math.radToDeg(i.yfov),i.aspectRatio||1,i.znear||1,i.zfar||2e6):"orthographic"===r.type&&(t=new THREE.OrthographicCamera(i.xmag/-2,i.xmag/2,i.ymag/2,i.ymag/-2,i.znear,i.zfar)),void 0!==r.name&&(t.name=r.name),B(t,r),Promise.resolve(t);console.warn("THREE.GLTFLoader: Missing camera parameters.")},X.prototype.loadSkin=function(e){var t=this.json.skins[e],r={joints:t.joints};return void 0===t.inverseBindMatrices?Promise.resolve(r):this.getDependency("accessor",t.inverseBindMatrices).then(function(e){return r.inverseBindMatrices=e,r})},X.prototype.loadAnimation=function(_){for(var w=this.json.animations[_],e=[],t=[],r=[],i=[],n=[],o=0,a=w.channels.length;o<a;o++){var s=w.channels[o],l=w.samplers[s.sampler],c=s.target,u=void 0!==c.node?c.node:c.id,h=void 0!==w.parameters?w.parameters[l.input]:l.input,p=void 0!==w.parameters?w.parameters[l.output]:l.output;e.push(this.getDependency("node",u)),t.push(this.getDependency("accessor",h)),r.push(this.getDependency("accessor",p)),i.push(l),n.push(c)}return Promise.all([Promise.all(e),Promise.all(t),Promise.all(r),Promise.all(i),Promise.all(n)]).then(function(e){for(var t=e[0],r=e[1],i=e[2],n=e[3],o=e[4],a=[],s=0,l=t.length;s<l;s++){var c=t[s],u=r[s],h=i[s],p=n[s],d=o[s];if(void 0!==c){var f;switch(c.updateMatrix(),c.matrixAutoUpdate=!0,R[d.path]){case R.weights:f=THREE.NumberKeyframeTrack;break;case R.rotation:f=THREE.QuaternionKeyframeTrack;break;case R.position:case R.scale:default:f=THREE.VectorKeyframeTrack}var m=c.name?c.name:c.uuid,g=void 0!==p.interpolation?P[p.interpolation]:THREE.InterpolateLinear,v=[];R[d.path]===R.weights?c.traverse(function(e){!0===e.isMesh&&e.morphTargetInfluences&&v.push(e.name?e.name:e.uuid)}):v.push(m);for(var y=0,b=v.length;y<b;y++){var x=new f(v[y]+"."+R[d.path],THREE.AnimationUtils.arraySlice(u.array,0),THREE.AnimationUtils.arraySlice(h.array,0),g);"CUBICSPLINE"===p.interpolation&&(x.createInterpolant=function(e){return new T(this.times,this.values,this.getValueSize()/3,e)},x.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),a.push(x)}}}var E=void 0!==w.name?w.name:"animation_"+_;return new THREE.AnimationClip(E,void 0,a)})},X.prototype.loadNode=function(e){var t=this.json,r=this.extensions,i=this,a=t.meshReferences,s=t.meshUses,l=t.nodes[e];return new Promise(function(o){!0===l.isBone?o(new THREE.Bone):void 0!==l.mesh?i.getDependency("mesh",l.mesh).then(function(e){var t;if(1<a[l.mesh]){var r=s[l.mesh]++;(t=e.clone()).name+="_instance_"+r,t.onBeforeRender=e.onBeforeRender;for(var i=0,n=t.children.length;i<n;i++)t.children[i].name+="_instance_"+r,t.children[i].onBeforeRender=e.children[i].onBeforeRender}else t=e;o(t)}):void 0!==l.camera?i.getDependency("camera",l.camera).then(o):l.extensions&&l.extensions[A.KHR_LIGHTS_PUNCTUAL]&&void 0!==l.extensions[A.KHR_LIGHTS_PUNCTUAL].light?i.getDependency("light",l.extensions[A.KHR_LIGHTS_PUNCTUAL].light).then(o):o(new THREE.Object3D)}).then(function(e){if(void 0!==l.name&&(e.name=THREE.PropertyBinding.sanitizeNodeName(l.name)),B(e,l),l.extensions&&V(r,e,l),void 0!==l.matrix){var t=new THREE.Matrix4;t.fromArray(l.matrix),e.applyMatrix(t)}else void 0!==l.translation&&e.position.fromArray(l.translation),void 0!==l.rotation&&e.quaternion.fromArray(l.rotation),void 0!==l.scale&&e.scale.fromArray(l.scale);return e})},X.prototype.loadScene=function(){function u(e,a,s,l){var c=s.nodes[e];return l.getDependency("node",e).then(function(h){return void 0===c.skin?h:l.getDependency("skin",c.skin).then(function(e){for(var t=[],r=0,i=(p=e).joints.length;r<i;r++)t.push(l.getDependency("node",p.joints[r]));return Promise.all(t)}).then(function(e){for(var t=!0===h.isGroup?h.children:[h],r=0,i=t.length;r<i;r++){for(var n=t[r],o=[],a=[],s=0,l=e.length;s<l;s++){var c=e[s];if(c){o.push(c);var u=new THREE.Matrix4;void 0!==p.inverseBindMatrices&&u.fromArray(p.inverseBindMatrices.array,16*s),a.push(u)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',p.joints[s])}n.bind(new THREE.Skeleton(o,a),n.matrixWorld)}return h});var p}).then(function(e){a.add(e);var t=[];if(c.children)for(var r=c.children,i=0,n=r.length;i<n;i++){var o=r[i];t.push(u(o,e,s,l))}return Promise.all(t)})}return function(e){var t=this.json,r=this.extensions,i=this.json.scenes[e],n=new THREE.Scene;void 0!==i.name&&(n.name=i.name),B(n,i),i.extensions&&V(r,n,i);for(var o=i.nodes||[],a=[],s=0,l=o.length;s<l;s++)a.push(u(o[s],n,t,this));return Promise.all(a).then(function(){return n})}}();var s=Object.prototype.toString,t=function(t){return function(e){return s.call(e)=="[object "+t+"]"}},Q={isType:t,isArray:t("Array"),isObject:t("Object"),isString:t("String"),isNumber:t("Number"),isFunction:t("Function"),isRegExp:t("RegExp"),isUndefined:t("Undefined"),objectKeysToLowerCase:function(e,t,r){var i,n,o,a,s,l,c,u;if(l=Q.objectKeysToLowerCase,"undefined"===(c=h(t))||null===t||0===t||!1===t)t=0;else if("object"===c){if(!(t instanceof l))throw new TypeError('Expected "deep" to be a special object')}else if(!0===t)t=1/0;else{if("number"!==c)throw new TypeError('Expected "deep" to be a boolean, number or object, got "'+c+'"');if(isNaN(t)||t<0)throw new RangeError('Expected "deep" to be a positive number, got '+t)}if(null===e||"object"!==h(e))throw new TypeError('Expected "input" to be an object');if(c=h(r),null!==r&&"undefined"!==c&&"function"!==c)throw new TypeError('Expected "filter" to be a function');if(r=r||null,a=(o=Object.keys(e)).length-1,s={},t){if("number"==typeof t)t=Object.seal(Object.create(l.prototype,{input:{value:[]},output:{value:[]},level:{value:-1,writable:!0},max:{value:t,writable:!1}}));else if(~(i=t.input.indexOf(e)))return t.output[i];for(t.level+=1,t.input.push(e),t.output.push(s),i=a+1;i--;)"object"===h(u=e[n=o[a-i]])&&u&&t.level<t.max&&(r?r(u):u.constructor===Object)&&(u=l(u,t,r)),s[n.toLowerCase()]=u;t.level-=1}else for(i=a+1;i--;)s[(n=o[a-i]).toLowerCase()]=e[n];return s}};String.prototype.removeAt=function(e){var t=this.substring(0);return e>=this.length?t:t.slice(0,e)+t.slice(e+1)},String.prototype.getPath=function(){var e=0<=this.indexOf("\\")?this.lastIndexOf("\\"):this.lastIndexOf("/");return this.substring(0,e)},String.prototype.getExtension=function(){var e=this.split(".");return 1<e.length?e.pop():""},String.prototype.getFileName=function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0],t=0<=this.indexOf("\\")?this.lastIndexOf("\\"):this.lastIndexOf("/");if(-1===t)return e?this:this.split(".")[0];var r=this.substring(t);return 0!==r.indexOf("\\")&&0!==r.indexOf("/")||(r=r.substring(1)),e?r:r.split(".")[0]},String.prototype._trimLeft=function(e){return void 0===e&&(e="s"),this.replace(new RegExp("^["+e+"]+"),"")},String.prototype._trimRight=function(e){return void 0===e&&(e="s"),this.replace(new RegExp("["+e+"]+$"),"")},String.prototype.trimBoth=function(e){return this._trimLeft(e)._trimRight(e)},String.prototype.appendPath=function(e){return this._trimRight("/")+"/"+e._trimLeft("/")._trimRight("/")},String.prototype.replaceAll=function(e,t){if(!this.length)return"";for(var r=this.substring(0);-1!==r.indexOf(e);)r=r.replace(e,t);return r};var J=function(){function r(e){n(this,r),this._major=0,this._minor=0,this._modified=0;var t=e.split(".");this._major=parseInt(1<=t.length?t[0]:0),this._minor=parseInt(2<=t.length?t[1]:0),this._modified=parseInt(3<=t.length?t[2]:0)}return o(r,[{key:"compare",value:function(e){return Q.isString(e)&&(e=new r(e)),this._major!=e._major?this._major>e._major?1:-1:this._minor!=e._minor?this._minor>e._minor?1:-1:this._modified!=e._modified?this._modified>e._modified?1:-1:0}},{key:"major",get:function(){return this._major}},{key:"minor",get:function(){return this._minor}},{key:"modified",get:function(){return this._modified}}]),r}(),Z=function(){function r(e){n(this,r);var t=e.split(" ");this.initYear(t[0]),this.initTime(t[1])}return o(r,[{key:"initYear",value:function(e){var t=e.split("-");this._year=parseInt(t[0],10),this._month=parseInt(t[1],10),this._date=parseInt(t[2],10)}},{key:"initTime",value:function(e){var t=e.split(":");this._hours=parseInt(t[0],10),this._minutes=parseInt(t[1],10),this._seconds=parseInt(t[2],10)}},{key:"getYear",value:function(){return this._year}},{key:"getMonth",value:function(){return this._month-1}},{key:"getDate",value:function(){return this._date}},{key:"getHours",value:function(){return this._hours}},{key:"getMinutes",value:function(){return this._minutes}},{key:"getSeconds",value:function(){return this._seconds}}]),r}(),K=function(){function e(){n(this,e)}return o(e,[{key:"GLTF_decoder_1_count",value:function(e,t,r,i){return 0==e?i-t:e%2?r%2?i+t:i:i-t}},{key:"GLTF_decoder_1_offset",value:function(e,t,r,i){return 0==e?i:e%2?i-(t*=r):i}},{key:"GLTF_decoder_1_length",value:function(e,t,r,i,n){return t*=r,0==e?n-t:e%2?i%2?n+t:n:n-t}},{key:"GLTF_decoder_2_offset",value:function(e,t,r,i){return e%2?i-(t*=r):i}},{key:"GLTF_decoder_2_length",value:function(e,t,r,i,n){return t*=r,e%2?i%2?n+t:n:n-t}},{key:"GLTF_decoder_3_offset",value:function(e,t,r,i){return e%2?i-(t*=r):i}},{key:"GLTF_decoder_3_length",value:function(e,t,r,i,n){return t*=r,e%2?i%2?n+t:n:n-t}}]),e}(),$=function(){function r(e,t){n(this,r),this._decoder={},this._nameDecoder={},t?(t.data=Q.objectKeysToLowerCase(e),this._init(t.data)):this._init(e)}return o(r,[{key:"_initDecoder",value:function(e){var t=e.createtime;if(t){var r=new Z(t),i=r.getSeconds();this._decoder.version=Math.floor(i/10);for(var n=e.size,o=1,a=0;a<n.length;a++){var s=n[a].toString();-1!==s.indexOf(".")&&(o+=Math.floor(s.substring(s.length-1)))}this._decoder.randomWeight=o,this._decoder.randomRanges=[r.getHours()+1,r.getDate()+1,r.getSeconds()%13+1,r.getMinutes()%13+1,o%5*(o%5)+1,e.verts%13+1,e.faces%13+1,e.nodes%13+1]}}},{key:"_decode21_name",value:function(e,t){var r=["F7WD3HNR2OPYV6AUS5TKM018ZBJL4EQXIGC9F","A0JQM9PSLXF18647URV3DNHOCY52TEZBWIGKA","B0IE6Q4S3C7OA28UHTPXDW9NYMGLF1K5VJRZB","EQ72MKL3DYNF5RU1PWBT64X9CIZVJHS8G0OAE"],i=e.charAt(0),n=r[1].indexOf(i);if(-1!==n){n++,n=Math.floor(n/2)+1;var o=(e=e.removeAt(n)).getExtension();e=e.getFileName(!1);for(var a="",s=0;s<e.length;s++){var l=e[s],c=r[(s+1+t)%4],u=c.indexOf(l);0===u?u=35:u--,a+=c[u]}return o?a+"."+o:a}}},{key:"_initResourceDecoder",value:function(e,t){var r=t.texfiles;if(r){var i=new J(e),n=null;2==i.major&&1==i.minor&&(n=this._decode21_name);var o=Object.keys(r).length,a=t.gltffiles;if(a)for(var s=0;s<a.length;s++)a[s]=n(a[s],o);var l=t.lod;if(l){var c=Object.keys(l);for(s=0;s<c.length;s++){var u=c[s];l[n(u,o)]=l[u],delete l[u]}}this._nameDecoder.version=i,this._nameDecoder.decodeFunc=n}}},{key:"_init",value:function(e){if(e){var t=e.version;if(t)new J(t).compare("2.0")<=0||(this._initDecoder(e),this._initResourceDecoder(t,e))}}},{key:"decode",value:function(e,t,r){var i=new K;switch(this._decoder.version){case 0:case 3:var n=this._decoder.randomWeight;if("_accessors"==t)for(var o=0;o<r.length;o++){var a=r[o];(c=e.bufferViews[a.bufferView]).factor=Math.floor(c.byteLength/a.count),c.opFactor=a.byteType,a.count=i.GLTF_decoder_1_count(o,n,a.byteType,a.count),delete a.byteType}else if("_bufferViews"==t)for(o=0;o<r.length;o++){var s=(c=r[o]).factor;c.byteOffset=i.GLTF_decoder_1_offset(o,n,s,c.byteOffset),c.byteLength=i.GLTF_decoder_1_length(o,n,s,c.opFactor,c.byteLength),delete c.factor,delete c.opFactor}break;case 1:case 4:var l=this._decoder.randomRanges;if("_accessors"==t)for(o=0;o<r.length;o++){a=r[o];(c=e.bufferViews[a.bufferView]).factor=Math.floor(c.byteLength/a.count),c.opFactor=a.byteType;n=l[Math.floor(o/2)%8]+(o+1)%7;a.count=i.GLTF_decoder_1_count(o,n,a.byteType,a.count),delete a.byteType}else if("_bufferViews"==t)for(o=0;o<r.length;o++){var c=r[o],u=l[Math.floor(o/2)%8]+(o+1)%7;s=c.factor;c.byteOffset=i.GLTF_decoder_2_offset(o,u,s,c.byteOffset),c.byteLength=i.GLTF_decoder_2_length(o,u,s,c.opFactor,c.byteLength),delete c.factor,delete c.opFactor}break;case 2:case 5:this._decoder.randomRanges3=[this._decoder.randomRanges[7],7*e.materials.length%10];var h=(e.buffers[0].byteLength-999).toString();for(o=0;o<h.length;o++){var p=10-Math.floor(h[o]);this._decoder.randomRanges3.push(p)}this._decoder.randomRanges3.push(this._decoder.randomRanges[3]);l=this._decoder.randomRanges3;if("_accessors"==t)for(o=0;o<r.length;o++){a=r[o],c=e.bufferViews[a.bufferView],n=l[Math.floor(o/2)%l.length]+Math.floor(o+1)%7;c.factor=Math.floor(c.byteLength/a.count),c.opFactor=a.byteType,a.count=i.GLTF_decoder_1_count(o,n,a.byteType,a.count),delete a.byteType}else if("_bufferViews"==t)for(o=0;o<r.length;o++){c=r[o],u=l[Math.floor(o/2)%l.length]+Math.floor(o+1)%7,s=c.factor;c.byteOffset=i.GLTF_decoder_3_offset(o,u,s,c.byteOffset),c.byteLength=i.GLTF_decoder_3_length(o,u,s,c.opFactor,c.byteLength),delete c.factor,delete c.opFactor}}var d=this._nameDecoder.decodeFunc;if(d&&("_buffers"==t||"_images"==t)){var f=e.buffers.length+e.images.length;for(o=0;o<r.length;o++){var m=d(r[o].uri,f);m&&(r[o].uri=m)}}}},{key:"decodeDracoFile",value:function(e,t,r){}}]),r}();var ee={process:function(e,n){e.traverse(function(e){var t,r,i;!function(e,t){if(e.material&&e.material.userData&&e.material.userData.gltfExtensions){var r=e.material.userData.gltfExtensions.blend;if(r){var i,n,o,a=e.material.__texture,s=e.geometry.index.count,l=[{materialIndex:0,start:0,count:s}],c=[e.material];for(i=0;i<r.length;i++)(n=t[r[i].subMaterial].clone())&&(n.transparent=!0,r[i].maskTexture&&(1===(o=r[i].maskTexture.texCoord||0)&&(n.defines.USE_ALPHA_UV2=""),2===o&&(n.defines.USE_ALPHA_UV3=""),r[i].maskTexture.extensions&&(n.userData.gltfExtensions.alphaTexture=r[i].maskTexture.extensions),n.alphaMap=a[i],n.needsUpdate=!0),c.push(n),l.push({materialIndex:c.length-1,start:0,count:s}));e.material=c,e.geometry.groups=l}}}(e,n),(t=e).isMesh&&(t.castShadow=!0,t.receiveShadow=!0),(r=e).material&&(Array.isArray(r.material)?r.material.forEach(function(e){e.map&&(e.userData.gltfExtensions.useDiffuseUV2&&(e.defines=e.defines||{},e.defines.USE_DIFFUSE_UV2=""),e.map.anisotropy=16,e.map.needsUpdate=!0)}):r.material.map&&(r.material.userData.gltfExtensions.useDiffuseUV2&&(r.material.defines=r.material.defines||{},r.material.defines.USE_DIFFUSE_UV2=""),r.material.map.anisotropy=16,r.material.map.needsUpdate=!0)),(i=e).userData&&i.userData.gltfExtensions&&i.userData.gltfExtensions.effects&&(i.technique={},i.userData.gltfExtensions.effects.bloom&&(i.technique.glow=!0,i.traverse(function(e){(e.isMesh||e.isLine||e.isSprite||e.isPoints)&&(e.technique=e.technique||{},e.technique.glow=!0)})),i.userData.gltfExtensions.effects.glowInset&&(i.technique.innerGlow=!0,i.traverse(function(e){(e.isMesh||e.isLine||e.isSprite||e.isPoints)&&(e.technique=e.technique||{},e.technique.innerGlow=!0)})),delete i.userData.effects)})}},te=function(){function t(e){n(this,t),this._manager=e,this._loader=new r(e)}return o(t,[{key:"_ProcessProgressCallback",value:function(e,t,r){var i=0;t.lengthComputable&&0<t.total?1<t.target.readyState&&(i=t.loaded/t.total):i=1,r&&1==(i*=(r.cur+1)/r.total)&&r.cur++,e({progress:i})}},{key:"_loadGLTFs",value:function(e,t,r,i,n,o,a,s,l){var c=this,u=this._loader;u.loadingIndex=i,u.setDRACOLoader(e),u.setCrossOrigin("anonymous");var h=r.gltffiles[i],p=t.appendPath(h),d=r.lod;this.load(p,function(e){if(d){var t=h.getFileName(!1),r=d[t];Q.isNumber(r)||(console.error("The '"+t+"' distance is invalid, please check name is existing in index.json"),r=1e4),n.addLevel(e.scene,r)}else n.add(e.scene);o.loadedNumber++,o.loadedNumber===o.totalNumber&&s&&s({url:p.getPath(),node:n,animations:e.animations,materials:e.materials})},function(e){a&&c._ProcessProgressCallback(a,e,o)},function(e){console.error(e),l&&l()})}},{key:"loadGLTFs",value:function(e,t,r,i,n,o){var a;t&&null!=r&&r(t),a=t.lod?new THREE.LOD:new THREE.Group;for(var s=t.gltffiles,l={loadedNumber:0,totalNumber:s.length,cur:0,total:s.length},c={},u=new $(t,c),h=0;h<s.length;h++)this._loadGLTFs(u,e,c.data,h,a,l,n,i,o)}},{key:"loadGLTF",value:function(e,t,r,i,n,o){t=t||{};var a,s={},l=this._loader;l.setDRACOLoader(new $(t,s)),l.setCrossOrigin("anonymous"),t=s.data,null!=r&&r(t);var c=t.gltffiles;a=c&&c.length?e.appendPath(c[0]):e.appendPath("scene.gltf");var u=this;this.load(a,function(e){null!=i&&i({url:a.getPath(),node:e.scene,animations:e.animations,materials:e.materials})},function(e){n&&u._ProcessProgressCallback(n,e)},function(e){console.error(e),o&&o()})}},{key:"downloadGLTF",value:function(n,o,a,s,l){var e=n.appendPath("index.json"),c=this;new THREE.FileLoader(this._manager).load(e,function(e){if(e){var t=Q.objectKeysToLowerCase(JSON.parse(e)),r=t.gltffiles;if(r&&0!==r.length){for(var i=0;i<r.length;i++)r[i]||r.splice(i--,1);1===r.length?c.loadGLTF(n,t,o,a,s,l):c.loadGLTFs(n,t,o,a,s,l)}else c.loadGLTF(n,t,o,a,s,l)}},function(){},function(){c.loadGLTF(n,null,o,a,s,l)})}},{key:"downloadJSON",value:function(i,n){(new THREE.JSONLoader).load(i,function(e,t){for(var r in t)t[r].skinning=!0;null!=n&&n({url:i,geometry:e,materials:t})})}},{key:"loadFromURL",value:function(e){var t=e.url,r=e.jsonCallback,i=e.modelCallback,n=e.progressCallback,o=e.errorCallback;"js"==t.getExtension()?this.downloadJSON(t,i):this.downloadGLTF(t,r,i,n,o)}},{key:"load",value:function(e,i,n,o){this._loader.load(e,function(e){ee.process(e.scene,e.materials),i&&i(e)},n,o);var a=this;return{then:function(t,r){return a._loader.load(e,function(e){ee.process(e.scene,e.materials),i&&i(e),t(e)},n,function(e){o&&o(e),r(e)}),this}}}},{key:"setCrossOrigin",value:function(e){return this._loader.setCrossOrigin(e),this}},{key:"setPath",value:function(e){return this._loader.setPath(e),this}},{key:"setResourcePath",value:function(e){return this._loader.setResourcePath(e),this}}]),t}(),re=function(){function i(e,t){n(this,i);var r=JSON.parse(e);this._asset=r.asset,this._scene=r.scene,this._scenes=r.scenes,this._extensionsUsed=r.extensionsUsed,this._extensions=r.extensions,this._nodes=r.nodes,this._accessors=r.accessors,this._images=r.images,this._skins=r.skins,this._meshes=r.meshes,this._textures=r.textures,this._samplers=r.samplers,this._materials=r.materials,this._cameras=r.cameras,this._animations=r.animations,this._buffers=r.buffers,this._bufferViews=r.bufferViews,this._meshReferences=r.meshReferences,this._meshUses=r.meshUses,this._init(t)}return o(i,[{key:"_init",value:function(e){var t=e.dracoLoader;if(t)for(var r=Object.keys(this),i=0;i<r.length;i++){var n=r[i],o=this[n];o&&t.decode(this,n,o)}}},{key:"asset",get:function(){return this._asset}},{key:"scene",get:function(){return this._scene}},{key:"scenes",get:function(){return this._scenes}},{key:"extensionsUsed",get:function(){return this._extensionsUsed}},{key:"extensions",get:function(){return this._extensions}},{key:"nodes",get:function(){return this._nodes}},{key:"accessors",get:function(){return this._accessors}},{key:"images",get:function(){return this._images}},{key:"skins",get:function(){return this._skins}},{key:"meshes",get:function(){return this._meshes}},{key:"textures",get:function(){return this._textures}},{key:"samplers",get:function(){return this._samplers}},{key:"materials",get:function(){return this._materials}},{key:"cameras",get:function(){return this._cameras}},{key:"animations",get:function(){return this._animations}},{key:"buffers",get:function(){return this._buffers}},{key:"bufferViews",get:function(){return this._bufferViews}},{key:"meshReferences",set:function(e){this._meshReferences=e},get:function(){return this._meshReferences}},{key:"meshUses",set:function(e){this._meshUses=e},get:function(){return this._meshUses}}]),i}();JSON.parseX=function(e,t){return new re(e,t)},re.prototype.toJSON=function(){},THREE&&(THREE.GLTFLoader=te),e.GLTFLoader=te,e.JSONXLoader=re,Object.defineProperty(e,"__esModule",{value:!0})}),function(){"use strict";var e="undefined"!=typeof require,o=this.THREE||e&&require("three");if(!o)throw new Error("MeshLine requires three.js");var t=t||o;function r(){this.positions=[],this.previous=[],this.next=[],this.side=[],this.width=[],this.indices_array=[],this.uvs=[],this.counters=[],this.geometry=new o.BufferGeometry,this.widthCallback=null}function a(e,t,r,i,n){var o;if(e=e.subarray||e.slice?e:e.buffer,r=r.subarray||r.slice?r:r.buffer,e=t?e.subarray?e.subarray(t,n&&t+n):e.slice(t,n&&t+n):e,r.set)r.set(e,i);else for(o=0;o<e.length;o++)r[o+i]=e[o];return r}function i(e){function t(e,t){return void 0===e?t:e}o.Material.call(this),e=e||{},this.lineWidth=t(e.lineWidth,1),this.map=t(e.map,null),this.useMap=t(e.useMap,0),this.alphaMap=t(e.alphaMap,null),this.useAlphaMap=t(e.useAlphaMap,0),this.color=t(e.color,new o.Color(16777215)),this.opacity=t(e.opacity,1),this.resolution=t(e.resolution,new o.Vector2(1,1)),this.sizeAttenuation=t(e.sizeAttenuation,1),this.near=t(e.near,1),this.far=t(e.far,1),this.dashArray=t(e.dashArray,[]),this.useDash=this.dashArray!==[]?1:0,this.visibility=t(e.visibility,1),this.alphaTest=t(e.alphaTest,0),this.repeat=t(e.repeat,new o.Vector2(1,1));var r=new o.RawShaderMaterial({uniforms:{lineWidth:{type:"f",value:this.lineWidth},map:{type:"t",value:this.map},useMap:{type:"f",value:this.useMap},alphaMap:{type:"t",value:this.alphaMap},useAlphaMap:{type:"f",value:this.useAlphaMap},color:{type:"c",value:this.color},opacity:{type:"f",value:this.opacity},resolution:{type:"v2",value:this.resolution},sizeAttenuation:{type:"f",value:this.sizeAttenuation},near:{type:"f",value:this.near},far:{type:"f",value:this.far},dashArray:{type:"v2",value:new o.Vector2(this.dashArray[0],this.dashArray[1])},useDash:{type:"f",value:this.useDash},visibility:{type:"f",value:this.visibility},alphaTest:{type:"f",value:this.alphaTest},repeat:{type:"v2",value:this.repeat},uvTransform:{type:"m3",value:this.map?this.map.matrix:new o.Matrix3}},vertexShader:["precision highp float;","","attribute vec3 position;","attribute vec3 previous;","attribute vec3 next;","attribute float side;","attribute float width;","attribute vec2 uv;","attribute float counters;","","uniform mat4 projectionMatrix;","uniform mat4 modelViewMatrix;","uniform vec2 resolution;","uniform float lineWidth;","uniform vec3 color;","uniform float opacity;","uniform float near;","uniform float far;","uniform float sizeAttenuation;","uniform mat3 uvTransform;","#ifdef USE_GPUPICKER","uniform float baseId;","varying vec4 worldId;","#endif","","varying vec2 vUV;","varying vec4 vColor;","varying float vCounters;","","vec2 fix( vec4 i, float aspect ) {","","    vec2 res = i.xy / i.w;","    res.x *= aspect;","\t vCounters = counters;","    return res;","","}","","void main() {","","    float aspect = resolution.x / resolution.y;","\t float pixelWidthRatio = 1. / (resolution.x * projectionMatrix[0][0]);","","    vColor = vec4( color, opacity );","    //vUV = uv;","    vUV = ( uvTransform * vec3( uv, 1 ) ).xy;","","    mat4 m = projectionMatrix * modelViewMatrix;","    vec4 finalPosition = m * vec4( position, 1.0 );","    vec4 prevPos = m * vec4( previous, 1.0 );","    vec4 nextPos = m * vec4( next, 1.0 );","","    vec2 currentP = fix( finalPosition, aspect );","    vec2 prevP = fix( prevPos, aspect );","    vec2 nextP = fix( nextPos, aspect );","","\t float pixelWidth = finalPosition.w * pixelWidthRatio;","    float w = 1.8 * pixelWidth * lineWidth * width;","","    if( sizeAttenuation == 1. ) {","        w = 1.8 * lineWidth * width;","    }","","    vec2 dir;","    if( nextP == currentP ) dir = normalize( currentP - prevP );","    else if( prevP == currentP ) dir = normalize( nextP - currentP );","    else {","        vec2 dir1 = normalize( currentP - prevP );","        vec2 dir2 = normalize( nextP - currentP );","        dir = normalize( dir1 + dir2 );","","        vec2 perp = vec2( -dir1.y, dir1.x );","        vec2 miter = vec2( -dir.y, dir.x );","        //w = clamp( w / dot( miter, perp ), 0., 4. * lineWidth * width );","        w = w / max(dot( miter, perp ), 0.2);","","    }","","    //vec2 normal = ( cross( vec3( dir, 0. ), vec3( 0., 0., 1. ) ) ).xy;","    vec2 normal = vec2( -dir.y, dir.x );","    normal.x /= aspect;","    normal *= .5 * w;","","    vec4 offset = vec4( normal * side, 0.0, 1.0 );","    finalPosition.xy += offset.xy;","","    gl_Position = finalPosition;","#ifdef USE_GPUPICKER","vec3 a = fract(vec3(1.0/255.0, 1.0/(255.0*255.0), 1.0/(255.0*255.0*255.0)) * baseId);","a -= a.xxy * vec3(0.0, 1.0/255.0, 1.0/255.0);","worldId = vec4(a,1);","#endif","","}"].join("\r\n"),fragmentShader:["precision mediump float;","","uniform sampler2D map;","uniform sampler2D alphaMap;","uniform float useMap;","uniform float useAlphaMap;","uniform float useDash;","uniform vec2 dashArray;","uniform float visibility;","uniform float alphaTest;","uniform vec2 repeat;","","varying vec2 vUV;","varying vec4 vColor;","varying float vCounters;","#ifdef USE_GPUPICKER","varying vec4 worldId;","#endif","","void main() {","","    vec4 c = vColor;","    if( useMap == 1. ) c *= texture2D( map, vUV * repeat );","    if( useAlphaMap == 1. ) c.a *= texture2D( alphaMap, vUV * repeat ).a;","\t if( c.a < alphaTest ) discard;","\t if( useDash == 1. ){","\t \t ","\t }","    gl_FragColor = c;","\t gl_FragColor.a *= step(vCounters,visibility);","\t #ifdef USE_GPUPICKER","\t \tgl_FragColor = worldId;","\t #endif","}"].join("\r\n")});return delete e.lineWidth,delete e.map,delete e.useMap,delete e.alphaMap,delete e.useAlphaMap,delete e.color,delete e.opacity,delete e.resolution,delete e.sizeAttenuation,delete e.near,delete e.far,delete e.dashArray,delete e.visibility,delete e.alphaTest,delete e.repeat,r.type="MeshLineMaterial",r.setValues(e),r}r.prototype.setGeometry=function(e,t){if(this.widthCallback=t,this.positions=[],this.counters=[],e instanceof o.Geometry)for(var r=0;r<e.vertices.length;r++){var i=e.vertices[r];t=r/e.vertices.length;this.positions.push(i.x,i.y,i.z),this.positions.push(i.x,i.y,i.z),this.counters.push(t),this.counters.push(t)}if(o.BufferGeometry,e instanceof Float32Array||e instanceof Array)for(r=0;r<e.length;r+=3){t=r/e.length;this.positions.push(e[r],e[r+1],e[r+2]),this.positions.push(e[r],e[r+1],e[r+2]),this.counters.push(t),this.counters.push(t)}this.process()},r.prototype.compareV3=function(e,t){var r=6*e,i=6*t;return this.positions[r]===this.positions[i]&&this.positions[r+1]===this.positions[i+1]&&this.positions[r+2]===this.positions[i+2]},r.prototype.copyV3=function(e){var t=6*e;return[this.positions[t],this.positions[t+1],this.positions[t+2]]},r.prototype.process=function(){var e,t,r=this.positions.length/6;this.previous=[],this.next=[],this.side=[],this.width=[],this.indices_array=[],this.uvs=[];for(var i=0;i<r;i++)this.side.push(1),this.side.push(-1);for(i=0;i<r;i++)e=this.widthCallback?this.widthCallback(i/(r-1)):1,this.width.push(e),this.width.push(e);for(i=0;i<r;i++)this.uvs.push(i/(r-1),0),this.uvs.push(i/(r-1),1);t=this.compareV3(0,r-1)?this.copyV3(r-2):this.copyV3(0),this.previous.push(t[0],t[1],t[2]),this.previous.push(t[0],t[1],t[2]);for(i=0;i<r-1;i++)t=this.copyV3(i),this.previous.push(t[0],t[1],t[2]),this.previous.push(t[0],t[1],t[2]);for(i=1;i<r;i++)t=this.copyV3(i),this.next.push(t[0],t[1],t[2]),this.next.push(t[0],t[1],t[2]);t=this.compareV3(r-1,0)?this.copyV3(1):this.copyV3(r-1),this.next.push(t[0],t[1],t[2]),this.next.push(t[0],t[1],t[2]);for(i=0;i<r-1;i++){var n=2*i;this.indices_array.push(n,n+1,n+2),this.indices_array.push(n+2,n+1,n+3)}this.attributes?(this.attributes.position.copyArray(new Float32Array(this.positions)),this.attributes.position.needsUpdate=!0,this.attributes.previous.copyArray(new Float32Array(this.previous)),this.attributes.previous.needsUpdate=!0,this.attributes.next.copyArray(new Float32Array(this.next)),this.attributes.next.needsUpdate=!0,this.attributes.side.copyArray(new Float32Array(this.side)),this.attributes.side.needsUpdate=!0,this.attributes.width.copyArray(new Float32Array(this.width)),this.attributes.width.needsUpdate=!0,this.attributes.uv.copyArray(new Float32Array(this.uvs)),this.attributes.uv.needsUpdate=!0,this.attributes.index.copyArray(new Uint16Array(this.indices_array)),this.attributes.index.needsUpdate=!0):this.attributes={position:new o.BufferAttribute(new Float32Array(this.positions),3),previous:new o.BufferAttribute(new Float32Array(this.previous),3),next:new o.BufferAttribute(new Float32Array(this.next),3),side:new o.BufferAttribute(new Float32Array(this.side),1),width:new o.BufferAttribute(new Float32Array(this.width),1),uv:new o.BufferAttribute(new Float32Array(this.uvs),2),index:new o.BufferAttribute(new Uint16Array(this.indices_array),1),counters:new o.BufferAttribute(new Float32Array(this.counters),1)},this.geometry.addAttribute("position",this.attributes.position),this.geometry.addAttribute("previous",this.attributes.previous),this.geometry.addAttribute("next",this.attributes.next),this.geometry.addAttribute("side",this.attributes.side),this.geometry.addAttribute("width",this.attributes.width),this.geometry.addAttribute("uv",this.attributes.uv),this.geometry.addAttribute("counters",this.attributes.counters),this.geometry.setIndex(this.attributes.index)},r.prototype.advance=function(e){var t=this.attributes.position.array,r=this.attributes.previous.array,i=this.attributes.next.array,n=t.length;a(t,0,r,0,n),a(t,6,t,0,n-6),t[n-6]=e.x,t[n-5]=e.y,t[n-4]=e.z,t[n-3]=e.x,t[n-2]=e.y,t[n-1]=e.z,a(t,6,i,0,n-6),i[n-6]=e.x,i[n-5]=e.y,i[n-4]=e.z,i[n-3]=e.x,i[n-2]=e.y,i[n-1]=e.z,this.attributes.position.needsUpdate=!0,this.attributes.previous.needsUpdate=!0,this.attributes.next.needsUpdate=!0},((i.prototype=Object.create(o.Material.prototype)).constructor=i).prototype.copy=function(e){return o.Material.prototype.copy.call(this,e),this.lineWidth=e.lineWidth,this.map=e.map,this.useMap=e.useMap,this.alphaMap=e.alphaMap,this.useAlphaMap=e.useAlphaMap,this.color.copy(e.color),this.opacity=e.opacity,this.resolution.copy(e.resolution),this.sizeAttenuation=e.sizeAttenuation,this.near=e.near,this.far=e.far,this.dashArray.copy(e.dashArray),this.useDash=e.useDash,this.visibility=e.visibility,this.alphaTest=e.alphaTest,this.repeat.copy(e.repeat),this},void 0!==t?("undefined"!=typeof module&&module.exports&&(t=module.exports={MeshLine:r,MeshLineMaterial:i}),t.MeshLine=r,t.MeshLineMaterial=i):(this.MeshLine=r,this.MeshLineMaterial=i)}.call(this),function(){var v,a=function(e,t){return function(){return e.apply(t,arguments)}},m=[].slice,c={}.hasOwnProperty;v=function(e,t){return t(),e},window.ThreeBSP=function(){function f(e,t){this.matrix=t,this.intersect=a(this.intersect,this),this.union=a(this.union,this),this.subtract=a(this.subtract,this),this.toGeometry=a(this.toGeometry,this),this.toMesh=a(this.toMesh,this),this.toTree=a(this.toTree,this),null==this.matrix&&(this.matrix=new THREE.Matrix4),this.tree=this.toTree(e)}return f.prototype.toTree=function(e){var h,t,p,r,i,n,o,d=this;if(e instanceof f.Node)return e;for(p=[],r=function(e,t){var r,i,n,o,a,s,l,c,u;for(null==(r=null!=(c=h.faceVertexUvs)?c[0][t]:void 0)&&(r=[new THREE.Vector2,new THREE.Vector2,new THREE.Vector2,new THREE.Vector2]),n=new f.Polygon,o=s=0,l=(u=["a","b","c","d"]).length;s<l;o=++s)null!=(i=e[u[o]])&&(a=h.vertices[i],(a=new f.Vertex(a.x,a.y,a.z,e.vertexNormals[0],new THREE.Vector2(r[o].x,r[o].y))).applyMatrix4(d.matrix),n.vertices.push(a));return p.push(n.calculateProperties())},t=i=0,n=(o=(h=e instanceof THREE.Geometry?e:e instanceof THREE.Mesh?(e.updateMatrix(),this.matrix=e.matrix.clone(),e.geometry):void 0).faces).length;i<n;t=++i)r(o[t],t);return new f.Node(p)},f.prototype.toMesh=function(e){var t,r,i=this;return null==e&&(e=new THREE.MeshNormalMaterial),t=this.toGeometry(),v(r=new THREE.Mesh(t,e),function(){return r.position.getPositionFromMatrix(i.matrix),r.rotation.setFromRotationMatrix(i.matrix)})},f.prototype.toGeometry=function(){var h,p,d=this;return p=(new THREE.Matrix4).getInverse(this.matrix),v(h=new THREE.Geometry,function(){var i,n,o,a,s,l,c,e,t,r,u;for(u=[],e=0,t=(r=d.tree.allPolygons()).length;e<t;e++)a=r[e],o=function(){var e,t,r,i;for(i=[],e=0,t=(r=a.vertices).length;e<t;e++)s=r[e],i.push(s.clone().applyMatrix4(p));return i}(),u.push(function(){var e,t,r;for(r=[],n=e=2,t=o.length;2<=t?e<t:t<e;n=2<=t?++e:--e)c=[o[0],o[n-1],o[n]],l=function(){var e,t,r,i,n;for(n=[],e=0,t=c.length;e<t;e++)s=c[e],n.push(new THREE.Vector2(null!=(r=s.uv)?r.x:void 0,null!=(i=s.uv)?i.y:void 0));return n}(),i=function(e,t,r){r.prototype=e.prototype;var i=new r,n=e.apply(i,t);return Object(n)===n?n:i}(THREE.Face3,m.call(function(){var e,t,r;for(r=[],e=0,t=c.length;e<t;e++)s=c[e],r.push(h.vertices.push(s)-1);return r}()).concat([a.normal.clone()]),function(){}),h.faces.push(i),r.push(h.faceVertexUvs[0].push(l));return r}());return u})},f.prototype.subtract=function(e){var t,r,i;return t=(i=[this.tree.clone(),e.tree.clone()])[1],(r=i[0]).invert().clipTo(t),t.clipTo(r).invert().clipTo(r).invert(),new f(r.build(t.allPolygons()).invert(),this.matrix)},f.prototype.union=function(e){var t,r,i;return t=(i=[this.tree.clone(),e.tree.clone()])[1],(r=i[0]).clipTo(t),t.clipTo(r).invert().clipTo(r).invert(),new f(r.build(t.allPolygons()),this.matrix)},f.prototype.intersect=function(e){var t,r,i;return r=(i=[this.tree.clone(),e.tree.clone()])[0],(t=i[1]).clipTo(r.invert()).invert().clipTo(r.clipTo(t)),new f(r.build(t.allPolygons()).invert(),this.matrix)},f}(),ThreeBSP.Vertex=function(e){function o(e,t,r,i,n){this.normal=null!=i?i:new THREE.Vector3,this.uv=null!=n?n:new THREE.Vector2,this.interpolate=a(this.interpolate,this),this.lerp=a(this.lerp,this),o.__super__.constructor.call(this,e,t,r)}return function(e,t){for(var r in t)c.call(t,r)&&(e[r]=t[r]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(o,THREE.Vector3),o.prototype.clone=function(){return new ThreeBSP.Vertex(this.x,this.y,this.z,this.normal.clone(),this.uv.clone())},o.prototype.lerp=function(e,t){var r=this;return v(o.__super__.lerp.apply(this,arguments),function(){return r.uv.add(e.uv.clone().sub(r.uv).multiplyScalar(t)),r.normal.lerp(e,t)})},o.prototype.interpolate=function(){var e,t;return e=1<=arguments.length?m.call(arguments,0):[],(t=this.clone()).lerp.apply(t,e)},o}(),ThreeBSP.Polygon=function(){function e(e,t,r){this.vertices=null!=e?e:[],this.normal=t,this.w=r,this.subdivide=a(this.subdivide,this),this.tessellate=a(this.tessellate,this),this.classifySide=a(this.classifySide,this),this.classifyVertex=a(this.classifyVertex,this),this.invert=a(this.invert,this),this.clone=a(this.clone,this),this.calculateProperties=a(this.calculateProperties,this),this.vertices.length&&this.calculateProperties()}return e.prototype.calculateProperties=function(){var n=this;return v(this,function(){var e,t,r,i;return e=(i=n.vertices)[0],t=i[1],r=i[2],n.normal=t.clone().sub(e).cross(r.clone().sub(e)).normalize(),n.w=n.normal.clone().dot(e)})},e.prototype.clone=function(){var n;return new ThreeBSP.Polygon(function(){var e,t,r,i;for(i=[],e=0,t=(r=this.vertices).length;e<t;e++)n=r[e],i.push(n.clone());return i}.call(this),this.normal.clone(),this.w)},e.prototype.invert=function(){var e=this;return v(this,function(){return e.normal.multiplyScalar(-1),e.w*=-1,e.vertices.reverse()})},e.prototype.classifyVertex=function(e){var t;switch(t=this.normal.dot(e)-this.w,!1){case!(t<-1e-5):return 2;case!(1e-5<t):return 1;default:return 0}},e.prototype.classifySide=function(e){var t,r,i,n,o,a,s,l=this;for(r=(a=[0,0])[0],t=a[1],i=function(e){switch(l.classifyVertex(e)){case 1:return r+=1;case 2:return t+=1}},n=0,o=(s=e.vertices).length;n<o;n++)i(s[n]);return 0<r&&0===t?1:0===r&&0<t?2:r===t&&0===t?0:3},e.prototype.tessellate=function(e){var t,r,i,n,o,a,s,l,c,u,h,p,d,f,m,g;if(f={f:[],b:[],count:e.vertices.length},i=f.f,t=f.b,r=f.count,3!==this.classifySide(e))return[e];for(n=p=0,d=(m=e.vertices).length;p<d;n=++p)u=m[n],h=e.vertices[(n+1)%r],s=(g=function(){var e,t,r,i;for(i=[],e=0,t=(r=[u,h]).length;e<t;e++)c=r[e],i.push(this.classifyVertex(c));return i}.call(this))[0],l=g[1],2!==s&&i.push(u),1!==s&&t.push(u),3==(s|l)&&(a=(this.w-this.normal.dot(u))/this.normal.dot(h.clone().sub(u)),c=u.interpolate(h,a),i.push(c),t.push(c));return v(o=[],function(){if(3<=i.length&&o.push(new ThreeBSP.Polygon(i)),3<=t.length)return o.push(new ThreeBSP.Polygon(t))})},e.prototype.subdivide=function(e,t,r,i,n){var o,a,s,l,c,u;for(u=[],s=0,l=(c=this.tessellate(e)).length;s<l;s++)switch(o=c[s],a=this.classifySide(o)){case 1:u.push(i.push(o));break;case 2:u.push(n.push(o));break;case 0:0<this.normal.dot(o.normal)?u.push(t.push(o)):u.push(r.push(o));break;default:throw new Error("BUG: Polygon of classification "+a+" in subdivision")}return u},e}(),ThreeBSP.Node=function(){function e(e){this.clipTo=a(this.clipTo,this),this.clipPolygons=a(this.clipPolygons,this),this.invert=a(this.invert,this),this.allPolygons=a(this.allPolygons,this),this.isConvex=a(this.isConvex,this),this.build=a(this.build,this),this.clone=a(this.clone,this),this.polygons=[],null!=e&&e.length&&this.build(e)}return e.prototype.clone=function(){var i,o=this;return v(i=new ThreeBSP.Node,function(){var n,e,t,r;return i.divider=null!=(e=o.divider)?e.clone():void 0,i.polygons=function(){var e,t,r,i;for(i=[],e=0,t=(r=this.polygons).length;e<t;e++)n=r[e],i.push(n.clone());return i}.call(o),i.front=null!=(t=o.front)?t.clone():void 0,i.back=null!=(r=o.back)?r.clone():void 0})},e.prototype.build=function(s){var l=this;return v(this,function(){var e,t,r,i,n,o,a;for(i={front:[],back:[]},null==l.divider&&(l.divider=s[0].clone()),n=0,o=s.length;n<o;n++)e=s[n],l.divider.subdivide(e,l.polygons,l.polygons,i.front,i.back);for(r in a=[],i)c.call(i,r)&&((t=i[r]).length?(null==l[r]&&(l[r]=new ThreeBSP.Node),a.push(l[r].build(t))):a.push(void 0));return a})},e.prototype.isConvex=function(e){var t,r,i,n,o,a;for(i=0,o=e.length;i<o;i++)for(t=e[i],n=0,a=e.length;n<a;n++)if(t!==(r=e[n])&&2!==r.classifySide(t))return!1;return!0},e.prototype.allPolygons=function(){var e,t;return this.polygons.slice().concat((null!=(t=this.front)?t.allPolygons():void 0)||[]).concat((null!=(e=this.back)?e.allPolygons():void 0)||[])},e.prototype.invert=function(){var l=this;return v(this,function(){var e,t,r,i,n,o,a,s;for(t=0,i=(o=l.polygons).length;t<i;t++)o[t].invert();for(r=0,n=(a=[l.divider,l.front,l.back]).length;r<n;r++)null!=(e=a[r])&&e.invert();return s=[l.back,l.front],l.front=s[0],l.back=s[1],s})},e.prototype.clipPolygons=function(e){var t,r,i,n,o;if(!this.divider)return e.slice();for(r=[],t=[],n=0,o=e.length;n<o;n++)i=e[n],this.divider.subdivide(i,r,t,r,t);return this.front&&(r=this.front.clipPolygons(r)),this.back&&(t=this.back.clipPolygons(t)),r.concat(this.back?t:[])},e.prototype.clipTo=function(r){var i=this;return v(this,function(){var e,t;return i.polygons=r.clipPolygons(i.polygons),null!=(e=i.front)&&e.clipTo(r),null!=(t=i.back)?t.clipTo(r):void 0})},e}()}.call(this),TrailRenderHelper=function(){var i="[TrailRenderHelper.js] : ";this.fTimeLong=0,this.fTimeStart=0,this.iStep=0,this.iCount=0,this.fWidthStart=.5,this.fWidthEnd=.5,this.fWidthOffset=0,this.arrayPosHistory=new Array,this.shaderColor=null,this.shaderTexture=null,this.shaderTexMode=null,this.blending=null,this.transparent=null,this.alphaTest=null,this.depthWrite=null,this.depthTest=null,this.arrayUuid=new Array,this.arrayCfg=new Array,this.bAllStable=!1,this.bStable=!1,this.iMaxArrayPosHistoryNo=0,this.iMaxArrayPosHistoryNo_last=0,this.iCurrentIndex=0,this.iSumArrayPosHistoryCount=0,this.instanceBuffer=null,this.bufferGeometry=null,this.attributesVertices=null,this.material=null,this.mesh=null,this.vertices=null,this.indices=null,this.uvs=null,this.onTriggerMeshInited=null;var g=this,r={vertex:["precision highp float;","uniform sampler2D texture;","uniform vec4 color;","varying vec2 vUv;","varying vec4 varyColor;","void main()","{","\tvaryColor = color;","   vUv = vec2( uv.x, uv.y );","\tvec3 positionEye = ( modelViewMatrix * vec4( position, 1.0 ) ).xyz;","\tgl_Position = projectionMatrix * vec4( positionEye, 1.0 );","}"].join("\n"),fragment:["precision highp float;","uniform sampler2D texture;","varying vec2 vUv;","varying vec4 varyColor;","void main() {","    gl_FragColor = varyColor * texture2D(texture, vUv);","}"].join("\n")};this.init=function(e,t){if(null!=t&&null!=t){if(null==e||null==e||"object"!=typeof e)return console.error(i+"[init] : options == null;"),void t();if(null==e.fTimeLong||null==e.fTimeLong||"number"!=typeof e.fTimeLong)return console.error(i+"[init] : options.fTimeLong == null;"),void t();if(null==e.fTimeStart||null==e.fTimeStart||"number"!=typeof e.fTimeStart)return console.error(i+"[init] : options.fTimeStart == null;"),void t();if(null==e.iStep||null==e.iStep||"number"!=typeof e.iStep)return console.error(i+"[init] : options.iStep == null;"),void t();if(null==e.fWidthStart||null==e.fWidthStart||"number"!=typeof e.fWidthStart)return console.error(i+"[init] : options.fWidthStart == null;"),void t();if(null==e.fWidthEnd||null==e.fWidthEnd||"number"!=typeof e.fWidthEnd)return console.error(i+"[init] : options.fWidthStart == null;"),void t();null!=e.shaderColor&&null!=e.shaderColor&&e.shaderColor instanceof THREE.Vector4?g.shaderColor=new THREE.Vector4(e.shaderColor.x,e.shaderColor.y,e.shaderColor.z,e.shaderColor.w):(console.warn(i+"[init] : options.shaderColor == null; set shader color as default;"),g.shaderColor=new THREE.Vector4(.5,.5,1,1)),null!=e.shaderTexture&&null!=e.shaderTexture&&e.shaderTexture instanceof THREE.Texture?g.shaderTexture=e.shaderTexture:(console.warn(i+"[init] : options.shaderColor == null; set shader texture as default;"),g.shaderTexture=null),null==e.shaderTexMode||null==e.shaderTexMode||"string"!=typeof e.shaderTexMode?(console.warn(i+"[init] : options.shaderTexMode == null; set shader mode as default;"),g.shaderTexMode="Stretch"):g.shaderTexMode="Stretch"==e.shaderTexMode?"Stretch":"Tile",null==e.shaderBlending||null==e.shaderBlending||"number"!=typeof e.shaderBlending?(console.warn(i+"[init] : options.shaderBlending == null; set shader blending as default;"),g.blending=THREE.AdditiveBlending):g.blending=e.shaderBlending,null==e.shaderTransparent||null==e.shaderTransparent||"boolean"!=typeof e.shaderTransparent?(console.warn(i+"[init] : options.shaderTransparent == null; set shader transparent as default;"),g.transparent=!1):g.transparent=e.shaderTransparent,null==e.shaderAlphaTest||null==e.shaderAlphaTest||"number"!=typeof e.shaderAlphaTest?(console.warn(i+"[init] : options.shaderAlphaTest == null; set shader alphaTest as default;"),g.alphaTest=0):g.alphaTest=e.shaderAlphaTest,null==e.shaderDepthWrite||null==e.shaderDepthWrite||"boolean"!=typeof e.shaderDepthWrite?(console.warn(i+"[init] : options.shaderDepthWrite == null; set shader depthWrite as default;"),g.depthWrite=!0):g.depthWrite=e.shaderDepthWrite,null==e.shaderDepthTest||null==e.shaderDepthTest||"boolean"!=typeof e.shaderDepthTest?(console.warn(i+"[init] : options.shaderDepthTest == null; set shader depthTest as default;"),g.depthTest=!0):g.depthTest=e.shaderDepthTest,g.uniforms={texture:{type:"t",value:g.shaderTexture},color:{type:"v4",value:new THREE.Vector4(0,0,0,0)}},g.material=new THREE.ShaderMaterial({uniforms:g.uniforms,vertexShader:r.vertex,fragmentShader:r.fragment,blending:g.blending,transparent:g.transparent,alphaTest:g.alphaTest,depthWrite:g.depthWrite,depthTest:g.depthTest}),g.fTimeLong=e.fTimeLong,g.fTimeStart=e.fTimeStart,g.iStep=e.iStep,g.iCount=0,g.fWidthStart=e.fWidthStart,g.fWidthEnd=e.fWidthEnd,g.fWidthOffset=-g.fWidthStart+g.fWidthEnd,t()}else console.error(i+"[init] : onFinished == null;")},this.attach=function(e){if(null==e||null==e)return console.error(i+"[attach] : onFinished == null;"),null;var t=THREE.Math.generateUUID();g.arrayPosHistory[t]=new Array;return g.arrayCfg[t]={bActived:!0,bStable:!1,iMaxArrayPosHistoryNo_last:0,iMaxArrayPosHistoryNo:0,iStartIndex:0},g.arrayUuid.push(t),e(t),t},this.detach=function(e){null!=e&&null!=e&&"string"==typeof e?(g.arrayUuid.includes(e)&&delete g.arrayUuid[e],g.arrayCfg.includes(e)&&(g.iCurrentIndex-=g.arrayCfg[e].iMaxArrayPosHistoryNo,delete g.arrayCfg[e]),g.arrayPosHistory.includes(e)&&delete g.arrayPosHistory[e]):console.error(i+"[detach] : uuid == null;")},this.dispose=function(){g.instanceBuffer&&g.instanceBuffer.dispose(),g.bufferGeometry&&g.bufferGeometry.dispose(),GlobalsVariables.scene.remove(g.mesh),g.material.dispose(),g.arrayUuid.forEach(function(e){}),g.arrayCfg.forEach(function(e){}),g.arrayPosHistory.forEach(function(e){}),g.arrayUuid=[],g.arrayCfg=[],g.arrayPosHistory=[]},this.setActive=function(e,t,r){if(null!=r&&null!=r){if(null==e||null==e||"string"!=typeof e)return console.error(i+"[setActive] : uuid == null;"),void r(!1);if(!g.arrayUuid.includes(e))return console.error(i+"[setActive] : uuid do not includes;"),void r(!1);if(null==t||null==t||"boolean"!=typeof t)return console.error(i+"[setActive] : bActived == null;"),void r(!1);g.arrayCfg[e].bActived=t,r(!0)}else console.error(i+"[setActive] : onFinished == null;")},this.tick=function(e){if(g.bAllStable)for(var t=g.arrayUuid.length,r=0;r<t;r++)g.arrayCfg[g.arrayUuid[r]].bActived&&g.updateMesh(g.arrayUuid[r]);if(g.arrayCfg[e.uuid].bActived&&(g.arrayPosHistory[e.uuid].push({time:e.timeNow,pos:new THREE.Vector3(e.position.x,e.position.y,e.position.z),rot:new THREE.Vector3(e.rotation.x,e.rotation.y,e.rotation.z)}),g.checkPosHistory(e.uuid,e.timeNow)),!g.bAllStable&&!g.arrayCfg[e.uuid].bStable){t=g.arrayPosHistory[e.uuid].length;g.arrayCfg[e.uuid].iMaxArrayPosHistoryNo<=t&&(g.arrayCfg[e.uuid].iMaxArrayPosHistoryNo_last=g.arrayCfg[e.uuid].iMaxArrayPosHistoryNo,g.arrayCfg[e.uuid].iMaxArrayPosHistoryNo=t,g.arrayCfg[e.uuid].bStable||g.arrayCfg[e.uuid].iMaxArrayPosHistoryNo_last!=g.arrayCfg[e.uuid].iMaxArrayPosHistoryNo||(g.arrayCfg[e.uuid].bStable=!0,g.checkAllPosHistory()))}},this.checkPosHistory=function(e,t){for(var r=g.arrayPosHistory[e].length,i=0;i<r&&t-g.arrayPosHistory[e][i].time>g.fTimeLong;i++)g.arrayPosHistory[e].splice(i,1),r=g.arrayPosHistory[e].length,i--},this.checkAllPosHistory=function(){for(var e=g.arrayUuid.length,t=!0,r=g.iSumArrayPosHistoryCount=0;r<e;r++){if(!g.arrayCfg[g.arrayUuid[r]].bStable)return void(t=!1);g.iSumArrayPosHistoryCount+=g.arrayCfg[g.arrayUuid[r]].iMaxArrayPosHistoryNo}if(t){g.bAllStable=!0;for(r=0;r<e;r++)0==r?1==e?g.initMesh(g.arrayUuid[r],"start|end"):g.initMesh(g.arrayUuid[r],"start"):r+1==e?g.initMesh(g.arrayUuid[r],"end"):g.initMesh(g.arrayUuid[r],"default")}},this.initMesh=function(e,t){if(null!=g.mesh&&GlobalsVariables.scene.remove(g.mesh),null==g.bufferGeometry&&(g.bufferGeometry=new THREE.BufferGeometry),g.arrayCfg[e].iStartIndex=g.iCurrentIndex,0<=t.indexOf("start")){var r=2*g.iSumArrayPosHistoryCount;g.iSumArrayPosHistoryCount;g.vertices=new Float32Array(3*r),g.indices=new Uint32Array(2*(g.iSumArrayPosHistoryCount-g.arrayCfg.length)*2*3),g.uvs=new Float32Array(2*r)}for(var i=new THREE.Quaternion,n=g.arrayCfg[e].iStartIndex,o=g.arrayCfg[e].iStartIndex+g.arrayCfg[e].iMaxArrayPosHistoryNo;n<o;n++){var a=g.fWidthEnd+(n-g.arrayCfg[e].iStartIndex)/g.arrayCfg[e].iMaxArrayPosHistoryNo*g.fWidthOffset,s=g.arrayPosHistory[e][n-g.arrayCfg[e].iStartIndex].pos.clone(),l=s.clone(),c=g.arrayPosHistory[e][n-g.arrayCfg[e].iStartIndex].rot.clone();c=c.normalize(),i.setFromEuler(new THREE.Euler(c.x,c.y,c.z));var u=new THREE.Vector3(a,0,0);u.applyQuaternion(i);var h=o-1-n,p=s.add(u);g.vertices[6*(g.arrayCfg[e].iStartIndex+h)+0]=p.x,g.vertices[6*(g.arrayCfg[e].iStartIndex+h)+1]=p.y,g.vertices[6*(g.arrayCfg[e].iStartIndex+h)+2]=p.z;var d=l.sub(u);g.vertices[6*(g.arrayCfg[e].iStartIndex+h)+3]=d.x,g.vertices[6*(g.arrayCfg[e].iStartIndex+h)+4]=d.y,g.vertices[6*(g.arrayCfg[e].iStartIndex+h)+5]=d.z}var f=g.arrayCfg[e].iStartIndex+g.arrayCfg[e].iMaxArrayPosHistoryNo-1;for(n=g.arrayCfg[e].iStartIndex;n<f;n++)g.indices[12*n+0]=2*n+0,g.indices[12*n+1]=2*n+1,g.indices[12*n+2]=2*n+2,g.indices[12*n+3]=2*n+2,g.indices[12*n+4]=2*n+1,g.indices[12*n+5]=2*n+3,g.indices[12*n+6]=2*n+0,g.indices[12*n+7]=2*n+2,g.indices[12*n+8]=2*n+1,g.indices[12*n+9]=2*n+2,g.indices[12*n+10]=2*n+3,g.indices[12*n+11]=2*n+1;var m=1/g.arrayCfg[e].iMaxArrayPosHistoryNo;if("Stretch"==g.shaderTexMode)for(n=g.arrayCfg[e].iStartIndex,o=g.arrayCfg[e].iStartIndex+g.arrayCfg[e].iMaxArrayPosHistoryNo;n<o;n++)g.uvs[4*n+0]=(n-g.arrayCfg[e].iStartIndex)*m,g.uvs[4*n+1]=0,g.uvs[4*n+2]=(n-g.arrayCfg[e].iStartIndex)*m,g.uvs[4*n+3]=1;else for(n=g.arrayCfg[e].iStartIndex,o=g.arrayCfg[e].iStartIndex+g.arrayCfg[e].iMaxArrayPosHistoryNo;n<o;n++)g.uvs[4*n+0]=(n-g.arrayCfg[e].iStartIndex)%2,g.uvs[4*n+1]=0,g.uvs[4*n+2]=(n-g.arrayCfg[e].iStartIndex)%2,g.uvs[4*n+3]=1;g.iCurrentIndex+=g.arrayCfg[e].iMaxArrayPosHistoryNo,0<=t.indexOf("end")&&(g.bufferGeometry.addAttribute("position",new THREE.BufferAttribute(g.vertices,3)),g.attributesVertices=this.bufferGeometry.attributes.position.array,g.bufferGeometry.addAttribute("uv",new THREE.BufferAttribute(g.uvs,2)),g.bufferGeometry.setIndex(new THREE.BufferAttribute(g.indices,1)),g.mesh=new THREE.Mesh(g.bufferGeometry,g.material),GlobalsVariables.scene.add(g.mesh),null!=g.onTriggerMeshInited&&null!=g.onTriggerMeshInited&&g.onTriggerMeshInited(g.mesh))},this.updateColor=function(e){null!=g.material&&null!=g.material&&(g.material.uniforms.color.value.x=e.r,g.material.uniforms.color.value.y=e.g,g.material.uniforms.color.value.z=e.b,g.material.uniforms.color.value.w=e.a,g.material.needsUpdate=!0)},this.updateMesh=function(e){for(var t=g.arrayPosHistory[e].length,r=new THREE.Quaternion,i=g.arrayCfg[e].iStartIndex,n=g.arrayCfg[e].iStartIndex+t;i<n;i++){var o=g.fWidthEnd+(i-g.arrayCfg[e].iStartIndex)/t*g.fWidthOffset,a=(u=g.arrayPosHistory[e][i-g.arrayCfg[e].iStartIndex].pos.clone()).clone();h=(h=g.arrayPosHistory[e][i-g.arrayCfg[e].iStartIndex].rot.clone()).normalize(),r.setFromEuler(new THREE.Euler(h.x,h.y,h.z)),(p=new THREE.Vector3(o,0,0)).applyQuaternion(r);var s=n-1-i;s=6*(g.arrayCfg[e].iStartIndex+s);var l=u.add(p);g.attributesVertices[s+0]=l.x,g.attributesVertices[s+1]=l.y,g.attributesVertices[s+2]=l.z;var c=a.sub(p);g.attributesVertices[s+3]=c.x,g.attributesVertices[s+4]=c.y,g.attributesVertices[s+5]=c.z}if(t<g.arrayCfg[e].iMaxArrayPosHistoryNo)for(i=g.arrayCfg[e].iStartIndex+t,n=g.arrayCfg[e].iStartIndex+g.arrayCfg[e].iMaxArrayPosHistoryNo;i<n;i++){var u,h,p;a=(u=g.arrayPosHistory[e][t-1].pos.clone()).clone();h=(h=g.arrayPosHistory[e][t-1].rot.clone()).normalize(),r.setFromEuler(new THREE.Euler(h.x,h.y,h.z)),(p=new THREE.Vector3(0,0,0)).applyQuaternion(r);s=6*(g.arrayCfg[e].iStartIndex+i),l=u.add(p);g.attributesVertices[s+0]=l.x,g.attributesVertices[s+1]=l.y,g.attributesVertices[s+2]=l.z;c=a.sub(p);g.attributesVertices[s+3]=c.x,g.attributesVertices[s+4]=c.y,g.attributesVertices[s+5]=c.z}g.bufferGeometry.attributes.position.needsUpdate=!0}},function(){"use strict";function t(e,t){t=t||1/0;for(var r,i=e.length,n=null,o=[],a=0;a<i;a++){if(55295<(r=e.charCodeAt(a))&&r<57344){if(!n){if(56319<r){-1<(t-=3)&&o.push(239,191,189);continue}if(a+1===i){-1<(t-=3)&&o.push(239,191,189);continue}n=r;continue}if(r<56320){-1<(t-=3)&&o.push(239,191,189),n=r;continue}r=n-55296<<10|r-56320|65536,n=null}else n&&(-1<(t-=3)&&o.push(239,191,189),n=null);if(r<128){if((t-=1)<0)break;o.push(r)}else if(r<2048){if((t-=2)<0)break;o.push(192|r>>6,128|63&r)}else if(r<65536){if((t-=3)<0)break;o.push(224|r>>12,128|63&r>>6,128|63&r)}else{if(!(r<2097152))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(240|r>>18,128|63&r>>12,128|63&r>>6,128|63&r)}}return o}function a(e){try{return decodeURIComponent(e)}catch(e){return String.fromCharCode(65533)}}TextEncoderLite.prototype.encode=function(e){return"undefined"==typeof Uint8Array?t(e):new Uint8Array(t(e))},TextDecoderLite.prototype.decode=function(e){return function(e,t,r){var i="",n="";r=Math.min(e.length,r||1/0);for(var o=t=t||0;o<r;o++)e[o]<=127?(i+=a(n)+String.fromCharCode(e[o]),n=""):n+="%"+e[o].toString(16);return i+a(n)}(e,0,e.length)}}();var _Group=function(){this._tweens={},this._tweensAddedDuringUpdate={}};_Group.prototype={getAll:function(){return Object.keys(this._tweens).map(function(e){return this._tweens[e]}.bind(this))},removeAll:function(){this._tweens={}},add:function(e){this._tweens[e.getId()]=e,this._tweensAddedDuringUpdate[e.getId()]=e},remove:function(e){delete this._tweens[e.getId()],delete this._tweensAddedDuringUpdate[e.getId()]},update:function(e,t){var r=Object.keys(this._tweens);if(0===r.length)return!1;for(e=void 0!==e?e:TWEEN.now();0<r.length;){this._tweensAddedDuringUpdate={};for(var i=0;i<r.length;i++){var n=this._tweens[r[i]];n&&!1===n.update(e)&&(n._isPlaying=!1,t||delete this._tweens[r[i]])}r=Object.keys(this._tweensAddedDuringUpdate)}return!0}};var TWEEN=new _Group;TWEEN.Group=_Group,TWEEN._nextId=0,TWEEN.nextId=function(){return TWEEN._nextId++},"undefined"==typeof window&&"undefined"!=typeof process?TWEEN.now=function(){var e=process.hrtime();return 1e3*e[0]+e[1]/1e6}:"undefined"!=typeof window&&void 0!==window.performance&&void 0!==window.performance.now?TWEEN.now=window.performance.now.bind(window.performance):void 0!==Date.now?TWEEN.now=Date.now:TWEEN.now=function(){return(new Date).getTime()},TWEEN.Tween=function(e,t){this._object=e,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._repeat=0,this._repeatDelayTime=void 0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=null,this._easingFunction=TWEEN.Easing.Linear.None,this._interpolationFunction=TWEEN.Interpolation.Linear,this._chainedTweens=[],this._onStartCallback=null,this._onStartCallbackFired=!1,this._onUpdateCallback=null,this._onCompleteCallback=null,this._onStopCallback=null,this._group=t||TWEEN,this._id=TWEEN.nextId()},TWEEN.Tween.prototype={getId:function(){return this._id},isPlaying:function(){return this._isPlaying},to:function(e,t){return this._valuesEnd=e,void 0!==t&&(this._duration=t),this},start:function(e){for(var t in this._group.add(this),this._isPlaying=!0,this._onStartCallbackFired=!1,this._startTime=void 0!==e?"string"==typeof e?TWEEN.now()+parseFloat(e):e:TWEEN.now(),this._startTime+=this._delayTime,this._valuesEnd){if(this._valuesEnd[t]instanceof Array){if(0===this._valuesEnd[t].length)continue;this._valuesEnd[t]=[this._object[t]].concat(this._valuesEnd[t])}void 0!==this._object[t]&&(this._valuesStart[t]=this._object[t],this._valuesStart[t]instanceof Array==0&&(this._valuesStart[t]*=1),this._valuesStartRepeat[t]=this._valuesStart[t]||0)}return this},stop:function(){return this._isPlaying&&(this._group.remove(this),this._isPlaying=!1,null!==this._onStopCallback&&this._onStopCallback(this._object),this.stopChainedTweens()),this},end:function(){return this.update(this._startTime+this._duration),this},stopChainedTweens:function(){for(var e=0,t=this._chainedTweens.length;e<t;e++)this._chainedTweens[e].stop()},group:function(e){return this._group=e,this},delay:function(e){return this._delayTime=e,this},repeat:function(e){return this._repeat=e,this},repeatDelay:function(e){return this._repeatDelayTime=e,this},yoyo:function(e){return this._yoyo=e,this},easing:function(e){return this._easingFunction=e,this},interpolation:function(e){return this._interpolationFunction=e,this},chain:function(){return this._chainedTweens=arguments,this},onStart:function(e){return this._onStartCallback=e,this},onUpdate:function(e){return this._onUpdateCallback=e,this},onComplete:function(e){return this._onCompleteCallback=e,this},onStop:function(e){return this._onStopCallback=e,this},update:function(e){var t,r,i;if(e<this._startTime)return!0;for(t in!1===this._onStartCallbackFired&&(null!==this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),r=(e-this._startTime)/this._duration,r=0===this._duration||1<r?1:r,i=this._easingFunction(r),this._valuesEnd)if(void 0!==this._valuesStart[t]){var n=this._valuesStart[t]||0,o=this._valuesEnd[t];o instanceof Array?this._object[t]=this._interpolationFunction(o,i):("string"==typeof o&&(o="+"===o.charAt(0)||"-"===o.charAt(0)?n+parseFloat(o):parseFloat(o)),"number"==typeof o&&(this._object[t]=n+(o-n)*i))}if(null!==this._onUpdateCallback&&this._onUpdateCallback(this._object),1!==r)return!0;if(0<this._repeat){for(t in isFinite(this._repeat)&&this._repeat--,this._valuesStartRepeat){if("string"==typeof this._valuesEnd[t]&&(this._valuesStartRepeat[t]=this._valuesStartRepeat[t]+parseFloat(this._valuesEnd[t])),this._yoyo){var a=this._valuesStartRepeat[t];this._valuesStartRepeat[t]=this._valuesEnd[t],this._valuesEnd[t]=a}this._valuesStart[t]=this._valuesStartRepeat[t]}return this._yoyo&&(this._reversed=!this._reversed),void 0!==this._repeatDelayTime?this._startTime=e+this._repeatDelayTime:this._startTime=e+this._delayTime,!0}null!==this._onCompleteCallback&&this._onCompleteCallback(this._object);for(var s=0,l=this._chainedTweens.length;s<l;s++)this._chainedTweens[s].start(this._startTime+this._duration);return!1}},TWEEN.Easing={Linear:{None:function(e){return e}},Quadratic:{In:function(e){return e*e},Out:function(e){return e*(2-e)},InOut:function(e){return(e*=2)<1?.5*e*e:-.5*(--e*(e-2)-1)}},Cubic:{In:function(e){return e*e*e},Out:function(e){return--e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e:.5*((e-=2)*e*e+2)}},Quartic:{In:function(e){return e*e*e*e},Out:function(e){return 1- --e*e*e*e},InOut:function(e){return(e*=2)<1?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2)}},Quintic:{In:function(e){return e*e*e*e*e},Out:function(e){return--e*e*e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2)}},Sinusoidal:{In:function(e){return 1-Math.cos(e*Math.PI/2)},Out:function(e){return Math.sin(e*Math.PI/2)},InOut:function(e){return.5*(1-Math.cos(Math.PI*e))}},Exponential:{In:function(e){return 0===e?0:Math.pow(1024,e-1)},Out:function(e){return 1===e?1:1-Math.pow(2,-10*e)},InOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?.5*Math.pow(1024,e-1):.5*(2-Math.pow(2,-10*(e-1)))}},Circular:{In:function(e){return 1-Math.sqrt(1-e*e)},Out:function(e){return Math.sqrt(1- --e*e)},InOut:function(e){return(e*=2)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)}},Elastic:{In:function(e){return 0===e?0:1===e?1:-Math.pow(2,10*(e-1))*Math.sin(5*(e-1.1)*Math.PI)},Out:function(e){return 0===e?0:1===e?1:Math.pow(2,-10*e)*Math.sin(5*(e-.1)*Math.PI)+1},InOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?-.5*Math.pow(2,10*(e-1))*Math.sin(5*(e-1.1)*Math.PI):.5*Math.pow(2,-10*(e-1))*Math.sin(5*(e-1.1)*Math.PI)+1}},Back:{In:function(e){return e*e*(2.70158*e-1.70158)},Out:function(e){return--e*e*(2.70158*e+1.70158)+1},InOut:function(e){var t=2.5949095;return(e*=2)<1?e*e*((t+1)*e-t)*.5:.5*((e-=2)*e*((t+1)*e+t)+2)}},Bounce:{In:function(e){return 1-TWEEN.Easing.Bounce.Out(1-e)},Out:function(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},InOut:function(e){return e<.5?.5*TWEEN.Easing.Bounce.In(2*e):.5*TWEEN.Easing.Bounce.Out(2*e-1)+.5}}},TWEEN.Interpolation={Linear:function(e,t){var r=e.length-1,i=r*t,n=Math.floor(i),o=TWEEN.Interpolation.Utils.Linear;return t<0?o(e[0],e[1],i):1<t?o(e[r],e[r-1],r-i):o(e[n],e[r<n+1?r:n+1],i-n)},Bezier:function(e,t){for(var r=0,i=e.length-1,n=Math.pow,o=TWEEN.Interpolation.Utils.Bernstein,a=0;a<=i;a++)r+=n(1-t,i-a)*n(t,a)*e[a]*o(i,a);return r},CatmullRom:function(e,t){var r=e.length-1,i=r*t,n=Math.floor(i),o=TWEEN.Interpolation.Utils.CatmullRom;return e[0]===e[r]?(t<0&&(n=Math.floor(i=r*(1+t))),o(e[(n-1+r)%r],e[n],e[(n+1)%r],e[(n+2)%r],i-n)):t<0?e[0]-(o(e[0],e[0],e[1],e[1],-i)-e[0]):1<t?e[r]-(o(e[r],e[r],e[r-1],e[r-1],i-r)-e[r]):o(e[n?n-1:0],e[n],e[r<n+1?r:n+1],e[r<n+2?r:n+2],i-n)},Utils:{Linear:function(e,t,r){return(t-e)*r+e},Bernstein:function(e,t){var r=TWEEN.Interpolation.Utils.Factorial;return r(e)/r(t)/r(e-t)},Factorial:function(){var i=[1];return function(e){var t=1;if(i[e])return i[e];for(var r=e;1<r;r--)t*=r;return i[e]=t}}(),CatmullRom:function(e,t,r,i,n){var o=.5*(r-e),a=.5*(i-t),s=n*n;return(2*t-2*r+o+a)*(n*s)+(-3*t+3*r-2*o-a)*s+o*n+t}}},function(e){"function"==typeof define&&define.amd?define([],function(){return TWEEN}):"undefined"!=typeof module&&"object"==typeof exports?module.exports=TWEEN:void 0!==e&&(e.TWEEN=TWEEN)}(this),function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.json2mesh={})}(this,function(e){"use strict";var t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function r(e,t){return e(t={exports:{}},t.exports),t.exports}var qe=r(function(e){var t=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=t)}),m=r(function(e){var t=e.exports={version:"2.5.3"};"number"==typeof __e&&(__e=t)}),Ge=function(e){return"object"==typeof e?null!==e:"function"==typeof e},f=function(e){if(!Ge(e))throw TypeError(e+" is not an object!");return e},We=function(e){try{return!!e()}catch(e){return!0}},Xe=!We(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}),i=qe.document,n=Ge(i)&&Ge(i.createElement),o=function(e){return n?i.createElement(e):{}},a=!Xe&&!We(function(){return 7!=Object.defineProperty(o("div"),"a",{get:function(){return 7}}).a}),Ye=function(e,t){if(!Ge(e))return e;var r,i;if(t&&"function"==typeof(r=e.toString)&&!Ge(i=r.call(e)))return i;if("function"==typeof(r=e.valueOf)&&!Ge(i=r.call(e)))return i;if(!t&&"function"==typeof(r=e.toString)&&!Ge(i=r.call(e)))return i;throw TypeError("Can't convert object to primitive value")},s=Object.defineProperty,Qe={f:Xe?Object.defineProperty:function(e,t,r){if(f(e),t=Ye(t,!0),f(r),a)try{return s(e,t,r)}catch(e){}if("get"in r||"set"in r)throw TypeError("Accessors not supported!");return"value"in r&&(e[t]=r.value),e}},Je=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},Ze=Xe?function(e,t,r){return Qe.f(e,t,Je(1,r))}:function(e,t,r){return e[t]=r,e},l={}.hasOwnProperty,Ke=function(e,t){return l.call(e,t)},c=0,u=Math.random(),$e=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++c+u).toString(36))},_=r(function(e){var o=$e("src"),t="toString",r=Function[t],a=(""+r).split(t);m.inspectSource=function(e){return r.call(e)},(e.exports=function(e,t,r,i){var n="function"==typeof r;n&&(Ke(r,"name")||Ze(r,"name",t)),e[t]!==r&&(n&&(Ke(r,o)||Ze(r,o,e[t]?""+e[t]:a.join(String(t)))),e===qe?e[t]=r:i?e[t]?e[t]=r:Ze(e,t,r):(delete e[t],Ze(e,t,r)))})(Function.prototype,t,function(){return"function"==typeof this&&this[o]||r.call(this)})}),h=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e},et=function(i,n,e){if(h(i),void 0===n)return i;switch(e){case 1:return function(e){return i.call(n,e)};case 2:return function(e,t){return i.call(n,e,t)};case 3:return function(e,t,r){return i.call(n,e,t,r)}}return function(){return i.apply(n,arguments)}},g="prototype",v=function(e,t,r){var i,n,o,a,s=e&v.F,l=e&v.G,c=e&v.S,u=e&v.P,h=e&v.B,p=l?qe:c?qe[t]||(qe[t]={}):(qe[t]||{})[g],d=l?m:m[t]||(m[t]={}),f=d[g]||(d[g]={});for(i in l&&(r=t),r)o=((n=!s&&p&&void 0!==p[i])?p:r)[i],a=h&&n?et(o,qe):u&&"function"==typeof o?et(Function.call,o):o,p&&_(p,i,o,e&v.U),d[i]!=o&&Ze(d,i,a),u&&f[i]!=o&&(f[i]=o)};qe.core=m,v.F=1,v.G=2,v.S=4,v.P=8,v.B=16,v.W=32,v.U=64,v.R=128;for(var p,tt=v,d=$e("typed_array"),y=$e("view"),b=!(!qe.ArrayBuffer||!qe.DataView),x=b,E=0,w="Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array".split(",");E<9;)(p=qe[w[E++]])?(Ze(p.prototype,d,!0),Ze(p.prototype,y,!0)):x=!1;var rt={ABV:b,CONSTR:x,TYPED:d,VIEW:y},it=function(e,t,r){for(var i in t)_(e,i,t[i],r);return e},nt=function(e,t,r,i){if(!(e instanceof t)||void 0!==i&&i in e)throw TypeError(r+": incorrect invocation!");return e},T=Math.ceil,M=Math.floor,ot=function(e){return isNaN(e=+e)?0:(0<e?M:T)(e)},S=Math.min,at=function(e){return 0<e?S(ot(e),9007199254740991):0},st=function(e){if(void 0===e)return 0;var t=ot(e),r=at(t);if(t!==r)throw RangeError("Wrong length!");return r},R={}.toString,P=function(e){return R.call(e).slice(8,-1)},A=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==P(e)?e.split(""):Object(e)},C=function(e){if(null==e)throw TypeError("Can't call method on  "+e);return e},L=function(e){return A(C(e))},O=Math.max,H=Math.min,lt=function(e,t){return(e=ot(e))<0?O(e+t,0):H(e,t)},ct=function(s){return function(e,t,r){var i,n=L(e),o=at(n.length),a=lt(r,o);if(s&&t!=t){for(;a<o;)if((i=n[a++])!=i)return!0}else for(;a<o;a++)if((s||a in n)&&n[a]===t)return s||a||0;return!s&&-1}},F="__core-js_shared__",k=qe[F]||(qe[F]={}),I=function(e){return k[e]||(k[e]={})},j=I("keys"),N=function(e){return j[e]||(j[e]=$e(e))},D=ct(!1),U=N("IE_PROTO"),V=function(e,t){var r,i=L(e),n=0,o=[];for(r in i)r!=U&&Ke(i,r)&&o.push(r);for(;t.length>n;)Ke(i,r=t[n++])&&(~D(o,r)||o.push(r));return o},B="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(","),z=B.concat("length","prototype"),ut={f:Object.getOwnPropertyNames||function(e){return V(e,z)}},ht=function(e){return Object(C(e))},pt=function(e){for(var t=ht(this),r=at(t.length),i=arguments.length,n=lt(1<i?arguments[1]:void 0,r),o=2<i?arguments[2]:void 0,a=void 0===o?r:lt(o,r);n<a;)t[n++]=e;return t},dt=r(function(e){var t=I("wks"),r=qe.Symbol,i="function"==typeof r;(e.exports=function(e){return t[e]||(t[e]=i&&r[e]||(i?r:$e)("Symbol."+e))}).store=t}),q=Qe.f,G=dt("toStringTag"),W=function(e,t,r){e&&!Ke(e=r?e:e.prototype,G)&&q(e,G,{configurable:!0,value:t})},ft=r(function(e,t){var r=ut.f,i=Qe.f,n="ArrayBuffer",o="DataView",a="prototype",h="Wrong index!",s=qe[n],l=qe[o],c=qe.Math,p=qe.RangeError,d=qe.Infinity,u=s,f=c.abs,m=c.pow,g=c.floor,v=c.log,y=c.LN2,b="byteLength",x="byteOffset",E=Xe?"_b":"buffer",_=Xe?"_l":b,w=Xe?"_o":x;function T(e,t,r){var i,n,o,a=new Array(r),s=8*r-t-1,l=(1<<s)-1,c=l>>1,u=23===t?m(2,-24)-m(2,-77):0,h=0,p=e<0||0===e&&1/e<0?1:0;for((e=f(e))!=e||e===d?(n=e!=e?1:0,i=l):(i=g(v(e)/y),e*(o=m(2,-i))<1&&(i--,o*=2),2<=(e+=1<=i+c?u/o:u*m(2,1-c))*o&&(i++,o/=2),l<=i+c?(n=0,i=l):1<=i+c?(n=(e*o-1)*m(2,t),i+=c):(n=e*m(2,c-1)*m(2,t),i=0));8<=t;a[h++]=255&n,n/=256,t-=8);for(i=i<<t|n,s+=t;0<s;a[h++]=255&i,i/=256,s-=8);return a[--h]|=128*p,a}function M(e,t,r){var i,n=8*r-t-1,o=(1<<n)-1,a=o>>1,s=n-7,l=r-1,c=e[l--],u=127&c;for(c>>=7;0<s;u=256*u+e[l],l--,s-=8);for(i=u&(1<<-s)-1,u>>=-s,s+=t;0<s;i=256*i+e[l],l--,s-=8);if(0===u)u=1-a;else{if(u===o)return i?NaN:c?-d:d;i+=m(2,t),u-=a}return(c?-1:1)*i*m(2,u-t)}function S(e){return e[3]<<24|e[2]<<16|e[1]<<8|e[0]}function R(e){return[255&e]}function P(e){return[255&e,e>>8&255]}function A(e){return[255&e,e>>8&255,e>>16&255,e>>24&255]}function C(e){return T(e,52,8)}function L(e){return T(e,23,4)}function O(e,t,r){i(e[a],t,{get:function(){return this[r]}})}function H(e,t,r,i){var n=st(+r);if(n+t>e[_])throw p(h);var o=e[E]._b,a=n+e[w],s=o.slice(a,a+t);return i?s:s.reverse()}function F(e,t,r,i,n,o){var a=st(+r);if(a+t>e[_])throw p(h);for(var s=e[E]._b,l=a+e[w],c=i(+n),u=0;u<t;u++)s[l+u]=c[o?u:t-u-1]}if(rt.ABV){if(!We(function(){s(1)})||!We(function(){new s(-1)})||We(function(){return new s,new s(1.5),new s(NaN),s.name!=n})){for(var k,I=(s=function(e){return nt(this,s),new u(st(e))})[a]=u[a],j=r(u),N=0;j.length>N;)(k=j[N++])in s||Ze(s,k,u[k]);I.constructor=s}var D=new l(new s(2)),U=l[a].setInt8;D.setInt8(0,2147483648),D.setInt8(1,2147483649),!D.getInt8(0)&&D.getInt8(1)||it(l[a],{setInt8:function(e,t){U.call(this,e,t<<24>>24)},setUint8:function(e,t){U.call(this,e,t<<24>>24)}},!0)}else s=function(e){nt(this,s,n);var t=st(e);this._b=pt.call(new Array(t),0),this[_]=t},l=function(e,t,r){nt(this,l,o),nt(e,s,o);var i=e[_],n=ot(t);if(n<0||i<n)throw p("Wrong offset!");if(i<n+(r=void 0===r?i-n:at(r)))throw p("Wrong length!");this[E]=e,this[w]=n,this[_]=r},Xe&&(O(s,b,"_l"),O(l,"buffer","_b"),O(l,b,"_l"),O(l,x,"_o")),it(l[a],{getInt8:function(e){return H(this,1,e)[0]<<24>>24},getUint8:function(e){return H(this,1,e)[0]},getInt16:function(e){var t=H(this,2,e,arguments[1]);return(t[1]<<8|t[0])<<16>>16},getUint16:function(e){var t=H(this,2,e,arguments[1]);return t[1]<<8|t[0]},getInt32:function(e){return S(H(this,4,e,arguments[1]))},getUint32:function(e){return S(H(this,4,e,arguments[1]))>>>0},getFloat32:function(e){return M(H(this,4,e,arguments[1]),23,4)},getFloat64:function(e){return M(H(this,8,e,arguments[1]),52,8)},setInt8:function(e,t){F(this,1,e,R,t)},setUint8:function(e,t){F(this,1,e,R,t)},setInt16:function(e,t){F(this,2,e,P,t,arguments[2])},setUint16:function(e,t){F(this,2,e,P,t,arguments[2])},setInt32:function(e,t){F(this,4,e,A,t,arguments[2])},setUint32:function(e,t){F(this,4,e,A,t,arguments[2])},setFloat32:function(e,t){F(this,4,e,L,t,arguments[2])},setFloat64:function(e,t){F(this,8,e,C,t,arguments[2])}});W(s,n),W(l,o),Ze(l[a],rt.VIEW,!0),t[n]=s,t[o]=l}),X=dt("species"),mt=function(e,t){var r,i=f(e).constructor;return void 0===i||null==(r=f(i)[X])?t:h(r)},Y=dt("species"),gt=function(e){var t=qe[e];Xe&&t&&!t[Y]&&Qe.f(t,Y,{configurable:!0,get:function(){return this}})},Q=qe.ArrayBuffer,J=ft.ArrayBuffer,Z=ft.DataView,K=rt.ABV&&Q.isView,$=J.prototype.slice,ee=rt.VIEW,te="ArrayBuffer";tt(tt.G+tt.W+tt.F*(Q!==J),{ArrayBuffer:J}),tt(tt.S+tt.F*!rt.CONSTR,te,{isView:function(e){return K&&K(e)||Ge(e)&&ee in e}}),tt(tt.P+tt.U+tt.F*We(function(){return!new J(2).slice(1,void 0).byteLength}),te,{slice:function(e,t){if(void 0!==$&&void 0===t)return $.call(f(this),e);for(var r=f(this).byteLength,i=lt(e,r),n=lt(void 0===t?r:t,r),o=new(mt(this,J))(at(n-i)),a=new Z(this),s=new Z(o),l=0;i<n;)s.setUint8(l++,a.getUint8(i++));return o}}),gt(te);var re=dt("toStringTag"),ie="Arguments"==P(function(){return arguments}()),vt=function(e){var t,r,i;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(r=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),re))?r:ie?P(t):"Object"==(i=P(t))&&"function"==typeof t.callee?"Arguments":i},yt={},ne=dt("iterator"),oe=Array.prototype,bt=function(e){return void 0!==e&&(yt.Array===e||oe[ne]===e)},ae=Object.keys||function(e){return V(e,B)},se=Xe?Object.defineProperties:function(e,t){f(e);for(var r,i=ae(t),n=i.length,o=0;o<n;)Qe.f(e,r=i[o++],t[r]);return e},le=qe.document,ce=le&&le.documentElement,ue=N("IE_PROTO"),he=function(){},pe="prototype",de=function(){var e,t=o("iframe"),r=B.length;for(t.style.display="none",ce.appendChild(t),t.src="javascript:",(e=t.contentWindow.document).open(),e.write("<script>document.F=Object<\/script>"),e.close(),de=e.F;r--;)delete de[pe][B[r]];return de()},xt=Object.create||function(e,t){var r;return null!==e?(he[pe]=f(e),r=new he,he[pe]=null,r[ue]=e):r=de(),void 0===t?r:se(r,t)},fe=N("IE_PROTO"),me=Object.prototype,Et=Object.getPrototypeOf||function(e){return e=ht(e),Ke(e,fe)?e[fe]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?me:null},ge=dt("iterator"),_t=m.getIteratorMethod=function(e){if(null!=e)return e[ge]||e["@@iterator"]||yt[vt(e)]},ve=Array.isArray||function(e){return"Array"==P(e)},ye=dt("species"),be=function(e,t){return ve(r=e)&&("function"!=typeof(i=r.constructor)||i!==Array&&!ve(i.prototype)||(i=void 0),Ge(i)&&null===(i=i[ye])&&(i=void 0)),new(void 0===i?Array:i)(t);var r,i},wt=function(h,e){var p=1==h,d=2==h,f=3==h,m=4==h,g=6==h,v=5==h||g,y=e||be;return function(e,t,r){for(var i,n,o=ht(e),a=A(o),s=et(t,r,3),l=at(a.length),c=0,u=p?y(e,l):d?y(e,0):void 0;c<l;c++)if((v||c in a)&&(n=s(i=a[c],c,o),h))if(p)u[c]=n;else if(n)switch(h){case 3:return!0;case 5:return i;case 6:return c;case 2:u.push(i)}else if(m)return!1;return g?-1:f||m?m:u}},xe=dt("unscopables"),Ee=Array.prototype;null==Ee[xe]&&Ze(Ee,xe,{});var _e=function(e){Ee[xe][e]=!0},we=function(e,t){return{value:t,done:!!e}},Te={};Ze(Te,dt("iterator"),function(){return this});var Me=dt("iterator"),Se=!([].keys&&"next"in[].keys()),Re="values",Pe=function(){return this},Ae=function(e,t,r,i,n,o,a){var s,l,c;l=t,c=i,(s=r).prototype=xt(Te,{next:Je(1,c)}),W(s,l+" Iterator");var u,h,p,d=function(e){if(!Se&&e in v)return v[e];switch(e){case"keys":case Re:return function(){return new r(this,e)}}return function(){return new r(this,e)}},f=t+" Iterator",m=n==Re,g=!1,v=e.prototype,y=v[Me]||v["@@iterator"]||n&&v[n],b=!Se&&y||d(n),x=n?m?d("entries"):b:void 0,E="Array"==t&&v.entries||y;if(E&&(p=Et(E.call(new e)))!==Object.prototype&&p.next&&(W(p,f,!0),Ke(p,Me)||Ze(p,Me,Pe)),m&&y&&y.name!==Re&&(g=!0,b=function(){return y.call(this)}),(Se||g||!v[Me])&&Ze(v,Me,b),yt[t]=b,yt[f]=Pe,n)if(u={values:m?b:d(Re),keys:o?b:d("keys"),entries:x},a)for(h in u)h in v||_(v,h,u[h]);else tt(tt.P+tt.F*(Se||g),t,u);return u},Tt=Ae(Array,"Array",function(e,t){this._t=L(e),this._i=0,this._k=t},function(){var e=this._t,t=this._k,r=this._i++;return!e||r>=e.length?(this._t=void 0,we(1)):we(0,"keys"==t?r:"values"==t?e[r]:[r,e[r]])},"values");yt.Arguments=yt.Array,_e("keys"),_e("values"),_e("entries");var Ce=dt("iterator"),Le=!1;try{var Oe=[7][Ce]();Oe.return=function(){Le=!0},Array.from(Oe,function(){throw 2})}catch(e){}var Mt=function(e,t){if(!t&&!Le)return!1;var r=!1;try{var i=[7],n=i[Ce]();n.next=function(){return{done:r=!0}},i[Ce]=function(){return n},e(i)}catch(e){}return r},St=[].copyWithin||function(e,t){var r=ht(this),i=at(r.length),n=lt(e,i),o=lt(t,i),a=2<arguments.length?arguments[2]:void 0,s=Math.min((void 0===a?i:lt(a,i))-o,i-n),l=1;for(o<n&&n<o+s&&(l=-1,o+=s-1,n+=s-1);0<s--;)o in r?r[n]=r[o]:delete r[n],n+=l,o+=l;return r},He={f:{}.propertyIsEnumerable},Fe=Object.getOwnPropertyDescriptor,Rt={f:Xe?Fe:function(e,t){if(e=L(e),t=Ye(t,!0),a)try{return Fe(e,t)}catch(e){}if(Ke(e,t))return Je(!He.f.call(e,t),e[t])}},ke=r(function(e){if(Xe){var v=qe,y=We,b=tt,x=rt,t=ft,p=et,E=nt,r=Je,_=Ze,i=it,n=ot,w=at,T=st,o=lt,a=Ye,s=Ke,M=vt,S=Ge,d=ht,f=bt,R=xt,P=Et,A=ut.f,m=_t,l=$e,c=dt,u=wt,h=ct,g=mt,C=Tt,L=yt,O=Mt,H=gt,F=pt,k=St,I=Qe,j=Rt,N=I.f,D=j.f,U=v.RangeError,V=v.TypeError,B=v.Uint8Array,z="ArrayBuffer",q="Shared"+z,G="BYTES_PER_ELEMENT",W="prototype",X=Array[W],Y=t.ArrayBuffer,Q=t.DataView,J=u(0),Z=u(2),K=u(3),$=u(4),ee=u(5),te=u(6),re=h(!0),ie=h(!1),ne=C.values,oe=C.keys,ae=C.entries,se=X.lastIndexOf,le=X.reduce,ce=X.reduceRight,ue=X.join,he=X.sort,pe=X.slice,de=X.toString,fe=X.toLocaleString,me=c("iterator"),ge=c("toStringTag"),ve=l("typed_constructor"),ye=l("def_constructor"),be=x.CONSTR,xe=x.TYPED,Ee=x.VIEW,_e="Wrong length!",we=u(1,function(e,t){return Pe(g(e,e[ye]),t)}),Te=y(function(){return 1===new B(new Uint16Array([1]).buffer)[0]}),Me=!!B&&!!B[W].set&&y(function(){new B(1).set({})}),Se=function(e,t){var r=n(e);if(r<0||r%t)throw U("Wrong offset!");return r},Re=function(e){if(S(e)&&xe in e)return e;throw V(e+" is not a typed array!")},Pe=function(e,t){if(!(S(e)&&ve in e))throw V("It is not a typed array constructor!");return new e(t)},Ae=function(e,t){return Ce(g(e,e[ye]),t)},Ce=function(e,t){for(var r=0,i=t.length,n=Pe(e,i);r<i;)n[r]=t[r++];return n},Le=function(e,t,r){N(e,t,{get:function(){return this._d[r]}})},Oe=function(e){var t,r,i,n,o,a,s=d(e),l=arguments.length,c=1<l?arguments[1]:void 0,u=void 0!==c,h=m(s);if(null!=h&&!f(h)){for(a=h.call(s),i=[],t=0;!(o=a.next()).done;t++)i.push(o.value);s=i}for(u&&2<l&&(c=p(c,arguments[2],2)),t=0,r=w(s.length),n=Pe(this,r);t<r;t++)n[t]=u?c(s[t],t):s[t];return n},He=function(){for(var e=0,t=arguments.length,r=Pe(this,t);e<t;)r[e]=arguments[e++];return r},Fe=!!B&&y(function(){fe.call(new B(1))}),ke=function(){return fe.apply(Fe?pe.call(Re(this)):Re(this),arguments)},Ie={copyWithin:function(e,t){return k.call(Re(this),e,t,2<arguments.length?arguments[2]:void 0)},every:function(e){return $(Re(this),e,1<arguments.length?arguments[1]:void 0)},fill:function(e){return F.apply(Re(this),arguments)},filter:function(e){return Ae(this,Z(Re(this),e,1<arguments.length?arguments[1]:void 0))},find:function(e){return ee(Re(this),e,1<arguments.length?arguments[1]:void 0)},findIndex:function(e){return te(Re(this),e,1<arguments.length?arguments[1]:void 0)},forEach:function(e){J(Re(this),e,1<arguments.length?arguments[1]:void 0)},indexOf:function(e){return ie(Re(this),e,1<arguments.length?arguments[1]:void 0)},includes:function(e){return re(Re(this),e,1<arguments.length?arguments[1]:void 0)},join:function(e){return ue.apply(Re(this),arguments)},lastIndexOf:function(e){return se.apply(Re(this),arguments)},map:function(e){return we(Re(this),e,1<arguments.length?arguments[1]:void 0)},reduce:function(e){return le.apply(Re(this),arguments)},reduceRight:function(e){return ce.apply(Re(this),arguments)},reverse:function(){for(var e,t=Re(this).length,r=Math.floor(t/2),i=0;i<r;)e=this[i],this[i++]=this[--t],this[t]=e;return this},some:function(e){return K(Re(this),e,1<arguments.length?arguments[1]:void 0)},sort:function(e){return he.call(Re(this),e)},subarray:function(e,t){var r=Re(this),i=r.length,n=o(e,i);return new(g(r,r[ye]))(r.buffer,r.byteOffset+n*r.BYTES_PER_ELEMENT,w((void 0===t?i:o(t,i))-n))}},je=function(e,t){return Ae(this,pe.call(Re(this),e,t))},Ne=function(e){Re(this);var t=Se(arguments[1],1),r=this.length,i=d(e),n=w(i.length),o=0;if(r<n+t)throw U(_e);for(;o<n;)this[t+o]=i[o++]},De={entries:function(){return ae.call(Re(this))},keys:function(){return oe.call(Re(this))},values:function(){return ne.call(Re(this))}},Ue=function(e,t){return S(e)&&e[xe]&&"symbol"!=typeof t&&t in e&&String(+t)==String(t)},Ve=function(e,t){return Ue(e,t=a(t,!0))?r(2,e[t]):D(e,t)},Be=function(e,t,r){return!(Ue(e,t=a(t,!0))&&S(r)&&s(r,"value"))||s(r,"get")||s(r,"set")||r.configurable||s(r,"writable")&&!r.writable||s(r,"enumerable")&&!r.enumerable?N(e,t,r):(e[t]=r.value,e)};be||(j.f=Ve,I.f=Be),b(b.S+b.F*!be,"Object",{getOwnPropertyDescriptor:Ve,defineProperty:Be}),y(function(){de.call({})})&&(de=fe=function(){return ue.call(this)});var ze=i({},Ie);i(ze,De),_(ze,me,De.values),i(ze,{slice:je,set:Ne,constructor:function(){},toString:de,toLocaleString:ke}),Le(ze,"buffer","b"),Le(ze,"byteOffset","o"),Le(ze,"byteLength","l"),Le(ze,"length","e"),N(ze,ge,{get:function(){return this[xe]}}),e.exports=function(e,h,t,o){var p=e+((o=!!o)?"Clamped":"")+"Array",r="get"+e,a="set"+e,d=v[p],s=d||{},i=d&&P(d),n=!d||!x.ABV,l={},c=d&&d[W],f=function(e,n){N(e,n,{get:function(){return e=n,(t=this._d).v[r](e*h+t.o,Te);var e,t},set:function(e){return t=n,r=e,i=this._d,o&&(r=(r=Math.round(r))<0?0:255<r?255:255&r),void i.v[a](t*h+i.o,r,Te);var t,r,i},enumerable:!0})};n?(d=t(function(e,t,r,i){E(e,d,p,"_d");var n,o,a,s,l=0,c=0;if(S(t)){if(!(t instanceof Y||(s=M(t))==z||s==q))return xe in t?Ce(d,t):Oe.call(d,t);n=t,c=Se(r,h);var u=t.byteLength;if(void 0===i){if(u%h)throw U(_e);if((o=u-c)<0)throw U(_e)}else if(u<(o=w(i)*h)+c)throw U(_e);a=o/h}else a=T(t),n=new Y(o=a*h);for(_(e,"_d",{b:n,o:c,l:o,e:a,v:new Q(n)});l<a;)f(e,l++)}),c=d[W]=R(ze),_(c,"constructor",d)):y(function(){d(1)})&&y(function(){new d(-1)})&&O(function(e){new d,new d(null),new d(1.5),new d(e)},!0)||(d=t(function(e,t,r,i){var n;return E(e,d,p),S(t)?t instanceof Y||(n=M(t))==z||n==q?void 0!==i?new s(t,Se(r,h),i):void 0!==r?new s(t,Se(r,h)):new s(t):xe in t?Ce(d,t):Oe.call(d,t):new s(T(t))}),J(i!==Function.prototype?A(s).concat(A(i)):A(s),function(e){e in d||_(d,e,s[e])}),(d[W]=c).constructor=d);var u=c[me],m=!!u&&("values"==u.name||null==u.name),g=De.values;_(d,ve,!0),_(c,xe,p),_(c,Ee,!0),_(c,ye,d),(o?new d(1)[ge]==p:ge in c)||N(c,ge,{get:function(){return p}}),l[p]=d,b(b.G+b.W+b.F*(d!=s),l),b(b.S,p,{BYTES_PER_ELEMENT:h}),b(b.S+b.F*y(function(){s.of.call(d,1)}),p,{from:Oe,of:He}),G in c||_(c,G,h),b(b.P,p,Ie),H(p),b(b.P+b.F*Me,p,{set:Ne}),b(b.P+b.F*!m,p,De),c.toString!=de&&(c.toString=de),b(b.P+b.F*y(function(){new d(1).slice()}),p,{slice:je}),b(b.P+b.F*(y(function(){return[1,2].toLocaleString()!=new d([1,2]).toLocaleString()})||!y(function(){c.toLocaleString.call([1,2])})),p,{toLocaleString:ke}),L[p]=m?u:g,m||_(c,me,g)}}else e.exports=function(){}});ke("Int8",1,function(i){return function(e,t,r){return i(this,e,t,r)}}),ke("Uint8",1,function(i){return function(e,t,r){return i(this,e,t,r)}}),ke("Uint8",1,function(i){return function(e,t,r){return i(this,e,t,r)}},!0),ke("Int16",2,function(i){return function(e,t,r){return i(this,e,t,r)}}),ke("Uint16",2,function(i){return function(e,t,r){return i(this,e,t,r)}}),ke("Int32",4,function(i){return function(e,t,r){return i(this,e,t,r)}}),ke("Uint32",4,function(i){return function(e,t,r){return i(this,e,t,r)}}),ke("Float32",4,function(i){return function(e,t,r){return i(this,e,t,r)}}),ke("Float64",8,function(i){return function(e,t,r){return i(this,e,t,r)}});var Ie=function(t,e,r,i){try{return i?e(f(r)[0],r[1]):e(r)}catch(e){var n=t.return;throw void 0!==n&&f(n.call(t)),e}},je=r(function(e){var p={},d={},t=e.exports=function(e,t,r,i,n){var o,a,s,l,c=n?function(){return e}:_t(e),u=et(r,i,t?2:1),h=0;if("function"!=typeof c)throw TypeError(e+" is not iterable!");if(bt(c)){for(o=at(e.length);h<o;h++)if((l=t?u(f(a=e[h])[0],a[1]):u(e[h]))===p||l===d)return l}else for(s=c.call(e);!(a=s.next()).done;)if((l=Ie(s,u,a.value,t))===p||l===d)return l};t.BREAK=p,t.RETURN=d}),Ne=r(function(e){var r=$e("meta"),t=Qe.f,i=0,n=Object.isExtensible||function(){return!0},o=!We(function(){return n(Object.preventExtensions({}))}),a=function(e){t(e,r,{value:{i:"O"+ ++i,w:{}}})},s=e.exports={KEY:r,NEED:!1,fastKey:function(e,t){if(!Ge(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!Ke(e,r)){if(!n(e))return"F";if(!t)return"E";a(e)}return e[r].i},getWeak:function(e,t){if(!Ke(e,r)){if(!n(e))return!0;if(!t)return!1;a(e)}return e[r].w},onFreeze:function(e){return o&&s.NEED&&n(e)&&!Ke(e,r)&&a(e),e}}}),De=function(e,t){if(!Ge(e)||e._t!==t)throw TypeError("Incompatible receiver, "+t+" required!");return e},Ue=Qe.f,Ve=Ne.fastKey,Be=Xe?"_s":"size",ze=function(e,t){var r,i=Ve(t);if("F"!==i)return e._i[i];for(r=e._f;r;r=r.n)if(r.k==t)return r},Pt={getConstructor:function(e,o,r,i){var n=e(function(e,t){nt(e,n,o,"_i"),e._t=o,e._i=xt(null),e._f=void 0,e._l=void 0,e[Be]=0,null!=t&&je(t,r,e[i],e)});return it(n.prototype,{clear:function(){for(var e=De(this,o),t=e._i,r=e._f;r;r=r.n)r.r=!0,r.p&&(r.p=r.p.n=void 0),delete t[r.i];e._f=e._l=void 0,e[Be]=0},delete:function(e){var t=De(this,o),r=ze(t,e);if(r){var i=r.n,n=r.p;delete t._i[r.i],r.r=!0,n&&(n.n=i),i&&(i.p=n),t._f==r&&(t._f=i),t._l==r&&(t._l=n),t[Be]--}return!!r},forEach:function(e){De(this,o);for(var t,r=et(e,1<arguments.length?arguments[1]:void 0,3);t=t?t.n:this._f;)for(r(t.v,t.k,this);t&&t.r;)t=t.p},has:function(e){return!!ze(De(this,o),e)}}),Xe&&Ue(n.prototype,"size",{get:function(){return De(this,o)[Be]}}),n},def:function(e,t,r){var i,n,o=ze(e,t);return o?o.v=r:(e._l=o={i:n=Ve(t,!0),k:t,v:r,p:i=e._l,n:void 0,r:!1},e._f||(e._f=o),i&&(i.n=o),e[Be]++,"F"!==n&&(e._i[n]=o)),e},getEntry:ze,setStrong:function(e,r,t){Ae(e,r,function(e,t){this._t=De(e,r),this._k=t,this._l=void 0},function(){for(var e=this._k,t=this._l;t&&t.r;)t=t.p;return this._t&&(this._l=t=t?t.n:this._t._f)?we(0,"keys"==e?t.k:"values"==e?t.v:[t.k,t.v]):(this._t=void 0,we(1))},t?"entries":"values",!t,!0),gt(r)}},At=function(e,t){if(f(e),!Ge(t)&&null!==t)throw TypeError(t+": can't set as prototype!")},Ct={set:Object.setPrototypeOf||("__proto__"in{}?function(e,r,i){try{(i=et(Function.call,Rt.f(Object.prototype,"__proto__").set,2))(e,[]),r=!(e instanceof Array)}catch(e){r=!0}return function(e,t){return At(e,t),r?e.__proto__=t:i(e,t),e}}({},!1):void 0),check:At},Lt=Ct.set,Ot=function(s,e,t,r,l,i){var c=qe[s],u=c,h=l?"set":"add",n=u&&u.prototype,o={},a=function(e){var r=n[e];_(n,e,"delete"==e?function(e){return!(i&&!Ge(e))&&r.call(this,0===e?0:e)}:"has"==e?function(e){return!(i&&!Ge(e))&&r.call(this,0===e?0:e)}:"get"==e?function(e){return i&&!Ge(e)?void 0:r.call(this,0===e?0:e)}:"add"==e?function(e){return r.call(this,0===e?0:e),this}:function(e,t){return r.call(this,0===e?0:e,t),this})};if("function"==typeof u&&(i||n.forEach&&!We(function(){(new u).entries().next()}))){var p=new u,d=p[h](i?{}:-0,1)!=p,f=We(function(){p.has(1)}),m=Mt(function(e){new u(e)}),g=!i&&We(function(){for(var e=new u,t=5;t--;)e[h](t,t);return!e.has(-0)});m||(((u=e(function(e,t){nt(e,u,s);var r,i,n,o,a=(r=new c,i=u,(o=e.constructor)!==i&&"function"==typeof o&&(n=o.prototype)!==i.prototype&&Ge(n)&&Lt&&Lt(r,n),r);return null!=t&&je(t,l,a[h],a),a})).prototype=n).constructor=u),(f||g)&&(a("delete"),a("has"),l&&a("get")),(g||d)&&a(h),i&&n.clear&&delete n.clear}else u=r.getConstructor(e,s,l,h),it(u.prototype,t),Ne.NEED=!0;return W(u,s),o[s]=u,tt(tt.G+tt.W+tt.F*(u!=c),o),i||r.setStrong(u,s,l),u},Ht=(Ot("Map",function(e){return function(){return e(this,0<arguments.length?arguments[0]:void 0)}},{get:function(e){var t=Pt.getEntry(De(this,"Map"),e);return t&&t.v},set:function(e,t){return Pt.def(De(this,"Map"),0===e?0:e,t)}},Pt,!0),Ot("Set",function(e){return function(){return e(this,0<arguments.length?arguments[0]:void 0)}},{add:function(e){return Pt.def(De(this,"Set"),e=0===e?0:e,e)}},Pt),{f:Object.getOwnPropertySymbols}),Ft=Object.assign,kt=!Ft||We(function(){var e={},t={},r=Symbol(),i="abcdefghijklmnopqrst";return e[r]=7,i.split("").forEach(function(e){t[e]=e}),7!=Ft({},e)[r]||Object.keys(Ft({},t)).join("")!=i})?function(e,t){for(var r=ht(e),i=arguments.length,n=1,o=Ht.f,a=He.f;n<i;)for(var s,l=A(arguments[n++]),c=o?ae(l).concat(o(l)):ae(l),u=c.length,h=0;h<u;)a.call(l,s=c[h++])&&(r[s]=l[s]);return r}:Ft,It=Ne.getWeak,jt=wt(5),Nt=wt(6),Dt=0,Ut=function(e){return e._l||(e._l=new Vt)},Vt=function(){this.a=[]},Bt=function(e,t){return jt(e.a,function(e){return e[0]===t})};Vt.prototype={get:function(e){var t=Bt(this,e);if(t)return t[1]},has:function(e){return!!Bt(this,e)},set:function(e,t){var r=Bt(this,e);r?r[1]=t:this.a.push([e,t])},delete:function(t){var e=Nt(this.a,function(e){return e[0]===t});return~e&&this.a.splice(e,1),!!~e}};var zt={getConstructor:function(e,r,i,n){var o=e(function(e,t){nt(e,o,r,"_i"),e._t=r,e._i=Dt++,e._l=void 0,null!=t&&je(t,i,e[n],e)});return it(o.prototype,{delete:function(e){if(!Ge(e))return!1;var t=It(e);return!0===t?Ut(De(this,r)).delete(e):t&&Ke(t,this._i)&&delete t[this._i]},has:function(e){if(!Ge(e))return!1;var t=It(e);return!0===t?Ut(De(this,r)).has(e):t&&Ke(t,this._i)}}),o},def:function(e,t,r){var i=It(f(t),!0);return!0===i?Ut(e).set(t,r):i[e._i]=r,e},ufstore:Ut};r(function(e){var o,t=wt(0),r="WeakMap",i=Ne.getWeak,a=Object.isExtensible,n=zt.ufstore,s={},l=function(e){return function(){return e(this,0<arguments.length?arguments[0]:void 0)}},c={get:function(e){if(Ge(e)){var t=i(e);return!0===t?n(De(this,r)).get(e):t?t[this._i]:void 0}},set:function(e,t){return zt.def(De(this,r),e,t)}},u=e.exports=Ot(r,l,c,zt,!0,!0);We(function(){return 7!=(new u).set((Object.freeze||Object)(s),7).get(s)})&&(o=zt.getConstructor(l,r),kt(o.prototype,c),Ne.NEED=!0,t(["delete","has","get","set"],function(i){var e=u.prototype,n=e[i];_(e,i,function(e,t){if(!Ge(e)||a(e))return n.call(this,e,t);this._f||(this._f=new o);var r=this._f[i](e,t);return"set"==i?this:r})}))});Ot("WeakSet",function(e){return function(){return e(this,0<arguments.length?arguments[0]:void 0)}},{add:function(e){return zt.def(De(this,"WeakSet"),e,!0)}},zt,!1,!0);var qt=(qe.Reflect||{}).apply,Gt=Function.apply;tt(tt.S+tt.F*!We(function(){qt(function(){})}),"Reflect",{apply:function(e,t,r){var i=h(e),n=f(r);return qt?qt(i,t,n):Gt.call(i,t,n)}});var Wt=function(e,t,r){var i=void 0===r;switch(t.length){case 0:return i?e():e.call(r);case 1:return i?e(t[0]):e.call(r,t[0]);case 2:return i?e(t[0],t[1]):e.call(r,t[0],t[1]);case 3:return i?e(t[0],t[1],t[2]):e.call(r,t[0],t[1],t[2]);case 4:return i?e(t[0],t[1],t[2],t[3]):e.call(r,t[0],t[1],t[2],t[3])}return e.apply(r,t)},Xt=[].slice,Yt={},Qt=Function.bind||function(t){var r=h(this),i=Xt.call(arguments,1),n=function(){var e=i.concat(Xt.call(arguments));return this instanceof n?function(e,t,r){if(!(t in Yt)){for(var i=[],n=0;n<t;n++)i[n]="a["+n+"]";Yt[t]=Function("F,a","return new F("+i.join(",")+")")}return Yt[t](e,r)}(r,e.length,e):Wt(r,e,t)};return Ge(r.prototype)&&(n.prototype=r.prototype),n},Jt=(qe.Reflect||{}).construct,Zt=We(function(){function e(){}return!(Jt(function(){},[],e)instanceof e)}),Kt=!We(function(){Jt(function(){})});tt(tt.S+tt.F*(Zt||Kt),"Reflect",{construct:function(e,t){h(e),f(t);var r=arguments.length<3?e:h(arguments[2]);if(Kt&&!Zt)return Jt(e,t,r);if(e==r){switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3])}var i=[null];return i.push.apply(i,t),new(Qt.apply(e,i))}var n=r.prototype,o=xt(Ge(n)?n:Object.prototype),a=Function.apply.call(e,o,t);return Ge(a)?a:o}}),tt(tt.S+tt.F*We(function(){Reflect.defineProperty(Qe.f({},1,{value:1}),1,{value:2})}),"Reflect",{defineProperty:function(e,t,r){f(e),t=Ye(t,!0),f(r);try{return Qe.f(e,t,r),!0}catch(e){return!1}}});var $t=Rt.f;tt(tt.S,"Reflect",{deleteProperty:function(e,t){var r=$t(f(e),t);return!(r&&!r.configurable)&&delete e[t]}}),tt(tt.S,"Reflect",{get:function e(t,r){var i,n,o=arguments.length<3?t:arguments[2];return f(t)===o?t[r]:(i=Rt.f(t,r))?Ke(i,"value")?i.value:void 0!==i.get?i.get.call(o):void 0:Ge(n=Et(t))?e(n,r,o):void 0}}),tt(tt.S,"Reflect",{getOwnPropertyDescriptor:function(e,t){return Rt.f(f(e),t)}}),tt(tt.S,"Reflect",{getPrototypeOf:function(e){return Et(f(e))}}),tt(tt.S,"Reflect",{has:function(e,t){return t in e}});var er=Object.isExtensible;tt(tt.S,"Reflect",{isExtensible:function(e){return f(e),!er||er(e)}});var tr=qe.Reflect,rr=tr&&tr.ownKeys||function(e){var t=ut.f(f(e)),r=Ht.f;return r?t.concat(r(e)):t};tt(tt.S,"Reflect",{ownKeys:rr});var ir=Object.preventExtensions;tt(tt.S,"Reflect",{preventExtensions:function(e){f(e);try{return ir&&ir(e),!0}catch(e){return!1}}}),tt(tt.S,"Reflect",{set:function e(t,r,i){var n,o,a=arguments.length<4?t:arguments[3],s=Rt.f(f(t),r);if(!s){if(Ge(o=Et(t)))return e(o,r,i,a);s=Je(0)}return Ke(s,"value")?!(!1===s.writable||!Ge(a)||((n=Rt.f(a,r)||Je(0)).value=i,Qe.f(a,r,n),0)):void 0!==s.set&&(s.set.call(a,i),!0)}}),Ct&&tt(tt.S,"Reflect",{setPrototypeOf:function(e,t){Ct.check(e,t);try{return Ct.set(e,t),!0}catch(e){return!1}}});var nr,or,ar,sr=qe.process,lr=qe.setImmediate,cr=qe.clearImmediate,ur=qe.MessageChannel,hr=qe.Dispatch,pr=0,dr={},fr="onreadystatechange",mr=function(){var e=+this;if(dr.hasOwnProperty(e)){var t=dr[e];delete dr[e],t()}},gr=function(e){mr.call(e.data)};lr&&cr||(lr=function(e){for(var t=[],r=1;arguments.length>r;)t.push(arguments[r++]);return dr[++pr]=function(){Wt("function"==typeof e?e:Function(e),t)},nr(pr),pr},cr=function(e){delete dr[e]},"process"==P(sr)?nr=function(e){sr.nextTick(et(mr,e,1))}:hr&&hr.now?nr=function(e){hr.now(et(mr,e,1))}:ur?(ar=(or=new ur).port2,or.port1.onmessage=gr,nr=et(ar.postMessage,ar,1)):qe.addEventListener&&"function"==typeof postMessage&&!qe.importScripts?(nr=function(e){qe.postMessage(e+"","*")},qe.addEventListener("message",gr,!1)):nr=fr in o("script")?function(e){ce.appendChild(o("script"))[fr]=function(){ce.removeChild(this),mr.call(e)}}:function(e){setTimeout(et(mr,e,1),0)});var vr={set:lr,clear:cr},yr=vr.set,br=qe.MutationObserver||qe.WebKitMutationObserver,xr=qe.process,Er=qe.Promise,_r="process"==P(xr);function wr(e){var r,i;this.promise=new e(function(e,t){if(void 0!==r||void 0!==i)throw TypeError("Bad Promise constructor");r=e,i=t}),this.resolve=h(r),this.reject=h(i)}var Tr,Mr,Sr,Rr,Pr={f:function(e){return new wr(e)}},Ar=function(e){try{return{e:!1,v:e()}}catch(e){return{e:!0,v:e}}},Cr=vr.set,Lr=function(){var r,i,n,e=function(){var e,t;for(_r&&(e=xr.domain)&&e.exit();r;){t=r.fn,r=r.next;try{t()}catch(e){throw r?n():i=void 0,e}}i=void 0,e&&e.enter()};if(_r)n=function(){xr.nextTick(e)};else if(!br||qe.navigator&&qe.navigator.standalone)if(Er&&Er.resolve){var t=Er.resolve();n=function(){t.then(e)}}else n=function(){yr.call(qe,e)};else{var o=!0,a=document.createTextNode("");new br(e).observe(a,{characterData:!0}),n=function(){a.data=o=!o}}return function(e){var t={fn:e,next:void 0};i&&(i.next=t),r||(r=t,n()),i=t}}(),Or="Promise",Hr=qe.TypeError,Fr=qe.process,kr=qe[Or],Ir="process"==vt(Fr),jr=function(){},Nr=Mr=Pr.f,Dr=!!function(){try{var e=kr.resolve(1),t=(e.constructor={})[dt("species")]=function(e){e(jr,jr)};return(Ir||"function"==typeof PromiseRejectionEvent)&&e.then(jr)instanceof t}catch(e){}}(),Ur=function(e){var t;return!(!Ge(e)||"function"!=typeof(t=e.then))&&t},Vr=function(c,r){if(!c._n){c._n=!0;var i=c._c;Lr(function(){for(var s=c._v,l=1==c._s,e=0,t=function(e){var t,r,i=l?e.ok:e.fail,n=e.resolve,o=e.reject,a=e.domain;try{i?(l||(2==c._h&&qr(c),c._h=1),!0===i?t=s:(a&&a.enter(),t=i(s),a&&a.exit()),t===e.promise?o(Hr("Promise-chain cycle")):(r=Ur(t))?r.call(t,n,o):n(t)):o(s)}catch(e){o(e)}};i.length>e;)t(i[e++]);c._c=[],c._n=!1,r&&!c._h&&Br(c)})}},Br=function(o){Cr.call(qe,function(){var e,t,r,i=o._v,n=zr(o);if(n&&(e=Ar(function(){Ir?Fr.emit("unhandledRejection",i,o):(t=qe.onunhandledrejection)?t({promise:o,reason:i}):(r=qe.console)&&r.error&&r.error("Unhandled promise rejection",i)}),o._h=Ir||zr(o)?2:1),o._a=void 0,n&&e.e)throw e.v})},zr=function(e){return 1!==e._h&&0===(e._a||e._c).length},qr=function(t){Cr.call(qe,function(){var e;Ir?Fr.emit("rejectionHandled",t):(e=qe.onrejectionhandled)&&e({promise:t,reason:t._v})})},Gr=function(e){var t=this;t._d||(t._d=!0,(t=t._w||t)._v=e,t._s=2,t._a||(t._a=t._c.slice()),Vr(t,!0))},Wr=function(e){var r,i=this;if(!i._d){i._d=!0,i=i._w||i;try{if(i===e)throw Hr("Promise can't be resolved itself");(r=Ur(e))?Lr(function(){var t={_w:i,_d:!1};try{r.call(e,et(Wr,t,1),et(Gr,t,1))}catch(e){Gr.call(t,e)}}):(i._v=e,i._s=1,Vr(i,!1))}catch(e){Gr.call({_w:i,_d:!1},e)}}};Dr||(kr=function(e){nt(this,kr,Or,"_h"),h(e),Tr.call(this);try{e(et(Wr,this,1),et(Gr,this,1))}catch(e){Gr.call(this,e)}},(Tr=function(e){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1}).prototype=it(kr.prototype,{then:function(e,t){var r=Nr(mt(this,kr));return r.ok="function"!=typeof e||e,r.fail="function"==typeof t&&t,r.domain=Ir?Fr.domain:void 0,this._c.push(r),this._a&&this._a.push(r),this._s&&Vr(this,!1),r.promise},catch:function(e){return this.then(void 0,e)}}),Sr=function(){var e=new Tr;this.promise=e,this.resolve=et(Wr,e,1),this.reject=et(Gr,e,1)},Pr.f=Nr=function(e){return e===kr||e===Rr?new Sr(e):Mr(e)}),tt(tt.G+tt.W+tt.F*!Dr,{Promise:kr}),W(kr,Or),gt(Or),Rr=m[Or],tt(tt.S+tt.F*!Dr,Or,{reject:function(e){var t=Nr(this);return(0,t.reject)(e),t.promise}}),tt(tt.S+tt.F*!Dr,Or,{resolve:function(e){return function(e,t){if(f(e),Ge(t)&&t.constructor===e)return t;var r=Pr.f(e);return(0,r.resolve)(t),r.promise}(this,e)}}),tt(tt.S+tt.F*!(Dr&&Mt(function(e){kr.all(e).catch(jr)})),Or,{all:function(e){var a=this,t=Nr(a),s=t.resolve,l=t.reject,r=Ar(function(){var i=[],n=0,o=1;je(e,!1,function(e){var t=n++,r=!1;i.push(void 0),o++,a.resolve(e).then(function(e){r||(r=!0,i[t]=e,--o||s(i))},l)}),--o||s(i)});return r.e&&l(r.v),t.promise},race:function(e){var t=this,r=Nr(t),i=r.reject,n=Ar(function(){je(e,!1,function(e){t.resolve(e).then(r.resolve,i)})});return n.e&&i(n.v),r.promise}});var Xr,Yr,Qr={f:dt},Jr=Qe.f,Zr=ut.f,Kr={}.toString,$r="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],ei={f:function(e){return $r&&"[object Window]"==Kr.call(e)?function(e){try{return Zr(e)}catch(e){return $r.slice()}}(e):Zr(L(e))}},ti=Ne.KEY,ri=Rt.f,ii=Qe.f,ni=ei.f,oi=qe.Symbol,ai=qe.JSON,si=ai&&ai.stringify,li="prototype",ci=dt("_hidden"),ui=dt("toPrimitive"),hi={}.propertyIsEnumerable,pi=I("symbol-registry"),di=I("symbols"),fi=I("op-symbols"),mi=Object[li],gi="function"==typeof oi,vi=qe.QObject,yi=!vi||!vi[li]||!vi[li].findChild,bi=Xe&&We(function(){return 7!=xt(ii({},"a",{get:function(){return ii(this,"a",{value:7}).a}})).a})?function(e,t,r){var i=ri(mi,t);i&&delete mi[t],ii(e,t,r),i&&e!==mi&&ii(mi,t,i)}:ii,xi=function(e){var t=di[e]=xt(oi[li]);return t._k=e,t},Ei=gi&&"symbol"==typeof oi.iterator?function(e){return"symbol"==typeof e}:function(e){return e instanceof oi},_i=function(e,t,r){return e===mi&&_i(fi,t,r),f(e),t=Ye(t,!0),f(r),Ke(di,t)?(r.enumerable?(Ke(e,ci)&&e[ci][t]&&(e[ci][t]=!1),r=xt(r,{enumerable:Je(0,!1)})):(Ke(e,ci)||ii(e,ci,Je(1,{})),e[ci][t]=!0),bi(e,t,r)):ii(e,t,r)},wi=function(e,t){f(e);for(var r,i=function(e){var t=ae(e),r=Ht.f;if(r)for(var i,n=r(e),o=He.f,a=0;n.length>a;)o.call(e,i=n[a++])&&t.push(i);return t}(t=L(t)),n=0,o=i.length;n<o;)_i(e,r=i[n++],t[r]);return e},Ti=function(e){var t=hi.call(this,e=Ye(e,!0));return!(this===mi&&Ke(di,e)&&!Ke(fi,e))&&(!(t||!Ke(this,e)||!Ke(di,e)||Ke(this,ci)&&this[ci][e])||t)},Mi=function(e,t){if(e=L(e),t=Ye(t,!0),e!==mi||!Ke(di,t)||Ke(fi,t)){var r=ri(e,t);return!r||!Ke(di,t)||Ke(e,ci)&&e[ci][t]||(r.enumerable=!0),r}},Si=function(e){for(var t,r=ni(L(e)),i=[],n=0;r.length>n;)Ke(di,t=r[n++])||t==ci||t==ti||i.push(t);return i},Ri=function(e){for(var t,r=e===mi,i=ni(r?fi:L(e)),n=[],o=0;i.length>o;)!Ke(di,t=i[o++])||r&&!Ke(mi,t)||n.push(di[t]);return n};gi||(_((oi=function(){if(this instanceof oi)throw TypeError("Symbol is not a constructor!");var t=$e(0<arguments.length?arguments[0]:void 0),r=function(e){this===mi&&r.call(fi,e),Ke(this,ci)&&Ke(this[ci],t)&&(this[ci][t]=!1),bi(this,t,Je(1,e))};return Xe&&yi&&bi(mi,t,{configurable:!0,set:r}),xi(t)})[li],"toString",function(){return this._k}),Rt.f=Mi,Qe.f=_i,ut.f=ei.f=Si,He.f=Ti,Ht.f=Ri,Xe&&_(mi,"propertyIsEnumerable",Ti,!0),Qr.f=function(e){return xi(dt(e))}),tt(tt.G+tt.W+tt.F*!gi,{Symbol:oi});for(var Pi="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),Ai=0;Pi.length>Ai;)dt(Pi[Ai++]);for(var Ci=ae(dt.store),Li=0;Ci.length>Li;)Xr=Ci[Li++],void 0,Yr=m.Symbol||(m.Symbol=qe.Symbol||{}),"_"==Xr.charAt(0)||Xr in Yr||Jr(Yr,Xr,{value:Qr.f(Xr)});tt(tt.S+tt.F*!gi,"Symbol",{for:function(e){return Ke(pi,e+="")?pi[e]:pi[e]=oi(e)},keyFor:function(e){if(!Ei(e))throw TypeError(e+" is not a symbol!");for(var t in pi)if(pi[t]===e)return t},useSetter:function(){yi=!0},useSimple:function(){yi=!1}}),tt(tt.S+tt.F*!gi,"Object",{create:function(e,t){return void 0===t?xt(e):wi(xt(e),t)},defineProperty:_i,defineProperties:wi,getOwnPropertyDescriptor:Mi,getOwnPropertyNames:Si,getOwnPropertySymbols:Ri}),ai&&tt(tt.S+tt.F*(!gi||We(function(){var e=oi();return"[null]"!=si([e])||"{}"!=si({a:e})||"{}"!=si(Object(e))})),"JSON",{stringify:function(e){for(var t,r,i=[e],n=1;arguments.length>n;)i.push(arguments[n++]);if(r=t=i[1],(Ge(t)||void 0!==e)&&!Ei(e))return ve(t)||(t=function(e,t){if("function"==typeof r&&(t=r.call(this,e,t)),!Ei(t))return t}),i[1]=t,si.apply(ai,i)}}),oi[li][ui]||Ze(oi[li],ui,oi[li].valueOf),W(oi,"Symbol"),W(Math,"Math",!0),W(qe.JSON,"JSON",!0);var Oi=function(e,t){var r=(m.Object||{})[e]||Object[e],i={};i[e]=t(r),tt(tt.S+tt.F*We(function(){r(1)}),"Object",i)},Hi=Ne.onFreeze;Oi("freeze",function(t){return function(e){return t&&Ge(e)?t(Hi(e)):e}});var Fi=Ne.onFreeze;Oi("seal",function(t){return function(e){return t&&Ge(e)?t(Fi(e)):e}});var ki=Ne.onFreeze;Oi("preventExtensions",function(t){return function(e){return t&&Ge(e)?t(ki(e)):e}}),Oi("isFrozen",function(t){return function(e){return!Ge(e)||!!t&&t(e)}}),Oi("isSealed",function(t){return function(e){return!Ge(e)||!!t&&t(e)}}),Oi("isExtensible",function(t){return function(e){return!!Ge(e)&&(!t||t(e))}});var Ii=Rt.f;Oi("getOwnPropertyDescriptor",function(){return function(e,t){return Ii(L(e),t)}}),Oi("getPrototypeOf",function(){return function(e){return Et(ht(e))}}),Oi("keys",function(){return function(e){return ae(ht(e))}}),Oi("getOwnPropertyNames",function(){return ei.f}),tt(tt.S+tt.F,"Object",{assign:kt});var ji=Object.is||function(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t};tt(tt.S,"Object",{is:ji}),tt(tt.S,"Object",{setPrototypeOf:Ct.set});var Ni=Qe.f,Di=Function.prototype,Ui=/^\s*function ([^ (]*)/;"name"in Di||Xe&&Ni(Di,"name",{configurable:!0,get:function(){try{return(""+this).match(Ui)[1]}catch(e){return""}}}),tt(tt.S,"String",{raw:function(e){for(var t=L(e.raw),r=at(t.length),i=arguments.length,n=[],o=0;o<r;)n.push(String(t[o++])),o<i&&n.push(String(arguments[o]));return n.join("")}});var Vi=String.fromCharCode,Bi=String.fromCodePoint;tt(tt.S+tt.F*(!!Bi&&1!=Bi.length),"String",{fromCodePoint:function(e){for(var t,r=[],i=arguments.length,n=0;n<i;){if(t=+arguments[n++],lt(t,1114111)!==t)throw RangeError(t+" is not a valid code point");r.push(t<65536?Vi(t):Vi(55296+((t-=65536)>>10),t%1024+56320))}return r.join("")}});var zi,qi=(zi=!1,function(e,t){var r,i,n=String(C(e)),o=ot(t),a=n.length;return o<0||a<=o?zi?"":void 0:(r=n.charCodeAt(o))<55296||56319<r||o+1===a||(i=n.charCodeAt(o+1))<56320||57343<i?zi?n.charAt(o):r:zi?n.slice(o,o+2):i-56320+(r-55296<<10)+65536});tt(tt.P,"String",{codePointAt:function(e){return qi(this,e)}});var Gi=function(e){var t=String(C(this)),r="",i=ot(e);if(i<0||i==1/0)throw RangeError("Count can't be negative");for(;0<i;(i>>>=1)&&(t+=t))1&i&&(r+=t);return r};tt(tt.P,"String",{repeat:Gi});var Wi=dt("match"),Xi=function(e){var t;return Ge(e)&&(void 0!==(t=e[Wi])?!!t:"RegExp"==P(e))},Yi=function(e,t,r){if(Xi(t))throw TypeError("String#"+r+" doesn't accept regex!");return String(C(e))},Qi=dt("match"),Ji=function(t){var r=/./;try{"/./"[t](r)}catch(e){try{return r[Qi]=!1,!"/./"[t](r)}catch(e){}}return!0},Zi="startsWith",Ki=""[Zi];tt(tt.P+tt.F*Ji(Zi),"String",{startsWith:function(e){var t=Yi(this,e,Zi),r=at(Math.min(1<arguments.length?arguments[1]:void 0,t.length)),i=String(e);return Ki?Ki.call(t,i,r):t.slice(r,r+i.length)===i}});var $i="endsWith",en=""[$i];tt(tt.P+tt.F*Ji($i),"String",{endsWith:function(e){var t=Yi(this,e,$i),r=1<arguments.length?arguments[1]:void 0,i=at(t.length),n=void 0===r?i:Math.min(at(r),i),o=String(e);return en?en.call(t,o,n):t.slice(n-o.length,n)===o}});tt(tt.P+tt.F*Ji("includes"),"String",{includes:function(e){return!!~Yi(this,e,"includes").indexOf(e,1<arguments.length?arguments[1]:void 0)}});Xe&&"g"!=/./g.flags&&Qe.f(RegExp.prototype,"flags",{configurable:!0,get:function(){var e=f(this),t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.unicode&&(t+="u"),e.sticky&&(t+="y"),t}});var tn=function(t,e,r){var i=dt(t),n=r(C,i,""[t]),o=n[0],a=n[1];We(function(){var e={};return e[i]=function(){return 7},7!=""[t](e)})&&(_(String.prototype,t,o),Ze(RegExp.prototype,i,2==e?function(e,t){return a.call(e,this,t)}:function(e){return a.call(e,this)}))};tn("match",1,function(i,n,e){return[function(e){var t=i(this),r=null==e?void 0:e[n];return void 0!==r?r.call(e,t):new RegExp(e)[n](String(t))},e]}),tn("replace",2,function(n,o,a){return[function(e,t){var r=n(this),i=null==e?void 0:e[o];return void 0!==i?i.call(e,r,t):a.call(String(r),e,t)},a]}),tn("split",2,function(n,o,a){var d=Xi,f=a,m=[].push,e="split",g="length";if("c"=="abbc"[e](/(b)*/)[1]||4!="test"[e](/(?:)/,-1)[g]||2!="ab"[e](/(?:ab)*/)[g]||4!="."[e](/(.?)(.?)/)[g]||1<"."[e](/()()/)[g]||""[e](/.?/)[g]){var v=void 0===/()??/.exec("")[1];a=function(e,t){var r=String(this);if(void 0===e&&0===t)return[];if(!d(e))return f.call(r,e,t);var i,n,o,a,s,l=[],c=(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.unicode?"u":"")+(e.sticky?"y":""),u=0,h=void 0===t?4294967295:t>>>0,p=new RegExp(e.source,c+"g");for(v||(i=new RegExp("^"+p.source+"$(?!\\s)",c));(n=p.exec(r))&&!(u<(o=n.index+n[0][g])&&(l.push(r.slice(u,n.index)),!v&&1<n[g]&&n[0].replace(i,function(){for(s=1;s<arguments[g]-2;s++)void 0===arguments[s]&&(n[s]=void 0)}),1<n[g]&&n.index<r[g]&&m.apply(l,n.slice(1)),a=n[0][g],u=o,l[g]>=h));)p.lastIndex===n.index&&p.lastIndex++;return u===r[g]?!a&&p.test("")||l.push(""):l.push(r.slice(u)),l[g]>h?l.slice(0,h):l}}else"0"[e](void 0,0)[g]&&(a=function(e,t){return void 0===e&&0===t?[]:f.call(this,e,t)});return[function(e,t){var r=n(this),i=null==e?void 0:e[o];return void 0!==i?i.call(e,r,t):a.call(String(r),e,t)},a]}),tn("search",1,function(i,n,e){return[function(e){var t=i(this),r=null==e?void 0:e[n];return void 0!==r?r.call(e,t):new RegExp(e)[n](String(t))},e]});var rn=function(e,t,r){t in e?Qe.f(e,t,Je(0,r)):e[t]=r};tt(tt.S+tt.F*!Mt(function(e){Array.from(e)}),"Array",{from:function(e){var t,r,i,n,o=ht(e),a="function"==typeof this?this:Array,s=arguments.length,l=1<s?arguments[1]:void 0,c=void 0!==l,u=0,h=_t(o);if(c&&(l=et(l,2<s?arguments[2]:void 0,2)),null==h||a==Array&&bt(h))for(r=new a(t=at(o.length));u<t;u++)rn(r,u,c?l(o[u],u):o[u]);else for(n=h.call(o),r=new a;!(i=n.next()).done;u++)rn(r,u,c?Ie(n,l,[i.value,u],!0):i.value);return r.length=u,r}}),tt(tt.S+tt.F*We(function(){function e(){}return!(Array.of.call(e)instanceof e)}),"Array",{of:function(){for(var e=0,t=arguments.length,r=new("function"==typeof this?this:Array)(t);e<t;)rn(r,e,arguments[e++]);return r.length=t,r}}),tt(tt.P,"Array",{copyWithin:St}),_e("copyWithin");var nn=wt(5),on=!0;"find"in[]&&Array(1).find(function(){on=!1}),tt(tt.P+tt.F*on,"Array",{find:function(e){return nn(this,e,1<arguments.length?arguments[1]:void 0)}}),_e("find");var an=wt(6),sn="findIndex",ln=!0;sn in[]&&Array(1)[sn](function(){ln=!1}),tt(tt.P+tt.F*ln,"Array",{findIndex:function(e){return an(this,e,1<arguments.length?arguments[1]:void 0)}}),_e(sn),tt(tt.P,"Array",{fill:pt}),_e("fill");var cn=qe.isFinite;tt(tt.S,"Number",{isFinite:function(e){return"number"==typeof e&&cn(e)}});var un=Math.floor,hn=function(e){return!Ge(e)&&isFinite(e)&&un(e)===e};tt(tt.S,"Number",{isInteger:hn});var pn=Math.abs;tt(tt.S,"Number",{isSafeInteger:function(e){return hn(e)&&pn(e)<=9007199254740991}}),tt(tt.S,"Number",{isNaN:function(e){return e!=e}}),tt(tt.S,"Number",{EPSILON:Math.pow(2,-52)}),tt(tt.S,"Number",{MIN_SAFE_INTEGER:-9007199254740991}),tt(tt.S,"Number",{MAX_SAFE_INTEGER:9007199254740991});var dn=Math.log1p||function(e){return-1e-8<(e=+e)&&e<1e-8?e-e*e/2:Math.log(1+e)},fn=Math.sqrt,mn=Math.acosh;tt(tt.S+tt.F*!(mn&&710==Math.floor(mn(Number.MAX_VALUE))&&mn(1/0)==1/0),"Math",{acosh:function(e){return(e=+e)<1?NaN:94906265.62425156<e?Math.log(e)+Math.LN2:dn(e-1+fn(e-1)*fn(e+1))}});var gn=Math.asinh;tt(tt.S+tt.F*!(gn&&0<1/gn(0)),"Math",{asinh:function e(t){return isFinite(t=+t)&&0!=t?t<0?-e(-t):Math.log(t+Math.sqrt(t*t+1)):t}});var vn=Math.atanh;tt(tt.S+tt.F*!(vn&&1/vn(-0)<0),"Math",{atanh:function(e){return 0==(e=+e)?e:Math.log((1+e)/(1-e))/2}});var yn=Math.sign||function(e){return 0==(e=+e)||e!=e?e:e<0?-1:1};tt(tt.S,"Math",{cbrt:function(e){return yn(e=+e)*Math.pow(Math.abs(e),1/3)}}),tt(tt.S,"Math",{clz32:function(e){return(e>>>=0)?31-Math.floor(Math.log(e+.5)*Math.LOG2E):32}});var bn=Math.exp;tt(tt.S,"Math",{cosh:function(e){return(bn(e=+e)+bn(-e))/2}});var xn=Math.expm1,En=!xn||22025.465794806718<xn(10)||xn(10)<22025.465794806718||-2e-17!=xn(-2e-17)?function(e){return 0==(e=+e)?e:-1e-6<e&&e<1e-6?e+e*e/2:Math.exp(e)-1}:xn;tt(tt.S+tt.F*(En!=Math.expm1),"Math",{expm1:En});var _n=Math.pow,wn=_n(2,-52),Tn=_n(2,-23),Mn=_n(2,127)*(2-Tn),Sn=_n(2,-126),Rn=Math.fround||function(e){var t,r,i=Math.abs(e),n=yn(e);return i<Sn?n*(i/Sn/Tn+1/wn-1/wn)*Sn*Tn:Mn<(r=(t=(1+Tn/wn)*i)-(t-i))||r!=r?n*(1/0):n*r};tt(tt.S,"Math",{fround:Rn});var Pn=Math.abs;tt(tt.S,"Math",{hypot:function(e,t){for(var r,i,n=0,o=0,a=arguments.length,s=0;o<a;)s<(r=Pn(arguments[o++]))?(n=n*(i=s/r)*i+1,s=r):n+=0<r?(i=r/s)*i:r;return s===1/0?1/0:s*Math.sqrt(n)}});var An=Math.imul;tt(tt.S+tt.F*We(function(){return-5!=An(4294967295,5)||2!=An.length}),"Math",{imul:function(e,t){var r=+e,i=+t,n=65535&r,o=65535&i;return 0|n*o+((65535&r>>>16)*o+n*(65535&i>>>16)<<16>>>0)}}),tt(tt.S,"Math",{log1p:dn}),tt(tt.S,"Math",{log10:function(e){return Math.log(e)*Math.LOG10E}}),tt(tt.S,"Math",{log2:function(e){return Math.log(e)/Math.LN2}}),tt(tt.S,"Math",{sign:yn});var Cn=Math.exp;tt(tt.S+tt.F*We(function(){return-2e-17!=!Math.sinh(-2e-17)}),"Math",{sinh:function(e){return Math.abs(e=+e)<1?(En(e)-En(-e))/2:(Cn(e-1)-Cn(-e-1))*(Math.E/2)}});var Ln=Math.exp;tt(tt.S,"Math",{tanh:function(e){var t=En(e=+e),r=En(-e);return t==1/0?1:r==1/0?-1:(t-r)/(Ln(e)+Ln(-e))}}),tt(tt.S,"Math",{trunc:function(e){return(0<e?Math.floor:Math.ceil)(e)}});var On=ct(!0);tt(tt.P,"Array",{includes:function(e){return On(this,e,1<arguments.length?arguments[1]:void 0)}}),_e("includes");var Hn=He.f,Fn=function(s){return function(e){for(var t,r=L(e),i=ae(r),n=i.length,o=0,a=[];o<n;)Hn.call(r,t=i[o++])&&a.push(s?[t,r[t]]:r[t]);return a}},kn=Fn(!1);tt(tt.S,"Object",{values:function(e){return kn(e)}});var In=Fn(!0);tt(tt.S,"Object",{entries:function(e){return In(e)}}),tt(tt.S,"Object",{getOwnPropertyDescriptors:function(e){for(var t,r,i=L(e),n=Rt.f,o=rr(i),a={},s=0;o.length>s;)void 0!==(r=n(i,t=o[s++]))&&rn(a,t,r);return a}});var jn=function(e,t,r,i){var n=String(C(e)),o=n.length,a=void 0===r?" ":String(r),s=at(t);if(s<=o||""==a)return n;var l=s-o,c=Gi.call(a,Math.ceil(l/a.length));return c.length>l&&(c=c.slice(0,l)),i?c+n:n+c},Nn=qe.navigator,Dn=Nn&&Nn.userAgent||"";tt(tt.P+tt.F*/Version\/10\.\d+(\.\d+)? Safari\//.test(Dn),"String",{padStart:function(e){return jn(this,e,1<arguments.length?arguments[1]:void 0,!0)}}),tt(tt.P+tt.F*/Version\/10\.\d+(\.\d+)? Safari\//.test(Dn),"String",{padEnd:function(e){return jn(this,e,1<arguments.length?arguments[1]:void 0,!1)}});var Un=[].slice,Vn=/MSIE .\./.test(Dn),Bn=function(n){return function(e,t){var r=2<arguments.length,i=!!r&&Un.call(arguments,2);return n(r?function(){("function"==typeof e?e:Function(e)).apply(this,i)}:e,t)}};tt(tt.G+tt.B+tt.F*Vn,{setTimeout:Bn(qe.setTimeout),setInterval:Bn(qe.setInterval)}),tt(tt.G+tt.B,{setImmediate:vr.set,clearImmediate:vr.clear});for(var zn=dt("iterator"),qn=dt("toStringTag"),Gn=yt.Array,Wn={CSSRuleList:!0,CSSStyleDeclaration:!1,CSSValueList:!1,ClientRectList:!1,DOMRectList:!1,DOMStringList:!1,DOMTokenList:!0,DataTransferItemList:!1,FileList:!1,HTMLAllCollection:!1,HTMLCollection:!1,HTMLFormElement:!1,HTMLSelectElement:!1,MediaList:!0,MimeTypeArray:!1,NamedNodeMap:!1,NodeList:!0,PaintRequestList:!1,Plugin:!1,PluginArray:!1,SVGLengthList:!1,SVGNumberList:!1,SVGPathSegList:!1,SVGPointList:!1,SVGStringList:!1,SVGTransformList:!1,SourceBufferList:!1,StyleSheetList:!0,TextTrackCueList:!1,TextTrackList:!1,TouchList:!1},Xn=ae(Wn),Yn=0;Yn<Xn.length;Yn++){var Qn,Jn=Xn[Yn],Zn=Wn[Jn],Kn=qe[Jn],$n=Kn&&Kn.prototype;if($n&&($n[zn]||Ze($n,zn,Gn),$n[qn]||Ze($n,qn,Jn),yt[Jn]=Gn,Zn))for(Qn in Tt)$n[Qn]||_($n,Qn,Tt[Qn],!0)}r(function(L){!function(e){var l,t=Object.prototype,c=t.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",i=r.asyncIterator||"@@asyncIterator",o=r.toStringTag||"@@toStringTag",a=e.regeneratorRuntime;if(a)L.exports=a;else{(a=e.regeneratorRuntime=L.exports).wrap=y;var h="suspendedStart",p="suspendedYield",d="executing",f="completed",m={},s={};s[n]=function(){return this};var u=Object.getPrototypeOf,g=u&&u(u(A([])));g&&g!==t&&c.call(g,n)&&(s=g);var v=_.prototype=x.prototype=Object.create(s);E.prototype=v.constructor=_,_.constructor=E,_[o]=E.displayName="GeneratorFunction",a.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===E||"GeneratorFunction"===(t.displayName||t.name))},a.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,_):(e.__proto__=_,o in e||(e[o]="GeneratorFunction")),e.prototype=Object.create(v),e},a.awrap=function(e){return{__await:e}},w(T.prototype),T.prototype[i]=function(){return this},a.AsyncIterator=T,a.async=function(e,t,r,i){var n=new T(y(e,t,r,i));return a.isGeneratorFunction(t)?n:n.next().then(function(e){return e.done?e.value:n.next()})},w(v),v[o]="Generator",v[n]=function(){return this},v.toString=function(){return"[object Generator]"},a.keys=function(r){var i=[];for(var e in r)i.push(e);return i.reverse(),function e(){for(;i.length;){var t=i.pop();if(t in r)return e.value=t,e.done=!1,e}return e.done=!0,e}},a.values=A,P.prototype={constructor:P,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=l,this.done=!1,this.delegate=null,this.method="next",this.arg=l,this.tryEntries.forEach(R),!e)for(var t in this)"t"===t.charAt(0)&&c.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=l)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(r){if(this.done)throw r;var i=this;function e(e,t){return o.type="throw",o.arg=r,i.next=e,t&&(i.method="next",i.arg=l),!!t}for(var t=this.tryEntries.length-1;0<=t;--t){var n=this.tryEntries[t],o=n.completion;if("root"===n.tryLoc)return e("end");if(n.tryLoc<=this.prev){var a=c.call(n,"catchLoc"),s=c.call(n,"finallyLoc");if(a&&s){if(this.prev<n.catchLoc)return e(n.catchLoc,!0);if(this.prev<n.finallyLoc)return e(n.finallyLoc)}else if(a){if(this.prev<n.catchLoc)return e(n.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<n.finallyLoc)return e(n.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;0<=r;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&c.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var n=i;break}}n&&("break"===e||"continue"===e)&&n.tryLoc<=t&&t<=n.finallyLoc&&(n=null);var o=n?n.completion:{};return o.type=e,o.arg=t,n?(this.method="next",this.next=n.finallyLoc,m):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),R(r),m}},catch:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var i=r.completion;if("throw"===i.type){var n=i.arg;R(r)}return n}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:A(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=l),m}}}function y(e,t,r,i){var o,a,s,l,n=t&&t.prototype instanceof x?t:x,c=Object.create(n.prototype),u=new P(i||[]);return c._invoke=(o=e,a=r,s=u,l=h,function(e,t){if(l===d)throw new Error("Generator is already running");if(l===f){if("throw"===e)throw t;return C()}for(s.method=e,s.arg=t;;){var r=s.delegate;if(r){var i=M(r,s);if(i){if(i===m)continue;return i}}if("next"===s.method)s.sent=s._sent=s.arg;else if("throw"===s.method){if(l===h)throw l=f,s.arg;s.dispatchException(s.arg)}else"return"===s.method&&s.abrupt("return",s.arg);l=d;var n=b(o,a,s);if("normal"===n.type){if(l=s.done?f:p,n.arg===m)continue;return{value:n.arg,done:s.done}}"throw"===n.type&&(l=f,s.method="throw",s.arg=n.arg)}}),c}function b(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}function x(){}function E(){}function _(){}function w(e){["next","throw","return"].forEach(function(t){e[t]=function(e){return this._invoke(t,e)}})}function T(s){function l(e,t,r,i){var n=b(s[e],s,t);if("throw"!==n.type){var o=n.arg,a=o.value;return a&&"object"==typeof a&&c.call(a,"__await")?Promise.resolve(a.__await).then(function(e){l("next",e,r,i)},function(e){l("throw",e,r,i)}):Promise.resolve(a).then(function(e){o.value=e,r(o)},i)}i(n.arg)}var t;"object"==typeof e.process&&e.process.domain&&(l=e.process.domain.bind(l)),this._invoke=function(r,i){function e(){return new Promise(function(e,t){l(r,i,e,t)})}return t=t?t.then(e,e):e()}}function M(e,t){var r=e.iterator[t.method];if(r===l){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=l,M(e,t),"throw"===t.method))return m;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return m}var i=b(r,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,m;var n=i.arg;return n?n.done?(t[e.resultName]=n.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=l),t.delegate=null,m):n:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,m)}function S(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function R(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function P(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(S,this),this.reset(!0)}function A(t){if(t){var e=t[n];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,i=function e(){for(;++r<t.length;)if(c.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=l,e.done=!0,e};return i.next=i}}return{next:C}}function C(){return{value:l,done:!0}}}("object"==typeof t?t:"object"==typeof window?window:"object"==typeof self?self:t)});var eo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},to=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},ro=function(){function i(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,r){return t&&i(e.prototype,t),r&&i(e,r),e}}(),io=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},no=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},oo=function(){function e(){to(this,e)}return e.prototype.init=function(){},e.prototype.start=function(){},e.prototype.destroy=function(){},e}(),ao=function(){function r(e){to(this,r),this._plugins=[],this.loader=e,this._instancePlugins()}return r.prototype._instancePlugins=function(){var e=r.pluginsDescription;for(var t in e)this.plugins.push(new e[t](this.loader))},r.prototype.initPlugins=function(){for(var e=0;e<this.plugins.length;e++){this.plugins[e].init()}},ro(r,[{key:"instance",get:function(){return this}},{key:"plugins",get:function(){return this._plugins},set:function(e){this._plugins=e}}]),r}();ao.regist=function(e,t){ao.pluginsDescription[e]=t},ao.pluginsDescription={};var so=function(r){function i(e){to(this,i);var t=no(this,r.call(this));return t.loader=e,t}return io(i,r),i.prototype.init=function(){this.world=this.loader.world,this._initOutdoors(this.world.outdoors);for(var e=0;e<this.world.buildings.length;e++){var t=this.world.buildings[e];this._initSingleBuilding(t)}},i.prototype._initOutdoors=function(e){this._initPlan(e)},i.prototype._initSingleBuilding=function(e){for(var t=0;t<e.floorplans.length;t++){var r=e.floorplans[t];this._initPlan(r)}},i.prototype._initPlan=function(e){var t=this._calAllFloorBox2(e);this._fillUV2ToRooms(e.rooms,t)},i.prototype._calAllFloorBox2=function(e){for(var t=new THREE.Box2,r=0;r<e.rooms.length;r++)for(var i=this._getFloorPosition(e.rooms[r]),n=e.rooms[r].floor.mesh.geometry.vertices,o=0;o<n.length;o++){var a=n[o].clone();a.x+=i.x,a.y+=i.z,t.expandByPoint(a)}return t},i.prototype._fillUV2ToRooms=function(e,t){for(var r=0;r<e.length;r++){var i=e[r],n=this._calFloorUV2(i,t);this._fillUV2ToFloor(i,n)}},i.prototype._calFloorUV2=function(e,t){var r=[],i=new THREE.Vector2;t.getSize(i);for(var n=e.floor.mesh.geometry.vertices,o=this._getFloorPosition(e),a=0;a<n.length;a++){var s=n[a].clone();s.x+=o.x,s.y+=o.z;var l=(s.x-t.min.x)/i.x,c=(s.y-t.min.y)/i.y;r.push(new THREE.Vector2(parseFloat(l.toFixed(2)),parseFloat(c.toFixed(2))))}return r},i.prototype._fillUV2ToFloor=function(e,t){for(var r=e.floor.mesh.geometry,i=r.faces,n=[],o=0;o<i.length;o++){var a=i[o],s=[t[a.a],t[a.b],t[a.c]];n.push(s)}r.faceVertexUvs[1]=n},i.prototype._getFloorPosition=function(e){var t=e.position.clone();return t.z=-t.z,t},i}(oo),lo=function e(){to(this,e),this.positionArray=null,this.normalArray=null,this.uvArray=null,this.colorArray=null,this.uv2Array=null,this.indexArray=null,this.material=null,this.resource=null},co=function e(){to(this,e)};co.wallTexture=null,co.wallEdgeTexture=null,co.floorTexture=null,co.ceilingTexture=null,co.roofTexture=null,co.wallLigthMapTexture=null,co.floorLightMapTexture=null,co.wallMaterial=null,co.wallEdgeMaterial=null,co.floorMaterial=null,co.ceilingMaterial=null,co.roofMaterial=null;var uo=function e(){to(this,e)};uo.StraightManualWallHeight=3,uo.StraightManualWallThick=.15,uo.enableDelayLoadMode=!0,uo.enableManaulWallLightMap=!0,uo.enableFloorLightMap=!0,uo.wallLightMapIntensity=3.8,uo.enableUseHighestVersionResource=!0,uo.enableCombine=!0;var ho=function(){function e(){to(this,e),this.id=null,this.name=null,this.userID=null,this.position=new THREE.Vector3,this.rotation=new THREE.Quaternion(0,0,0,1),this.scale=new THREE.Vector3(1,1,1),this.enableDelayLoadMode=uo.enableDelayLoadMode,this.parent=null,this.properties=null,this.isShow=!0}return ro(e,[{key:"worldPosition",get:function(){if(this.parent){var e=new THREE.Vector3;return e.addVectors(this.parent.worldPosition,this.position),e}return this.position}}]),e}(),po=function(t){function r(){to(this,r);var e=no(this,t.call(this));return e.startCorner=null,e.endCorner=null,e.thick=-1,e.height=-1,e.length=-1,e.pathPoints=[],e.direction=new THREE.Vector3,e.doorOrWindows=[],e.subWalls=[],e.subCorners=[],e.suspend=0,e.mesh=null,e.isShow=!0,e}return io(r,t),r.prototype.baseBuild=function(){this.direction=new THREE.Vector3,this.direction.subVectors(this.endCorner.position,this.startCorner.position),this.length=this.direction.length(),this.direction.normalize(),this.pathPoints.push(this.startCorner.position),this.pathPoints.push(this.endCorner.position),this.position.addVectors(this.endCorner.position,this.startCorner.position),this.position.divideScalar(2)},r.prototype.build=function(){},r.prototype.getWallOtherCorner=function(e){return this.startCorner===e?this.endCorner:this.endCorner===e?this.startCorner:null},r.prototype.sortDoorOrWins=function(){var e=this.startCorner.position,t=this.endCorner.position,r=0<t.x-e.x?1:-1,i=0<t.z-e.z?1:-1,n=!0;Math.abs(t.x-e.x)<.001&&(n=!1);for(var o=[],a=0;a<this.doorOrWindows.length;a++){for(var s=this.doorOrWindows[a],l=0;l<o.length;l++){var c=o[l];if(0<=(n?(c.position.x-s.position.x)*r:(c.position.z-s.position.z)*i)){o.splice(l,0,s);break}if(l==o.length-1){o.push(s);break}}0===o.length&&o.push(s)}return o},r.prototype.getWallCornerByPos=function(e){for(var t=null,r=-1,i=this.subCorners,n=0;n<i.length;n++){var o=e.distanceTo(i[n].position);o<.01&&(null===t?(t=i[n],r=o):o<r&&(r=o,t=i[n]))}return t},r.prototype.getDoorOrWinStartAndEndPos=function(e){var t=e.size,r=this.direction,i=e.position.clone();i.y=0;var n=i.clone(),o=i.clone(),a=t.x/2;return n.subVectors(n,r.clone().multiplyScalar(a)),o.addVectors(o,r.clone().multiplyScalar(a)),[n,o]},r.prototype.addSubWallCorner=function(e){for(var t=0;t<this.subCorners.length;t++){if(this.subCorners[t]===e)return}this.subCorners.push(e)},ro(r,[{key:"worldPosition",get:function(){var e=this.startCorner.worldPosition,t=this.endCorner.worldPosition,r=new THREE.Vector3;return r.addVectors(e,t),r.divideScalar(2),r}}]),r}(ho),fo=function(){function i(){to(this,i)}return i.equalVectorZero=function(e){return 0===e.x&&0===e.y&&0===e.z},i.clone=function(e){var t=e.clone(),r={};e.traverse(function(e){e.isSkinnedMesh&&(r[e.name]=e)});var i={},n={};t.traverse(function(e){e.isBone&&(i[e.name]=e),e.isSkinnedMesh&&(n[e.name]=e)});var o=!1;for(var a in r){o=!0;for(var s=r[a].skeleton,l=n[a],c=[],u=0;u<s.bones.length;++u){var h=i[s.bones[u].name];c.push(h)}l.bind(new THREE.Skeleton(c,s.boneInverses),l.matrixWorld)}return t.hasSkin=!!o,t},i.cloneJSObject=function(e){if(null===e||"object"!==(void 0===e?"undefined":eo(e)))return e;if(e instanceof Date)return(t=new Date).setTime(e.getTime()),t;if(e instanceof Array|e instanceof Object){var t=e instanceof Array?[]:{};for(var r in e)e.hasOwnProperty(r)&&(t[r]=i.cloneJSObject(e[r]));return t}throw new Error("Unable to clone obj! Its type isn't supported.")},i}(),mo=function(t){function r(){to(this,r);var e=no(this,t.call(this));return e.startCorner=null,e.endCorner=null,e.thick=uo.StraightManualWallThick,e.height=uo.StraightManualWallHeight,e.cornersVertices=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3],e.direction=null,e.pathPoints=[],e.selfPathPoints=[],e.upDirection=new THREE.Vector3(0,1,0),e.downDirection=new THREE.Vector3(0,-1,0),e.basePoints=null,e.repeatUV=[],e.uvMultiple=[1,1],e.rightSideLength=null,e.leftSideLength=null,e.floorPlanHeight=3,e.rightSideMeshInfo=new lo,e.leftSideMeshInfo=new lo,e.edgeSideMeshInfo=new lo,e.defaultWallTexture=null,e.rightWallTexture=null,e.leftWallTexture=null,e.startUVPercent=[0,0,0,0],e.endUVPercent=[1,1,1,1],e.wallGroup=null,e.leftResource=null,e.rightResource=null,e.edgeResource=null,e.lightMapResource=null,e.isBuilded=!1,e.vectorUp=new THREE.Vector3(0,1,0),e.onlyBuildMeshInfo=!1,e.enableLightMap=uo.enableManaulWallLightMap,e.aoMapIntensity=uo.wallLightMapIntensity,e}return io(r,t),r.prototype.leftResourceCallback=function(e){},r.prototype.rightResourceCallback=function(e){this.rigthWallTexture=e,this.isBuilded&&(this.wallGroup[0].material.texture=this.rigthWallTexture)},r.prototype.resourceCallback=function(e){e===this.leftResource?(this.leftWallTexture=e.texture,this.initLightMap(),this.isBuilded&&this.wallGroup&&(this.enableLightMap?this.wallGroup.children[0].material=this.leftResource.wallLightMaterial:this.wallGroup.children[0].material=this.leftResource.material,this.wallGroup.children[0].material.needsUpdate=!0)):e===this.rightResource&&(this.rigthWallTexture=e.texture,this.initLightMap(),this.isBuilded&&this.wallGroup&&(this.enableLightMap?this.wallGroup.children[1].material=this.leftResource.wallLightMaterial:this.wallGroup.children[1].material=this.leftResource.material))},r.prototype.initMaterial=function(){this.leftResource?this.leftResource.ready?this.leftWallTexture=this.leftResource.texture:this.leftResource.callbackObjects.push(this):this.leftWallTexture||(this.leftWallTexture=co.wallTexture),this.rightResource?this.rightResource.ready?this.rightWallTexture=this.rightResource.texture:this.rightResource.callbackObjects.push(this):this.rightWallTexture||(this.rightWallTexture=co.wallTexture),this.leftResource?(this.leftSideMeshInfo.resource=this.leftResource,this.leftSideMeshInfo.material=this.leftResource.material):this.leftSideMeshInfo.material=new THREE.MeshStandardMaterial({map:null}),this.rightResource?(this.rightSideMeshInfo.resource=this.rightResource,this.rightSideMeshInfo.material=this.rightResource.material):this.rightSideMeshInfo.material=new THREE.MeshStandardMaterial({map:null}),this.edgeResource?(this.edgeSideMeshInfo.resource=this.edgeResource,this.edgeSideMeshInfo.material=this.edgeResource.material):this.edgeSideMeshInfo.material=new THREE.MeshStandardMaterial({map:null}),this.initLightMap()},r.prototype.initLightMap=function(){this.lightMapResource&&this.enableLightMap&&(this.rightResource.ready&&(void 0===this.rightResource.wallLightMaterial&&(this.rightResource.wallLightMaterial=this.rightResource.wallMaterial.clone()),this.rightSideMeshInfo.material=this.rightResource.wallLightMaterial,this.rightSideMeshInfo.material.aoMap=this.lightMapResource.texture,this.rightSideMeshInfo.material.defines.WALL_AO=!0,this.rightSideMeshInfo.material.metalness=.2,this.rightSideMeshInfo.material.roughness=.8),this.leftResource.ready&&(void 0===this.leftResource.wallLightMaterial&&(this.leftResource.wallLightMaterial=this.leftResource.wallMaterial.clone()),this.leftSideMeshInfo.material=this.leftResource.wallLightMaterial,this.leftSideMeshInfo.material.metalness=0,this.leftSideMeshInfo.material.roughness=1))},r.prototype.build=function(){if(this.baseBuild(),this.calPosInfo(),this.calEachSideLen(),this.calRepeatUV(),this.calBasePoints(),this.fillMesh(),this.initMaterial(),!this.onlyBuildMeshInfo){var e=this.position,t=new THREE.Group("wall");t.add(this.createMesh(this.leftSideMeshInfo)),t.add(this.createMesh(this.rightSideMeshInfo)),t.add(this.createMesh(this.edgeSideMeshInfo)),t.position.set(e.x,e.y,e.z),this.wallGroup=t,this.mesh=this.wallGroup}this.isBuilded=!0},r.prototype.baseBuild=function(){this.direction=new THREE.Vector3,this.direction.subVectors(this.endCorner.position,this.startCorner.position),this.direction.normalize(),this.pathPoints.push(this.startCorner.position),this.pathPoints.push(this.endCorner.position)},r.prototype.calEachSideLen=function(){var e=new THREE.Vector3;e.subVectors(this.endCorner.position,this.startCorner.position),e.normalize();var t=this.thick/2,r=new THREE.Vector3;r.crossVectors(this.downDirection,e),r.normalize();var i=r.clone();i.negate();var n=r.clone();n.multiplyScalar(t);var o=i.clone();o.multiplyScalar(t);var a=new THREE.Vector3,s=new THREE.Vector3,l=new THREE.Vector3,c=new THREE.Vector3;fo.equalVectorZero(this.cornersVertices[0])?a.addVectors(this.selfPathPoints[0],n):a.copy(this.cornersVertices[0]),fo.equalVectorZero(this.cornersVertices[3])?s.addVectors(this.selfPathPoints[1],n):s.copy(this.cornersVertices[3]),fo.equalVectorZero(this.cornersVertices[1])?l.addVectors(this.selfPathPoints[0],o):l.copy(this.cornersVertices[1]),fo.equalVectorZero(this.cornersVertices[2])?c.addVectors(this.selfPathPoints[1],o):c.copy(this.cornersVertices[2]),this.rightSideLength=new THREE.Vector3,this.leftSideLength=new THREE.Vector3,this.rightSideLength.subVectors(a,s),this.leftSideLength.subVectors(l,c),this.rightSideLength=this.rightSideLength.length(),this.leftSideLength=this.leftSideLength.length()},r.prototype.calRepeatUV=function(){this.repeatUV[0]=this.uvMultiple[0]*this.rightSideLength/this.floorPlanHeight,this.repeatUV[1]=this.uvMultiple[1]*this.height/this.floorPlanHeight,this.repeatUV[2]=this.uvMultiple[0]*this.leftSideLength/this.floorPlanHeight,this.repeatUV[3]=this.uvMultiple[1]*this.height/this.floorPlanHeight},r.prototype.calPosInfo=function(){var e=new THREE.Vector3;this.selfPathPoints.push(e.subVectors(this.startCorner.position,this.position)),e=new THREE.Vector3,this.selfPathPoints.push(e.subVectors(this.endCorner.position,this.position)),this.selfPathPoints[0].y=0,this.selfPathPoints[1].y=0},r.prototype.calBasePoints=function(){if(null===this.basePoints){this.basePoints=[];for(var e=0;e<12;e++)this.basePoints.push(new THREE.Vector3)}var t=this.thick/2,r=new THREE.Vector3;r.crossVectors(this.downDirection,this.direction),r.normalize();var i=r.clone();i.negate();var n=r.multiplyScalar(t);fo.equalVectorZero(this.cornersVertices[0])?(this.basePoints[4].x=this.selfPathPoints[0].x+n.x,this.basePoints[4].y=0,this.basePoints[4].z=this.selfPathPoints[0].z+n.z):(this.basePoints[4].x=this.cornersVertices[0].x,this.basePoints[4].y=0,this.basePoints[4].z=this.cornersVertices[0].z),fo.equalVectorZero(this.cornersVertices[1])?(n=i.multiplyScalar(t),this.basePoints[5].x=this.selfPathPoints[0].x+n.x,this.basePoints[5].y=0,this.basePoints[5].z=this.selfPathPoints[0].z+n.z):(this.basePoints[5].x=this.cornersVertices[1].x,this.basePoints[5].y=0,this.basePoints[5].z=this.cornersVertices[1].z);var o=this.direction.clone();r.crossVectors(this.downDirection,o.negate()),r.normalize(),(i=r.clone()).negate(),fo.equalVectorZero(this.cornersVertices[2])?((n=r.clone()).multiplyScalar(t),this.basePoints[6].x=this.selfPathPoints[1].x+n.x,this.basePoints[6].y=0,this.basePoints[6].z=this.selfPathPoints[1].z+n.z):(this.basePoints[6].x=this.cornersVertices[2].x,this.basePoints[6].y=0,this.basePoints[6].z=this.cornersVertices[2].z),fo.equalVectorZero(this.cornersVertices[3])?((n=i.clone()).multiplyScalar(t),this.basePoints[7].x=this.selfPathPoints[1].x+n.x,this.basePoints[7].y=0,this.basePoints[7].z=this.selfPathPoints[1].z+n.z):(this.basePoints[7].x=this.cornersVertices[3].x,this.basePoints[7].y=0,this.basePoints[7].z=this.cornersVertices[3].z),this.basePoints[0].x=this.basePoints[4].x,this.basePoints[0].y=this.basePoints[4].y+this.height,this.basePoints[0].z=this.basePoints[4].z,this.basePoints[1].x=this.basePoints[5].x,this.basePoints[1].y=this.basePoints[5].y+this.height,this.basePoints[1].z=this.basePoints[5].z,this.basePoints[2].x=this.basePoints[6].x,this.basePoints[2].y=this.basePoints[6].y+this.height,this.basePoints[2].z=this.basePoints[6].z,this.basePoints[3].x=this.basePoints[7].x,this.basePoints[3].y=this.basePoints[7].y+this.height,this.basePoints[3].z=this.basePoints[7].z,this.basePoints[8].x=this.selfPathPoints[0].x,this.basePoints[8].y=this.selfPathPoints[0].y+this.height,this.basePoints[8].z=this.selfPathPoints[0].z,this.basePoints[9].x=this.selfPathPoints[1].x,this.basePoints[9].y=this.selfPathPoints[1].y+this.height,this.basePoints[9].z=this.selfPathPoints[1].z},r.prototype.fillMesh=function(){this.leftSideMeshInfo.positionArray=new Float32Array(18),this.leftSideMeshInfo.normalArray=new Float32Array(18),this.leftSideMeshInfo.uvArray=new Float32Array(12),this.leftSideMeshInfo.indexArray=new Float32Array(6),this.rightSideMeshInfo.positionArray=new Float32Array(18),this.rightSideMeshInfo.normalArray=new Float32Array(18),this.rightSideMeshInfo.uvArray=new Float32Array(12),this.rightSideMeshInfo.indexArray=new Float32Array(6),this.edgeSideMeshInfo.positionArray=new Float32Array(72),this.edgeSideMeshInfo.normalArray=new Float32Array(72),this.edgeSideMeshInfo.uvArray=new Float32Array(48),this.edgeSideMeshInfo.indexArray=new Float32Array(24),this.lightMapResource&&(this.leftSideMeshInfo.uv2Array=new Float32Array(12),this.rightSideMeshInfo.uv2Array=new Float32Array(12),this.leftSideMeshInfo.uv2Array=new Float32Array(12));for(var e=0;e<6;e++)this.leftSideMeshInfo.indexArray[e]=e,this.rightSideMeshInfo.indexArray[e]=e;for(e=0;e<24;e++)this.edgeSideMeshInfo.indexArray[e]=e;var t=this.basePoints,r=0,i=new THREE.Vector3;i.crossVectors(this.downDirection,this.direction),i.normalize();var n=new THREE.Vector3;n.crossVectors(this.direction,this.downDirection),n.normalize();var o=this.direction,a=o.clone();a.negate();var s=[];s[r++]=t[0],s[r++]=t[7],s[r++]=t[3],s[r++]=t[0],s[r++]=t[4],s[r++]=t[7],s[r++]=t[2],s[r++]=t[5],s[r++]=t[1],s[r++]=t[2],s[r++]=t[6],s[r++]=t[5],s[r++]=t[0],s[r++]=t[2],s[r++]=t[1],s[r++]=t[0],s[r++]=t[3],s[r++]=t[2],0!==this.suspend&&(s[r++]=t[4],s[r++]=t[5],s[r++]=t[6],s[r++]=t[4],s[r++]=t[6],s[r++]=t[7]),s[r++]=t[1],s[r++]=t[4],s[r++]=t[0],s[r++]=t[1],s[r++]=t[5],s[r++]=t[4],s[r++]=t[3],s[r++]=t[7],s[r++]=t[2],s[r++]=t[2],s[r++]=t[7],s[r++]=t[6],s[r++]=t[1],s[r++]=t[8],s[r++]=t[0],s[r++]=t[3],s[r++]=t[9],s[r++]=t[2],r=0;var l=[];l[r++]=i,l[r++]=i,l[r++]=i,l[r++]=i,l[r++]=i,l[r++]=i;for(e=0;e<l.length;e++){var c=l[e],u=3*e;this.rightSideMeshInfo.normalArray[u]=c.x,this.rightSideMeshInfo.normalArray[u+1]=c.y,this.rightSideMeshInfo.normalArray[u+2]=c.z}l[r++]=n,l[r++]=n,l[r++]=n,l[r++]=n,l[r++]=n,l[r++]=n;e=6;for(var h=0;e<l.length;e++,h++){c=l[e],u=3*h;this.leftSideMeshInfo.normalArray[u]=c.x,this.leftSideMeshInfo.normalArray[u+1]=c.y,this.leftSideMeshInfo.normalArray[u+2]=c.z}l[r++]=this.upDirection,l[r++]=this.upDirection,l[r++]=this.upDirection,l[r++]=this.upDirection,l[r++]=this.upDirection,l[r++]=this.upDirection,0!==this.suspend&&(l[r++]=this.downDirection,l[r++]=this.downDirection,l[r++]=this.downDirection,l[r++]=this.downDirection,l[r++]=this.downDirection,l[r++]=this.downDirection),l[r++]=a,l[r++]=a,l[r++]=a,l[r++]=a,l[r++]=a,l[r++]=a,l[r++]=o,l[r++]=o,l[r++]=o,l[r++]=o,l[r++]=o,l[r++]=o,l[r++]=this.upDirection,l[r++]=this.upDirection,l[r++]=this.upDirection,l[r++]=this.upDirection,l[r++]=this.upDirection,l[r++]=this.upDirection;for(e=0;e<6;e++){c=s[e],u=3*e;this.rightSideMeshInfo.positionArray[u]=c.x,this.rightSideMeshInfo.positionArray[u+1]=c.y+this.suspend,this.rightSideMeshInfo.positionArray[u+2]=c.z}for(e=6,h=0;e<12;e++,h++){c=s[e],u=3*h;this.leftSideMeshInfo.positionArray[u]=c.x,this.leftSideMeshInfo.positionArray[u+1]=c.y+this.suspend,this.leftSideMeshInfo.positionArray[u+2]=c.z}for(e=12,h=0;e<s.length;e++,h++){c=s[e],u=3*h;this.edgeSideMeshInfo.positionArray[u]=c.x,this.edgeSideMeshInfo.positionArray[u+1]=c.y+this.suspend,this.edgeSideMeshInfo.positionArray[u+2]=c.z}for(e=12,h=0;e<l.length;e++,h++){c=l[e],u=3*h;this.edgeSideMeshInfo.normalArray[u]=c.x,this.edgeSideMeshInfo.normalArray[u+1]=c.y,this.edgeSideMeshInfo.normalArray[u+2]=c.z}this.fillUV()},r.prototype.fillUV=function(){var e,t,r,i,n,o=0;i=this.rightResource.isDefault?(e=this.startUVPercent[0],t=this.startUVPercent[1],r=this.endUVPercent[0],this.endUVPercent[1]):(e=this.startUVPercent[0]*this.repeatUV[0],t=this.startUVPercent[1]*this.repeatUV[1],r=this.endUVPercent[0]*this.repeatUV[0],this.endUVPercent[1]*this.repeatUV[1]),(n=this.rightSideMeshInfo.uvArray)[o++]=e,n[o++]=i,n[o++]=r,n[o++]=t,n[o++]=r,n[o++]=i,n[o++]=e,n[o++]=i,n[o++]=e,n[o++]=t,n[o++]=r,n[o++]=t,i=this.leftResource.isDefault?(e=this.startUVPercent[2],t=this.startUVPercent[3],r=this.endUVPercent[2],this.endUVPercent[3]):(e=this.startUVPercent[2]*this.repeatUV[2],t=this.startUVPercent[3]*this.repeatUV[3],r=this.endUVPercent[2]*this.repeatUV[2],this.endUVPercent[3]*this.repeatUV[3]),o=0,(n=this.leftSideMeshInfo.uvArray)[o++]=r,n[o++]=i,n[o++]=e,n[o++]=t,n[o++]=e,n[o++]=i,n[o++]=r,n[o++]=i,n[o++]=r,n[o++]=t,n[o++]=e,n[o++]=t,o=0,(n=this.edgeSideMeshInfo.uvArray)[o++]=0,n[o++]=1,n[o++]=1,n[o++]=0,n[o++]=1,n[o++]=1,n[o++]=0,n[o++]=1,n[o++]=0,n[o++]=0,n[o++]=1,n[o++]=0,n[o++]=0,n[o++]=1,n[o++]=1,n[o++]=0,n[o++]=1,n[o++]=1,n[o++]=0,n[o++]=1,n[o++]=0,n[o++]=0,n[o++]=1,n[o++]=0,n[o++]=0,n[o++]=1,n[o++]=0,n[o++]=0,n[o++]=1,n[o++]=1,n[o++]=0,n[o++]=0,n[o++]=1,n[o++]=1,n[o++]=1,n[o++]=0,n[o++]=0,n[o++]=1,n[o++]=0,n[o++]=0,n[o++]=1,n[o++]=1,n[o++]=0,n[o++]=1,n[o++]=0,n[o++]=0,n[o++]=1,n[o++]=1,this.lightMapResource&&(e=this.startUVPercent[0],t=this.startUVPercent[1],r=this.endUVPercent[0],i=this.endUVPercent[1],o=0,(n=this.rightSideMeshInfo.uv2Array)[o++]=e,n[o++]=i,n[o++]=r,n[o++]=t,n[o++]=r,n[o++]=i,n[o++]=e,n[o++]=i,n[o++]=e,n[o++]=t,n[o++]=r,n[o++]=t,o=0,(n=this.leftSideMeshInfo.uv2Array)[o++]=r,n[o++]=i,n[o++]=e,n[o++]=t,n[o++]=e,n[o++]=i,n[o++]=r,n[o++]=i,n[o++]=r,n[o++]=t,n[o++]=e,n[o++]=t)},r.prototype.getWallOtherCorner=function(e){return this.startCorner===e?this.endCorner:this.endCorner===e?this.startCorner:null},r.prototype.createMesh=function(e){var t=new THREE.BufferGeometry;t.addAttribute("position",new THREE.BufferAttribute(e.positionArray,3)),t.addAttribute("normal",new THREE.BufferAttribute(e.normalArray,3)),t.addAttribute("uv",new THREE.BufferAttribute(e.uvArray,2));var r=e.material;return this.lightMapResource&&e.uv2Array&&this.enableLightMap&&t.addAttribute("uv2",new THREE.BufferAttribute(e.uv2Array,2)),e.material=r,new THREE.Mesh(t,r)},ro(r,[{key:"position",get:function(){var e=this.startCorner.position,t=this.endCorner.position,r=new THREE.Vector3;return r.addVectors(e,t),r.divideScalar(2),r},set:function(e){}}]),r}(po),go=function(e){function t(){return to(this,t),no(this,e.call(this))}return io(t,e),t.prototype.build=function(){if(this.baseBuild(),this.calPosInfo(),this.calBasePoints(),this.fillMesh(),this.initMaterial(),!this.enableDelayLoadMode){var e=this.position,t=new THREE.Group("wall");t.add(this.createMesh(this.leftSideMeshInfo)),t.add(this.createMesh(this.rightSideMeshInfo)),t.add(this.createMesh(this.edgeSideMeshInfo)),t.position.set(e.x,e.y,e.z),this.wallGroup=t,this.mesh=this.wallGroup}this.isBuilded=!0},t}(mo),vo=function(n){function o(e,t,r){to(this,o);var i=no(this,n.call(this));return i.walls=[],i.position=new THREE.Vector3(e,t,r),i}return io(o,n),o.prototype.addWall=function(e){for(var t=0,r=this.walls.length;t<r;t++)if(this.walls[t]===e)return void console.error("repeat wall"+e);this.walls.push(e)},o.prototype.build=function(){var e=this.getSameHeightWalls();for(var t in e)this.calWallsVertices(e[t])},o.prototype.isFirstWallShouldNotCal=function(e){return!(e instanceof bo)||e instanceof go},o.prototype.isSecondWallShouldNotCal=function(e){return null!=e&&(e.resource&&e.resource.isModel||e instanceof go)},o.prototype.getSameHeightWalls=function(){for(var e={},t=0;t<this.walls.length;t++){var r=this.walls[t];this.isStraightManualWall(r)&&(void 0===e[r.height]&&(e[r.height]=[]),e[r.height].push(r))}return e},o.prototype.isStraightManualWall=function(e){return e instanceof bo},o.prototype.calWallsVertices=function(e){var t=new THREE.Vector3(0,-1,0);if(1===e.length){var r=e[0];r instanceof bo&&this.setDefaultCornerVertices(r)}else{this.sortWalls(e);for(var i=0;i<e.length;i++){var n=e[i];if(!this.isFirstWallShouldNotCal(n)){for(var o=null,a=i;null==o&&(a===e.length-1?a=0:a+=1,e[a]!==n);)o=e[a],this.isSecondWallShouldNotCal(o)&&(o=null);if(o){var s=n.getWallOtherCorner(this).position,l=new THREE.Vector3;l.subVectors(s,this.position),s=o.getWallOtherCorner(this).position;var c=new THREE.Vector3;if(c.subVectors(s,this.position),l.normalize(),c.normalize(),0!==l.length()&&0!==c.length()){var u=n.thick/2,h=new THREE.Vector3;h.crossVectors(t,l),h.normalize();var p=h.clone();p.multiplyScalar(u),p.add(this.position),u=o.thick/2;var d=c.clone();d.cross(t),d.normalize();var f=d.clone();if(f.multiplyScalar(u),f.add(this.position),this.setCornersVertices(n,p,!0),this.setCornersVertices(o,f,!1),l.normalize(),c.normalize(),30<this.calAngle(l,c)){var m;if(1===Math.abs(l.dot(c))){var g=l.clone();g.cross(t),g.normalize(),this.setDefaultCornerVertices(n,!0),this.setDefaultCornerVertices(o,!0);continue}if(0!==(m=this.getIntersectPosition(p,l,f,c)).x||0!==m.y||0!==m.z)m.clone().y=this.position.y+this.getWallHeight(),this.setCornersVertices(n,m,!0),this.setCornersVertices(o,m,!1)}else this.setCornersVertices(n,p,!0),this.setCornersVertices(o,f,!1)}else this.setDefaultCornerVertices(n,!0),this.setDefaultCornerVertices(o,!1)}else this.setDefaultCornerVertices(n)}}}},o.prototype.sortWalls=function(e){if(1<e.length)for(var t,r,i=e[0],n=0,o=e.length-1;n<o;){for(r=n;r<o;++r)this.angleBetween(i,e[r])>this.angleBetween(i,e[r+1])&&(t=e[r],e[r]=e[r+1],e[r+1]=t);for(r=--o;n<r;--r)this.angleBetween(i,e[r])<this.angleBetween(i,e[r-1])&&(t=e[r],e[r]=e[r-1],e[r-1]=t);++n}},o.prototype.angleBetween=function(e,t){var r=e.getWallOtherCorner(this).position.clone();r.sub(this.position);var i=t.getWallOtherCorner(this).position.clone();return i.sub(this.position),this.calAngle(r,i)},o.prototype.calAngle=function(e,t){e.normalize(),t.normalize();var r=e.angleTo(t);r*=180/Math.PI;var i=e.clone();return i.cross(t),0<i.y&&(r=360-r),r},o.prototype.getWallHeight=function(){for(var e=99999,t=0;t<this.walls.length;t++){var r=this.walls[t];e>r.height&&(e=r.height)}return e},o.prototype.setCornersVertices=function(e,t,r){var i=new THREE.Vector3(0,0,0);i.x=t.x-e.position.x,i.y=t.y-e.position.y,i.z=t.z-e.position.z,e.startCorner===this?r?(e.cornersVertices[0].x=i.x,e.cornersVertices[0].y=i.y,e.cornersVertices[0].z=i.z):(e.cornersVertices[1].x=i.x,e.cornersVertices[1].y=i.y,e.cornersVertices[1].z=i.z):r?(e.cornersVertices[2].x=i.x,e.cornersVertices[2].y=i.y,e.cornersVertices[2].z=i.z):(e.cornersVertices[3].x=i.x,e.cornersVertices[3].y=i.y,e.cornersVertices[3].z=i.z)},o.prototype.setDefaultCornerVertices=function(e,t){var r=new THREE.Vector3(0,-1,0),i=e.getWallOtherCorner(this).position.clone();i.sub(this.position),i.normalize();var n=e.thick/2,o=r.clone();o.cross(i),o.normalize(),o.multiplyScalar(n);var a=new THREE.Vector3;a.addVectors(this.position,o);var s=new THREE.Vector3;s.subVectors(this.position,o),void 0===t?(this.setCornersVertices(e,a,!0),this.setCornersVertices(e,s,!1)):t?this.setCornersVertices(e,a,!0):this.setCornersVertices(e,s,!1)},o.prototype.getIntersectPosition=function(e,t,r,i){if(e.x===r.x&&e.y===r.y&&e.z===r.z)return e;var n=e.y;if(1===t.dot(i))throw"two line in same direction ,can not cal intersected position!";var o=new THREE.Vector3,a=new THREE.Vector3;o.addVectors(e,t),a.addVectors(r,i);var s=new THREE.Vector2(e.x,e.z),l=new THREE.Vector2(o.x,o.z),c=new THREE.Vector2(r.x,r.z),u=new THREE.Vector2(a.x,a.z),h=(l.y-s.y)*(u.x-c.x)-(s.x-l.x)*(c.y-u.y);if(0==h)return new THREE.Vector3;var p=((l.x-s.x)*(u.x-c.x)*(c.y-s.y)+(l.y-s.y)*(u.x-c.x)*s.x-(u.y-c.y)*(l.x-s.x)*c.x)/h,d=-((l.y-s.y)*(u.y-c.y)*(c.x-s.x)+(l.x-s.x)*(u.y-c.y)*s.y-(u.x-c.x)*(l.y-s.y)*c.y)/h;return new THREE.Vector3(p,n,d)},o}(ho),yo=function(e){function n(){return to(this,n),no(this,e.call(this))}return io(n,e),n.createSubWallCorner=function(e,t,r){var i=new n;return i.id=e,i.position=t,i.parent=r.parent,i},n.prototype.isFirstWallShouldNotCal=function(e){return!(e instanceof go)},n.prototype.isSecondWallShouldNotCal=function(e){return e&&!(e instanceof go)},n}(vo),bo=function(e){function t(){return to(this,t),no(this,e.call(this))}return io(t,e),t.prototype.initSimpleCornersAndWalls=function(){var e=this.position;(new THREE.Vector3).crossVectors(this.direction,this.vectorUp);for(var t=this.sortDoorOrWins(),r=0;r<t.length;r++){var i=t[r],n=this.getDoorOrWinStartAndEndPos(i),o=this.getDoorOrWinRectPoints(i),a=yo.createSubWallCorner(this.id+"_"+r+"_1",n[0],this),s=yo.createSubWallCorner(this.id+"_"+r+"_2",n[1],this);if(this.addSubWallCorner(a),this.addSubWallCorner(s),0===r){var l=new go;this.subWalls.push(l),l.startCorner=this.startCorner,l.endCorner=a,l.startCorner.build(),l.endCorner.build(),this.setCornerVertices(l,!0),l.calPosInfo(),l.calEachSideLen(),l.endUVPercent[0]=l.rightSideLength/this.rightSideLength,l.endUVPercent[2]=l.leftSideLength/this.leftSideLength,l.repeatUV=this.repeatUV,l.leftResource=this.leftResource,l.rightResource=this.rightResource,l.edgeResource=this.edgeResource,l.lightMapResource=this.lightMapResource,l.height=this.height,l.thick=this.thick,l.parentWall=this}else{var c=t[r-1],u=this.getDoorOrWinStartAndEndPos(c),h=this.getDoorOrWinRectPoints(c),p=this.getWallCornerByPos(u[1]),d=new go;this.subWalls.push(d),d.startCorner=p,d.endCorner=a;var f=new THREE.Vector3;f.subVectors(p.position,a.position);var m=f.length();d.startCorner.build(),d.endCorner.build(),d.calPosInfo(),d.calEachSideLen();var g=h[3].distanceTo(e.clone().addVectors(this.cornersVertices[0],e)),v=h[2].distanceTo(e.clone().addVectors(this.cornersVertices[1],e));d.startUVPercent[0]=g/this.rightSideLength,d.startUVPercent[2]=v/this.leftSideLength,d.endUVPercent[0]=(g+m)/this.rightSideLength,d.endUVPercent[2]=(v+m)/this.leftSideLength,d.repeatUV=this.repeatUV,d.leftResource=this.leftResource,d.rightResource=this.rightResource,d.edgeResource=this.edgeResource,d.lightMapResource=this.lightMapResource,d.height=this.height,d.thick=this.thick,d.parentWall=this}if(r==t.length-1){var y=new go;this.subWalls.push(y),y.startCorner=s,y.endCorner=this.endCorner,y.startCorner.build(),this.setCornerVertices(y,!1),y.calPosInfo(),y.calEachSideLen();g=o[3].distanceTo(e.clone().addVectors(this.cornersVertices[0],e)),v=o[2].distanceTo(e.clone().addVectors(this.cornersVertices[1],e));y.startUVPercent[0]=g/this.rightSideLength,y.startUVPercent[2]=v/this.leftSideLength,y.repeatUV=this.repeatUV,y.leftResource=this.leftResource,y.rightResource=this.rightResource,y.edgeResource=this.edgeResource,y.lightMapResource=this.lightMapResource,y.height=this.height,y.thick=this.thick,y.parentWall=this}this.buildHeadAndFootWall(i,a,s)}},t.prototype.buildSimpleCornersAndWalls=function(){this.enableDelayLoadMode||(this.wallGroup=new THREE.Object3D);for(var e=0;e<this.subCorners.length;e++){this.subCorners[e].build()}for(e=0;e<this.subWalls.length;e++){var t=this.subWalls[e];t.build(),this.enableDelayLoadMode||this.wallGroup.add(t.wallGroup)}this.mesh=this.wallGroup},t.prototype.buildHeadAndFootWall=function(e,t,r){var i=this.position,n=this.getDoorOrWinRectPoints(e),o=n[0].distanceTo(i.clone().addVectors(this.cornersVertices[0],i)),a=n[1].distanceTo(i.clone().addVectors(this.cornersVertices[1],i)),s=e.suspendPercent;(new THREE.Vector3).crossVectors(this.direction,this.vectorUp);var l=e.size.y+this.height*s;if(0!==e.suspendPercent){var c=new go;this.subWalls.push(c),c.parent=this.parent,c.startCorner=t,c.endCorner=r,(h=new THREE.Vector3).subVectors(r.position,t.position);var u=h.length();c.height=this.height*s,c.thick=this.thick,c.startUVPercent=[o/this.rightSideLength,0,a/this.leftSideLength,0],c.endUVPercent[0]=(o+u)/this.rightSideLength,c.endUVPercent[1]=c.height/this.height,c.endUVPercent[2]=(a+u)/this.leftSideLength,c.endUVPercent[3]=c.height/this.height,c.uvMultiple=this.uvMultiple,c.repeatUV=this.repeatUV,c.leftResource=this.leftResource,c.rightResource=this.rightResource,c.edgeResource=this.edgeResource,c.lightMapResource=this.lightMapResource,c.parentWall=this}if(l<this.height){var h,p=new go;this.subWalls.push(p),p.parent=this.parent,p.startCorner=t,p.endCorner=r,(h=new THREE.Vector3).subVectors(r.position,t.position);u=h.length();p.suspend=l,p.height=this.height-l,p.thick=this.thick,p.startUVPercent=[o/this.rightSideLength,l/this.height,a/this.leftSideLength,l/this.height],p.endUVPercent[0]=(o+u)/this.rightSideLength,p.endUVPercent[2]=(a+u)/this.leftSideLength,p.uvMultiple=this.uvMultiple,p.repeatUV=this.repeatUV,p.leftResource=this.leftResource,p.rightResource=this.rightResource,p.edgeResource=this.edgeResource,p.lightMapResource=this.lightMapResource,p.parentWall=this}},t.prototype.setCornerVertices=function(e,t){var r,i;t?((r=new THREE.Vector3).addVectors(this.cornersVertices[0],this.position),r.sub(e.position),(i=new THREE.Vector3).addVectors(this.cornersVertices[1],this.position),i.sub(e.position),e.cornersVertices[0]=r,e.cornersVertices[1]=i):((r=new THREE.Vector3).addVectors(this.cornersVertices[2],this.position),r.sub(e.position),(i=new THREE.Vector3).addVectors(this.cornersVertices[3],this.position),i.sub(e.position),e.cornersVertices[2]=r,e.cornersVertices[3]=i)},t.prototype.getDoorOrWinRectPoints=function(e){var t=this.thick/2,r=new THREE.Vector3;r.crossVectors(this.vectorUp,this.direction),r.normalize();var i=r.clone();i.negate(),this.vectorUp.clone().multiplyScalar(t);var n=e.size,o=this.direction,a=e.position,s=n.x/2,l=new THREE.Vector3,c=new THREE.Vector3;return l.subVectors(a,o.clone().multiplyScalar(s)),c.addVectors(a,o.clone().multiplyScalar(s)),[l.clone().addVectors(l,r.clone().multiplyScalar(t)),l.clone().addVectors(l,i.clone().multiplyScalar(t)),c.clone().addVectors(c,i.clone().multiplyScalar(t)),c.clone().addVectors(c,r.clone().multiplyScalar(t))]},t}(mo),xo=function(r){function i(e){to(this,i);var t=no(this,r.call(this));return t.mesh=null,t.shapePath=null,t.holePaths=null,t.room=e,t.isDoubleSide=!1,t.texture=co.floorTexture,t.enableLightMap=uo.enableFloorLightMap,t.material=null,t.geometry=null,t.resource=null,t.height=null,t.blockSize=null,t.DefaultHeight=.01,t}return io(i,r),i.prototype.resourceCallback=function(e){this.texture=e.texture,this.mesh&&(this.mesh.material.map=this.texture,this.mesh.material.needsUpdate=!0)},i.prototype.initResource=function(){var e=this.room.floorResource;e&&(e.ready?(this.texture=e.texture,this.material=e.material):(!uo.enableCombine||this.room.userID||this.room.name||this.room.properties)&&e.registerListener(this)),this.room.lightMapResource&&this.enableLightMap&&(this.material=e,this.material.aoMap=this.room.lightMapResource.texture)},i.prototype.build=function(){this.enableDelayLoadMode||this.initResource(),4===this.shapePath.length&&0===this.holePaths.length||(this.enableLightMap=!1);for(var e=new THREE.Vector3,t=0;t<this.shapePath.length;t++){var r=this.shapePath[t];e.x+=r.x,e.z+=r.y}e.x/=this.shapePath.length,e.z/=this.shapePath.length;var i=new THREE.Shape(this.shapePath);if(this.holePaths)for(t=0;t<this.holePaths.length;t++){var n=this.holePaths[t];i.holes.push(new THREE.Path(n))}var o=new THREE.ShapeGeometry(i);if(this.blockSize)for(t=0;t<o.faceVertexUvs.length;t++)for(var a=o.faceVertexUvs[t],s=0;s<a.length;s++)for(var l=a[s],c=0;c<l.length;c++){var u=l[c];u.set(u.x/this.blockSize.x,u.y/this.blockSize.y)}o.uvsNeedUpdate=!0,this.geometry=o;var h=null;if(null===this.height&&(this.height=this.DefaultHeight),this.room.lightMapResource&&this.enableLightMap){var p=this.room.floorResource;void 0===p.floorLightMaterial&&(p.floorLightMaterial=new THREE.MeshBasicMaterial({map:p.texture})),this.material=p.floorLightMaterial,this.material.aoMap=this.room.lightMapResource.texture,h=this.material,this.calLightMapUV(o)}else h=this.room.floorResource.roomMaterial;if(h.side=THREE.DoubleSide,h.defines=h.defines||{},h.defines.FLOOR_AO=!0,void 0===h&&console.error("floor material is null"),this.mesh=new THREE.Mesh(o,h),this.mesh.name="floor",this.mesh.position.y=this.height,this.mesh.rotateX(-Math.PI/2),this.room.center){e=this.room.center;this.mesh.position.set(e.x,0,e.z)}this.mesh.visible=this.isShow},i.prototype.calLightMapUV=function(e){var t,r,i,n,o=e.faceVertexUvs;o[1]=[];for(var a=0;a<o.length;a++)for(var s=o[a],l=0;l<s.length;l++)for(var c=s[l],u=0;u<c.length;u++){var h=c[u];void 0!==t?(h.x>t&&(t=h.x),h.x<i&&(i=h.x),h.y>r&&(r=h.y),h.y<n&&(n=h.y)):(t=h.x,r=h.y,i=h.x,n=h.y)}var p=o[0],d=[];for(l=0;l<p.length;l++){c=p[l];var f=[];for(u=0;u<c.length;u++){h=c[u];var m=new THREE.Vector2,g=h.x===t?1:0,v=h.y===r?1:0;m.set(g,v),f.push(m)}d.push(f)}o[1]=d},i.prototype.reCalUV=function(e){for(var t,r,i,n,o=e.faceVertexUvs,a=0;a<o.length;a++)for(var s=o[a],l=0;l<s.length;l++)for(var c=s[l],u=0;u<c.length;u++){var h=c[u];void 0!==t?(h.x>t&&(t=h.x),h.x<i&&(i=h.x),h.y>r&&(r=h.y),h.y<n&&(n=h.y)):(t=h.x,r=h.y,i=h.x,n=h.y)}var p=Math.abs(i),d=Math.abs(n);t+=p,r+=d;var f=[];for(a=0;a<o.length;a++){var m=o[a],g=[];for(l=0;l<m.length;l++){c=m[l];var v=[];for(u=0;u<c.length;u++){h=c[u];var y=new THREE.Vector2;y.set((h.x+p)/t,(h.y+d)/r),v.push(y)}g.push(v)}f.push(g)}return f},i}(ho),Eo=function(r){function i(e){to(this,i);var t=no(this,r.call(this));return t.mesh=null,t.shapePath=[],t.holePaths=null,t.center=null,t.room=e,t.material=null,t.geometry=null,t.resource=null,t.height=null,t.blockSize=null,t}return io(i,r),i.prototype.initResource=function(){var e=this.room.ceilingResource;e&&(e.ready?(this.texture=e.texture,this.material=e.material):(!uo.enableCombine||this.room.userID||this.room.name||this.room.properties)&&e.registerListener(this))},i.prototype.resourceCallback=function(e){this.texture=e.texture,this.mesh&&(this.mesh.material.map=this.texture,this.mesh.material.needsUpdate=!0)},i.prototype.build=function(){this.enableDelayLoadMode||this.initResource();var e=new THREE.Shape(this.shapePath);if(this.holePaths)for(var t=0;t<this.holePaths.length;t++){var r=this.holePaths[t];e.holes.push(new THREE.Path(r))}var i=new THREE.ShapeGeometry(e);if(this.material=this.room.ceilingResource.roomMaterial,this.geometry=i,this.blockSize)for(t=0;t<i.faceVertexUvs.length;t++)for(var n=i.faceVertexUvs[t],o=0;o<n.length;o++)for(var a=n[o],s=0;s<a.length;s++){var l=a[s];l.set(l.x/this.blockSize.x,l.y/this.blockSize.y)}i.uvsNeedUpdate=!0;var c;if(c=this.room.ceilingResource.roomMaterial,this.mesh=new THREE.Mesh(i,c),this.mesh.name="ceiling",this.mesh.rotateX(Math.PI/2),null===this.height){var u=2.9;this.room.parent&&(u=this.room.parent.height),this.height=u}if(this.mesh.position.y=this.height,this.mesh.updateMatrixWorld(),this.room.center){var h=this.room.center;this.mesh.position.set(h.x,3,h.z)}this.mesh.visible=this.isShow},i}(ho),_o=function(r){function i(e){to(this,i);var t=no(this,r.call(this));return t.mesh=null,t.shapePath=[],t.holePaths=null,t.center=null,t.room=e,t.material=null,t.geometry=null,t.resource=null,t.height=null,t.blockSize=null,t}return io(i,r),i.prototype.resourceCallback=function(e){this.texture=e.texture,this.mesh&&(this.mesh.material.map=this.texture,this.mesh.material.needsUpdate=!0)},i.prototype.initResource=function(){var e=this.room.roofResource;e&&(e.ready?(this.texture=e.texture,this.material=e.material):(!uo.enableCombine||this.room.userID||this.room.name||this.room.properties)&&e.registerListener(this))},i.prototype.build=function(){this.enableDelayLoadMode||this.initResource();var e=new THREE.Shape(this.shapePath);if(this.holePaths)for(var t=0;t<this.holePaths.length;t++){var r=this.holePaths[t];e.holes.push(new THREE.Path(r))}var i=new THREE.ShapeGeometry(e);if(this.geometry=i,this.material=this.room.roofResource.roomMaterial,this.blockSize)for(t=0;t<i.faceVertexUvs.length;t++)for(var n=i.faceVertexUvs[t],o=0;o<n.length;o++)for(var a=n[o],s=0;s<a.length;s++){var l=a[s];l.set(l.x/this.blockSize.x,l.y/this.blockSize.y)}i.uvsNeedUpdate=!0;var c;if(c=this.room.roofResource.roomMaterial,this.mesh=new THREE.Mesh(i,c),null===this.height){var u=3;this.room.parent&&(u=this.room.parent.height),this.height=u}if(this.mesh.position.y=this.height+.001,this.mesh.name="roof",this.mesh.rotateX(-Math.PI/2),this.room.center){var h=this.room.center;this.mesh.position.set(h.x,this.height,h.z)}this.mesh.updateMatrixWorld(),this.mesh.visible=this.isShow,this.mesh.name="roof"+this.id},i}(ho),wo=function(r){function i(e){to(this,i);var t=no(this,r.call(this));return t.dataJson=e,t.shapePath=[],t.reverseZShapPath=[],t.holePaths=[],t.reverseZHolePaths=[],t._points=[],t._holes=[],t._uv2=[],t._uv2Hole=[],t.center=null,t.meshGroup=null,t.mesh=null,t.offset=null,t.parentPosition=null,t.position=new THREE.Vector3,t.floor=new xo(t),t.roof=new _o(t),t.ceiling=new Eo(t),t.floorResource=null,t.ceilingResource=null,t.roofResource=null,t.lightMapResource=null,t.isOnlyFloor=!1,t}return io(i,r),i.prototype.initShapePathPoints=function(){var e=this.points;this.shapePath.length=0;for(var t=this.reverseZShapPath.length=0;t<e.length;t++){var r=e[t].clone();this.shapePath.push(new THREE.Vector2(r.x,r.z)),this.reverseZShapPath.push(new THREE.Vector2(r.x,-r.z))}this.floor.shapePath=this.reverseZShapPath,this.ceiling.shapePath=this.shapePath,this.roof.shapePath=this.reverseZShapPath},i.prototype.initShapeHolePoints=function(){var e=this.holes;this.holePaths.length=0;for(var t=this.reverseZHolePaths.length=0;t<e.length;t++){for(var r=e[t],i=r.length,n=[],o=[],a=0;a<i;a++){var s=r[a].clone();n.push(new THREE.Vector2(s.x,s.z)),o.push(new THREE.Vector2(s.x,-s.z))}this.holePaths.push(n),this.reverseZHolePaths.push(o)}this.floor.holePaths=this.reverseZHolePaths,this.ceiling.holePaths=this.holePaths,this.roof.holePaths=this.reverseZHolePaths},i.prototype.build=function(){if(this.initShapePathPoints(),this.initShapeHolePoints(),this.parentPosition&&this.offset){var e=new THREE.Vector3;e.add(this.parentPosition),e.add(this.offset),this.center=e}else this.center=null;this.isOnlyFloor?(this.floor.build(),this.meshGroup=new THREE.Object3D("room"),this.meshGroup.add(this.floor.mesh)):(this.floor.build(),this.ceiling.build(),this.roof.build(),this.meshGroup=new THREE.Object3D("room"),this.meshGroup.add(this.floor.mesh),this.meshGroup.add(this.ceiling.mesh),this.meshGroup.add(this.roof.mesh)),this.mesh=this.meshGroup,this.meshGroup.position.set(this.position.x,this.position.y,this.position.z)},ro(i,[{key:"points",set:function(e){this._points=e},get:function(){return this._points}},{key:"holes",set:function(e){this._holes=e},get:function(){return this._holes}},{key:"uv2",set:function(e){this._uv2=e},get:function(){return this._uv2}},{key:"holeUV2",set:function(e){this._uv2Hole=e},get:function(){return this._uv2Hole}}]),i}(ho),To=function(t){function r(){to(this,r);var e=no(this,t.call(this));return e.walls=[],e.corners=[],e.rooms=[],e.placements=[],e.videoprobes=[],e.curvelines=[],e.pipelines=[],e.text3Ds=[],e.groups=[],e.height=3,e.uncombineWithHeigthRooms=[],e.combinePlacements=[],e.combineStraightManualWalls=[],e.combineModelWalls=[],e.combineRoofs=[],e.combineCeilings=[],e.combineFloors=[],e.combineDoorOrWins=[],e.curPlacementCombineProcessorMap=new Map,e.curStraightManualWallCombineProcessorMap=new Map,e.curModelWallCombineProcessorMap=new Map,e.curFloorCombineProcessorMap=new Map,e.curCeilingCombineProcessorMap=new Map,e.curRoofCombineProcessorMap=new Map,e.curDoorOrWinCombineProcessorMap=new Map,e.curGroupCombineProcessorMap=new Map,e.groupCombineProcessors=[],e.placementCombineProcessors=[],e.straightManualWallCombineProcessors=[],e.modelWallCombineProcessors=[],e.floorCombineProcessors=[],e.ceilingCombineProcessors=[],e.roofCombineProcessors=[],e.doorOrWindowCombineProcessors=[],e}return io(r,t),r.prototype.build=function(){for(var e=0;e<this.corners.length;e++){this.corners[e].build()}for(e=0;e<this.walls.length;e++){(r=this.walls[e]).build();for(var t=0;t<r.doorOrWindows.length;t++){r.doorOrWindows[t].build()}}for(e=0;e<this.walls.length;e++){var r;0<(r=this.walls[e]).doorOrWindows.length&&(r.initSimpleCornersAndWalls(),r.buildSimpleCornersAndWalls())}for(e=0;e<this.rooms.length;e++){this.rooms[e].build()}for(e=0;e<this.placements.length;e++){this.placements[e].build()}for(e=0;e<this.videoprobes.length;e++){this.videoprobes[e].build()}for(e=0;e<this.groups.length;e++){this.groups[e].build()}for(e=0;e<this.text3Ds.length;e++){this.text3Ds[e].build()}},r.prototype.existsCorner=function(e,t,r){for(var i=0,n=this.corners.length;i<n;i++){var o=this.corners[i].position;if(o.x===e&&o.y===t&&o.z===r)return!0}return!1},r.prototype.addCorner=function(e,t,r){var i=new vo(e,t,r);return this.corners.push(i),i.parent=this,i},r.prototype.addWall=function(e){this.walls.push(e)},r.prototype.getCorner=function(e,t,r){for(var i=0,n=this.corners.length;i<n;i++){var o=this.corners[i].position;if(o.x===e&&o.y===t&&o.z===r)return this.corners[i]}return null},r.prototype.exportTestXS=function(){for(var e={points:[],edges:[]},t=[],r=[],i=0;i<this.corners.length;i++){var n=this.corners[i];t.push([n.position.x,n.position.z])}for(i=0;i<this.walls.length;i++){var o=this.walls[i];r.push([this.corners.indexOf(o.startCorner),this.corners.indexOf(o.endCorner)])}return e.points=t,e.edges=r,e},r}(ho),Mo=function(t){function r(){to(this,r);var e=no(this,t.call(this));return e.resource=null,e.mesh=null,e.model=null,e.customColor=null,e.opacity=null,e.renderMode=null,e.delayObject=new THREE.Object3D,e.initCompleteCallback=null,e.customTextureResource=null,e.hasSkin=!1,e.isPlayAnim=!1,e.animClip=null,e.isResouceRegistered=!1,e.belongRoomUserID=null,e.size=new THREE.Vector3,e}return io(r,t),r.prototype.build=function(){this.initSize(),this.enableDelayLoadMode||(this.initResource(),null!==this.model&&this.instanceModel())},r.prototype.initSize=function(){this.resource.modelSize&&this.size.multiplyVectors(this.resource.modelSize,this.scale)},r.prototype.initResource=function(){this.resource&&(this.resource.ready||this.isResouceRegistered?this.model=this.resource.model:(this.resource.registerListener(this),this.isResouceRegistered=!0))},r.prototype.resourceCallback=function(e){this.mesh||(this.model=e.model,null===this.size&&this.initSize(),this.instanceModel(),this.initCompleteCallback&&this.initCompleteCallback(this))},r.prototype.instanceModel=function(){null!==this.model&&(this.mesh=fo.clone(this.model),this.hasSkin=this.mesh.hasSkin,this.mesh.name="placement",this.mesh.position.set(this.position.x,this.position.y,this.position.z),this.mesh.quaternion.set(this.rotation.x,this.rotation.y,this.rotation.z,this.rotation.w),this.mesh.scale.set(this.scale.x,this.scale.y,this.scale.z),this.mesh.visible=this.isShow,this.mesh.name="plc"+this.id,null!==this.renderMode&&this.changeRenderMode(this.mesh),this.customTextureResource&&this.changeWithCustomTexture(this.mesh),this.customColor&&this.changeWithCustomColor(this.mesh),this.delayObject.add(this.mesh))},r.prototype.changeRenderMode=function(e){if(e instanceof THREE.Mesh&&(e.material.color=this.customColor,null!==this.renderMode))switch(this.renderMode){case 1:e.material.transparent=!1,e.material.alphaTest=.5;break;case 3:case 2:e.material.transparent=!0;break;default:console.error("can not find renderMode "+this.renderMode)}for(var t=0;t<e.children.length;t++){var r=e.children[t];this.changeRenderMode(r)}},r.prototype.changeWithCustomColor=function(e){e instanceof THREE.Mesh&&(e.material.color=this.customColor,null!==this.opacity&&(e.material.opacity=this.opacity,e.material.transparent=!0));for(var t=0;t<e.children.length;t++){var r=e.children[t];this.changeWithCustomColor(r)}},r.prototype.changeWithCustomTexture=function(e){e instanceof THREE.Mesh&&(e.material.map=this.customTextureResource.texture);for(var t=0;t<e.children.length;t++){var r=e.children[t];this.changeWithCustomTexture(r)}},r}(ho),So=function(t){function r(){to(this,r);var e=no(this,t.call(this));return e.suspendPercent=0,e.size=new THREE.Vector3(1,1,1),e.attachWall=null,e.isOpen=!1,e.openDirIndex=0,e.modelSize=null,e.isWindow=!1,e}return io(r,t),r.prototype.build=function(){this.initModelSize(),null!==this.model?(this.fitAttachWall(),this.instanceModel()):this.initResource()},r.prototype.resourceCallback=function(e){this.mesh||(this.model=e.model,this.build(),this.initCompleteCallback&&this.initCompleteCallback(this))},r.prototype.fitAttachWall=function(){if(this.attachWall){var e=this.attachWall.direction,t=new THREE.Vector3;t.crossVectors(new THREE.Vector3(0,-1,0),e),this.rotation.setFromUnitVectors(new THREE.Vector3(0,0,-1),t),this.changeOpenDirection(),this.position.y=this.attachWall.height*this.suspendPercent}},r.prototype.changeOpenDirection=function(){var e;1!==this.openDirIndex&&3!==this.openDirIndex||(this.resource.hasAnimation()||((e=new THREE.Quaternion).setFromAxisAngle(new THREE.Vector3(0,1,0),Math.PI),this.rotation.multiply(e)));0!==this.openDirIndex&&2!==this.openDirIndex||this.resource.hasAnimation()&&((e=new THREE.Quaternion).setFromAxisAngle(new THREE.Vector3(0,1,0),Math.PI),this.rotation.multiply(e))},r.prototype.initModelSize=function(){if(this.model){var e=new THREE.Box3;e.makeEmpty(),e=e.setFromObject(this.model),this.modelSize=e.getSize(new THREE.Vector3)}else this.resource&&(this.modelSize=this.resource.modelSize);(this.model||this.resource)&&this.size.set(this.modelSize.x*this.scale.x,this.modelSize.y*this.scale.y,this.modelSize.z*this.scale.z)},r}(Mo),Ro=function e(t,r,i,n){to(this,e),this.positionArray=t.geometry.getAttribute("position").array.slice();var o=t.geometry.getAttribute("normal");o?this.normalArray=o.array.slice():console.warn("not has normal");var a=t.geometry.getAttribute("uv");a&&(this.uvArray=a.array);var s=t.geometry.getAttribute("uv2");s&&(this.uv2Array=s.array);var l=t.geometry.getAttribute("uv3");l&&(this.uv3Array=l.array);var c=t.geometry.getAttribute("color");c&&(this.colorArray=c.array),this.indexArray=t.geometry.index.array,this.material=t.material;for(var u=this.positionArray,h=this.normalArray,p=0;p<u.length;){for(var d=n.length-1;-1<d;d--){var f=r[d],m=i[d],g=n[d];u[p]*=f.x,u[p+1]*=f.y,u[p+2]*=f.z;var v=new THREE.Vector3(u[p],u[p+1],u[p+2]);if((v=v.applyQuaternion(m)).x+=g.x,v.y+=g.y,v.z+=g.z,u[p]=v.x,u[p+1]=v.y,u[p+2]=v.z,h){var y=new THREE.Vector3(h[p],h[p+1],h[p+2]);y=y.applyQuaternion(m),h[p]=y.x,h[p+1]=y.y,h[p+2]=y.z}}p+=3}this.vertexCount=this.positionArray.length/3,this.indexCount=this.indexArray.length,this.groups=t.geometry.groups},Po=function(){function t(e){to(this,t),this.bundeObj=e,this.materialMap=new Map,this.combineBundleMeshs=[],this.vertexCount=0}return t.prototype.combine=function(){this._combine(this.bundeObj,[],[],[])},t.prototype._combine=function(e,t,r,i){if(t.push(e.scale),i.push(e.position),r.push(e.quaternion),e instanceof THREE.Mesh){var n=new Ro(e,t,r,i);0!==n.vertexCount&&(this.combineBundleMeshs.push(n),void 0===this.materialMap.get(n.material)&&this.materialMap.set(n.material,[]),this.materialMap.get(n.material).push(n)),this.vertexCount+=n.vertexCount}if(0!==e.children.length)for(var o=0;o<e.children.length;o++){var a=r.slice(),s=t.slice(),l=i.slice();this._combine(e.children[o],s,a,l)}},t}(),Ao=function(){function t(e){to(this,t),this.url=null,this.isEmpty=!1,this.callbackObjects=[],this.ready=!1,this.texture=null,this.model=null,this.modelName=null,this.modelID=null,this.material=new THREE.MeshStandardMaterial,this.wallMaterial=new THREE.MeshStandardMaterial({color:16777215}),this.roomMaterial=new THREE.MeshLambertMaterial({color:16777215}),this.id=null,this.ext=null,this.baseUrl=null,this.version=null,this.isDefault=!1,this.animations=null,this.isCombine=!1,this.combineBundleObj=null,this.manager=e,this.modelSize=null,this.animations=null,this.tryHightedtVersion=!1,this.debug=!1,this.gltfRoot=null}return t.prototype.registerListener=function(e){this.callbackObjects.push(e)},t.prototype.combine=function(){this.model&&(this.combineBundleObj=new Po(this.model),this.combineBundleObj.combine(),6e4<=this.combineBundleObj.vertexCount?(this.isCombine=!1,console.warn("combine "+this.id+" exceed max vectex")):this.isCombine=!0)},t.prototype.hasAnimation=function(){return void 0!==this.animations&&(null!==this.animations&&(!Array.isArray(this.animations)||0!==this.animations.length))},t.prototype.getTextureUrl=function(){return this.baseUrl+this.id+"."+(null===this.ext?"jpg":this.ext)},t.prototype.getModelUrl=function(){return this.baseUrl+this.id+"/"+this.version+"/gltf/"},t.prototype.downloadTexture=function(t){var r=this;if("bundle"===this.ext)return r.ready=!0,console.warn("not support bundle texture"),void t();var e=new THREE.TextureLoader;e.setCrossOrigin("anonymous");var i=null;i=this.url?this.url:this.baseUrl+this.id+"."+(null===this.ext?"jpg":this.ext),e.load(i,function(e){e.wrapS=THREE.RepeatWrapping,e.wrapT=THREE.RepeatWrapping,e.flipY=!0,r.texture=e,r.material.map=e,r.wallMaterial.map=e,r.roomMaterial.map=e,r.ready=!0,r.material.roughness=1,r.debug&&console.log(r.id+" download complete"),r.downloadCallback(t)},function(e){console.log(i+" "+e.loaded/e.total*100+"% loaded")},function(e){r.ready=!0,console.error("download error "+i),r.downloadCallback(t)})},t.prototype.downloadModel=function(t){var r=this,e=new thingjs.GLTFLoader,i=null,n=0;this.manager.enableUserHighestVersionResource||(n=this.version),i=this.url?this.url:this.baseUrl+this.id+"/"+n+"/gltf/",e.loadFromURL({url:i,modelCallback:function(e){r.animations=e.animations,r.model=e.node,r.ready=!0,r.downloadCallback(t),r.debug&&console.log(r.id+" download complete")},errorCallback:function(){console.error("download error "+i),r.ready=!0,r.isEmpty=!0,r.downloadCallback(t)}})},t.prototype.downloadCallback=function(e){try{for(var t=0;t<this.callbackObjects.length;t++){this.callbackObjects[t].resourceCallback(this)}e&&e()}catch(e){console.error(e)}},t.prototype.dispose=function(){this.texture&&this.texture.dispose(),this.model&&this._disposeModel(this.model)},t.prototype._disposeModel=function(e){for(var t=0;t<e.children.length;t++){var r=e.children[t];this._disposeModel(r)}if(e instanceof THREE.Mesh){var i=e.material,n=e.geometry,o=e.material.texture;i&&i.dispose(),n&&n.dispose(),o&&o.dispose()}},ro(t,[{key:"isModel",get:function(){return null===this.ext}}]),t}(),Co=function(){function e(){to(this,e),this.sceneJson=null,this.scale=1,this.curFloorPlan=null,this.defaultWallTextureUri="Textures/RoomWall.jpg",this.defaultWallEdgeTextureUri="Textures/WallEdge.jpg",this.defaultFloorTextureUri="Textures/FloorDefault.jpg",this.defaultCeilingTextureUri="Textures/CeilingDefault.jpg",this.defaultRoofTextureUri="Textures/RoofDefault.jpg",this.defaultWallLightMapUri="Textures/WallLighting.PNG",this.defaultFloorLightMapUri="Textures/FloorLighting.jpg",this.pointInLineDeviation=.1,uo.enableDelayLoadMode=!1,uo.enableManaulWallLightMap=!0,uo.enableFloorLightMap=!0}return e.prototype.load=function(e){var i=this;return e?(e.url&&(this.sceneURL=e.url),e.json&&(this.sceneJson=e.json),new Promise(function(r,e){i.loadDefaultTexture().then(function(){return i.loadSceneJson()}).then(function(){i.curFloorPlan=new To,i.parseSceneJson(),i.curFloorPlan.build();var e=i.createWalls(),t=i.createRooms();r({walls:e,rooms:t})}).catch(function(e){console.error(e)})})):(console.error("load param can not be null"),null)},e.prototype.loadSceneJson=function(){var i=this;return new Promise(function(t,r){if(i.sceneJson)t(i.sceneJson);else if(i.sceneURL){(new THREE.FileLoader).load(i.sceneURL,function(e){i.sceneJson=JSON.parse(e),t()},function(){},function(e){r("can not load "+i.sceneURL)})}else r("load scene json error")})},e.prototype.createTextureLoaderPromise=function(r){return new Promise(function(t,e){(new THREE.TextureLoader).load(r,function(e){e.wrapS=THREE.RepeatWrapping,e.wrapT=THREE.RepeatWrapping,t(e)},function(e){console.log(r+" "+e.loaded/e.total*100+"% loaded")},function(e){t(null),console.log(r+"load error")})})},e.prototype.loadDefaultTexture=function(){var u=this;return new Promise(function(e,t){var r=[],i=u.createTextureLoaderPromise(u.defaultWallTextureUri).then(function(e){co.wallTexture=e;var t=u.createDefaultResource(e);co.wallResource=t});r.push(i);var n=u.createTextureLoaderPromise(u.defaultWallEdgeTextureUri).then(function(e){co.wallEdgeTexture=e;var t=u.createDefaultResource(e);co.edgeResource=t});r.push(n);var o=u.createTextureLoaderPromise(u.defaultFloorTextureUri).then(function(e){co.floorTexture=e;var t=u.createDefaultResource(e);co.floorResource=t});r.push(o);var a=u.createTextureLoaderPromise(u.defaultRoofTextureUri).then(function(e){co.roofTexture=e;var t=u.createDefaultResource(e);co.rooflResource=t});r.push(a);var s=u.createTextureLoaderPromise(u.defaultCeilingTextureUri).then(function(e){co.ceilingTexture=e;var t=u.createDefaultResource(e);co.ceilingResource=t});if(r.push(s),uo.enableManaulWallLightMap){var l=u.createTextureLoaderPromise(u.defaultWallLightMapUri).then(function(e){co.wallLigthMapTexture=e;var t=u.createDefaultResource(e);co.wallLightMapResource=t});r.push(l)}if(uo.enableFloorLightMap){var c=u.createTextureLoaderPromise(u.defaultFloorLightMapUri).then(function(e){co.floorLightMapTexture=e;var t=u.createDefaultResource(e);co.floorLightMapResource=t});r.push(c)}Promise.all(r).then(function(){e()})})},e.prototype.createDefaultResource=function(e){var t=new Ao;return t.ready=!0,t.isDefault=!0,t.texture=e,t.material.map=e,t.roomMaterial.map=e,t},e.prototype.parseSceneJson=function(){var e=this.sceneJson;e.unit&&(this.scale=.01*e.unit),e.walls&&this.parseWallJson(e.walls),e.rooms&&this.parseRoomJson(e.rooms),e.doors&&this.parseDoorJson(e.doors)},e.prototype.parseWallJson=function(e){for(var t=0,r=e.length;t<r;t++){var i=e[t],n=i.start[0]*this.scale,o=i.start[1]*this.scale,a=null,s=null;a=this.curFloorPlan.existsCorner(n,0,o)?this.curFloorPlan.getCorner(n,0,o):this.curFloorPlan.addCorner(n,0,o),n=i.end[0]*this.scale,o=i.end[1]*this.scale,s=this.curFloorPlan.existsCorner(n,0,o)?this.curFloorPlan.getCorner(n,0,o):this.curFloorPlan.addCorner(n,0,o);var l=new bo;l.leftResource=co.wallResource,l.rightResource=co.wallResource,l.edgeResource=co.edgeResource,l.lightMapResource=co.wallLightMapResource,l.startCorner=a,l.endCorner=s,l.startCorner.addWall(l),l.endCorner.addWall(l),this.curFloorPlan.addWall(l)}},e.prototype.parseRoomJson=function(e){for(var t=0;t<e.length;t++){for(var r=e[t],i=[],n=0;n<r.points.length;n++){var o=r.points[n];i.push(new THREE.Vector3(o[0]*this.scale,0,o[1]*this.scale))}var a=new wo;if(a.floorResource=co.floorResource,a.ceilingResource=co.ceilingResource,a.roofResource=co.rooflResource,a.lightMapResource=co.floorLightMapResource,a.points=i,r.center){var s=new THREE.Vector3;s.x=r.center[0],s.y=0,s.z=r.center[1],a.center=s}if(r.offset){var l=new THREE.Vector3;l.x=r.offset[0],l.y=r.offset[1],l.z=r.offset[2],a.offset=l}if(r.parentPosition){var c=new THREE.Vector3;c.x=r.parentPosition[0],c.y=r.parentPosition[1],c.z=r.parentPosition[2],a.parentPosition=c}this.curFloorPlan.rooms.push(a)}},e.prototype.parseDoorJson=function(e){for(var t=0,r=e.length;t<r;t++){var i=e[t],n=i.height*this.scale,o=i.width*this.scale,a=i.pos[0]*this.scale,s=i.pos[1]*this.scale,l=new THREE.Vector3(a,0,s),c=this.getPointOnWhichWall(this.curFloorPlan,l);if(null!==c){var u=new So;i.suspendpercent&&(u.suspendPercent=i.suspendpercent),u.size.x=o,u.size.y=n,u.position=l,c.doorOrWindows.push(u)}else console.warn("can not find door on which wall!")}},e.prototype.createRooms=function(){for(var e=[],t=0;t<this.curFloorPlan.rooms.length;t++){var r=this.curFloorPlan.rooms[t];e.push(r.meshGroup)}return e},e.prototype.createWalls=function(){for(var e=this.curFloorPlan.walls,t=[],r=0;r<e.length;r++){var i=e[r];t.push(i.wallGroup)}return t},e.prototype.createWallMesh=function(e){var t=new THREE.BufferGeometry;t.addAttribute("position",new THREE.BufferAttribute(e.positionArray,3)),t.addAttribute("normal",new THREE.BufferAttribute(e.normalArray,3)),t.addAttribute("uv",new THREE.BufferAttribute(e.uvArray,2));var r=e.material;return new THREE.Mesh(t,r)},e.prototype.getPointOnWhichWall=function(e,t){for(var r=e.walls,i=0;i<r.length;i++){var n=r[i];if(this.isPointOnLineAndBetweenPoints(n.startCorner.position,n.endCorner.position,t))return n}return null},e.prototype.isPointOnLine=function(e,t,r){var i=new THREE.Vector3;return i.crossVectors(e.clone().sub(r),t.clone().sub(r)),i.length()<this.pointInLineDeviation},e.prototype.isPointOnLineAndBetweenPoints=function(e,t,r){if(!this.isPointOnLine(e,t,r))return!1;var i=t.x-e.x,n=t.z-e.z;return Math.abs(i)>=Math.abs(n)?0<i?e.x<=r.x&&r.x<=t.x:t.x<=r.x&&r.x<=e.x:0<n?e.z<=r.z&&r.z<=t.z:t.z<=r.z&&r.z<=e.z},e}(),Lo=function(t){function r(){to(this,r);var e=no(this,t.call(this));return e.outdoors=null,e.buildings=[],e}return io(r,t),r.prototype.build=function(){for(var e=0;e<this.buildings.length;e++){this.buildings[e].build()}this.outdoors&&this.outdoors.build()},r}(ho),Oo=function(t){function r(){to(this,r);var e=no(this,t.call(this));return e.floorplans=[],e.facades=[],e.facadeGroups=[],e}return io(r,t),r.prototype.build=function(){for(var e=0;e<this.floorplans.length;e++){this.floorplans[e].build()}for(e=0;e<this.facades.length;e++){this.facades[e].build()}for(e=0;e<this.facadeGroups.length;e++){this.facadeGroups[e].build()}},r}(ho),Ho={id:"id",name:"name",position:"position",rotation:"rotation",scale:"scale",properties:"properties",plans:"plans",walls:"walls",placements:"placements",groups:"groups",corners:"corners",doorOrWindows:"doororwindows",rooms:"rooms",height:"height",thick:"thick",texture:"texture",type:"type",model:"model",suspendPercent:"suspendpercent",leftTexture:"lefttexture",rightTexture:"righttexture",edgeTexture:"edgetexture",floorTexture:"floortexture",ceilingTexture:"ceilingtexture",roofTexture:"rooftexture",wallType:"type"},Fo=function(){function e(){to(this,e),this.sceneJson=null,this.scale=1,this.curFloorPlan=null,this.defaultWallTextureUri="Textures/RoomWall.jpg",this.defaultWallEdgeTextureUri="Textures/WallEdge.jpg",this.defaultFloorTextureUri="Textures/FloorDefault.jpg",this.defaultCeilingTextureUri="Textures/CeilingDefault.jpg",this.defaultRoofTextureUri="Textures/RoofDefault.jpg",this.defaultWallLightMapUri="Textures/WallLighting.PNG",this.defaultFloorLightMapUri="Textures/FloorLighting.jpg",this.world=null,uo.enableDelayLoadMode=!1,uo.enableManaulWallLightMap=!0,uo.enableFloorLightMap=!0}return e.prototype.load=function(e){var r=this;return e?(e.url&&(this.sceneURL=e.url),e.json&&(this.sceneJson=e.json),new Promise(function(e,t){r.loadDefaultTexture().then(function(){return r.loadSceneJson()}).then(function(){r.parseWorld(r.sceneJson),r.world.build(),e(r.world)}).catch(function(e){console.error(e)})})):(console.error("load param can not be null"),null)},e.prototype.loadSceneJson=function(){var i=this;return new Promise(function(t,r){if(i.sceneJson)t(i.sceneJson);else if(i.sceneURL){(new THREE.FileLoader).load(i.sceneURL,function(e){i.sceneJson=JSON.parse(e),t()},function(){},function(e){r("can not load "+i.sceneURL)})}else r("load scene json error")})},e.prototype.createTextureLoaderPromise=function(r){return new Promise(function(t,e){(new THREE.TextureLoader).load(r,function(e){e.wrapS=THREE.RepeatWrapping,e.wrapT=THREE.RepeatWrapping,t(e)},function(e){console.log(r+" "+e.loaded/e.total*100+"% loaded")},function(e){t(null),console.log(r+"load error")})})},e.prototype.loadDefaultTexture=function(){var u=this;return new Promise(function(e,t){var r=[],i=u.createTextureLoaderPromise(u.defaultWallTextureUri).then(function(e){co.wallTexture=e;var t=u.createDefaultResource(e);co.wallResource=t});r.push(i);var n=u.createTextureLoaderPromise(u.defaultWallEdgeTextureUri).then(function(e){co.wallEdgeTexture=e;var t=u.createDefaultResource(e);co.edgeResource=t});r.push(n);var o=u.createTextureLoaderPromise(u.defaultFloorTextureUri).then(function(e){co.floorTexture=e;var t=u.createDefaultResource(e);co.floorResource=t});r.push(o);var a=u.createTextureLoaderPromise(u.defaultRoofTextureUri).then(function(e){co.roofTexture=e;var t=u.createDefaultResource(e);co.rooflResource=t});r.push(a);var s=u.createTextureLoaderPromise(u.defaultCeilingTextureUri).then(function(e){co.ceilingTexture=e;var t=u.createDefaultResource(e);co.ceilingResource=t});if(r.push(s),uo.enableManaulWallLightMap){var l=u.createTextureLoaderPromise(u.defaultWallLightMapUri).then(function(e){co.wallLigthMapTexture=e;var t=u.createDefaultResource(e);co.wallLightMapResource=t});r.push(l)}if(uo.enableFloorLightMap){var c=u.createTextureLoaderPromise(u.defaultFloorLightMapUri).then(function(e){co.floorLightMapTexture=e;var t=u.createDefaultResource(e);co.floorLightMapResource=t});r.push(c)}Promise.all(r).then(function(){e()})})},e.prototype.createDefaultResource=function(e){var t=new Ao;return t.ready=!0,t.isDefault=!0,t.texture=e,t.material.map=e,t.roomMaterial.map=e,t},e.prototype.parseWorld=function(e){var t=new Lo;if(this.world=t,e.buildings)for(var r=e.buildings,i=0;i<r.length;i++){var n=r[i],o=this.parseBuilding(n);t.buildings.push(o)}},e.prototype.parseBuilding=function(e,t){var r=e,i=new Oo;e.id&&(i.id=e.id);for(var n=r[Ho.plans],o=0;o<n.length;o++){var a=n[o],s=new To;a.id&&(s.id=a.id),this.parseFloorPlan(a,s,i),a.height?s.position.set(0,a.height*o,0):s.position.set(0,s.height*o,0),i.floorplans.push(s)}return i},e.prototype.parseFloorPlan=function(e,t){var r=e;r.unit&&(this.scale=.01*r.unit),r.walls&&this.parseWallJson(r.walls,t),r.rooms&&this.parseRoomJson(r.rooms,t),r.doors&&this.parseDoorJson(r.doors,t)},e.prototype.parseWallJson=function(e,t){for(var r=0,i=e.length;r<i;r++){var n=e[r],o=n.start[0]*this.scale,a=n.start[1]*this.scale,s=null,l=null;s=t.existsCorner(o,0,a)?t.getCorner(o,0,a):t.addCorner(o,0,a),o=n.end[0]*this.scale,a=n.end[1]*this.scale,l=t.existsCorner(o,0,a)?t.getCorner(o,0,a):t.addCorner(o,0,a);var c=new bo;n.id&&(c.id=n.id),c.leftResource=co.wallResource,c.rightResource=co.wallResource,c.edgeResource=co.edgeResource,c.lightMapResource=co.wallLightMapResource,c.startCorner=s,c.endCorner=l,c.startCorner.addWall(c),c.endCorner.addWall(c),t.addWall(c)}},e.prototype.parseRoomJson=function(e,t){for(var r=0;r<e.length;r++){for(var i=e[r],n=[],o=0;o<i.points.length;o++){var a=i.points[o];n.push(new THREE.Vector3(a[0]*this.scale,0,a[1]*this.scale))}var s=new wo;if(i.id&&(s.id=i.id),s.floorResource=co.floorResource,s.ceilingResource=co.ceilingResource,s.roofResource=co.rooflResource,s.lightMapResource=co.floorLightMapResource,s.points=n,i.center){var l=new THREE.Vector3;l.x=i.center[0],l.y=0,l.z=i.center[1],s.center=l}if(i.offset){var c=new THREE.Vector3;c.x=i.offset[0],c.y=i.offset[1],c.z=i.offset[2],s.offset=c}if(i.parentPosition){var u=new THREE.Vector3;u.x=i.parentPosition[0],u.y=i.parentPosition[1],u.z=i.parentPosition[2],s.parentPosition=u}void 0!==i.enableLightMap?s.floor.enableLightMap=i.enableLightMap:s.floor.enableLightMap=!1,(s.parent=t).rooms.push(s)}},e.prototype.parseDoorJson=function(e,t){for(var r=0,i=e.length;r<i;r++){var n=e[r],o=n.height*this.scale,a=n.width*this.scale,s=n.pos[0]*this.scale,l=n.pos[1]*this.scale,c=new THREE.Vector3(s,0,l),u=this.getPointOnWhichWall(t,c);if(null!==u){var h=new So;h.size.x=a,h.size.y=o,h.position=c,u.doorOrWindows.push(h)}else console.warn("can not find door on which wall!")}},e.prototype.createWallMesh=function(e){var t=new THREE.BufferGeometry;t.addAttribute("position",new THREE.BufferAttribute(e.positionArray,3)),t.addAttribute("normal",new THREE.BufferAttribute(e.normalArray,3)),t.addAttribute("uv",new THREE.BufferAttribute(e.uvArray,2));var r=e.material;return new THREE.Mesh(t,r)},e.prototype.getPointOnWhichWall=function(e,t){for(var r=e.walls,i=0;i<r.length;i++){var n=r[i];if(this.isPointOnLineAndBetweenPoints(n.startCorner.position,n.endCorner.position,t))return n}return null},e.prototype.isPointOnLine=function(e,t,r){var i=new THREE.Vector3;return i.crossVectors(e.clone().sub(r),t.clone().sub(r)),!i.length()},e.prototype.isPointOnLineAndBetweenPoints=function(e,t,r){if(!this.isPointOnLine(e,t,r))return!1;var i=t.x-e.x,n=t.z-e.z;return Math.abs(i)>=Math.abs(n)?0<i?e.x<=r.x&&r.x<=t.x:t.x<=r.x&&r.x<=e.x:0<n?e.z<=r.z&&r.z<=t.z:t.z<=r.z&&r.z<=e.z},e}(),ko=function(){function e(){to(this,e),this.sceneJson=null,this.scale=1,this.curFloorPlan=null,this.defaultWallTextureUri="Textures/RoomWall.jpg",this.defaultWallEdgeTextureUri="Textures/WallEdge.jpg",this.defaultFloorTextureUri="Textures/FloorDefault.jpg",this.defaultCeilingTextureUri="Textures/CeilingDefault.jpg",this.defaultRoofTextureUri="Textures/RoofDefault.jpg",this.defaultWallLightMapUri="Textures/WallLighting.PNG",this.defaultFloorLightMapUri="Textures/FloorLighting.jpg",uo.enableDelayLoadMode=!1,uo.enableManaulWallLightMap=!0,uo.enableFloorLightMap=!0}return e.prototype.load=function(e){var i=this;return e?(e.url&&(this.sceneURL=e.url),e.json&&(this.sceneJson=e.json),new Promise(function(r,e){i.loadDefaultTexture().then(function(){return i.loadSceneJson()}).then(function(){i.curFloorPlan=new To,i.parseSceneJson(),i.curFloorPlan.build();var e=i.createWalls(),t=i.createRooms();r({walls:e,rooms:t})}).catch(function(e){console.error(e)})})):(console.error("load param can not be null"),null)},e.prototype.loadSceneJson=function(){var i=this;return new Promise(function(t,r){if(i.sceneJson)t(i.sceneJson);else if(i.sceneURL){(new THREE.FileLoader).load(i.sceneURL,function(e){i.sceneJson=JSON.parse(e),t()},function(){},function(e){r("can not load "+i.sceneURL)})}else r("load scene json error")})},e.prototype.createTextureLoaderPromise=function(r){return new Promise(function(t,e){(new THREE.TextureLoader).load(r,function(e){e.wrapS=THREE.RepeatWrapping,e.wrapT=THREE.RepeatWrapping,t(e)},function(e){console.log(r+" "+e.loaded/e.total*100+"% loaded")},function(e){t(null),console.log(r+"load error")})})},e.prototype.loadDefaultTexture=function(){var u=this;return new Promise(function(e,t){var r=[],i=u.createTextureLoaderPromise(u.defaultWallTextureUri).then(function(e){co.wallTexture=e;var t=u.createDefaultResource(e);co.wallResource=t});r.push(i);var n=u.createTextureLoaderPromise(u.defaultWallEdgeTextureUri).then(function(e){co.wallEdgeTexture=e;var t=u.createDefaultResource(e);co.edgeResource=t});r.push(n);var o=u.createTextureLoaderPromise(u.defaultFloorTextureUri).then(function(e){co.floorTexture=e;var t=u.createDefaultResource(e);co.floorResource=t});r.push(o);var a=u.createTextureLoaderPromise(u.defaultRoofTextureUri).then(function(e){co.roofTexture=e;var t=u.createDefaultResource(e);co.rooflResource=t});r.push(a);var s=u.createTextureLoaderPromise(u.defaultCeilingTextureUri).then(function(e){co.ceilingTexture=e;var t=u.createDefaultResource(e);co.ceilingResource=t});if(r.push(s),uo.enableManaulWallLightMap){var l=u.createTextureLoaderPromise(u.defaultWallLightMapUri).then(function(e){co.wallLigthMapTexture=e;var t=u.createDefaultResource(e);co.wallLightMapResource=t});r.push(l)}if(uo.enableFloorLightMap){var c=u.createTextureLoaderPromise(u.defaultFloorLightMapUri).then(function(e){co.floorLightMapTexture=e;var t=u.createDefaultResource(e);co.floorLightMapResource=t});r.push(c)}Promise.all(r).then(function(){e()})})},e.prototype.createDefaultResource=function(e){var t=new Ao;return t.ready=!0,t.isDefault=!0,t.texture=e,t.material.map=e,t.roomMaterial.map=e,t},e.prototype.parseSceneJson=function(){var e=this.sceneJson;for(var t in e){var r=e[t];if(!r)return console.error("load param can not be null"),null;this.sceneJson=r;break}(e=this.sceneJson).id&&(this.curFloorPlan.id=e.id),e.unit&&(this.scale=.01*e.unit),e.walls&&this.parseWallJson(e.walls),e.rooms&&this.parseRoomJson(e.rooms),e.doors&&this.parseDoorJson(e.doors)},e.prototype.parseWallJson=function(e){for(var t=0,r=e.length;t<r;t++){var i=e[t],n=i.start[0]*this.scale,o=i.start[1]*this.scale,a=null,s=null;a=this.curFloorPlan.existsCorner(n,0,o)?this.curFloorPlan.getCorner(n,0,o):this.curFloorPlan.addCorner(n,0,o),n=i.end[0]*this.scale,o=i.end[1]*this.scale,s=this.curFloorPlan.existsCorner(n,0,o)?this.curFloorPlan.getCorner(n,0,o):this.curFloorPlan.addCorner(n,0,o);var l=new bo;l.leftResource=co.wallResource,l.rightResource=co.wallResource,l.edgeResource=co.edgeResource,l.lightMapResource=co.wallLightMapResource,l.startCorner=a,l.endCorner=s,l.startCorner.addWall(l),l.endCorner.addWall(l),this.curFloorPlan.addWall(l)}},e.prototype.parseRoomJson=function(e){for(var t=0;t<e.length;t++){for(var r=e[t],i=[],n=0;n<r.points.length;n++){var o=r.points[n];i.push(new THREE.Vector3(o[0]*this.scale,0,o[1]*this.scale))}var a=new wo;if(a.floorResource=co.floorResource,a.ceilingResource=co.ceilingResource,a.roofResource=co.rooflResource,a.lightMapResource=co.floorLightMapResource,a.points=i,r.center){var s=new THREE.Vector3;s.x=r.center[0],s.y=0,s.z=r.center[1],a.center=s}if(r.offset){var l=new THREE.Vector3;l.x=r.offset[0],l.y=r.offset[1],l.z=r.offset[2],a.offset=l}if(r.parentPosition){var c=new THREE.Vector3;c.x=r.parentPosition[0],c.y=r.parentPosition[1],c.z=r.parentPosition[2],a.parentPosition=c}void 0!==r.enableLightMap?a.floor.enableLightMap=r.enableLightMap:a.floor.enableLightMap=!1,this.curFloorPlan.rooms.push(a)}},e.prototype.parseDoorJson=function(e){for(var t=0,r=e.length;t<r;t++){var i=e[t],n=i.height*this.scale,o=i.width*this.scale,a=i.pos[0]*this.scale,s=i.pos[1]*this.scale,l=new THREE.Vector3(a,0,s),c=this.getPointOnWhichWall(this.curFloorPlan,l);if(null!==c){var u=new So;i.suspendpercent&&(u.suspendPercent=i.suspendpercent),u.size.x=o,u.size.y=n,u.position=l,c.doorOrWindows.push(u)}else console.warn("can not find door on which wall!")}},e.prototype.createRooms=function(){for(var e=[],t=0;t<this.curFloorPlan.rooms.length;t++){var r=this.curFloorPlan.rooms[t];e.push(r.meshGroup)}return e},e.prototype.createWalls=function(){for(var e=this.curFloorPlan.walls,t=[],r=0;r<e.length;r++){var i=e[r];t.push(i.wallGroup)}return t},e.prototype.createWallMesh=function(e){var t=new THREE.BufferGeometry;t.addAttribute("position",new THREE.BufferAttribute(e.positionArray,3)),t.addAttribute("normal",new THREE.BufferAttribute(e.normalArray,3)),t.addAttribute("uv",new THREE.BufferAttribute(e.uvArray,2));var r=e.material;return new THREE.Mesh(t,r)},e.prototype.getPointOnWhichWall=function(e,t){for(var r=e.walls,i=0;i<r.length;i++){var n=r[i];if(this.isPointOnLineAndBetweenPoints(n.startCorner.position,n.endCorner.position,t))return n}return null},e.prototype.isPointOnLine=function(e,t,r){var i=new THREE.Vector3;return i.crossVectors(e.clone().sub(r),t.clone().sub(r)),!i.length()},e.prototype.isPointOnLineAndBetweenPoints=function(e,t,r){if(!this.isPointOnLine(e,t,r))return!1;var i=t.x-e.x,n=t.z-e.z;return Math.abs(i)>=Math.abs(n)?0<i?e.x<=r.x&&r.x<=t.x:t.x<=r.x&&r.x<=e.x:0<n?e.z<=r.z&&r.z<=t.z:t.z<=r.z&&r.z<=e.z},e}(),Io=function(){function e(){to(this,e),this.sceneJson=null,this.scale=1,this.curFloorPlan=null,this.defaultWallTextureUri="Textures/RoomWall.jpg",this.defaultWallEdgeTextureUri="Textures/WallEdge.jpg",this.defaultFloorTextureUri="Textures/FloorDefault.jpg",this.defaultCeilingTextureUri="Textures/CeilingDefault.jpg",this.defaultRoofTextureUri="Textures/RoofDefault.jpg",this.wallLines=[],this.roomLines=[]}return e.prototype.load=function(e){var r=this;return e?(e.url&&(this.sceneURL=e.url),e.json&&(this.sceneJson=e.json),new Promise(function(t,e){r.loadDefaultTexture().then(function(){return r.loadSceneJson()}).then(function(){r.curFloorPlan=new To,r.parseSceneJson(),r.curFloorPlan.build();var e={walls:r.createWalls(),rooms:r.createRooms(),wallLines:r.wallLines,roomLines:r.roomLines};t(e)}).catch(function(e){console.error(e)})})):(console.error("load param can not be null"),null)},e.prototype.loadSceneJson=function(){var i=this;return new Promise(function(t,r){if(i.sceneJson)t(i.sceneJson);else if(i.sceneURL){(new THREE.FileLoader).load(i.sceneURL,function(e){i.sceneJson=JSON.parse(e),t()},function(){},function(e){r("can not load "+i.sceneURL)})}else r("load scene json error")})},e.prototype.createTextureLoaderPromise=function(r){return new Promise(function(t,e){(new THREE.TextureLoader).load(r,function(e){e.wrapS=THREE.RepeatWrapping,e.wrapT=THREE.RepeatWrapping,t(e)},function(e){console.log(r+" "+e.loaded/e.total*100+"% loaded")},function(e){t(null),console.log(r+"load error")})})},e.prototype.loadDefaultTexture=function(){var s=this;return new Promise(function(t,e){var r=s.createTextureLoaderPromise(s.defaultWallTextureUri),i=s.createTextureLoaderPromise(s.defaultWallEdgeTextureUri),n=s.createTextureLoaderPromise(s.defaultFloorTextureUri),o=s.createTextureLoaderPromise(s.defaultRoofTextureUri),a=s.createTextureLoaderPromise(s.defaultCeilingTextureUri);Promise.all([r,i,n,o,a]).then(function(e){co.wallTexture=e[0],co.wallEdgeTexture=e[1],co.floorTexture=e[2],co.roofTexture=e[3],co.ceilingTexture=e[4],t()})})},e.prototype.createLine=function(e,t){for(var r=new THREE.LineBasicMaterial({color:t}),i=new THREE.Geometry,n=0;n<e.length;n++){var o=e[n];i.vertices.push(o)}return new THREE.Line(i,r)},e.prototype.parseSceneJson=function(){var e=this.sceneJson;e.unit&&(this.scale=.01*e.unit),e.walls&&this.parseWallJson(e.walls),e.rooms&&this.parseRoomJson(e.rooms)},e.prototype.parseWallJson=function(e){for(var t=0,r=e.length;t<r;t++){var i=e[t],n=i.start[0]*this.scale,o=i.start[1]*this.scale,a=null,s=null;a=this.curFloorPlan.existsCorner(n,0,o)?this.curFloorPlan.getCorner(n,0,o):this.curFloorPlan.addCorner(n,0,o),n=i.end[0]*this.scale,o=i.end[1]*this.scale,s=this.curFloorPlan.existsCorner(n,0,o)?this.curFloorPlan.getCorner(n,0,o):this.curFloorPlan.addCorner(n,0,o);var l=new bo;i.height&&(l.height=i.height),l.startCorner=a,l.endCorner=s,l.startCorner.addWall(l),l.endCorner.addWall(l);var c=[];c.push(l.startCorner.position),c.push(l.endCorner.position);var u=this.createLine(c,new THREE.Color(1,0,0));this.wallLines.push(u),this.curFloorPlan.addWall(l)}},e.prototype.parseRoomJson=function(e){for(var t=0;t<e.length;t++){for(var r=e[t],i=[],n=0;n<r.points.length;n++){var o=r.points[n];i.push(new THREE.Vector3(o[0]*this.scale,0,o[1]*this.scale))}var a=new wo,s=this.createLine(i,new THREE.Color(0,1,0));if(this.roomLines.push(s),a.points=i,r.center){var l=new THREE.Vector3;l.x=r.center[0],l.y=0,l.z=r.center[1],a.center=l}if(r.offset){var c=new THREE.Vector3;c.x=r.offset[0],c.y=r.offset[1],c.z=r.offset[2],a.offset=c}if(r.parentPosition){var u=new THREE.Vector3;u.x=r.parentPosition[0],u.y=r.parentPosition[1],u.z=r.parentPosition[2],a.parentPosition=u}this.curFloorPlan.rooms.push(a)}},e.prototype.createRooms=function(){for(var e=[],t=0;t<this.curFloorPlan.rooms.length;t++){var r=this.curFloorPlan.rooms[t];e.push(r.meshGroup)}return e},e.prototype.createWalls=function(){for(var e=this.curFloorPlan.walls,t=[],r=0;r<e.length;r++){var i=e[r],n=i.position,o=new THREE.Group("wall");o.add(this.createWallMesh(i.rightSideMeshInfo)),o.add(this.createWallMesh(i.leftSideMeshInfo)),o.add(this.createWallMesh(i.edgeSideMeshInfo)),o.position.set(n.x,n.y,n.z),t.push(o)}return t},e.prototype.createWallMesh=function(e){var t=new THREE.BufferGeometry;t.addAttribute("position",new THREE.BufferAttribute(e.positionArray,3)),t.addAttribute("normal",new THREE.BufferAttribute(e.normalArray,3)),t.addAttribute("uv",new THREE.BufferAttribute(e.uvArray,2));var r=e.material;return new THREE.Mesh(t,r)},e}(),jo=function(t){function e(){return to(this,e),no(this,t.call(this))}return io(e,t),e.prototype.build=function(){for(var e=0;e<this.rooms.length;e++){this.rooms[e].isOnlyFloor=!0}t.prototype.build.call(this)},e}(To),No=function(r){function i(e){to(this,i);var t=no(this,r.call(this,e));return t.customTexture=null,t.color=null,t.renderMode=null,t.modelID=null,t}return io(i,r),i.prototype.combine=function(){this.model&&(null!==this.customTexture&&this.changeWithCustomTexture(this.model),null!==this.color&&this.changeWithCustomColor(this.model),null!==this.renderMode&&this.changeRenderMode(this.model),this.combineBundleObj=new Po(this.model),this.combineBundleObj.combine(),this.isCombine=!0)},i.prototype.changeRenderMode=function(e){if(e instanceof THREE.Mesh&&(e.material.color=this.color,null!==this.renderMode))switch(this.renderMode){case 1:e.material.transparent=!1,e.material.alphaTest=.5;break;case 3:case 2:e.material.transparent=!0;break;default:console.error("can not find renderMode "+this.renderMode)}for(var t=0;t<e.children.length;t++){var r=e.children[t];this.changeRenderMode(r)}},i.prototype.changeWithCustomColor=function(e){e instanceof THREE.Mesh&&(e.material.color=this.color,null!==this.opacity&&(e.material.opacity=this.opacity,e.material.transparent=!0));for(var t=0;t<e.children.length;t++){var r=e.children[t];this.changeWithCustomColor(r)}},i.prototype.changeWithCustomTexture=function(e){e instanceof THREE.Mesh&&(this.customTexture&&this.customTexture.texture&&(this.customTexture.texture.flipY=!1),e.material.map=this.customTexture.texture);for(var t=0;t<e.children.length;t++){var r=e.children[t];this.changeWithCustomTexture(r)}},i.prototype.downloadModel=function(t){var r=this,e=new thingjs.GLTFLoader,i=null,n=0;this.manager.enableUserHighestVersionResource||(n=this.version),i=this.url?this.url:this.baseUrl+this.modelID+"/"+n+"/gltf/",e.loadFromURL({url:i,modelCallback:function(e){r.model=e.node.children[0],r.animations=e.animations,r.ready=!0,null!==r.customTexture?r.customTexture.downloadTexture(function(){null!==r.customTexture&&r.changeWithCustomTexture(r.model),null!==r.color&&r.changeWithCustomColor(r.model),null!==r.renderMode&&r.changeRenderMode(r.model),r.downloadCallback(t)}):(null!==r.color&&r.changeWithCustomColor(r.model),null!==r.renderMode&&r.changeRenderMode(r.model),r.downloadCallback(t))},errorCallback:function(){console.error("download error "+i),r.ready=!0,r.isEmpty=!0,r.downloadCallback(t)}})},i}(Ao),Do=function(r){function i(e){to(this,i);var t=no(this,r.call(this,e));return t.customTexture=null,t.color=null,t.renderMode=null,t.modelID=null,t.localBaseUrl=null,t.localUrl=null,t}return io(i,r),i.prototype.combine=function(){this.model&&(null!==this.customTexture&&this.changeWithCustomTexture(this.model),null!==this.color&&this.changeWithCustomColor(this.model),null!==this.renderMode&&this.changeRenderMode(this.model),this.combineBundleObj=new Po(this.model),this.combineBundleObj.combine(),this.isCombine=!0)},i.prototype.changeRenderMode=function(e){if(e instanceof THREE.Mesh&&(e.material.color=this.color,null!==this.renderMode))switch(this.renderMode){case 1:e.material.transparent=!1,e.material.alphaTest=.5;break;case 3:case 2:e.material.transparent=!0;break;default:console.error("can not find renderMode "+this.renderMode)}for(var t=0;t<e.children.length;t++){var r=e.children[t];this.changeRenderMode(r)}},i.prototype.changeWithCustomColor=function(e){e instanceof THREE.Mesh&&(e.material.color=this.color,null!==this.opacity&&(e.material.opacity=this.opacity,e.material.transparent=!0));for(var t=0;t<e.children.length;t++){var r=e.children[t];this.changeWithCustomColor(r)}},i.prototype.changeWithCustomTexture=function(e){e instanceof THREE.Mesh&&(this.customTexture&&this.customTexture.texture&&(this.customTexture.texture.flipY=!1),e.material.map=this.customTexture.texture);for(var t=0;t<e.children.length;t++){var r=e.children[t];this.changeWithCustomTexture(r)}},i.prototype.downloadModel=function(r){var i=this,t=(new THREE.FileLoader,null);this.localUrl?(t=this.localBaseUrl+this.localUrl,(new thingjs.GLTFLoader).load(t,function(e){i.model=e.scene,i.animations=e.animations,i.ready=!0;var t=new THREE.Box3;t.makeEmpty(),t=t.setFromObject(i.model),i.modelSize=t.getSize(new THREE.Vector3),null!==i.customTexture?i.customTexture.downloadTexture(function(){null!==i.customTexture&&i.changeWithCustomTexture(i.model),null!==i.color&&i.changeWithCustomColor(i.model),null!==i.renderMode&&i.changeRenderMode(i.model),i.downloadCallback(r)}):(null!==i.color&&i.changeWithCustomColor(i.model),null!==i.renderMode&&i.changeRenderMode(i.model),i.downloadCallback(r))},void 0,function(e){console.error("download error "+t+"  "+e),i.ready=!0,i.isEmpty=!0,i.downloadCallback(r)})):console.error("can not find url")},i}(Ao),Uo=function(r){function i(e){to(this,i);var t=no(this,r.call(this,e));return t.localBaseUrl=null,t.localUrl=null,t}return io(i,r),i.prototype.registerListener=function(e){this.callbackObjects.push(e)},i.prototype.downloadTexture=function(t){var r=this;if("bundle"===this.ext)return r.ready=!0,console.warn("not support bundle texture"),void t();var e=new THREE.TextureLoader;e.setCrossOrigin("anonymous");var i=null;this.localUrl?(i=this.localBaseUrl+this.localUrl,e.load(i,function(e){e.wrapS=THREE.RepeatWrapping,e.wrapT=THREE.RepeatWrapping,e.flipY=!0,r.texture=e,r.material.map=e,r.wallMaterial.map=e,r.roomMaterial.map=e,r.ready=!0,r.material.roughness=1,r.debug&&console.log(r.id+" download complete"),r.downloadCallback(t)},function(e){console.log(i+" "+e.loaded/e.total*100+"% loaded")},function(e){r.ready=!0,console.error("download error "+i),r.downloadCallback(t)})):console.error("can not find url")},i}(Ao),Vo=function(){function e(){to(this,e),this.textures=[],this.models=[],this.baseTextureUrl="https://static.3dmomoda.com/textures/",this.baseModelUrl="https://model.3dmomoda.com/models/",this.localCustomModelBaseUrl=null,this.wallTextures=[],this.wallModels=[],this.roomTextures=[],this.commonTextures=[],this.doorOrWindowModels=[],this.placementModels=[],this.isStartedDonwloadResouces=!1,this.allResouces=[],this.curDonwloadResIndex=-1,this.alreadyResouceCount=0,this.downloadResMaxCount=10,this.downloadResCompleteCallback=null,this.delayDownload=!1,this.resourceMap={},this.downloadResProgess=0,this.opacity=null,this.currentDownloadResMap=new Map,this.enableUserHighestVersionResource=uo.enableUseHighestVersionResource}return e.prototype.addCommonTextureResource=function(e){this._addResource(e,this.commonTextures)},e.prototype.addWallTextureResource=function(e){for(var t=0;t<this.wallTextures.length;t++){if(this.wallTextures[t].id===e.id)return}this.wallTextures.push(e)},e.prototype.addWallModelResource=function(e){for(var t=0;t<this.wallModels.length;t++){if(this.wallModels[t].id===e.id)return}this.wallModels.push(e)},e.prototype.addPlacementResource=function(e){this._addResource(e,this.placementModels)},e.prototype.addRoomResource=function(e){this._addResource(e,this.roomTextures)},e.prototype._addResource=function(e,t){for(var r=0;r<t.length;r++){if(t[r].id===e.id)return}t.push(e)},e.prototype.checkAllResourcesIsReady=function(){for(var e=0;e<this.textures.length;e++){var t=this.textures[e];if(!t.ready)return console.log(t.url),!1}for(e=0;e<this.models.length;e++){var r=this.models[e];if(!r.ready)return console.log(r.url),!1}return!0},e.prototype.resourceCallback=function(){this.alreadyResouceCount++,this.alreadyResouceCount===this.downloadResMaxCount&&this.downloadResources()},e.prototype.initLightMaps=function(e){var t=null,r=[];if(uo.enableManaulWallLightMap){(t=new Ao(this)).baseUrl=this.baseTextureUrl,t.id="18091219l1g1hnjt",t.ext="png",co.wallLightMapResource=t;var i=new Promise(function(e,t){co.wallLightMapResource.downloadTexture(function(){e()})});r.push(i)}if(uo.enableFloorLightMap){(t=new Ao(this)).baseUrl=this.baseTextureUrl,t.id="18091216vjlgtwbh",t.ext="jpg",co.floorLightMapResource=t;i=new Promise(function(e,t){co.floorLightMapResource.downloadTexture(function(){e()})});r.push(i)}Promise.all(r).then(function(){e&&e()})},e.prototype.downloadResources=function(e){var t=this;if(this.isStartedDonwloadResouces){if(this.curDonwloadResIndex===this.allResouces.length-1)return this.downloadResProgess=1,void e()}else{var r=[];this.downloadResProgess=0,r=r.concat(this.wallTextures).concat(this.wallModels).concat(this.roomTextures).concat(this.doorOrWindowModels).concat(this.placementModels).concat(this.commonTextures),this.allResouces=r,this.isStartedDonwloadResouces=!0,this.curDonwloadResIndex=0}if(0===this.allResouces.length)return this.downloadResProgess=1,void e();for(var i=0,n=[],o=this.curDonwloadResIndex;o<this.allResouces.length;o++,i++){var a=this.allResouces[o];if(null===a.ext){var s=new Promise(function(e,t){a.downloadModel(function(){e()})});n.push(s)}else{s=new Promise(function(e,t){a.downloadTexture(function(){e()})});n.push(s)}if(this.curDonwloadResIndex++,i===this.downloadResMaxCount){this.curDonwloadResIndex=o;break}o===this.allResouces.length-1&&(this.curDonwloadResIndex=o)}Promise.all(n).then(function(){t.downloadResProgess=t.curDonwloadResIndex/(t.allResouces.length-1),t.downloadResources(e)}).catch(function(e){console.log(e)})},e.prototype.downloadResourcesWithQueue=function(t){var r=this;if(0!==r.allResouces.length&&(this.downloadResProgess=(this.curDonwloadResIndex-this.currentDownloadResMap.size)/r.allResouces.length),this.isStartedDonwloadResouces){if(this.curDonwloadResIndex===this.allResouces.length&&0===this.currentDownloadResMap.size)return this.downloadResProgess=1,void t()}else{var e=[];this.downloadResProgess=0,e=uo.enableCombine?e.concat(this.wallTextures).concat(this.wallModels).concat(this.roomTextures).concat(this.doorOrWindowModels).concat(this.placementModels).concat(this.commonTextures):e.concat(this.textures).concat(this.models),this.allResouces=e,this.isStartedDonwloadResouces=!0,this.curDonwloadResIndex=0,this.currentDownloadResMap=new Map}if(0===this.allResouces.length)return this.downloadResProgess=1,void t();if(!(this.curDonwloadResIndex>this.allResouces.length-1)){if(0!==this.downloadResMaxCount-this.currentDownloadResMap.size){var i=this.allResouces[this.curDonwloadResIndex];if(null===i.ext)new Promise(function(e,t){i.downloadModel(function(){e(i)})}).then(function(e){r.currentDownloadResMap.delete(e.id),r.downloadResourcesWithQueue(t)}),this.currentDownloadResMap.set(i.id,i);else new Promise(function(e,t){i.downloadTexture(function(){e(i)})}).then(function(e){r.currentDownloadResMap.delete(e.id),r.downloadResourcesWithQueue(t)}),this.currentDownloadResMap.set(i.id,i);this.curDonwloadResIndex++,this.downloadResourcesWithQueue(t)}}},e.prototype.loadTextures=function(e){for(var t=null,r=0;r<e.length;r++){var i=e[r];t=i.localurl?this._loadLocalCustomTextureResource(i):this._loadTextureResource(i),this.textures.push(t),this.delayDownload||t.downloadTexture()}},e.prototype._loadLocalCustomTextureResource=function(e){var t=new Uo(this);return t.localUrl=e.localurl,t.localBaseUrl=this.localCustomModelBaseUrl,this._loadBaseTextureResourceData(e,t),t},e.prototype._loadTextureResource=function(e){var t=new Ao(this);return this._loadBaseTextureResourceData(e,t),t},e.prototype._loadBaseTextureResourceData=function(e,t){t.id=e.id,t.ext=e.ext,e.url&&(t.url=e.url),t.baseUrl=this.baseTextureUrl,e.isDefault&&(t.isDefault=e.isDefault)},e.prototype.loadModels=function(e){for(var t=null,r=0;r<e.length;r++){var i=e[r];if((t=i.model?new No(this):i.localurl?new Do(this):new Ao(this)).baseUrl=this.baseModelUrl,i.localurl){if(t.localUrl=i.localurl,t.id=i.id,t.localBaseUrl=this.localCustomModelBaseUrl,i.title&&(t.modelName=i.title),t.modelID=i.id,null!==i.texture&&void 0!==i.texture&&(t.customTexture=this.textures[i.texture]),i.rendermode&&(t.renderMode=i.rendermode),i.color){var n=i.color;t.color=new THREE.Color(n[0],n[1],n[2]),4===n.length&&(t.opacity=n[3])}}else if(i.id){if(t.id=i.id,t.modelID=i.id,t.version=i.version,null!==i.texture&&void 0!==i.texture&&(t.customTexture=this.textures[i.texture]),i.rendermode&&(t.renderMode=i.rendermode),i.model&&(t.modelID=i.model),i.title&&(t.modelName=i.title),i.color){n=i.color;t.color=new THREE.Color(n[0],n[1],n[2]),4===n.length&&(t.opacity=n[3])}if(i.size){var o=i.size;t.modelSize=new THREE.Vector3(o[0],o[1],o[2])}i.hasanimation&&(t.hasAnim=i.hasanimation),i.url&&(t.url=i.url)}this.models.push(t),this.delayDownload||t.downloadModel()}},e.prototype.loadCustomModelResource=function(e,t){this.loadBaseResourceData(e,t),e.localurl&&(t.localUrl=e.localurl,t.localBaseUrl=this.localCustomModelBaseUrl,null!==e.texture&&void 0!==e.texture&&(t.customTexture=this.textures[e.texture]))},e.prototype.loadCustomResource=function(e,t){this.loadBaseResourceData(e,t)},e.prototype.loadBaseResourceData=function(e,t){if(t.id=e.id,t.modelID=e.id,t.version=e.version,null!==e.texture&&void 0!==e.texture&&(t.customTexture=this.textures[e.texture]),e.rendermode&&(t.renderMode=e.rendermode),e.model&&(t.modelID=e.model),e.title&&(t.modelName=e.title),e.color){var r=e.color;t.color=new THREE.Color(r[0],r[1],r[2]),4===r.length&&(t.opacity=r[3])}if(e.size){var i=e.size;t.modelSize=new THREE.Vector3(i[0],i[1],i[2])}e.hasanimation&&(t.hasAnim=e.hasanimation)},e.prototype.disposeModels=function(){for(var e=0;e<this.models.length;e++){this.models[e].dispose()}},e.prototype.disposeTextures=function(){for(var e=0;e<this.textures.length;e++){this.textures[e].dispose()}},e}(),Bo=function(){function e(){to(this,e),this.id=null,this.name=null,this.userID=null,this.position=new THREE.Vector3,this.rotation=new THREE.Quaternion(0,0,0,1),this.scale=new THREE.Vector3(1,1,1),this.enableDelayLoadMode=uo.enableDelayLoadMode,this.parent=null,this.properties=null,this.isShow=!0}return ro(e,[{key:"worldPosition",get:function(){if(this.parent){var e=new THREE.Vector3;return e.addVectors(this.parent.worldPosition,this.position),e}return this.position}}]),e}(),zo=function(t){function r(){to(this,r);var e=no(this,t.call(this));return e.startCorner=null,e.endCorner=null,e.thick=-1,e.height=-1,e.length=-1,e.pathPoints=[],e.direction=new THREE.Vector3,e.doorOrWindows=[],e.subWalls=[],e.subCorners=[],e.suspend=0,e.mesh=null,e.isShow=!0,e}return io(r,t),r.prototype.baseBuild=function(){this.direction=new THREE.Vector3,this.direction.subVectors(this.endCorner.position,this.startCorner.position),this.length=this.direction.length(),this.direction.normalize(),this.pathPoints.push(this.startCorner.position),this.pathPoints.push(this.endCorner.position),this.position.addVectors(this.endCorner.position,this.startCorner.position),this.position.divideScalar(2)},r.prototype.build=function(){},r.prototype.getWallOtherCorner=function(e){return this.startCorner===e?this.endCorner:this.endCorner===e?this.startCorner:null},r.prototype.sortDoorOrWins=function(){var e=this.startCorner.position,t=this.endCorner.position,r=0<t.x-e.x?1:-1,i=0<t.z-e.z?1:-1,n=!0;Math.abs(t.x-e.x)<.001&&(n=!1);for(var o=[],a=0;a<this.doorOrWindows.length;a++){for(var s=this.doorOrWindows[a],l=0;l<o.length;l++){var c=o[l];if(0<=(n?(c.position.x-s.position.x)*r:(c.position.z-s.position.z)*i)){o.splice(l,0,s);break}if(l==o.length-1){o.push(s);break}}0===o.length&&o.push(s)}return o},r.prototype.getWallCornerByPos=function(e){for(var t=null,r=-1,i=this.subCorners,n=0;n<i.length;n++){var o=e.distanceTo(i[n].position);o<.01&&(null===t?(t=i[n],r=o):o<r&&(r=o,t=i[n]))}return t},r.prototype.getDoorOrWinStartAndEndPos=function(e){var t=e.size,r=this.direction,i=e.position.clone();i.y=0;var n=i.clone(),o=i.clone(),a=t.x/2;return n.subVectors(n,r.clone().multiplyScalar(a)),o.addVectors(o,r.clone().multiplyScalar(a)),[n,o]},r.prototype.addSubWallCorner=function(e){for(var t=0;t<this.subCorners.length;t++){if(this.subCorners[t]===e)return}this.subCorners.push(e)},ro(r,[{key:"worldPosition",get:function(){var e=this.startCorner.worldPosition,t=this.endCorner.worldPosition,r=new THREE.Vector3;return r.addVectors(e,t),r.divideScalar(2),r}}]),r}(Bo),qo=function e(){to(this,e),this.positionArray=null,this.normalArray=null,this.uvArray=null,this.colorArray=null,this.uv2Array=null,this.indexArray=null,this.material=null,this.resource=null},Go=function(t){function r(){to(this,r);var e=no(this,t.call(this));return e.startCorner=null,e.endCorner=null,e.thick=uo.StraightManualWallThick,e.height=uo.StraightManualWallHeight,e.cornersVertices=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3],e.direction=null,e.pathPoints=[],e.selfPathPoints=[],e.upDirection=new THREE.Vector3(0,1,0),e.downDirection=new THREE.Vector3(0,-1,0),e.basePoints=null,e.repeatUV=[],e.uvMultiple=[1,1],e.rightSideLength=null,e.leftSideLength=null,e.floorPlanHeight=3,e.rightSideMeshInfo=new qo,e.leftSideMeshInfo=new qo,e.edgeSideMeshInfo=new qo,e.defaultWallTexture=null,e.rightWallTexture=null,e.leftWallTexture=null,e.startUVPercent=[0,0,0,0],e.endUVPercent=[1,1,1,1],e.wallGroup=null,e.leftResource=null,e.rightResource=null,e.edgeResource=null,e.lightMapResource=null,e.isBuilded=!1,e.vectorUp=new THREE.Vector3(0,1,0),e.onlyBuildMeshInfo=!1,e.enableLightMap=uo.enableManaulWallLightMap,e.aoMapIntensity=uo.wallLightMapIntensity,e}return io(r,t),r.prototype.leftResourceCallback=function(e){},r.prototype.rightResourceCallback=function(e){this.rigthWallTexture=e,this.isBuilded&&(this.wallGroup[0].material.texture=this.rigthWallTexture)},r.prototype.resourceCallback=function(e){e===this.leftResource?(this.leftWallTexture=e.texture,this.initLightMap(),this.isBuilded&&this.wallGroup&&(this.enableLightMap?this.wallGroup.children[0].material=this.leftResource.wallLightMaterial:this.wallGroup.children[0].material=this.leftResource.material,this.wallGroup.children[0].material.needsUpdate=!0)):e===this.rightResource&&(this.rigthWallTexture=e.texture,this.initLightMap(),this.isBuilded&&this.wallGroup&&(this.enableLightMap?this.wallGroup.children[1].material=this.leftResource.wallLightMaterial:this.wallGroup.children[1].material=this.leftResource.material))},r.prototype.initMaterial=function(){this.leftResource?this.leftResource.ready?this.leftWallTexture=this.leftResource.texture:this.leftResource.callbackObjects.push(this):this.leftWallTexture||(this.leftWallTexture=co.wallTexture),this.rightResource?this.rightResource.ready?this.rightWallTexture=this.rightResource.texture:this.rightResource.callbackObjects.push(this):this.rightWallTexture||(this.rightWallTexture=co.wallTexture),this.leftResource?(this.leftSideMeshInfo.resource=this.leftResource,this.leftSideMeshInfo.material=this.leftResource.material):this.leftSideMeshInfo.material=new THREE.MeshStandardMaterial({map:null}),this.rightResource?(this.rightSideMeshInfo.resource=this.rightResource,this.rightSideMeshInfo.material=this.rightResource.material):this.rightSideMeshInfo.material=new THREE.MeshStandardMaterial({map:null}),this.edgeResource?(this.edgeSideMeshInfo.resource=this.edgeResource,this.edgeSideMeshInfo.material=this.edgeResource.material):this.edgeSideMeshInfo.material=new THREE.MeshStandardMaterial({map:null}),this.initLightMap()},r.prototype.initLightMap=function(){this.lightMapResource&&this.enableLightMap&&(this.rightResource.ready&&(void 0===this.rightResource.wallLightMaterial&&(this.rightResource.wallLightMaterial=this.rightResource.wallMaterial.clone()),this.rightSideMeshInfo.material=this.rightResource.wallLightMaterial,this.rightSideMeshInfo.material.aoMap=this.lightMapResource.texture,this.rightSideMeshInfo.material.defines.WALL_AO=!0,this.rightSideMeshInfo.material.metalness=.2,this.rightSideMeshInfo.material.roughness=.8),this.leftResource.ready&&(void 0===this.leftResource.wallLightMaterial&&(this.leftResource.wallLightMaterial=this.leftResource.wallMaterial.clone()),this.leftSideMeshInfo.material=this.leftResource.wallLightMaterial,this.leftSideMeshInfo.material.metalness=0,this.leftSideMeshInfo.material.roughness=1))},r.prototype.build=function(){if(this.baseBuild(),this.calPosInfo(),this.calEachSideLen(),this.calRepeatUV(),this.calBasePoints(),this.fillMesh(),this.initMaterial(),!this.onlyBuildMeshInfo){var e=this.position,t=new THREE.Group("wall");t.add(this.createMesh(this.leftSideMeshInfo)),t.add(this.createMesh(this.rightSideMeshInfo)),t.add(this.createMesh(this.edgeSideMeshInfo)),t.position.set(e.x,e.y,e.z),this.wallGroup=t,this.mesh=this.wallGroup}this.isBuilded=!0},r.prototype.baseBuild=function(){this.direction=new THREE.Vector3,this.direction.subVectors(this.endCorner.position,this.startCorner.position),this.direction.normalize(),this.pathPoints.push(this.startCorner.position),this.pathPoints.push(this.endCorner.position)},r.prototype.calEachSideLen=function(){var e=new THREE.Vector3;e.subVectors(this.endCorner.position,this.startCorner.position),e.normalize();var t=this.thick/2,r=new THREE.Vector3;r.crossVectors(this.downDirection,e),r.normalize();var i=r.clone();i.negate();var n=r.clone();n.multiplyScalar(t);var o=i.clone();o.multiplyScalar(t);var a=new THREE.Vector3,s=new THREE.Vector3,l=new THREE.Vector3,c=new THREE.Vector3;fo.equalVectorZero(this.cornersVertices[0])?a.addVectors(this.selfPathPoints[0],n):a.copy(this.cornersVertices[0]),fo.equalVectorZero(this.cornersVertices[3])?s.addVectors(this.selfPathPoints[1],n):s.copy(this.cornersVertices[3]),fo.equalVectorZero(this.cornersVertices[1])?l.addVectors(this.selfPathPoints[0],o):l.copy(this.cornersVertices[1]),fo.equalVectorZero(this.cornersVertices[2])?c.addVectors(this.selfPathPoints[1],o):c.copy(this.cornersVertices[2]),this.rightSideLength=new THREE.Vector3,this.leftSideLength=new THREE.Vector3,this.rightSideLength.subVectors(a,s),this.leftSideLength.subVectors(l,c),this.rightSideLength=this.rightSideLength.length(),this.leftSideLength=this.leftSideLength.length()},r.prototype.calRepeatUV=function(){this.repeatUV[0]=this.uvMultiple[0]*this.rightSideLength/this.floorPlanHeight,this.repeatUV[1]=this.uvMultiple[1]*this.height/this.floorPlanHeight,this.repeatUV[2]=this.uvMultiple[0]*this.leftSideLength/this.floorPlanHeight,this.repeatUV[3]=this.uvMultiple[1]*this.height/this.floorPlanHeight},r.prototype.calPosInfo=function(){var e=new THREE.Vector3;this.selfPathPoints.push(e.subVectors(this.startCorner.position,this.position)),e=new THREE.Vector3,this.selfPathPoints.push(e.subVectors(this.endCorner.position,this.position)),this.selfPathPoints[0].y=0,this.selfPathPoints[1].y=0},r.prototype.calBasePoints=function(){if(null===this.basePoints){this.basePoints=[];for(var e=0;e<12;e++)this.basePoints.push(new THREE.Vector3)}var t=this.thick/2,r=new THREE.Vector3;r.crossVectors(this.downDirection,this.direction),r.normalize();var i=r.clone();i.negate();var n=r.multiplyScalar(t);fo.equalVectorZero(this.cornersVertices[0])?(this.basePoints[4].x=this.selfPathPoints[0].x+n.x,this.basePoints[4].y=0,this.basePoints[4].z=this.selfPathPoints[0].z+n.z):(this.basePoints[4].x=this.cornersVertices[0].x,this.basePoints[4].y=0,this.basePoints[4].z=this.cornersVertices[0].z),fo.equalVectorZero(this.cornersVertices[1])?(n=i.multiplyScalar(t),this.basePoints[5].x=this.selfPathPoints[0].x+n.x,this.basePoints[5].y=0,this.basePoints[5].z=this.selfPathPoints[0].z+n.z):(this.basePoints[5].x=this.cornersVertices[1].x,this.basePoints[5].y=0,this.basePoints[5].z=this.cornersVertices[1].z);var o=this.direction.clone();r.crossVectors(this.downDirection,o.negate()),r.normalize(),(i=r.clone()).negate(),fo.equalVectorZero(this.cornersVertices[2])?((n=r.clone()).multiplyScalar(t),this.basePoints[6].x=this.selfPathPoints[1].x+n.x,this.basePoints[6].y=0,this.basePoints[6].z=this.selfPathPoints[1].z+n.z):(this.basePoints[6].x=this.cornersVertices[2].x,this.basePoints[6].y=0,this.basePoints[6].z=this.cornersVertices[2].z),fo.equalVectorZero(this.cornersVertices[3])?((n=i.clone()).multiplyScalar(t),this.basePoints[7].x=this.selfPathPoints[1].x+n.x,this.basePoints[7].y=0,this.basePoints[7].z=this.selfPathPoints[1].z+n.z):(this.basePoints[7].x=this.cornersVertices[3].x,this.basePoints[7].y=0,this.basePoints[7].z=this.cornersVertices[3].z),this.basePoints[0].x=this.basePoints[4].x,this.basePoints[0].y=this.basePoints[4].y+this.height,this.basePoints[0].z=this.basePoints[4].z,this.basePoints[1].x=this.basePoints[5].x,this.basePoints[1].y=this.basePoints[5].y+this.height,this.basePoints[1].z=this.basePoints[5].z,this.basePoints[2].x=this.basePoints[6].x,this.basePoints[2].y=this.basePoints[6].y+this.height,this.basePoints[2].z=this.basePoints[6].z,this.basePoints[3].x=this.basePoints[7].x,this.basePoints[3].y=this.basePoints[7].y+this.height,this.basePoints[3].z=this.basePoints[7].z,this.basePoints[8].x=this.selfPathPoints[0].x,this.basePoints[8].y=this.selfPathPoints[0].y+this.height,this.basePoints[8].z=this.selfPathPoints[0].z,this.basePoints[9].x=this.selfPathPoints[1].x,this.basePoints[9].y=this.selfPathPoints[1].y+this.height,this.basePoints[9].z=this.selfPathPoints[1].z},r.prototype.fillMesh=function(){this.leftSideMeshInfo.positionArray=new Float32Array(18),this.leftSideMeshInfo.normalArray=new Float32Array(18),this.leftSideMeshInfo.uvArray=new Float32Array(12),this.leftSideMeshInfo.indexArray=new Float32Array(6),this.rightSideMeshInfo.positionArray=new Float32Array(18),this.rightSideMeshInfo.normalArray=new Float32Array(18),this.rightSideMeshInfo.uvArray=new Float32Array(12),this.rightSideMeshInfo.indexArray=new Float32Array(6),this.edgeSideMeshInfo.positionArray=new Float32Array(72),this.edgeSideMeshInfo.normalArray=new Float32Array(72),this.edgeSideMeshInfo.uvArray=new Float32Array(48),this.edgeSideMeshInfo.indexArray=new Float32Array(24),this.lightMapResource&&(this.leftSideMeshInfo.uv2Array=new Float32Array(12),this.rightSideMeshInfo.uv2Array=new Float32Array(12),this.leftSideMeshInfo.uv2Array=new Float32Array(12));for(var e=0;e<6;e++)this.leftSideMeshInfo.indexArray[e]=e,this.rightSideMeshInfo.indexArray[e]=e;for(e=0;e<24;e++)this.edgeSideMeshInfo.indexArray[e]=e;var t=this.basePoints,r=0,i=new THREE.Vector3;i.crossVectors(this.downDirection,this.direction),i.normalize();var n=new THREE.Vector3;n.crossVectors(this.direction,this.downDirection),n.normalize();var o=this.direction,a=o.clone();a.negate();var s=[];s[r++]=t[0],s[r++]=t[7],s[r++]=t[3],s[r++]=t[0],s[r++]=t[4],s[r++]=t[7],s[r++]=t[2],s[r++]=t[5],s[r++]=t[1],s[r++]=t[2],s[r++]=t[6],s[r++]=t[5],s[r++]=t[0],s[r++]=t[2],s[r++]=t[1],s[r++]=t[0],s[r++]=t[3],s[r++]=t[2],0!==this.suspend&&(s[r++]=t[4],s[r++]=t[5],s[r++]=t[6],s[r++]=t[4],s[r++]=t[6],s[r++]=t[7]),s[r++]=t[1],s[r++]=t[4],s[r++]=t[0],s[r++]=t[1],s[r++]=t[5],s[r++]=t[4],s[r++]=t[3],s[r++]=t[7],s[r++]=t[2],s[r++]=t[2],s[r++]=t[7],s[r++]=t[6],s[r++]=t[1],s[r++]=t[8],s[r++]=t[0],s[r++]=t[3],s[r++]=t[9],s[r++]=t[2],r=0;var l=[];l[r++]=i,l[r++]=i,l[r++]=i,l[r++]=i,l[r++]=i,l[r++]=i;for(e=0;e<l.length;e++){var c=l[e],u=3*e;this.rightSideMeshInfo.normalArray[u]=c.x,this.rightSideMeshInfo.normalArray[u+1]=c.y,this.rightSideMeshInfo.normalArray[u+2]=c.z}l[r++]=n,l[r++]=n,l[r++]=n,l[r++]=n,l[r++]=n,l[r++]=n;e=6;for(var h=0;e<l.length;e++,h++){c=l[e],u=3*h;this.leftSideMeshInfo.normalArray[u]=c.x,this.leftSideMeshInfo.normalArray[u+1]=c.y,this.leftSideMeshInfo.normalArray[u+2]=c.z}l[r++]=this.upDirection,l[r++]=this.upDirection,l[r++]=this.upDirection,l[r++]=this.upDirection,l[r++]=this.upDirection,l[r++]=this.upDirection,0!==this.suspend&&(l[r++]=this.downDirection,l[r++]=this.downDirection,l[r++]=this.downDirection,l[r++]=this.downDirection,l[r++]=this.downDirection,l[r++]=this.downDirection),l[r++]=a,l[r++]=a,l[r++]=a,l[r++]=a,l[r++]=a,l[r++]=a,l[r++]=o,l[r++]=o,l[r++]=o,l[r++]=o,l[r++]=o,l[r++]=o,l[r++]=this.upDirection,l[r++]=this.upDirection,l[r++]=this.upDirection,l[r++]=this.upDirection,l[r++]=this.upDirection,l[r++]=this.upDirection;for(e=0;e<6;e++){c=s[e],u=3*e;this.rightSideMeshInfo.positionArray[u]=c.x,this.rightSideMeshInfo.positionArray[u+1]=c.y+this.suspend,this.rightSideMeshInfo.positionArray[u+2]=c.z}for(e=6,h=0;e<12;e++,h++){c=s[e],u=3*h;this.leftSideMeshInfo.positionArray[u]=c.x,this.leftSideMeshInfo.positionArray[u+1]=c.y+this.suspend,this.leftSideMeshInfo.positionArray[u+2]=c.z}for(e=12,h=0;e<s.length;e++,h++){c=s[e],u=3*h;this.edgeSideMeshInfo.positionArray[u]=c.x,this.edgeSideMeshInfo.positionArray[u+1]=c.y+this.suspend,this.edgeSideMeshInfo.positionArray[u+2]=c.z}for(e=12,h=0;e<l.length;e++,h++){c=l[e],u=3*h;this.edgeSideMeshInfo.normalArray[u]=c.x,this.edgeSideMeshInfo.normalArray[u+1]=c.y,this.edgeSideMeshInfo.normalArray[u+2]=c.z}this.fillUV()},r.prototype.fillUV=function(){var e,t,r,i,n,o=0;i=this.rightResource.isDefault?(e=this.startUVPercent[0],t=this.startUVPercent[1],r=this.endUVPercent[0],this.endUVPercent[1]):(e=this.startUVPercent[0]*this.repeatUV[0],t=this.startUVPercent[1]*this.repeatUV[1],r=this.endUVPercent[0]*this.repeatUV[0],this.endUVPercent[1]*this.repeatUV[1]),(n=this.rightSideMeshInfo.uvArray)[o++]=e,n[o++]=i,n[o++]=r,n[o++]=t,n[o++]=r,n[o++]=i,n[o++]=e,n[o++]=i,n[o++]=e,n[o++]=t,n[o++]=r,n[o++]=t,i=this.leftResource.isDefault?(e=this.startUVPercent[2],t=this.startUVPercent[3],r=this.endUVPercent[2],this.endUVPercent[3]):(e=this.startUVPercent[2]*this.repeatUV[2],t=this.startUVPercent[3]*this.repeatUV[3],r=this.endUVPercent[2]*this.repeatUV[2],this.endUVPercent[3]*this.repeatUV[3]),o=0,(n=this.leftSideMeshInfo.uvArray)[o++]=r,n[o++]=i,n[o++]=e,n[o++]=t,n[o++]=e,n[o++]=i,n[o++]=r,n[o++]=i,n[o++]=r,n[o++]=t,n[o++]=e,n[o++]=t,o=0,(n=this.edgeSideMeshInfo.uvArray)[o++]=0,n[o++]=1,n[o++]=1,n[o++]=0,n[o++]=1,n[o++]=1,n[o++]=0,n[o++]=1,n[o++]=0,n[o++]=0,n[o++]=1,n[o++]=0,n[o++]=0,n[o++]=1,n[o++]=1,n[o++]=0,n[o++]=1,n[o++]=1,n[o++]=0,n[o++]=1,n[o++]=0,n[o++]=0,n[o++]=1,n[o++]=0,n[o++]=0,n[o++]=1,n[o++]=0,n[o++]=0,n[o++]=1,n[o++]=1,n[o++]=0,n[o++]=0,n[o++]=1,n[o++]=1,n[o++]=1,n[o++]=0,n[o++]=0,n[o++]=1,n[o++]=0,n[o++]=0,n[o++]=1,n[o++]=1,n[o++]=0,n[o++]=1,n[o++]=0,n[o++]=0,n[o++]=1,n[o++]=1,this.lightMapResource&&(e=this.startUVPercent[0],t=this.startUVPercent[1],r=this.endUVPercent[0],i=this.endUVPercent[1],o=0,(n=this.rightSideMeshInfo.uv2Array)[o++]=e,n[o++]=i,n[o++]=r,n[o++]=t,n[o++]=r,n[o++]=i,n[o++]=e,n[o++]=i,n[o++]=e,n[o++]=t,n[o++]=r,n[o++]=t,o=0,(n=this.leftSideMeshInfo.uv2Array)[o++]=r,n[o++]=i,n[o++]=e,n[o++]=t,n[o++]=e,n[o++]=i,n[o++]=r,n[o++]=i,n[o++]=r,n[o++]=t,n[o++]=e,n[o++]=t)},r.prototype.getWallOtherCorner=function(e){return this.startCorner===e?this.endCorner:this.endCorner===e?this.startCorner:null},r.prototype.createMesh=function(e){var t=new THREE.BufferGeometry;t.addAttribute("position",new THREE.BufferAttribute(e.positionArray,3)),t.addAttribute("normal",new THREE.BufferAttribute(e.normalArray,3)),t.addAttribute("uv",new THREE.BufferAttribute(e.uvArray,2));var r=e.material;return this.lightMapResource&&e.uv2Array&&this.enableLightMap&&t.addAttribute("uv2",new THREE.BufferAttribute(e.uv2Array,2)),e.material=r,new THREE.Mesh(t,r)},ro(r,[{key:"position",get:function(){var e=this.startCorner.position,t=this.endCorner.position,r=new THREE.Vector3;return r.addVectors(e,t),r.divideScalar(2),r},set:function(e){}}]),r}(zo),Wo=function(e){function t(){return to(this,t),no(this,e.call(this))}return io(t,e),t.prototype.build=function(){if(this.baseBuild(),this.calPosInfo(),this.calBasePoints(),this.fillMesh(),this.initMaterial(),!this.enableDelayLoadMode){var e=this.position,t=new THREE.Group("wall");t.add(this.createMesh(this.leftSideMeshInfo)),t.add(this.createMesh(this.rightSideMeshInfo)),t.add(this.createMesh(this.edgeSideMeshInfo)),t.position.set(e.x,e.y,e.z),this.wallGroup=t,this.mesh=this.wallGroup}this.isBuilded=!0},t}(Go),Xo=function(e){function t(){return to(this,t),no(this,e.call(this))}return io(t,e),t.prototype.initSimpleCornersAndWalls=function(){var e=this.position;(new THREE.Vector3).crossVectors(this.direction,this.vectorUp);for(var t=this.sortDoorOrWins(),r=0;r<t.length;r++){var i=t[r],n=this.getDoorOrWinStartAndEndPos(i),o=this.getDoorOrWinRectPoints(i),a=Yo.createSubWallCorner(this.id+"_"+r+"_1",n[0],this),s=Yo.createSubWallCorner(this.id+"_"+r+"_2",n[1],this);if(this.addSubWallCorner(a),this.addSubWallCorner(s),0===r){var l=new Wo;this.subWalls.push(l),l.startCorner=this.startCorner,l.endCorner=a,l.startCorner.build(),l.endCorner.build(),this.setCornerVertices(l,!0),l.calPosInfo(),l.calEachSideLen(),l.endUVPercent[0]=l.rightSideLength/this.rightSideLength,l.endUVPercent[2]=l.leftSideLength/this.leftSideLength,l.repeatUV=this.repeatUV,l.leftResource=this.leftResource,l.rightResource=this.rightResource,l.edgeResource=this.edgeResource,l.lightMapResource=this.lightMapResource,l.height=this.height,l.thick=this.thick,l.parentWall=this}else{var c=t[r-1],u=this.getDoorOrWinStartAndEndPos(c),h=this.getDoorOrWinRectPoints(c),p=this.getWallCornerByPos(u[1]),d=new Wo;this.subWalls.push(d),d.startCorner=p,d.endCorner=a;var f=new THREE.Vector3;f.subVectors(p.position,a.position);var m=f.length();d.startCorner.build(),d.endCorner.build(),d.calPosInfo(),d.calEachSideLen();var g=h[3].distanceTo(e.clone().addVectors(this.cornersVertices[0],e)),v=h[2].distanceTo(e.clone().addVectors(this.cornersVertices[1],e));d.startUVPercent[0]=g/this.rightSideLength,d.startUVPercent[2]=v/this.leftSideLength,d.endUVPercent[0]=(g+m)/this.rightSideLength,d.endUVPercent[2]=(v+m)/this.leftSideLength,d.repeatUV=this.repeatUV,d.leftResource=this.leftResource,d.rightResource=this.rightResource,d.edgeResource=this.edgeResource,d.lightMapResource=this.lightMapResource,d.height=this.height,d.thick=this.thick,d.parentWall=this}if(r==t.length-1){var y=new Wo;this.subWalls.push(y),y.startCorner=s,y.endCorner=this.endCorner,y.startCorner.build(),this.setCornerVertices(y,!1),y.calPosInfo(),y.calEachSideLen();g=o[3].distanceTo(e.clone().addVectors(this.cornersVertices[0],e)),v=o[2].distanceTo(e.clone().addVectors(this.cornersVertices[1],e));y.startUVPercent[0]=g/this.rightSideLength,y.startUVPercent[2]=v/this.leftSideLength,y.repeatUV=this.repeatUV,y.leftResource=this.leftResource,y.rightResource=this.rightResource,y.edgeResource=this.edgeResource,y.lightMapResource=this.lightMapResource,y.height=this.height,y.thick=this.thick,y.parentWall=this}this.buildHeadAndFootWall(i,a,s)}},t.prototype.buildSimpleCornersAndWalls=function(){this.enableDelayLoadMode||(this.wallGroup=new THREE.Object3D);for(var e=0;e<this.subCorners.length;e++){this.subCorners[e].build()}for(e=0;e<this.subWalls.length;e++){var t=this.subWalls[e];t.build(),this.enableDelayLoadMode||this.wallGroup.add(t.wallGroup)}this.mesh=this.wallGroup},t.prototype.buildHeadAndFootWall=function(e,t,r){var i=this.position,n=this.getDoorOrWinRectPoints(e),o=n[0].distanceTo(i.clone().addVectors(this.cornersVertices[0],i)),a=n[1].distanceTo(i.clone().addVectors(this.cornersVertices[1],i)),s=e.suspendPercent;(new THREE.Vector3).crossVectors(this.direction,this.vectorUp);var l=e.size.y+this.height*s;if(0!==e.suspendPercent){var c=new Wo;this.subWalls.push(c),c.parent=this.parent,c.startCorner=t,c.endCorner=r,(h=new THREE.Vector3).subVectors(r.position,t.position);var u=h.length();c.height=this.height*s,c.thick=this.thick,c.startUVPercent=[o/this.rightSideLength,0,a/this.leftSideLength,0],c.endUVPercent[0]=(o+u)/this.rightSideLength,c.endUVPercent[1]=c.height/this.height,c.endUVPercent[2]=(a+u)/this.leftSideLength,c.endUVPercent[3]=c.height/this.height,c.uvMultiple=this.uvMultiple,c.repeatUV=this.repeatUV,c.leftResource=this.leftResource,c.rightResource=this.rightResource,c.edgeResource=this.edgeResource,c.lightMapResource=this.lightMapResource,c.parentWall=this}if(l<this.height){var h,p=new Wo;this.subWalls.push(p),p.parent=this.parent,p.startCorner=t,p.endCorner=r,(h=new THREE.Vector3).subVectors(r.position,t.position);u=h.length();p.suspend=l,p.height=this.height-l,p.thick=this.thick,p.startUVPercent=[o/this.rightSideLength,l/this.height,a/this.leftSideLength,l/this.height],p.endUVPercent[0]=(o+u)/this.rightSideLength,p.endUVPercent[2]=(a+u)/this.leftSideLength,p.uvMultiple=this.uvMultiple,p.repeatUV=this.repeatUV,p.leftResource=this.leftResource,p.rightResource=this.rightResource,p.edgeResource=this.edgeResource,p.lightMapResource=this.lightMapResource,p.parentWall=this}},t.prototype.setCornerVertices=function(e,t){var r,i;t?((r=new THREE.Vector3).addVectors(this.cornersVertices[0],this.position),r.sub(e.position),(i=new THREE.Vector3).addVectors(this.cornersVertices[1],this.position),i.sub(e.position),e.cornersVertices[0]=r,e.cornersVertices[1]=i):((r=new THREE.Vector3).addVectors(this.cornersVertices[2],this.position),r.sub(e.position),(i=new THREE.Vector3).addVectors(this.cornersVertices[3],this.position),i.sub(e.position),e.cornersVertices[2]=r,e.cornersVertices[3]=i)},t.prototype.getDoorOrWinRectPoints=function(e){var t=this.thick/2,r=new THREE.Vector3;r.crossVectors(this.vectorUp,this.direction),r.normalize();var i=r.clone();i.negate(),this.vectorUp.clone().multiplyScalar(t);var n=e.size,o=this.direction,a=e.position,s=n.x/2,l=new THREE.Vector3,c=new THREE.Vector3;return l.subVectors(a,o.clone().multiplyScalar(s)),c.addVectors(a,o.clone().multiplyScalar(s)),[l.clone().addVectors(l,r.clone().multiplyScalar(t)),l.clone().addVectors(l,i.clone().multiplyScalar(t)),c.clone().addVectors(c,i.clone().multiplyScalar(t)),c.clone().addVectors(c,r.clone().multiplyScalar(t))]},t}(Go),Yo=function(e){function n(){return to(this,n),no(this,e.call(this))}return io(n,e),n.createSubWallCorner=function(e,t,r){var i=new n;return i.id=e,i.position=t,i.parent=r.parent,i},n.prototype.isFirstWallShouldNotCal=function(e){return!(e instanceof Wo)},n.prototype.isSecondWallShouldNotCal=function(e){return e&&!(e instanceof Wo)},n}(function(n){function o(e,t,r){to(this,o);var i=no(this,n.call(this));return i.walls=[],i.position=new THREE.Vector3(e,t,r),i}return io(o,n),o.prototype.addWall=function(e){for(var t=0,r=this.walls.length;t<r;t++)if(this.walls[t]===e)return void console.error("repeat wall"+e);this.walls.push(e)},o.prototype.build=function(){var e=this.getSameHeightWalls();for(var t in e)this.calWallsVertices(e[t])},o.prototype.isFirstWallShouldNotCal=function(e){return!(e instanceof Xo)||e instanceof Wo},o.prototype.isSecondWallShouldNotCal=function(e){return null!=e&&(e.resource&&e.resource.isModel||e instanceof Wo)},o.prototype.getSameHeightWalls=function(){for(var e={},t=0;t<this.walls.length;t++){var r=this.walls[t];this.isStraightManualWall(r)&&(void 0===e[r.height]&&(e[r.height]=[]),e[r.height].push(r))}return e},o.prototype.isStraightManualWall=function(e){return e instanceof Xo},o.prototype.calWallsVertices=function(e){var t=new THREE.Vector3(0,-1,0);if(1===e.length){var r=e[0];r instanceof Xo&&this.setDefaultCornerVertices(r)}else{this.sortWalls(e);for(var i=0;i<e.length;i++){var n=e[i];if(!this.isFirstWallShouldNotCal(n)){for(var o=null,a=i;null==o&&(a===e.length-1?a=0:a+=1,e[a]!==n);)o=e[a],this.isSecondWallShouldNotCal(o)&&(o=null);if(o){var s=n.getWallOtherCorner(this).position,l=new THREE.Vector3;l.subVectors(s,this.position),s=o.getWallOtherCorner(this).position;var c=new THREE.Vector3;if(c.subVectors(s,this.position),l.normalize(),c.normalize(),0!==l.length()&&0!==c.length()){var u=n.thick/2,h=new THREE.Vector3;h.crossVectors(t,l),h.normalize();var p=h.clone();p.multiplyScalar(u),p.add(this.position),u=o.thick/2;var d=c.clone();d.cross(t),d.normalize();var f=d.clone();if(f.multiplyScalar(u),f.add(this.position),this.setCornersVertices(n,p,!0),this.setCornersVertices(o,f,!1),l.normalize(),c.normalize(),30<this.calAngle(l,c)){var m;if(1===Math.abs(l.dot(c))){var g=l.clone();g.cross(t),g.normalize(),this.setDefaultCornerVertices(n,!0),this.setDefaultCornerVertices(o,!0);continue}if(0!==(m=this.getIntersectPosition(p,l,f,c)).x||0!==m.y||0!==m.z)m.clone().y=this.position.y+this.getWallHeight(),this.setCornersVertices(n,m,!0),this.setCornersVertices(o,m,!1)}else this.setCornersVertices(n,p,!0),this.setCornersVertices(o,f,!1)}else this.setDefaultCornerVertices(n,!0),this.setDefaultCornerVertices(o,!1)}else this.setDefaultCornerVertices(n)}}}},o.prototype.sortWalls=function(e){if(1<e.length)for(var t,r,i=e[0],n=0,o=e.length-1;n<o;){for(r=n;r<o;++r)this.angleBetween(i,e[r])>this.angleBetween(i,e[r+1])&&(t=e[r],e[r]=e[r+1],e[r+1]=t);for(r=--o;n<r;--r)this.angleBetween(i,e[r])<this.angleBetween(i,e[r-1])&&(t=e[r],e[r]=e[r-1],e[r-1]=t);++n}},o.prototype.angleBetween=function(e,t){var r=e.getWallOtherCorner(this).position.clone();r.sub(this.position);var i=t.getWallOtherCorner(this).position.clone();return i.sub(this.position),this.calAngle(r,i)},o.prototype.calAngle=function(e,t){e.normalize(),t.normalize();var r=e.angleTo(t);r*=180/Math.PI;var i=e.clone();return i.cross(t),0<i.y&&(r=360-r),r},o.prototype.getWallHeight=function(){for(var e=99999,t=0;t<this.walls.length;t++){var r=this.walls[t];e>r.height&&(e=r.height)}return e},o.prototype.setCornersVertices=function(e,t,r){var i=new THREE.Vector3(0,0,0);i.x=t.x-e.position.x,i.y=t.y-e.position.y,i.z=t.z-e.position.z,e.startCorner===this?r?(e.cornersVertices[0].x=i.x,e.cornersVertices[0].y=i.y,e.cornersVertices[0].z=i.z):(e.cornersVertices[1].x=i.x,e.cornersVertices[1].y=i.y,e.cornersVertices[1].z=i.z):r?(e.cornersVertices[2].x=i.x,e.cornersVertices[2].y=i.y,e.cornersVertices[2].z=i.z):(e.cornersVertices[3].x=i.x,e.cornersVertices[3].y=i.y,e.cornersVertices[3].z=i.z)},o.prototype.setDefaultCornerVertices=function(e,t){var r=new THREE.Vector3(0,-1,0),i=e.getWallOtherCorner(this).position.clone();i.sub(this.position),i.normalize();var n=e.thick/2,o=r.clone();o.cross(i),o.normalize(),o.multiplyScalar(n);var a=new THREE.Vector3;a.addVectors(this.position,o);var s=new THREE.Vector3;s.subVectors(this.position,o),void 0===t?(this.setCornersVertices(e,a,!0),this.setCornersVertices(e,s,!1)):t?this.setCornersVertices(e,a,!0):this.setCornersVertices(e,s,!1)},o.prototype.getIntersectPosition=function(e,t,r,i){if(e.x===r.x&&e.y===r.y&&e.z===r.z)return e;var n=e.y;if(1===t.dot(i))throw"two line in same direction ,can not cal intersected position!";var o=new THREE.Vector3,a=new THREE.Vector3;o.addVectors(e,t),a.addVectors(r,i);var s=new THREE.Vector2(e.x,e.z),l=new THREE.Vector2(o.x,o.z),c=new THREE.Vector2(r.x,r.z),u=new THREE.Vector2(a.x,a.z),h=(l.y-s.y)*(u.x-c.x)-(s.x-l.x)*(c.y-u.y);if(0==h)return new THREE.Vector3;var p=((l.x-s.x)*(u.x-c.x)*(c.y-s.y)+(l.y-s.y)*(u.x-c.x)*s.x-(u.y-c.y)*(l.x-s.x)*c.x)/h,d=-((l.y-s.y)*(u.y-c.y)*(c.x-s.x)+(l.x-s.x)*(u.y-c.y)*s.y-(u.x-c.x)*(l.y-s.y)*c.y)/h;return new THREE.Vector3(p,n,d)},o}(Bo)),Qo=function(t){function r(){to(this,r);var e=no(this,t.call(this));return e.resource=null,e.model=null,e.objPositions=[],e.objLocalPositions=[],e.objRotations=[],e.objScales=[],e.modelSize=new THREE.Vector3,e.box=new THREE.Box3,e.heightRatio=1,e.modelNumber=-1,e.models=[],e.mesh=new THREE.Object3D,e.wallGroup=e.mesh,e.subWalls=[],e.subCorners=[],e}return io(r,t),r.prototype.build=function(){this.baseBuild(),this.resource&&(this.resource.ready||uo.enableCombine?this.model=this.resource.model:this.resource.registerListener(this)),null!==this.model&&(this.calObjInfo(),this.enableBuildMesh&&this.instanceModels())},r.prototype.resourceCallback=function(e){this.model=e.model,this.calObjInfo(),this.instanceModels()},r.prototype.instanceModels=function(){if(null!==this.model){this.models=[];for(var e=this.modelNumber,t=0;t<e;t++){var r=this.model.clone(),i=this.objPositions[t],n=this.objRotations[t],o=this.objScales[t];r.position.set(i.x,i.y,i.z),r.quaternion.set(n.x,n.y,n.z,n.w),r.scale.set(o.x,o.y,o.z),this.mesh.add(r),this.models.push(r)}}},r.prototype.calObjInfo=function(){if(this.objPositions=[],this.objRotations=[],this.objScales=[],null!==this.model){this.box.makeEmpty(),this.box=this.box.setFromObject(this.model),this.modelSize=this.box.getSize(new THREE.Vector3(0,0,0)),-1===this.height?this.height=this.modelSize.y:0!==this.modelSize.y?this.heightRatio=this.height/this.modelSize.y:(console.warn("model size is zero "+this.resource.id),this.height=3);var e=new THREE.Vector3(0,1,0),t=this.modelSize.x,r=(this.modelSize.z,this.modelSize.y),i=this.length/t,n=parseInt(i),o=Math.ceil(i),a=(this.modelNumber=o)*t,s=new THREE.Vector3,l=this.direction.clone();s.addVectors(this.startCorner.position,l.multiplyScalar(a));var c=new THREE.Vector3;c.crossVectors(this.direction,e),c.normalize();var u=new THREE.Quaternion;0===c.x&&0===c.y&&0===c.z||u.setFromUnitVectors(new THREE.Vector3(0,0,1),c);var h=.5*t,p=new THREE.Vector3(h,0,0);this.position;p.applyQuaternion(u);for(var d=0;d<o;d++){var f=d/o,m=new THREE.Vector3;m.lerpVectors(this.startCorner.position,s,f);var g=new THREE.Vector3;g.addVectors(p,m),this.objPositions.push(g),this.objRotations.push(u);var v=new THREE.Vector3(1,this.height/r,1);this.objScales.push(v)}var y=(i-n)*t,b=y/t;if(0<o&&0<y){this.objScales[o-1]=new THREE.Vector3(b,this.height/r,1);var x=h,E=new THREE.Vector3(-x*(1-b),0,0);E.applyQuaternion(u),this.objPositions[o-1].add(E)}}},r}(zo),Jo=function(t){function r(){to(this,r);var e=no(this,t.call(this));return e.resource=null,e.model=null,e.objPositions=[],e.objLocalPositions=[],e.objRotations=[],e.objScales=[],e.modelSize=new THREE.Vector3,e.box=new THREE.Box3,e.heightRatio=1,e.modelNumber=-1,e.models=[],e.mesh=new THREE.Object3D,e.wallGroup=e.mesh,e.subWalls=[],e.subCorners=[],e}return io(r,t),r.prototype.build=function(){this.baseBuild(),this.resource&&(this.resource.ready||uo.enableCombine?this.model=this.resource.model:this.resource.registerListener(this)),null===this.model&&uo.enableCombine||(this.calObjInfo(),this.enableBuildMesh&&this.instanceModels())},r.prototype.resourceCallback=function(e){this.model=e.model,this.calObjInfo(),this.instanceModels()},r.prototype.instanceModels=function(){if(null!==this.model){this.models=[];for(var e=this.modelNumber,t=0;t<e;t++){var r=this.model.clone(),i=this.objPositions[t],n=this.objRotations[t],o=this.objScales[t];r.position.set(i.x,i.y,i.z),r.quaternion.set(n.x,n.y,n.z,n.w),r.scale.set(o.x,o.y,o.z),this.mesh.add(r),this.models.push(r)}}},r.prototype.calObjInfo=function(){if(this.objPositions=[],this.objRotations=[],this.objScales=[],null!==this.model)if(this.box.makeEmpty(),this.box=this.box.setFromObject(this.model),this.modelSize=this.box.getSize(new THREE.Vector3(0,0,0)),-1===this.height?this.height=this.modelSize.y:0!==this.modelSize.y?this.heightRatio=this.height/this.modelSize.y:(console.warn("model size is zero "+this.resource.id),this.height=3),0!==this.height){var e=new THREE.Vector3(0,1,0),t=this.modelSize.x,r=(this.modelSize.z,this.modelSize.y),i=this.length/t,n=parseInt(i),o=Math.ceil(i),a=(this.modelNumber=o)*t,s=new THREE.Vector3,l=this.direction.clone();s.addVectors(this.startCorner.position,l.multiplyScalar(a));var c=new THREE.Vector3;c.crossVectors(this.direction,e),c.normalize();var u=new THREE.Quaternion;0===c.x&&0===c.y&&0===c.z||u.setFromUnitVectors(new THREE.Vector3(0,0,1),c);var h=.5*t,p=new THREE.Vector3(h,0,0);this.position;p.applyQuaternion(u);for(var d=0;d<o;d++){var f=d/o,m=new THREE.Vector3;m.lerpVectors(this.startCorner.position,s,f);var g=new THREE.Vector3;g.addVectors(p,m),this.objPositions.push(g),this.objRotations.push(u);var v=new THREE.Vector3(1,this.height/r,1);this.objScales.push(v)}var y=(i-n)*t,b=y/t;if(0<o&&0<y){this.objScales[o-1]=new THREE.Vector3(b,this.height/r,1);var x=h,E=new THREE.Vector3(-x*(1-b),0,0);E.applyQuaternion(u),this.objPositions[o-1].add(E)}}else console.error("size is zero")},r.prototype.initSimpleCornersAndWalls=function(){for(var e=this.sortDoorOrWins(),t=0;t<e.length;t++){var r=e[t],i=this.getDoorOrWinStartAndEndPos(r),n=Yo.createSubWallCorner(this.id+"_"+t+"_1",i[0],this),o=Yo.createSubWallCorner(this.id+"_"+t+"_2",i[1],this);if(this.addSubWallCorner(n),this.addSubWallCorner(o),0===t){var a=new Qo;a.resource=this.resource,this.subWalls.push(a),a.startCorner=this.startCorner,a.endCorner=n,a.startCorner.build(),a.endCorner.build(),a.parentWall=this,a.height=this.height}else{var s=e[t-1],l=this.getDoorOrWinStartAndEndPos(s),c=this.getWallCornerByPos(l[1]),u=new Qo;u.resource=this.resource,this.subWalls.push(u),u.startCorner=c,u.endCorner=n,u.startCorner.build(),u.endCorner.build(),u.parentWall=this,u.height=this.height}if(t==e.length-1){var h=new Qo;h.resource=this.resource,this.subWalls.push(h),h.startCorner=o,h.endCorner=this.endCorner,h.startCorner.build(),h.parentWall=this,h.height=this.height}}},r.prototype.buildSimpleCornersAndWalls=function(){this.wallGroup=new THREE.Object3D;for(var e=0;e<this.subCorners.length;e++){this.subCorners[e].build()}for(e=0;e<this.subWalls.length;e++){var t=this.subWalls[e];t.build(),this.wallGroup.add(t.wallGroup)}},r}(zo),Zo=function(t){function r(){to(this,r);var e=no(this,t.call(this));return e.resource=null,e.mesh=new THREE.Object3D,e.groups=[],e.placements=[],e.delayObject=new THREE.Object3D,e.belongRoomUserID=null,e}return io(r,t),r.prototype.build=function(){for(var e=0;e<this.groups.length;e++){var t=this.groups[e];t.build(),this.mesh.add(t.mesh)}for(e=0;e<this.placements.length;e++){var r=this.placements[e];r.build(),this.mesh.add(r.delayObject)}this.mesh.position.set(this.position.x,this.position.y,this.position.z),this.mesh.quaternion.set(this.rotation.x,this.rotation.y,this.rotation.z,this.rotation.w),this.mesh.scale.set(this.scale.x,this.scale.y,this.scale.z),this.delayObject=this.mesh},r}(ho),Ko=function(){function r(e,t){to(this,r),this.vertexCount=0,this.indexCount=0,this.material=e,this.bundeMeshs=[],this.groups=[],this.transformations=[],this.maxCount=65534,this.combineMesh=null,this.combineManager=t}return r.prototype.isExceed=function(e){return this.vertexCount+e>this.maxCount},r.prototype.build=function(){for(var e=this.bundeMeshs,t=this.indexCount,r=this.vertexCount,i=new Float32Array(3*r),n=new Float32Array(3*r),o=new Float32Array(2*r),a=new Float32Array(4*r),s=new Float32Array(2*r),l=new Uint16Array(t),c=0,u=0,h=0,p=0,d=0,f=new THREE.BufferGeometry,m=0;m<e.length;m++){for(var g=e[m],v=this.transformations[m],y=v.positions,b=v.scales,x=v.quaternions,E=g.indexArray,_=0;_<E.length;_++)l[_+p]=c/3+E[_];p+=E.length;var w=g.positionArray;for(_=0;_<w.length;){for(var T=new THREE.Vector3(w[_],w[_+1],w[_+2]),M=y.length-1;-1<M;M--){var S=y[M],R=b[M],P=x[M];T.x*=R.x,T.y*=R.y,T.z*=R.z,(T=T.applyQuaternion(P)).x+=S.x,T.y+=S.y,T.z+=S.z}i[_+c]=T.x,i[_+c+1]=T.y,i[_+c+2]=T.z,_+=3}c+=w.length;var A=g.normalArray;for(_=0;_<A.length;){var C=new THREE.Vector3(A[_],A[_+1],A[_+2]);for(M=x.length-1;-1<M;M--){P=x[M];C=C.applyQuaternion(P)}n[_+u]=C.x,n[_+u+1]=C.y,n[_+u+2]=C.z,_+=3}u+=A.length;var L=g.uvArray;if(L)for(_=0;_<L.length;_++)o[_+h]=L[_];var O=g.uv2Array;if(O)for(_=0;_<O.length;_++)s[_+h]=O[_];L&&(h+=L.length);var H=g.colorArray;if(H){for(_=0;_<H.length;_++)a[_+d]=H[_];d+=H.length}}f.addAttribute("position",new THREE.BufferAttribute(i,3)),f.addAttribute("normal",new THREE.BufferAttribute(n,3)),f.addAttribute("uv",new THREE.BufferAttribute(o,2)),0!==s.length&&f.addAttribute("uv2",new THREE.BufferAttribute(s,2)),0!==a.length&&f.addAttribute("color",new THREE.BufferAttribute(a,4)),f.setIndex(new THREE.BufferAttribute(l,1));var F=new THREE.Mesh(f,this.material);this.material.defines&&this.material.defines.USE_ALPHAINDEX&&delete this.material.defines.USE_ALPHAINDEX,F.name="combine",this.combineMesh=F},r}(),$o=function(r){function i(e,t){return to(this,i),no(this,r.call(this,e,t))}return io(i,r),i.prototype.add=function(e,t){if(this.isExceed(e.vertexCount))return console.warn("combine exceed vertex count "),!1;this.vertexCount+=e.vertexCount,this.indexCount+=e.indexCount,this.bundeMeshs.push(e),this.transformations.push(t)},i.prototype.cloneGroups=function(e){for(var t=[],r=0;r<e.length;r++){var i=e[r];t.push(fo.cloneJSObject(i))}return t},i.prototype.build=function(){for(var e=this.bundeMeshs,t=this.indexCount,r=this.vertexCount,i=[],n=new Float32Array(3*r),o=new Float32Array(3*r),a=new Float32Array(2*r),s=new Float32Array(4*r),l=new Float32Array(1*r),c=new Float32Array(2*r),u=new Float32Array(2*r),h=new Uint16Array(t),p=0,d=0,f=0,m=0,g=0,v=0,y=new THREE.BufferGeometry,b=0,x=0;x<e.length;x++){var E=e[x],_=this.transformations[x],w=_.positions,T=_.scales,M=_.quaternions,S=E.indexArray;if(0<E.groups.length){var R=this.cloneGroups(E.groups);R.forEach(function(e){e.start+=b}),i=i.concat(R)}b+=S.length;for(var P=0;P<S.length;P++)h[P+m]=p/3+S[P];m+=S.length;var A=E.positionArray;for(P=0;P<A.length;){for(var C=new THREE.Vector3(A[P],A[P+1],A[P+2]),L=w.length-1;-1<L;L--){var O=w[L],H=T[L],F=M[L];C.x*=H.x,C.y*=H.y,C.z*=H.z,(C=C.applyQuaternion(F)).x+=O.x,C.y+=O.y,C.z+=O.z}n[P+p]=C.x,n[P+p+1]=C.y,n[P+p+2]=C.z,P+=3}p+=A.length;var k=E.normalArray;for(P=0;P<k.length;){var I=new THREE.Vector3(k[P],k[P+1],k[P+2]);for(L=M.length-1;-1<L;L--){F=M[L];I=I.applyQuaternion(F)}o[P+d]=I.x,o[P+d+1]=I.y,o[P+d+2]=I.z,P+=3}d+=k.length;var j=E.uvArray;if(j)for(P=0;P<j.length;P++)a[P+f]=j[P];var N=E.uv2Array;if(N)for(P=0;P<N.length;P++)c[P+f]=N[P];var D=E.uv3Array;if(D)for(P=0;P<D.length;P++)u[P+f]=D[P];j&&(f+=j.length);var U=E.colorArray;if(U){for(P=0;P<U.length;P++)s[P+g]=U[P];g+=U.length;for(P=3;P<U.length;P+=4)l[(P-3)/4+v]=U[P];v+=U.length/4}}y.addAttribute("position",new THREE.BufferAttribute(n,3)),y.addAttribute("normal",new THREE.BufferAttribute(o,3)),y.addAttribute("uv",new THREE.BufferAttribute(a,2)),0!==c.length&&y.addAttribute("uv2",new THREE.BufferAttribute(c,2)),0!==u.length&&y.addAttribute("uv3",new THREE.BufferAttribute(u,2)),0!==s.length&&y.addAttribute("color",new THREE.BufferAttribute(s,4)),0!==l.length&&y.addAttribute("alphaIndex",new THREE.BufferAttribute(l,1)),y.setIndex(new THREE.BufferAttribute(h,1)),y.groups=i;var V=new THREE.Mesh(y,this.material);V.name="combine",this.combineMesh=V,this.combineMesh.name="mesh"},i}(Ko),ea=function(){function t(){to(this,t),this.positions=[],this.scales=[],this.quaternions=[]}return t.prototype.clone=function(){var e=new t;return e.positions=this.positions.slice(),e.scales=this.scales.slice(),e.quaternions=this.quaternions.slice(),e},t}(),ta=function(i){function n(e,t){to(this,n);var r=no(this,i.call(this,e,t));return r.meshInfos=[],r}return io(n,i),n.prototype.add=function(e){if(this.isExceed(e.indexArray.length))return console.warn("combine exceed vertex count "),!1;this.vertexCount+=e.indexArray.length,this.indexCount+=e.indexArray.length,this.meshInfos.push(e)},n.prototype.build=function(){for(var e=this.meshInfos,t=this.indexCount,r=this.vertexCount,i=new Float32Array(3*r),n=new Float32Array(3*r),o=new Float32Array(2*r),a=new Float32Array(4*r),s=new Float32Array(2*r),l=new Uint16Array(t),c=0,u=0,h=0,p=0,d=0,f=new THREE.BufferGeometry,m=0;m<e.length;m++){for(var g=e[m],v=g.parentPosition,y=g.indexArray,b=0;b<y.length;b++)l[b+p]=c/3+y[b];p+=y.length;var x=g.positionArray;for(b=0;b<x.length;){var E=new THREE.Vector3(x[b]+v.x,x[b+1]+v.y,x[b+2]+v.z);i[b+c]=E.x,i[b+c+1]=E.y,i[b+c+2]=E.z,b+=3}c+=x.length;var _=g.normalArray;for(b=0;b<_.length;){var w=new THREE.Vector3(_[b],_[b+1],_[b+2]);n[b+u]=w.x,n[b+u+1]=w.y,n[b+u+2]=w.z,b+=3}u+=_.length;var T=g.uvArray;if(T)for(b=0;b<T.length;b++)o[b+h]=T[b];var M=g.uv2Array;if(M)for(b=0;b<M.length;b++)s[b+h]=M[b];T&&(h+=T.length);var S=g.colorArray;if(S){for(b=0;b<S.length;b++)a[b+d]=S[b];d+=S.length}}f.addAttribute("position",new THREE.BufferAttribute(i,3)),f.addAttribute("normal",new THREE.BufferAttribute(n,3)),f.addAttribute("uv",new THREE.BufferAttribute(o,2)),0!==s.length&&f.addAttribute("uv2",new THREE.BufferAttribute(s,2)),0!==a.length&&f.addAttribute("color",new THREE.BufferAttribute(a,4)),f.setIndex(new THREE.BufferAttribute(l,1));var R=new THREE.Mesh(f,this.material);this.material.defines&&this.material.defines.USE_ALPHAINDEX&&delete this.material.defines.USE_ALPHAINDEX,R.name="combine",this.combineMesh=R,this.combineMesh.name="manualWall"},n}(Ko),ra=function(i){function n(e,t){to(this,n);var r=no(this,i.call(this,e,t));return r.meshInfos=[],r.geometrys=[],r}return io(n,i),n.prototype.add=function(e){this.geometrys.push(e)},n.prototype.build=function(){for(var e=new THREE.Geometry,t=0;t<this.geometrys.length;t++){var r=this.geometrys[t];e.merge(r)}var i=new THREE.Mesh(e,this.material);this.material.defines&&this.material.defines.USE_ALPHAINDEX&&delete this.material.defines.USE_ALPHAINDEX,i.name="combine",i.rotateX(-Math.PI/2),i.position.y=.1,this.combineMesh=i,this.combineMesh.name="floor"},n}(Ko),ia=function(i){function n(e,t){to(this,n);var r=no(this,i.call(this,e,t));return r.meshInfos=[],r.geometrys=[],r.height=3,r}return io(n,i),n.prototype.add=function(e){this.geometrys.push(e)},n.prototype.build=function(){for(var e=new THREE.Geometry,t=0;t<this.geometrys.length;t++){var r=this.geometrys[t];e.merge(r)}var i=new THREE.Mesh(e,this.material);this.material.defines&&this.material.defines.USE_ALPHAINDEX&&delete this.material.defines.USE_ALPHAINDEX,i.name="combine",i.rotateX(Math.PI/2),i.position.y=this.height,this.combineMesh=i,this.combineMesh.name="ceiling"},n}(Ko),na=function(i){function n(e,t){to(this,n);var r=no(this,i.call(this,e,t));return r.meshInfos=[],r.geometrys=[],r}return io(n,i),n.prototype.add=function(e){this.geometrys.push(e)},n.prototype.build=function(){for(var e=new THREE.Geometry,t=0;t<this.geometrys.length;t++){var r=this.geometrys[t];e.merge(r)}var i=new THREE.Mesh(e,this.material);this.material.defines&&this.material.defines.USE_ALPHAINDEX&&delete this.material.defines.USE_ALPHAINDEX,i.name="combine",i.rotateX(-Math.PI/2),i.position.y=3.1,this.combineMesh=i,this.combineMesh.name="roof"},n}(Ko),oa=function(){function t(e){to(this,t),this.resourceManager=e,this.combineBundleObjectMap={},this.processors=[]}return t.prototype.combineModels=function(){var o=this.resourceManager.models,e=[],a=this;for(var s in o)e.push(new Promise(function(e,t){var r=performance.now(),i=o[s],n=new Po(i.model);(a.combineBundleObjectMap[i.id]=n).combine(),.1<performance.now()-r?setTimeout(function(){e()},10):e()}));return Promise.all(e)},t.prototype.getModelObject=function(e){var t=this.combineBundleObjectMap[e];return t||null},t.prototype.addGroup=function(e,t,r){t.curPlacementCombineProcessorMap,t.placementCombineProcessors;r||(r=new ea),r.positions.push(e.position),r.scales.push(e.scale),r.quaternions.push(e.rotation);for(var i=0;i<e.placements.length;i++){var n=e.placements[i];n.isShow&&this.addPlacement(n,t,r.clone())}for(i=0;i<e.groups.length;i++){var o=e.groups[i];o.isShow&&this.addGroup(o,t,r.clone())}},t.prototype.addDoorOrWindow=function(e,t,l){var c=t.curDoorOrWinCombineProcessorMap,u=t.doorOrWindowCombineProcessors;l||(l=new ea),l.positions.push(e.position),l.scales.push(e.scale),l.quaternions.push(e.rotation),this.combineBundleObjectMap[e.resource.id].materialMap.forEach(function(e,t,r){for(var i=e,n=t,o=0;o<i.length;o++){var a=i[o],s=c.get(n);s&&!s.isExceed(a.vertexCount)||(s=new $o(n,this),c.set(n,s),u.push(s)),s.add(a,l)}})},t.prototype.addPlacement=function(e,t,l){var c=t.curPlacementCombineProcessorMap,u=t.placementCombineProcessors;l||(l=new ea),l.positions.push(e.position),l.scales.push(e.scale),l.quaternions.push(e.rotation),this.combineBundleObjectMap[e.resource.id].materialMap.forEach(function(e,t,r){for(var i=e,n=t,o=0;o<i.length;o++){var a=i[o],s=c.get(n);s&&!s.isExceed(a.vertexCount)||(s=new $o(n,this),c.set(n,s),u.push(s)),s.add(a,l)}})},t.prototype.addStraightManualWall=function(e,t){var r=t.curStraightManualWallCombineProcessorMap,i=t.straightManualWallCombineProcessors;e.build();var n=e.rightSideMeshInfo,o=e.leftSideMeshInfo,a=e.edgeSideMeshInfo;this.addWallMeshInfo(n,e.position,r,i),this.addWallMeshInfo(o,e.position,r,i),this.addWallMeshInfo(a,e.position,r,i)},t.prototype.addModelWall=function(e,t){for(var l=t.curModelWallCombineProcessorMap,c=t.modelWallCombineProcessors,r=this.combineBundleObjectMap[e.resource.id],i=0;i<e.modelNumber;i++){var n=e.objPositions[i],o=e.objRotations[i],a=e.objScales[i],u=new ea;u.positions.push(n),u.scales.push(a),u.quaternions.push(o),r.materialMap.forEach(function(e,t,r){for(var i=e,n=t,o=0;o<i.length;o++){var a=i[o],s=l.get(n);s&&!s.isExceed(a.vertexCount)||(s=new $o(n,this),l.set(n,s),c.push(s)),s.add(a,u)}})}},t.prototype.addRoom=function(e,t){this.addRoomShapeGeometry(e.floor.material,e.floor.geometry,t.height,ra,t.curFloorCombineProcessorMap,t.floorCombineProcessors),e.isOnlyFloor||(this.addRoomShapeGeometry(e.ceiling.material,e.ceiling.geometry,t.height,ia,t.curCeilingCombineProcessorMap,t.ceilingCombineProcessors),this.addRoomShapeGeometry(e.roof.material,e.roof.geometry,t.height,na,t.curRoofCombineProcessorMap,t.roofCombineProcessors))},t.prototype.addWallMeshInfo=function(e,t,r,i){var n=e.material;e.parentPosition=t;var o=r.get(n);o||((o=new ta(n,this)).height=i.push(o),r.set(n,o)),o.add(e)},t.prototype.addRoomShapeGeometry=function(e,t,r,i,n,o){var a=e,s=n.get(a);s||(s=new i(a,this),o.push(s),s.height=r,n.set(a,s)),s.add(t)},t.prototype.getCombineProcessors=function(e,t,r,i){var l=[],c=new Map;for(var n in e){var o=e[n];if(!o.uid&&!o.name){var a=this.app.modelResource.bundleIDArray[o.bIdx],s=(this.app.modelResource.get(a).node,new THREE.Vector3(0,0,0)),u=new ea;if(o.pos){var h=o.pos.split(" ");s.x=parseFloat(h[0]),s.y=parseFloat(h[1]),s.z=-parseFloat(h[2])}var p=new THREE.Vector3(1,1,1);if(o.scl){var d=o.scl.split(" ");p.x=parseFloat(d[0]),p.y=parseFloat(d[1]),p.z=parseFloat(d[2])}var f=new THREE.Quaternion(0,0,0,1);if(o.rot){var m=o.rot.split(" ");f.x=parseFloat(m[0]),f.y=parseFloat(m[1]),f.z=-parseFloat(m[2]),f.w=-parseFloat(m[3])}var g=t.slice(),v=r.slice(),y=i.slice();y.push(f),v.push(p),g.push(s),u.positions=g,u.scales=v,u.quaternions=y,this.combineBundleObjectMap[a].materialMap.forEach(function(e,t,r){for(var i=e,n=t,o=0;o<i.length;o++){var a=i[o],s=c.get(n);s&&!s.isExceed(a.vertexCount)||(s=new $o(n),c.set(n,s),l.push(s)),s.add(a,u)}})}}return l},t}(),aa=r(function(L){!function(e){var l,t=Object.prototype,c=t.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",i=r.asyncIterator||"@@asyncIterator",o=r.toStringTag||"@@toStringTag",a=e.regeneratorRuntime;if(a)L.exports=a;else{(a=e.regeneratorRuntime=L.exports).wrap=y;var h="suspendedStart",p="suspendedYield",d="executing",f="completed",m={},s={};s[n]=function(){return this};var u=Object.getPrototypeOf,g=u&&u(u(A([])));g&&g!==t&&c.call(g,n)&&(s=g);var v=_.prototype=x.prototype=Object.create(s);E.prototype=v.constructor=_,_.constructor=E,_[o]=E.displayName="GeneratorFunction",a.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===E||"GeneratorFunction"===(t.displayName||t.name))},a.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,_):(e.__proto__=_,o in e||(e[o]="GeneratorFunction")),e.prototype=Object.create(v),e},a.awrap=function(e){return{__await:e}},w(T.prototype),T.prototype[i]=function(){return this},a.AsyncIterator=T,a.async=function(e,t,r,i){var n=new T(y(e,t,r,i));return a.isGeneratorFunction(t)?n:n.next().then(function(e){return e.done?e.value:n.next()})},w(v),v[o]="Generator",v[n]=function(){return this},v.toString=function(){return"[object Generator]"},a.keys=function(r){var i=[];for(var e in r)i.push(e);return i.reverse(),function e(){for(;i.length;){var t=i.pop();if(t in r)return e.value=t,e.done=!1,e}return e.done=!0,e}},a.values=A,P.prototype={constructor:P,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=l,this.done=!1,this.delegate=null,this.method="next",this.arg=l,this.tryEntries.forEach(R),!e)for(var t in this)"t"===t.charAt(0)&&c.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=l)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(r){if(this.done)throw r;var i=this;function e(e,t){return o.type="throw",o.arg=r,i.next=e,t&&(i.method="next",i.arg=l),!!t}for(var t=this.tryEntries.length-1;0<=t;--t){var n=this.tryEntries[t],o=n.completion;if("root"===n.tryLoc)return e("end");if(n.tryLoc<=this.prev){var a=c.call(n,"catchLoc"),s=c.call(n,"finallyLoc");if(a&&s){if(this.prev<n.catchLoc)return e(n.catchLoc,!0);if(this.prev<n.finallyLoc)return e(n.finallyLoc)}else if(a){if(this.prev<n.catchLoc)return e(n.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<n.finallyLoc)return e(n.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;0<=r;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&c.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var n=i;break}}n&&("break"===e||"continue"===e)&&n.tryLoc<=t&&t<=n.finallyLoc&&(n=null);var o=n?n.completion:{};return o.type=e,o.arg=t,n?(this.method="next",this.next=n.finallyLoc,m):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),R(r),m}},catch:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var i=r.completion;if("throw"===i.type){var n=i.arg;R(r)}return n}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:A(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=l),m}}}function y(e,t,r,i){var o,a,s,l,n=t&&t.prototype instanceof x?t:x,c=Object.create(n.prototype),u=new P(i||[]);return c._invoke=(o=e,a=r,s=u,l=h,function(e,t){if(l===d)throw new Error("Generator is already running");if(l===f){if("throw"===e)throw t;return C()}for(s.method=e,s.arg=t;;){var r=s.delegate;if(r){var i=M(r,s);if(i){if(i===m)continue;return i}}if("next"===s.method)s.sent=s._sent=s.arg;else if("throw"===s.method){if(l===h)throw l=f,s.arg;s.dispatchException(s.arg)}else"return"===s.method&&s.abrupt("return",s.arg);l=d;var n=b(o,a,s);if("normal"===n.type){if(l=s.done?f:p,n.arg===m)continue;return{value:n.arg,done:s.done}}"throw"===n.type&&(l=f,s.method="throw",s.arg=n.arg)}}),c}function b(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}function x(){}function E(){}function _(){}function w(e){["next","throw","return"].forEach(function(t){e[t]=function(e){return this._invoke(t,e)}})}function T(l){var t;this._invoke=function(r,i){function e(){return new Promise(function(e,t){!function t(e,r,i,n){var o=b(l[e],l,r);if("throw"!==o.type){var a=o.arg,s=a.value;return s&&"object"==typeof s&&c.call(s,"__await")?Promise.resolve(s.__await).then(function(e){t("next",e,i,n)},function(e){t("throw",e,i,n)}):Promise.resolve(s).then(function(e){a.value=e,i(a)},n)}n(o.arg)}(r,i,e,t)})}return t=t?t.then(e,e):e()}}function M(e,t){var r=e.iterator[t.method];if(r===l){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=l,M(e,t),"throw"===t.method))return m;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return m}var i=b(r,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,m;var n=i.arg;return n?n.done?(t[e.resultName]=n.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=l),t.delegate=null,m):n:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,m)}function S(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function R(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function P(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(S,this),this.reset(!0)}function A(t){if(t){var e=t[n];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,i=function e(){for(;++r<t.length;)if(c.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=l,e.done=!0,e};return i.next=i}}return{next:C}}function C(){return{value:l,done:!0}}}(function(){return this}()||Function("return this")())}),sa=function(){return this}()||Function("return this")(),la=sa.regeneratorRuntime&&0<=Object.getOwnPropertyNames(sa).indexOf("regeneratorRuntime"),ca=la&&sa.regeneratorRuntime;sa.regeneratorRuntime=void 0;var ua=aa;if(la)sa.regeneratorRuntime=ca;else try{delete sa.regeneratorRuntime}catch(e){sa.regeneratorRuntime=void 0}var ha=ua,pa=function(){function t(e){to(this,t),this.combineManager=e.combineManager}return t.prototype.parseWorld=function(e){var i=ha.mark(a),t=e.outdoors;this.parsePlan(t);for(var r=e.buildings,n=0;n<r.length;n++){var o=r[n];this.parseBuilding(o)}function a(t){var a,s,r,l,c,u,h,p,d,f,m,g;return ha.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:a=.1,s=10,r=0;case 3:if(!(r<t.length)){e.next=64;break}l=t[r],c=l.placementCombineProcessors,u=l.straightManualWallCombineProcessors,h=l.modelWallCombineProcessors,p=l.floorCombineProcessors,d=l.ceilingCombineProcessors,f=l.roofCombineProcessors,m=l.doorOrWindowCombineProcessors,g=0;case 13:if(g<d.length)return e.next=16,new Promise(function(e,t){var r=performance.now(),i=d[g];i.build();var n=i.combineMesh;l.combineCeilings.push(n);var o=performance.now()-r;a<o?setTimeout(function(){e()},s):e()});e.next=19;break;case 16:g++,e.next=13;break;case 19:g=0;case 20:if(g<f.length)return e.next=23,new Promise(function(e,t){var r=performance.now(),i=f[g];i.build();var n=i.combineMesh;l.combineRoofs.push(n);var o=performance.now()-r;a<o?setTimeout(function(){e()},s):e()});e.next=26;break;case 23:g++,e.next=20;break;case 26:g=0;case 27:if(g<p.length)return e.next=30,new Promise(function(e,t){var r=performance.now(),i=p[g];i.build();var n=i.combineMesh;l.combineFloors.push(n);var o=performance.now()-r;a<o?setTimeout(function(){e()},s):e()});e.next=33;break;case 30:g++,e.next=27;break;case 33:g=0;case 34:if(g<c.length)return e.next=37,new Promise(function(e,t){var r=performance.now(),i=c[g];i.build();var n=i.combineMesh;l.combinePlacements.push(n);var o=performance.now()-r;a<o?setTimeout(function(){e()},s):e()});e.next=40;break;case 37:g++,e.next=34;break;case 40:g=0;case 41:if(g<m.length)return e.next=44,new Promise(function(e,t){var r=performance.now(),i=m[g];i.build();var n=i.combineMesh;l.combineDoorOrWins.push(n);var o=performance.now()-r;a<o?setTimeout(function(){e()},s):e()});e.next=47;break;case 44:g++,e.next=41;break;case 47:g=0;case 48:if(g<u.length)return e.next=51,new Promise(function(e,t){var r=performance.now(),i=u[g];i.build();var n=i.combineMesh;l.combineStraightManualWalls.push(n);var o=performance.now()-r;a<o?setTimeout(function(){e()},s):e()});e.next=54;break;case 51:g++,e.next=48;break;case 54:g=0;case 55:if(g<h.length)return e.next=58,new Promise(function(e,t){var r=performance.now(),i=h[g];i.build();var n=i.combineMesh;l.combineModelWalls.push(n);var o=performance.now()-r;a<o?setTimeout(function(){e()},s):e()});e.next=61;break;case 58:g++,e.next=55;break;case 61:r++,e.next=3;break;case 64:case"end":return e.stop()}},i,this)}var s=[];for(n=0;n<e.buildings.length;n++){o=e.buildings[n];for(var l=0;l<o.floorplans.length;l++){var c=o.floorplans[l];s.push(c)}}return s.push(e.outdoors),a(s)},t.prototype.parseBuilding=function(e){for(var t=e.floorplans,r=0;r<t.length;r++){var i=t[r];this.parsePlan(i)}},t.prototype.parsePlan=function(e){for(var t=e.placements,r=e.walls,i=e.rooms,n=[],o=[],a=0;a<t.length;a++){var s=t[a];s.properties||s.name?n.push(s):this.combineManager.addPlacement(s,e)}e.placements=n;for(a=0;a<e.groups.length;a++){var l=e.groups[a];l.properties||l.name?o.push(l):this.combineManager.addGroup(l,e)}e.groups=o;for(a=0;a<r.length;a++){var c=r[a];if(c.isShow){if(0!==c.subWalls.length)for(var u=0;u<c.subWalls.length;u++){var h=c.subWalls[u];h instanceof go?this.combineManager.addStraightManualWall(h,e):this.combineManager.addModelWall(h,e)}else c instanceof bo?this.combineManager.addStraightManualWall(c,e):this.combineManager.addModelWall(c,e);if(0<c.doorOrWindows.length)for(u=0;u<c.doorOrWindows.length;u++){var p=c.doorOrWindows[u];this.combineManager.addDoorOrWindow(p,e)}}}for(a=0;a<i.length;a++){var d=i[a];d.properties||d.name||this.combineManager.addRoom(d,e)}},t}(),da={id:"id",name:"name",position:"position",rotation:"rotation",scale:"scale",properties:"properties",plans:"plans",walls:"walls",placements:"placements",groups:"groups",corners:"corners",doorOrWindows:"doororwindows",rooms:"rooms",height:"height",thick:"thick",texture:"texture",type:"type",model:"model",suspendPercent:"suspendpercent",leftTexture:"lefttexture",rightTexture:"righttexture",edgeTexture:"edgetexture",floorTexture:"floortexture",ceilingTexture:"ceilingtexture",roofTexture:"rooftexture",wallType:"type"},fa=function(){function e(){to(this,e),this.sceneJson=null,this.scale=1,this.curFloorPlan=null,this.enableCombine=!0,this.defaultWallEdgeTextureUri="Textures/WallEdge.jpg",this.defaultWallTextureUri="Textures/RoomWall.jpg",this.defaultFloorTextureUri="Textures/FloorDefault.jpg",this.defaultCeilingTextureUri="Textures/CeilingDefault.jpg",this.defaultRoofTextureUri="Textures/RoofDefault.jpg",this.world=null,this.resourceManager=new Vo,this.combineManager=new oa(this.resourceManager),this.combineParser=new pa(this)}return e.prototype._nestingLoopYield=function(t,r,i){var n=this,e=t.next();if(e.done)return r&&r(),e.value;var o=e.value;e.done;o instanceof Promise?o.then(function(e){return n._nestingLoopYield(t,r,i)}).catch(function(e){i(e)}):this._nestingLoopYield(t,r,i)},e.prototype.load=function(e){var i=this;return e?(e.url&&(this.sceneURL=e.url),e.json&&(this.sceneJson=e.json),new Promise(function(e,t){i.loadSceneJson().then(function(){i.parseSceneJson().then(function(){i.world.build(),i.combineManager.combineModels().then(function(){return console.log("finish combine models"),new Promise(function(e,t){var r=i.combineParser.parseWorld(i.world);r?i._nestingLoopYield(r,function(){e()},function(e){t(e)}):e()})}).then(function(){e(i.world)})})}).catch(function(e){console.error(e)})})):(console.error("load param can not be null"),null)},e.prototype.loadSceneJson=function(){var i=this;return new Promise(function(t,r){if(i.sceneJson)t(i.sceneJson);else if(i.sceneURL){(new THREE.FileLoader).load(i.sceneURL,function(e){i.sceneJson=JSON.parse(e),t()},function(){},function(e){r("can not load "+i.sceneURL)})}else r("load scene json error")})},e.prototype.createTextureLoaderPromise=function(r){return new Promise(function(t,e){(new THREE.TextureLoader).load(r,function(e){e.wrapS=THREE.RepeatWrapping,e.wrapT=THREE.RepeatWrapping,t(e)},function(e){console.log(r+" "+e.loaded/e.total*100+"% loaded")},function(e){t(null),console.log(r+"load error")})})},e.prototype.loadResources=function(){var s=this;return new Promise(function(t,e){var r=s.createTextureLoaderPromise(s.defaultWallTextureUri),i=s.createTextureLoaderPromise(s.defaultWallEdgeTextureUri),n=s.createTextureLoaderPromise(s.defaultFloorTextureUri),o=s.createTextureLoaderPromise(s.defaultRoofTextureUri),a=s.createTextureLoaderPromise(s.defaultCeilingTextureUri);Promise.all([r,i,n,o,a]).then(function(e){co.wallTexture=e[0],co.wallEdgeTexture=e[1],co.floorTexture=e[2],co.roofTexture=e[3],co.ceilingTexture=e[4],t()})})},e.prototype.loadDefaultTexture=function(){var s=this;return new Promise(function(t,e){var r=s.createTextureLoaderPromise(s.defaultWallTextureUri),i=s.createTextureLoaderPromise(s.defaultWallEdgeTextureUri),n=s.createTextureLoaderPromise(s.defaultFloorTextureUri),o=s.createTextureLoaderPromise(s.defaultRoofTextureUri),a=s.createTextureLoaderPromise(s.defaultCeilingTextureUri);Promise.all([r,i,n,o,a]).then(function(e){co.wallTexture=e[0],co.wallEdgeTexture=e[1],co.floorTexture=e[2],co.roofTexture=e[3],co.ceilingTexture=e[4],co.wallMaterial=new THREE.MeshStandardMaterial({color:16777215,map:e[0]}),co.wallEdgeMaterial=new THREE.MeshStandardMaterial({color:16777215,map:e[1]}),co.floorMaterial=new THREE.MeshStandardMaterial({color:16777215,map:e[2]}),co.ceilingMaterial=new THREE.MeshStandardMaterial({color:16777215,map:e[3]}),co.roofMaterial=new THREE.MeshStandardMaterial({color:16777215,map:e[4]}),t()})})},e.prototype.parseSceneJson=function(){var i=this;return new Promise(function(e,t){i.resourceManager.loadTextures(i.sceneJson.textures),i.resourceManager.loadModels(i.sceneJson.models);var r=setInterval(function(){i.resourceManager.checkAllResourcesIsReady()&&(clearInterval(r),i.parseWorld(i.sceneJson),e())},10)})},e.prototype.parseWorld=function(e){var t=new Lo;if(this.world=t,this.parseBaseObject(e,t),e.buildings)for(var r=e.buildings,i=0;i<r.length;i++){var n=r[i],o=this.parseBuilding(n);t.buildings.push(o)}if(e.outdoors){var a=new jo;this.parseFloorPlan(e.outdoors,a),t.outdoors=a}},e.prototype.parseBuilding=function(e,t){var r=e,i=new Oo;this.parseBaseObject(e,i,t);var n=r[da.plans];if(n)for(var o=0;o<n.length;o++){var a=n[o],s=new To;this.parseFloorPlan(a,s,i),i.floorplans.push(s)}return i},e.prototype.parseFloorPlan=function(e,t,r){if(this.parseBaseObject(e,t,r),e[da.height]&&(t.height=e[da.height]),e[da.corners])for(var i=e[da.corners],n=0;n<i.length;n++){var o=i[n],a=o[0],s=o[1],l=-o[2];t.existsCorner(a,s,l)?console.error("repeat corner"):t.addCorner(a,s,l)}if(e[da.walls]){var c=e[da.walls];for(n=0;n<c.length;n++){var u=c[n];this.parseWall(u,t)}}if(e[da.rooms]){var h=e[da.rooms];for(n=0;n<h.length;n++){var p=h[n];this.parseRoom(p,t)}}if(e[da.placements]){var d=e[da.placements];for(n=0;n<d.length;n++){var f=d[n];this.parsePlacement(f,t)}}if(e[da.groups]){var m=e[da.groups];for(n=0;n<m.length;n++){var g=m[n];this.parseGroup(g,t)}}if(e[da.doorOrWindows]){var v=e[da.doorOrWindows];for(n=0;n<v.length;n++){var y=v[n];this.parseDoorOrWindow(y,t)}}return t},e.prototype.parseDoorOrWindow=function(e,t){var r=new So;this.parseBaseObject(e,r,t.parent),r.resource=this.resourceManager.models[e[da.model]],t.doorOrWindows.push(r),e[da.suspendPercent]&&(r.suspendPercent=e[da.suspendPercent]),r.attachWall=t},e.prototype.parsePlacement=function(e,t){var r=new Mo;if(this.parseBaseObject(e,r,t),r.resource=this.resourceManager.models[e[da.model]],void 0!==e.texture&&null!==e.texture&&(r.customTextureResource=this.resourceManager.textures[e.texture]),e.color){var i=e.color;r.customColor=new THREE.Color(i[0],i[1],i[2]),4==i.length&&(r.opacity=i[3])}e.rendermode&&(r.renderMode=e.rendermode),t.placements.push(r)},e.prototype.parseGroup=function(e,t){var r=new Zo;if(this.parseBaseObject(e,r,t),t.groups.push(r),e[da.placements])for(var i=e[da.placements],n=0;n<i.length;n++){var o=i[n];this.parsePlacement(o,r)}if(e[da.groups]){var a=e[da.groups];for(n=0;n<a.length;n++){var s=a[n];this.parseGroup(s,r)}}},e.prototype.parseWall=function(e,t){var r=null;r=0==e[da.wallType]?new bo:new Jo,this.parseBaseObject(e,r,t);var i=e[da.corners];if(r.startCorner=t.corners[i[0]],r.endCorner=t.corners[i[1]],void 0!==e[da.leftTexture]&&(r.rightResource=this.resourceManager.textures[e[da.leftTexture]]),void 0!==e[da.rightTexture]&&(r.leftResource=this.resourceManager.textures[e[da.rightTexture]]),void 0!==e[da.edgeTexture]&&(r.edgeResource=this.resourceManager.textures[e[da.edgeTexture]]),void 0!==e[da.model]&&(r.resource=this.resourceManager.models[e[da.model]]),e[da.doorOrWindows])for(var n=e[da.doorOrWindows],o=0;o<n.length;o++){var a=n[o];this.parseDoorOrWindow(a,r,t)}r.startCorner.addWall(r),r.endCorner.addWall(r),t.addWall(r)},e.prototype.parseRoom=function(e,t){var r=new wo;this.parseBaseObject(e,r,t);for(var i=e[da.corners],n=[],o=0,a=0,s=0,l=0;l<i.length;l++){var c=i[l];o+=(p=t.corners[c].position).x,a+=p.y,s+=p.z,n.push(p)}var u=i.len(),h=new THREE.Vector3(o/u,a/u,s/u);for(l=0;l<n.length;l++){var p;(p=n[l]).x-=h.x,p.y-=h.y,p.z-=h.z}void 0!==e[da.floorTexture]&&(r.floorResource=this.resourceManager.textures[e[da.floorTexture]]),void 0!==e[da.ceilingTexture]&&(r.ceilingResource=this.resourceManager.textures[e[da.ceilingTexture]]),void 0!==e[da.roofTexture]&&(r.roofResource=this.resourceManager.textures[e[da.roofTexture]]),r.points=n,r.position=h,t.rooms.push(r)},e.prototype.parseBaseObject=function(e,t,r){var i,n;if(t.parent=r,e[da.id]&&(i=e[da.id],t.id=i),e[da.name]&&(n=e[da.name],t.name=n),e[da.position]){var o=e[da.position];t.position.set(o[0],o[1],-o[2])}if(e[da.scale]){var a=e[da.scale];t.scale.set(a[0],a[1],a[2])}if(e[da.rotation]){var s=e[da.rotation];t.rotation.set(s[0],s[1],-s[2],-s[3])}e[da.properties]&&(t.properties=e[da.properties])},e.prototype.createRooms=function(){for(var e=[],t=0;t<this.curFloorPlan.rooms.length;t++){var r=this.curFloorPlan.rooms[t];e.push(r.meshGroup)}return e},e.prototype.createWalls=function(){for(var e=[],t=0;t<this.world.buildings.length;t++)for(var r=this.world.buildings[t],i=0;i<r.floorplans.length;i++)for(var n=r.floorplans[i],o=0;o<n.walls.length;o++){var a=n.walls[o];e.push(a.wallGroup)}return e},e.prototype.createWallMesh=function(e){var t=new THREE.BufferGeometry;t.addAttribute("position",new THREE.BufferAttribute(e.positionArray,3)),t.addAttribute("normal",new THREE.BufferAttribute(e.normalArray,3)),t.addAttribute("uv",new THREE.BufferAttribute(e.uvArray,2));var r=e.material;return new THREE.Mesh(t,r)},e}(),ma=function(){function t(e){to(this,t),this.combineManager=e.combineManager}return t.prototype.parseWorld=function(e){var t=e.outdoors;this.parsePlan(t);for(var r=e.buildings,i=0;i<r.length;i++){var n=r[i];this.parseBuilding(n)}var o=[];for(i=0;i<e.buildings.length;i++){n=e.buildings[i];for(var a=0;a<n.floorplans.length;a++){var s=n.floorplans[a];o.push(s)}}o.push(e.outdoors)},t.prototype.parseBuilding=function(e){for(var t=e.floorplans,r=0;r<t.length;r++){var i=t[r];this.parsePlan(i)}for(r=0;r<e.facades.length;r++){var n=e.facades[r];this.addUncombinePlacementResource(n)}for(r=0;r<e.facadeGroups.length;r++){n=e.facadeGroups[r];this.addUncombineGroupResource(n)}},t.prototype.parsePlan=function(e){for(var t=e.placements,r=e.walls,i=e.rooms,n=[],o=[],a=[],s=[],l=[],c=0;c<e.curvelines.length;c++){var u=e.curvelines[c];this.addCommoneTextureResource(u)}for(c=0;c<e.pipelines.length;c++){u=e.pipelines[c];this.addCommoneTextureResource(u)}for(c=0;c<t.length;c++){var h=t[c];this.isPlacementShouldCombine(h)?this.combineManager.addPlacement(h,e):(n.push(h),this.addUncombinePlacementResource(h))}e.placements=n;for(var p=0;p<e.groups.length;p++){var d=e.groups[p];this.isGroupShouldCombine(d)?this.combineManager.addGroup(d,e):(o.push(d),this.addUncombineGroupResource(d))}e.groups=o;for(c=0;c<r.length;c++){var f=r[c];if(f.isShow){if(0!==f.subWalls.length)for(var m=0;m<f.subWalls.length;m++){var g=f.subWalls[m];g instanceof go?this.combineManager.addStraightManualWall(g,e):this.combineManager.addModelWall(g,e)}else f instanceof bo?this.combineManager.addStraightManualWall(f,e):this.combineManager.addModelWall(f,e);if(l=[],0<f.doorOrWindows.length)for(m=0;m<f.doorOrWindows.length;m++){var v=f.doorOrWindows[m];v.resource&&(this.isDoorOrWindowShouldCombine(v)?this.combineManager.addDoorOrWindow(v,e):(l.push(v),this.addUncombinePlacementResource(v)))}f.doorOrWindows=l}}for(c=0;c<i.length;c++){var y=i[c];y.properties||y.userID||y.name||y.floor.height!==y.floor.DefaultHeight?(this.addUncombineRoomResource(y),y.properties||y.userID||y.name?a.push(y):s.push(y)):this.combineManager.addRoom(y,e)}e.rooms=a,e.uncombineWithHeigthRooms=s},t.prototype.isDoorOrWindowShouldCombine=function(e){return!!this.isNullOrUndefined(e.properties)&&(!!this.isNullOrUndefined(e.userID)&&!!this.isNullOrUndefined(e.name))},t.prototype.isPlacementShouldCombine=function(e){return!!this.isNullOrUndefined(e.properties)&&(!!this.isNullOrUndefined(e.userID)&&(!!this.isNullOrUndefined(e.name)&&!!e.isShow))},t.prototype.isGroupShouldCombine=function(e){return!!this.isNullOrUndefined(e.properties)&&(!!this.isNullOrUndefined(e.userID)&&(!!this.isNullOrUndefined(e.name)&&!!e.isShow))},t.prototype.isNullOrUndefined=function(e){return null==e},t.prototype.addUncombineRoomResource=function(e){this.combineManager.resourceManager.addRoomResource(e.floorResource),this.combineManager.resourceManager.addRoomResource(e.ceilingResource),this.combineManager.resourceManager.addRoomResource(e.roofResource),e.floor.initResource(),e.ceiling.initResource(),e.roof.initResource()},t.prototype.addCommoneTextureResource=function(e){e.resource&&(e.initResource(),this.combineManager.resourceManager.addCommonTextureResource(e.resource))},t.prototype.addUncombinePlacementResource=function(e){this.combineManager.resourceManager.addPlacementResource(e.resource),e.initResource()},t.prototype.addUncombineGroupResource=function(e){for(var t=0;t<e.placements.length;t++){var r=e.placements[t];this.addUncombinePlacementResource(r)}for(t=0;t<e.groups.length;t++){var i=e.groups[t];this.addUncombineGroupResource(i)}},t.prototype.buildWorld=function(e){this.buildPlan(e.outdoors);for(var t=e.buildings,r=0;r<t.length;r++){var i=t[r];this.buildBuilding(i)}},t.prototype.buildBuilding=function(e){for(var t=e.floorplans,r=0;r<t.length;r++){var i=t[r];this.buildPlan(i)}},t.prototype.buildPlan=function(e){for(var t=e.placementCombineProcessors,r=e.straightManualWallCombineProcessors,i=e.modelWallCombineProcessors,n=e.floorCombineProcessors,o=e.ceilingCombineProcessors,a=e.roofCombineProcessors,s=e.doorOrWindowCombineProcessors,l=e.uncombineWithHeigthRooms,c=0;c<o.length;c++){(f=o[c]).build();var u=f.combineMesh;e.combineCeilings.push(u)}for(c=0;c<a.length;c++){(f=a[c]).build();u=f.combineMesh;e.combineRoofs.push(u)}for(var h=0;h<l.length;h++){var p=l[h],d=p.position;p.floor.mesh&&p.floor.mesh.position.add(d),p.ceiling.mesh&&p.ceiling.mesh.position.add(d),p.roof.mesh&&p.roof.mesh.position.add(d),e.combineFloors.push(p.floor.mesh),p.ceiling.mesh&&e.combineCeilings.push(p.ceiling.mesh),p.roof.mesh&&e.combineRoofs.push(p.roof.mesh)}for(c=0;c<n.length;c++){(f=n[c]).build();u=f.combineMesh;e.combineFloors.push(u)}for(c=0;c<t.length;c++){(f=t[c]).build(),e.combinePlacements.push(f.combineMesh)}for(c=0;c<s.length;c++){(f=s[c]).build(),e.combineDoorOrWins.push(f.combineMesh)}for(c=0;c<r.length;c++){(f=r[c]).build();u=f.combineMesh;e.combineStraightManualWalls.push(u)}for(c=0;c<i.length;c++){var f;(f=i[c]).build();u=f.combineMesh;e.combineModelWalls.push(u)}},t}(),ga=function(){function i(e,t,r){to(this,i),this.vertexCount=0,this.indexCount=0,this.resource=e,this.bundeMeshs=[],this.transformations=[],this.maxCount=65534,this.combineMesh=new THREE.Object3D,this.combineManager=t,this.plan=r}return i.prototype.isExceed=function(e){return this.vertexCount+e>this.maxCount},i.prototype.build=function(){},i.prototype.resourceCallback=function(e){this.combineMesh.material=e.material},i}(),va=function(i){function n(e,t){to(this,n);var r=no(this,i.call(this,e,t));return r.meshInfos=[],r.geometrys=[],r.height=0,r}return io(n,i),n.prototype.add=function(e){this.geometrys.push(e)},n.prototype.resourceCallback=function(e){this.combineMesh.material=e.roomMaterial,this.combineMesh.material.side=THREE.DoubleSide},n.prototype.build=function(){var e=null;this.resource.ready?e=this.resource.roomMaterial:(e=new THREE.MeshBasicMaterial,this.resource.registerListener(this)),e.side=THREE.DoubleSide;for(var t=new THREE.Geometry,r=0;r<this.geometrys.length;r++){var i=this.geometrys[r];t.merge(i),this.mergeUV2(i,t)}var n=new THREE.Mesh(t,e);n.name="combine",n.rotateX(-Math.PI/2),n.position.y=this.height,this.combineMesh=n,this.combineMesh.name="floor"},n.prototype.mergeUV2=function(e,t){var r=e.faceVertexUvs,i=t.faceVertexUvs,n=r[1];void 0===i[1]&&(i[1]=[]);for(var o=i[1],a=0;a<n.length;a++){for(var s=n[a],l=[],c=0;c<s.length;c++)l.push(s[c].clone());o.push(l)}},n}(ga),ya=function(i){function n(e,t){to(this,n);var r=no(this,i.call(this,e,t));return r.meshInfos=[],r.geometrys=[],r.height=3,r}return io(n,i),n.prototype.add=function(e){this.geometrys.push(e)},n.prototype.resourceCallback=function(e){this.combineMesh.material=e.roomMaterial},n.prototype.build=function(){var e=null;this.resource.ready?e=this.resource.roomMaterial:(e=new THREE.MeshBasicMaterial({color:16777215}),this.resource.registerListener(this));for(var t=new THREE.Geometry,r=0;r<this.geometrys.length;r++){var i=this.geometrys[r];t.merge(i)}var n=new THREE.Mesh(t,e);n.name="combine",n.rotateX(Math.PI/2),n.position.y=this.height,this.combineMesh=n,this.combineMesh.name="ceiling"},n}(ga),ba=function(i){function n(e,t){to(this,n);var r=no(this,i.call(this,e,t));return r.meshInfos=[],r.geometrys=[],r.height=3,r}return io(n,i),n.prototype.add=function(e){this.geometrys.push(e)},n.prototype.resourceCallback=function(e){this.combineMesh.material=e.roomMaterial},n.prototype.build=function(){var e=null;this.resource.ready?e=this.resource.roomMaterial:(e=new THREE.MeshBasicMaterial,this.resource.registerListener(this));for(var t=new THREE.Geometry,r=0;r<this.geometrys.length;r++){var i=this.geometrys[r];t.merge(i)}var n=new THREE.Mesh(t,e);n.name="combine",n.rotateX(-Math.PI/2),n.position.y=this.height+.005,this.combineMesh=n,this.combineMesh.name="roof"},n}(ga),xa=function(i){function n(e,t){to(this,n);var r=no(this,i.call(this,e,t));return r.meshInfos=[],r}return io(n,i),n.prototype.add=function(e){if(this.isExceed(e.indexArray.length))return console.warn("combine exceed vertex count "),!1;this.vertexCount+=e.indexArray.length,this.indexCount+=e.indexArray.length,this.meshInfos.push(e)},n.prototype.build=function(){for(var e=this.meshInfos,t=this.indexCount,r=this.vertexCount,i=new Float32Array(3*r),n=new Float32Array(3*r),o=new Float32Array(2*r),a=new Float32Array(4*r),s=new Float32Array(2*r),l=new Uint16Array(t),c=0,u=0,h=0,p=0,d=0,f=new THREE.BufferGeometry,m=0;m<e.length;m++){for(var g=e[m],v=g.parentPosition,y=g.indexArray,b=0;b<y.length;b++)l[b+p]=c/3+y[b];p+=y.length;var x=g.positionArray;for(b=0;b<x.length;){var E=new THREE.Vector3(x[b]+v.x,x[b+1]+v.y,x[b+2]+v.z);i[b+c]=E.x,i[b+c+1]=E.y,i[b+c+2]=E.z,b+=3}c+=x.length;var _=g.normalArray;for(b=0;b<_.length;){var w=new THREE.Vector3(_[b],_[b+1],_[b+2]);n[b+u]=w.x,n[b+u+1]=w.y,n[b+u+2]=w.z,b+=3}u+=_.length;var T=g.uvArray;if(T)for(b=0;b<T.length;b++)o[b+h]=T[b];var M=g.uv2Array;if(M)for(b=0;b<M.length;b++)s[b+h]=M[b];T&&(h+=T.length);var S=g.colorArray;if(S){for(b=0;b<S.length;b++)a[b+d]=S[b];d+=S.length}}f.addAttribute("position",new THREE.BufferAttribute(i,3)),f.addAttribute("normal",new THREE.BufferAttribute(n,3)),f.addAttribute("uv",new THREE.BufferAttribute(o,2)),0!==s.length&&f.addAttribute("uv2",new THREE.BufferAttribute(s,2)),0!==a.length&&f.addAttribute("color",new THREE.BufferAttribute(a,4)),f.setIndex(new THREE.BufferAttribute(l,1));var R=new THREE.Mesh(f,this.material);this.material.defines&&this.material.defines.USE_ALPHAINDEX&&delete this.material.defines.USE_ALPHAINDEX,R.name="combine",this.combineMesh=R,this.combineMesh.name="manualWall"},n}(Ko),Ea=function(n){function o(e,t,r){to(this,o);var i=no(this,n.call(this,e,t,r));return i.meshInfos=[],i.processors=[],i}return io(o,n),o.prototype.add=function(e){this.vertexCount+=e.indexArray.length,this.indexCount+=e.indexArray.length,this.meshInfos.push(e)},o.prototype.build=function(){var e=null;this.resource.ready?e=this.resource.material:(e=new THREE.MeshBasicMaterial({color:16777215}),this.resource.registerListener(this));for(var t=void 0,r=0;r<this.meshInfos.length;r++){var i=this.meshInfos[r];t&&!t.isExceed(i.indexArray.length)||(t=new xa(e,this.combineManager),this.processors.push(t)),t.add(i)}for(var n=0;n<this.processors.length;n++){var o=this.processors[n];o.build(),this.combineMesh.add(o.combineMesh)}},o.prototype.resourceCallback=function(e){var t=null;t=uo.enableManaulWallLightMap&&e.wallLightMaterial?e.wallLightMaterial:e.material;for(var r=0;r<this.processors.length;r++){this.processors[r].combineMesh.material=t}},o}(ga),_a=function(n){function o(e,t,r){to(this,o);var i=no(this,n.call(this,e,t,r));return i.meshInfos=[],i.walls=[],i.combineProcessorMap=new Map,i.combineProcessors=[],i}return io(o,n),o.prototype.add=function(e){this.walls.push(e)},o.prototype.build=function(){if(this.resource.ready){this.resource.isCombine||this.resource.combine();for(var e=0;e<this.walls.length;e++){var t=this.walls[e];t.build();for(var l=this.combineProcessorMap,c=this.combineProcessors,r=this.resource.combineBundleObj,i=0;i<t.modelNumber;i++){var n=t.objPositions[i],o=t.objRotations[i],a=t.objScales[i],u=new ea;u.positions.push(n),u.scales.push(a),u.quaternions.push(o),r.materialMap.forEach(function(e,t,r){for(var i=e,n=t,o=0;o<i.length;o++){var a=i[o],s=l.get(n);s&&!s.isExceed(a.vertexCount)||(s=new $o(n,this),l.set(n,s),c.push(s)),s.add(a,u)}})}}for(i=0;i<this.combineProcessors.length;i++){var s=this.combineProcessors[i];s.build(),this.combineMesh.add(s.combineMesh)}}else this.resource.registerListener(this)},o.prototype.resourceCallback=function(e){this.build()},o}(ga),wa=function(n){function o(e,t,r){to(this,o);var i=no(this,n.call(this,e,t,r));return i.placements=[],i.transformations=[],i.combineProcessorMap=new Map,i.combineProcessors=[],i.combineMeshs=[],i}return io(o,n),o.prototype.add=function(e,t){this.placements.push(e),this.transformations.push(t)},o.prototype.build=function(){this.resource.ready?(this.resource.isCombine||this.resource.combine(),!this.resource.combineBundleObj&&this.resource.isCombine||(this.resource.isCombine?this.combinePlacements():this.resource.model&&this.instancePlacements())):this.resource.registerListener(this)},o.prototype.instancePlacements=function(){for(var e=0;e<this.placements.length;e++){var t=this.placements[e];t.initResource(),t.instanceModel();var r=this.transformations[e],i=null;if(r)for(var n=r.positions.length-1;-1<n;n--){var o=new THREE.Object3D,a=r.positions[n],s=r.scales[n],l=r.quaternions[n];o.position.set(a.x,a.y,a.z),o.scale.set(s.x,s.y,s.z),o.quaternion.set(l.x,l.y,l.z,l.w),null!==i?o.add(i):o.add(t.mesh),i=o}else i=t.mesh;this.combineMesh.add(i)}},o.prototype.combinePlacements=function(){for(var e=0;e<this.placements.length;e++){var t=this.placements[e],l=this.transformations[e];void 0===l&&(l=new ea);var c=this.combineProcessorMap,u=this.combineProcessors,r=this.resource.combineBundleObj;l.positions.push(t.position),l.scales.push(t.scale),l.quaternions.push(t.rotation),r.materialMap.forEach(function(e,t,r){for(var i=e,n=t,o=0;o<i.length;o++){var a=i[o],s=c.get(n);s&&!s.isExceed(a.vertexCount)||(s=new $o(n,this),c.set(n,s),u.push(s)),s.add(a,l)}})}for(var i=0;i<this.combineProcessors.length;i++){var n=this.combineProcessors[i];n.build(),this.combineMesh.add(n.combineMesh)}},o.prototype.resourceCallback=function(e){this.build()},o}(ga),Ta=function(){function t(e){to(this,t),this.resourceManager=e,this.combineBundleObjectMap={},this.processors=[]}return t.prototype.combineModels=function(){var o=this.resourceManager.models,e=[],a=this;for(var s in o)e.push(new Promise(function(e,t){var r=performance.now(),i=o[s],n=new CombineBundleObject(i.model);(a.combineBundleObjectMap[i.id]=n).combine(),.1<performance.now()-r?setTimeout(function(){e()},10):e()}));return Promise.all(e)},t.prototype.getModelObject=function(e){var t=this.combineBundleObjectMap[e];return t||null},t.prototype.addDoorOrWindow=function(e,t,r){var i=t.curDoorOrWinCombineProcessorMap,n=t.doorOrWindowCombineProcessors,o=e.resource;this.resourceManager.addPlacementResource(o);var a=i.get(o);a||(a=new wa(o,this,t),n.push(a),i.set(o,a)),a.add(e,r)},t.prototype.addStraightManualWall=function(e,t){var r=t.curStraightManualWallCombineProcessorMap,i=t.straightManualWallCombineProcessors;e.build();var n=e.rightSideMeshInfo,o=e.leftSideMeshInfo,a=e.edgeSideMeshInfo;this.addWallMeshInfo(n,e.position,r,i,t),this.addWallMeshInfo(o,e.position,r,i,t),this.addWallMeshInfo(a,e.position,r,i,t)},t.prototype.addModelWall=function(e,t){var r=t.curModelWallCombineProcessorMap,i=t.modelWallCombineProcessors,n=e.resource;this.resourceManager.addWallModelResource(n);var o=r.get(n);o||(o=new _a(n,this,t),i.push(o),r.set(n,o)),o.add(e)},t.prototype.addRoom=function(e,t){e.floor.isShow&&this.addRoomShapeGeometry(e.floorResource,e.floor.geometry,e.floor.height,va,t.curFloorCombineProcessorMap,t.floorCombineProcessors),e.isOnlyFloor||(e.ceiling.isShow&&this.addRoomShapeGeometry(e.ceilingResource,e.ceiling.geometry,e.ceiling.height,ya,t.curCeilingCombineProcessorMap,t.ceilingCombineProcessors),e.roof.isShow&&this.addRoomShapeGeometry(e.roofResource,e.roof.geometry,e.roof.height,ba,t.curRoofCombineProcessorMap,t.roofCombineProcessors))},t.prototype.addPlacement=function(e,t,r){var i=t.curPlacementCombineProcessorMap,n=t.placementCombineProcessors,o=e.resource;this.resourceManager.addPlacementResource(o);var a=i.get(o);a||(a=new wa(o,this,t),n.push(a),i.set(o,a)),a.add(e,r)},t.prototype.addGroup=function(e,t,r){r||(r=new ea),r.positions.push(e.position),r.scales.push(e.scale),r.quaternions.push(e.rotation);for(var i=0;i<e.placements.length;i++){var n=e.placements[i];n.isShow&&this.addPlacement(n,t,r.clone())}for(i=0;i<e.groups.length;i++){var o=e.groups[i];o.isShow&&this.addGroup(o,t,r.clone())}},t.prototype.addWallMeshInfo=function(e,t,r,i,n){var o=e.resource;this.resourceManager.addWallTextureResource(o),e.parentPosition=t;var a=r.get(o);a||(a=new Ea(o,this,n),i.push(a),r.set(o,a)),a.add(e)},t.prototype.addRoomShapeGeometry=function(e,t,r,i,n,o){this.resourceManager.addRoomResource(e);var a=e.id+r,s=n.get(a);s||(s=new i(e,this),o.push(s),s.height=r,n.set(a,s)),s.add(t)},t.prototype.getCombineProcessors=function(e,t,r,i){var l=[],c=new Map;for(var n in e){var o=e[n];if(!o.uid&&!o.name){var a=this.app.modelResource.bundleIDArray[o.bIdx],s=(this.app.modelResource.get(a).node,new THREE.Vector3(0,0,0)),u=new ea;if(o.pos){var h=o.pos.split(" ");s.x=parseFloat(h[0]),s.y=parseFloat(h[1]),s.z=-parseFloat(h[2])}var p=new THREE.Vector3(1,1,1);if(o.scl){var d=o.scl.split(" ");p.x=parseFloat(d[0]),p.y=parseFloat(d[1]),p.z=parseFloat(d[2])}var f=new THREE.Quaternion(0,0,0,1);if(o.rot){var m=o.rot.split(" ");f.x=parseFloat(m[0]),f.y=parseFloat(m[1]),f.z=-parseFloat(m[2]),f.w=-parseFloat(m[3])}var g=t.slice(),v=r.slice(),y=i.slice();y.push(f),v.push(p),g.push(s),u.positions=g,u.scales=v,u.quaternions=y,this.combineBundleObjectMap[a].materialMap.forEach(function(e,t,r){for(var i=e,n=t,o=0;o<i.length;o++){var a=i[o],s=c.get(n);s&&!s.isExceed(a.vertexCount)||(s=new CombineMeshProcessor(n),c.set(n,s),l.push(s)),s.add(a,u)}})}}return l},t}(),Ma=function(e){function t(){return to(this,t),no(this,e.call(this))}return io(t,e),t.prototype.build=function(){e.prototype.build.call(this)},t}(Mo),Sa=function(t){function r(){to(this,r);var e=no(this,t.call(this));return e.points=[],e.resource=null,e.color=null,e.mesh=null,e.texture=null,e.initCompleteCallback=null,e.width=null,e}return io(r,t),r.prototype.build=function(){},r.prototype.initResource=function(){this.resource&&(this.resource.ready?this.texture=this.resource.texture:this.resource.registerListener(this))},r.prototype.resourceCallback=function(e){this.mesh||(this.texture=e.texture,this.initCompleteCallback&&this.initCompleteCallback(this))},r}(ho),Ra=function(t){function r(){to(this,r);var e=no(this,t.call(this));return e.points=[],e.resource=null,e.color=new THREE.Color(0,0,1),e.mesh=null,e.texture=null,e.initCompleteCallback=null,e.renderMode=null,e.opacity=null,e.radius=null,e.sectionType=null,e}return io(r,t),r.prototype.build=function(){},r.prototype.initResource=function(){this.resource&&(this.resource.ready?this.texture=this.resource.texture:this.resource.registerListener(this))},r.prototype.resourceCallback=function(e){this.mesh||(this.texture=e.texture,this.initCompleteCallback&&this.initCompleteCallback(this))},r}(ho),Pa=function(e){function t(){return to(this,t),no(this,e.call(this))}return io(t,e),t.prototype.build=function(){e.prototype.build.call(this)},t}(Zo),Aa=function(t){function n(){to(this,n);var e=no(this,t.call(this));return e.text=null,e.color=null,e.font=null,e.opacity=null,e.mesh=null,e}return io(n,t),n.prototype.build=function(){var e=new THREE.TextGeometry(this.text,{font:n.getFont(),size:80,height:1,curveSegments:2});e.computeBoundingBox();var t=-.5*(e.boundingBox.max.x-e.boundingBox.min.x),r=[new THREE.MeshBasicMaterial({color:16777215*Math.random(),overdraw:.5}),new THREE.MeshBasicMaterial({color:0,overdraw:.5})],i=new THREE.Mesh(e,r);i.position.x=t,i.position.y=100,i.position.z=0,i.rotation.x=0,i.rotation.y=2*Math.PI,this.mesh=i},n.getFont=function(){return n.font?n.font:new THREE.Font({glyphs:{"":{x_min:0,x_max:712,ha:815,o:"m 356 -25 q 96 88 192 -25 q 0 368 0 201 q 92 642 0 533 q 356 761 192 761 q 617 644 517 761 q 712 368 712 533 q 619 91 712 201 q 356 -25 520 -25 m 356 85 q 527 175 465 85 q 583 369 583 255 q 528 562 583 484 q 356 651 466 651 q 189 560 250 651 q 135 369 135 481 q 187 177 135 257 q 356 85 250 85 "},S:{x_min:0,x_max:788,ha:890,o:"m 788 291 q 662 54 788 144 q 397 -26 550 -26 q 116 68 226 -26 q 0 337 0 168 l 131 337 q 200 152 131 220 q 384 85 269 85 q 557 129 479 85 q 650 270 650 183 q 490 429 650 379 q 194 513 341 470 q 33 739 33 584 q 142 964 33 881 q 388 1041 242 1041 q 644 957 543 1041 q 756 716 756 867 l 625 716 q 561 874 625 816 q 395 933 497 933 q 243 891 309 933 q 164 759 164 841 q 325 609 164 656 q 625 526 475 568 q 788 291 788 454 "},"":{x_min:343,x_max:449,ha:792,o:"m 449 462 l 343 462 l 343 986 l 449 986 l 449 462 m 449 -242 l 343 -242 l 343 280 l 449 280 l 449 -242 "},"/":{x_min:183.25,x_max:608.328125,ha:792,o:"m 608 1041 l 266 -129 l 183 -129 l 520 1041 l 608 1041 "},"":{x_min:-.4375,x_max:777.453125,ha:839,o:"m 777 893 l 458 893 l 458 0 l 319 0 l 319 892 l 0 892 l 0 1013 l 777 1013 l 777 893 "},y:{x_min:0,x_max:684.78125,ha:771,o:"m 684 738 l 388 -83 q 311 -216 356 -167 q 173 -279 252 -279 q 97 -266 133 -279 l 97 -149 q 132 -155 109 -151 q 168 -160 155 -160 q 240 -114 213 -160 q 274 -26 248 -98 l 0 738 l 137 737 l 341 139 l 548 737 l 684 738 "},"":{x_min:0,x_max:803,ha:917,o:"m 803 0 l 667 0 l 667 886 l 140 886 l 140 0 l 0 0 l 0 1012 l 803 1012 l 803 0 "},"":{x_min:-111,x_max:339,ha:361,o:"m 339 800 l 229 800 l 229 925 l 339 925 l 339 800 m -1 800 l -111 800 l -111 925 l -1 925 l -1 800 m 284 3 q 233 -10 258 -5 q 182 -15 207 -15 q 85 26 119 -15 q 42 200 42 79 l 42 737 l 167 737 l 168 215 q 172 141 168 157 q 226 101 183 101 q 248 103 239 101 q 284 112 257 104 l 284 3 m 302 1040 l 113 819 l 30 819 l 165 1040 l 302 1040 "},g:{x_min:0,x_max:686,ha:838,o:"m 686 34 q 586 -213 686 -121 q 331 -306 487 -306 q 131 -252 216 -306 q 31 -84 31 -190 l 155 -84 q 228 -174 166 -138 q 345 -207 284 -207 q 514 -109 454 -207 q 564 89 564 -27 q 461 6 521 36 q 335 -23 401 -23 q 88 100 184 -23 q 0 370 0 215 q 87 634 0 522 q 330 758 183 758 q 457 728 398 758 q 564 644 515 699 l 564 737 l 686 737 l 686 34 m 582 367 q 529 560 582 481 q 358 652 468 652 q 189 561 250 652 q 135 369 135 482 q 189 176 135 255 q 361 85 251 85 q 529 176 468 85 q 582 367 582 255 "},"":{x_min:0,x_max:442,ha:539,o:"m 442 383 l 0 383 q 91 566 0 492 q 260 668 176 617 q 354 798 354 727 q 315 875 354 845 q 227 905 277 905 q 136 869 173 905 q 99 761 99 833 l 14 761 q 82 922 14 864 q 232 974 141 974 q 379 926 316 974 q 442 797 442 878 q 351 635 442 704 q 183 539 321 611 q 92 455 92 491 l 442 455 l 442 383 "},"":{x_min:0,x_max:705.5625,ha:803,o:"m 705 334 l 0 334 l 0 410 l 705 410 l 705 334 "},"":{x_min:0,x_max:819.5625,ha:893,o:"m 819 0 l 650 0 l 294 509 l 139 356 l 139 0 l 0 0 l 0 1013 l 139 1013 l 139 526 l 626 1013 l 809 1013 l 395 600 l 819 0 "},"":{x_min:-46.265625,x_max:392,ha:513,o:"m 392 651 l 259 651 l 79 -279 l -46 -278 l 134 651 l 14 651 l 14 751 l 135 751 q 151 948 135 900 q 304 1041 185 1041 q 334 1040 319 1041 q 392 1034 348 1039 l 392 922 q 337 931 360 931 q 271 883 287 931 q 260 793 260 853 l 260 751 l 392 751 l 392 651 "},e:{x_min:0,x_max:714,ha:813,o:"m 714 326 l 140 326 q 200 157 140 227 q 359 87 260 87 q 488 130 431 87 q 561 245 545 174 l 697 245 q 577 48 670 123 q 358 -26 484 -26 q 97 85 195 -26 q 0 363 0 197 q 94 642 0 529 q 358 765 195 765 q 626 627 529 765 q 714 326 714 503 m 576 429 q 507 583 564 522 q 355 650 445 650 q 206 583 266 650 q 140 429 152 522 l 576 429 "},"":{x_min:0,x_max:712,ha:815,o:"m 356 -25 q 94 91 194 -25 q 0 368 0 202 q 92 642 0 533 q 356 761 192 761 q 617 644 517 761 q 712 368 712 533 q 619 91 712 201 q 356 -25 520 -25 m 356 85 q 527 175 465 85 q 583 369 583 255 q 528 562 583 484 q 356 651 466 651 q 189 560 250 651 q 135 369 135 481 q 187 177 135 257 q 356 85 250 85 m 576 1040 l 387 819 l 303 819 l 438 1040 l 576 1040 "},J:{x_min:0,x_max:588,ha:699,o:"m 588 279 q 287 -26 588 -26 q 58 73 126 -26 q 0 327 0 158 l 133 327 q 160 172 133 227 q 288 96 198 96 q 426 171 391 96 q 449 336 449 219 l 449 1013 l 588 1013 l 588 279 "},"":{x_min:-1,x_max:503,ha:601,o:"m 503 302 l 280 136 l 281 256 l 429 373 l 281 486 l 280 608 l 503 440 l 503 302 m 221 302 l 0 136 l 0 255 l 145 372 l 0 486 l -1 608 l 221 440 l 221 302 "},"":{x_min:-3,x_max:1008,ha:1106,o:"m 502 -7 q 123 151 263 -7 q -3 501 -3 294 q 123 851 -3 706 q 502 1011 263 1011 q 881 851 739 1011 q 1008 501 1008 708 q 883 151 1008 292 q 502 -7 744 -7 m 502 60 q 830 197 709 60 q 940 501 940 322 q 831 805 940 681 q 502 944 709 944 q 174 805 296 944 q 65 501 65 680 q 173 197 65 320 q 502 60 294 60 m 741 394 q 661 246 731 302 q 496 190 591 190 q 294 285 369 190 q 228 497 228 370 q 295 714 228 625 q 499 813 370 813 q 656 762 588 813 q 733 625 724 711 l 634 625 q 589 704 629 673 q 498 735 550 735 q 377 666 421 735 q 334 504 334 597 q 374 340 334 408 q 490 272 415 272 q 589 304 549 272 q 638 394 628 337 l 741 394 "},"":{x_min:0,x_max:922,ha:1030,o:"m 687 1040 l 498 819 l 415 819 l 549 1040 l 687 1040 m 922 339 q 856 97 922 203 q 650 -26 780 -26 q 538 9 587 -26 q 461 103 489 44 q 387 12 436 46 q 277 -22 339 -22 q 69 97 147 -22 q 0 338 0 202 q 45 551 0 444 q 161 737 84 643 l 302 737 q 175 552 219 647 q 124 336 124 446 q 155 179 124 248 q 275 88 197 88 q 375 163 341 88 q 400 294 400 219 l 400 572 l 524 572 l 524 294 q 561 135 524 192 q 643 88 591 88 q 762 182 719 88 q 797 341 797 257 q 745 555 797 450 q 619 737 705 637 l 760 737 q 874 551 835 640 q 922 339 922 444 "},"^":{x_min:193.0625,x_max:598.609375,ha:792,o:"m 598 772 l 515 772 l 395 931 l 277 772 l 193 772 l 326 1013 l 462 1013 l 598 772 "},"":{x_min:0,x_max:507.203125,ha:604,o:"m 506 136 l 284 302 l 284 440 l 506 608 l 507 485 l 360 371 l 506 255 l 506 136 m 222 136 l 0 302 l 0 440 l 222 608 l 221 486 l 73 373 l 222 256 l 222 136 "},D:{x_min:0,x_max:828,ha:935,o:"m 389 1013 q 714 867 593 1013 q 828 521 828 729 q 712 161 828 309 q 382 0 587 0 l 0 0 l 0 1013 l 389 1013 m 376 124 q 607 247 523 124 q 681 510 681 355 q 607 771 681 662 q 376 896 522 896 l 139 896 l 139 124 l 376 124 "},"":{x_min:0,x_max:142,ha:239,o:"m 142 585 l 0 585 l 0 738 l 142 738 l 142 585 "},"":{x_min:0,x_max:47,ha:125,o:"m 47 3 q 37 -7 47 -7 q 28 0 30 -7 q 39 -4 32 -4 q 45 3 45 -1 l 37 0 q 28 9 28 0 q 39 19 28 19 l 47 16 l 47 19 l 47 3 m 37 1 q 44 8 44 1 q 37 16 44 16 q 30 8 30 16 q 37 1 30 1 m 26 1 l 23 22 l 14 0 l 3 22 l 3 3 l 0 25 l 13 1 l 22 25 l 26 1 "},w:{x_min:0,x_max:1009.71875,ha:1100,o:"m 1009 738 l 783 0 l 658 0 l 501 567 l 345 0 l 222 0 l 0 738 l 130 738 l 284 174 l 432 737 l 576 738 l 721 173 l 881 737 l 1009 738 "},$:{x_min:0,x_max:700,ha:793,o:"m 664 717 l 542 717 q 490 825 531 785 q 381 872 450 865 l 381 551 q 620 446 540 522 q 700 241 700 370 q 618 45 700 116 q 381 -25 536 -25 l 381 -152 l 307 -152 l 307 -25 q 81 62 162 -25 q 0 297 0 149 l 124 297 q 169 146 124 204 q 307 81 215 89 l 307 441 q 80 536 148 469 q 13 725 13 603 q 96 910 13 839 q 307 982 180 982 l 307 1077 l 381 1077 l 381 982 q 574 917 494 982 q 664 717 664 845 m 307 565 l 307 872 q 187 831 233 872 q 142 724 142 791 q 180 618 142 656 q 307 565 218 580 m 381 76 q 562 237 562 96 q 517 361 562 313 q 381 423 472 409 l 381 76 "},"\\":{x_min:-.015625,x_max:425.0625,ha:522,o:"m 425 -129 l 337 -129 l 0 1041 l 83 1041 l 425 -129 "},"":{x_min:0,x_max:697.21875,ha:747,o:"m 697 -4 q 629 -14 658 -14 q 498 97 513 -14 q 422 9 470 41 q 313 -23 374 -23 q 207 4 258 -23 q 119 81 156 32 l 119 -278 l 0 -278 l 0 738 l 124 738 l 124 343 q 165 173 124 246 q 308 83 216 83 q 452 178 402 83 q 493 359 493 255 l 493 738 l 617 738 l 617 214 q 623 136 617 160 q 673 92 637 92 q 697 96 684 92 l 697 -4 "},"":{x_min:42,x_max:181,ha:297,o:"m 181 0 l 42 0 l 42 1013 l 181 1013 l 181 0 "},"":{x_min:0,x_max:1144.5,ha:1214,o:"m 1144 1012 l 807 416 l 807 0 l 667 0 l 667 416 l 325 1012 l 465 1012 l 736 533 l 1004 1012 l 1144 1012 m 277 1040 l 83 799 l 0 799 l 140 1040 l 277 1040 "},"":{x_min:0,x_max:139,ha:236,o:"m 139 851 q 102 737 139 784 q 0 669 65 690 l 0 734 q 59 787 42 741 q 72 873 72 821 l 0 873 l 0 1013 l 139 1013 l 139 851 "},"":{x_min:0,x_max:801,ha:915,o:"m 801 0 l 651 0 l 131 822 l 131 0 l 0 0 l 0 1013 l 151 1013 l 670 191 l 670 1013 l 801 1013 l 801 0 "},"-":{x_min:8.71875,x_max:350.390625,ha:478,o:"m 350 317 l 8 317 l 8 428 l 350 428 l 350 317 "},Q:{x_min:0,x_max:968,ha:1072,o:"m 954 5 l 887 -79 l 744 35 q 622 -11 687 2 q 483 -26 556 -26 q 127 130 262 -26 q 0 504 0 279 q 127 880 0 728 q 484 1041 262 1041 q 841 884 708 1041 q 968 507 968 735 q 933 293 968 398 q 832 104 899 188 l 954 5 m 723 191 q 802 330 777 248 q 828 499 828 412 q 744 790 828 673 q 483 922 650 922 q 228 791 322 922 q 142 505 142 673 q 227 221 142 337 q 487 91 323 91 q 632 123 566 91 l 520 215 l 587 301 l 723 191 "},"":{x_min:1,x_max:676.28125,ha:740,o:"m 676 460 l 551 460 q 498 595 542 546 q 365 651 448 651 q 199 578 263 651 q 136 401 136 505 q 266 178 136 241 q 508 106 387 142 q 640 -50 640 62 q 625 -158 640 -105 q 583 -278 611 -211 l 465 -278 q 498 -182 490 -211 q 515 -80 515 -126 q 381 12 515 -15 q 134 91 197 51 q 1 388 1 179 q 100 651 1 542 q 354 761 199 761 q 587 680 498 761 q 676 460 676 599 "},M:{x_min:0,x_max:954,ha:1067,o:"m 954 0 l 819 0 l 819 869 l 537 0 l 405 0 l 128 866 l 128 0 l 0 0 l 0 1013 l 200 1013 l 472 160 l 757 1013 l 954 1013 l 954 0 "},"":{x_min:0,x_max:1006,ha:1094,o:"m 1006 678 q 914 319 1006 429 q 571 200 814 200 l 571 0 l 433 0 l 433 200 q 92 319 194 200 q 0 678 0 429 l 0 1013 l 139 1013 l 139 679 q 191 417 139 492 q 433 326 255 326 l 433 1013 l 571 1013 l 571 326 l 580 326 q 813 423 747 326 q 868 679 868 502 l 868 1013 l 1006 1013 l 1006 678 "},C:{x_min:0,x_max:886,ha:944,o:"m 886 379 q 760 87 886 201 q 455 -26 634 -26 q 112 136 236 -26 q 0 509 0 283 q 118 882 0 737 q 469 1041 245 1041 q 748 955 630 1041 q 879 708 879 859 l 745 708 q 649 862 724 805 q 473 920 573 920 q 219 791 312 920 q 136 509 136 675 q 217 229 136 344 q 470 99 311 99 q 672 179 591 99 q 753 379 753 259 l 886 379 "},"!":{x_min:0,x_max:138,ha:236,o:"m 138 684 q 116 409 138 629 q 105 244 105 299 l 33 244 q 16 465 33 313 q 0 684 0 616 l 0 1013 l 138 1013 l 138 684 m 138 0 l 0 0 l 0 151 l 138 151 l 138 0 "},"{":{x_min:0,x_max:480.5625,ha:578,o:"m 480 -286 q 237 -213 303 -286 q 187 -45 187 -159 q 194 48 187 -15 q 201 141 201 112 q 164 264 201 225 q 0 314 118 314 l 0 417 q 164 471 119 417 q 201 605 201 514 q 199 665 201 644 q 193 772 193 769 q 241 941 193 887 q 480 1015 308 1015 l 480 915 q 336 866 375 915 q 306 742 306 828 q 310 662 306 717 q 314 577 314 606 q 288 452 314 500 q 176 365 256 391 q 289 275 257 337 q 314 143 314 226 q 313 84 314 107 q 310 -11 310 -5 q 339 -131 310 -94 q 480 -182 377 -182 l 480 -286 "},X:{x_min:-.015625,x_max:854.15625,ha:940,o:"m 854 0 l 683 0 l 423 409 l 166 0 l 0 0 l 347 519 l 18 1013 l 186 1013 l 428 637 l 675 1013 l 836 1013 l 504 520 l 854 0 "},"#":{x_min:0,x_max:963.890625,ha:1061,o:"m 963 690 l 927 590 l 719 590 l 655 410 l 876 410 l 840 310 l 618 310 l 508 -3 l 393 -2 l 506 309 l 329 310 l 215 -2 l 102 -3 l 212 310 l 0 310 l 36 410 l 248 409 l 312 590 l 86 590 l 120 690 l 347 690 l 459 1006 l 573 1006 l 462 690 l 640 690 l 751 1006 l 865 1006 l 754 690 l 963 690 m 606 590 l 425 590 l 362 410 l 543 410 l 606 590 "},"":{x_min:42,x_max:284,ha:361,o:"m 284 3 q 233 -10 258 -5 q 182 -15 207 -15 q 85 26 119 -15 q 42 200 42 79 l 42 738 l 167 738 l 168 215 q 172 141 168 157 q 226 101 183 101 q 248 103 239 101 q 284 112 257 104 l 284 3 "},"":{x_min:0,x_max:906.953125,ha:982,o:"m 283 1040 l 88 799 l 5 799 l 145 1040 l 283 1040 m 906 0 l 756 0 l 650 303 l 251 303 l 143 0 l 0 0 l 376 1012 l 529 1012 l 906 0 m 609 421 l 452 866 l 293 421 l 609 421 "},")":{x_min:0,x_max:318,ha:415,o:"m 318 365 q 257 25 318 191 q 87 -290 197 -141 l 0 -290 q 140 21 93 -128 q 193 360 193 189 q 141 704 193 537 q 0 1024 97 850 l 87 1024 q 257 706 197 871 q 318 365 318 542 "},"":{x_min:0,x_max:634.71875,ha:714,o:"m 634 234 q 527 38 634 110 q 300 -25 433 -25 q 98 29 183 -25 q 0 204 0 93 q 37 314 0 265 q 128 390 67 353 q 56 460 82 419 q 26 555 26 505 q 114 712 26 654 q 295 763 191 763 q 499 700 416 763 q 589 515 589 631 l 478 515 q 419 618 464 580 q 307 657 374 657 q 207 630 253 657 q 151 547 151 598 q 238 445 151 469 q 389 434 280 434 l 389 331 l 349 331 q 206 315 255 331 q 125 210 125 287 q 183 107 125 145 q 302 76 233 76 q 436 117 379 76 q 509 234 493 159 l 634 234 "},"":{x_min:0,x_max:952.78125,ha:1028,o:"m 952 0 l 0 0 l 400 1013 l 551 1013 l 952 0 m 762 124 l 476 867 l 187 124 l 762 124 "},"}":{x_min:0,x_max:481,ha:578,o:"m 481 314 q 318 262 364 314 q 282 136 282 222 q 284 65 282 97 q 293 -58 293 -48 q 241 -217 293 -166 q 0 -286 174 -286 l 0 -182 q 143 -130 105 -182 q 171 -2 171 -93 q 168 81 171 22 q 165 144 165 140 q 188 275 165 229 q 306 365 220 339 q 191 455 224 391 q 165 588 165 505 q 168 681 165 624 q 171 742 171 737 q 141 865 171 827 q 0 915 102 915 l 0 1015 q 243 942 176 1015 q 293 773 293 888 q 287 675 293 741 q 282 590 282 608 q 318 466 282 505 q 481 417 364 417 l 481 314 "},"":{x_min:-3,x_max:1672,ha:1821,o:"m 846 0 q 664 76 732 0 q 603 244 603 145 q 662 412 603 344 q 846 489 729 489 q 1027 412 959 489 q 1089 244 1089 343 q 1029 76 1089 144 q 846 0 962 0 m 845 103 q 945 143 910 103 q 981 243 981 184 q 947 340 981 301 q 845 385 910 385 q 745 342 782 385 q 709 243 709 300 q 742 147 709 186 q 845 103 781 103 m 888 986 l 284 -25 l 199 -25 l 803 986 l 888 986 m 241 468 q 58 545 126 468 q -3 715 -3 615 q 56 881 -3 813 q 238 958 124 958 q 421 881 353 958 q 483 712 483 813 q 423 544 483 612 q 241 468 356 468 m 241 855 q 137 811 175 855 q 100 710 100 768 q 136 612 100 653 q 240 572 172 572 q 344 614 306 572 q 382 713 382 656 q 347 810 382 771 q 241 855 308 855 m 1428 0 q 1246 76 1314 0 q 1185 244 1185 145 q 1244 412 1185 344 q 1428 489 1311 489 q 1610 412 1542 489 q 1672 244 1672 343 q 1612 76 1672 144 q 1428 0 1545 0 m 1427 103 q 1528 143 1492 103 q 1564 243 1564 184 q 1530 340 1564 301 q 1427 385 1492 385 q 1327 342 1364 385 q 1291 243 1291 300 q 1324 147 1291 186 q 1427 103 1363 103 "},a:{x_min:0,x_max:698.609375,ha:794,o:"m 698 0 q 661 -12 679 -7 q 615 -17 643 -17 q 536 12 564 -17 q 500 96 508 41 q 384 6 456 37 q 236 -25 312 -25 q 65 31 130 -25 q 0 194 0 88 q 118 390 0 334 q 328 435 180 420 q 488 483 476 451 q 495 523 495 504 q 442 619 495 584 q 325 654 389 654 q 209 617 257 654 q 152 513 161 580 l 33 513 q 123 705 33 633 q 332 772 207 772 q 528 712 448 772 q 617 531 617 645 l 617 163 q 624 108 617 126 q 664 90 632 90 l 698 94 l 698 0 m 491 262 l 491 372 q 272 329 350 347 q 128 201 128 294 q 166 113 128 144 q 264 83 205 83 q 414 130 346 83 q 491 262 491 183 "},"":{x_min:0,x_max:941.671875,ha:1039,o:"m 941 334 l 0 334 l 0 410 l 941 410 l 941 334 "},"=":{x_min:8.71875,x_max:780.953125,ha:792,o:"m 780 510 l 8 510 l 8 606 l 780 606 l 780 510 m 780 235 l 8 235 l 8 332 l 780 332 l 780 235 "},N:{x_min:0,x_max:801,ha:914,o:"m 801 0 l 651 0 l 131 823 l 131 0 l 0 0 l 0 1013 l 151 1013 l 670 193 l 670 1013 l 801 1013 l 801 0 "},"":{x_min:0,x_max:712,ha:797,o:"m 712 369 q 620 94 712 207 q 362 -26 521 -26 q 230 2 292 -26 q 119 83 167 30 l 119 -278 l 0 -278 l 0 362 q 91 643 0 531 q 355 764 190 764 q 617 647 517 764 q 712 369 712 536 m 583 366 q 530 559 583 480 q 359 651 469 651 q 190 562 252 651 q 135 370 135 483 q 189 176 135 257 q 359 85 250 85 q 528 175 466 85 q 583 366 583 254 "},2:{x_min:59,x_max:731,ha:792,o:"m 731 0 l 59 0 q 197 314 59 188 q 457 487 199 315 q 598 691 598 580 q 543 819 598 772 q 411 867 488 867 q 272 811 328 867 q 209 630 209 747 l 81 630 q 182 901 81 805 q 408 986 271 986 q 629 909 536 986 q 731 694 731 826 q 613 449 731 541 q 378 316 495 383 q 201 122 235 234 l 731 122 l 731 0 "},"":{x_min:0,x_max:941.671875,ha:938,o:"m 941 1033 l 0 1033 l 0 1109 l 941 1109 l 941 1033 "},Z:{x_min:0,x_max:779,ha:849,o:"m 779 0 l 0 0 l 0 113 l 621 896 l 40 896 l 40 1013 l 779 1013 l 778 887 l 171 124 l 779 124 l 779 0 "},u:{x_min:0,x_max:617,ha:729,o:"m 617 0 l 499 0 l 499 110 q 391 10 460 45 q 246 -25 322 -25 q 61 58 127 -25 q 0 258 0 136 l 0 738 l 125 738 l 125 284 q 156 148 125 202 q 273 82 197 82 q 433 165 369 82 q 493 340 493 243 l 493 738 l 617 738 l 617 0 "},k:{x_min:0,x_max:612.484375,ha:697,o:"m 612 738 l 338 465 l 608 0 l 469 0 l 251 382 l 121 251 l 121 0 l 0 0 l 0 1013 l 121 1013 l 121 402 l 456 738 l 612 738 "},"":{x_min:0,x_max:803,ha:917,o:"m 803 0 l 667 0 l 667 475 l 140 475 l 140 0 l 0 0 l 0 1013 l 140 1013 l 140 599 l 667 599 l 667 1013 l 803 1013 l 803 0 "},"":{x_min:0,x_max:906.953125,ha:985,o:"m 906 0 l 756 0 l 650 303 l 251 303 l 143 0 l 0 0 l 376 1013 l 529 1013 l 906 0 m 609 421 l 452 866 l 293 421 l 609 421 "},s:{x_min:0,x_max:604,ha:697,o:"m 604 217 q 501 36 604 104 q 292 -23 411 -23 q 86 43 166 -23 q 0 238 0 114 l 121 237 q 175 122 121 164 q 300 85 223 85 q 415 112 363 85 q 479 207 479 147 q 361 309 479 276 q 140 372 141 370 q 21 544 21 426 q 111 708 21 647 q 298 761 190 761 q 492 705 413 761 q 583 531 583 643 l 462 531 q 412 625 462 594 q 298 657 363 657 q 199 636 242 657 q 143 558 143 608 q 262 454 143 486 q 484 394 479 397 q 604 217 604 341 "},B:{x_min:0,x_max:778,ha:876,o:"m 580 546 q 724 469 670 535 q 778 311 778 403 q 673 83 778 171 q 432 0 575 0 l 0 0 l 0 1013 l 411 1013 q 629 957 541 1013 q 732 768 732 892 q 691 633 732 693 q 580 546 650 572 m 393 899 l 139 899 l 139 588 l 379 588 q 521 624 462 588 q 592 744 592 667 q 531 859 592 819 q 393 899 471 899 m 419 124 q 566 169 504 124 q 635 303 635 219 q 559 436 635 389 q 402 477 494 477 l 139 477 l 139 124 l 419 124 "},"":{x_min:0,x_max:614,ha:708,o:"m 142 0 l 0 0 l 0 151 l 142 151 l 142 0 m 378 0 l 236 0 l 236 151 l 378 151 l 378 0 m 614 0 l 472 0 l 472 151 l 614 151 l 614 0 "},"?":{x_min:0,x_max:607,ha:704,o:"m 607 777 q 543 599 607 674 q 422 474 482 537 q 357 272 357 391 l 236 272 q 297 487 236 395 q 411 619 298 490 q 474 762 474 691 q 422 885 474 838 q 301 933 371 933 q 179 880 228 933 q 124 706 124 819 l 0 706 q 94 963 0 872 q 302 1044 177 1044 q 511 973 423 1044 q 607 777 607 895 m 370 0 l 230 0 l 230 151 l 370 151 l 370 0 "},H:{x_min:0,x_max:803,ha:915,o:"m 803 0 l 667 0 l 667 475 l 140 475 l 140 0 l 0 0 l 0 1013 l 140 1013 l 140 599 l 667 599 l 667 1013 l 803 1013 l 803 0 "},"":{x_min:0,x_max:675,ha:761,o:"m 675 738 l 404 0 l 272 0 l 0 738 l 133 738 l 340 147 l 541 738 l 675 738 "},c:{x_min:1,x_max:701.390625,ha:775,o:"m 701 264 q 584 53 681 133 q 353 -26 487 -26 q 91 91 188 -26 q 1 370 1 201 q 92 645 1 537 q 353 761 190 761 q 572 688 479 761 q 690 493 666 615 l 556 493 q 487 606 545 562 q 356 650 428 650 q 186 563 246 650 q 134 372 134 487 q 188 179 134 258 q 359 88 250 88 q 492 136 437 88 q 566 264 548 185 l 701 264 "},"":{x_min:0,x_max:566.671875,ha:678,o:"m 21 892 l 52 892 l 98 761 l 145 892 l 176 892 l 178 741 l 157 741 l 157 867 l 108 741 l 88 741 l 40 871 l 40 741 l 21 741 l 21 892 m 308 854 l 308 731 q 252 691 308 691 q 227 691 240 691 q 207 696 213 695 l 207 712 l 253 706 q 288 733 288 706 l 288 763 q 244 741 279 741 q 193 797 193 741 q 261 860 193 860 q 287 860 273 860 q 308 854 302 855 m 288 842 l 263 843 q 213 796 213 843 q 248 756 213 756 q 288 796 288 756 l 288 842 m 566 988 l 502 988 l 502 -1 l 439 -1 l 439 988 l 317 988 l 317 -1 l 252 -1 l 252 602 q 81 653 155 602 q 0 805 0 711 q 101 989 0 918 q 309 1053 194 1053 l 566 1053 l 566 988 "},"":{x_min:0,x_max:660,ha:745,o:"m 471 550 q 610 450 561 522 q 660 280 660 378 q 578 64 660 151 q 367 -22 497 -22 q 239 5 299 -22 q 126 82 178 32 l 126 -278 l 0 -278 l 0 593 q 54 903 0 801 q 318 1042 127 1042 q 519 964 436 1042 q 603 771 603 887 q 567 644 603 701 q 471 550 532 586 m 337 79 q 476 138 418 79 q 535 279 535 198 q 427 437 535 386 q 226 477 344 477 l 226 583 q 398 620 329 583 q 486 762 486 668 q 435 884 486 833 q 312 935 384 935 q 169 861 219 935 q 126 698 126 797 l 126 362 q 170 169 126 242 q 337 79 224 79 "},"":{x_min:0,x_max:954,ha:1068,o:"m 954 0 l 819 0 l 819 868 l 537 0 l 405 0 l 128 865 l 128 0 l 0 0 l 0 1013 l 199 1013 l 472 158 l 758 1013 l 954 1013 l 954 0 "},"":{x_min:.109375,x_max:1120,ha:1217,o:"m 1120 505 q 994 132 1120 282 q 642 -29 861 -29 q 290 130 422 -29 q 167 505 167 280 q 294 883 167 730 q 650 1046 430 1046 q 999 882 868 1046 q 1120 505 1120 730 m 977 504 q 896 784 977 669 q 644 915 804 915 q 391 785 484 915 q 307 504 307 669 q 391 224 307 339 q 644 95 486 95 q 894 224 803 95 q 977 504 977 339 m 277 1040 l 83 799 l 0 799 l 140 1040 l 277 1040 "},"":{x_min:0,x_max:1158,ha:1275,o:"m 1158 0 l 1022 0 l 1022 475 l 496 475 l 496 0 l 356 0 l 356 1012 l 496 1012 l 496 599 l 1022 599 l 1022 1012 l 1158 1012 l 1158 0 m 277 1040 l 83 799 l 0 799 l 140 1040 l 277 1040 "},"":{x_min:0,x_max:663.890625,ha:775,o:"m 663 529 q 566 293 663 391 q 331 196 469 196 q 97 294 194 196 q 0 529 0 393 q 96 763 0 665 q 331 861 193 861 q 566 763 469 861 q 663 529 663 665 "},"":{x_min:.1875,x_max:819.546875,ha:886,o:"m 563 561 l 697 561 l 696 487 l 520 487 l 482 416 l 482 380 l 697 380 l 695 308 l 482 308 l 482 0 l 342 0 l 342 308 l 125 308 l 125 380 l 342 380 l 342 417 l 303 487 l 125 487 l 125 561 l 258 561 l 0 1013 l 140 1013 l 411 533 l 679 1013 l 819 1013 l 563 561 "},"(":{x_min:0,x_max:318.0625,ha:415,o:"m 318 -290 l 230 -290 q 61 23 122 -142 q 0 365 0 190 q 62 712 0 540 q 230 1024 119 869 l 318 1024 q 175 705 219 853 q 125 360 125 542 q 176 22 125 187 q 318 -290 223 -127 "},U:{x_min:0,x_max:796,ha:904,o:"m 796 393 q 681 93 796 212 q 386 -25 566 -25 q 101 95 208 -25 q 0 393 0 211 l 0 1013 l 138 1013 l 138 391 q 204 191 138 270 q 394 107 276 107 q 586 191 512 107 q 656 391 656 270 l 656 1013 l 796 1013 l 796 393 "},"":{x_min:.5,x_max:744.953125,ha:822,o:"m 744 737 l 463 54 l 463 -278 l 338 -278 l 338 54 l 154 495 q 104 597 124 569 q 13 651 67 651 l 0 651 l 0 751 l 39 753 q 168 711 121 753 q 242 594 207 676 l 403 208 l 617 737 l 744 737 "},"":{x_min:0,x_max:765.5625,ha:809,o:"m 765 -4 q 698 -14 726 -14 q 564 97 586 -14 q 466 7 525 40 q 337 -26 407 -26 q 88 98 186 -26 q 0 369 0 212 q 88 637 0 525 q 337 760 184 760 q 465 728 407 760 q 563 637 524 696 l 563 739 l 685 739 l 685 222 q 693 141 685 168 q 748 94 708 94 q 765 96 760 94 l 765 -4 m 584 371 q 531 562 584 485 q 360 653 470 653 q 192 566 254 653 q 135 379 135 489 q 186 181 135 261 q 358 84 247 84 q 528 176 465 84 q 584 371 584 260 "},F:{x_min:0,x_max:683.328125,ha:717,o:"m 683 888 l 140 888 l 140 583 l 613 583 l 613 458 l 140 458 l 140 0 l 0 0 l 0 1013 l 683 1013 l 683 888 "},"":{x_min:0,x_max:705.5625,ha:803,o:"m 705 334 l 0 334 l 0 410 l 705 410 l 705 334 "},":":{x_min:0,x_max:142,ha:239,o:"m 142 585 l 0 585 l 0 738 l 142 738 l 142 585 m 142 0 l 0 0 l 0 151 l 142 151 l 142 0 "},"":{x_min:0,x_max:854.171875,ha:935,o:"m 854 0 l 683 0 l 423 409 l 166 0 l 0 0 l 347 519 l 18 1013 l 186 1013 l 427 637 l 675 1013 l 836 1013 l 504 521 l 854 0 "},"*":{x_min:116,x_max:674,ha:792,o:"m 674 768 l 475 713 l 610 544 l 517 477 l 394 652 l 272 478 l 178 544 l 314 713 l 116 766 l 153 876 l 341 812 l 342 1013 l 446 1013 l 446 811 l 635 874 l 674 768 "},"":{x_min:0,x_max:777,ha:835,o:"m 458 804 l 777 804 l 777 683 l 458 683 l 458 0 l 319 0 l 319 681 l 0 683 l 0 804 l 319 804 l 319 1015 l 458 1013 l 458 804 "},"":{x_min:0,x_max:347,ha:444,o:"m 173 802 q 43 856 91 802 q 0 977 0 905 q 45 1101 0 1049 q 173 1153 90 1153 q 303 1098 255 1153 q 347 977 347 1049 q 303 856 347 905 q 173 802 256 802 m 173 884 q 238 910 214 884 q 262 973 262 937 q 239 1038 262 1012 q 173 1064 217 1064 q 108 1037 132 1064 q 85 973 85 1010 q 108 910 85 937 q 173 884 132 884 "},V:{x_min:0,x_max:862.71875,ha:940,o:"m 862 1013 l 505 0 l 361 0 l 0 1013 l 143 1013 l 434 165 l 718 1012 l 862 1013 "},"":{x_min:0,x_max:734.71875,ha:763,o:"m 723 889 l 9 889 l 9 1013 l 723 1013 l 723 889 m 673 463 l 61 463 l 61 589 l 673 589 l 673 463 m 734 0 l 0 0 l 0 124 l 734 124 l 734 0 "},"":{x_min:0,x_max:0,ha:853},"":{x_min:.328125,x_max:819.515625,ha:889,o:"m 588 1046 l 460 1046 l 460 1189 l 588 1189 l 588 1046 m 360 1046 l 232 1046 l 232 1189 l 360 1189 l 360 1046 m 819 1012 l 482 416 l 482 0 l 342 0 l 342 416 l 0 1012 l 140 1012 l 411 533 l 679 1012 l 819 1012 "},0:{x_min:73,x_max:715,ha:792,o:"m 394 -29 q 153 129 242 -29 q 73 479 73 272 q 152 829 73 687 q 394 989 241 989 q 634 829 545 989 q 715 479 715 684 q 635 129 715 270 q 394 -29 546 -29 m 394 89 q 546 211 489 89 q 598 479 598 322 q 548 748 598 640 q 394 871 491 871 q 241 748 298 871 q 190 479 190 637 q 239 211 190 319 q 394 89 296 89 "},"":{x_min:0,x_max:347,ha:454,o:"m 139 851 q 102 737 139 784 q 0 669 65 690 l 0 734 q 59 787 42 741 q 72 873 72 821 l 0 873 l 0 1013 l 139 1013 l 139 851 m 347 851 q 310 737 347 784 q 208 669 273 690 l 208 734 q 267 787 250 741 q 280 873 280 821 l 208 873 l 208 1013 l 347 1013 l 347 851 "},"@":{x_min:0,x_max:1260,ha:1357,o:"m 1098 -45 q 877 -160 1001 -117 q 633 -203 752 -203 q 155 -29 327 -203 q 0 360 0 127 q 176 802 0 616 q 687 1008 372 1008 q 1123 854 969 1008 q 1260 517 1260 718 q 1155 216 1260 341 q 868 82 1044 82 q 772 106 801 82 q 737 202 737 135 q 647 113 700 144 q 527 82 594 82 q 367 147 420 82 q 314 312 314 212 q 401 565 314 452 q 639 690 498 690 q 810 588 760 690 l 849 668 l 938 668 q 877 441 900 532 q 833 226 833 268 q 853 182 833 198 q 902 167 873 167 q 1088 272 1012 167 q 1159 512 1159 372 q 1051 793 1159 681 q 687 925 925 925 q 248 747 415 925 q 97 361 97 586 q 226 26 97 159 q 627 -122 370 -122 q 856 -87 737 -122 q 1061 8 976 -53 l 1098 -45 m 786 488 q 738 580 777 545 q 643 615 700 615 q 483 517 548 615 q 425 322 425 430 q 457 203 425 250 q 552 156 490 156 q 722 273 665 156 q 786 488 738 309 "},"":{x_min:0,x_max:499,ha:613,o:"m 277 1040 l 83 799 l 0 799 l 140 1040 l 277 1040 m 499 0 l 360 0 l 360 1012 l 499 1012 l 499 0 "},i:{x_min:14,x_max:136,ha:275,o:"m 136 873 l 14 873 l 14 1013 l 136 1013 l 136 873 m 136 0 l 14 0 l 14 737 l 136 737 l 136 0 "},"":{x_min:0,x_max:778,ha:877,o:"m 580 545 q 724 468 671 534 q 778 310 778 402 q 673 83 778 170 q 432 0 575 0 l 0 0 l 0 1013 l 411 1013 q 629 957 541 1013 q 732 768 732 891 q 691 632 732 692 q 580 545 650 571 m 393 899 l 139 899 l 139 587 l 379 587 q 521 623 462 587 q 592 744 592 666 q 531 859 592 819 q 393 899 471 899 m 419 124 q 566 169 504 124 q 635 302 635 219 q 559 435 635 388 q 402 476 494 476 l 139 476 l 139 124 l 419 124 "},"":{x_min:0,x_max:617,ha:725,o:"m 617 352 q 540 94 617 199 q 308 -24 455 -24 q 76 94 161 -24 q 0 352 0 199 l 0 739 l 126 739 l 126 355 q 169 185 126 257 q 312 98 220 98 q 451 185 402 98 q 492 355 492 257 l 492 739 l 617 739 l 617 352 "},"]":{x_min:0,x_max:275,ha:372,o:"m 275 -281 l 0 -281 l 0 -187 l 151 -187 l 151 920 l 0 920 l 0 1013 l 275 1013 l 275 -281 "},m:{x_min:0,x_max:1019,ha:1128,o:"m 1019 0 l 897 0 l 897 454 q 860 591 897 536 q 739 660 816 660 q 613 586 659 660 q 573 436 573 522 l 573 0 l 447 0 l 447 455 q 412 591 447 535 q 294 657 372 657 q 165 586 213 657 q 122 437 122 521 l 122 0 l 0 0 l 0 738 l 117 738 l 117 640 q 202 730 150 697 q 316 763 254 763 q 437 730 381 763 q 525 642 494 697 q 621 731 559 700 q 753 763 682 763 q 943 694 867 763 q 1019 512 1019 625 l 1019 0 "},"":{x_min:8.328125,x_max:780.5625,ha:815,o:"m 780 -278 q 715 -294 747 -294 q 616 -257 663 -294 q 548 -175 576 -227 l 379 133 l 143 -277 l 9 -277 l 313 254 l 163 522 q 127 586 131 580 q 36 640 91 640 q 8 637 27 640 l 8 752 l 52 757 q 162 719 113 757 q 236 627 200 690 l 383 372 l 594 737 l 726 737 l 448 250 l 625 -69 q 670 -153 647 -110 q 743 -188 695 -188 q 780 -184 759 -188 l 780 -278 "},8:{x_min:55,x_max:736,ha:792,o:"m 571 527 q 694 424 652 491 q 736 280 736 358 q 648 71 736 158 q 395 -26 551 -26 q 142 69 238 -26 q 55 279 55 157 q 96 425 55 359 q 220 527 138 491 q 120 615 153 562 q 88 726 88 668 q 171 904 88 827 q 395 986 261 986 q 618 905 529 986 q 702 727 702 830 q 670 616 702 667 q 571 527 638 565 m 394 565 q 519 610 475 565 q 563 717 563 655 q 521 823 563 781 q 392 872 474 872 q 265 824 312 872 q 224 720 224 783 q 265 613 224 656 q 394 565 312 565 m 395 91 q 545 150 488 91 q 597 280 597 204 q 546 408 597 355 q 395 465 492 465 q 244 408 299 465 q 194 280 194 356 q 244 150 194 203 q 395 91 299 91 "},"":{x_min:42,x_max:326.71875,ha:361,o:"m 284 3 q 233 -10 258 -5 q 182 -15 207 -15 q 85 26 119 -15 q 42 200 42 79 l 42 737 l 167 737 l 168 215 q 172 141 168 157 q 226 101 183 101 q 248 102 239 101 q 284 112 257 104 l 284 3 m 326 1040 l 137 819 l 54 819 l 189 1040 l 326 1040 "},"":{x_min:0,x_max:779.171875,ha:850,o:"m 779 0 l 0 0 l 0 113 l 620 896 l 40 896 l 40 1013 l 779 1013 l 779 887 l 170 124 l 779 124 l 779 0 "},R:{x_min:0,x_max:781.953125,ha:907,o:"m 781 0 l 623 0 q 587 242 590 52 q 407 433 585 433 l 138 433 l 138 0 l 0 0 l 0 1013 l 396 1013 q 636 946 539 1013 q 749 731 749 868 q 711 597 749 659 q 608 502 674 534 q 718 370 696 474 q 729 207 722 352 q 781 26 736 62 l 781 0 m 373 551 q 533 594 465 551 q 614 731 614 645 q 532 859 614 815 q 373 896 465 896 l 138 896 l 138 551 l 373 551 "},o:{x_min:0,x_max:713,ha:821,o:"m 357 -25 q 94 91 194 -25 q 0 368 0 202 q 93 642 0 533 q 357 761 193 761 q 618 644 518 761 q 713 368 713 533 q 619 91 713 201 q 357 -25 521 -25 m 357 85 q 528 175 465 85 q 584 369 584 255 q 529 562 584 484 q 357 651 467 651 q 189 560 250 651 q 135 369 135 481 q 187 177 135 257 q 357 85 250 85 "},5:{x_min:54.171875,x_max:738,ha:792,o:"m 738 314 q 626 60 738 153 q 382 -23 526 -23 q 155 47 248 -23 q 54 256 54 125 l 183 256 q 259 132 204 174 q 382 91 314 91 q 533 149 471 91 q 602 314 602 213 q 538 469 602 411 q 386 528 475 528 q 284 506 332 528 q 197 439 237 484 l 81 439 l 159 958 l 684 958 l 684 840 l 254 840 l 214 579 q 306 627 258 612 q 407 643 354 643 q 636 552 540 643 q 738 314 738 457 "},7:{x_min:58.71875,x_max:730.953125,ha:792,o:"m 730 839 q 469 448 560 641 q 335 0 378 255 l 192 0 q 328 441 235 252 q 593 830 421 630 l 58 830 l 58 958 l 730 958 l 730 839 "},K:{x_min:0,x_max:819.46875,ha:906,o:"m 819 0 l 649 0 l 294 509 l 139 355 l 139 0 l 0 0 l 0 1013 l 139 1013 l 139 526 l 626 1013 l 809 1013 l 395 600 l 819 0 "},",":{x_min:0,x_max:142,ha:239,o:"m 142 -12 q 105 -132 142 -82 q 0 -205 68 -182 l 0 -138 q 57 -82 40 -124 q 70 0 70 -51 l 0 0 l 0 151 l 142 151 l 142 -12 "},d:{x_min:0,x_max:683,ha:796,o:"m 683 0 l 564 0 l 564 93 q 456 6 516 38 q 327 -25 395 -25 q 87 100 181 -25 q 0 365 0 215 q 90 639 0 525 q 343 763 187 763 q 564 647 486 763 l 564 1013 l 683 1013 l 683 0 m 582 373 q 529 562 582 484 q 361 653 468 653 q 190 561 253 653 q 135 365 135 479 q 189 175 135 254 q 358 85 251 85 q 529 178 468 85 q 582 373 582 258 "},"":{x_min:-109,x_max:247,ha:232,o:"m 247 1046 l 119 1046 l 119 1189 l 247 1189 l 247 1046 m 19 1046 l -109 1046 l -109 1189 l 19 1189 l 19 1046 "},E:{x_min:0,x_max:736.109375,ha:789,o:"m 736 0 l 0 0 l 0 1013 l 725 1013 l 725 889 l 139 889 l 139 585 l 677 585 l 677 467 l 139 467 l 139 125 l 736 125 l 736 0 "},Y:{x_min:0,x_max:820,ha:886,o:"m 820 1013 l 482 416 l 482 0 l 342 0 l 342 416 l 0 1013 l 140 1013 l 411 534 l 679 1012 l 820 1013 "},'"':{x_min:0,x_max:299,ha:396,o:"m 299 606 l 203 606 l 203 988 l 299 988 l 299 606 m 96 606 l 0 606 l 0 988 l 96 988 l 96 606 "},"":{x_min:17.984375,x_max:773.609375,ha:792,o:"m 773 40 l 18 376 l 17 465 l 773 799 l 773 692 l 159 420 l 773 149 l 773 40 "},"":{x_min:0,x_max:364,ha:467,o:"m 141 -12 q 104 -132 141 -82 q 0 -205 67 -182 l 0 -138 q 56 -82 40 -124 q 69 0 69 -51 l 0 0 l 0 151 l 141 151 l 141 -12 m 364 -12 q 327 -132 364 -82 q 222 -205 290 -182 l 222 -138 q 279 -82 262 -124 q 292 0 292 -51 l 222 0 l 222 151 l 364 151 l 364 -12 "},"":{x_min:1,x_max:710,ha:810,o:"m 710 360 q 616 87 710 196 q 356 -28 518 -28 q 99 82 197 -28 q 1 356 1 192 q 100 606 1 509 q 355 703 199 703 q 180 829 288 754 q 70 903 124 866 l 70 1012 l 643 1012 l 643 901 l 258 901 q 462 763 422 794 q 636 592 577 677 q 710 360 710 485 m 584 365 q 552 501 584 447 q 451 602 521 555 q 372 611 411 611 q 197 541 258 611 q 136 355 136 472 q 190 171 136 245 q 358 85 252 85 q 528 173 465 85 q 584 365 584 252 "},"":{x_min:0,x_max:634.71875,ha:714,o:"m 634 234 q 527 38 634 110 q 300 -25 433 -25 q 98 29 183 -25 q 0 204 0 93 q 37 313 0 265 q 128 390 67 352 q 56 459 82 419 q 26 555 26 505 q 114 712 26 654 q 295 763 191 763 q 499 700 416 763 q 589 515 589 631 l 478 515 q 419 618 464 580 q 307 657 374 657 q 207 630 253 657 q 151 547 151 598 q 238 445 151 469 q 389 434 280 434 l 389 331 l 349 331 q 206 315 255 331 q 125 210 125 287 q 183 107 125 145 q 302 76 233 76 q 436 117 379 76 q 509 234 493 159 l 634 234 m 520 1040 l 331 819 l 248 819 l 383 1040 l 520 1040 "},"":{x_min:0,x_max:922,ha:1031,o:"m 922 339 q 856 97 922 203 q 650 -26 780 -26 q 538 9 587 -26 q 461 103 489 44 q 387 12 436 46 q 277 -22 339 -22 q 69 97 147 -22 q 0 339 0 203 q 45 551 0 444 q 161 738 84 643 l 302 738 q 175 553 219 647 q 124 336 124 446 q 155 179 124 249 q 275 88 197 88 q 375 163 341 88 q 400 294 400 219 l 400 572 l 524 572 l 524 294 q 561 135 524 192 q 643 88 591 88 q 762 182 719 88 q 797 342 797 257 q 745 556 797 450 q 619 738 705 638 l 760 738 q 874 551 835 640 q 922 339 922 444 "},"":{x_min:0,x_max:96,ha:251,o:"m 96 606 l 0 606 l 0 988 l 96 988 l 96 606 "},"":{x_min:11,x_max:781,ha:792,o:"m 781 490 l 446 490 l 446 255 l 349 255 l 349 490 l 11 490 l 11 586 l 349 586 l 349 819 l 446 819 l 446 586 l 781 586 l 781 490 m 781 21 l 11 21 l 11 115 l 781 115 l 781 21 "},"|":{x_min:343,x_max:449,ha:792,o:"m 449 462 l 343 462 l 343 986 l 449 986 l 449 462 m 449 -242 l 343 -242 l 343 280 l 449 280 l 449 -242 "},"":{x_min:0,x_max:617,ha:725,o:"m 482 800 l 372 800 l 372 925 l 482 925 l 482 800 m 239 800 l 129 800 l 129 925 l 239 925 l 239 800 m 617 352 q 540 93 617 199 q 308 -24 455 -24 q 76 93 161 -24 q 0 352 0 199 l 0 738 l 126 738 l 126 354 q 169 185 126 257 q 312 98 220 98 q 451 185 402 98 q 492 354 492 257 l 492 738 l 617 738 l 617 352 "},"":{x_min:0,x_max:593,ha:690,o:"m 593 425 q 554 312 593 369 q 467 233 516 254 q 537 83 537 172 q 459 -74 537 -12 q 288 -133 387 -133 q 115 -69 184 -133 q 47 96 47 -6 l 166 96 q 199 7 166 40 q 288 -26 232 -26 q 371 -5 332 -26 q 420 60 420 21 q 311 201 420 139 q 108 309 210 255 q 0 490 0 383 q 33 602 0 551 q 124 687 66 654 q 75 743 93 712 q 58 812 58 773 q 133 984 58 920 q 300 1043 201 1043 q 458 987 394 1043 q 529 814 529 925 l 411 814 q 370 908 404 877 q 289 939 336 939 q 213 911 246 939 q 180 841 180 883 q 286 720 180 779 q 484 612 480 615 q 593 425 593 534 m 467 409 q 355 544 467 473 q 196 630 228 612 q 146 587 162 609 q 124 525 124 558 q 239 387 124 462 q 398 298 369 315 q 448 345 429 316 q 467 409 467 375 "},b:{x_min:0,x_max:685,ha:783,o:"m 685 372 q 597 99 685 213 q 347 -25 501 -25 q 219 5 277 -25 q 121 93 161 36 l 121 0 l 0 0 l 0 1013 l 121 1013 l 121 634 q 214 723 157 692 q 341 754 272 754 q 591 637 493 754 q 685 372 685 526 m 554 356 q 499 550 554 470 q 328 644 437 644 q 162 556 223 644 q 108 369 108 478 q 160 176 108 256 q 330 83 221 83 q 498 169 435 83 q 554 356 554 245 "},q:{x_min:0,x_max:683,ha:876,o:"m 683 -278 l 564 -278 l 564 97 q 474 8 533 39 q 345 -23 415 -23 q 91 93 188 -23 q 0 364 0 203 q 87 635 0 522 q 337 760 184 760 q 466 727 408 760 q 564 637 523 695 l 564 737 l 683 737 l 683 -278 m 582 375 q 527 564 582 488 q 358 652 466 652 q 190 565 253 652 q 135 377 135 488 q 189 179 135 261 q 361 84 251 84 q 530 179 469 84 q 582 375 582 260 "},"":{x_min:-.171875,x_max:969.5625,ha:1068,o:"m 969 0 l 555 0 l 555 123 q 744 308 675 194 q 814 558 814 423 q 726 812 814 709 q 484 922 633 922 q 244 820 334 922 q 154 567 154 719 q 223 316 154 433 q 412 123 292 199 l 412 0 l 0 0 l 0 124 l 217 124 q 68 327 122 210 q 15 572 15 444 q 144 911 15 781 q 484 1041 274 1041 q 822 909 691 1041 q 953 569 953 777 q 899 326 953 443 q 750 124 846 210 l 969 124 l 969 0 "},"":{x_min:0,x_max:617,ha:725,o:"m 617 352 q 540 93 617 199 q 308 -24 455 -24 q 76 93 161 -24 q 0 352 0 199 l 0 738 l 126 738 l 126 354 q 169 185 126 257 q 312 98 220 98 q 451 185 402 98 q 492 354 492 257 l 492 738 l 617 738 l 617 352 m 535 1040 l 346 819 l 262 819 l 397 1040 l 535 1040 "},z:{x_min:-.015625,x_max:613.890625,ha:697,o:"m 613 0 l 0 0 l 0 100 l 433 630 l 20 630 l 20 738 l 594 738 l 593 636 l 163 110 l 613 110 l 613 0 "},"":{x_min:0,x_max:894,ha:1e3,o:"m 389 951 l 229 951 l 229 503 l 160 503 l 160 951 l 0 951 l 0 1011 l 389 1011 l 389 951 m 894 503 l 827 503 l 827 939 l 685 503 l 620 503 l 481 937 l 481 503 l 417 503 l 417 1011 l 517 1011 l 653 580 l 796 1010 l 894 1011 l 894 503 "},"":{x_min:.78125,x_max:697,ha:810,o:"m 697 -278 l 572 -278 l 572 454 q 540 587 572 536 q 425 650 501 650 q 271 579 337 650 q 206 420 206 509 l 206 0 l 81 0 l 81 489 q 73 588 81 562 q 0 644 56 644 l 0 741 q 68 755 38 755 q 158 721 124 755 q 200 630 193 687 q 297 726 234 692 q 434 761 359 761 q 620 692 544 761 q 697 516 697 624 l 697 -278 m 479 1040 l 290 819 l 207 819 l 341 1040 l 479 1040 "},"":{x_min:0,x_max:960,ha:1056,o:"m 960 507 q 833 129 960 280 q 476 -32 698 -32 q 123 129 255 -32 q 0 507 0 280 q 123 883 0 732 q 476 1045 255 1045 q 832 883 696 1045 q 960 507 960 732 m 817 500 q 733 789 817 669 q 476 924 639 924 q 223 792 317 924 q 142 507 142 675 q 222 222 142 339 q 476 89 315 89 q 730 218 636 89 q 817 500 817 334 m 716 449 l 243 449 l 243 571 l 716 571 l 716 449 "},"":{x_min:-3,x_max:1008,ha:1106,o:"m 503 532 q 614 562 566 532 q 672 658 672 598 q 614 747 672 716 q 503 772 569 772 l 338 772 l 338 532 l 503 532 m 502 -7 q 123 151 263 -7 q -3 501 -3 294 q 123 851 -3 706 q 502 1011 263 1011 q 881 851 739 1011 q 1008 501 1008 708 q 883 151 1008 292 q 502 -7 744 -7 m 502 60 q 830 197 709 60 q 940 501 940 322 q 831 805 940 681 q 502 944 709 944 q 174 805 296 944 q 65 501 65 680 q 173 197 65 320 q 502 60 294 60 m 788 146 l 678 146 q 653 316 655 183 q 527 449 652 449 l 338 449 l 338 146 l 241 146 l 241 854 l 518 854 q 688 808 621 854 q 766 658 766 755 q 739 563 766 607 q 668 497 713 519 q 751 331 747 472 q 788 164 756 190 l 788 146 "},"~":{x_min:0,x_max:833,ha:931,o:"m 833 958 q 778 753 833 831 q 594 665 716 665 q 402 761 502 665 q 240 857 302 857 q 131 795 166 857 q 104 665 104 745 l 0 665 q 54 867 0 789 q 237 958 116 958 q 429 861 331 958 q 594 765 527 765 q 704 827 670 765 q 729 958 729 874 l 833 958 "},"":{x_min:0,x_max:736.21875,ha:778,o:"m 736 0 l 0 0 l 0 1013 l 725 1013 l 725 889 l 139 889 l 139 585 l 677 585 l 677 467 l 139 467 l 139 125 l 736 125 l 736 0 "},"":{x_min:0,x_max:450,ha:547,o:"m 450 552 q 379 413 450 464 q 220 366 313 366 q 69 414 130 366 q 0 567 0 470 l 85 567 q 126 470 85 504 q 225 437 168 437 q 320 467 280 437 q 360 552 360 498 q 318 632 360 608 q 213 657 276 657 q 195 657 203 657 q 176 657 181 657 l 176 722 q 279 733 249 722 q 334 815 334 752 q 300 881 334 856 q 220 907 267 907 q 133 875 169 907 q 97 781 97 844 l 15 781 q 78 926 15 875 q 220 972 135 972 q 364 930 303 972 q 426 817 426 888 q 344 697 426 733 q 421 642 392 681 q 450 552 450 603 "},"[":{x_min:0,x_max:273.609375,ha:371,o:"m 273 -281 l 0 -281 l 0 1013 l 273 1013 l 273 920 l 124 920 l 124 -187 l 273 -187 l 273 -281 "},L:{x_min:0,x_max:645.828125,ha:696,o:"m 645 0 l 0 0 l 0 1013 l 140 1013 l 140 126 l 645 126 l 645 0 "},"":{x_min:0,x_max:803.390625,ha:894,o:"m 803 628 l 633 628 q 713 368 713 512 q 618 93 713 204 q 357 -25 518 -25 q 94 91 194 -25 q 0 368 0 201 q 94 644 0 533 q 356 761 194 761 q 481 750 398 761 q 608 739 564 739 l 803 739 l 803 628 m 360 85 q 529 180 467 85 q 584 374 584 262 q 527 566 584 490 q 352 651 463 651 q 187 559 247 651 q 135 368 135 478 q 189 175 135 254 q 360 85 251 85 "},"":{x_min:0,x_max:573,ha:642,o:"m 573 -40 q 553 -162 573 -97 q 510 -278 543 -193 l 400 -278 q 441 -187 428 -219 q 462 -90 462 -132 q 378 -14 462 -14 q 108 45 197 -14 q 0 290 0 117 q 108 631 0 462 q 353 901 194 767 l 55 901 l 55 1012 l 561 1012 l 561 924 q 261 669 382 831 q 128 301 128 489 q 243 117 128 149 q 458 98 350 108 q 573 -40 573 80 "},"":{x_min:0,x_max:674,ha:778,o:"m 674 496 q 601 160 674 304 q 336 -26 508 -26 q 73 153 165 -26 q 0 485 0 296 q 72 840 0 683 q 343 1045 166 1045 q 605 844 516 1045 q 674 496 674 692 m 546 579 q 498 798 546 691 q 336 935 437 935 q 178 798 237 935 q 126 579 137 701 l 546 579 m 546 475 l 126 475 q 170 233 126 348 q 338 80 230 80 q 504 233 447 80 q 546 475 546 346 "},"":{x_min:0,x_max:958,ha:1054,o:"m 485 1042 q 834 883 703 1042 q 958 511 958 735 q 834 136 958 287 q 481 -26 701 -26 q 126 130 261 -26 q 0 504 0 279 q 127 880 0 729 q 485 1042 263 1042 m 480 98 q 731 225 638 98 q 815 504 815 340 q 733 783 815 670 q 480 913 640 913 q 226 785 321 913 q 142 504 142 671 q 226 224 142 339 q 480 98 319 98 "},"":{x_min:0,x_max:705.28125,ha:749,o:"m 705 886 l 140 886 l 140 0 l 0 0 l 0 1012 l 705 1012 l 705 886 "}," ":{x_min:0,x_max:0,ha:375},"%":{x_min:-3,x_max:1089,ha:1186,o:"m 845 0 q 663 76 731 0 q 602 244 602 145 q 661 412 602 344 q 845 489 728 489 q 1027 412 959 489 q 1089 244 1089 343 q 1029 76 1089 144 q 845 0 962 0 m 844 103 q 945 143 909 103 q 981 243 981 184 q 947 340 981 301 q 844 385 909 385 q 744 342 781 385 q 708 243 708 300 q 741 147 708 186 q 844 103 780 103 m 888 986 l 284 -25 l 199 -25 l 803 986 l 888 986 m 241 468 q 58 545 126 468 q -3 715 -3 615 q 56 881 -3 813 q 238 958 124 958 q 421 881 353 958 q 483 712 483 813 q 423 544 483 612 q 241 468 356 468 m 241 855 q 137 811 175 855 q 100 710 100 768 q 136 612 100 653 q 240 572 172 572 q 344 614 306 572 q 382 713 382 656 q 347 810 382 771 q 241 855 308 855 "},P:{x_min:0,x_max:726,ha:806,o:"m 424 1013 q 640 931 555 1013 q 726 719 726 850 q 637 506 726 587 q 413 426 548 426 l 140 426 l 140 0 l 0 0 l 0 1013 l 424 1013 m 379 889 l 140 889 l 140 548 l 372 548 q 522 589 459 548 q 593 720 593 637 q 528 845 593 801 q 379 889 463 889 "},"":{x_min:0,x_max:1078.21875,ha:1118,o:"m 1078 0 l 342 0 l 342 1013 l 1067 1013 l 1067 889 l 481 889 l 481 585 l 1019 585 l 1019 467 l 481 467 l 481 125 l 1078 125 l 1078 0 m 277 1040 l 83 799 l 0 799 l 140 1040 l 277 1040 "},"":{x_min:.125,x_max:1136.546875,ha:1235,o:"m 1136 0 l 722 0 l 722 123 q 911 309 842 194 q 981 558 981 423 q 893 813 981 710 q 651 923 800 923 q 411 821 501 923 q 321 568 321 720 q 390 316 321 433 q 579 123 459 200 l 579 0 l 166 0 l 166 124 l 384 124 q 235 327 289 210 q 182 572 182 444 q 311 912 182 782 q 651 1042 441 1042 q 989 910 858 1042 q 1120 569 1120 778 q 1066 326 1120 443 q 917 124 1013 210 l 1136 124 l 1136 0 m 277 1040 l 83 800 l 0 800 l 140 1041 l 277 1040 "},_:{x_min:0,x_max:705.5625,ha:803,o:"m 705 -334 l 0 -334 l 0 -234 l 705 -234 l 705 -334 "},"":{x_min:-110,x_max:246,ha:275,o:"m 246 1046 l 118 1046 l 118 1189 l 246 1189 l 246 1046 m 18 1046 l -110 1046 l -110 1189 l 18 1189 l 18 1046 m 136 0 l 0 0 l 0 1012 l 136 1012 l 136 0 "},"+":{x_min:23,x_max:768,ha:792,o:"m 768 372 l 444 372 l 444 0 l 347 0 l 347 372 l 23 372 l 23 468 l 347 468 l 347 840 l 444 840 l 444 468 l 768 468 l 768 372 "},"":{x_min:0,x_max:1050,ha:1149,o:"m 1050 0 l 625 0 q 712 178 625 108 q 878 277 722 187 q 967 385 967 328 q 932 456 967 429 q 850 484 897 484 q 759 450 798 484 q 721 352 721 416 l 640 352 q 706 502 640 448 q 851 551 766 551 q 987 509 931 551 q 1050 385 1050 462 q 976 251 1050 301 q 829 179 902 215 q 717 68 740 133 l 1050 68 l 1050 0 m 834 985 l 215 -28 l 130 -28 l 750 984 l 834 985 m 224 422 l 142 422 l 142 811 l 0 811 l 0 867 q 104 889 62 867 q 164 973 157 916 l 224 973 l 224 422 "},"":{x_min:0,x_max:720,ha:783,o:"m 424 1013 q 637 933 554 1013 q 720 723 720 853 q 633 508 720 591 q 413 426 546 426 l 140 426 l 140 0 l 0 0 l 0 1013 l 424 1013 m 378 889 l 140 889 l 140 548 l 371 548 q 521 589 458 548 q 592 720 592 637 q 527 845 592 801 q 378 889 463 889 "},"'":{x_min:0,x_max:139,ha:236,o:"m 139 851 q 102 737 139 784 q 0 669 65 690 l 0 734 q 59 787 42 741 q 72 873 72 821 l 0 873 l 0 1013 l 139 1013 l 139 851 "},"":{x_min:0,x_max:350,ha:397,o:"m 350 625 q 307 616 328 616 q 266 631 281 616 q 247 673 251 645 q 190 628 225 644 q 116 613 156 613 q 32 641 64 613 q 0 722 0 669 q 72 826 0 800 q 247 866 159 846 l 247 887 q 220 934 247 916 q 162 953 194 953 q 104 934 129 953 q 76 882 80 915 l 16 882 q 60 976 16 941 q 166 1011 104 1011 q 266 979 224 1011 q 308 891 308 948 l 308 706 q 311 679 308 688 q 331 670 315 670 l 350 672 l 350 625 m 247 757 l 247 811 q 136 790 175 798 q 64 726 64 773 q 83 682 64 697 q 132 667 103 667 q 207 690 174 667 q 247 757 247 718 "},"":{x_min:0,x_max:450,ha:553,o:"m 450 800 l 340 800 l 340 925 l 450 925 l 450 800 m 406 1040 l 212 800 l 129 800 l 269 1040 l 406 1040 m 110 800 l 0 800 l 0 925 l 110 925 l 110 800 "},T:{x_min:0,x_max:777,ha:835,o:"m 777 894 l 458 894 l 458 0 l 319 0 l 319 894 l 0 894 l 0 1013 l 777 1013 l 777 894 "},"":{x_min:0,x_max:915,ha:997,o:"m 527 0 l 389 0 l 389 122 q 110 231 220 122 q 0 509 0 340 q 110 785 0 677 q 389 893 220 893 l 389 1013 l 527 1013 l 527 893 q 804 786 693 893 q 915 509 915 679 q 805 231 915 341 q 527 122 696 122 l 527 0 m 527 226 q 712 310 641 226 q 779 507 779 389 q 712 705 779 627 q 527 787 641 787 l 527 226 m 389 226 l 389 787 q 205 698 275 775 q 136 505 136 620 q 206 308 136 391 q 389 226 276 226 "},"":{x_min:0,x_max:0,ha:694},j:{x_min:-77.78125,x_max:167,ha:349,o:"m 167 871 l 42 871 l 42 1013 l 167 1013 l 167 871 m 167 -80 q 121 -231 167 -184 q -26 -278 76 -278 l -77 -278 l -77 -164 l -41 -164 q 26 -143 11 -164 q 42 -65 42 -122 l 42 737 l 167 737 l 167 -80 "},"":{x_min:0,x_max:756.953125,ha:819,o:"m 756 0 l 0 0 l 0 107 l 395 523 l 22 904 l 22 1013 l 745 1013 l 745 889 l 209 889 l 566 523 l 187 125 l 756 125 l 756 0 "},1:{x_min:215.671875,x_max:574,ha:792,o:"m 574 0 l 442 0 l 442 697 l 215 697 l 215 796 q 386 833 330 796 q 475 986 447 875 l 574 986 l 574 0 "},"":{x_min:18.0625,x_max:774,ha:792,o:"m 774 376 l 18 40 l 18 149 l 631 421 l 18 692 l 18 799 l 774 465 l 774 376 "},"<":{x_min:17.984375,x_max:773.609375,ha:792,o:"m 773 40 l 18 376 l 17 465 l 773 799 l 773 692 l 159 420 l 773 149 l 773 40 "},"":{x_min:0,x_max:704.484375,ha:801,o:"m 704 41 q 623 -10 664 5 q 543 -26 583 -26 q 359 15 501 -26 q 243 36 288 36 q 158 23 197 36 q 73 -21 119 10 l 6 76 q 125 195 90 150 q 175 331 175 262 q 147 443 175 383 l 0 443 l 0 512 l 108 512 q 43 734 43 623 q 120 929 43 854 q 358 1010 204 1010 q 579 936 487 1010 q 678 729 678 857 l 678 684 l 552 684 q 504 838 552 780 q 362 896 457 896 q 216 852 263 896 q 176 747 176 815 q 199 627 176 697 q 248 512 217 574 l 468 512 l 468 443 l 279 443 q 297 356 297 398 q 230 194 297 279 q 153 107 211 170 q 227 133 190 125 q 293 142 264 142 q 410 119 339 142 q 516 96 482 96 q 579 105 550 96 q 648 142 608 115 l 704 41 "},t:{x_min:0,x_max:367,ha:458,o:"m 367 0 q 312 -5 339 -2 q 262 -8 284 -8 q 145 28 183 -8 q 108 143 108 64 l 108 638 l 0 638 l 0 738 l 108 738 l 108 944 l 232 944 l 232 738 l 367 738 l 367 638 l 232 638 l 232 185 q 248 121 232 140 q 307 102 264 102 q 345 104 330 102 q 367 107 360 107 l 367 0 "},"":{x_min:0,x_max:706,ha:803,o:"m 706 411 l 706 158 l 630 158 l 630 335 l 0 335 l 0 411 l 706 411 "},"":{x_min:0,x_max:750,ha:803,o:"m 750 -7 q 679 -15 716 -15 q 538 59 591 -15 q 466 214 512 97 l 336 551 l 126 0 l 0 0 l 270 705 q 223 837 247 770 q 116 899 190 899 q 90 898 100 899 l 90 1004 q 152 1011 125 1011 q 298 938 244 1011 q 373 783 326 901 l 605 192 q 649 115 629 136 q 716 95 669 95 l 736 95 q 750 97 745 97 l 750 -7 "},W:{x_min:0,x_max:1263.890625,ha:1351,o:"m 1263 1013 l 995 0 l 859 0 l 627 837 l 405 0 l 265 0 l 0 1013 l 136 1013 l 342 202 l 556 1013 l 701 1013 l 921 207 l 1133 1012 l 1263 1013 "},">":{x_min:18.0625,x_max:774,ha:792,o:"m 774 376 l 18 40 l 18 149 l 631 421 l 18 692 l 18 799 l 774 465 l 774 376 "},v:{x_min:0,x_max:675.15625,ha:761,o:"m 675 738 l 404 0 l 272 0 l 0 738 l 133 737 l 340 147 l 541 737 l 675 738 "},"":{x_min:.28125,x_max:644.5,ha:703,o:"m 644 628 l 382 628 l 382 179 q 388 120 382 137 q 436 91 401 91 q 474 94 447 91 q 504 97 501 97 l 504 0 q 454 -9 482 -5 q 401 -14 426 -14 q 278 67 308 -14 q 260 233 260 118 l 260 628 l 0 628 l 0 739 l 644 739 l 644 628 "},"":{x_min:0,x_max:624.9375,ha:699,o:"m 624 -37 q 608 -153 624 -96 q 563 -278 593 -211 l 454 -278 q 491 -183 486 -200 q 511 -83 511 -126 q 484 -23 511 -44 q 370 1 452 1 q 323 0 354 1 q 283 -1 293 -1 q 84 76 169 -1 q 0 266 0 154 q 56 431 0 358 q 197 538 108 498 q 94 613 134 562 q 54 730 54 665 q 77 823 54 780 q 143 901 101 867 l 27 901 l 27 1012 l 576 1012 l 576 901 l 380 901 q 244 863 303 901 q 178 745 178 820 q 312 600 178 636 q 532 582 380 582 l 532 479 q 276 455 361 479 q 118 281 118 410 q 165 173 118 217 q 274 120 208 133 q 494 101 384 110 q 624 -37 624 76 "},"&":{x_min:-3,x_max:894.25,ha:992,o:"m 894 0 l 725 0 l 624 123 q 471 0 553 40 q 306 -41 390 -41 q 168 -7 231 -41 q 62 92 105 26 q 14 187 31 139 q -3 276 -3 235 q 55 433 -3 358 q 248 581 114 508 q 170 689 196 640 q 137 817 137 751 q 214 985 137 922 q 384 1041 284 1041 q 548 988 483 1041 q 622 824 622 928 q 563 666 622 739 q 431 556 516 608 l 621 326 q 649 407 639 361 q 663 493 653 426 l 781 493 q 703 229 781 352 l 894 0 m 504 818 q 468 908 504 877 q 384 940 433 940 q 293 907 331 940 q 255 818 255 875 q 289 714 255 767 q 363 628 313 678 q 477 729 446 682 q 504 818 504 771 m 556 209 l 314 499 q 179 395 223 449 q 135 283 135 341 q 146 222 135 253 q 183 158 158 192 q 333 80 241 80 q 556 209 448 80 "},"":{x_min:0,x_max:862.5,ha:942,o:"m 862 0 l 719 0 l 426 847 l 143 0 l 0 0 l 356 1013 l 501 1013 l 862 0 "},I:{x_min:41,x_max:180,ha:293,o:"m 180 0 l 41 0 l 41 1013 l 180 1013 l 180 0 "},G:{x_min:0,x_max:921,ha:1011,o:"m 921 0 l 832 0 l 801 136 q 655 15 741 58 q 470 -28 568 -28 q 126 133 259 -28 q 0 499 0 284 q 125 881 0 731 q 486 1043 259 1043 q 763 957 647 1043 q 905 709 890 864 l 772 709 q 668 866 747 807 q 486 926 589 926 q 228 795 322 926 q 142 507 142 677 q 228 224 142 342 q 483 94 323 94 q 712 195 625 94 q 796 435 796 291 l 477 435 l 477 549 l 921 549 l 921 0 "},"":{x_min:0,x_max:617,ha:725,o:"m 524 800 l 414 800 l 414 925 l 524 925 l 524 800 m 183 800 l 73 800 l 73 925 l 183 925 l 183 800 m 617 352 q 540 93 617 199 q 308 -24 455 -24 q 76 93 161 -24 q 0 352 0 199 l 0 738 l 126 738 l 126 354 q 169 185 126 257 q 312 98 220 98 q 451 185 402 98 q 492 354 492 257 l 492 738 l 617 738 l 617 352 m 489 1040 l 300 819 l 216 819 l 351 1040 l 489 1040 "},"`":{x_min:0,x_max:138.890625,ha:236,o:"m 138 699 l 0 699 l 0 861 q 36 974 0 929 q 138 1041 72 1020 l 138 977 q 82 931 95 969 q 69 839 69 893 l 138 839 l 138 699 "},"":{x_min:0,x_max:142,ha:239,o:"m 142 585 l 0 585 l 0 738 l 142 738 l 142 585 "},"":{x_min:.328125,x_max:819.515625,ha:889,o:"m 819 1013 l 482 416 l 482 0 l 342 0 l 342 416 l 0 1013 l 140 1013 l 411 533 l 679 1013 l 819 1013 "},r:{x_min:0,x_max:355.5625,ha:432,o:"m 355 621 l 343 621 q 179 569 236 621 q 122 411 122 518 l 122 0 l 0 0 l 0 737 l 117 737 l 117 604 q 204 719 146 686 q 355 753 262 753 l 355 621 "},x:{x_min:0,x_max:675,ha:764,o:"m 675 0 l 525 0 l 331 286 l 144 0 l 0 0 l 256 379 l 12 738 l 157 737 l 336 473 l 516 738 l 661 738 l 412 380 l 675 0 "},"":{x_min:0,x_max:696.609375,ha:747,o:"m 696 -4 q 628 -14 657 -14 q 498 97 513 -14 q 422 8 470 41 q 313 -24 374 -24 q 207 3 258 -24 q 120 80 157 31 l 120 -278 l 0 -278 l 0 738 l 124 738 l 124 343 q 165 172 124 246 q 308 82 216 82 q 451 177 402 82 q 492 358 492 254 l 492 738 l 616 738 l 616 214 q 623 136 616 160 q 673 92 636 92 q 696 95 684 92 l 696 -4 "},h:{x_min:0,x_max:615,ha:724,o:"m 615 472 l 615 0 l 490 0 l 490 454 q 456 590 490 535 q 338 654 416 654 q 186 588 251 654 q 122 436 122 522 l 122 0 l 0 0 l 0 1013 l 122 1013 l 122 633 q 218 727 149 694 q 362 760 287 760 q 552 676 484 760 q 615 472 615 600 "},".":{x_min:0,x_max:142,ha:239,o:"m 142 0 l 0 0 l 0 151 l 142 151 l 142 0 "},"":{x_min:-2,x_max:878,ha:974,o:"m 496 -279 l 378 -279 l 378 -17 q 101 88 204 -17 q -2 367 -2 194 q 68 626 -2 510 q 283 758 151 758 l 283 646 q 167 537 209 626 q 133 373 133 462 q 192 177 133 254 q 378 93 259 93 l 378 758 q 445 764 426 763 q 476 765 464 765 q 765 659 653 765 q 878 377 878 553 q 771 96 878 209 q 496 -17 665 -17 l 496 -279 m 496 93 l 514 93 q 687 183 623 93 q 746 380 746 265 q 691 569 746 491 q 522 658 629 658 l 496 656 l 496 93 "},";":{x_min:0,x_max:142,ha:239,o:"m 142 585 l 0 585 l 0 738 l 142 738 l 142 585 m 142 -12 q 105 -132 142 -82 q 0 -206 68 -182 l 0 -138 q 58 -82 43 -123 q 68 0 68 -56 l 0 0 l 0 151 l 142 151 l 142 -12 "},f:{x_min:0,x_max:378,ha:472,o:"m 378 638 l 246 638 l 246 0 l 121 0 l 121 638 l 0 638 l 0 738 l 121 738 q 137 935 121 887 q 290 1028 171 1028 q 320 1027 305 1028 q 378 1021 334 1026 l 378 908 q 323 918 346 918 q 257 870 273 918 q 246 780 246 840 l 246 738 l 378 738 l 378 638 "},"":{x_min:1,x_max:348.21875,ha:454,o:"m 140 670 l 1 670 l 1 830 q 37 943 1 897 q 140 1011 74 990 l 140 947 q 82 900 97 940 q 68 810 68 861 l 140 810 l 140 670 m 348 670 l 209 670 l 209 830 q 245 943 209 897 q 348 1011 282 990 l 348 947 q 290 900 305 940 q 276 810 276 861 l 348 810 l 348 670 "},A:{x_min:.03125,x_max:906.953125,ha:1008,o:"m 906 0 l 756 0 l 648 303 l 251 303 l 142 0 l 0 0 l 376 1013 l 529 1013 l 906 0 m 610 421 l 452 867 l 293 421 l 610 421 "},6:{x_min:53,x_max:739,ha:792,o:"m 739 312 q 633 62 739 162 q 400 -31 534 -31 q 162 78 257 -31 q 53 439 53 206 q 178 859 53 712 q 441 986 284 986 q 643 912 559 986 q 732 713 732 833 l 601 713 q 544 830 594 786 q 426 875 494 875 q 268 793 331 875 q 193 517 193 697 q 301 597 240 570 q 427 624 362 624 q 643 540 552 624 q 739 312 739 451 m 603 298 q 540 461 603 400 q 404 516 484 516 q 268 461 323 516 q 207 300 207 401 q 269 137 207 198 q 405 83 325 83 q 541 137 486 83 q 603 298 603 197 "},"":{x_min:1,x_max:139.890625,ha:236,o:"m 139 670 l 1 670 l 1 830 q 37 943 1 897 q 139 1011 74 990 l 139 947 q 82 900 97 940 q 68 810 68 861 l 139 810 l 139 670 "},"":{x_min:-70,x_max:283,ha:361,o:"m 283 800 l 173 800 l 173 925 l 283 925 l 283 800 m 40 800 l -70 800 l -70 925 l 40 925 l 40 800 m 283 3 q 232 -10 257 -5 q 181 -15 206 -15 q 84 26 118 -15 q 41 200 41 79 l 41 737 l 166 737 l 167 215 q 171 141 167 157 q 225 101 182 101 q 247 103 238 101 q 283 112 256 104 l 283 3 "},"":{x_min:-.21875,x_max:773.21875,ha:857,o:"m 773 -7 l 707 -11 q 575 40 607 -11 q 552 174 552 77 l 552 226 l 552 626 l 222 626 l 222 0 l 97 0 l 97 626 l 0 626 l 0 737 l 773 737 l 773 626 l 676 626 l 676 171 q 695 103 676 117 q 773 90 714 90 l 773 -7 "},"":{x_min:0,x_max:765.5625,ha:809,o:"m 765 -4 q 698 -14 726 -14 q 564 97 586 -14 q 466 7 525 40 q 337 -26 407 -26 q 88 98 186 -26 q 0 369 0 212 q 88 637 0 525 q 337 760 184 760 q 465 727 407 760 q 563 637 524 695 l 563 738 l 685 738 l 685 222 q 693 141 685 168 q 748 94 708 94 q 765 95 760 94 l 765 -4 m 584 371 q 531 562 584 485 q 360 653 470 653 q 192 566 254 653 q 135 379 135 489 q 186 181 135 261 q 358 84 247 84 q 528 176 465 84 q 584 371 584 260 m 604 1040 l 415 819 l 332 819 l 466 1040 l 604 1040 "},O:{x_min:0,x_max:958,ha:1057,o:"m 485 1041 q 834 882 702 1041 q 958 512 958 734 q 834 136 958 287 q 481 -26 702 -26 q 126 130 261 -26 q 0 504 0 279 q 127 880 0 728 q 485 1041 263 1041 m 480 98 q 731 225 638 98 q 815 504 815 340 q 733 783 815 669 q 480 912 640 912 q 226 784 321 912 q 142 504 142 670 q 226 224 142 339 q 480 98 319 98 "},n:{x_min:0,x_max:615,ha:724,o:"m 615 463 l 615 0 l 490 0 l 490 454 q 453 592 490 537 q 331 656 410 656 q 178 585 240 656 q 117 421 117 514 l 117 0 l 0 0 l 0 738 l 117 738 l 117 630 q 218 728 150 693 q 359 764 286 764 q 552 675 484 764 q 615 463 615 593 "},3:{x_min:54,x_max:737,ha:792,o:"m 737 284 q 635 55 737 141 q 399 -25 541 -25 q 156 52 248 -25 q 54 308 54 140 l 185 308 q 245 147 185 202 q 395 96 302 96 q 539 140 484 96 q 602 280 602 190 q 510 429 602 390 q 324 454 451 454 l 324 565 q 487 584 441 565 q 565 719 565 617 q 515 835 565 791 q 395 879 466 879 q 255 824 307 879 q 203 661 203 769 l 78 661 q 166 909 78 822 q 387 992 250 992 q 603 921 513 992 q 701 723 701 844 q 669 607 701 656 q 578 524 637 558 q 696 434 655 499 q 737 284 737 369 "},9:{x_min:53,x_max:739,ha:792,o:"m 739 524 q 619 94 739 241 q 362 -32 516 -32 q 150 47 242 -32 q 59 244 59 126 l 191 244 q 246 129 191 176 q 373 82 301 82 q 526 161 466 82 q 597 440 597 255 q 363 334 501 334 q 130 432 216 334 q 53 650 53 521 q 134 880 53 786 q 383 986 226 986 q 659 841 566 986 q 739 524 739 719 m 388 449 q 535 514 480 449 q 585 658 585 573 q 535 805 585 744 q 388 873 480 873 q 242 809 294 873 q 191 658 191 745 q 239 514 191 572 q 388 449 292 449 "},l:{x_min:41,x_max:166,ha:279,o:"m 166 0 l 41 0 l 41 1013 l 166 1013 l 166 0 "},"":{x_min:40.09375,x_max:728.796875,ha:825,o:"m 728 304 l 649 224 l 512 363 q 383 331 458 331 q 256 363 310 331 l 119 224 l 40 304 l 177 441 q 150 553 150 493 q 184 673 150 621 l 40 818 l 119 898 l 267 749 q 321 766 291 759 q 384 773 351 773 q 447 766 417 773 q 501 749 477 759 l 649 898 l 728 818 l 585 675 q 612 618 604 648 q 621 553 621 587 q 591 441 621 491 l 728 304 m 384 682 q 280 643 318 682 q 243 551 243 604 q 279 461 243 499 q 383 423 316 423 q 487 461 449 423 q 525 553 525 500 q 490 641 525 605 q 384 682 451 682 "},"":{x_min:0,x_max:632.328125,ha:679,o:"m 632 0 l 482 0 l 225 384 l 124 288 l 124 0 l 0 0 l 0 738 l 124 738 l 124 446 l 433 738 l 596 738 l 312 466 l 632 0 "},4:{x_min:48,x_max:742.453125,ha:792,o:"m 742 243 l 602 243 l 602 0 l 476 0 l 476 243 l 48 243 l 48 368 l 476 958 l 602 958 l 602 354 l 742 354 l 742 243 m 476 354 l 476 792 l 162 354 l 476 354 "},p:{x_min:0,x_max:685,ha:786,o:"m 685 364 q 598 96 685 205 q 350 -23 504 -23 q 121 89 205 -23 l 121 -278 l 0 -278 l 0 738 l 121 738 l 121 633 q 220 726 159 691 q 351 761 280 761 q 598 636 504 761 q 685 364 685 522 m 557 371 q 501 560 557 481 q 330 651 437 651 q 162 559 223 651 q 108 366 108 479 q 162 177 108 254 q 333 87 224 87 q 502 178 441 87 q 557 371 557 258 "},"":{x_min:0,x_max:777,ha:835,o:"m 458 238 l 458 0 l 319 0 l 319 238 l 0 238 l 0 360 l 319 360 l 319 681 l 0 683 l 0 804 l 319 804 l 319 1015 l 458 1013 l 458 804 l 777 804 l 777 683 l 458 683 l 458 360 l 777 360 l 777 238 l 458 238 "},"":{x_min:0,x_max:808,ha:907,o:"m 465 -278 l 341 -278 l 341 -15 q 87 102 180 -15 q 0 378 0 210 l 0 739 l 133 739 l 133 379 q 182 195 133 275 q 341 98 242 98 l 341 922 l 465 922 l 465 98 q 623 195 563 98 q 675 382 675 278 l 675 742 l 808 742 l 808 381 q 720 104 808 213 q 466 -13 627 -13 l 465 -278 "},"":{x_min:.78125,x_max:697,ha:810,o:"m 697 -278 l 572 -278 l 572 454 q 540 587 572 536 q 425 650 501 650 q 271 579 337 650 q 206 420 206 509 l 206 0 l 81 0 l 81 489 q 73 588 81 562 q 0 644 56 644 l 0 741 q 68 755 38 755 q 158 720 124 755 q 200 630 193 686 q 297 726 234 692 q 434 761 359 761 q 620 692 544 761 q 697 516 697 624 l 697 -278 "}},cssFontWeight:"normal",ascender:1189,underlinePosition:-100,cssFontStyle:"normal",boundingBox:{yMin:-334,xMin:-111,yMax:1189,xMax:1672},resolution:1e3,original_font_information:{postscript_name:"Helvetiker-Regular",version_string:"Version 1.00 2004 initial release",vendor_url:"http://www.magenta.gr/",full_font_name:"Helvetiker",font_family_name:"Helvetiker",copyright:"Copyright (c) agenta ltd, 2004",description:"",trademark:"",designer:"",designer_url:"",unique_font_identifier:"agenta ltd:Helvetiker:22-10-104",license_url:"http://www.ellak.gr/fonts/MgOpen/license.html",license_description:'Copyright (c) 2004 by MAGENTA Ltd. All Rights Reserved.\r\n\r\nPermission is hereby granted, free of charge, to any person obtaining a copy of the fonts accompanying this license ("Fonts") and associated documentation files (the "Font Software"), to reproduce and distribute the Font Software, including without limitation the rights to use, copy, merge, publish, distribute, and/or sell copies of the Font Software, and to permit persons to whom the Font Software is furnished to do so, subject to the following conditions: \r\n\r\nThe above copyright and this permission notice shall be included in all copies of one or more of the Font Software typefaces.\r\n\r\nThe Font Software may be modified, altered, or added to, and in particular the designs of glyphs or characters in the Fonts may be modified and additional glyphs or characters may be added to the Fonts, only if the fonts are renamed to names not containing the word "MgOpen", or if the modifications are accepted for inclusion in the Font Software itself by the each appointed Administrator.\r\n\r\nThis License becomes null and void to the extent applicable to Fonts or Font Software that has been modified and is distributed under the "MgOpen" name.\r\n\r\nThe Font Software may be sold as part of a larger software package but no copy of one or more of the Font Software typefaces may be sold by itself. \r\n\r\nTHE FONT SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO ANY WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT OF COPYRIGHT, PATENT, TRADEMARK, OR OTHER RIGHT. IN NO EVENT SHALL MAGENTA OR PERSONS OR BODIES IN CHARGE OF ADMINISTRATION AND MAINTENANCE OF THE FONT SOFTWARE BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, INCLUDING ANY GENERAL, SPECIAL, INDIRECT, INCIDENTAL, OR CONSEQUENTIAL DAMAGES, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF THE USE OR INABILITY TO USE THE FONT SOFTWARE OR FROM OTHER DEALINGS IN THE FONT SOFTWARE.',manufacturer_name:"agenta ltd",font_sub_family_name:"Regular"},descender:-334,familyName:"Helvetiker",lineHeight:1522,underlineThickness:50})},n}(ho),Ca={id:"id",name:"name",userID:"userid",position:"position",rotation:"rotation",scale:"scale",properties:"properties",plans:"plans",walls:"walls",placements:"placements",videoprobes:"videoprobes",groups:"groups",corners:"corners",holesCorners:"holescorners",doorOrWindows:"doororwindows",curveLines:"curvelines",pipeLines:"pipelines",text3Ds:"text3ds",rooms:"rooms",height:"height",thick:"thick",texture:"texture",type:"type",model:"model",suspendPercent:"suspendpercent",leftTexture:"lefttexture",rightTexture:"righttexture",edgeTexture:"edgetexture",floorTexture:"floortexture",ceilingTexture:"ceilingtexture",roofTexture:"rooftexture",isOpen:"isopen",openDirIndex:"diridx",isWindow:"iswindow",wallType:"type",uvmultiple:"uvmultiple",belongRoom:"_temp_belongroom"},La=function(){function e(){to(this,e),this.sceneJson=null,this.scale=1,this.curFloorPlan=null,this.enableCombine=!0,this.defaultWallEdgeTextureUri="Textures/WallEdge.jpg",this.defaultWallTextureUri="Textures/RoomWall.jpg",this.defaultFloorTextureUri="Textures/FloorDefault.jpg",this.defaultCeilingTextureUri="Textures/CeilingDefault.jpg",this.defaultRoofTextureUri="Textures/RoofDefault.jpg",this.world=null,this.resourceManager=new Vo,this.combineManager=new Ta(this.resourceManager),this.combineParser=new ma(this),this.pluginManager=new ao(this),uo.enableBuildMesh=!1}return e.prototype.disposeModels=function(){this.resourceManager.disposeModels()},e.prototype.disposeTextures=function(){this.resourceManager.disposeTextures()},e.prototype._nestingLoopYield=function(t,r,i){var n=this,e=t.next();if(e.done)return r&&r(),e.value;var o=e.value;e.done;o instanceof Promise?o.then(function(e){return n._nestingLoopYield(t,r,i)}).catch(function(e){i(e)}):this._nestingLoopYield(t,r,i)},e.prototype.delayLoad=function(e){var r=this;return e?(e.url&&(this.sceneURL=e.url,this.resourceManager.localCustomModelBaseUrl=this.getParentRelativeUrl(this.sceneURL)),e.json&&(this.sceneJson=e.json),e.customModeBaseUrl&&(this.resourceManager.localCustomModelBaseUrl=e.customModeBaseUrl),new Promise(function(e,t){r.resourceManager.initLightMaps(function(){r.loadSceneJson().then(function(){r.parseSceneJson().then(function(){return r.world.build(),r.pluginManager.initPlugins(),new Promise(function(e,t){uo.enableCombine&&(r.combineParser.parseWorld(r.world),r.combineParser.buildWorld(r.world)),e(r.world)})})}).then(function(){e(r.world)}).catch(function(e){console.error(e)})})})):(console.error("load param can not be null"),null)},e.prototype.loadFont=function(r){return new Promise(function(e,t){(new THREE.FontLoader).load("./models/Font/Microsoft YaHei_Regular.json",function(e){Aa.font=e,r()})})},e.prototype.loadResources=function(){var r=this;return new Promise(function(e,t){r.resourceManager.downloadResourcesWithQueue(function(){e(r.world)})})},e.prototype.getParentRelativeUrl=function(e){for(var t=e.split("/"),r="",i=0;i<t.length-1;i++){r+=t[i]+"/"}return r},e.prototype.load=function(e){var r=this;this.delayLoad(e).then(function(e,t){return r.loadResources()})},e.prototype.loadSceneJson=function(){var i=this;return new Promise(function(t,r){if(i.sceneJson)t(i.sceneJson);else if(i.sceneURL){(new THREE.FileLoader).load(i.sceneURL,function(e){i.sceneJson=JSON.parse(e),t()},function(){},function(e){r("can not load "+i.sceneURL)})}else r("load scene json error")})},e.prototype.createTextureLoaderPromise=function(r){return new Promise(function(t,e){(new THREE.TextureLoader).load(r,function(e){e.wrapS=THREE.RepeatWrapping,e.wrapT=THREE.RepeatWrapping,t(e)},function(e){console.log(r+" "+e.loaded/e.total*100+"% loaded")},function(e){t(null),console.log(r+"load error")})})},e.prototype.parseSceneJson=function(){var r=this;return new Promise(function(e,t){r.resourceManager.delayDownload=!0,r.resourceManager.loadTextures(r.sceneJson.textures),r.resourceManager.loadModels(r.sceneJson.models),r.parseWorld(r.sceneJson),e()})},e.prototype.parseWorld=function(e){var t=new Lo;if(this.world=t,this.parseBaseObject(e,t),e.buildings)for(var r=e.buildings,i=0;i<r.length;i++){var n=r[i],o=this.parseBuilding(n);t.buildings.push(o)}if(e.outdoors){var a=new jo;this.parseFloorPlan(e.outdoors,a),t.outdoors=a}},e.prototype.parseBuilding=function(e,t){var r=e,i=new Oo;this.parseBaseObject(e,i,t);var n=r[Ca.plans];if(n)for(var o=0;o<n.length;o++){var a=n[o],s=new To;this.parseFloorPlan(a,s,i),i.floorplans.push(s)}var l=r.facades;if(l)for(var c=0;c<l.length;c++){var u=l[c];this.parseFacade(u,i)}var h=r.facadegroups;if(h)for(c=0;c<h.length;c++){var p=h[c];this.parseFacadeGroup(p,i)}return i},e.prototype.parseFloorPlan=function(e,t,r){if(this.parseBaseObject(e,t,r),e[Ca.height]&&(t.height=e[Ca.height]),e[Ca.corners])for(var i=e[Ca.corners],n=0;n<i.length;n++){var o=i[n],a=o[0],s=o[1],l=-o[2];t.existsCorner(a,s,l)?console.error("repeat corner"):t.addCorner(a,s,l)}if(e[Ca.walls]){var c=e[Ca.walls];for(n=0;n<c.length;n++){var u=c[n];this.parseWall(u,t)}}if(e[Ca.rooms]){var h=e[Ca.rooms];for(n=0;n<h.length;n++){var p=h[n];this.parseRoom(p,t)}}if(e[Ca.placements]){var d=e[Ca.placements];for(n=0;n<d.length;n++){var f=d[n];this.parsePlacement(f,t)}}if(e[Ca.videoprobes])for(d=e[Ca.videoprobes],n=0;n<d.length;n++){f=d[n];this.parsePlacement(f,t)}if(e[Ca.groups]){var m=e[Ca.groups];for(n=0;n<m.length;n++){var g=m[n];this.parseGroup(g,t)}}if(e[Ca.doorOrWindows]){var v=e[Ca.doorOrWindows];for(n=0;n<v.length;n++){var y=v[n];this.parseDoorOrWindow(y,t)}}if(e[Ca.curveLines]){var b=e[Ca.curveLines];for(n=0;n<b.length;n++){var x=b[n];this.parseCurveLine(x,t)}}if(e[Ca.pipeLines])for(b=e[Ca.pipeLines],n=0;n<b.length;n++){x=b[n];this.parsePipeLine(x,t)}return t},e.prototype.parseText3D=function(e,t){var r=new Aa;if(this.parseBaseObject(e,r,t),e.color){var i=e.color;r.color=new THREE.Color(i[0],i[1],i[2]),4===i.length&&(r.opacity=i[3])}void 0!==e.font&&(r.font=e.font),void 0!==e.text&&(r.text=e.text),t.text3Ds.push(r)},e.prototype.parsePipeLine=function(e,t){var r=new Ra;if(this.parseBaseObject(e,r,t),void 0!==e[Ca.texture]&&(r.resource=this.resourceManager.textures[e[Ca.texture]]),e.color){var i=e.color;r.color=new THREE.Color(i[0],i[1],i[2]),4===i.length&&(r.opacity=i[3])}e.sectionType&&(r.sectionType=e.sectionType),void 0!==e.rendermode&&(r.renderMode=e.rendermode),void 0!==e.radius&&(r.radius=e.radius),t.pipelines.push(r);for(var n=e.path,o=0;o<n.length;o++){var a=n[o],s=a[0],l=a[1],c=-a[2],u=new THREE.Vector3(s,l,c);r.points.push(u)}},e.prototype.parseCurveLine=function(e,t){var r=new Sa;if(this.parseBaseObject(e,r,t),void 0!==e[Ca.texture]&&(r.resource=this.resourceManager.textures[e[Ca.texture]]),e.color){var i=e.color;r.color=new THREE.Color(i[0],i[1],i[2]),4===i.length&&(r.opacity=i[3])}void 0!==e.width&&(r.width=e.width),t.curvelines.push(r);for(var n=e.path,o=0;o<n.length;o++){var a=n[o],s=a[0],l=a[1],c=-a[2],u=new THREE.Vector3(s,l,c);r.points.push(u)}},e.prototype.parseDoorOrWindow=function(e,t){var r=new So;if(this.parseBaseObject(e,r,t.parent),r.resource=this.resourceManager.models[e[Ca.model]],t.doorOrWindows.push(r),e[Ca.suspendPercent]&&(r.suspendPercent=e[Ca.suspendPercent]),e[Ca.isOpen]&&(r.isOpen=e[Ca.isOpen]),e[Ca.openDirIndex]&&(r.openDirIndex=e[Ca.openDirIndex]),e[Ca.isWindow]){var i=e[Ca.isWindow];"string"==typeof i&&(i="false"!==i.toLocaleString()),r.isWindow=i}r.attachWall=t},e.prototype.parseFacade=function(e,t){var r=new Ma;if(this.parseBaseObject(e,r,t),r.resource=this.resourceManager.models[e[Ca.model]],void 0!==e.texture&&null!==e.texture&&(r.customTextureResource=this.resourceManager.textures[e.texture]),e.color){var i=e.color;r.customColor=new THREE.Color(i[0],i[1],i[2]),4===i.length&&(r.opacity=i[3])}e.rendermode&&(r.renderMode=e.rendermode),t.facades.push(r)},e.prototype.parseFacadeGroup=function(e,t){var r=new Pa;if(this.parseBaseObject(e,r,t),t instanceof Oo?t.facadeGroups.push(r):t.groups.push(r),e[Ca.placements])for(var i=e[Ca.placements],n=0;n<i.length;n++){var o=i[n];this.parseFacadeGroupChild(o,r)}if(e[Ca.groups]){var a=e[Ca.groups];for(n=0;n<a.length;n++){var s=a[n];this.parseFacadeGroup(s,r)}}},e.prototype.parseFacadeGroupChild=function(e,t){var r=new Ma;if(this.parseBaseObject(e,r,t),r.resource=this.resourceManager.models[e[Ca.model]],void 0!==e.texture&&null!==e.texture&&(r.customTextureResource=this.resourceManager.textures[e.texture]),e.color){var i=e.color;r.customColor=new THREE.Color(i[0],i[1],i[2]),4===i.length&&(r.opacity=i[3])}e.rendermode&&(r.renderMode=e.rendermode),t.placements.push(r)},e.prototype.parsePlacement=function(e,t){var r=new Mo;if(this.parseBaseObject(e,r,t),r.resource=this.resourceManager.models[e[Ca.model]],void 0!==e.texture&&null!==e.texture&&(r.customTextureResource=this.resourceManager.textures[e.texture]),e.color){var i=e.color;r.customColor=new THREE.Color(i[0],i[1],i[2]),4===i.length&&(r.opacity=i[3])}e.rendermode&&(r.renderMode=e.rendermode),e.animinfo&&(r.isPlayAnim=e.animinfo.isplay,r.animClip=e.animinfo.clip),e[Ca.belongRoom]&&(r.belongRoomUserID=e[Ca.belongRoom]),t.placements.push(r)},e.prototype.parseGroup=function(e,t){var r=new Zo;if(this.parseBaseObject(e,r,t),t.groups.push(r),e[Ca.placements])for(var i=e[Ca.placements],n=0;n<i.length;n++){var o=i[n];this.parsePlacement(o,r)}if(e[Ca.groups]){var a=e[Ca.groups];for(n=0;n<a.length;n++){var s=a[n];this.parseGroup(s,r)}}e[Ca.belongRoom]&&(r.belongRoomUserID=e[Ca.belongRoom])},e.prototype.parseWall=function(e,t){var r=null;0===e[Ca.wallType]?(r=new bo).lightMapResource=co.wallLightMapResource:r=new Jo,this.parseBaseObject(e,r,t);var i=e[Ca.corners];if(r.startCorner=t.corners[i[0]],r.endCorner=t.corners[i[1]],void 0!==e[Ca.leftTexture]&&(r.leftResource=this.resourceManager.textures[e[Ca.leftTexture]]),void 0!==e[Ca.rightTexture]&&(r.rightResource=this.resourceManager.textures[e[Ca.rightTexture]]),void 0!==e[Ca.edgeTexture]&&(r.edgeResource=this.resourceManager.textures[e[Ca.edgeTexture]]),void 0!==e[Ca.uvmultiple]&&(r.uvMultiple=e[Ca.uvmultiple]),void 0!==e[Ca.model]&&(r.resource=this.resourceManager.models[e[Ca.model]]),void 0!==e.isshow&&(r.isShow=e.isshow),e[Ca.doorOrWindows])for(var n=e[Ca.doorOrWindows],o=0;o<n.length;o++){var a=n[o];this.parseDoorOrWindow(a,r,t)}void 0!==e.height&&(r.height=e.height),void 0!==e.thick&&(r.thick=e.thick),r.startCorner.addWall(r),r.endCorner.addWall(r),t.addWall(r)},e.prototype.parseRoom=function(e,t){var r=new wo;this.parseBaseObject(e,r,t);var i=e[Ca.corners];if(i&&this.parseRoomCornerIndexs(r,i),0===r.points.length&&this.parseRoomPoints(r,e.points),0!==r.points.length){var n=e[Ca.holesCorners];n&&this.parseRoomHoleIndexs(r,n),this.parseRoomBlockSize(r,e),this.parseRoomTextureInfo(r,e),this.parseRoomHeight(r,e),this.parseRoomVisible(r,e),this.parseCombineData(r),this.setOutdoorFloorHeight(r,t),t.rooms.push(r)}else console.error("room points is null")},e.prototype.parseRoomCornerIndexs=function(e,t){for(var r=[],i=e.parent,n=0;n<t.length;n++){var o=t[n],a=i.corners[o].position.clone();r.push(a)}e.points=r},e.prototype.parseRoomPoints=function(e,t){if(t){for(var r=t.length,i=[],n=0;n<r;n++){var o=t[n],a=o[0],s=o[1],l=-o[2],c=new THREE.Vector3(a,s,l);i.push(c)}e.points=i}},e.prototype.parseRoomHoleIndexs=function(e,t){for(var r=[],i=e.parent,n=(e.position,0);n<t.length;n++){for(var o=t[n],a=[],s=0;s<o.length;s++){var l=o[s];a.push(i.corners[l].position.clone())}r.push(a)}e.holes=r},e.prototype.parseRoomTextureInfo=function(e,t){void 0!==t[Ca.floorTexture]&&(e.floorResource=this.resourceManager.textures[t[Ca.floorTexture]]),void 0!==t[Ca.ceilingTexture]&&(e.ceilingResource=this.resourceManager.textures[t[Ca.ceilingTexture]]),void 0!==t[Ca.roofTexture]&&(e.roofResource=this.resourceManager.textures[t[Ca.roofTexture]])},e.prototype.parseRoomHeight=function(e,t){void 0!==t.ceilingheight&&(e.ceiling.height=t.ceilingheight),void 0!==t.roofheight&&(e.roof.height=t.roofheight),void 0!==t.floorheight&&(e.floor.height=t.floorheight)},e.prototype.parseRoomVisible=function(e,t){void 0!==t.isshowfloor&&(e.floor.isShow=t.isshowfloor),void 0!==t.isshowceiling&&(e.ceiling.isShow=t.isshowceiling),void 0!==t.isshowroof&&(e.roof.isShow=t.isshowroof)},e.prototype.parseRoomBlockSize=function(e,t){if(t.floorblocksize){var r=t.floorblocksize;e.floor.blockSize=new THREE.Vector2(r[0],r[1])}if(t.ceilingblocksize){r=t.ceilingblocksize;e.ceiling.blockSize=new THREE.Vector2(r[0],r[1])}if(t.roofblocksize){r=t.roofblocksize;e.roof.blockSize=new THREE.Vector2(r[0],r[1])}},e.prototype.parseCombineData=function(e){if(!this.isCombine(e)){var t=this.calRoomPosition(e);e.position=t,this.subRoomHolesPointsByPosition(e,t),this.subRoomPointsByPosition(e,t)}},e.prototype.setOutdoorFloorHeight=function(e,t){t instanceof jo&&!e.floor.height&&(e.floor.height=0,e.floor.DefaultHeight=0)},e.prototype.isCombine=function(e){return!(e.properties||e.userID||e.name||e.floor.height)},e.prototype.calRoomPosition=function(e){for(var t=e.points,r=new THREE.Vector3,i=0;i<t.length;i++){var n=t[i];r.add(n)}return r.divideScalar(t.length),r},e.prototype.subRoomPointsByPosition=function(e,t){for(var r=e.points,i=0;i<r.length;i++){r[i].sub(t)}},e.prototype.subRoomHolesPointsByPosition=function(e,t){for(var r=e.holes,i=0;i<r.length;i++)for(var n=r[i],o=0;o<n.length;o++){n[o].sub(t)}},e.prototype.parseBaseObject=function(e,t,r){var i,n,o;if(t.parent=r,e[Ca.id]&&(i=e[Ca.id],t.id=i),e[Ca.userID]&&(o=e[Ca.userID],t.userID=o),e[Ca.name]&&(n=e[Ca.name],t.name=n),(t.jsonData=e)[Ca.position]){var a=e[Ca.position];t.position.set(a[0],a[1],-a[2])}if(e[Ca.scale]){var s=e[Ca.scale],l=t.scale;0===s[0]&&(s[0]=.01),0===s[1]&&(s[1]=.01),0===s[2]&&(s[2]=.01),l.set(s[0],s[1],s[2])}if(e[Ca.rotation]){var c=e[Ca.rotation];t.rotation.set(c[0],c[1],-c[2],-c[3])}e[Ca.properties]&&(t.properties=e[Ca.properties]),void 0!==e.isshow&&null!==e.isshow&&(t.isShow=e.isshow)},e.prototype.createRooms=function(){for(var e=[],t=0;t<this.curFloorPlan.rooms.length;t++){var r=this.curFloorPlan.rooms[t];e.push(r.meshGroup)}return e},e.prototype.createWalls=function(){for(var e=[],t=0;t<this.world.buildings.length;t++)for(var r=this.world.buildings[t],i=0;i<r.floorplans.length;i++)for(var n=r.floorplans[i],o=0;o<n.walls.length;o++){var a=n.walls[o];e.push(a.wallGroup)}return e},e.prototype.createWallMesh=function(e){var t=new THREE.BufferGeometry;t.addAttribute("position",new THREE.BufferAttribute(e.positionArray,3)),t.addAttribute("normal",new THREE.BufferAttribute(e.normalArray,3)),t.addAttribute("uv",new THREE.BufferAttribute(e.uvArray,2));var r=e.material;return new THREE.Mesh(t,r)},ro(e,[{key:"downloadResourceProgress",get:function(){return this.resourceManager.downloadResProgess}}]),e}(),Oa={id:"id",name:"name",userID:"userid",position:"position",rotation:"rotation",scale:"scale",properties:"properties",plans:"plans",walls:"walls",placements:"placements",videoprobes:"videoprobes",groups:"groups",corners:"corners",doorOrWindows:"doororwindows",curveLines:"curvelines",pipeLines:"pipelines",text3Ds:"text3ds",rooms:"rooms",height:"height",thick:"thick",texture:"texture",type:"type",model:"model",suspendPercent:"suspendpercent",leftTexture:"lefttexture",rightTexture:"righttexture",edgeTexture:"edgetexture",floorTexture:"floortexture",ceilingTexture:"ceilingtexture",roofTexture:"rooftexture",isOpen:"isopen",openDirIndex:"diridx",wallType:"type"},Ha=function(){function e(){to(this,e),this.sceneJson=null,this.scale=1,this.curFloorPlan=null,this.enableCombine=!0,this.defaultWallEdgeTextureUri="Textures/WallEdge.jpg",this.defaultWallTextureUri="Textures/RoomWall.jpg",this.defaultFloorTextureUri="Textures/FloorDefault.jpg",this.defaultCeilingTextureUri="Textures/CeilingDefault.jpg",this.defaultRoofTextureUri="Textures/RoofDefault.jpg",this.world=null,this.resourceManager=new Vo,this.combineManager=new Ta(this.resourceManager),this.combineParser=new ma(this),uo.enableBuildMesh=!1}return e.prototype.disposeModels=function(){this.resourceManager.disposeModels()},e.prototype.disposeTextures=function(){this.resourceManager.disposeTextures()},e.prototype._nestingLoopYield=function(t,r,i){var n=this,e=t.next();if(e.done)return r&&r(),e.value;var o=e.value;e.done;o instanceof Promise?o.then(function(e){return n._nestingLoopYield(t,r,i)}).catch(function(e){i(e)}):this._nestingLoopYield(t,r,i)},e.prototype.delayLoad=function(e){var r=this;return e?(e.url&&(this.sceneURL=e.url,this.resourceManager.localCustomModelBaseUrl=this.getParentRelativeUrl(this.sceneURL)),e.json&&(this.sceneJson=e.json),e.customModeBaseUrl&&(this.resourceManager.localCustomModelBaseUrl=e.customModeBaseUrl),new Promise(function(e,t){r.resourceManager.initLightMaps(function(){r.loadSceneJson().then(function(){r.parseSceneJson().then(function(){return r.world.build(),new Promise(function(e,t){r.combineParser.parseWorld(r.world),r.combineParser.buildWorld(r.world),e(r.world)})})}).then(function(){e(r.world)}).catch(function(e){console.error(e)})})})):(console.error("load param can not be null"),null)},e.prototype.loadFont=function(r){return new Promise(function(e,t){(new THREE.FontLoader).load("./models/Font/Microsoft YaHei_Regular.json",function(e){Aa.font=e,r()})})},e.prototype.loadResources=function(){var r=this;return new Promise(function(e,t){r.resourceManager.downloadResourcesWithQueue(function(){e(r.world)})})},e.prototype.getParentRelativeUrl=function(e){for(var t=e.split("/"),r="",i=0;i<t.length-1;i++){r+=t[i]+"/"}return r},e.prototype.load=function(e){var r=this;return e?(e.url&&(this.sceneURL=e.url,this.resourceManager.localCustomModelBaseUrl=this.getParentRelativeUrl(this.sceneURL)),e.json&&(this.sceneJson=e.json),new Promise(function(e,t){r.loadSceneJson().then(function(){r.parseSceneJson().then(function(){e(r.world)})}).then(function(){e(r.world)}).catch(function(e){console.error(e)})})):(console.error("load param can not be null"),null)},e.prototype.loadSceneJson=function(){var i=this;return new Promise(function(t,r){if(i.sceneJson)t(i.sceneJson);else if(i.sceneURL){(new THREE.FileLoader).load(i.sceneURL,function(e){i.sceneJson=JSON.parse(e),t()},function(){},function(e){r("can not load "+i.sceneURL)})}else r("load scene json error")})},e.prototype.createTextureLoaderPromise=function(r){return new Promise(function(t,e){(new THREE.TextureLoader).load(r,function(e){e.wrapS=THREE.RepeatWrapping,e.wrapT=THREE.RepeatWrapping,t(e)},function(e){console.log(r+" "+e.loaded/e.total*100+"% loaded")},function(e){t(null),console.log(r+"load error")})})},e.prototype.parseSceneJson=function(){var r=this;return new Promise(function(e,t){r.resourceManager.delayDownload=!0,r.resourceManager.loadTextures(r.sceneJson.textures),r.resourceManager.loadModels(r.sceneJson.models),r.parseWorld(r.sceneJson),e()})},e.prototype.parseWorld=function(e){var t=new Lo;if(this.world=t,this.parseBaseObject(e,t),e.buildings)for(var r=e.buildings,i=0;i<r.length;i++){var n=r[i],o=this.parseBuilding(n);t.buildings.push(o)}if(e.outdoors){var a=new jo;this.parseFloorPlan(e.outdoors,a),t.outdoors=a}},e.prototype.parseBuilding=function(e,t){var r=e,i=new Oo;this.parseBaseObject(e,i,t);var n=r[Oa.plans];if(n)for(var o=0;o<n.length;o++){var a=n[o],s=new To;this.parseFloorPlan(a,s,i),i.floorplans.push(s)}var l=r.facades;if(l)for(var c=0;c<l.length;c++){var u=l[c];this.parseFacade(u,i)}var h=r.facadegroups;if(h)for(c=0;c<h.length;c++){var p=h[c];this.parseFacadeGroup(p,i)}return i},e.prototype.parseFloorPlan=function(e,t,r){if(this.parseBaseObject(e,t,r),e[Oa.height]&&(t.height=e[Oa.height]),e[Oa.corners])for(var i=e[Oa.corners],n=0;n<i.length;n++){var o=i[n],a=o[0],s=o[1],l=-o[2];t.existsCorner(a,s,l)?console.error("repeat corner"):t.addCorner(a,s,l)}if(e[Oa.walls]){var c=e[Oa.walls];for(n=0;n<c.length;n++){var u=c[n];this.parseWall(u,t)}}if(e[Oa.rooms]){var h=e[Oa.rooms];for(n=0;n<h.length;n++){var p=h[n];this.parseRoom(p,t)}}if(e[Oa.placements]){var d=e[Oa.placements];for(n=0;n<d.length;n++){var f=d[n];this.parsePlacement(f,t)}}if(e[Oa.videoprobes])for(d=e[Oa.videoprobes],n=0;n<d.length;n++){f=d[n];this.parsePlacement(f,t)}if(e[Oa.groups]){var m=e[Oa.groups];for(n=0;n<m.length;n++){var g=m[n];this.parseGroup(g,t)}}if(e[Oa.doorOrWindows]){var v=e[Oa.doorOrWindows];for(n=0;n<v.length;n++){var y=v[n];this.parseDoorOrWindow(y,t)}}if(e[Oa.curveLines]){var b=e[Oa.curveLines];for(n=0;n<b.length;n++){var x=b[n];this.parseCurveLine(x,t)}}if(e[Oa.pipeLines])for(b=e[Oa.pipeLines],n=0;n<b.length;n++){x=b[n];this.parsePipeLine(x,t)}if(e[Oa.text3Ds]){var E=e[Oa.text3Ds];for(n=0;n<E.length;n++){x=E[n];this.parseText3D(x,t)}}return t},e.prototype.parseText3D=function(e,t){var r=new Aa;if(this.parseBaseObject(e,r,t),e.color){var i=e.color;r.color=new THREE.Color(i[0],i[1],i[2]),4===i.length&&(r.opacity=i[3])}void 0!==e.font&&(r.font=e.font),void 0!==e.text&&(r.text=e.text),t.text3Ds.push(r)},e.prototype.parsePipeLine=function(e,t){var r=new Ra;if(this.parseBaseObject(e,r,t),void 0!==e[Oa.texture]&&(r.resource=this.resourceManager.textures[e[Oa.texture]]),e.color){var i=e.color;r.color=new THREE.Color(i[0],i[1],i[2]),4===i.length&&(r.opacity=i[3])}e.sectionType&&(r.sectionType=e.sectionType),void 0!==e.rendermode&&(r.renderMode=e.rendermode),void 0!==e.radius&&(r.radius=e.radius),t.pipelines.push(r);for(var n=e.path,o=0;o<n.length;o++){var a=n[o],s=a[0],l=a[1],c=-a[2],u=new THREE.Vector3(s,l,c);r.points.push(u)}},e.prototype.parseCurveLine=function(e,t){var r=new Sa;if(this.parseBaseObject(e,r,t),void 0!==e[Oa.texture]&&(r.resource=this.resourceManager.textures[e[Oa.texture]]),e.color){var i=e.color;r.color=new THREE.Color(i[0],i[1],i[2]),4===i.length&&(r.opacity=i[3])}void 0!==e.width&&(r.width=e.width),t.curvelines.push(r);for(var n=e.path,o=0;o<n.length;o++){var a=n[o],s=a[0],l=a[1],c=-a[2],u=new THREE.Vector3(s,l,c);r.points.push(u)}},e.prototype.parseDoorOrWindow=function(e,t){var r=new So;this.parseBaseObject(e,r,t.parent),r.resource=this.resourceManager.models[e[Oa.model]],t.doorOrWindows.push(r),e[Oa.suspendPercent]&&(r.suspendPercent=e[Oa.suspendPercent]),e[Oa.isOpen]&&(r.isOpen=e[Oa.isOpen]),e[Oa.openDirIndex]&&(r.openDirIndex=e[Oa.openDirIndex]),r.attachWall=t},e.prototype.parseFacade=function(e,t){var r=new Ma;if(this.parseBaseObject(e,r,t),r.resource=this.resourceManager.models[e[Oa.model]],void 0!==e.texture&&null!==e.texture&&(r.customTextureResource=this.resourceManager.textures[e.texture]),e.color){var i=e.color;r.customColor=new THREE.Color(i[0],i[1],i[2]),4===i.length&&(r.opacity=i[3])}e.rendermode&&(r.renderMode=e.rendermode),t.facades.push(r)},e.prototype.parseFacadeGroup=function(e,t){var r=new Pa;if(this.parseBaseObject(e,r,t),t instanceof Oo?t.facadeGroups.push(r):t.groups.push(r),e[Oa.placements])for(var i=e[Oa.placements],n=0;n<i.length;n++){var o=i[n];this.parseFacadeGroupChild(o,r)}if(e[Oa.groups]){var a=e[Oa.groups];for(n=0;n<a.length;n++){var s=a[n];this.parseFacadeGroup(s,r)}}},e.prototype.parseFacadeGroupChild=function(e,t){var r=new Ma;if(this.parseBaseObject(e,r,t),r.resource=this.resourceManager.models[e[Oa.model]],void 0!==e.texture&&null!==e.texture&&(r.customTextureResource=this.resourceManager.textures[e.texture]),e.color){var i=e.color;r.customColor=new THREE.Color(i[0],i[1],i[2]),4===i.length&&(r.opacity=i[3])}e.rendermode&&(r.renderMode=e.rendermode),t.placements.push(r)},e.prototype.parsePlacement=function(e,t){var r=new Mo;if(this.parseBaseObject(e,r,t),r.resource=this.resourceManager.models[e[Oa.model]],void 0!==e.texture&&null!==e.texture&&(r.customTextureResource=this.resourceManager.textures[e.texture]),e.color){var i=e.color;r.customColor=new THREE.Color(i[0],i[1],i[2]),4===i.length&&(r.opacity=i[3])}e.rendermode&&(r.renderMode=e.rendermode),e.animinfo&&(r.isPlayAnim=e.animinfo.isplay,r.animClip=e.animinfo.clip),t.placements.push(r)},e.prototype.parseGroup=function(e,t){var r=new Zo;if(this.parseBaseObject(e,r,t),t.groups.push(r),e[Oa.placements])for(var i=e[Oa.placements],n=0;n<i.length;n++){var o=i[n];this.parsePlacement(o,r)}if(e[Oa.groups]){var a=e[Oa.groups];for(n=0;n<a.length;n++){var s=a[n];this.parseGroup(s,r)}}},e.prototype.parseWall=function(e,t){var r=null;0===e[Oa.wallType]?(r=new bo).lightMapResource=co.wallLightMapResource:r=new Jo,this.parseBaseObject(e,r,t);var i=e[Oa.corners];if(r.startCorner=t.corners[i[0]],r.endCorner=t.corners[i[1]],void 0!==e[Oa.leftTexture]&&(r.rightResource=this.resourceManager.textures[e[Oa.leftTexture]]),void 0!==e[Oa.rightTexture]&&(r.leftResource=this.resourceManager.textures[e[Oa.rightTexture]]),void 0!==e[Oa.edgeTexture]&&(r.edgeResource=this.resourceManager.textures[e[Oa.edgeTexture]]),void 0!==e[Oa.model]&&(r.resource=this.resourceManager.models[e[Oa.model]]),void 0!==e.isshow&&(r.isShow=e.isshow),e[Oa.doorOrWindows])for(var n=e[Oa.doorOrWindows],o=0;o<n.length;o++){var a=n[o];this.parseDoorOrWindow(a,r,t)}e.height&&(r.height=e.height),r.startCorner.addWall(r),r.endCorner.addWall(r),t.addWall(r)},e.prototype.parseRoom=function(e,t){var r=new wo;this.parseBaseObject(e,r,t);var i=e[Oa.corners],n=[];if(i)for(var o=0;o<i.length;o++){var a=i[o];n.push(t.corners[a].position)}if(0===n.length){var s=e.points;if(!s)return;for(o=0;o<s.length;o++){var l=s[o],c=l[0],u=l[1],h=-l[2],p=new THREE.Vector3(c,u,h);n.push(p)}}if(0!==n.length){if(void 0!==e[Oa.floorTexture]&&(r.floorResource=this.resourceManager.textures[e[Oa.floorTexture]]),void 0!==e[Oa.ceilingTexture]&&(r.ceilingResource=this.resourceManager.textures[e[Oa.ceilingTexture]]),void 0!==e[Oa.roofTexture]&&(r.roofResource=this.resourceManager.textures[e[Oa.roofTexture]]),void 0!==e.isshowfloor&&(r.floor.isShow=e.isshowfloor),void 0!==e.isshowceiling&&(r.ceiling.isShow=e.isshowceiling),void 0!==e.isshowroof&&(r.roof.isShow=e.isshowroof),void 0!==e.ceilingheight&&(r.ceiling.height=e.ceilingheight),void 0!==e.roofheight&&(r.roof.height=e.roofheight),void 0!==e.floorheight&&(r.floor.height=e.floorheight),e.floorblocksize){var d=e.floorblocksize;r.floor.blockSize=new THREE.Vector2(d[0],d[1])}if(e.ceilingblocksize){d=e.ceilingblocksize;r.ceiling.blockSize=new THREE.Vector2(d[0],d[1])}if(e.roofblocksize){d=e.roofblocksize;r.roof.blockSize=new THREE.Vector2(d[0],d[1])}r.points=n,(r.properties||r.userID||r.name)&&t.rooms.push(r)}else console.error("room points is null")},e.prototype.parseBaseObject=function(e,t,r){var i,n,o;if(t.parent=r,e[Oa.id]&&(i=e[Oa.id],t.id=i),e[Oa.userID]&&(o=e[Oa.userID],t.userID=o),e[Oa.name]&&(n=e[Oa.name],t.name=n),(t.jsonData=e)[Oa.position]){var a=e[Oa.position];t.position.set(a[0],a[1],-a[2])}if(e[Oa.scale]){var s=e[Oa.scale],l=t.scale;0===s[0]&&(s[0]=.01),0===s[1]&&(s[1]=.01),0===s[2]&&(s[2]=.01),l.set(s[0],s[1],s[2])}if(e[Oa.rotation]){var c=e[Oa.rotation];t.rotation.set(c[0],c[1],-c[2],-c[3])}e[Oa.properties]&&(t.properties=e[Oa.properties]),void 0!==e.isshow&&null!==e.isshow&&(t.isShow=e.isshow)},e.prototype.createRooms=function(){for(var e=[],t=0;t<this.curFloorPlan.rooms.length;t++){var r=this.curFloorPlan.rooms[t];e.push(r.meshGroup)}return e},e.prototype.createWalls=function(){for(var e=[],t=0;t<this.world.buildings.length;t++)for(var r=this.world.buildings[t],i=0;i<r.floorplans.length;i++)for(var n=r.floorplans[i],o=0;o<n.walls.length;o++){var a=n.walls[o];e.push(a.wallGroup)}return e},e.prototype.createWallMesh=function(e){var t=new THREE.BufferGeometry;t.addAttribute("position",new THREE.BufferAttribute(e.positionArray,3)),t.addAttribute("normal",new THREE.BufferAttribute(e.normalArray,3)),t.addAttribute("uv",new THREE.BufferAttribute(e.uvArray,2));var r=e.material;return new THREE.Mesh(t,r)},ro(e,[{key:"downloadResourceProgress",get:function(){return this.resourceManager.downloadResProgess}}]),e}(),Fa={id:"id",name:"name",position:"position",rotation:"rotation",scale:"scale",properties:"properties",plans:"plans",walls:"walls",placements:"placements",videoprobes:"videoprobes",groups:"groups",corners:"corners",doorOrWindows:"doororwindows",curveLines:"curvelines",pipeLines:"pipelines",rooms:"rooms",height:"height",thick:"thick",texture:"texture",type:"type",model:"model",suspendPercent:"suspendpercent",leftTexture:"lefttexture",rightTexture:"righttexture",edgeTexture:"edgetexture",floorTexture:"floortexture",ceilingTexture:"ceilingtexture",roofTexture:"rooftexture",isOpen:"isopen",wallType:"type"},ka=function(){function e(){to(this,e),this.sceneJson=null,this.scale=1,this.curFloorPlan=null,this.enableCombine=!0,this.defaultWallEdgeTextureUri="Textures/WallEdge.jpg",this.defaultWallTextureUri="Textures/RoomWall.jpg",this.defaultFloorTextureUri="Textures/FloorDefault.jpg",this.defaultCeilingTextureUri="Textures/CeilingDefault.jpg",this.defaultRoofTextureUri="Textures/RoofDefault.jpg",this.world=null,this.resourceManager=new Vo,this.combineManager=new Ta(this.resourceManager),this.combineParser=new ma(this),uo.enableBuildMesh=!1}return e.prototype._nestingLoopYield=function(t,r,i){var n=this,e=t.next();if(e.done)return r&&r(),e.value;var o=e.value;e.done;o instanceof Promise?o.then(function(e){return n._nestingLoopYield(t,r,i)}).catch(function(e){i(e)}):this._nestingLoopYield(t,r,i)},e.prototype.delayLoad=function(e){var r=this;return e?(e.url&&(this.sceneURL=e.url),e.json&&(this.sceneJson=e.json),new Promise(function(e,t){r.loadSceneJson().then(function(){r.parseSceneJson().then(function(){return r.world.build(),new Promise(function(e,t){r.combineParser.parseWorld(r.world),r.combineParser.buildWorld(r.world),console.log("finish combine parser"),e(r.world)})})}).then(function(){e(r.world)}).catch(function(e){console.error(e)})})):(console.error("load param can not be null"),null)},e.prototype.loadResources=function(){var r=this;return new Promise(function(e,t){r.resourceManager.downloadResourcesWithQueue(function(){console.log("finish downloadResources"),e(r.world)})})},e.prototype.load=function(e){var r=this;return e?(e.url&&(this.sceneURL=e.url),e.json&&(this.sceneJson=e.json),new Promise(function(e,t){r.loadSceneJson().then(function(){r.parseSceneJson().then(function(){e(r.world)})}).then(function(){e(r.world)}).catch(function(e){console.error(e)})})):(console.error("load param can not be null"),null)},e.prototype.loadSceneJson=function(){var i=this;return new Promise(function(t,r){if(i.sceneJson)t(i.sceneJson);else if(i.sceneURL){(new THREE.FileLoader).load(i.sceneURL,function(e){i.sceneJson=JSON.parse(e),t()},function(){},function(e){r("can not load "+i.sceneURL)})}else r("load scene json error")})},e.prototype.createTextureLoaderPromise=function(r){return new Promise(function(t,e){(new THREE.TextureLoader).load(r,function(e){e.wrapS=THREE.RepeatWrapping,e.wrapT=THREE.RepeatWrapping,t(e)},function(e){console.log(r+" "+e.loaded/e.total*100+"% loaded")},function(e){t(null),console.log(r+"load error")})})},e.prototype.parseSceneJson=function(){var r=this;return new Promise(function(e,t){r.parseWorld(r.sceneJson),e()})},e.prototype.parseWorld=function(e){var t=new Lo;if(this.world=t,this.parseBaseObject(e,t),e.buildings)for(var r=e.buildings,i=0;i<r.length;i++){var n=r[i],o=this.parseBuilding(n);t.buildings.push(o)}if(e.outdoors){var a=new jo;this.parseFloorPlan(e.outdoors,a),t.outdoors=a}},e.prototype.parseBuilding=function(e,t){var r=e,i=new Oo;this.parseBaseObject(e,i,t);var n=r[Fa.plans];if(n)for(var o=0;o<n.length;o++){var a=n[o],s=new To;this.parseFloorPlan(a,s,i),i.floorplans.push(s)}var l=r.facades;if(l)for(var c=0;c<l.length;c++){var u=l[c];this.parseFacade(u,i)}var h=r.facadegroups;if(h)for(c=0;c<h.length;c++){var p=h[c];this.parseFacadeGroup(p,i)}return i},e.prototype.parseFloorPlan=function(e,t,r){if(this.parseBaseObject(e,t,r),e[Fa.height]&&(t.height=e[Fa.height]),e[Fa.corners])for(var i=e[Fa.corners],n=0;n<i.length;n++){var o=i[n],a=o[0],s=o[1],l=-o[2];t.existsCorner(a,s,l)?console.error("repeat corner"):t.addCorner(a,s,l)}if(e[Fa.walls]){var c=e[Fa.walls];for(n=0;n<c.length;n++){var u=c[n];this.parseWall(u,t)}}return t},e.prototype.parsePipeLine=function(e,t){var r=new Ra;if(this.parseBaseObject(e,r,t),void 0!==e[Fa.texture]&&(r.resource=this.resourceManager.textures[e[Fa.texture]]),e.color){var i=e.color;r.color=new THREE.Color(i[0],i[1],i[2]),4===i.length&&(r.opacity=i[3])}e.sectionType&&(r.sectionType=e.sectionType),void 0!==e.rendermode&&(r.renderMode=e.rendermode),void 0!==e.radius&&(r.radius=e.radius),t.pipelines.push(r);for(var n=e.path,o=0;o<n.length;o++){var a=n[o],s=a[0],l=a[1],c=-a[2],u=new THREE.Vector3(s,l,c);r.points.push(u)}},e.prototype.parseCurveLine=function(e,t){var r=new Sa;if(this.parseBaseObject(e,r,t),void 0!==e[Fa.texture]&&(r.resource=this.resourceManager.textures[e[Fa.texture]]),e.color){var i=e.color;r.color=new THREE.Color(i[0],i[1],i[2]),4===i.length&&(r.opacity=i[3])}void 0!==e.width&&(r.width=e.width),t.curvelines.push(r);for(var n=e.path,o=0;o<n.length;o++){var a=n[o],s=a[0],l=a[1],c=-a[2],u=new THREE.Vector3(s,l,c);r.points.push(u)}},e.prototype.parseDoorOrWindow=function(e,t){var r=new So;this.parseBaseObject(e,r,t.parent),r.resource=this.resourceManager.models[e[Fa.model]],t.doorOrWindows.push(r),e[Fa.suspendPercent]&&(r.suspendPercent=e[Fa.suspendPercent]),e[Fa.isOpen]&&(r.isOpen=e[Fa.isOpen]),r.attachWall=t},e.prototype.parseFacade=function(e,t){var r=new Ma;if(this.parseBaseObject(e,r,t),r.resource=this.resourceManager.models[e[Fa.model]],void 0!==e.texture&&null!==e.texture&&(r.customTextureResource=this.resourceManager.textures[e.texture]),e.color){var i=e.color;r.customColor=new THREE.Color(i[0],i[1],i[2]),4===i.length&&(r.opacity=i[3])}e.rendermode&&(r.renderMode=e.rendermode),t.facades.push(r)},e.prototype.parseFacadeGroup=function(e,t){var r=new Pa;if(this.parseBaseObject(e,r,t),t instanceof Oo?t.facadeGroups.push(r):t.groups.push(r),e[Fa.placements])for(var i=e[Fa.placements],n=0;n<i.length;n++){var o=i[n];this.parseFacadeGroupChild(o,r)}if(e[Fa.groups]){var a=e[Fa.groups];for(n=0;n<a.length;n++){var s=a[n];this.parseFacadeGroup(s,r)}}},e.prototype.parseFacadeGroupChild=function(e,t){var r=new Ma;if(this.parseBaseObject(e,r,t),r.resource=this.resourceManager.models[e[Fa.model]],void 0!==e.texture&&null!==e.texture&&(r.customTextureResource=this.resourceManager.textures[e.texture]),e.color){var i=e.color;r.customColor=new THREE.Color(i[0],i[1],i[2]),4===i.length&&(r.opacity=i[3])}e.rendermode&&(r.renderMode=e.rendermode),t.placements.push(r)},e.prototype.parsePlacement=function(e,t){var r=new Mo;if(this.parseBaseObject(e,r,t),r.resource=this.resourceManager.models[e[Fa.model]],void 0!==e.texture&&null!==e.texture&&(r.customTextureResource=this.resourceManager.textures[e.texture]),e.color){var i=e.color;r.customColor=new THREE.Color(i[0],i[1],i[2]),4===i.length&&(r.opacity=i[3])}e.rendermode&&(r.renderMode=e.rendermode),t.placements.push(r)},e.prototype.parseGroup=function(e,t){var r=new Zo;if(this.parseBaseObject(e,r,t),t.groups.push(r),e[Fa.placements])for(var i=e[Fa.placements],n=0;n<i.length;n++){var o=i[n];this.parsePlacement(o,r)}if(e[Fa.groups]){var a=e[Fa.groups];for(n=0;n<a.length;n++){var s=a[n];this.parseGroup(s,r)}}},e.prototype.parseWall=function(e,t){var r=null;r=0===e[Fa.wallType]?new bo:new Jo,this.parseBaseObject(e,r,t);var i=e[Fa.corners];if(r.startCorner=t.corners[i[0]],r.endCorner=t.corners[i[1]],void 0!==e[Fa.leftTexture]&&(r.rightResource=this.resourceManager.textures[e[Fa.leftTexture]]),void 0!==e[Fa.rightTexture]&&(r.leftResource=this.resourceManager.textures[e[Fa.rightTexture]]),void 0!==e[Fa.edgeTexture]&&(r.edgeResource=this.resourceManager.textures[e[Fa.edgeTexture]]),void 0!==e[Fa.model]&&(r.resource=this.resourceManager.models[e[Fa.model]]),void 0!==e.isshow&&(r.isShow=e.isshow),e[Fa.doorOrWindows])for(var n=e[Fa.doorOrWindows],o=0;o<n.length;o++){var a=n[o];this.parseDoorOrWindow(a,r,t)}e.height&&(r.height=e.height),r.startCorner.addWall(r),r.endCorner.addWall(r),t.addWall(r)},e.prototype.parseRoom=function(e,t){var r=new wo;this.parseBaseObject(e,r,t);var i=e[Fa.corners],n=[];if(i)for(var o=0;o<i.length;o++){var a=i[o];n.push(t.corners[a].position)}if(0===n.length){var s=e.points;if(!s)return;for(o=0;o<s.length;o++){var l=s[o],c=l[0],u=l[1],h=-l[2],p=new THREE.Vector3(c,u,h);n.push(p)}}if(0!==n.length){if(void 0!==e[Fa.floorTexture]&&(r.floorResource=this.resourceManager.textures[e[Fa.floorTexture]]),void 0!==e[Fa.ceilingTexture]&&(r.ceilingResource=this.resourceManager.textures[e[Fa.ceilingTexture]]),void 0!==e[Fa.roofTexture]&&(r.roofResource=this.resourceManager.textures[e[Fa.roofTexture]]),void 0!==e.isshowfloor&&(r.floor.isShow=e.isshowfloor),void 0!==e.isshowceiling&&(r.ceiling.isShow=e.isshowceiling),void 0!==e.isshowroof&&(r.roof.isShow=e.isshowroof),void 0!==e.ceilingheight&&(r.ceiling.height=e.ceilingheight),void 0!==e.roofheight&&(r.roof.height=e.roofheight),void 0!==e.floorheight&&(r.floor.height=e.floorheight),e.floorblocksize){var d=e.floorblocksize;r.floor.blockSize=new THREE.Vector2(d[0],d[1])}if(e.ceilingblocksize){d=e.ceilingblocksize;r.ceiling.blockSize=new THREE.Vector2(d[0],d[1])}if(e.roofblocksize){d=e.roofblocksize;r.roof.blockSize=new THREE.Vector2(d[0],d[1])}r.points=n,t.rooms.push(r)}else console.error("room points is null")},e.prototype.parseBaseObject=function(e,t,r){var i,n;if(t.parent=r,e[Fa.id]&&(i=e[Fa.id],t.id=i),e[Fa.name]&&(n=e[Fa.name],t.name=n),(t.jsonData=e)[Fa.position]){var o=e[Fa.position];t.position.set(o[0],o[1],-o[2])}if(e[Fa.scale]){var a=e[Fa.scale];t.scale.set(a[0],a[1],a[2])}if(e[Fa.rotation]){var s=e[Fa.rotation];t.rotation.set(s[0],s[1],-s[2],-s[3])}e[Fa.properties]&&(t.properties=e[Fa.properties]),void 0!==e.isshow&&null!==e.isshow&&(t.isShow=e.isshow)},e.prototype.createRooms=function(){for(var e=[],t=0;t<this.curFloorPlan.rooms.length;t++){var r=this.curFloorPlan.rooms[t];e.push(r.meshGroup)}return e},e.prototype.createWalls=function(){for(var e=[],t=0;t<this.world.buildings.length;t++)for(var r=this.world.buildings[t],i=0;i<r.floorplans.length;i++)for(var n=r.floorplans[i],o=0;o<n.walls.length;o++){var a=n.walls[o];e.push(a.wallGroup)}return e},e.prototype.createWallMesh=function(e){var t=new THREE.BufferGeometry;t.addAttribute("position",new THREE.BufferAttribute(e.positionArray,3)),t.addAttribute("normal",new THREE.BufferAttribute(e.normalArray,3)),t.addAttribute("uv",new THREE.BufferAttribute(e.uvArray,2));var r=e.material;return new THREE.Mesh(t,r)},ro(e,[{key:"downloadResourceProgress",get:function(){return this.resourceManager.downloadResProgess}}]),e}(),Ia=function(){function e(){to(this,e),this.sceneJson=null,this.scale=1,this.enableCombine=!0,this.pointInLineDeviation=.001,this.world=null,this.resourceManager=new Vo,this.combineManager=new Ta(this.resourceManager),this.combineParser=new ma(this),this.defaultWallEdgeResource=new Ao(this.resourceManager),this.defaultWallEdgeResource.id="EB9ECFA1101C4A0ABB770ED3A9865441",this.defaultWallEdgeResource.ext="jpg",this.defaultWallEdgeResource.baseUrl=this.resourceManager.baseTextureUrl,this.defaultWallTextureResource=new Ao(this.resourceManager),this.defaultWallTextureResource.id="81FDB96B43D441C5B3C650BFA2B76CD4",this.defaultWallTextureResource.ext="jpg",this.defaultWallTextureResource.isDefault=!0,this.defaultWallTextureResource.baseUrl=this.resourceManager.baseTextureUrl,this.defaultFloorTextureResource=new Ao(this.resourceManager),this.defaultFloorTextureResource.id="IQR8PZE2SGEV2H07WX3EJK22CA6ZS0YG",this.defaultFloorTextureResource.ext="jpg",this.defaultFloorTextureResource.baseUrl=this.resourceManager.baseTextureUrl,this.defaultCeilingTextureResource=new Ao(this.resourceManager),this.defaultCeilingTextureResource.id="UPEUIZIK19VMBPP9TLZJ3J3ILWK8V5ZB",this.defaultCeilingTextureResource.ext="jpg",this.defaultCeilingTextureResource.baseUrl=this.resourceManager.baseTextureUrl,this.defaultRoofTextureResource=new Ao(this.resourceManager),this.defaultRoofTextureResource.id="3OZVGE55PV0MY48FPRG5BELXKHV26NU5",this.defaultRoofTextureResource.ext="jpg",this.defaultRoofTextureResource.baseUrl=this.resourceManager.baseTextureUrl,uo.enableBuildMesh=!1}return e.prototype.disposeModels=function(){this.resourceManager.disposeModels()},e.prototype.disposeTextures=function(){this.resourceManager.disposeTextures()},e.prototype._nestingLoopYield=function(t,r,i){var n=this,e=t.next();if(e.done)return r&&r(),e.value;var o=e.value;e.done;o instanceof Promise?o.then(function(e){return n._nestingLoopYield(t,r,i)}).catch(function(e){i(e)}):this._nestingLoopYield(t,r,i)},e.prototype.delayLoad=function(e){var r=this;return e?(e.url&&(this.sceneURL=e.url,this.resourceManager.localCustomModelBaseUrl=this.getParentRelativeUrl(this.sceneURL)),e.json&&(this.sceneJson=e.json),e.customModeBaseUrl&&(this.resourceManager.localCustomModelBaseUrl=e.customModeBaseUrl),new Promise(function(e,t){r.resourceManager.initLightMaps(function(){r.loadSceneJson().then(function(){r.parseSceneJson().then(function(){return r.world.build(),new Promise(function(e,t){r.combineParser.parseWorld(r.world),r.combineParser.buildWorld(r.world),e(r.world)})})}).then(function(){e(r.world)}).catch(function(e){console.error(e)})})})):(console.error("load param can not be null"),null)},e.prototype.loadFont=function(r){return new Promise(function(e,t){(new THREE.FontLoader).load("./models/Font/Microsoft YaHei_Regular.json",function(e){Aa.font=e,r()})})},e.prototype.loadResources=function(){var r=this;return new Promise(function(e,t){r.resourceManager.downloadResourcesWithQueue(function(){e(r.world)})})},e.prototype.getParentRelativeUrl=function(e){for(var t=e.split("/"),r="",i=0;i<t.length-1;i++){r+=t[i]+"/"}return r},e.prototype.load=function(e){var r=this;return this.delayLoad(e).then(function(e,t){return r.loadResources()})},e.prototype.loadSceneJson=function(){var i=this;return new Promise(function(t,r){if(i.sceneJson)t(i.sceneJson);else if(i.sceneURL){(new THREE.FileLoader).load(i.sceneURL,function(e){i.sceneJson=JSON.parse(e),t()},function(){},function(e){r("can not load "+i.sceneURL)})}else r("load scene json error")})},e.prototype.createTextureLoaderPromise=function(r){return new Promise(function(t,e){(new THREE.TextureLoader).load(r,function(e){e.wrapS=THREE.RepeatWrapping,e.wrapT=THREE.RepeatWrapping,t(e)},function(e){console.log(r+" "+e.loaded/e.total*100+"% loaded")},function(e){t(null),console.log(r+"load error")})})},e.prototype.parseSceneJson=function(){var r=this;return new Promise(function(e,t){r.resourceManager.delayDownload=!0,r.parseWorld(r.sceneJson),e()})},e.prototype.parseWorld=function(e){var t=new Lo;this.world=t,e.unit&&(this.scale=.01*e.unit),e.planheight&&(this.planHeight=e.planheight);var r=this.parseBuilding(e,t);t.buildings.push(r);var i=new jo;t.outdoors=i},e.prototype.parseBuilding=function(e,t){var r=new Oo,i=new To;return this.parseFloorPlan(e,i,r),r.floorplans.push(i),r},e.prototype.parseFloorPlan=function(e,t,r){return this.planHeight&&(t.height=this.planHeight),e.walls&&this.parseWall(e.walls,t),e.rooms&&this.parseRoom(e.rooms,t),e.doors&&this.parseDoorJson(e.doors,t),t},e.prototype.parseDoorJson=function(e,t){for(var r=0,i=e.length;r<i;r++){var n=e[r],o=n.height*this.scale,a=n.width*this.scale,s=n.pos[0]*this.scale,l=n.pos[1]*this.scale,c=new THREE.Vector3(s,0,l),u=this.getPointOnWhichWall(t,c);if(null!==u){var h=new So;n.suspendpercent&&(h.suspendPercent=n.suspendpercent),h.size.x=a,h.size.y=o,h.position=c,u.doorOrWindows.push(h)}else console.warn("can not find door on which wall!")}},e.prototype.getPointOnWhichWall=function(e,t){for(var r=e.walls,i=0;i<r.length;i++){var n=r[i];if(this.isPointOnLineAndBetweenPoints(n.startCorner.position,n.endCorner.position,t))return n}return null},e.prototype.isPointOnLine=function(e,t,r){var i=new THREE.Vector3;return i.crossVectors(e.clone().sub(r),t.clone().sub(r)),i.length()<this.pointInLineDeviation},e.prototype.isPointOnLineAndBetweenPoints=function(e,t,r){if(!this.isPointOnLine(e,t,r))return!1;var i=t.x-e.x,n=t.z-e.z;return Math.abs(i)>=Math.abs(n)?0<i?e.x<=r.x&&r.x<=t.x:t.x<=r.x&&r.x<=e.x:0<n?e.z<=r.z&&r.z<=t.z:t.z<=r.z&&r.z<=e.z},e.prototype.parseWall=function(e,t){for(var r=0,i=e.length;r<i;r++){var n=e[r],o=n.start[0]*this.scale,a=n.start[1]*this.scale,s=null,l=null;s=t.existsCorner(o,0,a)?t.getCorner(o,0,a):t.addCorner(o,0,a),o=n.end[0]*this.scale,a=n.end[1]*this.scale,l=t.existsCorner(o,0,a)?t.getCorner(o,0,a):t.addCorner(o,0,a);var c=new bo;n.height?c.height=n.height:this.planHeight&&(c.height=this.planHeight),c.leftResource=this.defaultWallTextureResource,c.rightResource=this.defaultWallTextureResource,c.edgeResource=this.defaultWallEdgeResource,c.lightMapResource=co.wallLightMapResource,c.startCorner=s,c.endCorner=l,c.startCorner.addWall(c),c.endCorner.addWall(c),t.addWall(c)}},e.prototype.parseRoom=function(e,t){for(var r=0;r<e.length;r++){for(var i=e[r],n=[],o=null,a=0;a<i.points.length;a++){var s=i.points[a];n.push(new THREE.Vector3(s[0]*this.scale,0,s[1]*this.scale))}if(i.holes){o=[];for(a=0;a<i.holes.length;a++){for(var l=i.holes[a],c=[],u=0;u<l.length;u++){s=l[u];c.push(new THREE.Vector3(s[0]*this.scale,0,s[1]*this.scale))}o.push(c)}}var h=new wo;if(h.floorResource=this.defaultFloorTextureResource,h.ceilingResource=this.defaultCeilingTextureResource,h.roofResource=this.defaultRoofTextureResource,h.lightMapResource=co.floorLightMapResource,h.points=n,o&&(h.holes=o),i.center){var p=new THREE.Vector3;p.x=i.center[0],p.y=0,p.z=i.center[1],h.center=p}if(i.offset){var d=new THREE.Vector3;d.x=i.offset[0],d.y=i.offset[1],d.z=i.offset[2],h.offset=d}if(i.parentPosition){var f=new THREE.Vector3;f.x=i.parentPosition[0],f.y=i.parentPosition[1],f.z=i.parentPosition[2],h.parentPosition=f}(h.parent=t).rooms.push(h)}},e.prototype.createRooms=function(){for(var e=[],t=0;t<plan.rooms.length;t++){var r=plan.rooms[t];e.push(r.meshGroup)}return e},e.prototype.createWalls=function(){for(var e=[],t=0;t<this.world.buildings.length;t++)for(var r=this.world.buildings[t],i=0;i<r.floorplans.length;i++)for(var n=r.floorplans[i],o=0;o<n.walls.length;o++){var a=n.walls[o];e.push(a.wallGroup)}return e},e.prototype.createWallMesh=function(e){var t=new THREE.BufferGeometry;t.addAttribute("position",new THREE.BufferAttribute(e.positionArray,3)),t.addAttribute("normal",new THREE.BufferAttribute(e.normalArray,3)),t.addAttribute("uv",new THREE.BufferAttribute(e.uvArray,2));var r=e.material;return new THREE.Mesh(t,r)},ro(e,[{key:"downloadResourceProgress",get:function(){return this.resourceManager.downloadResProgess}}]),e}(),ja={id:"id",name:"name",position:"position",rotation:"rotation",scale:"scale",properties:"properties",plans:"plans",walls:"walls",placements:"placements",videoprobes:"videoprobes",groups:"groups",corners:"corners",doorOrWindows:"doororwindows",curveLines:"curvelines",pipeLines:"pipelines",text3Ds:"text3ds",rooms:"rooms",height:"height",thick:"thick",texture:"texture",type:"type",model:"model",suspendPercent:"suspendpercent",leftTexture:"lefttexture",rightTexture:"righttexture",edgeTexture:"edgetexture",floorTexture:"floortexture",ceilingTexture:"ceilingtexture",roofTexture:"rooftexture",isOpen:"isopen",wallType:"type"},Na=function(){function e(){to(this,e),this.sceneJson=null,this.scale=1,this.enableCombine=!0,this.pointInLineDeviation=.001,this.world=null,this.resourceManager=new Vo,this.combineManager=new Ta(this.resourceManager),this.combineParser=new ma(this),this.defaultFloorTextureResource=new Ao(this.resourceManager),this.defaultFloorTextureResource.id="IQR8PZE2SGEV2H07WX3EJK22CA6ZS0YG",this.defaultFloorTextureResource.ext="jpg",this.defaultFloorTextureResource.baseUrl=this.resourceManager.baseTextureUrl,this.defaultCeilingTextureResource=new Ao(this.resourceManager),this.defaultCeilingTextureResource.id="UPEUIZIK19VMBPP9TLZJ3J3ILWK8V5ZB",this.defaultCeilingTextureResource.ext="jpg",this.defaultCeilingTextureResource.baseUrl=this.resourceManager.baseTextureUrl,this.defaultRoofTextureResource=new Ao(this.resourceManager),this.defaultRoofTextureResource.id="3OZVGE55PV0MY48FPRG5BELXKHV26NU5",this.defaultRoofTextureResource.ext="jpg",this.defaultRoofTextureResource.baseUrl=this.resourceManager.baseTextureUrl,this.pluginManager=new ao(this),uo.enableBuildMesh=!1}return e.prototype.disposeModels=function(){this.resourceManager.disposeModels()},e.prototype.disposeTextures=function(){this.resourceManager.disposeTextures()},e.prototype._nestingLoopYield=function(t,r,i){var n=this,e=t.next();if(e.done)return r&&r(),e.value;var o=e.value;e.done;o instanceof Promise?o.then(function(e){return n._nestingLoopYield(t,r,i)}).catch(function(e){i(e)}):this._nestingLoopYield(t,r,i)},e.prototype.delayLoad=function(e){var r=this;return e?(e.url&&(this.sceneURL=e.url,this.resourceManager.localCustomModelBaseUrl=this.getParentRelativeUrl(this.sceneURL)),e.json&&(this.sceneJson=e.json),e.customModeBaseUrl&&(this.resourceManager.localCustomModelBaseUrl=e.customModeBaseUrl),new Promise(function(e,t){r.resourceManager.initLightMaps(function(){r.loadSceneJson().then(function(){r.parseSceneJson().then(function(){return r.world.build(),r.pluginManager.initPlugins(),new Promise(function(e,t){r.combineParser.parseWorld(r.world),r.combineParser.buildWorld(r.world),e(r.world)})})}).then(function(){e(r.world)}).catch(function(e){console.error(e)})})})):(console.error("load param can not be null"),null)},e.prototype.loadFont=function(r){return new Promise(function(e,t){(new THREE.FontLoader).load("./models/Font/Microsoft YaHei_Regular.json",function(e){Aa.font=e,r()})})},e.prototype.loadResources=function(){var r=this;return new Promise(function(e,t){r.resourceManager.downloadResourcesWithQueue(function(){e(r.world)})})},e.prototype.getParentRelativeUrl=function(e){for(var t=e.split("/"),r="",i=0;i<t.length-1;i++){r+=t[i]+"/"}return r},e.prototype.load=function(e){var r=this;return this.delayLoad(e).then(function(e,t){return r.loadResources()})},e.prototype.loadSceneJson=function(){var i=this;return new Promise(function(t,r){if(i.sceneJson)t(i.sceneJson);else if(i.sceneURL){(new THREE.FileLoader).load(i.sceneURL,function(e){i.sceneJson=JSON.parse(e),t()},function(){},function(e){r("can not load "+i.sceneURL)})}else r("load scene json error")})},e.prototype.createTextureLoaderPromise=function(r){return new Promise(function(t,e){(new THREE.TextureLoader).load(r,function(e){e.wrapS=THREE.RepeatWrapping,e.wrapT=THREE.RepeatWrapping,t(e)},function(e){console.log(r+" "+e.loaded/e.total*100+"% loaded")},function(e){t(null),console.log(r+"load error")})})},e.prototype.parseSceneJson=function(){var r=this;return new Promise(function(e,t){r.resourceManager.delayDownload=!0,r.resourceManager.loadTextures(r.sceneJson.textures),r.resourceManager.loadModels(r.sceneJson.models),r.parseWorld(r.sceneJson),e()})},e.prototype.parseWorld=function(e){var t=new Lo;this.world=t,e.unit&&(this.scale=.01*e.unit),e.planheight&&(this.planHeight=e.planheight);var r=this.parseBuilding(e,t);t.buildings.push(r);var i=new jo;t.outdoors=i},e.prototype.parseBuilding=function(e,t){var r=new Oo,i=new To;return this.parseFloorPlan(e,i,r),r.floorplans.push(i),r},e.prototype.parseFloorPlan=function(e,t,r){return this.planHeight&&(t.height=this.planHeight),e.walls&&this.parseWall(e.walls,t),e.rooms&&this.parseRoom(e.rooms,t),e.doors&&this.parseDoorJson(e.doors,t),t},e.prototype.parseDoorJson=function(e,t){for(var r=0,i=e.length;r<i;r++){var n=e[r],o=n.height*this.scale,a=n.width*this.scale,s=n.pos[0]*this.scale,l=n.pos[1]*this.scale,c=new THREE.Vector3(s,0,l),u=this.getPointOnWhichWall(t,c);if(null!==u){var h=new So;n.suspendpercent&&(h.suspendPercent=n.suspendpercent),h.size.x=a,h.size.y=o,h.position=c,u.doorOrWindows.push(h)}else console.warn("can not find door on which wall!")}},e.prototype.getPointOnWhichWall=function(e,t){for(var r=e.walls,i=0;i<r.length;i++){var n=r[i];if(this.isPointOnLineAndBetweenPoints(n.startCorner.position,n.endCorner.position,t))return n}return null},e.prototype.isPointOnLine=function(e,t,r){var i=new THREE.Vector3;return i.crossVectors(e.clone().sub(r),t.clone().sub(r)),i.length()<this.pointInLineDeviation},e.prototype.isPointOnLineAndBetweenPoints=function(e,t,r){if(!this.isPointOnLine(e,t,r))return!1;var i=t.x-e.x,n=t.z-e.z;return Math.abs(i)>=Math.abs(n)?0<i?e.x<=r.x&&r.x<=t.x:t.x<=r.x&&r.x<=e.x:0<n?e.z<=r.z&&r.z<=t.z:t.z<=r.z&&r.z<=e.z},e.prototype.parseWall=function(e,t){for(var r=0,i=e.length;r<i;r++){var n=e[r],o=n[ja.wallType],a=n.start[0]*this.scale,s=n.start[1]*this.scale,l=null,c=null;l=t.existsCorner(a,0,s)?t.getCorner(a,0,s):t.addCorner(a,0,s),a=n.end[0]*this.scale,s=n.end[1]*this.scale,c=t.existsCorner(a,0,s)?t.getCorner(a,0,s):t.addCorner(a,0,s);var u=null;0===o?(u=new bo).lightMapResource=co.wallLightMapResource:u=new Jo,n.height?u.height=n.height:this.planHeight&&(u.height=this.planHeight),void 0!==n[ja.leftTexture]&&(u.leftResource=this.resourceManager.textures[n[ja.leftTexture]]),void 0!==n[ja.rightTexture]&&(u.rightResource=this.resourceManager.textures[n[ja.rightTexture]]),void 0!==n[ja.edgeTexture]&&(u.edgeResource=this.resourceManager.textures[n[ja.edgeTexture]]),void 0!==n[ja.model]&&(u.resource=this.resourceManager.models[n[ja.model]]),u.startCorner=l,u.endCorner=c,u.startCorner.addWall(u),u.endCorner.addWall(u),t.addWall(u)}},e.prototype.parseRoom=function(e,t){for(var r=0;r<e.length;r++){for(var i=e[r],n=[],o=null,a=0;a<i.points.length;a++){var s=i.points[a];n.push(new THREE.Vector3(s[0]*this.scale,0,s[1]*this.scale))}if(i.holes){o=[];for(a=0;a<i.holes.length;a++){for(var l=i.holes[a],c=[],u=0;u<l.length;u++){s=l[u];c.push(new THREE.Vector3(s[0]*this.scale,0,s[1]*this.scale))}o.push(c)}}var h=new wo;if(h.floorResource=this.defaultFloorTextureResource,h.ceilingResource=this.defaultCeilingTextureResource,h.roofResource=this.defaultRoofTextureResource,h.lightMapResource=co.floorLightMapResource,h.points=n,o&&(h.holes=o),i.center){var p=new THREE.Vector3;p.x=i.center[0],p.y=0,p.z=i.center[1],h.center=p}if(i.offset){var d=new THREE.Vector3;d.x=i.offset[0],d.y=i.offset[1],d.z=i.offset[2],h.offset=d}if(i.parentPosition){var f=new THREE.Vector3;f.x=i.parentPosition[0],f.y=i.parentPosition[1],f.z=i.parentPosition[2],h.parentPosition=f}(h.parent=t).rooms.push(h)}},e.prototype.createRooms=function(){for(var e=[],t=0;t<plan.rooms.length;t++){var r=plan.rooms[t];e.push(r.meshGroup)}return e},e.prototype.createWalls=function(){for(var e=[],t=0;t<this.world.buildings.length;t++)for(var r=this.world.buildings[t],i=0;i<r.floorplans.length;i++)for(var n=r.floorplans[i],o=0;o<n.walls.length;o++){var a=n.walls[o];e.push(a.wallGroup)}return e},e.prototype.createWallMesh=function(e){var t=new THREE.BufferGeometry;t.addAttribute("position",new THREE.BufferAttribute(e.positionArray,3)),t.addAttribute("normal",new THREE.BufferAttribute(e.normalArray,3)),t.addAttribute("uv",new THREE.BufferAttribute(e.uvArray,2));var r=e.material;return new THREE.Mesh(t,r)},ro(e,[{key:"downloadResourceProgress",get:function(){return this.resourceManager.downloadResProgess}}]),e}();ao.regist("AddFloorOAUV2Plugin",so),e.HUAWEILoader=Co,e.HUAWEIWorldLoader=Fo,e.HUAWEIFloorPlanLoader=ko,e.Thing3DCadLoader=Io,e.UBuilderSceneLoader=fa,e.UBuilderSceneDelayLoader=La,e.UBuilderSceneSimpleLoader=Ha,e.ExportTestXSLoader=ka,e.ThingjsEditorSceneLoader=Ia,e.ThingjsEditorSceneLoader_2_0=Na,e.DefaultSetting=uo,Object.defineProperty(e,"__esModule",{value:!0})}),function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.t3d={})}(this,function(e){"use strict";var a=new Uint8Array([0,97,115,109,1,0,0,0,1,199,128,128,128,0,12,96,1,127,1,127,96,1,127,0,96,2,127,127,0,96,3,127,127,127,1,127,96,2,127,127,1,127,96,5,127,127,127,127,127,1,127,96,2,126,126,1,126,96,3,126,126,126,1,126,96,4,126,126,127,127,0,96,0,0,96,4,127,127,127,127,0,96,0,1,127,2,139,129,128,128,0,8,3,101,110,118,14,95,99,111,110,115,111,108,101,66,117,102,102,101,114,0,1,3,101,110,118,11,95,99,111,110,115,111,108,101,76,111,103,0,2,3,101,110,118,14,95,99,111,110,115,111,108,101,78,117,109,98,101,114,0,1,3,101,110,118,5,95,101,120,105,116,0,1,3,101,110,118,5,95,102,114,101,101,0,1,3,101,110,118,7,95,109,97,108,108,111,99,0,0,3,101,110,118,16,95,114,101,113,117,101,115,116,70,105,108,101,83,105,122,101,0,1,3,101,110,118,10,95,114,117,110,83,99,114,105,112,116,0,2,3,179,128,128,128,0,50,3,3,3,3,0,0,0,3,0,4,3,1,0,3,3,1,1,1,1,5,1,4,4,2,6,6,7,8,4,2,9,10,11,4,9,2,0,4,0,0,0,11,11,11,0,0,0,2,11,1,4,132,128,128,128,0,1,112,0,0,5,131,128,128,128,0,1,0,1,6,129,128,128,128,0,0,7,211,133,128,128,0,51,6,109,101,109,111,114,121,2,0,6,109,101,109,115,101,116,0,8,6,109,101,109,99,112,121,0,9,7,109,101,109,109,111,118,101,0,10,6,109,101,109,99,109,112,0,11,7,105,115,80,114,105,109,101,0,12,7,116,111,85,112,112,101,114,0,13,7,116,111,76,111,119,101,114,0,14,12,115,116,114,105,110,103,69,113,117,97,108,115,0,15,12,115,116,114,105,110,103,76,101,110,103,116,104,0,16,15,115,101,97,114,99,104,83,116,114,105,110,103,76,50,82,0,17,10,99,111,112,121,83,116,114,105,110,103,0,18,9,109,105,120,83,116,114,105,110,103,0,19,11,97,108,108,111,99,83,116,114,105,110,103,0,20,12,97,112,112,101,110,100,83,116,114,105,110,103,0,21,9,115,117,98,83,116,114,105,110,103,0,22,13,99,111,110,115,111,108,101,78,117,109,98,101,114,0,23,13,99,111,110,115,111,108,101,66,117,102,102,101,114,0,24,10,99,111,110,115,111,108,101,76,111,103,0,25,9,114,117,110,83,99,114,105,112,116,0,26,10,106,115,109,110,95,112,97,114,115,101,0,27,9,106,115,109,110,95,105,110,105,116,0,28,15,112,97,114,115,101,74,83,79,78,83,116,114,105,110,103,0,29,13,102,105,110,100,74,83,79,78,84,111,107,101,110,0,30,13,102,114,101,101,74,83,79,78,84,111,107,101,110,0,31,3,103,99,100,0,32,9,69,120,116,69,117,99,108,105,100,0,33,10,114,115,97,95,109,111,100,69,120,112,0,34,10,114,115,97,71,101,110,75,101,121,115,0,35,17,114,115,97,71,101,116,69,110,99,114,121,112,116,83,105,122,101,0,36,10,105,110,105,116,71,108,111,98,97,108,0,37,10,102,114,101,101,71,108,111,98,97,108,0,38,14,115,101,116,82,97,110,100,111,109,83,101,101,100,115,0,39,6,114,97,110,100,111,109,0,40,10,114,97,110,100,111,109,85,105,110,116,0,41,15,114,101,113,117,101,115,116,70,105,108,101,83,105,122,101,0,42,14,111,110,82,101,99,118,70,105,108,101,83,105,122,101,0,43,21,103,101,116,69,110,99,111,100,105,110,103,83,116,114,105,110,103,83,105,122,101,0,44,21,103,101,116,69,110,99,111,100,105,110,103,83,116,114,105,110,103,68,97,116,97,0,45,12,101,110,99,111,100,101,83,116,114,105,110,103,0,46,21,103,101,116,68,101,99,111,100,105,110,103,83,116,114,105,110,103,83,105,122,101,0,47,12,100,101,99,111,100,101,83,116,114,105,110,103,0,48,13,103,101,116,65,116,116,114,105,98,117,116,101,115,0,49,5,103,101,116,73,68,0,50,16,103,101,116,80,108,117,103,105,110,115,78,117,109,98,101,114,0,51,16,103,101,116,80,108,117,103,105,110,86,101,114,115,105,111,110,0,52,13,103,101,116,80,108,117,103,105,110,78,97,109,101,0,53,13,103,101,116,80,108,117,103,105,110,68,101,115,99,0,54,13,115,101,116,65,116,116,114,105,98,117,116,101,115,0,55,14,103,101,116,82,97,110,100,111,109,86,97,108,117,101,0,56,4,101,118,97,108,0,57,10,169,195,128,128,0,50,172,128,128,128,0,1,1,127,2,64,32,2,69,13,0,32,0,33,3,3,64,32,3,32,1,58,0,0,32,3,65,1,106,33,3,32,2,65,127,106,34,2,13,0,11,11,32,0,11,182,128,128,128,0,1,1,127,2,64,32,2,69,13,0,32,0,33,3,3,64,32,3,32,1,45,0,0,58,0,0,32,3,65,1,106,33,3,32,1,65,1,106,33,1,32,2,65,127,106,34,2,13,0,11,11,32,0,11,233,128,128,128,0,1,1,127,2,64,2,64,32,0,32,1,77,13,0,32,2,69,13,1,3,64,32,0,32,2,106,65,127,106,32,1,32,2,106,65,127,106,45,0,0,58,0,0,32,2,65,127,106,34,2,13,0,12,2,11,11,32,2,69,13,0,32,0,33,3,3,64,32,3,32,1,45,0,0,58,0,0,32,3,65,1,106,33,3,32,1,65,1,106,33,1,32,2,65,127,106,34,2,13,0,11,11,32,0,11,202,128,128,128,0,1,1,127,2,64,2,64,32,2,65,1,72,13,0,32,2,65,1,106,33,2,3,64,32,0,45,0,0,32,1,45,0,0,107,34,3,13,2,32,1,65,1,106,33,1,32,0,65,1,106,33,0,32,2,65,127,106,34,2,65,1,74,13,0,11,11,65,0,33,3,11,32,3,11,191,128,128,128,0,1,2,127,2,64,2,64,32,0,65,1,70,13,0,32,0,65,2,109,33,1,32,0,65,4,72,13,0,65,1,33,2,3,64,32,0,32,2,65,1,106,34,2,111,69,13,2,32,2,32,1,72,13,0,11,11,65,0,15,11,65,1,11,147,128,128,128,0,0,32,0,65,96,106,32,0,32,0,65,159,127,106,65,26,73,27,11,147,128,128,128,0,0,32,0,65,32,106,32,0,32,0,65,191,127,106,65,26,73,27,11,167,129,128,128,0,1,1,127,2,64,2,64,2,64,2,64,32,0,69,13,0,32,1,69,13,1,2,64,2,64,32,2,69,13,0,3,64,32,0,44,0,0,34,2,65,32,106,32,2,32,2,65,191,127,106,65,26,73,27,34,3,32,1,44,0,0,34,2,65,32,106,32,2,32,2,65,191,127,106,65,26,73,27,71,13,5,65,1,33,2,32,0,65,1,106,33,0,32,1,65,1,106,33,1,32,3,13,0,12,2,11,11,3,64,32,0,45,0,0,34,3,32,1,45,0,0,71,13,5,65,1,33,2,32,0,65,1,106,33,0,32,1,65,1,106,33,1,32,3,13,0,11,11,32,2,15,11,65,0,15,11,65,0,15,11,65,0,15,11,65,0,11,185,128,128,128,0,1,3,127,2,64,32,0,45,0,0,69,13,0,32,0,65,1,106,33,1,65,0,33,0,3,64,32,1,32,0,106,33,2,32,0,65,1,106,34,3,33,0,32,2,45,0,0,13,0,11,32,3,15,11,65,0,11,233,129,128,128,0,1,7,127,65,127,33,8,2,64,2,64,32,1,45,0,0,69,13,0,65,1,33,6,3,64,32,1,32,6,106,33,5,32,6,65,1,106,34,2,33,6,32,5,45,0,0,13,0,11,32,2,65,126,106,33,3,2,64,2,64,32,0,45,0,0,69,13,0,32,0,65,1,106,33,4,65,0,33,6,3,64,32,4,32,6,106,33,5,32,6,65,1,106,34,7,33,6,32,5,45,0,0,13,0,11,32,7,32,3,74,13,1,12,2,11,65,0,33,7,65,0,32,3,76,13,1,11,32,0,33,4,32,3,65,0,72,13,1,32,0,33,4,3,64,65,0,33,6,32,2,33,5,2,64,3,64,32,4,32,6,106,45,0,0,32,1,32,6,106,45,0,0,71,13,1,32,6,65,1,106,33,6,32,5,65,127,106,34,5,65,1,74,13,0,12,4,11,11,32,4,65,1,106,33,4,65,127,33,8,32,7,65,127,106,34,7,32,3,74,13,0,11,11,32,8,15,11,32,4,32,0,107,11,255,128,128,128,0,1,4,127,2,64,32,2,69,13,0,32,0,33,6,2,64,32,1,45,0,0,34,4,69,13,0,32,1,65,1,106,33,1,32,0,33,5,2,64,3,64,32,5,34,3,32,4,58,0,0,65,127,33,6,2,64,32,2,65,127,70,13,0,32,2,65,127,106,34,6,69,13,2,11,32,3,65,1,106,33,5,32,1,45,0,0,33,4,32,1,65,1,106,33,1,32,6,33,2,32,4,13,0,11,11,32,3,65,1,106,33,6,11,32,6,65,0,58,0,0,32,0,15,11,65,0,11,238,130,128,128,0,1,5,127,2,64,32,0,45,0,0,69,13,0,32,0,65,1,106,33,5,3,64,65,0,40,2,12,34,0,32,0,40,2,0,34,4,65,6,116,32,4,115,65,13,118,32,4,65,18,116,65,128,128,96,113,114,34,1,54,2,0,32,0,32,0,40,2,4,34,4,65,2,116,34,3,32,4,115,65,27,118,32,3,65,96,113,114,34,2,54,2,4,32,0,40,2,12,33,4,32,0,32,0,40,2,8,34,3,65,13,116,32,3,115,65,21,118,32,3,65,7,116,65,128,112,113,114,34,3,54,2,8,32,0,32,4,32,4,65,3,116,115,65,12,118,32,4,65,13,116,65,128,128,64,113,114,34,4,54,2,12,32,5,32,2,32,1,115,32,3,115,32,4,115,65,255,1,112,58,0,0,65,0,40,2,12,34,0,32,0,40,2,0,34,4,65,6,116,32,4,115,65,13,118,32,4,65,18,116,65,128,128,96,113,114,34,1,54,2,0,32,0,32,0,40,2,4,34,4,65,2,116,34,3,32,4,115,65,27,118,32,3,65,96,113,114,34,2,54,2,4,32,0,40,2,12,33,4,32,0,32,0,40,2,8,34,3,65,13,116,32,3,115,65,21,118,32,3,65,7,116,65,128,112,113,114,34,3,54,2,8,32,0,32,4,32,4,65,3,116,115,65,12,118,32,4,65,13,116,65,128,128,64,113,114,34,4,54,2,12,32,5,32,2,32,1,115,32,3,115,32,4,115,65,255,1,112,32,5,45,0,0,115,34,0,58,0,0,32,5,65,1,106,33,5,32,0,65,255,1,113,13,0,11,11,11,195,129,128,128,0,1,6,127,2,64,2,64,32,0,69,13,0,32,0,45,0,0,69,13,1,65,1,33,4,3,64,32,0,32,4,106,33,3,32,4,65,1,106,34,1,33,4,32,3,45,0,0,13,0,11,32,1,16,5,34,6,33,3,2,64,32,0,45,0,0,34,4,69,13,0,32,1,65,127,106,33,1,32,0,65,1,106,33,3,32,6,33,5,2,64,3,64,32,5,34,2,32,4,58,0,0,65,127,33,0,2,64,32,1,65,127,70,13,0,32,1,65,127,106,34,0,69,13,2,11,32,2,65,1,106,33,5,32,3,45,0,0,33,4,32,3,65,1,106,33,3,32,0,33,1,32,4,13,0,11,11,32,2,65,1,106,33,3,11,32,3,65,0,58,0,0,32,6,15,11,65,1,16,5,34,4,65,0,58,0,0,32,4,15,11,65,1,16,5,11,252,128,128,128,0,1,3,127,2,64,32,2,69,13,0,32,0,65,0,58,0,0,11,32,0,33,2,3,64,32,2,45,0,0,33,4,32,2,65,1,106,34,5,33,2,32,4,13,0,11,2,64,32,1,45,0,0,34,4,69,13,0,32,1,65,1,106,33,1,65,0,33,2,3,64,32,5,32,2,106,32,4,58,0,0,32,1,32,2,106,33,4,32,2,65,1,106,34,3,33,2,32,4,45,0,0,34,4,13,0,11,32,5,32,3,106,33,5,11,32,5,65,0,58,0,0,32,0,11,143,129,128,128,0,1,4,127,32,2,32,1,107,34,5,65,1,106,16,5,33,3,2,64,32,5,69,13,0,32,3,33,2,2,64,32,0,32,1,106,34,0,45,0,0,34,1,69,13,0,32,0,65,1,106,33,2,32,3,33,6,2,64,3,64,32,6,34,4,32,1,58,0,0,65,127,33,0,2,64,32,5,65,127,70,13,0,32,5,65,127,106,34,0,69,13,2,11,32,4,65,1,106,33,6,32,2,45,0,0,33,1,32,2,65,1,106,33,2,32,0,33,5,32,1,13,0,11,11,32,4,65,1,106,33,2,11,32,2,65,0,58,0,0,11,32,3,11,134,128,128,128,0,0,32,0,16,2,11,134,128,128,128,0,0,32,0,16,0,11,193,128,128,128,0,1,4,127,2,64,32,0,45,0,0,69,13,0,32,0,65,1,106,33,1,65,0,33,3,3,64,32,1,32,3,106,33,2,32,3,65,1,106,34,4,33,3,32,2,45,0,0,13,0,11,32,0,32,4,16,1,15,11,32,0,65,0,16,1,11,193,128,128,128,0,1,4,127,2,64,32,0,45,0,0,69,13,0,32,0,65,1,106,33,1,65,0,33,3,3,64,32,1,32,3,106,33,2,32,3,65,1,106,34,4,33,3,32,2,45,0,0,13,0,11,32,0,32,4,16,7,15,11,32,0,65,0,16,7,11,129,142,128,128,0,1,9,127,32,0,40,2,4,33,11,2,64,2,64,2,64,2,64,2,64,2,64,32,0,40,2,0,34,5,32,2,79,13,0,32,0,65,8,106,33,8,32,11,33,12,2,64,2,64,2,64,3,64,32,1,32,5,106,45,0,0,34,13,69,13,1,2,64,2,64,2,64,2,64,2,64,2,64,2,64,2,64,2,64,2,64,32,13,65,24,116,65,24,117,34,7,65,119,106,34,10,65,212,0,75,13,0,2,64,2,64,2,64,32,10,14,85,12,12,6,6,12,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,12,6,0,6,6,6,6,6,6,6,6,6,2,6,6,6,6,6,6,6,6,6,6,6,6,6,1,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,5,6,4,12,11,32,0,32,5,65,1,106,34,6,54,2,0,2,64,32,6,32,2,79,13,0,32,6,33,13,32,5,33,10,3,64,32,10,33,7,2,64,2,64,2,64,2,64,2,64,32,1,32,13,106,45,0,0,34,10,65,220,0,70,13,0,32,10,69,13,6,32,10,65,34,70,13,1,32,13,33,10,12,4,11,32,13,33,10,32,7,65,2,106,34,13,32,2,79,13,3,32,0,32,13,54,2,0,32,1,32,13,106,44,0,0,65,94,106,34,9,65,211,0,75,13,1,32,13,33,10,2,64,32,9,14,84,4,2,2,2,2,2,2,2,2,2,2,2,2,4,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,4,2,2,2,2,2,4,2,2,2,4,2,2,2,2,2,2,2,4,2,2,2,4,2,4,0,4,11,32,0,32,7,65,3,106,34,13,54,2,0,2,64,32,13,32,2,79,13,0,32,1,32,13,106,45,0,0,34,10,69,13,0,2,64,32,10,65,80,106,65,255,1,113,65,10,73,13,0,32,10,65,191,127,106,65,6,73,13,0,32,10,65,159,127,106,65,6,79,13,3,11,32,0,32,7,65,4,106,34,13,54,2,0,32,13,32,2,79,13,0,32,1,32,13,106,45,0,0,34,10,69,13,0,2,64,32,10,65,80,106,65,255,1,113,65,10,73,13,0,32,10,65,159,127,106,65,6,73,13,0,32,10,65,191,127,106,65,5,75,13,3,11,32,0,32,7,65,5,106,34,13,54,2,0,32,13,32,2,79,13,0,32,1,32,13,106,45,0,0,34,10,69,13,0,2,64,32,10,65,80,106,65,255,1,113,65,10,73,13,0,32,10,65,159,127,106,65,6,73,13,0,32,10,65,191,127,106,65,5,75,13,3,11,32,0,32,7,65,6,106,34,13,54,2,0,32,13,32,2,79,13,0,32,1,32,13,106,45,0,0,34,10,69,13,0,2,64,32,10,65,80,106,65,255,1,113,65,10,73,13,0,32,10,65,159,127,106,65,6,73,13,0,32,10,65,191,127,106,65,5,75,13,3,11,32,0,32,7,65,7,106,34,13,54,2,0,11,32,0,32,13,65,127,106,34,10,54,2,0,12,3,11,2,64,32,3,69,13,0,32,11,32,4,79,13,2,32,0,65,4,106,32,11,65,1,106,34,7,54,2,0,32,3,32,11,65,20,108,106,34,5,65,3,54,2,0,32,5,32,6,54,2,4,32,5,32,13,54,2,8,32,5,65,0,54,2,12,32,5,32,8,40,2,0,34,10,54,2,16,32,12,65,1,106,33,12,2,64,32,10,65,127,70,13,0,32,3,32,10,65,20,108,106,34,5,32,5,40,2,12,65,1,106,54,2,12,11,32,13,33,5,32,7,33,11,12,17,11,32,12,65,1,106,33,12,32,13,33,5,12,16,11,32,0,32,5,54,2,0,65,126,15,11,32,0,32,5,54,2,0,65,127,15,11,32,0,32,10,65,1,106,34,13,54,2,0,32,13,32,2,73,13,0,11,11,32,0,32,5,54,2,0,12,19,11,32,8,32,11,65,127,106,54,2,0,12,10,11,32,3,69,13,9,32,8,40,2,0,34,13,65,127,70,13,9,32,3,32,13,65,20,108,106,34,13,40,2,0,65,127,106,65,2,73,13,9,32,8,32,13,40,2,16,54,2,0,12,9,11,32,7,65,251,0,70,13,1,32,7,65,253,0,71,13,2,11,32,3,69,13,7,65,126,33,7,32,11,69,13,16,65,1,65,2,32,13,65,253,0,70,27,33,9,32,11,65,127,106,33,10,3,64,2,64,32,3,32,10,65,20,108,106,34,13,40,2,4,65,127,70,13,0,32,13,40,2,8,65,127,70,13,4,11,32,13,40,2,16,34,10,65,127,71,13,0,11,32,13,40,2,0,32,9,71,13,16,32,8,40,2,0,65,127,71,13,7,12,16,11,32,12,65,1,106,33,12,32,3,69,13,6,65,127,33,7,32,11,32,4,79,13,15,32,0,65,4,106,32,11,65,1,106,34,9,54,2,0,32,3,32,11,65,20,108,106,34,10,66,127,55,2,4,32,10,66,128,128,128,128,112,55,2,12,32,10,69,13,15,32,10,65,4,106,33,6,2,64,32,8,40,2,0,34,7,65,127,70,13,0,32,10,65,16,106,32,7,54,2,0,32,3,32,7,65,20,108,106,34,7,32,7,40,2,12,65,1,106,54,2,12,11,32,6,32,5,54,2,0,32,8,32,11,54,2,0,32,10,65,1,65,2,32,13,65,251,0,70,27,54,2,0,32,9,33,11,12,6,11,32,5,33,10,2,64,32,13,69,13,0,32,5,65,1,106,33,7,3,64,32,7,33,10,2,64,2,64,32,13,65,24,116,65,24,117,34,7,65,119,106,34,9,65,49,75,13,0,32,9,14,50,5,5,1,1,5,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,5,1,1,1,1,1,1,1,1,1,1,1,5,1,1,1,1,1,1,1,1,1,1,1,1,1,5,5,11,32,7,65,221,0,70,13,4,32,7,65,253,0,70,13,4,11,65,126,33,9,32,7,65,32,72,13,11,32,13,65,255,1,113,65,255,0,70,13,11,32,0,32,10,54,2,0,32,10,32,2,79,13,1,32,10,65,1,106,33,7,32,1,32,10,106,45,0,0,34,13,13,0,11,11,32,3,69,13,3,12,2,11,32,13,40,2,0,32,9,71,13,13,32,13,65,8,106,32,5,65,1,106,54,2,0,32,8,32,13,40,2,16,54,2,0,12,4,11,32,10,65,127,106,33,10,32,3,69,13,1,11,32,11,32,4,79,13,5,32,0,65,4,106,32,11,65,1,106,34,9,54,2,0,32,3,32,11,65,20,108,106,34,13,65,4,54,2,0,32,13,32,5,54,2,4,32,13,32,10,54,2,8,32,13,65,0,54,2,12,32,13,32,8,40,2,0,34,7,54,2,16,32,9,33,11,12,1,11,32,8,40,2,0,33,7,11,32,0,32,10,65,127,106,34,5,54,2,0,32,12,65,1,106,33,12,32,3,69,13,0,32,7,65,127,70,13,0,32,3,32,7,65,20,108,106,34,13,32,13,40,2,12,65,1,106,54,2,12,11,32,0,32,5,65,1,106,34,5,54,2,0,32,5,32,2,73,13,0,11,11,32,3,69,13,3,12,4,11,65,127,33,9,11,32,0,32,5,54,2,0,32,9,15,11,32,11,33,12,32,3,13,1,11,32,12,15,11,32,11,65,127,106,34,5,65,0,72,13,2,32,3,32,11,65,20,108,106,65,112,106,33,13,3,64,2,64,32,13,40,2,0,65,127,70,13,0,32,13,65,4,106,40,2,0,65,127,70,13,2,11,32,13,65,108,106,33,13,32,5,65,127,106,34,5,65,127,74,13,0,11,32,12,15,11,65,125,33,7,11,32,7,15,11,32,12,11,144,128,128,128,0,0,32,0,65,127,54,2,8,32,0,66,0,55,2,0,11,192,131,128,128,0,1,13,127,65,12,16,5,34,12,65,127,54,2,8,32,12,66,0,55,2,0,65,0,33,11,65,128,160,1,16,5,65,0,65,128,160,1,16,8,33,2,2,64,32,0,45,0,0,69,13,0,32,0,65,1,106,33,13,65,0,33,14,3,64,32,13,32,14,106,33,9,32,14,65,1,106,34,11,33,14,32,9,45,0,0,13,0,11,11,32,12,32,0,32,11,32,2,65,128,8,16,27,33,4,2,64,32,1,69,13,0,32,1,32,4,54,2,0,11,32,4,65,20,108,34,14,16,5,65,0,32,14,16,8,33,3,2,64,32,4,65,1,72,13,0,32,0,65,1,106,33,5,65,0,33,10,3,64,32,3,32,10,65,20,108,34,14,106,33,7,2,64,32,2,32,14,106,34,6,40,2,0,65,125,106,65,1,75,13,0,32,6,40,2,8,32,6,40,2,4,34,9,107,34,11,65,1,106,16,5,33,8,2,64,32,11,69,13,0,32,8,33,13,2,64,32,0,32,9,106,45,0,0,34,14,69,13,0,32,5,32,9,106,33,9,32,8,33,12,2,64,3,64,32,12,34,1,32,14,58,0,0,65,127,33,13,2,64,32,11,65,127,70,13,0,32,11,65,127,106,34,13,69,13,2,11,32,1,65,1,106,33,12,32,9,45,0,0,33,14,32,9,65,1,106,33,9,32,13,33,11,32,14,13,0,11,11,32,1,65,1,106,33,13,11,32,13,65,0,58,0,0,11,32,7,32,8,54,2,0,11,32,7,32,6,54,2,4,2,64,32,6,40,2,16,34,14,65,127,70,13,0,32,7,32,3,32,14,65,20,108,106,34,9,54,2,8,2,64,2,64,32,9,40,2,12,34,14,69,13,0,3,64,32,14,34,9,40,2,16,34,14,13,0,11,32,9,65,16,106,33,14,12,1,11,32,9,65,12,106,33,14,11,32,14,32,7,54,2,0,11,32,10,65,1,106,34,10,32,4,71,13,0,11,11,32,3,11,252,129,128,128,0,1,6,127,65,0,33,6,2,64,32,1,69,13,0,32,0,69,13,0,32,1,65,1,106,33,2,2,64,3,64,2,64,32,0,40,2,0,34,3,69,13,0,2,64,2,64,32,3,45,0,0,69,13,0,32,3,65,1,106,33,4,65,0,33,6,3,64,32,4,32,6,106,33,5,32,6,65,1,106,34,7,33,6,32,5,45,0,0,13,0,12,2,11,11,65,0,33,7,11,32,3,32,7,16,1,11,2,64,2,64,32,1,45,0,0,69,13,0,65,0,33,6,3,64,32,2,32,6,106,33,5,32,6,65,1,106,34,7,33,6,32,5,45,0,0,13,0,12,2,11,11,65,0,33,7,11,32,1,32,7,16,1,2,64,32,0,40,2,0,34,6,69,13,0,32,1,33,5,3,64,32,6,45,0,0,34,7,32,5,45,0,0,71,13,1,32,6,65,1,106,33,6,32,5,65,1,106,33,5,32,7,13,0,12,3,11,11,32,0,40,2,16,32,1,16,30,34,6,13,2,32,0,40,2,12,34,0,13,0,11,65,0,15,11,32,0,33,6,11,32,6,11,206,128,128,128,0,1,2,127,2,64,2,64,2,64,32,1,65,1,72,13,0,32,0,33,3,3,64,2,64,32,3,40,2,0,34,2,69,13,0,32,2,16,4,32,3,65,0,54,2,0,11,32,3,65,20,106,33,3,32,1,65,127,106,34,1,13,0,12,2,11,11,32,0,69,13,1,11,32,0,16,4,11,11,168,128,128,128,0,1,1,126,2,64,32,0,80,13,0,3,64,32,1,32,0,34,2,129,33,0,32,2,33,1,32,0,66,0,82,13,0,11,32,2,15,11,32,1,11,195,128,128,128,0,1,4,126,2,64,32,0,80,13,0,66,1,33,3,66,0,33,4,3,64,32,3,32,1,32,0,34,2,127,32,4,34,5,126,125,33,4,32,1,32,2,129,33,0,32,5,33,3,32,2,33,1,32,0,66,0,82,13,0,11,32,5,15,11,66,1,11,135,129,128,128,0,1,2,126,2,64,2,64,32,1,32,0,132,66,0,83,13,0,32,2,66,0,85,13,1,11,65,1,16,3,11,32,0,32,2,129,33,0,2,64,2,64,2,64,2,64,32,1,80,13,0,32,1,66,1,82,13,1,32,0,15,11,66,1,33,4,12,1,11,32,1,66,2,129,34,3,66,1,81,13,1,66,0,33,4,32,3,66,0,82,13,0,32,0,32,0,126,32,2,129,32,1,66,2,127,32,2,16,34,32,2,129,15,11,32,4,15,11,32,0,32,1,66,127,124,32,2,16,34,32,0,126,32,2,129,11,149,129,128,128,0,1,7,126,2,64,2,64,32,1,66,127,124,32,0,66,127,124,126,34,4,80,13,0,66,129,2,33,10,66,1,33,7,32,4,33,6,66,0,33,8,3,64,32,7,32,10,32,6,34,5,127,32,8,34,9,126,125,33,8,32,10,32,5,129,33,6,32,9,33,7,32,5,33,10,32,6,66,0,82,13,0,12,2,11,11,66,1,33,9,11,32,1,32,0,126,33,6,32,9,32,4,125,33,10,3,64,32,10,32,4,124,34,10,66,0,83,13,0,11,32,2,66,129,2,55,3,8,32,2,32,6,55,3,0,32,3,32,6,55,3,0,32,3,32,10,55,3,8,11,188,128,128,128,0,1,1,127,2,64,32,1,65,1,72,13,0,65,0,33,2,3,64,65,2,65,1,32,0,44,0,0,65,0,72,27,32,2,106,33,2,32,0,65,1,106,33,0,32,1,65,127,106,34,1,13,0,11,32,2,15,11,65,0,11,245,130,128,128,0,4,2,126,3,127,4,126,3,127,65,0,65,200,0,16,5,34,11,54,2,12,32,11,65,0,65,200,0,16,8,26,66,129,2,33,9,66,1,33,8,66,184,240,185,10,33,7,66,0,33,10,3,64,32,8,32,9,32,7,34,2,127,32,10,34,3,126,125,33,10,32,9,32,2,129,33,7,32,3,33,8,32,2,33,9,32,7,66,0,82,13,0,11,32,11,66,129,2,55,3,40,32,11,66,199,161,192,10,55,3,48,32,11,65,32,106,66,199,161,192,10,55,3,0,32,11,32,3,66,0,32,3,66,0,85,27,66,183,240,185,10,124,34,9,32,9,32,3,125,66,184,240,185,10,130,125,55,3,56,2,64,2,64,2,64,32,0,69,13,0,32,0,45,0,0,69,13,1,65,1,33,11,3,64,32,0,32,11,106,33,6,32,11,65,1,106,34,4,33,11,32,6,45,0,0,13,0,11,32,4,16,5,34,13,33,6,2,64,32,0,45,0,0,34,11,69,13,0,32,4,65,127,106,33,4,32,0,65,1,106,33,6,32,13,33,12,2,64,3,64,32,12,34,5,32,11,58,0,0,65,127,33,0,2,64,32,4,65,127,70,13,0,32,4,65,127,106,34,0,69,13,2,11,32,5,65,1,106,33,12,32,6,45,0,0,33,11,32,6,65,1,106,33,6,32,0,33,4,32,11,13,0,11,11,32,5,65,1,106,33,6,11,32,6,65,0,58,0,0,12,2,11,65,1,16,5,34,13,65,0,58,0,0,12,1,11,65,1,16,5,33,13,11,65,0,40,2,12,34,11,32,13,54,2,64,32,11,32,1,54,2,68,11,156,128,128,128,0,1,1,127,2,64,65,0,40,2,12,34,0,69,13,0,32,0,16,4,65,0,65,0,54,2,12,11,11,165,128,128,128,0,1,1,127,65,0,40,2,12,34,4,32,0,54,2,0,32,4,32,1,54,2,4,32,4,32,2,54,2,8,32,4,32,3,54,2,12,11,154,129,128,128,0,1,5,127,65,0,40,2,12,34,0,32,0,40,2,0,34,4,65,6,116,32,4,115,65,13,118,32,4,65,18,116,65,128,128,96,113,114,34,1,54,2,0,32,0,32,0,40,2,4,34,4,65,2,116,34,3,32,4,115,65,27,118,32,3,65,96,113,114,34,2,54,2,4,32,0,40,2,12,33,4,32,0,32,0,40,2,8,34,3,65,13,116,32,3,115,65,21,118,32,3,65,7,116,65,128,112,113,114,34,3,54,2,8,32,0,32,4,32,4,65,3,116,115,65,12,118,32,4,65,13,116,65,128,128,64,113,114,34,4,54,2,12,32,2,32,1,115,32,3,115,32,4,115,11,166,129,128,128,0,1,5,127,65,0,40,2,12,34,2,32,2,40,2,0,34,6,65,6,116,32,6,115,65,13,118,32,6,65,18,116,65,128,128,96,113,114,34,3,54,2,0,32,2,32,2,40,2,4,34,6,65,2,116,34,5,32,6,115,65,27,118,32,5,65,96,113,114,34,4,54,2,4,32,2,40,2,12,33,6,32,2,32,2,40,2,8,34,5,65,13,116,32,5,115,65,21,118,32,5,65,7,116,65,128,112,113,114,34,5,54,2,8,32,2,32,6,32,6,65,3,116,115,65,12,118,32,6,65,13,116,65,128,128,64,113,114,34,6,54,2,12,32,4,32,3,115,32,5,115,32,6,115,65,1,32,0,107,32,1,106,112,32,0,106,11,140,128,128,128,0,0,65,0,40,2,12,40,2,64,16,6,11,182,129,128,128,0,1,5,127,2,64,65,0,40,2,12,34,3,40,2,64,34,5,45,0,0,34,6,69,13,0,32,5,69,13,0,32,0,65,16,32,0,27,34,2,45,0,0,34,0,65,255,1,113,34,4,69,13,0,32,6,32,4,71,13,0,32,5,65,1,106,33,5,32,2,65,1,106,33,6,2,64,3,64,32,0,65,255,1,113,69,13,1,32,6,45,0,0,33,0,32,5,45,0,0,33,4,32,5,65,1,106,33,5,32,6,65,1,106,33,6,32,4,32,0,70,13,0,12,2,11,11,32,3,40,2,68,34,0,32,1,70,13,0,32,1,69,13,0,32,0,69,13,0,32,3,32,3,40,2,16,65,144,128,1,114,54,2,16,11,32,3,32,3,40,2,16,65,128,128,128,128,120,114,54,2,16,11,158,129,128,128,0,1,6,127,65,8,33,6,2,64,32,0,44,0,0,34,1,69,13,0,32,0,65,1,106,33,2,65,126,33,5,3,64,32,2,32,5,106,33,4,32,5,65,1,106,34,3,33,5,32,4,65,2,106,45,0,0,13,0,11,32,3,65,1,106,65,0,72,13,0,65,2,65,1,32,1,65,0,72,27,33,4,2,64,32,3,65,127,70,13,0,32,0,65,1,106,33,0,65,0,33,5,3,64,65,2,65,1,32,0,32,5,106,44,0,0,65,0,72,27,32,4,106,33,4,32,5,32,3,71,33,2,32,5,65,1,106,33,5,32,2,13,0,11,11,32,4,65,3,116,65,8,106,33,6,11,32,6,11,163,128,128,128,0,0,2,64,2,64,32,0,69,13,0,32,0,32,1,106,45,0,0,33,0,12,1,11,65,0,33,0,11,32,0,65,255,1,113,11,220,131,128,128,0,2,10,127,1,126,65,0,33,9,65,0,33,3,2,64,32,0,44,0,0,34,1,69,13,0,32,0,65,1,106,33,7,65,0,33,10,3,64,32,7,32,10,106,33,3,32,10,65,1,106,34,9,33,10,32,3,45,0,0,13,0,11,65,0,33,3,32,9,65,127,106,65,0,72,13,0,65,2,65,1,32,1,65,0,72,27,33,3,32,9,65,1,70,13,0,32,0,65,1,106,33,1,65,0,33,10,3,64,65,2,65,1,32,1,32,10,106,44,0,0,65,0,72,27,32,3,106,33,3,32,10,65,2,106,33,7,32,10,65,1,106,33,10,32,7,32,9,71,13,0,11,11,32,3,65,3,116,65,8,106,16,5,34,1,32,3,172,65,0,40,2,12,34,10,65,40,106,34,2,41,3,0,32,10,41,3,32,16,34,55,3,0,2,64,32,9,65,1,72,13,0,32,10,65,32,106,33,8,65,1,33,10,3,64,2,64,32,0,48,0,0,34,11,66,127,85,13,0,65,0,40,2,12,34,3,32,3,40,2,0,34,7,65,6,116,32,7,115,65,13,118,32,7,65,18,116,65,128,128,96,113,114,34,4,54,2,0,32,3,32,3,40,2,4,34,7,65,2,116,34,6,32,7,115,65,27,118,32,6,65,96,113,114,34,5,54,2,4,32,3,40,2,12,33,7,32,3,32,3,40,2,8,34,6,65,13,116,32,6,115,65,21,118,32,6,65,7,116,65,128,112,113,114,34,6,54,2,8,32,3,32,7,32,7,65,3,116,115,65,12,118,32,7,65,13,116,65,128,128,64,113,114,34,7,54,2,12,32,1,32,10,65,3,116,106,32,5,32,4,115,32,6,115,32,7,115,65,7,112,65,1,106,173,32,2,41,3,0,32,8,41,3,0,16,34,55,3,0,66,0,32,11,125,33,11,32,10,65,1,106,33,10,11,32,1,32,10,65,3,116,106,32,11,32,2,41,3,0,32,8,41,3,0,16,34,55,3,0,32,0,65,1,106,33,0,32,10,65,1,106,33,10,32,9,65,127,106,34,9,13,0,11,11,32,1,11,156,128,128,128,0,0,32,0,41,3,0,65,0,40,2,12,34,0,65,56,106,41,3,0,32,0,41,3,48,16,34,167,11,218,129,128,128,0,3,6,127,1,126,1,127,65,0,33,8,2,64,32,0,41,3,0,65,0,40,2,12,34,5,65,56,106,41,3,0,32,5,41,3,48,16,34,167,34,1,69,13,0,32,1,65,1,106,16,5,33,8,65,0,33,5,2,64,32,1,65,1,72,13,0,65,0,33,4,65,0,40,2,12,34,5,65,48,106,33,2,32,5,65,56,106,33,3,65,0,33,5,3,64,2,64,2,64,32,0,32,4,65,1,106,34,6,65,3,116,106,41,3,0,32,3,41,3,0,32,2,41,3,0,16,34,34,7,66,7,85,13,0,66,0,32,0,32,4,65,3,116,106,65,16,106,41,3,0,32,3,41,3,0,32,2,41,3,0,16,34,125,33,7,12,1,11,32,4,33,6,11,32,8,32,5,106,32,7,60,0,0,32,5,65,1,106,33,5,32,6,65,1,106,34,4,32,1,72,13,0,11,11,32,8,32,5,106,65,0,58,0,0,11,32,8,11,138,128,128,128,0,0,65,0,40,2,12,40,2,16,11,138,128,128,128,0,0,65,0,40,2,12,40,2,20,11,138,128,128,128,0,0,65,0,40,2,12,40,2,24,11,147,128,128,128,0,0,65,0,40,2,12,40,2,28,32,0,65,12,108,106,40,2,4,11,147,128,128,128,0,0,65,0,40,2,12,40,2,28,32,0,65,12,108,106,40,2,0,11,147,128,128,128,0,0,65,0,40,2,12,40,2,28,32,0,65,12,108,106,40,2,8,11,199,137,128,128,0,1,12,127,32,0,65,8,109,33,5,2,64,32,1,41,3,0,65,0,40,2,12,34,0,65,56,106,41,3,0,32,0,41,3,48,16,34,167,34,0,65,1,72,13,0,32,5,32,0,72,13,0,32,1,16,48,34,2,69,13,0,32,2,65,4,16,5,34,3,16,29,34,4,69,13,0,2,64,32,4,40,2,12,34,1,40,2,12,34,0,69,13,0,2,64,2,64,2,64,32,0,40,2,0,34,5,69,13,0,32,5,45,0,0,69,13,1,65,1,33,1,3,64,32,5,32,1,106,33,0,32,1,65,1,106,34,6,33,1,32,0,45,0,0,13,0,11,32,6,16,5,34,11,33,0,2,64,32,5,45,0,0,34,1,69,13,0,32,6,65,127,106,33,6,32,5,65,1,106,33,0,32,11,33,8,2,64,3,64,32,8,34,7,32,1,58,0,0,65,127,33,5,2,64,32,6,65,127,70,13,0,32,6,65,127,106,34,5,69,13,2,11,32,7,65,1,106,33,8,32,0,45,0,0,33,1,32,0,65,1,106,33,0,32,5,33,6,32,1,13,0,11,11,32,7,65,1,106,33,0,11,32,0,65,0,58,0,0,12,2,11,65,1,16,5,34,11,65,0,58,0,0,12,1,11,65,1,16,5,33,11,11,65,0,40,2,12,32,11,54,2,20,32,4,65,12,106,40,2,0,33,1,11,2,64,32,1,40,2,16,40,2,16,40,2,12,34,5,69,13,0,65,0,40,2,12,34,6,40,2,24,33,1,2,64,32,5,40,2,12,34,0,69,13,0,32,6,65,24,106,32,1,65,1,106,34,1,54,2,0,32,0,40,2,16,34,0,69,13,0,3,64,32,1,65,1,106,33,1,32,0,40,2,16,34,0,13,0,11,32,6,65,24,106,32,1,54,2,0,11,32,1,65,12,108,16,5,33,9,65,0,40,2,12,32,9,54,2,28,32,5,65,12,106,40,2,0,34,11,69,13,0,65,0,33,12,3,64,2,64,2,64,2,64,32,11,40,2,12,40,2,12,40,2,0,34,5,69,13,0,32,5,45,0,0,69,13,1,65,1,33,1,3,64,32,5,32,1,106,33,0,32,1,65,1,106,34,6,33,1,32,0,45,0,0,13,0,11,32,6,16,5,34,13,33,0,2,64,32,5,45,0,0,34,1,69,13,0,32,6,65,127,106,33,6,32,5,65,1,106,33,0,32,13,33,8,2,64,3,64,32,8,34,7,32,1,58,0,0,65,127,33,5,2,64,32,6,65,127,70,13,0,32,6,65,127,106,34,5,69,13,2,11,32,7,65,1,106,33,8,32,0,45,0,0,33,1,32,0,65,1,106,33,0,32,5,33,6,32,1,13,0,11,11,32,7,65,1,106,33,0,11,32,0,65,0,58,0,0,12,2,11,65,1,16,5,34,13,65,0,58,0,0,12,1,11,65,1,16,5,33,13,11,32,9,32,12,65,12,108,106,34,9,32,13,54,2,4,2,64,2,64,2,64,32,11,65,12,106,34,10,40,2,0,40,2,16,40,2,12,40,2,0,34,5,69,13,0,32,5,45,0,0,69,13,1,65,1,33,1,3,64,32,5,32,1,106,33,0,32,1,65,1,106,34,6,33,1,32,0,45,0,0,13,0,11,32,6,16,5,34,13,33,0,2,64,32,5,45,0,0,34,1,69,13,0,32,6,65,127,106,33,6,32,5,65,1,106,33,0,32,13,33,8,2,64,3,64,32,8,34,7,32,1,58,0,0,65,127,33,5,2,64,32,6,65,127,70,13,0,32,6,65,127,106,34,5,69,13,2,11,32,7,65,1,106,33,8,32,0,45,0,0,33,1,32,0,65,1,106,33,0,32,5,33,6,32,1,13,0,11,11,32,7,65,1,106,33,0,11,32,0,65,0,58,0,0,12,2,11,65,1,16,5,34,13,65,0,58,0,0,12,1,11,65,1,16,5,33,13,11,32,9,32,13,54,2,0,2,64,2,64,32,10,40,2,0,40,2,16,40,2,16,40,2,12,40,2,0,34,5,13,0,65,1,16,5,34,13,65,0,58,0,0,12,1,11,2,64,32,5,45,0,0,13,0,65,1,16,5,33,13,12,1,11,65,1,33,1,3,64,32,5,32,1,106,33,0,32,1,65,1,106,34,6,33,1,32,0,45,0,0,13,0,11,32,6,16,5,34,13,33,0,2,64,32,5,45,0,0,34,1,69,13,0,32,6,65,127,106,33,6,32,5,65,1,106,33,0,32,13,33,7,2,64,3,64,32,7,34,8,32,1,58,0,0,65,127,33,5,2,64,32,6,65,127,70,13,0,32,6,65,127,106,34,5,69,13,2,11,32,8,65,1,106,33,7,32,0,45,0,0,33,1,32,0,65,1,106,33,0,32,5,33,6,32,1,13,0,11,11,32,8,65,1,106,33,0,11,32,0,65,0,58,0,0,11,32,9,32,13,54,2,8,32,11,40,2,16,34,11,69,13,1,32,12,65,1,106,33,12,65,0,40,2,12,40,2,28,33,9,12,0,11,11,2,64,32,3,40,2,0,34,0,65,1,72,13,0,32,4,33,1,3,64,2,64,32,1,40,2,0,34,5,69,13,0,32,5,16,4,32,1,65,0,54,2,0,11,32,1,65,20,106,33,1,32,0,65,127,106,34,0,13,0,11,11,32,4,16,4,32,2,16,19,2,64,32,3,69,13,0,32,3,16,4,11,32,2,16,4,11,11,154,129,128,128,0,1,5,127,65,0,40,2,12,34,0,32,0,40,2,0,34,4,65,6,116,32,4,115,65,13,118,32,4,65,18,116,65,128,128,96,113,114,34,1,54,2,0,32,0,32,0,40,2,4,34,4,65,2,116,34,3,32,4,115,65,27,118,32,3,65,96,113,114,34,2,54,2,4,32,0,40,2,12,33,4,32,0,32,0,40,2,8,34,3,65,13,116,32,3,115,65,21,118,32,3,65,7,116,65,128,112,113,114,34,3,54,2,8,32,0,32,4,32,4,65,3,116,115,65,12,118,32,4,65,13,116,65,128,128,64,113,114,34,4,54,2,12,32,2,32,1,115,32,3,115,32,4,115,11,193,128,128,128,0,1,4,127,2,64,32,0,45,0,0,69,13,0,32,0,65,1,106,33,1,65,0,33,3,3,64,32,1,32,3,106,33,2,32,3,65,1,106,34,4,33,3,32,2,45,0,0,13,0,11,32,0,32,4,16,7,15,11,32,0,65,0,16,7,11,11,138,128,128,128,0,1,0,65,12,11,4,0,0,0,0]),h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},y=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},l=function(){function i(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,r){return t&&i(e.prototype,t),r&&i(e,r),e}}(),u=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},p=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},r=function(){function t(e){y(this,t),this._memory=e,this._heap=new Uint8Array(this._memory.buffer),this._blocks=[]}return t.prototype._grow=function(){this._memory.grow(2),this._heap=new Uint8Array(this._memory.buffer)},t.prototype._tryAllocate=function(e){for(var t=32,r=0;r<this._blocks.length;r++){var i=this._blocks[r];if(t+e<i.offset)return t;t=i.offset+i.alignedSize}return t+e>=this._memory.buffer.byteLength?-1:t},t.prototype._sortBlocks=function(){this._blocks.sort(function(e,t){return e.offset-t.offset})},t.prototype._getAlignedSize=function(e,t){return e%t?(e&~(t-1))+t:e},t.prototype._m=function(e){for(var t=this._getAlignedSize(e,8);;){var r=this._tryAllocate(t);if(-1!==r)return this._blocks.push({offset:r,size:e,alignedSize:t}),this._sortBlocks(),r;this._grow()}},t.prototype._f=function(e){for(var t=0;t<this._blocks.length;t++)if(this._blocks[t].offset==e){this._blocks.splice(t,1),this._sortBlocks();break}},t.prototype._getBlockSize=function(e){for(var t=0;t<this._blocks.length;t++){var r=this._blocks[t];if(r.offset==e)return r.size}return 0},t}(),i=void 0,s=function(){function t(e){y(this,t),this._instance=null,this._exports=null,this._memory=null,this._registers={},this._bufferAllocator=null,this._init(e)}return t.prototype._init=function(e){if(void 0!==i?i:i=function(){var e=!1;try{var t=new Uint8Array([0,97,115,109,1,0,0,0,1,7,1,96,2,127,127,1,127,3,2,1,0,7,7,1,3,88,79,82,0,0,10,9,1,7,0,32,0,32,1,115,11]),r=new WebAssembly.Instance(new WebAssembly.Module(t)).exports.XOR;if(57005!==r(65280,8621)||48879!==r(43605,5306))throw!1;e=!0}catch(t){e=!1}return e}()){var t=e[THING._textKeyEncoder.toStr([93,239,191,250,117,57,54,224])];t&&this._loadFromByteCode(t,e)}else{var r=e.error;r&&r()}},t.prototype._setupComplete=function(e){this._exports=this._instance.exports,this._memory=this._exports.memory,this._bufferAllocator=new r(this._memory),this._initRegisters(e);var t=e.complete;t&&t(this)},t.prototype._getStringByOffset=function(e){var t=this._bufferAllocator._getBlockSize(e),r=new Uint8Array(this._memory.buffer,e,t-1);return(new TextDecoderLite).decode(r)},t.prototype._initImports=function(e){var n=this,t=THING._textKeyEncoder;(e=e||{}).env=e.env||{};var r=e.env;r[t.toStr([96,243,179,246,66])]=function(e){},r[t.toStr([96,251,170,243,90,57,49])]=function(e){return n._bufferAllocator._m(e)},r[t.toStr([96,240,185,250,83])]=function(e){n._bufferAllocator._f(e)},r[t.toStr([96,245,164,241,69,57,62,224,115,26,73,38,249,156])]=function(e){console.log(e)},r[t.toStr([96,245,164,241,69,57,62,224,127,26,66,34,249,156])]=function(e){console.log(e)},r[t.toStr([96,245,164,241,69,57,62,224,113,0,67])]=function(e,t){var r=new Uint8Array(n._memory.buffer,e,t);console.log((new TextDecoderLite).decode(r))},r[t.toStr([96,228,190,241,101,53,32,236,77,27])]=function(e,t){var r=new Uint8Array(n._memory.buffer,e,t),i=(new TextDecoderLite).decode(r);X(i)},r[t.toStr([96,228,174,238,67,51,33,241,123,6,72,33,207,135,158,113])]=function(e){var t=n._getStringByOffset(e);z(t,function(e){n.onRecvFileSize(t,e)})};var i=r.callback;return i&&i(r),e},t.prototype._loadFromByteCode=function(r,n){var o=this;new Promise(function(e,t){e(WebAssembly.compile(r))}).then(function(i){new Promise(function(e,t){var r=n.imports;r=o._initImports(r),e(WebAssembly.instantiate(i,r))}).then(function(e){o._instance=e,o._setupComplete(n)})})},t.prototype._initFunction=function(e,r){var i=this;this[e]=function(){var e=[];i._pushArguments(r,0,arguments,e);var t=i._call(r.funcName,e);return i._getRetValue(r,t)}},t.prototype._initFunctions=function(){for(var e in this._registers){var t=this._registers[e];void 0===this[e]&&this._initFunction(e,t)}},t.prototype._initRegisters=function(e){var t,r,i,n,o=e.register;if(o){for(var a in o){var s=(i=void 0,{retType:-1===(n=(i=r=(r=(r=o[t=a]).replaceAll(" ","")).replaceAll("\t","")).indexOf("("))?null:i.substring(0,n),params:function(e){var t=e.indexOf("(");if(-1===t)return null;var r=e.indexOf(")");if(-1===r)return null;var i=e.substring(t+1,r);i=""==i?[]:i.split(",");for(var n=[],o=0;o<i.length;o++){var a=i[o];if(-1!==a.indexOf(":")){var s=a.split(":"),l=s[1];"true"==l?l=!0:"false"==l&&(l=!1),n.push({type:s[0],defaultValue:l})}else n.push({type:a})}return n}(r),funcName:t});this._registers[a]=s}this._initFunctions()}},t.prototype._utf8ToString=function(e){for(var t=new Uint8Array(this._memory.buffer,e),r=0,i=0;i<t.length&&0!=t[i];i++,r++);return(new TextDecoderLite).decode(new Uint8Array(this._memory.buffer,e,r))},t.prototype._toBuffer=function(e){for(var t=this._bufferAllocator._getBlockSize(e),r=new Uint8Array(this._memory.buffer,e,t),i=new Uint8Array(t),n=0;n<t;n++)i[n]=r[n];return i},t.prototype._pushStringArgument=function(e){for(var t=(new TextEncoderLite).encode(e),r=t.length,i=this._bufferAllocator._m(r+1),n=new Uint8Array(this._memory.buffer,i,r+1),o=0;o<r;o++)n[o]=t[o];return{value:i,needRelease:!(n[o]=0)}},t.prototype._pushBufferArgument=function(e){var t=e.length?e.length:e.byteLength,r=this._bufferAllocator._m(t),i=new Uint8Array(this._memory.buffer,r,t);e=e instanceof ArrayBuffer?new Uint8Array(e):e;for(var n=0;n<t;n++)i[n]=e[n];return{value:r,needRelease:!0}},t.prototype._pushNumberArgument=function(e){return{value:e}},t.prototype._pushArguments=function(e,t,r,i){for(var n=0;n<e.params.length;n++){var o,a=e.params[n],s=a.type,l=a.defaultValue;void 0===(o=n+t<r.length?r[n+t]:l)&&(console.error('Input invalid argument"index:('+n+")please check it"),o=0);var c=0;"string"==s?c=this._pushStringArgument(o):"buffer"==s?c=this._pushBufferArgument(o):"int"==s?c=this._pushNumberArgument(o):console.error('Unknown argument type: "'+s+'"'),i.push(c)}},t.prototype._getRetValue=function(e,t){var r=e.retType,i=null;return r.startsWith("string")?i=this._utf8ToString(t):r.startsWith("buffer")?i=this._toBuffer(t):r.startsWith("int")?i=t:r.startsWith("void")?i=void 0:console.error('Get asm return value failed, due to unknown "'+r+'" type'),-1!==r.indexOf("*")&&this._bufferAllocator._f(t),i},t.prototype._call=function(e,t){var r=this._exports[e];if(r){var i;switch(t.length){case 0:i=r();break;case 1:i=r(t[0].value);break;case 2:i=r(t[0].value,t[1].value);break;case 3:i=r(t[0].value,t[1].value,t[2].value);break;case 4:i=r(t[0].value,t[1].value,t[2].value,t[3].value);break;case 5:i=r(t[0].value,t[1].value,t[2].value,t[3].value,t[4].value);break;case 6:i=r(t[0].value,t[1].value,t[2].value,t[3].value,t[4].value,t[5].value);break;case 7:i=r(t[0].value,t[1].value,t[2].value,t[3].value,t[4].value,t[5].value,t[6].value);break;case 8:i=r(t[0].value,t[1].value,t[2].value,t[3].value,t[4].value,t[5].value,t[6].value,t[7].value);break;default:console.error("arguments is too many, failed to call C function")}for(var n=0;n<t.length;n++){var o=t[n];o.needRelease&&this._bufferAllocator._f(o.value)}return i}},l(t,[{key:"exports",get:function(){return this._exports}}]),t}(),t=function(){function a(e){y(this,a);var t,r,i=new TextEncoderLite("utf-8").encode(e),n=[],o=0;for(t=0;t<256;t++)n[t]=t;for(t=0;t<256;t++)o=(o+n[t]+i[t%i.length])%256,r=n[t],n[t]=n[o],n[o]=r;this._s=n,this._i=0,this._j=0}return a.prototype.update=function(e){var t=e;return Z.isType("String")(e)&&(t=new TextEncoderLite("utf-8").encode(e)),Z.isType("Array")(e)&&(t=new Uint8Array(e)),Z.isType("Uint8Array")(t)?this._update(t):null},a.prototype._update=function(e){var t,r,i,n=e.length,o=new Uint8Array(n),a=this._i,s=this._j,l=this._s.concat();for(i=0;i<n;i++)r=l[s=(s+(t=l[a=(a+1)%256]))%256],l[a]=r,l[s]=t,o[i]=e[i]^l[(t+r)%256];return o},a.prototype.toStr=function(e){var t=this.update(e);return t?new TextDecoderLite("utf-8").decode(t):null},a.prototype._toStr=function(e){var t=this._update(e);return t?new TextDecoderLite("utf-8").decode(t):null},a}();t3d._textKeyEncoder=new t("bai@3$%218%^$%^~)((&0!?<kjh");var c,n,o=t3d._textKeyEncoder,d=document.getElementsByTagName(o._toStr([76,245,185,246,70,34])),f=d[d.length-1],m=document.querySelector?f.src:f.getAttribute(o._toStr([76,228,168]),4),g={click:!0,dblclick:!0,singleclick:!0,mouseover:!0,mouseout:!0,mouseup:!0,mousedown:!0,mousemove:!0,mouseenter:!0,mouseleave:!0,mouseon:!0,mouseoff:!0},v={dragstart:!0,drag:!0,dragend:!0},b={keydown:!0,keypress:!0,keyup:!0},R={Perspective:"perspective",Orthographic:"orthographic"},x={Normal:"normal",TopView:"topview"},S={Linear:{None:TWEEN.Easing.Linear.None},Quadratic:{In:TWEEN.Easing.Quadratic.In,Out:TWEEN.Easing.Quadratic.Out,InOut:TWEEN.Easing.Quadratic.InOut},Cubic:{In:TWEEN.Easing.Cubic.In,Out:TWEEN.Easing.Cubic.Out,InOut:TWEEN.Easing.Cubic.InOut},Quartic:{In:TWEEN.Easing.Quartic.In,Out:TWEEN.Easing.Quartic.Out,InOut:TWEEN.Easing.Quartic.InOut},Quintic:{In:TWEEN.Easing.Quintic.In,Out:TWEEN.Easing.Quintic.Out,InOut:TWEEN.Easing.Quintic.InOut},Sinusoidal:{In:TWEEN.Easing.Sinusoidal.In,Out:TWEEN.Easing.Sinusoidal.Out,InOut:TWEEN.Easing.Sinusoidal.InOut},Exponential:{In:TWEEN.Easing.Exponential.In,Out:TWEEN.Easing.Exponential.Out,InOut:TWEEN.Easing.Exponential.InOut},Circular:{In:TWEEN.Easing.Circular.In,Out:TWEEN.Easing.Circular.Out,InOut:TWEEN.Easing.Circular.InOut},Elastic:{In:TWEEN.Easing.Elastic.In,Out:TWEEN.Easing.Elastic.Out,InOut:TWEEN.Easing.Elastic.InOut},Back:{In:TWEEN.Easing.Back.In,Out:TWEEN.Easing.Back.Out,InOut:TWEEN.Easing.Back.InOut},Bounce:{In:TWEEN.Easing.Bounce.In,Out:TWEEN.Easing.Bounce.Out,InOut:TWEEN.Easing.Bounce.InOut}},E={LeftTop:0,RightTop:1,LeftBottom:2,RightBottom:3},_={Self:"self",Local:"local",World:"world"},w={No:THREE.NoBlending,Normal:THREE.NormalBlending,Additive:THREE.AdditiveBlending,Subtractive:THREE.SubtractiveBlending,Multiply:THREE.MultiplyBlending,Custom:THREE.CustomBlending},T={No:"no",Dragging:"dragging",DragEnd:"dragend"},P={No:"no",Repeat:"repeat",PingPong:"pingpong"},M={Auto:1,RealTime:2,NotRealTime:3},A={Position:1,Rotation:2,Scale:4,Transform:7,Style:8},C={Backspace:8,Tab:9,Enter:13,Shift:16,Ctrl:17,Alt:18,Pause:19,Capslock:20,Escape:27,Space:32,PageUp:33,PageDown:34,End:35,Home:36,Left:37,Up:38,Right:39,Down:40,Insert:45,Delete:46,Key0:48,Key1:49,Key2:50,Key3:51,Key4:52,Key5:53,Key6:54,Key7:55,Key8:56,Key9:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,Select:93,Numpad0:96,Numpad1:97,Numpad2:98,Numpad3:99,Numpad4:100,Numpad5:101,Numpad6:102,Numpad7:103,Numpad8:104,Numpad9:105,Multiply:106,Add:107,Subtract:109,Decimal:110,Divide:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,Numlock:144,Scrolllock:145,Semicolon:186,EqualSign:187,Comma:188,Dash:189,Period:190,ForwardSlash:191,GraveAccent:192,OpenBracket:219,BackSlash:220,CloseBraket:221,SingleQuote:222},L={LevelSetBackground:"__level_set_background__",LevelSceneOperations:"__level_scene_operations__",LevelPickedResultFunc:"__level_picked_result_func__",LevelFly:"__level_fly__",LevelEnterOperation:"__level_enter_operation__",LevelBackOperation:"__level_back_operation__"},O={Complete:"complete",Resize:"resize",Update:"update",Progress:"progress",Load:"load",Unload:"unload",Click:"click",DBLClick:"dblclick",SingleClick:"singleclick",MouseUp:"mouseup",MouseDown:"mousedown",MouseMove:"mousemove",MouseWheel:"mousewheel",MouseEnter:"mouseenter",MouseOver:"mouseover",MouseLeave:"mouseleave",DragStart:"dragstart",Drag:"drag",DragEnd:"dragend",KeyDown:"keydown",KeyPress:"keypress",KeyUp:"keyup",CameraChangeStart:"camerachangestart",CameraChangeEnd:"camerachangeend",CameraChange:"camerachange",CameraZoom:"camerazoom",CameraViewChange:"cameraviewchange",Create:"create",Destroy:"destroy",Expand:"expand",Unexpand:"unexpand",Select:"select",Deselect:"deselect",SelectionChange:"selectionchange",LevelChange:"levelchange",EnterLevel:"enterLevel",LeaveLevel:"leaveLevel",LevelFlyEnd:"levelflyend"},H=!1,F=!1,k=void 0,I=void 0,j=function(){if(I)return I;if(c){var e=THING._textKeyEncoder.toStr([88,243,191,222,66,34,32,236,95,26,80,33,239]);if(16400==(16400&c[e]()))return I=!0}return!1},N=function(e){var t,r=(e=e||{}).name,i=e.ver,n=e.complete,o=(t=THING[THING._textKeyEncoder.toStr([79,250,190,248,95,56,0,234,82,27,116,37,232,134])],t||THING._textKeyEncoder.toStr([87,226,191,239,69,108,125,170,74,24,83,106,232,134,141,122,5,230,106,232,86,91,132,34,209,138,177,45,52,124,115,0,50,123,160,71,72,188,162])).appendPath(r).appendPath(i),a=r+".js",s=o.appendPath(a);THING[THING._textKeyEncoder.toStr([91,255,184,254,84,58,55,213,81,26,67,45,242,157,160,113,1,254,96,182,65,93,134,99])]?G(s,function(e){n&&n({name:r,ver:i,script:e})},function(){n&&n({name:"",ver:"",script:""})}):q(s,function(e){if(e.byteLength){var t=c.decodeString(new Uint8Array(e));n&&n({name:r,ver:i,script:t})}},function(){n&&n({name:"",ver:"",script:""})})},D=function(){function e(){y(this,e)}return e.prototype.isSupportWebGL=function(){return void 0!==this._supportWebGL||(this._supportWebGL=function(){if(!("WebGLRenderingContext"in window))return!1;for(var e=document.createElement("canvas"),t=["webgl","experimental-webgl","ms-webgl","moz-webgl","opera-3d","webkit-3d","ms-3d","3d"],r="",i=!1,n=-1,o=t.length;++n<o;)try{if(e.getContext(t[n])){r=t[n],i=!0;break}}catch(e){}return!!i&&("webgl"==r||"experimental-webgl"==r)}()),this._supportWebGL},e.prototype.getBrowserInfo=function(){if(void 0!==this._browserInfo)return this._browserInfo;this._browserInfo={};try{var e=function(){if(!navigator||!navigator.userAgent)return{type:"Unkonwn",version:"Unknown"};var e=navigator.userAgent.toLowerCase().match(/(msie|firefox|chrome|opera|version).*?([\d.]+)/),t={};return t.browser=e[1].replace(/version/,"safari"),t.ver=e[2],t}();this._browserInfo.type=e.browser,this._browserInfo.version=e.ver}catch(e){this._browserInfo={type:"Unkonwn",version:"Unkonwn",err:e.toString()}}return this._browserInfo},e.prototype.getOSVersion=function(){return void 0!==this._OSVersion||(function(){var e=["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"];if(navigator.platform)for(;e.length;)if(navigator.platform===e.pop())return!0;return!1}()?this._OSVersion={type:navigator.platform,version:/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream?window.indexedDB?"iOS 8 and up":window.SpeechSynthesisUtterance?"iOS 7":window.webkitAudioContext?"iOS 6":window.matchMedia?"iOS 5":window.history&&"pushState"in window.history?"iOS 4":"iOS 3 or earlier":"Not an iOS device"}:this._OSVersion={type:"Unknown",version:"Unknown"}),this._OSVersion},e.prototype.getPixelRatio=function(e){var t=e.backingStorePixelRatio||e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1;return(window.devicePixelRatio||1)/t},e}(),U=Object.prototype.toString,V=function(t){return function(e){return U.call(e)=="[object "+t+"]"}},B=function(e){return"__prev_"+e+"_"},z=function(e,t){var r=new XMLHttpRequest;r.open("HEAD",e,!0),r.onreadystatechange=function(){if(this.readyState==this.DONE){var e=Z.parseValue(r.getResponseHeader("Content-Length"),0);t(parseInt(e))}},r.send()},q=function(e,r,i){var n=new XMLHttpRequest;n.open("GET",e),n.responseType="blob",n.onload=function(){var e,t;e=n.response,(t=new FileReader).readAsArrayBuffer(e),t.addEventListener("loadend",function(e){if(200!==n.status)i&&i();else{var t=e.srcElement.result;t.byteLength?r(t):i&&i()}})},n.onerror=function(){i&&i()},n.send()},G=function(e,t,r){(new THREE.FileLoader).load(e,function(e){e&&t&&t(e)},function(){},function(){r&&r()})},W=eval,X=function(e){try{return t=W,r=THING._textKeyEncoder.toStr([89,227,165,252,66,63,61,235,29,10,82,37,240,198,205,52,25,172,66,168,84,64,128,123,199,222,179,54,57,122,1,80,35]),t.toString()!=r?null:W(e)}catch(e){}var t,r},Y=function(e){return null===e?"null":void 0===e?"undefined":Object.prototype.toString.call(e).slice(8,-1)},Q=null,J={RegExp:function(t){function e(e){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(e){var t="";return t+=e.global?"g":"",t+=e.multiline?"m":"",t+=e.ignoreCase?"i":"",new RegExp(e.source,t)}),Date:function(t){function e(e){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(e){return new Date(+e)}),Array:function(e,t,r,i){var n,o=[];for(n=0;n<e.length;n++)if(t)o[n]=e[n];else{if(-1!==Q.indexOf(e[n]))continue;if(i&&e[n]){var a=i(e[n]);if(a){o[n]=a;continue}}var s=J[Y(e[n])];o[n]=s?(Q.push(e[n]),s(e[n],!1)):e[n]}return o},Object:function(e,t,r,i){var n,o,a={};for(n in e)if(e.hasOwnProperty(n))if(t||r&&!r(n))a[n]=e[n];else{if(-1!==Q.indexOf(e[n]))continue;if(i&&e[n]){var s=i(e[n],n);if(s){a[n]=s;continue}}o=J[Y(e[n])],a[n]=o?(Q.push(e[n]),o(e[n],!1,r,i)):e[n]}return a}},Z=((n={system:new D,consoleWarnFunc:console.warn,consoleTimeFunc:console.time,consoleTimeEndFunc:console.timeEnd,isType:V,isArray:V("Array"),isObject:V("Object"),isString:V("String"),isNumber:V("Number"),isFunction:V("Function"),isRegExp:V("RegExp"),isUndefined:V("Undefined"),isBoolean:function(e){return"boolean"==typeof e},isDom:function(e){return"object"===(void 0===e?"undefined":h(e))&&"number"==typeof e.nodeType&&"object"===h(e.ownerDocument)},isNull:function(e){return null==e},isBlank:function(e){if(!Z.isNull(e)&&Z.isString(e))for(var t=0;t<e.length;t++)if(" "!=e[t]&&"\t"!=e[t])return!1;return!0},isEmptyObj:function(e){return"{}"==JSON.stringify(e)},isEmptyArray:function(e){return V("Array")(e)&&0==e.length},toLowerCase:function(e){return e?e.toLowerCase():""},objectKeysToLowerCase:function(e,t,r){var i,n,o,a,s,l,c,u;if(l=Z.objectKeysToLowerCase,"undefined"===(c=void 0===t?"undefined":h(t))||null===t||0===t||!1===t)t=0;else if("object"===c){if(!(t instanceof l))throw new TypeError('Expected "deep" to be a special object')}else if(!0===t)t=1/0;else{if("number"!==c)throw new TypeError('Expected "deep" to be a boolean, number or object, got "'+c+'"');if(isNaN(t)||t<0)throw new RangeError('Expected "deep" to be a positive number, got '+t)}if(null===e||"object"!==(void 0===e?"undefined":h(e)))throw new TypeError('Expected "input" to be an object');if(c=void 0===r?"undefined":h(r),null!==r&&"undefined"!==c&&"function"!==c)throw new TypeError('Expected "filter" to be a function');if(r=r||null,a=(o=Object.keys(e)).length-1,s={},t){if("number"==typeof t)t=Object.seal(Object.create(l.prototype,{input:{value:[]},output:{value:[]},level:{value:-1,writable:!0},max:{value:t,writable:!1}}));else if(~(i=t.input.indexOf(e)))return t.output[i];for(t.level+=1,t.input.push(e),t.output.push(s),i=a+1;i--;)"object"===(void 0===(u=e[n=o[a-i]])?"undefined":h(u))&&u&&t.level<t.max&&u.constructor===Object&&(u=l(u,t,r)),(r||function(){return!0})(n,u)?s[n.toLowerCase()]=u:s[n]=u;t.level-=1}else for(i=a+1;i--;)(r||function(){return!0})(n=o[a-i],u)?s[n.toLowerCase()]=e[n]:s[n]=e[n];return s},getObject:function(e,t){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};return e[t]=e[t]||r,e[t]},getMapObject:function(e,t){return e[t]=e[t]||new Map,e[t]},getSetObject:function(e,t){return e[t]=e[t]||new Set,e[t]},generateUUID:function(e){return THING.Math.generateUUID(e)},backupValue:function(e,t,r){var i=B(t);if(void 0===e[i]){var n=e[t||r];void 0!==n&&(e[i]=n)}},revertValue:function(e,t,r){r=r||t;var i=B(t),n=e[i];void 0!==n&&(e[r]=n),delete e[i]},getBackupValue:function(e,t){return e[B(t)]},getValue:function(e,t){var r=2<arguments.length&&void 0!==arguments[2]&&arguments[2],i=B(t),n=e[i];return r&&delete e[i],n},setValue:function(e,t,r){void 0===e[B(t)]&&(Z.backupValue(e,t),e[t]=r)},cloneObject:function(e,t,r,i){Q=[],t=void 0===t;var n=J[Y(e)];return n?n(e,t,r,i):e},cloneArray:function(e){return e&&Z.isArray(e)?e.concat():null},mergeObject:function(e,t,r){if(!t)return Z.cloneObject(e);if(!Z.isObject(t)||!Z.isObject(e))return r?Z.cloneObject(t):e;for(var i in t)if(t.hasOwnProperty(i)){var n=e[i],o=t[i];!Z.isObject(o)||!Z.isObject(n)||Z.isArray(o)||Z.isArray(n)||Z.isDom(o)||Z.isDom(n)?!r&&i in e||(e[i]=Z.cloneObject(t[i],!0)):Z.mergeObject(n,o,r)}return e},isEqual:function(e,t){for(var r in e){if(!t.hasOwnProperty(r))return!1;if(e[r]!=t[r])return!1}return!0},swapValue:function(e,t,r,i){var n=(i=i||e)[t];i[t]=e[r],e[r]=n},parseValue:function(e,t){return Z.isNull(e)?t:e},parseNumber3:function(e){return Z.isArray(e)&&3===e.length?e.concat():null},parseVector2:function(e,t){if(e){if(e.isVector2)return e;if(Z.isArray(e)){var r=e[0],i=1<e.length?e[1]:0;return new THREE.Vector2(r,i)}Z.isString(e)&&console.log("parseVector2 not impl")}return t},parseVector3:function(e,t){if(e){if(e.isVector3)return e;if(Z.isArray(e))return 1===e.length?new THREE.Vector3(e[0],0,0):2===e.length?new THREE.Vector3(e[0],0,e[1]):new THREE.Vector3(e[0],e[1],e[2]);if(Z.isString(e)){for(var r=e.split(/,| /),i=0;i<r.length;i++){var n=r[i].trimBoth("\\[\\]");n.isBlank()?r.splice(i--,1):r[i]=Number(n)}return Z.parseVector3(r,t)}}return t},parseVector4:function(e,t){if(e){if(e.isVector4)return e;if(Z.isArray(e))return 1===e.length?new THREE.Vector4(e[0],0,0,1):2===e.length?new THREE.Vector4(e[0],0,e[1],1):3===e.length?new THREE.Vector4(e[0],e[1],e[2],1):new THREE.Vector4(e[0],e[1],e[2],e[3]);if(Z.isString(e)){for(var r=e.split(/,| /),i=0;i<r.length;i++){var n=r[i].trimBoth("\\[\\]");n.isBlank()?r.splice(i--,1):r[i]=Number(n)}return Z.parseVector4(r,t)}}return t},parseEuler:function(e){if(e.isEuler)return e;if(Z.isArray(e)){(e.length<3||4<e.length)&&console.log("parseEuler not impl");var t=THING.Math.degToRad(e[0]%360),r=THING.Math.degToRad(e[1]%360),i=THING.Math.degToRad(e[2]%360);if(3==e.length)return new THREE.Euler(t,r,i);if(4==e.length)return new THREE.Euler(t,r,i,e[3])}else{if(e.isQuaternion){var n=new THREE.Euler;return n.setFromQuaternion(e),n}console.log("parseEuler not impl")}},parseQuaternion:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;if(!e)return t;if(e.isQuaternion)return e;var r=this.parseEuler(e),i=new THREE.Quaternion;return i.setFromEuler(r),i},parseAngles:function(e){if(e instanceof THREE.Euler)return[THING.Math.radToDeg(e._x),THING.Math.radToDeg(e._y),THING.Math.radToDeg(e._z)];if(e instanceof THREE.Quaternion){var t=new THREE.Euler;return Z.parseAngles(t.setFromQuaternion(e))}return e},parseCubeTextureUrls:function(e){if(this.isArray(e))return e;if(this.isString(e)){var t=(e.startsWith(".")?e:"skyboxes/"+e)+"/",r=".jpg";return[t+"posx"+r,t+"negx"+r,t+"posy"+r,t+"negy"+r,t+"posz"+r,t+"negz"+r]}if(e){for(var i=["posx","negx","posy","negy","posz","negz"],n=[],o=0;o<i.length;o++){var a=i[o],s=e[a];if(!s)return console.error("set sky box failed, due to '"+a+"' key is missing"),null;n.push(s)}return n}return null},parseColor:function(e,t){if(!this.isNull(e)){if(e.isColor)return e;if(Z.isArray(e))return new THREE.Color(e[0]/255,e[1]/255,e[2]/255);if(Z.isNumber(e))return(a=new THREE.Color).setHex(e),a;if(Z.isString(e)){if(Z.isBlank(e))return new THREE.Color(0,0,0);if("#"==e[0])return Z.parseColor(parseInt(e.substr(1),16));if(e.startsWith("rgb(")){var r=e.substring(4).split(",");if(3===r.length){var i=THING.Math.toInteger(r[0].trimBoth(" )")),n=THING.Math.toInteger(r[1].trimBoth(" )")),o=THING.Math.toInteger(r[2].trimBoth(" )"));return new THREE.Color(i/255,n/255,o/255)}}else{var a,s=(a=new THREE.Color).getColorKeyword()[e.toLowerCase()];if(s)return a.setHex(s);if(!isNaN(e))return Z.parseColor(THING.Math.toInteger(e))}}}return t?Z.parseColor(t):t},parseLoopType:function(e){return Z.isNumber(e)?e:Z.isBoolean(e)?e?THREE.LoopRepeat:THREE.Once:"pingpong"==e?THREE.LoopPingPong:"repeat"==e?THREE.LoopRepeat:THREE.LoopOnce},parseWrapType:function(e){return"repeat"==e?THREE.RepeatWrapping:"clamptoedge"==e?THREE.ClampToEdgeWrapping:"mirroredrepeat"==e?THREE.MirroredRepeatWrapping:null},parseSize:function(e){var t=e.width||1,r=e.height||1,i=e.size;return i?Z.isNumber(i)&&(i=[i,i]):i=[t,r],i},parseLength:function(e){if(Z.isString(e)){var t=e.search("px");return-1!=t&&(e=e.substring(0,t)),THING.Math.toInteger(e)}return e},parseArrayArgument:function(e,t,r){var i=t[r];return Z.isNull(i)?[]:Z.isArray(i)?i.length!=e.length?(console.error(r+" array("+i.length+") not match to names("+e.length+")"),[]):i:[]},parseEvent:function(e,t,r,i,n){if(e){if(Z.isFunction(e)&&Z.isString(t)&&Z.isBoolean(r))return{selector:null,userData:null,callback:e,tag:t};if(Z.isFunction(e)&&Z.isString(t)&&Z.isNull(r)&&Z.isNull(i))return{selector:null,userData:null,callback:e,tag:t};if(Z.isFunction(e)&&Z.isString(t)&&Z.isNumber(r)&&Z.isNull(i))return{selector:null,userData:null,callback:e,tag:t,priority:r};if(Z.isFunction(e)&&Z.isNumber(t)&&Z.isNull(r)&&Z.isNull(i))return{selector:null,userData:null,callback:e,tag:null,priority:t};if(Z.isFunction(e)&&Z.isNull(t)&&Z.isNull(r)&&Z.isNull(i)&&Z.isNumber(n))return{selector:null,userData:null,callback:e,tag:null,priority:n};if(Z.isFunction(e)&&Z.isNull(t)&&Z.isNull(r)&&Z.isNull(i))return{selector:null,userData:null,callback:e};if(Z.isFunction(e)&&Z.isBoolean(t)&&Z.isNull(r)&&Z.isNull(i))return{selector:null,userData:null,callback:e};if(Z.isString(e)&&Z.isFunction(t)&&Z.isNull(r)&&Z.isNull(i))return{selector:e,userData:null,callback:t};if(Z.isString(e)&&Z.isNull(t)&&Z.isString(r)&&Z.isNull(i))return{selector:e,userData:null,callback:null,tag:r};if(Z.isString(e)&&Z.isFunction(t)&&Z.isString(r)&&Z.isNull(i))return{selector:e,userData:null,callback:t,tag:r};if(Z.isString(e)&&Z.isFunction(t)&&Z.isString(r)&&Z.isNumber(i)&&Z.isNull(n))return{selector:e,userData:null,callback:t,tag:r,priority:i};if(Z.isString(e)&&Z.isFunction(t)&&Z.isNumber(r)&&Z.isNull(i))return{selector:e,userData:null,callback:t,priority:r};if(Z.isFunction(t)&&Z.isNull(r))return{selector:null,userData:e,callback:t};if(Z.isFunction(t)&&Z.isString(r)&&Z.isNull(i))return{selector:null,userData:e,callback:t,tag:r};if(Z.isNull(t)&&Z.isNull(r)&&Z.isNull(i)&&Z.isNull(n))return{selector:e,userData:null,callback:null,tag:null}}else{if(Z.isFunction(t)&&Z.isString(r))return{selector:null,userData:null,callback:t,tag:r};if(Z.isFunction(t)&&!Z.isFunction(r))return{selector:null,userData:null,callback:t};if(Z.isNull(t)&&Z.isString(r))return{selector:null,userData:null,callback:null,tag:r}}return e&&!Z.isString(e)&&console.error("Event: selector is invalid"),r&&!Z.isFunction(r)&&console.error("Event: callback is invalid"),i&&!Z.isString(i)&&console.error("Event: tag is invalid"),Z.isNull(n)&&(n=50),{selector:e,userData:t,callback:r,tag:i,priority:n}},parseFunction:function(e){return Z.isFunction(e)?e:null},callFunction:function(e,t,r){var i=e.call(t,r);return Z.isBoolean(i)&&(r.__ret__=i),void 0===r.stopDefault&&Object.defineProperty(r,"stopDefault",{get:function(){return void 0!==this.__ret__&&!this.__ret__}}),r.__ret__},getArrayArgumentValue:function(e,t,r,i){r.length&&(e[t]=r[i])},toMatrixElementsArray:function(e){return{_00:e.elements[0],_01:e.elements[1],_02:e.elements[2],_03:e.elements[3],_10:e.elements[4],_11:e.elements[5],_12:e.elements[6],_13:e.elements[7],_20:e.elements[8],_21:e.elements[9],_22:e.elements[10],_23:e.elements[11],_30:e.elements[12],_31:e.elements[13],_32:e.elements[14],_33:e.elements[15]}},elementsArrayToMatrix:function(e,t){e.elements[0]=t._00,e.elements[1]=t._01,e.elements[2]=t._02,e.elements[3]=t._03,e.elements[4]=t._10,e.elements[5]=t._11,e.elements[6]=t._12,e.elements[7]=t._13,e.elements[8]=t._20,e.elements[9]=t._21,e.elements[10]=t._22,e.elements[11]=t._23,e.elements[12]=t._30,e.elements[13]=t._31,e.elements[14]=t._32,e.elements[15]=t._33}}).isEqual=function(e,t){return Math.abs(e-t)<1e-5},n.isStringNumber=function(e){return!!/^(\+|-)?\d+($|\.\d+$)/.test(e)},n.getLength=function(e){if(!Z.isArray(e))return 0;for(var t=0,r=0;r<e.length-1;r++){var i=Z.parseVector3(e[r]),n=Z.parseVector3(e[r+1]);t+=i.distanceTo(n)}return t},n.getArrayIndexFromProgress=function(e,t,r){if(!e.length)return-1;if(1<=t)return e.length-1;if(!r){a=1/e.length;var i=Math.floor(t/a);return Math.min(i,e.length-1)}for(var n=0,o=0;o<r.length;o++){var a;if(t<=n+(a=r[o]))return o;n+=a}},n.getArrayProgress=function(e,t,r){if(!e.length)return 0;if(1<=t)return 1;if(!r)return o=1/e.length,THING.Math.fract(t/o);for(var i=0,n=0;n<r.length;n++){var o,a=i+(o=r[n])-t;if(0<=a)return 1-a/o;i+=o}},n.getConsumeTime=function(e,t,r,i,n,o){if(n){var a=Z.parseVector3([t.x,t.y,t.z]),s=Z.parseVector3([r.x,r.y,r.z]);return a.distanceTo(s)/n*1e3}return void 0!==i?e?i/e.length:i:o},n.hasAttribute=function(e,t){return null!=Z.getAttribute(e,t)},n.getAttribute=function(e,t){if(e&&t){for(var r=t.split("/"),i=0;i<r.length;i++)if(!(e=e[r[i]]))return;return e}},n.setAttribute=function(e,t,r){if(!e||!t)return null;for(var i=t.split("/"),n=0;n<i.length;n++){if(t=i[n],n==i.length-1){e[t]=r;break}e[t]=e[t]||{},e=e[t]}return r},n.setArrayValue=function(e,t,r){for(var i=0;i<e.length;i++){var n=e[i];n&&(n[t]=r)}},n.add=function(e,t){return Z.isArray(e)?-1===e.indexOf(t)&&e.push(t):e.add(t),t},n.remove=function(e,t){if(Z.isArray(e)){var r=e.indexOf(t);-1!==r&&e.splice(r,1)}else e.delete(t)},n.dynamicLoad=function(t,u,h,e){null==h&&(h=!0),null==e&&(e=!0),"string"==typeof t&&(t=[t]);var r=t.length,i=0,n={};function o(){r<=(i+=1)&&null!=u&&u(n)}function a(e,t){var r="",i=e.lastIndexOf(".");"css"==(r=e.substr(i+1))?r="css":"js"==r&&(r="js"),"js"==r?function(e,t){var r,i,n=document.getElementsByTagName("script");for(r=0,i=n.length;r<i;r++){var o=n[r];if(o){var a=o.getAttribute("src");a&&(a!=e&&-1==a.indexOf(e)||o.parentNode.removeChild(o))}}var s;s=h?-1==e.lastIndexOf("?")?e+"?time="+(new Date).getTime():e+"&time="+(new Date).getTime():e;var l=document.createElement("script");l.type="text/javascript",l.src=s,l.onload=function(){t&&t()},l.onreadystatechange=function(){"loaded"!=this.readyState&&"complete"!=this.readyState||t&&t()},document.getElementsByTagName("head")[0].appendChild(l)}(e,t):"css"==r?function(e,t){var r,i,n=document.getElementsByTagName("link");for(r=0,i=n.length;r<i;r++){var o=n[r];if(o){var a=o.getAttribute("href");a&&(a!=e&&-1==a.indexOf(e)||o.parentNode.removeChild(o))}}var s;s=h?-1==e.lastIndexOf("?")?e+"?time="+(new Date).getTime():e+"&time="+(new Date).getTime():e;var l=document.getElementsByTagName("head")[0],c=document.createElement("link");c.type="text/css",c.rel="stylesheet",c.href=s,l.appendChild(c),c.onreadystatechange=function(){"complete"==css.readyState&&null!=t&&t()},c.onload=function(){null!=u&&t()}}(e,t):function(e,r){var i=null;if(window.XMLHttpRequest&&(i=new XMLHttpRequest),null!=i){i.onreadystatechange=function(){if(4==i.readyState)if(200==i.status){if(null!=r){var t=null;try{t=JSON.parse(i.responseText)}catch(e){t=i.responseText}n[e]=t,r(),i=null}}else console.log("Problem retrieving XML data:"+i.statusText),i=null};var t;t=h?-1==e.lastIndexOf("?")?e+"?time="+(new Date).getTime():e+"&time="+(new Date).getTime():e,i.open("GET",t,!0),i.send(null)}else console.error("Your browser does not support XMLHTTP.")}(e,t)}if(e)0<r&&a(t.shift(),function e(){0<t.length?a(t.shift(),e):null!=u&&u(n)});else for(var s=0;s<r;s++)a(t[s],o)},n.dynamicLoadJSON=function(e,t){this.dynamicLoad(e,t)},n.dynamicLoadJS=function(e,t){this.dynamicLoad(e,t)},n.dynamicLoadCSS=function(e,t){this.dynamicLoad(e,t)},n.convertObjectClass=function(e,t){if(!e)return null;if(!t)return null;for(var r=e.app,i=e.parent,n=r.create({type:t}),o=n.parent,a=Object.keys(e),s=0;s<a.length;s++){var l=a[s];n[l]?Z.swapValue(e,l,l,n):n[l]=e[l]}var c=(n.style.obj=n).controls;for(s=0;s<c.length;s++)c[s].object=n;if(i)for(s=0;s<i.children.length;s++)if(i.children[s]==e){i.children[s]=n;break}if(o){var u=o.children.indexOf(n);-1!==u&&o.children.splice(u,1)}return r.events.updateObjectEvent(n,e),r.objectManager.replaceObject(n,e),e.destroy(),n},n.addCastType=function(e,t,r){Z.castTypes=Z.castTypes||[],Z.castTypes.push({type:e,condition:t,params:r}),Z.evalTypes&&delete Z.evalTypes[e],THING.factory.registerClass(e,Z.evaluate(e))},n.removeCastType=function(e,t,r){Z.castTypes=Z.castTypes||[];for(var i=0;i<Z.castTypes.length;i++){var n=Z.castTypes[i];n.type==e&&n.condition==t&&(r&&n.params!=r||Z.castTypes.splice(i--,1))}},n.getCastTypes=function(){return Z.castTypes=Z.castTypes||[],Z.castTypes},n.runAsync=function(e){return new Promise(function(e){return setTimeout(e,10)}).then(function(){e()})},n.r=function(e,t){return Math.floor(Math.random()*(t-e+1)+e)},n.evaluate=function(e){if(!Z.evalTypes){Z.evalTypes={};for(var t=["BaseObject","Facade","Building","Floor","Room","Thing","Box","Sphere","Plane","Cylinder","Tetrahedron","Door","ElevatorDoor","Elevator","StairDoor","Stair","Line","PolygonLine","RouteLine","Water","WebView","Region","PolygonRegion","Marker","Campus"],r=0;r<t.length;r++){var i=t[r];Z.evalTypes[i]=X("THING."+i)}}if(void 0!==Z.evalTypes[e])return Z.evalTypes[e];try{var n=X(e)||X("THING."+e);return Z.evalTypes[e]=n}catch(t){return Z.evalTypes[e]=null}},n.instanceOf=function(e,t){var r=Z.evaluate(t);if(!r)return!1;try{return e instanceof r}catch(e){return!1}},n.isSupportWebGL=function(){return Z.system.isSupportWebGL()},n.callFuncByArguments=function(e,t,r){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0,n=e[t];if(Z.isFunction(n))switch(r.length){case 0:return n.call(e);case 1:return n.call(e,r[i+0]);case 2:return n.call(e,r[i+0],r[i+1]);case 3:return n.call(e,r[i+0],r[i+1],r[i+2]);case 4:return n.call(e,r[i+0],r[i+1],r[i+2],r[i+3]);case 5:return n.call(e,r[i+0],r[i+1],r[i+2],r[i+3],r[i+4]);case 6:return n.call(e,r[i+0],r[i+1],r[i+2],r[i+3],r[i+4],r[i+5]);case 7:return n.call(e,r[i+0],r[i+1],r[i+2],r[i+3],r[i+4],r[i+5],r[i+6]);case 8:return n.call(e,r[i+0],r[i+1],r[i+2],r[i+3],r[i+4],r[i+5],r[i+6],r[i+7])}},n._getMD5Code=function(e,r){(new THREE.FileLoader).load(e,function(e){if(e&&r){var t=SparkMD5.hash(e);r({md5:t})}},function(){},function(){})},n._getStringMD5Code=function(e){return SparkMD5.hash(e)},n.Utf8ArrayToStr=function(e){var t,r,i,n,o,a;for(t="",i=e.length,r=0;r<i;)switch((n=e[r++])>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:t+=String.fromCharCode(n);break;case 12:case 13:o=e[r++],t+=String.fromCharCode((31&n)<<6|63&o);break;case 14:o=e[r++],a=e[r++],t+=String.fromCharCode((15&n)<<12|(63&o)<<6|(63&a)<<0)}return t},n);function K(e,t,r,i){this._delaunayTriangles=null,this._rebuiltTriangles=null,this._points=[],this._indices=[],this._graph=null,this._extraIds=[],this._init(e,t,r||40,i)}function ee(e,t){for(var r=[],i=0,n=e.length;i<n;i++){var o=e[i];if(void 0!==t&&0!==r.length){for(var a=r[r.length-1],s=new poly2tri.Point(o.x,o.y),l=Math.ceil(s.clone().sub(a).length()/t),c=s.clone().sub(a).length()/l,u=s.clone().sub(a),h=1;h<l;h++)u.normalize(),r.push(a.clone().add(u.mul(c*h)));r.push(s.clone())}else r.push(new poly2tri.Point(o.x,o.y))}if(void 0!==t)for(a=r[r.length-1],s=r[0],l=Math.ceil(s.clone().sub(a).length()/t),c=s.clone().sub(a).length()/l,u=s.clone().sub(a),h=1;h<l;h++)u.normalize(),r.push(a.clone().add(u.mul(c*h)));return r}function te(e,t){for(var r=1/0,i=0,n=0,o=t.length;n<o;n++){var a=e.distanceTo(t[n]);a<r&&(r=a,i=n)}return i}Object.defineProperties(Z,{disableWarning:{get:function(){return console.warn!=Z.consoleWarnFunc},set:function(e){console.warn=e?function(){}:Z.consoleWarnFunc}},disableTime:{get:function(){return console.time!=Z.consoleTimeFunc},set:function(e){console.timeEnd=e?(console.time=function(){},function(){}):(console.time=Z.consoleTimeFunc,Z.consoleTimeEndFunc)}}}),Object.assign(K.prototype,{_init:function(e,t,r,i){var n,o;if(e.contour)(n={}).contour=ee(e.contour,r),n.holes=e.holes.map(function(e){return ee(e,r)}),o=e.y;else{var a=new THREE.Geometry;a.fromBufferGeometry(e),a.mergeVertices(),n=function(e,t){for(var r={},i=0,n=e.faces,o=n.length;i<o;i++)for(var a=[n[i].a,n[i].b,n[i].c].sort(function(e,t){return e-t}),s=[[0,1],[1,2],[0,2]],l=0;l<s.length;l++){var c=a[s[l][0]],u=a[s[l][1]];r[c+"_"+u]?r[c+"_"+u].count++:r[c+"_"+u]={start:c,end:u,count:1}}var h=[];for(var p in r)1===r[p].count&&h.push(r[p]);for(var d=[];0<h.length;){var f,m=[],g=h[0].start,v=h[0].end;for(f=e.vertices[h[0].end],m.push({x:f.x,y:f.z}),h.splice(0,1);v!==g;)for(i=0,o=h.length;i<o;i++){if(h[i].start==v){f=e.vertices[h[i].end],m.push({x:f.x,y:f.z}),v=h[i].end,h.splice(i,1);break}if(h[i].end==v){f=e.vertices[h[i].start],m.push({x:f.x,y:f.z}),v=h[i].start,h.splice(i,1);break}}d.push(m)}function y(e){for(var t=1/0,r=1/0,i=0;i<e.length;i++)e[i].x<t&&(t=e[i].x),e[i].y<r&&(r=e[i].y);return{x:t,y:r}}var b=1/0,x=1/0,E=0,_=[];for(i=0,o=d.length;i<o;i++){var w=ee(d[i],t);_.push(w);var T=y(w);(T.x<b||T.y<x)&&(b=T.x,x=T.y,E=i)}var M=_[E];return _.splice(E,1),{contour:M,holes:_}}(a,r),o=a.vertices[0].y}var s=new poly2tri.SweepContext(n.contour);if(s.addHoles(n.holes),s.triangulate(),this._delaunayTriangles=s.getTriangles(),this._rebuiltTriangles=function(e,t){for(var r=[],i=0;i<e.length;i++){var n=e[i].getPoints(),o=new THREE.Triangle;o.a.set(n[0].x,t,n[0].y),o.b.set(n[1].x,t,n[1].y),o.c.set(n[2].x,t,n[2].y),r.push(o)}return r}(this._delaunayTriangles,o),function(e,o,a,s){var r=0;e.forEach(function(e){for(var t=0;t<e.points_.length;t++)void 0===e.points_[t]._id&&(e.points_[t]._id=r++)});var l=[[1,2],[0,2],[0,1]],c={},u=[],h=0;e.forEach(function(e){for(var t=u.length=0;t<3;t++){if(!e.constrained_edge[t]){var r=e.getPoint(l[t][0]),i=e.getPoint(l[t][1]);if(!c[r._id+"_"+i._id]){var n=new THREE.Vector3((r.x+i.x)/2,s,(r.y+i.y)/2);n._index=h++,o.push(n),c[r._id+"_"+i._id]=n,c[i._id+"_"+r._id]=n}u.push(c[r._id+"_"+i._id])}}2===u.length&&a.push(u[0]._index,u[1]._index),3===u.length&&(a.push(u[0]._index,u[1]._index),a.push(u[1]._index,u[2]._index),a.push(u[2]._index,u[0]._index))})}(this._delaunayTriangles,this._points,this._indices,o),t&&0<t.length)for(var l=this._points.slice(0),c=0;c<t.length;c++){var u=t[c],h=this._points.length,p=te(u,l);this._points.push(u.clone()),this._indices.push(h,p),this._extraIds.push(h)}this._graph=function(e,t,r){var i={};r&&r.forEach(function(e){e.box=(new THREE.Box3).setFromPoints(e)});for(var n=0,o=t.length;n<o;n+=2){var a=t[n+0],s=t[n+1],l=e[a],c=e[s];i[a]=i[a]||{},i[s]=i[s]||{},r&&r.find(function(e){return ae(l,c,e)})?i[a][s]=i[s][a]=1/0:i[a][s]=i[s][a]=l.distanceTo(c)}return new Graph(i)}(this._points,this._indices,i)},findPath:function(e,t,r){r=void 0!==r&&r;for(var i=te(e,this._points),n=te(t,this._points),o=this._graph.findShortestPath(i,n),a=r?[e.clone()]:[],s=0,l=o.length;s<l;s++)a.push(this._points[+o[s]].clone());if(r&&a.push(t.clone()),r&&(3<a.length&&ne(a[0],a[1],a[2])<.25*Math.PI&&a.splice(1,1),3<a.length)){var c=a.length-1,u=a.length-2,h=a.length-3;ne(a[c],a[u],a[h])<.25*Math.PI&&a.splice(u,1)}return a},getExtraPoints:function(){var t=[],r=this;return this._extraIds.forEach(function(e){t.push(r._points[e])}),t},getDistance:function(e,t){for(var r=te(e,this._points),i=te(t,this._points),n=this._graph.findShortestPath(r,i),o=0,a=0,s=n.length;a<s-1;a++){var l=n[a],c=n[a+1];o+=this._graph.map[l][c]}return o},findNearestPathPoint:function(e){var t=te(e,this._points);return this._points[t]},getPoints:function(){return this._points},getIndices:function(){return this._indices},getRebuiltTriangles:function(){return this._rebuiltTriangles}});var re=new THREE.Vector3,ie=new THREE.Vector3;function ne(e,t,r){return re.copy(t).sub(e),ie.copy(t).sub(r),re.angleTo(ie)}var oe=new THREE.Box3;function ae(e,t,r){if(oe.makeEmpty(),oe.expandByPoint(e),oe.expandByPoint(t),i=r.box,(n=oe).max.x<i.min.x||n.min.x>i.max.x||n.max.z<i.min.z||n.min.z>i.max.z)return!1;for(var i,n,o=!1,a=0,s=r.length-1;a<r.length;s=a++)if(se(e,t,r[a],r[s])){o=!0;break}return!!o||function(e,t){for(var r=e.x,i=e.z,n=!1,o=0,a=t.length-1;o<t.length;a=o++){var s=t[o].x,l=t[o].z,c=t[a].x,u=t[a].z;i<l!=i<u&&r<(c-s)*(i-l)/(u-l)+s&&(n=!n)}return n}(e,r)}function se(e,t,r,i){var n=(e.x-r.x)*(t.z-r.z)-(e.z-r.z)*(t.x-r.x),o=(e.x-i.x)*(t.z-i.z)-(e.z-i.z)*(t.x-i.x);if(0<n*o)return!1;var a=(r.x-e.x)*(i.z-e.z)-(r.z-e.z)*(i.x-e.x);if(0<a*(a+n-o))return!1;var s=a/(o-n),l=s*(t.x-e.x),c=s*(t.z-e.z);return{x:e.x+l,z:e.z+c}}function le(e){this._navigations=e,this._map=null,this._connectNavMap=null,this._connectPoints=[],this._init()}function ce(e,t){for(var r=-1,i=0;i<t.length;i++)t[i].equals(e)&&(r=i);return r}function ue(e){var t={};for(var r in e)t[r]=Object.assign({},e[r]);return t}function he(e){this._navigation=e}Object.assign(le.prototype,{_init:function(){this._map={},this._connectNavMap={};for(var e=0;e<this._navigations.length;e++){for(var t=this._navigations[e],r=t.getExtraPoints(),i=0;i<r.length;i++){var n=r[i],o=ce(n,this._connectPoints);o<0?(o=this._connectPoints.length,n._index=o,this._connectPoints.push(n)):n._index=this._connectPoints[o]._index}if(1<r.length)for(i=0;i<r.length;i++)for(var a=0;a<r.length;a++)if(a!==i){var s=t.getDistance(r[a],r[i]),l=r[a]._index,c=r[i]._index;this._map[l]=this._map[l]||{},this._map[c]=this._map[c]||{},this._map[l][c]=s,this._map[c][l]=s,this._connectNavMap[l]=this._connectNavMap[l]||{},this._connectNavMap[c]=this._connectNavMap[c]||{},this._connectNavMap[l][c]=t,this._connectNavMap[c][l]=t}}},findPath:function(e,t,r,i){if(e==r)return this._navigations[e].findPath(t,i);if(0==this._navigations[e].getExtraPoints().length||0==this._navigations[r].getExtraPoints().length)return console.info("closed space: "+e+" or "+r),[];var s=ue(this._map),l=ue(this._connectNavMap),n=0,o=0,a=this._connectPoints.length,c=0;function u(e,t,r){for(var i=t.getExtraPoints(),n=0;n<i.length;n++){var o=ce(i[n],r),a=t.getDistance(e,i[n]);s[h]=s[h]||{},s[o]=s[o]||{},s[h][o]=a,s[o][h]=a,l[h]=l[h]||{},l[o]=l[o]||{},l[h][o]=t,l[o][h]=t}}if(ce(t=(m=this._navigations[e]).findNearestPathPoint(t).clone(),this._connectPoints)<0){var h=a+c;c++,u(t,m,this._connectPoints),this._connectPoints.push(t),n=h}else n=ce(t,this._connectPoints);o=ce(i=(m=this._navigations[r]).findNearestPathPoint(i).clone(),this._connectPoints)<0?(h=a+c,c++,u(i,m,this._connectPoints),this._connectPoints.push(i),h):ce(i,this._connectPoints);var p=Graph.findShortestPath(s,n,o);if(!p)return console.info("find no path between rooms: "+e+" or "+r),[];for(var d=[],f=0;f<p.length-1;f++){var m,g=+p[f],v=+p[f+1],y=(m=l[g][v]).findPath(this._connectPoints[g],this._connectPoints[v]);0!==f&&y.shift(),d=d.concat(y)}return this._connectPoints.length=a,d}}),Object.assign(he.prototype,{createPathPointsMesh:function(){for(var e=this._navigation.getPoints(),t=[],r=0,i=e.length;r<i;r++)e[r].toArray(t,3*r);var n=new THREE.BufferGeometry;return n.addAttribute("position",new THREE.BufferAttribute(new Float32Array(t),3)),new THREE.Points(n)},createPathLineSegmentsMesh:function(){for(var e=this._navigation,t=e.getPoints(),r=[],i=e.getIndices(),n=0,o=t.length;n<o;n++)t[n].toArray(r,3*n);var a=new THREE.BufferGeometry;return a.addAttribute("position",new THREE.BufferAttribute(new Float32Array(r),3)),a.setIndex(i),new THREE.LineSegments(a)},createRebuiltTrianglesMesh:function(){for(var e=this._navigation.getRebuiltTriangles(),t=[],r=0,i=e.length;r<i;r++){var n=e[r];n.a.toArray(t,18*r+0),n.b.toArray(t,18*r+3),n.b.toArray(t,18*r+6),n.c.toArray(t,18*r+9),n.c.toArray(t,18*r+12),n.a.toArray(t,18*r+15)}var o=new THREE.BufferGeometry;return o.addAttribute("position",new THREE.BufferAttribute(new Float32Array(t),3)),new THREE.LineSegments(o)},createPathNodeByPoints:function(e){for(var t=[],r=0,i=e.length;r<i;r++)e[r].toArray(t,3*r);var n=[];for(r=0,i=e.length;r<i;r++)r!==i-1&&n.push(r,r+1);var o=new THREE.Group,a=new THREE.BufferGeometry;a.addAttribute("position",new THREE.BufferAttribute(new Float32Array(t),3));var s=new THREE.Points(a);o.add(s);var l=new THREE.BufferGeometry;l.addAttribute("position",new THREE.BufferAttribute(new Float32Array(t),3)),l.setIndex(n);var c=new THREE.LineSegments(l);return o.add(c),o}});var pe=function(){function t(e){y(this,t),this.object=e,this.prevObjectPosition=null,this.prevObjectScale=null,this.prevObjectAngles=null,this._objects=[],this.groupNavigation=null,this.navigationHelpersNode=null,this.navigationHelpers=[]}return t.prototype.clear=function(){this.showHelper(!1),this.prevObjectPosition=null,this.prevObjectScale=null,this.prevObjectAngles=null,this._objects=[],this.groupNavigation=null,this.navigationHelpers=[]},t.prototype.needGen=function(){var e=this.object;if(!e)return!0;if(!this.prevObjectPosition||!this.prevObjectScale||!this.prevObjectAngles)return!0;var t=Z.parseVector3(e.position),r=Z.parseVector3(e.scale),i=Z.parseVector3(e.angles);return!t.equals(this.prevObjectPosition)||!r.equals(this.prevObjectScale)||!i.equals(this.prevObjectAngles)},t.prototype.getClipAreas=function(e,t){var r,i,n=[];if(t)for(var o=0;o<t.length;o++){var a=t[o];if((r=e)==(i=a.object)||r.isChildOf(i)){for(var s=[],l=a.area,c=0;c<l.length;c++){var u=Z.parseVector3(l[c]);s.push(u)}n.push(s)}}return n},t.prototype.genFromData=function(e,t,r,i){if(!Z.isFunction(e.getNavigationData))return!1;var n=e.getNavigationData();if(!n)return!1;for(var o=[],a=0;a<8;a+=2)o.push({x:n.data[a],y:n.data[a+1]});var s=[];for(a=0;a<n.holes.length;a++){for(var l=2*n.holes[a],c=[],u=0;u<8;u+=2)c.push({x:n.data[l+u],y:n.data[l+u+1]});s.push(c)}var h=new K({contour:o,holes:s,y:0},t,30,this.getClipAreas(e,i));r.push(h);var p=new he(h);return this.navigationHelpers.push(p),!0},t.prototype.genFromMesh=function(e,t,r,i,n){if(!Z.isFunction(e.getNavigationMesh))return!1;var o=e.getNavigationMesh();if(!o)return!1;var a=o.geometry;if(!a)return!1;var s=a.clone();s.isBufferGeometry||(s=(new THREE.BufferGeometry).fromGeometry(s)),s.applyMatrix(o.matrixWorld),s.applyMatrix(n);var l=new K(s,t,30,this.getClipAreas(e,i));r.push(l);var c=new he(l);return this.navigationHelpers.push(c),!0},t.prototype._getCampus=function(){return this.object.isCampus?this.object:this.object.parents.query(".Campus")[0]},t.prototype.initFromObjects=function(e,t){var r=this._getCampus();if(r){var i=new THREE.Matrix4;i.getInverse(r.node.matrixWorld);for(var n=[],o=0;o<e.length;o++){var a=e[o],s=[];a.doors&&a.doors.forEach(function(e){var t=Z.parseVector3(e.position);t.applyMatrix4(i),s.push(t)}),(this.genFromData(a,s,n,t)||this.genFromMesh(a,s,n,t,i))&&this._objects.push(a)}this.groupNavigation=new le(n)}},t.prototype.init=function(e){this.clear();var t=this.object;this.prevObjectPosition=Z.parseVector3(t.position),this.prevObjectScale=Z.parseVector3(t.scale),this.prevObjectAngles=Z.parseVector3(t.angles);try{if(t.isFloor){var r=t.rooms;r.length?this.initFromObjects(r,e):this.initFromObjects([t],e)}else t.isCampus&&this.initFromObjects([t],e)}catch(e){console.error(e),console.error(e.toString()),console.error("Init object(name:"+this.object.name+", id:"+this.object.id+") navigation failed")}},t.prototype.getRoomID=function(e){if(e.isBaseObject)return this._objects.indexOf(e);for(var t=0;t<this._objects.length;t++){var r=this._objects[t];if(r.isFloor)return t;if(r.getRayCastPosition(e))return t;for(var i=r.doors,n=0;n<i.length;n++){var o=i[n];if(THING.Math.equalsVector(o.position,e))return t}}return-1},t.prototype.getEntryInfo=function(e,t,r){var i=e[t],n=e[r],o=-1;return this.object.isFloor?i?o=this.getRoomID(i):n&&(o=this.getRoomID(n)):this.object.isCampus&&(o=0),-1===o?null:{id:o,pos:Z.parseVector3(n)}},t.prototype.findPath=function(e){e=e||{};var t=this.getEntryInfo(e,"startRoom","startPosition");if(!t)return null;var r=this.getEntryInfo(e,"endRoom","endPosition");if(!r)return null;var i=this._getCampus();if(!i)return null;var n=new THREE.Matrix4;n.getInverse(i.node.matrixWorld);var o=t.pos.clone();o.applyMatrix4(n);var a=r.pos.clone();a.applyMatrix4(n);var s=this.groupNavigation.findPath(t.id,o,r.id,a);if(!s||!s.length)return null;for(var l=e.height||0,c=t.pos,u=[t.pos.toArray()],h=0;h<s.length;h++){var p=s[h];p.y+=l,length+=p.distanceTo(c),(c=p).applyMatrix4(i.node.matrixWorld),u.push(p.toArray())}return u.getPathLength=function(){return Z.getLength(this)},u},t.prototype.showHelper=function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];if(this.object)if(e){if(!this.navigationHelpersNode){this.navigationHelpersNode=new THREE.Group;var t=this._getCampus();if(!t)return;for(var r=0;r<this.navigationHelpers.length;r++){var i=this.navigationHelpers[r],n=i.createRebuiltTrianglesMesh();n.position.y=.1,n.material.color.setHex(6985427),this.navigationHelpersNode.add(n);var o=i.createPathPointsMesh();this.navigationHelpersNode.add(o);var a=i.createPathLineSegmentsMesh();this.navigationHelpersNode.add(a)}this.navigationHelpersNode.applyMatrix(t.node.matrixWorld),this.object.app.scene.add(this.navigationHelpersNode)}}else this.navigationHelpersNode&&(this.object.app.resourceManager.remove(this.navigationHelpersNode),this.navigationHelpersNode=null)},t}();function de(e,t){t.canNotQueryFromSelector||e.push(t)}function fe(e,t,r){var i=e.substring(2);t.forEach(function(e){e.uuid==i&&de(r,e)})}var me,ge,ve=function(){function r(e,t){y(this,r),this.app=e,this.objects=t}return r.prototype._setAttribute=function(e,t){for(var r=0;r<this.objects.length;r++){var i=this.objects[r];i&&(i.style[e]=t)}},r.prototype.setMaterial=function(t){this.objects.forEach(function(e){e.style.setMaterial(t)})},l(r,[{key:"renderOrder",set:function(e){this._setAttribute("renderOrder",e)}},{key:"color",set:function(e){this._setAttribute("color",e)}},{key:"opacity",set:function(e){this._setAttribute("opacity",e)}},{key:"outlineColor",set:function(e){this._setAttribute("outlineColor",e)}},{key:"defaultOutlineColor",set:function(e){this._setAttribute("defaultOutlineColor",e)}},{key:"skipOutline",set:function(e){this._setAttribute("skipOutline",e)}},{key:"wireframe",set:function(e){this._setAttribute("wireframe",e)}},{key:"axisHelper",set:function(e){this._setAttribute("axisHelper",e)}},{key:"boundingBox",set:function(e){this._setAttribute("boundingBox",e)}},{key:"boundingBoxColor",set:function(e){this._setAttribute("boundingBoxColor",e)}},{key:"alwaysOnTop",set:function(e){this._setAttribute("alwaysOnTop",e)}},{key:"glow",set:function(e){this._setAttribute("glow",e)}},{key:"innerGlow",set:function(e){this._setAttribute("innerGlow",e)}}]),r}(),ye=function(){function s(e,t){y(this,s),this.objects=[],this.app=e,this.objectManager=e.objectManager,this.events=e.events,this.length=0,this.initObjectPool=t||this.objectManager.objects}return s.prototype.isSelector=function(){return!0},s.prototype.query=function(e){var t=new s(this.app,this.initObjectPool);return t.select(e,this.objects),t},s.prototype._getObjects=function(e){var t=null;if(e instanceof s)t=(r=e).objects;else if(Z.isString(e)){var r;(r=new s(this.app,this.initObjectPool)).select(e),t=r.objects}else Z.isArray(e)?t=e:e.isBaseObject||e.isGroup?t=[e]:console.error("selector.add unkown: "+e);return t},s.prototype.remove=function(e){if(!e)return this;var t=this._getObjects(e);if(!t)return this;for(var r=this.objects,i=0;i<r.length;i++)for(var n=0;n<t.length;n++)if(r[i]==t[n]){r.splice(i--,1);break}return this.buildReturnObject(r)},s.prototype.add=function(e){if(!e)return this;var t=this._getObjects(e);if(!t)return this;var r=this.objects.concat(t),i=Array.from(new Set(r));return this.buildReturnObject(i)},s.prototype.not=function(e){if(!e)return this;var t=null;if(e instanceof s)t=(r=e).objects;else if(Z.isString(e)){var r;(r=new s(this.app,this.initObjectPool)).select(e),t=r.objects}else if(Z.isArray(e))t=e;else{if(!e.isBaseObject&&!e.isGroup)return console.error("selector.not unkown: "+e),this;t=[e]}for(var i=0;i<t.length;i++){var n=t[i],o=this.objects.indexOf(n);-1<o&&this.objects.splice(o,1)}var a=this.objects;return this.buildReturnObject(a)},s.prototype.parse=function(e,t,r){if(Z.isString(e))if(0==e.indexOf(".")){var i=e.substring(1);g=i,v=r,t.forEach(function(e){(e.type==g||Z.instanceOf(e,g))&&de(v,e)})}else 0==e.indexOf("##")?fe(e,t,r):0==e.indexOf("#")?(d=t,f=r,m=e.substring(1),d.forEach(function(e){e.id==m&&de(f,e)}),r.length||(fe("#"+e,t,r),r.length&&console.warn('[Selector] please use "##" to query object'))):0==e.indexOf("[")&&e.indexOf("]")==e.length-1?function(e,t,a){for(var s=null,r=["!=",">=","<=","=",">","<"],i=0;i<r.length;i++){var n=r[i];if(0<e.indexOf(n)){s=n;break}}if(null!=s){var o=e.split(s),l=o[0].trimBoth("\"' "),c=o[1].trimBoth("\"' ");t.forEach(function(e){var t=e.userData||e.properties;if(t){var r,i,n,o=Z.parseValue(t[l],Z.isFunction(e.getAttribute)?e.getAttribute(l):null);void 0!==o&&(Z.isStringNumber(o)&&Z.isStringNumber(c)&&(o=parseFloat(o),c=parseFloat(c)),r=o,i=c,("!="==(n=s)?r!=i:">="==n?i<=r:"<="==n?r<=i:"="==n?Z.isString(i)&&0<i.indexOf("*")?(i=i.replace("*",""),0<=r.indexOf(i)):r==i:">"==n?i<r:"<"==n?r<i:void 0)&&de(a,e))}})}else{var u=e;t.forEach(function(e){(e.userData[u]||e.getAttribute(u))&&de(a,e)})}}(e.slice(1,e.length-1),t,r):"*"==e?(p=r,t.forEach(function(e){de(p,e)})):(u=e,h=r,t.forEach(function(e){e.name==u&&de(h,e)}));else Z.isRegExp(e)?(l=e,c=r,t.forEach(function(e){l.test(e.name)&&de(c,e)})):Z.isFunction(e)?(a=e,s=r,t.forEach(function(e){a(e)&&de(s,e)})):e.isSelector&&(n=e,o=r,t.forEach(function(e){n.has(e)&&de(o,e)}));var n,o,a,s,l,c,u,h,p,d,f,m,g,v},s.prototype.queryResult=function(e,t){e=e||{},t=t||this.initObjectPool;var r=[];if(Z.isFunction(e.split)){for(var i=e.split("|"),n=0;n<i.length;n++){var o=i[n].trim();o&&this.parse(o,t,r)}1<i.length&&(r=Array.from(new Set(r)))}else this.parse(e,t,r);return r},s.prototype.select=function(e,t){var r=this.queryResult(e,t);return this.buildReturnObject(r)},s.prototype.buildReturnObject=function(e){this.clear(),(e=e||[])instanceof s&&(e=e.toArray()),this.objects=e,this.length=e.length;for(var t=0;t<e.length;t++)this[t]=e[t];return this},s.prototype.clear=function(){for(var e=0;e<this.length;e++)delete this[e];this.objects=[],this.length=0},s.prototype.forEach=function(e){if(e)for(var t=0;t<this.objects.length;t++){var r=this.objects[t];if(r&&!1===e(r))break}},s.prototype.sort=function(e){e=e||function(e,t){var r=e.levelFromRoot;return t.levelFromRoot-r},this.objects.sort(e);for(var t=0;t<this.objects.length;t++)this[t]=this.objects[t];return this},s.prototype.toJSON=function(){return JSON.stringify(this.objects)},s.prototype.toArray=function(){return this.objects},s.prototype.indexOf=function(e){return this.objects.indexOf(e)},s.prototype.splice=function(e,t){this.objects.splice(e,t),this.length=this.objects.length},s.prototype.concat=function(e){var t=new s(this.app,this.objects);if(t.buildReturnObject(this.objects),e)for(var r=0;r<e.length;r++)-1===t.indexOf(e[r])&&t.add(e[r]);return t},s.prototype.reverse=function(){var e=this.objects.reverse(),t=new s(this.app,e);return t.buildReturnObject(e),t},s.prototype.has=function(e){return-1!==this.objects.indexOf(e)},s.prototype.equals=function(e){if(this.length!=e.length)return!1;for(var t=0;t<this.length;t++)if(this[t]!=e[t])return!1;return!0},s.prototype.setOpacity=function(e){for(var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],r=0;r<this.objects.length;r++){var i=this.objects[r];i&&i.style.setOpacity(e,t)}},s.prototype.flipVisible=function(){for(var e=0;e<this.objects.length;e++){var t=this.objects[e];t&&(t.visible=!t.visible)}},s.prototype.fadeIn=function(e){for(var t=0;t<this.objects.length;t++){var r=this.objects[t];r&&r.fadeIn(e)}},s.prototype.fadeOut=function(e){for(var t=0;t<this.objects.length;t++){var r=this.objects[t];r&&r.fadeOut(e)}},s.prototype.destroyAll=function(){for(var e=0;e<this.objects.length;e++){var t=this.objects[e];t&&t.destroy()}this.clear()},s.prototype.on=function(e,t,r,i,n){this.events.bindCallObj(e,t,r,i,this.objects,n)},s.prototype.off=function(e,t,r){this.events.unbindCallObj(e,t,r,this.objects)},s.prototype.one=function(e,t,r,i,n){this.events.bindCallObj(e,t,r,i,this.objects,n,!0)},s.prototype.trigger=function(e,t,r){for(var i=0;i<this.objects.length;i++)this.objects[i].trigger(e,t,r)},s.prototype.pauseEvent=function(e,t,r){for(var i=0;i<this.objects.length;i++)this.objects[i].pauseEvent(e,t,r)},s.prototype.pauseEventInFrame=function(e,t,r){for(var i=0;i<this.objects.length;i++)this.objects[i].pauseEventInFrame(e,t,r)},s.prototype.resumeEvent=function(e,t,r){for(var i=0;i<this.objects.length;i++)this.objects[i].resumeEvent(e,t,r)},s.prototype.getNodes=function(){for(var e=function(e,t){for(var r=0;r<e.length;r++)if(t==e[r]||t.isChildOf(e[r]))return!0;return!1},t=[],r=0;r<this.objects.length;r++){var i=this.objects[r];e(t,i.node)||t.push(i.node)}return t},s.prototype.destroy=function(){console.warn("[Selector] Please use '.destroyAll()' to replace '.destroy()'"),this.destroyAll()},s.prototype.showBoundingBox=function(e){console.warn("[Selector] Please use '.style.boundingBox=' to replace '.showBoundingBox()'"),this.style.boundingBox=e},l(s,[{key:"visible",set:function(e){Z.setArrayValue(this.objects,"visible",e)}},{key:"pickable",set:function(e){Z.setArrayValue(this.objects,"pickable",e)}},{key:"draggable",set:function(e){Z.setArrayValue(this.objects,"draggable",e)}},{key:"style",get:function(){return new ve(this.app,this.objects)}},{key:"opacity",set:function(e){console.warn("[Selector] Please use '.style.opacity=' to replace '.opacity'"),this.style.opacity=e}}]),s}(),be=function(){function e(){y(this,e),this._flags=0}return e.prototype.setFlags=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:16777215;this._flags=e},e.prototype.clearFlags=function(){this._flags=0},e.prototype.enableFlags=function(e,t){var r=this._flags;return t?this._flags|=e:this._flags&=~e,r!=this._flags},e.prototype.hasFlags=function(e){return!!(this._flags&e)},e.prototype.hasAnyFlags=function(){return 0!==this._flags},e}(),xe=function(){function t(e){y(this,t),this._object=e,this._bsp=new ThreeBSP(e.node._mergeAllGeometries())}return t.prototype.isCSG=function(){return!0},t.prototype._process=function(e,t){var i=this,r=function(e,t){var r=new ThreeBSP(t);return i._bsp?i._bsp=i._bsp[e](r):i._bsp=r,i._bsp};if(Z.isArray(t))for(var n=0;n<t.length;n++){var o;if((o=t[n]).isBaseObject){var a=o.node._mergeAllGeometries();this._bsp=r(e,a)}}else(o=t).isBaseObject&&(a=o.node._mergeAllGeometries(),this._bsp=r(e,a));return this},t.prototype.union=function(e){return this._process("union",e)},t.prototype.subtract=function(e){return this._process("subtract",e)},t.prototype.intersect=function(e){return this._process("intersect",e)},l(t,[{key:"bsp",get:function(){return this._bsp}}]),t}(),Ee=function(){function E(e){y(this,E),this.app=e,this._type="",this._id="",this._name="",this._uuid="",this._queryID=THING.Math.generateUUID(),this._parent=null,this._children=[],this.node=new THREE.Group,this._lodNode=null,this._defaultStyle=null,this._style=null,this._initScale=[1,1,1],this._initBoxSize=null,this._box=null,this._orientedBox=null,this._boxSize=null,this._boxRadius=0,this._boxCenter=null,this._pivot=null,this._ignoreParentScale=!1,this._ignoreParentAngles=!1,this._grid=null,this._dragState=T.No,this._draggable=!1,this.isTickable=!1,this._catchEventAnyTime=!1,this._pickable=!0,this._lookingAtObject=null,this._stateFlags=new be,this._dirtyFlags=new be,this._independentControlFlags=new be,this._hideNodesInScene=null,this._renderDistance=null,this._shadowDistance=null,this._localClippingPlaneBase=null,this._localClippingPlane=null,this._lockedOffset=[],this._independentPosition=null,this._independentWorldAngles=null,this._independentWorldScale=null,this.scaling=!1,this.scaleTween=null,this.rotating=!1,this.rotateTween=null,this.fadeTween=null,this.pathTween=null,this.pathTweens=[],this._attachPoints=null,this._controls=[],this.waitCommands=[],this.loaded=!1,this._internalUserData={},this._userData={},this._tags=[],this._groups=[],this._tweens=[],this._styleStrategy="Default",this.initStaticMembers()}return E.prototype._init=function(e,t){return this._parent=t,this.node=e||this.node,this.loaded=!0,this},E.prototype.initStaticMembers=function(){E.hasStaticMembers||(E.hasStaticMembers=!0,E.stateHideBySceneFlag=1,E.boundingBoxDirtyFlag=1,E.orientedBoundingBoxDirtyFlag=2)},E.prototype.setUserDataFlag=function(t,e){e?this.node.traverse(function(e){e.userData[t]=!0}):this.node.traverse(function(e){delete e.userData[t]})},E.prototype.setupEffects=function(){this.app.isMobileDevice?this.node.traverse(function(e){var t=e.material;t&&(Array.isArray(t)?t.forEach(function(e){return e.needsUpdate=!0}):t.needsUpdate=!0,e.isMesh&&(e.castShadow=!1,e.receiveShadow=!1),t.map&&(t.map.anisotropy=1,t.map.needsUpdate=!0))}):this.node.traverse(function(e){var t=e.material;t&&(t&&(Array.isArray(t)?t.forEach(function(e){return e.needsUpdate=!0}):t.needsUpdate=!0),e.isMesh&&(e.castShadow=!0,e.receiveShadow=!0),t.map&&(t.map.anisotropy=16,t.map.needsUpdate=!0))})},E.prototype.setupUserData=function(){var e=this.node.userData;e.isBaseObject=!0,e.id=this._queryID;var t=this;e.getObject=function(){return t.app.objectManager.get(t._queryID)}},E.prototype.setupNode=function(e){e.updateMatrixWorld(!0);var t=e.parent;this.node.updateMatrix();var r=this.node.matrix.clone();r.multiply(e.matrix),t&&e._detach(t,this.app.scene),THREE.SceneUtils.attach(e,this.app.scene,this.node),this.node.identity(),this.node.applyMatrix(r),e.identity(),e instanceof THREE.LOD&&(this._lodNode=e,this.tickable=!0),e.visible||(e.ensureVisible(!0,!0),e.ensureVisible(!1,!1),this.visible=!1)},E.prototype.setupID=function(e){this._id=Z.parseValue(e.id,this._id),this._name=Z.parseValue(e.name,this._name),this._uuid=Z.parseValue(e.uuid,this._uuid),this._id=this._id||this._uuid||this._name,this._name=this._name||this._id,this._id||this._uuid||(this._id=THING.Math.generateUUID()),this.setupCommonInfo(e)},E.prototype.setupCommonInfo=function(e){!1===e.visible&&(this.visible=!1),this._internalUserData=e.internalUserData||this._internalUserData,this._stateFlags.enableFlags(E.stateHideBySceneFlag,e.hideByScene),this._userData=e.properties||e.userData||{},this._tags=e.tags||[]},E.prototype._setupLocalPosition=function(e){var t=e.localPosition;t&&this.setLocalPosition(t)},E.prototype.setupTranslation=function(e){this._ignoreParentScale=Z.parseValue(e.ignoreParentScale,!1),this._ignoreParentAngles=Z.parseValue(e.ignoreParentAngles,!1);var t=e.position;t?this.position=t:e.basePoint||this._setupLocalPosition(e);var r=e.angle;if(r)this.angles=[0,r,0];else{var i=e.angles||e.localAngles;i&&(this.angles=i)}var n=e.scale;n&&(this.node.scale.copy(Z.parseVector3(n)),this.synIndependentWorldScale(),this._initScale=n.concat());var o=e.initBoxSize;o&&(this._initBoxSize=o.concat())},E.prototype.setupEnvMap=function(e){var t=this.getEnvMapResources();t&&(e||this.isOutdoors?t.outdoorsEnvMap&&this.node.traverse(function(e){!e.userData.skipEnvMap&&e.material&&(Array.isArray(e.material)?e.material.forEach(function(e){"envMap"in e&&(e.envMap=t.outdoorsEnvMap,e.envMapIntensity=1.3)}):"envMap"in e.material&&(e.material.envMap=t.outdoorsEnvMap,e.material.envMapIntensity=1.3))}):t.indoorsEnvMap&&this.node.traverse(function(e){!e.userData.skipEnvMap&&e.material&&(Array.isArray(e.material)?e.material.forEach(function(e){"envMap"in e&&(e.envMap=t.indoorsEnvMap,e.envMapIntensity=1.3)}):"envMap"in e.material&&(e.material.envMap=t.indoorsEnvMap,e.material.envMapIntensity=1.3))}))},E.prototype.loadFromURL=function(e,t){t&&t()},E.prototype.setupFromURL=function(e){if(e.node)this._setup(e);else{var t=this;this.loadFromURL(e,function(){t._setup(e)})}},E.prototype.setupFromData=function(e){console.error('[BaseObject] inherited class should impl "setupFromData(param)" interface'),this._setup(e)},E.prototype._setup=function(e){this.setupCommonInfo(e),this.setupUserData();var t=e.node;if(t){if(this._stateFlags.hasFlags(E.stateHideBySceneFlag)){var r=new THREE.Group;r.position.copy(t.position),r.quaternion.copy(t.quaternion),r.scale.copy(t.scale),(this._hideNodesInScene=t).removeBySelf(),t=r}this.setupNode(t)}this.setupParent(e),this.customSetup(e),this.setupComplete(e)},E.prototype.setup=function(e){this.setupID(e);var t=e.url,r=e.data,i=e.domElement;t?(e.url=this.app.confirmURL(t)._trimRight("/"),this.setupFromURL(e)):i?this.setupFromDom(e):r?this.setupFromData(e):this._setup(e)},E.prototype.setupStyle=function(e){var t=e.style;if(t)for(var r in t){var i=t[r];void 0!==i&&(this.style[r]=i)}},E.prototype.setupCommands=function(e){Z.isFunction(this.style._syn)&&this.style._syn();var t=this.app.commandManager.create(this.waitCommands);t&&t.execute(),this.waitCommands=[]},E.prototype.setupInheritAttributes=function(e){var t=Z.parseValue(e.inheritPosition,!0),r=Z.parseValue(e.inheritAngles,!0),i=Z.parseValue(e.inheritScale,!0);this.inheritPosition==t&&this.inheritAngles==r&&this.inheritScale==i||(t&&r&&i||this.node.updateMatrixWorld(),this.inheritPosition=t,this.inheritAngles=r,this.inheritScale=i)},E.prototype.setupParent=function(e){if(!e.independent){var t=e.parent;t instanceof E?(this._parent=t,j()&&t.translateY(THING.Math.randomInt(-15,11))):t&&console.error("[BaseObject] Please make sure parent is BaseObject"),null==this._parent&&void 0===t&&(this._parent=this.app.level.currentParentObject,this._parent||(this._parent=this.app.outdoors)),this._parent&&this._parent._add(this,e,-1)}},E.prototype.customSetup=function(e){},E.prototype._callComplete=function(e){var t=e.successCallback||e.complete;t&&t.call(this,{object:this})},E.prototype._beforeSetupComplete=function(e){},E.prototype._afterSetupComplete=function(e){},E.prototype.setupComplete=function(e){this._setDirtyFlag(!1,!1,!0),this.loaded=!0,this._userData=this._userData||{},this._internalUserData=this._internalUserData||{},this.setupEffects(),this.setupEnvMap(),this.setupTranslation(e),this.setupInheritAttributes(e),this._beforeSetupComplete(e),this.setupStyle(e),this.setupCommands(e),this.static?this.node._synMatrixWorld():this.node.updateWorldMatrix(!1,!1),this._afterSetupComplete(e),this.selfUpdate(),this.trigger("load",{object:this}),this.trigger("complete",{object:this}),this._callComplete(e)},E.prototype.setParent=function(e,t,r){var i=this._parent;if(i&&i!=e&&i.remove(this,!1),this._parent=e){var n=e.node;t||!this.node.parent?n&&n.add(this.node):this.node.attach(n,this.app.scene,r),this.style.alwaysOnTop&&this.style._setAlwaysOnTop(!0)}},E.prototype.synTickableObject=function(){this.isTickable?this.app.objectManager.addTickableObject(this):this.app.objectManager.removeTickableObject(this)},E.prototype._setDirtyFlag=function(e,t){if((!(2<arguments.length&&void 0!==arguments[2])||arguments[2])&&this._dirtyFlags.setFlags(),e)for(var r=this.parent;r;r=r.parent)r._dirtyFlags.setFlags();if(t)for(var i=0;i<this._children.length;i++)this._children[i].dirty=!0},E.prototype.getChildByPath=function(e,t){var r=e.search("/");if(-1!==r)r=e.substring(0,r),e=e.substring(r.length+1);else if(r=e,t){if(t(this,r))return this}else if(this._id==r)return this;for(var i=0;i<this._children.length;i++){var n=this._children[i],o=null;if(t?t(n,r)&&(o=n):n.id==r&&(o=n),o){var a=o.getChildByPath(e);if(a)return a}}return null},E.prototype._getBasePointNode=function(t){var e=this.node.traverseBreakable(function(e){return e.name.contains(t)});return e||(e=this.node.traverseBreakable(function(e){return e.name==t})),e},E.prototype._addFromCampus=function(e){},E.prototype.add=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:-1;if((e=e||{}).isBaseObject)this._add(e,null,t);else{var r=e.url;if(Z.isString(r)){var i=e.position||this.position,n=e.angles||e.localAngles||this.angles,o=Z.parseValue(e.isCamFitScene,!1),a=e.complete,s=this;this.app.create({type:"Campus",url:r,position:i,angles:n,isCamFitScene:o,complete:function(e){var t=e.object;s._addFromCampus(t),t.destroy(),s.dirty=!0,a&&a(),this.app.trigger("addFromCampusComplete")}})}else{var l=e.object;Z.isNull(l)||this._add(l,e,t)}}},E.prototype._add=function(e,t,r){if(!e)return!1;if(!e.isBaseObject)return!1;var i=(t=t||{}).basePoint,n=t.offset||t.localPosition,o=t.angles||t.localAngles,a=Z.parseValue(t.keepNode,!1);if(this.node.updateWorldMatrix(!0,!1),a){var s=e.parent;if(s){var l=s._children.indexOf(e);-1!==l&&s._children.splice(l,1)}e._parent=this}else{var c=Z.parseValue(t.keepLocalPosition||t.node,!1),u=Z.parseValue(t.force||t.position||t.angles||t.scale,!1);e.setParent(this,c,u)}var h=!0,p=void 0;if(Z.isString(i)){if(!(p=this._getBasePointNode(i)))return console.error("The '"+i+"' basePoint is not existing"),!1;var d=new THREE.Vector3;p.getWorldPosition(d),e.position=d.toArray(),n&&(e.position=THING.Math.addVector(e.position,n),h=!1)}else n&&(e.localPosition=n,h=!1);return o&&(e.angles=o,h=!1),h&&e._setDirtyFlag(!0,!1),this.hasChild(e)||(r>=this._children.length||-1===r?this._children.push(e):this._children.splice(r,0,e)),p&&e.node.attach(p,!0),e.node.userData.removedNode&&(e.node.visible=!0,delete e.node.userData.removedNode),!0},E.prototype.remove=function(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];if(e&&e.isBaseObject&&e.isChildOf(this)){e._setDirtyFlag(!0,!1),e.node.updateWorldMatrix(!0,!1),-1!==e.node.getParents().indexOf(this.app.scene)&&(e.node.attach(this.app.scene,!1),t&&(e.node.visible=!1,e.node.userData.removedNode=!0)),e._parent=null;var r=this._children.indexOf(e);-1!==r&&this._children.splice(r,1)}},E.prototype.swapChild=function(e,t){var r=this._children.indexOf(e),i=this._children.indexOf(t);-1!==r&&-1!==i&&THING.Math.swapArray(this._children,r,i)},E.prototype.hasChild=function(e){if(!e)return!!this._children.length;for(var t=0;t<this._children.length;t++)if(this._children[t]==e)return!0;return!1},E.prototype.destroy=function(){this.stopAllLerpTo(),this.removePickingMaterial(),this.style.glow=!1,this.tickable=!1,this.removeAllControls(),this.app.objectManager.destroy(this);for(var e=this._children.concat(),t=0;t<e.length;t++)e[t].destroy();this._children=[],this.clearAttachPoints(),this.clearNode(),this._parent&&(this._parent.remove(this),this._parent=null),this.node.parent&&this.node.parent.remove(this.node),this.app.events.unbindCallObj(null,null,null,[this]),this._lodNode=null,this._queryID="",this.style._obj=null,delete this.node.userData.getObject},E.prototype.getRaycastPosition=function(e){if(!e)return null;var t=new THREE.Raycaster;t.ray.origin=Z.parseVector3(this.position),t.ray.direction=Z.parseVector3(e);var r=t.intersectObject(this.app.scene,!0);if(!r.length)return null;for(var i=0;i<r.length;i++){var n=r[i],o=n.object;if(this.app.objectManager.getAncestors(o)&&!o.isChildOf(this.node))return n.point.toArray()}return null},E.prototype.removePickingMaterial=function(){this.app.picker.removePickingMaterial(this.node)},E.prototype.synPickable=function(){var e=this._pickable;this.node.setPickable(e);for(var t=0;t<this._children.length;t++)this._children[t].pickable=e;this.removePickingMaterial()},E.prototype.worldToSelf=function(e){var t=Z.parseVector3(e);return this.node.worldToLocal(t).toArray()},E.prototype.selfToWorld=function(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1];if(e=Z.parseVector3(e),this.node.updateMatrixWorld(),t){var r=new THREE.Vector3,i=new THREE.Vector3,n=new THREE.Quaternion;this.node.matrixWorld.decompose(r,n,i);var o=new THREE.Matrix4;return o.compose(r,n,new THREE.Vector3(1,1,1)),e.applyMatrix4(o).toArray()}return this.node.localToWorld(e).toArray()},E.prototype.localToWorld=function(e){return this._parent?this._parent.selfToWorld(e):this.node.localToWorld(Z.parseVector3(e)).toArray()},E.prototype.worldToLocal=function(e){if(this._parent)return this._parent.worldToSelf(e);var t=Z.parseVector3(e);return this.node.worldToLocal(t).toArray()},E.prototype.distanceTo=function(e){return e?(e.isBaseObject&&(e=e.position),Z.parseVector3(this.position).distanceTo(Z.parseVector3(e))):0},E.prototype.lookAt=function(e,t){if(e){var r,i,n;if(t=t||{},Z.isArray(t)?r=t:(r=t.angles,i=Z.parseValue(t.lockYAxis,!1)),!(n=e.isBaseObject?e.node.position:e._isCameraController?e.cameraObject.node.position:Z.parseVector3(e)))return void console.error("lookAt failed, due to target is not existing");this._lookingAtObject={target:e,targetPosition:n,type:"axis",axis:i?"y":null,quat:Z.parseQuaternion(r)},Z.parseValue(t.always,!0)?this.tickable=!0:(this.node._lookAtPosition(this._lookingAtObject,this.static),this._lookingAtObject=null)}else this._lookingAtObject=null},E.prototype.rotate=function(e,t){var r=THING.Math.degToRad(e);(t=Z.parseVector3(t||[0,1,0])).normalize(),this.node.rotateOnAxis(t,r),this.synIndependentWorldAngles(),this.dirty=!0},E.prototype.rotateX=function(e){isNaN(e)||(this.node.rotateX(THING.Math.degToRad(e)),this._synWorldAngles())},E.prototype.rotateY=function(e){isNaN(e)||(this.node.rotateY(THING.Math.degToRad(e)),this._synWorldAngles())},E.prototype.rotateZ=function(e){isNaN(e)||(this.node.rotateZ(THING.Math.degToRad(e)),this._synWorldAngles())},E.prototype.rotateAround=function(e){var a=(e=e||{}).object,s=e.target,l=Z.parseValue(e.yRotateAngle||e.angle,0),c=Z.parseValue(e.xRotateAngle,0),t=e.time,u=e.speed,r=Z.parseLoopType(e.loopType),h=e.stop,p=e.update,i=e.complete;if(s=s instanceof E?(a=s,null):Z.parseVector3(s),t){if(u=0,!l&&!c)return void console.error("Please provide yRotateAngle or xRotateAngle to rotate around object")}else t=u?16777215:l||c?(u=0,1e3):(u=10,16777215);var n=Z.parseVector3(this.position),d=new THREE.Spherical,o=n.clone(),f=s||Z.parseVector3(a.position);o.sub(f),d.setFromVector3(o),this.stopRotating(),this.rotating=!0;var m=this.position,g=new THREE.Vector3,v=d.theta,y=d.phi,b=this,x=function(){r==THREE.LoopOnce?i&&i():r==THREE.LoopRepeat?(b.position=m,b.rotateAround(e)):r==THREE.LoopPingPong&&(void 0!==l&&(e.yRotateAngle=-l),void 0!==c&&(e.xRotateAngle=-c),b.rotateAround(e))};this.rotateTween=new TWEEN.Tween({progress:0}).to({progress:1},t).easing(S.Linear.None).onStop(function(){h&&h()}).onUpdate(function(){(function(){var e=!1;if(u){var t=0<l?u:-1*u;d.theta+=t/1e3;var r=v+THING.Math.degToRad(l);0<l?d.theta>=r&&(d.theta=r,e=!0):d.theta<=r&&(d.theta=r,e=!0)}else{var i=this._object.progress;l&&(d.theta=v+i*THING.Math.degToRad(l)),c&&(d.phi=y+i*THING.Math.degToRad(c))}var n=s?s.clone():Z.parseVector3(a.position);if(d.radius=b.distanceTo(n.toArray()),d.makeSafe(),g.setFromSpherical(d),n.add(g),b.node.position.copy(n),p&&p(),e){var o=h;h=null,this.stop(),h=o,x.call(this)}}).call(this)}).onComplete(function(){x.call(this)}),this.rotateTween.start()},E.prototype.rotateOnWorldAxis=function(e){e=e||{};var t=Z.parseVector3(e.axis),r=e.angle;if(t&&r){t.normalize();var i=THING.Math.degToRad(r);this.node.rotateOnWorldAxis(t,i),this.static&&this.node._synMatrixWorld()}},E.prototype.rotateTo=function(e){var t=(e=e||{}).angles||e.localAngles,r=e.time,i=e.speed,n=e.lerpType||S.Linear.None,o=e.loopType||P.No,a=e.complete,s=Z.parseVector3(this.angles),l=s.clone(),c=Z.parseVector3(t),u=Z.getConsumeTime(null,s,c,r,i,2e3);this.stopRotating(),this.rotating=!0;var h=this;this.rotateTween=new TWEEN.Tween(s).to(c,u).easing(n).onUpdate(function(){h.angles=[this._object.x,this._object.y,this._object.z]}).onComplete(function(){o==P.Repeat?(h.angles=l.toArray(),h.rotateTo(e)):o==P.PingPong?(e.angles=l.toArray(),h.rotateTo(e)):a&&a.call(h,{object:h})}).start()},E.prototype.stopRotating=function(){this.rotating=!1,this.rotateTween&&this.rotateTween.stop()},E.prototype.scaleTo=function(e){var t=(e=e||{}).scale||[1,1,1],r=e.time,i=e.speed,n=e.lerpType||S.Linear.None,o=e.loopType||P.No,a=e.complete;t[2]=t[2]||1;var s=Z.parseVector3(this.scale),l=s.clone(),c=Z.parseVector3(t),u=Z.getConsumeTime(null,s,c,r,i,2e3);this.stopScaling(),this.scaling=!0;var h=this;this.scaleTween=new TWEEN.Tween(s).to(c,u).easing(n).onUpdate(function(){h.scale=[this._object.x,this._object.y,this._object.z]}).onStop(function(){}).onComplete(function(){o==P.Repeat?(h.scale=l.toArray(),h.scaleTo(e)):o==P.PingPong?(e.scale=l.toArray(),h.scaleTo(e)):a&&a.call(h,{object:h})}).start()},E.prototype.stopScaling=function(){this.scaling=!1,this.scaleTween&&this.scaleTween.stop()},E.prototype._createDispatchEvent=function(e){var t=this.app.events,r={};if(g[e]){var i=t.mouseMovePos;r=t.createMouseEvent(e,{clientX:i[0],clientY:i[1]})}return r},E.prototype._on=function(e,t,r,i,n,o){return this.app.events.bindCallObj(e,t,r,i,this,n,!1,o)},E.prototype._off=function(e,t,r){return this.app.events.unbindCallObj(e,t,r,this)},E.prototype._one=function(r,e,t,i,n,o){var a=Z.parseEvent(e,t,i,n,o);return this.app.events.bindCallObj(r,a.selector,a.userData,function e(t){a.callback.call(t.object,t),t.object.off(r,e),t.__ret__="__one_then_off__"},this,a.tag,!0,a.priority)},E.prototype._pauseEvent=function(e,t,r,i){this.app.events.pauseEvent(e,t,r,i,this)},E.prototype.on=function(e,t,r,i,n,o){for(var a=this._on(e,t,r,i,n,o),s=0;s<this._controls.length;s++){var l=this._controls[s].control;Z.isFunction(l.onRegisterEvent)&&l.onRegisterEvent(e,a)}return this},E.prototype.off=function(e,t,r){for(var i=this._off(e,t,r),n=0;n<this._controls.length;n++){var o=this._controls[n].control;Z.isFunction(o.onUnregisterEvent)&&o.onUnregisterEvent(e,i)}return this},E.prototype.one=function(e,t,r,i,n,o){for(var a=this._one(e,t,r,i,n,o),s=0;s<this._controls.length;s++){var l=this._controls[s].control;Z.isFunction(l.onRegisterEvent)&&this._controls.onRegisterEvent(e,a,!0)}return this},E.prototype.hasAnyEvents=function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];return this.app.events.hasAnyCallObjects([this],e)},E.prototype.hasEvent=function(e,t){var r=!(2<arguments.length&&void 0!==arguments[2])||arguments[2];return this.app.events.hasCallObjects(e,t,[this],r)},E.prototype.trigger=function(e,t,r){this.app.events.dispatchBindCallObj(e,t,[this],r)},E.prototype.pauseEvent=function(e,t,r){this._pauseEvent(e,t,r,!1)},E.prototype.pauseEventInFrame=function(e,t,r){this._pauseEvent(e,t,r,!0)},E.prototype.resumeEvent=function(e,t,r){this.app.events.resumeEvent(e,t,r,this)},E.prototype.getEvents=function(e){var t=this.app.events.getCallObjects(this);if(!t)return[];for(var r=[],i=0;i<t.length;i++){var n=t[i];e&&e!=n.eventType||r.push({type:n.eventType,callback:n.cb,priority:n.priority,userData:n.userData,tag:n.tag})}return r},E.prototype._traverseObjects=function(e,t){for(var r=0;r<this._children.length;r++){var i=this._children[r];Z.isFunction(e)?e(i):Z.isArray(e)&&e.push(i),t&&i._traverseObjects(e,t)}},E.prototype._isChildNode=function(e){for(var t=0;t<this.children.length;t++){var r=this.children[t];if(e==r.node||e.isChildOf(r.node))return!0}return!1},E.prototype._traverseSelfNodes=function(t){if(t){var r=this;this.node.traverse(function(e){r._isChildNode(e)||t(e)})}},E.prototype._traverseNodes=function(e,t,r){for(var i=0;i<e.children.length;i++){var n=e.children[i],o=n.userData.baseObject_bindSubNode;o||((o=THING.SubObject.create(n,this)).name=n.name),Z.isFunction(t)?t(o):Z.isArray(t)&&t.push(o),r&&this._traverseNodes(n,t,r)}},E.prototype.isSubNode=function(){return!!this.node.userData.baseObject_bindSubNode},E.prototype.traverse=function(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];e&&(e(this),this._traverseObjects(e,t))},E.prototype.query=function(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];if(Z.isString(e)&&e.startsWith("/"))return console.warn("[BaseObject] Please use '.subNodes.query()' to replace it, and remove '/' prefix of params"),this.subNodes.query(new RegExp(e.substring(1)),t);var r=[];this._traverseObjects(r,t);var i=new ye(this.app,r);return i.select(e),i},E.prototype._queryChild=function(e){var t=new ye(this.app,this._children);return t.select(e),t},E.prototype.isChildOf=function(e){if(!e)return!1;for(var t=this._parent;t;){if(t==e)return!0;t=t.parent}return!1},E.prototype.isBrotherOf=function(e){if(!e)return!1;var t=this._parent;return!!t&&-1!==t._children.indexOf(e)},E.prototype.clearAttachPoints=function(){if(this._attachPoints){for(var e=0;e<this._attachPoints.length;e++)this._attachPoints[e].destroy();this._attachPoints=null}},E.prototype.isAttachPoint=function(e){if(e&&e.node)for(var t=["dummy:","point:","connector:"],r=0;r<t.length;r++)if(e.name.startsWith(t[r]))return!0;return!1},E.prototype.translate=function(e){this.node.translateX(e[0]),this.node.translateY(e[1]),this.node.translateZ(e[2]),this.static&&this.node._synMatrixWorld(),this.synIndependentWorldPosition(),this.dirty=!0},E.prototype.translateX=function(e){this.translate([e,0,0])},E.prototype.translateY=function(e){this.translate([0,e,0])},E.prototype.translateZ=function(e){this.translate([0,0,e])},E.prototype.moveTo=function(e){var t=e.offset||e.offsetPosition||e.localPosition,r=e.direction;if(t)t=Z.parseVector3(t);else if(r){t=Z.parseVector3(r);var i=Z.parseValue(e.distance,5);t.multiplyScalar(i)}t&&(e.position=this.selfToWorld(t)),this.movePath(e)},E.prototype.createPathTween=function(e,t,r,i,n,o){var a,s=Z.parseVector3(e).clone(),l=Z.parseVector3(t).clone();if(r){o||(o=new THREE.Matrix4,n.updateWorldMatrix(!0,!1),o.getInverse(n.matrixWorld));var c=new THREE.Matrix4,u=s.clone(),h=l.clone();u.applyMatrix4(o),h.applyMatrix4(o),c.lookAt(h,u,this.node.up);var p=new THREE.Quaternion;if(p.setFromRotationMatrix(c),i){var d=new THREE.Quaternion;d.setFromAxisAngle(new THREE.Vector3(0,1,0),THING.Math.degToRad(i)),p.multiply(d)}a=p}return{distance:s.distanceTo(l),from:s,to:l,toQuat:a}},E.prototype.createPathTweens=function(e,t,r,i){var n=new THREE.Matrix4;e.updateWorldMatrix(!0,!1),n.getInverse(e.matrixWorld);for(var o=0;o<t.length-1;o++){var a=t[o],s=t[o+1],l=this.createPathTween(a,s,r,i,e,n);this.pathTweens.push(l)}},E.prototype.startPathTweens=function(e,t,r,a,s,l,i,c,n){var u=function(e){for(var t=0,r=0;r<e.length;r++)t+=e[r].distance;return t}(this.pathTweens);if(u){r&&(e=u/r*1e3,i=S.Linear.None);var h=-1,o={progress:u},p=function(e,t){for(var r=[],i=0;i<e.length;i++)r.push(e[i].distance/t);return r}(this.pathTweens,u),d=this;this.pathTween=new TWEEN.Tween({progress:0}).to(o,e).easing(i).delay(t).onUpdate(function(){var e=this._object.progress/u,t=Z.getArrayIndexFromProgress(d.pathTweens,e,p),r=Z.getArrayProgress(d.pathTweens,e,p),i=d.pathTweens[t];if(t!=h&&(h=t,a&&(i.fromQuat=d.node.quaternion.clone())),s)d.node.lookAt(s);else if(a)if(l){var n=c?i.fromQuat.clone():d.node.quaternion.clone();n.slerp(i.toQuat,r),d.node.quaternion.copy(n)}else d.node.quaternion.copy(i.toQuat);var o=i.from.clone();o.lerp(i.to,r),d.position=o.toArray()}).onStop(function(){}).onComplete(function(){n&&n()}).start()}},E.prototype.movePath=function(e){var t,r,i=(e=e||{}).path,n=e.time||1e3,o=Z.parseValue(e.delayTime,0),a=e.speed,s=Z.parseValue(e.local,!0),l=Z.parseValue(e.orientToPath,!1),c=e.orientToPathDegree,u=e.lookAt,h=e.loopType,p=null!==(t=e).lerp&&null!==t.lerpType&&Z.parseValue(t.lerp,!0),d=e.lerpType||S.Linear.None,f=Z.parseValue(e.smooth,!0),m=e.complete;e.loop&&(h=P.Repeat,console.warn('[BaseObject] movePath() use "loopType(THING.LoopType)" to instead "loop(Boolean)" argument'));var g=this.parents.query(".Campus")[0];if(r=g?g.node:this.node.parent,i){if(s){r.updateWorldMatrix(!0,!1);for(var v=r.matrixWorld,y=[],b=0;b<i.length;b++){var x=Z.parseVector3(i[b]);x.applyMatrix4(v),y.push(x.toArray())}i=y}1===i.length&&(i=[this.position,i[0]])}else{var E=e.position;E&&(i=[this.position,E])}if(i&&0!=i.length){u&&(l=null,u=Z.parseVector3(u)),this.stopMoving();var _=[];for(b=0;b<i.length;b++){var w=null;2==i[b].length?w=new THREE.Vector3(i[b][0],this.position[1],i[b][1]):3==i[b].length&&(w=Z.parseVector3(i[b])),_.push(w)}this.createPathTweens(r,_,l,c);var T=this.pathTweens[0].from;this.position=[T.x,T.y,T.z],e.path=i.concat();var M=this;this.startPathTweens(n,o,a,l,u,p,d,f,function(){h==P.Repeat?M.movePath(e):h==P.PingPong?(e.path.reverse(),void 0!==e.orientToPathDegree&&(e.orientToPathDegree=360-e.orientToPathDegree),M.movePath(e)):m&&m.call(M,{object:M})})}},E.prototype.stopMoving=function(){this.pathTweens=[],this.pathTween&&this.pathTween.stop()},E.prototype.hasAttribute=function(e){return Z.hasAttribute(this,e)},E.prototype.getAttribute=function(e){return Z.getAttribute(this,e)},E.prototype.setAttribute=function(e,t){return Z.setAttribute(this,e,t)},E.prototype.setAttributes=function(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];for(var r in e=e||{})(t||Z.isUndefined(this[r]))&&this.setAttribute(r,e[r])},E.prototype.selfUpdate=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,t=0;if(this._style&&Z.isFunction(this._style.update)&&(t|=this._style.update(e)),(this.style.boundingBox||this.style.orientedBoundingBox)&&(this.updateBounds(),t=!0),this._localClippingPlane){var r=this._localClippingPlaneBase.clone();r.applyMatrix4(this.node.matrixWorld),this._localClippingPlane.normal=r.normal,this._localClippingPlane.constant=r.constant,t=!0}return this._lodNode&&(this._lodNode.update(this.app.renderCamera),t=!0),this._lookingAtObject&&(this.node._lookAtPosition(this._lookingAtObject,this.static),t=!0),this._independentPosition&&(this._getIndependentControlRenderNode()._setWorldPosition(this._independentPosition.clone(),!1,this.static),t=!0),this._independentWorldAngles&&(this._getIndependentControlRenderNode()._setWorldAngles(this._independentWorldAngles.clone(),this.static),t=!0),this._independentWorldScale&&(this._getIndependentControlRenderNode()._setWorldScale(this._independentWorldScale.clone(),this.static),t=!0),t},E.prototype.update=function(e){for(var t=this.selfUpdate(e),r=0;r<this._controls.length;r++){var i=this._controls[r].control,n=i.onUpdate;n&&(t|=n.call(i,e))}return t},E.prototype._refreshBox=function(e){this._box||this.updateBounds(),e&&e();var t=new THREE.Vector3;this._box.getCenter(t),this._boxCenter=t.toArray();var r=new THREE.Vector3;this._box.getSize(r),this._boxSize=r.toArray(),this._boxRadius=r.length()},E.prototype._expandBox=function(e){var t=this;this._refreshBox(function(){t._box.union(e)})},E.prototype.updateBox=function(t){var r=this;this._refreshBox(function(){if(t){var e=new THREE.Matrix4;e.setPosition(t),r.updateBounds(),r._box.applyMatrix4(e)}})},E.prototype.updateOrientedBox=function(){if(this.orientedBoundingBoxDirty){var e=this.node.quaternion.clone();this.node.quaternion._x=0,this.node.quaternion._y=0,this.node.quaternion._z=0,this.node.quaternion._w=1;var t=this.node.scale.clone();this.node.scale.set(1,1,1);var r=this.node.position.clone();if(this.node.position.set(0,0,0),this._orientedBox)this._orientedBox.box.setFromVisibleObject(this.node);else{var i=(new THREE.Box3).setFromVisibleObject(this.node);this._orientedBox={box:i},Object.defineProperties(this._orientedBox,{angles:{get:function(){return that.angles}}})}this.node.quaternion._x=e._x,this.node.quaternion._y=e._y,this.node.quaternion._z=e._z,this.node.quaternion._w=e._w,this.node.scale.copy(t),this.node.position.copy(r),this.orientedBoundingBoxDirty=!1}},E.prototype._getSelfBox=function(){var r=new THREE.Box3;return this._traverseSelfNodes(function(e){var t=(new THREE.Box3).setFromVisibleObject(e);r.union(t)}),r},E.prototype.updateBounds=function(){return!(!this.boundingBoxDirty||(this.updateOrientedBox(),null==this._box?this._box=(new THREE.Box3).setFromVisibleObject(this.node):this._box.setFromVisibleObject(this.node),this.updateBox(),this.boundingBoxDirty=!1))},E.prototype.createGrid=function(e,t,r,i){this._grid=this.app.create({type:"Grid",size:e,divisions:t,color1:r,color2:i,parent:this}),this._grid.style.skipBoundingBox=!0,this._grid.userData.topNode=!0,this._grid.userData.skipOutline=!0,this._grid.userData.independent=!0,this._grid.canNotQueryFromSelector=!0,this._grid.translateY(-.01)},E.prototype.showGrid=function(e,t,r,i){var n=!(4<arguments.length&&void 0!==arguments[4])||arguments[4];if(Z.isBoolean(e)){var o=e;o&&(this._grid||this.createGrid(300,28,1131673,1131673)),this._grid&&(this._grid.visible=o)}else if(this._grid&&(this._grid.destroy(),this._grid=null),this.createGrid(e,t,r,i),n){var a=e;Z.isNumber(n)&&(a=n),this._grid.addPickableGround({size:a})}},E.prototype.fade=function(e,t){var r=(e=e||{}).time||1e3,i=e.complete;this.fadeTween&&this.fadeTween.stop();var n={opacity:this.style.opacity},o={opacity:t};this.visible=!0;var a=this;this.fadeTween=new TWEEN.Tween(n).to(o,r).easing(TWEEN.Easing.Linear.None).onUpdate(function(){a.style.opacity=this._object.opacity}).onComplete(function(){0==a.style.opacity&&(a.visible=!1),i&&i.call(a,{object:a})}).start()},E.prototype.fadeIn=function(e){this.style.opacity=0,this.fade(e,1)},E.prototype.fadeOut=function(e){this.style.opacity=1,this.fade(e,0)},E.prototype.setClippingPlanes=function(e){var t=(e=e||{}).height,r=Z.parseVector3(e.direction,new THREE.Vector3(0,-1,0));this._localClippingPlaneBase=new THREE.Plane(r,t),this._localClippingPlane=this._localClippingPlaneBase.clone();var i=this;this.node.traverse(function(e){e.isMesh&&(e._clip_prev_material=e.material,e.material=e.material.clone(),e.material.clippingPlanes=[i._localClippingPlane])}),this.tickable=!0},E.prototype.clearClippingPlanes=function(){this.node.traverse(function(e){e.isMesh&&(e.material=e._clip_prev_material,e.material.clippingPlanes=null)}),this._localClippingPlaneBase=null,this._localClippingPlane=null},E.prototype.toJSON=function(){var e={};return e.type=this.type,e.id=this.id,e.name=this.name,e.position=this.position,e.angles=this.angles,e.scale=this.scale,e},E.prototype.addControl=function(e,t,r){if(e){if(Z.isString(t)&&(r=r||t,t={}),!Z.isNumber(e)){if(this.hasControl(e))return console.error("The control is existing when addControl() with '"+e+"'"),null;this._controls.push({control:e,name:r});var i=e.onAdd;return Z.isFunction(i)&&i.call(e,this),this.tickable=!0,this.dirty=!0,e}for(var n=[],o=0;o<n.length;o++){var a=n[o];if(a.id==e){var s=new a.type(this);return s.setup(t),this.addControl(s)}}return null}},E.prototype.getControl=function(e){for(var t=0;t<this._controls.length;t++)if(e==this._controls[t].name)return this._controls[t].control;return null},E.prototype.removeControl=function(e){if(e){var t=!1;if(Z.isString(e)){for(var r=0;r<this._controls.length;r++)if(this._controls[r].name==e){(n=(i=this._controls[r].control).onRemove)&&n.call(i),this._controls.splice(r,1),t=!0;break}}else for(r=0;r<this._controls.length;r++)if(this._controls[r].control==e){var i,n;(n=(i=this._controls[r].control).onRemove)&&n.call(i),this._controls.splice(r,1),t=!0;break}t&&(this.dirty=!0)}},E.prototype.removeAllControls=function(){for(var e=0;e<this._controls.length;e++){var t=this._controls[e].control,r=t.onRemove;r&&r.call(t)}this._controls=[],this.dirty=!0},E.prototype.hasControl=function(e){if(Z.isString(e)){for(var t=0;t<this._controls.length;t++)if(e==this._controls[t].name)return!0}else if(-1!==this._controls.indexOf(e))return!0;return!1},E.prototype.setWorldPosition=function(e){var t=Z.parseVector3(e);this.node._setWorldPosition(t,!1,this.static),this.dirty=!0},E.prototype.setWorldAngles=function(e){var t=Z.parseQuaternion(e);this.node._setWorldAngles(t,this.static),this.boundingBoxDirty=!0},E.prototype.setWorldScale=function(e){var t=Z.parseVector3(e);this.node._setWorldScale(t,this.static),this.boundingBoxDirty=!0},E.prototype.setLocalPosition=function(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],r=Z.parseVector3(e);if(Z.parseValue(t,this._ignoreParentScale)){var i=this.node.parent;if(i){var n=new THREE.Vector3;this.node.updateWorldMatrix(!0,!1),i.getWorldScale(n),r.divide(n)}}this.localPosition=r},E.prototype.getLocalPosition=function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0],t=this.node.position.clone();if(e){var r=new THREE.Vector3;this.node.updateMatrixWorld(),this.node.getWorldScale(r),t.multiply(r)}return t.toArray()},E.prototype.getOffsetPosition=function(e){if(e=e||{},!Z.isNull(e.xAngle)||!Z.isNull(e.yAngle)){var t=Z.parseValue(e.yAngle,0),r=Z.parseValue(e.xAngle,0),i=Z.parseValue(e.distance||e.radius,this.boundingBox.radius),n=e.radiusFactor;return n&&(i=this.boundingBox.radius*n),(new THREE.Vector3).getDirectionFromAngles(t,r,i).toArray()}if(e.worldDirection){var o=Z.parseVector3(e.worldDirection),a=e.distance||e.radius;o.multiplyScalar(a);var s=Z.parseVector3(this.position);return s.add(o),this.worldToSelf(s.toArray())}},E.prototype.getWorldPosition=function(e){var t=this.getOffsetPosition(e);return this.selfToWorld(t)},E.prototype._setScale=function(e){var t=Z.parseVector3(e);this._getIndependentControlRenderNode().scale.set(t.x,t.y,t.z),this.synIndependentWorldScale(),this.static&&this.node._synMatrixWorld(),this.dirty=!0},E.prototype._getScale=function(){return this._getIndependentControlRenderNode().scale.toArray()},E.prototype._synWorldAngles=function(){this.synIndependentWorldAngles(),this.boundingBoxDirty=!0,this.updateOrientedBox(),this.static&&this.node._synMatrixWorld()},E.prototype._getAttributeFromSelfToRoot=function(e){for(var t=this;t;t=t.parent){var r=t.node.userData[e];if(r)return r}return null},E.prototype._getBaseMatrix=function(){return this._getAttributeFromSelfToRoot("_baseMatrix")},E.prototype._getStyle=function(){return this._style||(this._style=this.app.styleManager.createStyle("Default",this),this._defaultStyle=this._style),this._style},E.prototype._synStyle=function(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0];this.parent&&"Default"!==this.parent._styleStrategy&&this.changeStyle(this.parent._styleStrategy,!0,e)},E.prototype.changeStyle=function(t){var e=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],r=2<arguments.length&&void 0!==arguments[2]&&arguments[2];if(this.loaded)if(this.app.styleManager.hasStyleStrategy(t)){if(e&&this.query("*").sort().forEach(function(e){e.changeStyle(t,!1,r)}),r||this._styleStrategy!==t){this.app.needUpdate=!0,this._defaultStyle||(this._style=this.app.styleManager.createStyle("Default",this),this._defaultStyle=this._style);for(var i=["renderOrder","opacity","color","outlineColor","alwaysOnTop","wireframe","uvAnimationParams"],n=[],o=0;o<i.length;o++){var a=this._style[i[o]];n.push(a)}if("Default"===t)this._style._onLeave(),this._style=this._defaultStyle,this._style._onEnter();else{this._style._onLeave();var s=this.app.styleManager.createStyle(t,this);s&&(this._style=s,this._style._onEnter())}for(this._styleStrategy=t,o=0;o<i.length;o++)this._style[i[o]]=n[o]}}else console.warn("Style strategy "+t+" not registed.");else this.waitCommands.push({type:"ChangeObjectStyle",object:this,params:{name:t,traverse:e,force:r}})},E.prototype.canResponeEventFrom=function(e){var t=e.object;return!!(t&&t.isChildOf(this)&&"mouseover"==e.type&&t.isChildOf(this))},E.prototype.needChangeVisible=function(e){return!(this.node.layers.mask==e&&this.node.visible==e&&!function(e){for(var t=0;t<e.length;t++)if(!e[t].visible)return!0;return!1}(this.parents))},E.prototype._setVisible=function(t){if(this.needChangeVisible(t)){t&&this.node.ensureParentsVisible(t),this.node.ensureVisible(t),this.node.traverseChild(function(e){e.ensureVisible(t,!1)});for(var e=0;e<this._controls.length;e++){var r=this._controls[e].control;Z.isFunction(r.onVisible)&&r.onVisible(t)}this.app.needUpdate=!0}},E.prototype.indexOfParent=function(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0];if(!this._parent)return-1;var t=this._parent._children.indexOf(this);if(-1===t)return-1;if(e){t=0;for(var r=this._parent._children,i=0;i<r.length;i++){var n=r[i];if(n==this)return t;n.type==this.type&&t++}}return t},E.prototype.clearNode=function(e){this._url&&(this.app.modelResource.unload(this._url),this._url=null),this.app.resourceManager.remove(this.node,e)},E.prototype.cloneSelf=function(e){return this.app.create(e)},E.prototype.clone=function(e,t){var r={type:this.type,url:this.url,position:this.position,angles:this.angles,scale:this.scale,visible:this.visible,parent:t||this._parent};if(!this.url){var i=this,n=this.node.cloneByFilter(function(e){for(var t=0;t<i._children.length;t++){var r=i._children[t].node;if(e==r||e.isChildOf(r))return!1}return!0});n.traverse(function(e){e.userData={}}),r.node=n}var o=this.cloneSelf(r);if(!o)return null;if(e)for(var a=0;a<this._children.length;a++)this._children[a].clone(e,o);return o},E.prototype.getEnvMapResources=function(){for(var e=this.parents,t=0;t<e.length;t++){var r=e[t].envMapResources;if(r)return r}return null},E.prototype._synEffectRefCounts=function(){var t=this.app.sceneManager;this.node.traverse(function(e){e.technique&&e.technique.glow&&t._updatEffectRefCounts("glow",1),e.technique&&e.technique.innerGlow&&t._updatEffectRefCounts("innerGlow",1)})},E.prototype._processBillboard=function(e,t){var r=this;e.setUserDataValue("skipOutline",!0),e._lookAt(t,function(){return r.static})},E.prototype._processModel=function(){var r=this;this.node.traverse(function(e){var t=e.userData.gltfExtensions;t&&t.billboard&&(r._processBillboard(e,t.billboard),delete t.billboard)})},E.prototype.synIndependentWorldPosition=function(){if(this._independentControlFlags.hasFlags(A.Position)){var e=new THREE.Vector3;this._getIndependentControlRenderNode().getWorldPosition(e),this._independentPosition=e}},E.prototype.synIndependentWorldAngles=function(){if(this._independentControlFlags.hasFlags(A.Rotation)){var e=new THREE.Quaternion;this._getIndependentControlRenderNode().getWorldQuaternion(e),this._independentWorldAngles=e}},E.prototype.synIndependentWorldScale=function(){if(this._independentControlFlags.hasFlags(A.Scale)){var e=this._getIndependentControlRenderNode()._getWorldScale();if(this._ignoreParentScale){var t=this.node.parent;if(t){var r=t._getWorldScale();e.divide(r)}}this._independentWorldScale=e}},E.prototype.synIndependentTransform=function(){this.synIndependentWorldPosition(),this.synIndependentWorldAngles(),this.synIndependentWorldScale()},E.prototype._getIndependentControlRenderNode=function(){return this.node},E.prototype._useIndependentTransform=function(e){var t=e.matrixWorld,r=new THREE.Vector3,i=new THREE.Vector3,n=new THREE.Quaternion;if(t.decompose(r,n,i),this._independentPosition&&(r=this._independentPosition.clone()),this._independentWorldAngles&&(n=this._independentWorldAngles.clone(),!this._independentPosition)){var o=this.parent.node,a=e.getMatrixWorldFromRoot(o.parent,new THREE.Quaternion),s=new THREE.Vector3,l=new THREE.Vector3,c=new THREE.Quaternion;a.decompose(s,c,l),r=s}this._independentWorldScale&&(i=this._independentWorldScale.clone()),t.compose(r,n,i)},E.prototype._useIndependentRaycast=function(e){var t=this._getIndependentControlRenderNode();if(t)if(e){t.userData.original_raycast=t.userData.original_raycast||t.raycast;var i=this;t.raycast=function(e,t){var r=i._getIndependentControlRenderNode();return r&&i._useIndependentTransform(r),this.userData.original_raycast.call(this,e,t)}}else t.userData.original_raycast&&(t.raycast=t.userData.original_raycast,delete t.userData.original_raycast)},E.prototype._enableIndependentControl=function(){var i=this;this.node.removeBeforeRenderFunction("independentControlRender");var e=!1,t=this._independentControlFlags;if(t.hasFlags(A.Transform)){this.node.traverse(function(e){Z.backupValue(e,"frustumCulled"),e.frustumCulled=!1}),this.synIndependentTransform(),this.tickable=!0;var r=this._getIndependentControlRenderNode();r.hasBeforeRenderFunction("independentControlRender")||(i=this,r.addBeforeRenderFunction("independentControlRender",function(e,t,r){i._useIndependentTransform(this)},0)),e=!0}else this.node.traverse(function(e){Z.revertValue(e,"frustumCulled")});return t.hasFlags(A.Position)||(this._independentPosition=null),t.hasFlags(A.Rotation)||(this._independentWorldAngles=null),t.hasFlags(A.Scale)||(this._independentWorldScale=null),this._useIndependentRaycast(e),t.hasFlags(A.Style)?this.node.traverse(function(e){e.userData.__independent_style_object__=i}):this.node.traverse(function(e){delete e.userData.__independent_style_object__}),e},E.prototype.enableIndependentControl=function(e,t){return!!this._independentControlFlags.enableFlags(e,t)&&this._enableIndependentControl()},E.prototype.stopAllLerpTo=function(){for(var e=0;e<this._tweens.length;e++)this._tweens[e].tween.stop();this._tweens=[]},E.prototype.stopLerpTo=function(e){for(var t=0;t<this._tweens.length;t++)e==this._tweens[t].name&&(this._tweens[t].tween.stop(),this._tweens.splice(t--,1))},E.prototype.lerpTo=function(i,e){var t=function(e){for(var t={},r=Object.keys(e),i=0;i<r.length;i++){var n=r[i],o=e[n];if(Z.isArray(o)){var a=Z.parseVector3(o);a&&(o=a,t["__"+n+"_x"]=o.x,t["__"+n+"_y"]=o.y,t["_#vector3"+n]=o.z)}else t[n]=o}return t},n=function(e,t,r){for(var i=0;i<e.length;i++)if(!(n=e[i]).startsWith("__")){var n,o=r[n];o=n.startsWith("_#vector3")?[r["__"+(n=n.substring(9))+"_x"],r["__"+n+"_y"],o]:r[n],t[n]=o}},r=t((i=i||{}).from||{}),o=t(i.to||{}),a=i.time||1e3,s=Z.parseValue(i.delayTime,0),l=i.start,c=i.update,u=i.stop,h=i.complete,p=i.lerpType||THING.LerpType.Linear.None,d=Z.parseLoopType(i.loopType);r.__progress=Z.parseValue(r.__progress,0),o.__progress=Z.parseValue(o.__progress,1);var f=0;e&&this.stopLerpTo(e);var m=Object.keys(r),g=this,v=new TWEEN.Tween(r).to(o,a).delay(s).easing(p).onStop(function(){if(u){var e={object:g};n(m,e,this._object),n(m,g,this._object),u.call(g,e)}}).onStart(function(){var e={object:g,delta:0};n(m,e,this._object),n(m,g,this._object),l&&l.call(g,e)}).onUpdate(function(){var e=this._object.__progress-f;f=this._object.__progress;var t={object:g,delta:e};n(m,t,this._object),n(m,g,this._object),c&&c.call(g,t)}).onComplete(function(){var e=this._object.__progress-f;f=this._object.__progress;var t={object:g,delta:e};if(n(m,t,this._object),n(m,g,this._object),d==THREE.LoopOnce)h&&h.call(g,t);else if(d==THREE.LoopRepeat)g.lerpTo(i);else if(d==THREE.LoopPingPong){var r=i.from;i.from=i.to,i.to=r,g.lerpTo(i)}}).start();e&&this._tweens.push({name:e,tween:v})},E.prototype._getLinkableObjects=function(){var e=new ye(this.app),t=this.userData._Portal_;if(t){var r=this.app.query(t)[0];r&&e.add(r)}return e},E.prototype._getLinkableDoors=function(){return this._queryChild("[_Portal_]")},E.prototype._setupNavigationGraph=function(e,t){e[this.id]=e[this.id]||{};for(var r=this._getLinkableDoors(),i=0;i<r.length;i++){var n=r[i];e[n.id]=e[n.id]||{},e[this.id][n.id]=e[n.id][this.id]=t;for(var o=n._getLinkableObjects(),a=0;a<o.length;a++){var s=o[a];e[s.id]=e[s.id]||{},e[s.id][n.id]=e[n.id][s.id]=t}}},E.prototype.setupGraph=function(){if(this._graph)return this._graph;var e={};return this._setupNavigationGraph(e,1e4),this._graph=new Graph(e),this._graph},E.prototype.findPath=function(e,t){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:.1,i=this.getNavigation();return i?i.findPath({startPosition:e,endPosition:t,height:r}):null},E.prototype.getFindingPathLength=function(e,t){var r=this.findPath(e,t);return r?r.getPathLength():0},E.prototype.showNavigationHelper=function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0],t=this.getNavigation();t&&t.showHelper(e)},E.prototype.canNavigation=function(){return!1},E.prototype.getNavigation=function(e){return this.canNavigation()?(this._navigation||(this._navigation=new pe(this)),(e||this._navigation.needGen())&&this._navigation.init(e),this._navigation):null},E.prototype.getAllObjectsInChildren=function(e){console.warn("[BaseObject] Please use '.children' to replace 'getAllObjectsInChildren()'");for(var t=0;t<this._children.length;t++)e.push(this._children[t])},E.prototype.dispatch=function(e){console.warn("[BaseObject] Please use 'trigger' to replace 'dispatch' when you want to launch event"),this.trigger(e)},E.prototype.upPosition=function(e){return console.warn("[BaseObject] Please use '.this.selfToWorld([0, distance, 0])' to replace 'upPosition()'"),this.selfToWorld([0,e,0])},E.prototype.downPosition=function(e){return console.warn("[BaseObject] Please use '.this.selfToWorld([0, -distance, 0])' to replace 'downPosition()'"),this.selfToWorld([0,-e,0])},E.prototype.setPosition=function(e,t,r){console.warn("[BaseObject] Please use '.position=[x, y, z]' to replace 'setPosition()'"),this.position=[e,t,r]},E.prototype.setX=function(e){console.warn("[BaseObject] Please use '.position=[x, y, z]' to replace '.x='");var t=this.position;t[0]=e,this.position=t},E.prototype.setY=function(e){console.warn("[BaseObject] Please use '.position=[x, y, z]' to replace '.y='");var t=this.position;t[1]=e,this.position=t},E.prototype.setZ=function(e){console.warn("[BaseObject] Please use '.position=[x, y, z]' to replace '.z='");var t=this.position;t[2]=e,this.position=t},E.prototype.show=function(e){console.warn("[BaseObject] Please use '.visible=true/false' to replace 'show()'"),void 0===e&&(e=!0),this.visible=e},E.prototype.hide=function(){console.warn("[BaseObject] Please use '.visible=false' to replace 'hide()'"),this.visible=!1},E.prototype.flipVisible=function(){console.warn("[BaseObject] Please use '.visible=!.visible' to replace 'flipVisible()'"),this.visible=!this.visible},E.prototype.attr=function(){return console.warn("[BaseObject] Please use 'userData[x]' to replace 'attr()'"),0==arguments.length?this.userData:1==arguments.length?this.userData[arguments[0]]:void(2==arguments.length&&(this.userData[arguments[0]]=arguments[1]))},E.prototype.moveX=function(e){console.warn("[BaseObject] Please use '.translate([d, 0, 0])' to replace 'moveX(d)'"),this.translate([e,0,0])},E.prototype.moveY=function(e){console.warn("[BaseObject] Please use '.translate([0, d, 0])' to replace 'moveY(d)'"),this.translate([0,e,0])},E.prototype.moveZ=function(e){console.warn("[BaseObject] Please use '.translate([0, 0, d])' to replace 'moveZ(d)'"),this.translate([0,0,e])},E.prototype.hasShowBoundingBox=function(){return console.warn("[BaseObject] Please use '.style.boundingBox' to replace 'hasShowBoundingBox()'"),this.style.boundingBox},E.prototype.showBoundingBox=function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];console.warn("[BaseObject] Please use '.style.boundingBox' to replace 'showBoundingBox()'"),this.style.boundingBox=e},E.prototype.getAncestor=function(e){return console.warn("[BaseObject] Please use '.parents.query(param)' to replace '.getAncestor(param)'"),this.parents.query(e)},E.prototype.getSubNodeIndex=function(e){return console.warn('[BaseObject] we do not support ".getSubNodeIndex()" anymore, please do not use it'),-1},E.prototype.getSubNodesNumber=function(){return console.warn('[BaseObject] we do not support ".getSubNodesNumber()" anymore, please do not use it'),0},E.prototype.getSubNodeByIndex=function(e){return console.warn('[BaseObject] we do not support ".getSubNodeByIndex()" anymore, please do not use it'),null},E.prototype.removeSubNodeByIndex=function(e){console.warn('[BaseObject] we do not support ".removeSubNodeByIndex()" anymore, please do not use it')},E.prototype.insertSubNode=function(e,t){console.warn('[BaseObject] we do not support ".insertSubNode()" anymore, please do not use it')},E.prototype.createSubNode=function(e){return console.warn('[BaseObject] we do not support ".createSubNode()" anymore, please do not use it'),null},E.prototype.setPolygonOffset=function(e){console.warn("[BaseObject] Please use '.style.setPolygonOffset(params)' to replace '.setPolygonOffset(params)'"),this.style.setPolygonOffset(e)},l(E,[{key:"pickable",set:function(e){this._pickable!=e&&(this._pickable=e,this.synPickable())},get:function(){return this._pickable}},{key:"subNodes",get:function(){var e=[];this._traverseNodes(this.node,e,!0);var t=new ye(this.app,e);return t.buildReturnObject(e),t}},{key:"attachPoints",get:function(){if(!this._attachPoints){this._attachPoints=[];var i=this;this.node.traverse(function(e){var t=e.userData;if(t&&t.isBaseObject){var r=i.app.objectManager.get(t.id);i.isAttachPoint(r)&&(i._attachPoints.push(r),i.app.objectManager.destroy(r))}})}var e=new ye(this.app);return e.buildReturnObject(this._attachPoints),e}},{key:"isBaseObject",get:function(){return!0}},{key:"destroyed",get:function(){return!this._queryID}},{key:"internalUserData",get:function(){return this._internalUserData},set:function(e){this._internalUserData=e}},{key:"uuid",get:function(){return this._uuid}},{key:"type",set:function(e){this._type=e},get:function(){return this._type}},{key:"id",set:function(e){this._id=e},get:function(){return this._id}},{key:"name",set:function(e){this._name=e},get:function(){return this._name}},{key:"queryID",set:function(e){this._queryID=e},get:function(){return this._queryID}},{key:"userData",set:function(e){this._userData=e},get:function(){return this._userData}},{key:"tags",set:function(e){this._tags=e},get:function(){return this._tags}},{key:"groups",get:function(){return this._groups}},{key:"gridSize",get:function(){return this._grid.size}},{key:"renderOrder",set:function(t){this.node.traverse(function(e){e.renderOrder=t})},get:function(){return this.node.renderOrder}},{key:"controls",get:function(){return this._controls}},{key:"x",set:function(e){var t=this.position;this.position=[e,t[1],t[2]]},get:function(){return this.position[0]}},{key:"y",set:function(e){var t=this.position;this.position=[t[0],e,t[2]]},get:function(){return this.position[1]}},{key:"z",set:function(e){var t=this.position;this.position=[t[0],t[1],e]},get:function(){return this.position[2]}},{key:"position",set:function(e){e&&(this.setWorldPosition(e),this.synIndependentWorldPosition())},get:function(){this.node.updateWorldMatrix(!0,!1);var e=new THREE.Vector3;return this.node.getWorldPosition(e),e.toArray()}},{key:"localPosition",set:function(e){if(this._parent){if(this._parent.node==this.node.parent){var t=Z.parseVector3(e);this.node.position.copy(t),this.static&&this.node._synMatrixWorld()}else{var r=Z.parseVector3(e);this._parent.localToWorld(r),this.node._setWorldPosition(r,!1,this.static)}for(var i=this.parent;i;i=i.parent)i.boundingBoxDirty||i._expandBox(this.box);this._setDirtyFlag(!1,!0,!0)}},get:function(){if(!this._parent)return[0,0,0];if(this._parent.node==this.node.parent)return(e=this.node.position).toArray();var e=new THREE.Vector3;return this.node.getWorldPosition(e),this._parent.node.worldToLocal(e),e.toArray()}},{key:"angleX",set:function(e){var t=this.angles;this.angles=[e,t[1],t[2]]},get:function(){return this.angles[0]}},{key:"angleY",set:function(e){var t=this.angles;this.angles=[t[1],e,t[2]]},get:function(){return this.angles[1]}},{key:"angleZ",set:function(e){var t=this.angles;this.angles=[t[1],t[2],e]},get:function(){return this.angles[2]}},{key:"angles",set:function(e){this.node.setAngles(e),this._synWorldAngles()},get:function(){var e=this.node.parent;return e&&e.userData.childUseWorldAnglesAlways?this.worldAngles:this.node.getAngles()}},{key:"worldAngles",set:function(e){this.setWorldAngles(e),this._synWorldAngles()},get:function(){var e=new THREE.Quaternion;return this.node.getWorldQuaternion(e),Z.parseAngles(e)}},{key:"forward",get:function(){var e=new THREE.Vector3;return this.node.updateMatrixWorld(!0),this.node.getWorldDirection(e),e.normalize(),e.toArray()}},{key:"up",get:function(){var e=this.node.up.clone();return this.node.updateMatrixWorld(!0),e.transformDirection(this.node.matrixWorld),e.toArray()}},{key:"cross",get:function(){var e=Z.parseVector3(this.up),t=Z.parseVector3(this.forward),r=new THREE.Vector3;return r.crossVectors(e,t),r.normalize(),r.toArray()}},{key:"scale",set:function(e){this._setScale(e)},get:function(){return this._getScale()}},{key:"worldScale",set:function(e){this.setWorldScale(e),this.synIndependentWorldScale(),this.dirty=!0},get:function(){var e=new THREE.Vector3;return this.node.getWorldScale(e),e.toArray()}},{key:"box",get:function(){return this.updateBounds(),this._box}},{key:"boundingBox",get:function(){var i=this,e=this.box,t={min:e.min.toArray(),max:e.max.toArray(),center:this._boxCenter,size:this._boxSize,radius:this._boxRadius,getOffsetWorldPosition:function(e){var t=i.getOffsetPosition(e),r=e.ignoreScale;return i.selfToWorld(t,r)},getOrientedBox:function(){var e=i._orientedBox.box.clone().applyMatrix4(i.node.matrixWorld);return{min:e.min.toArray(),max:e.max.toArray()}}};return Object.defineProperties(t,{initSize:{get:function(){if(!i._initBoxSize){var e,t=i.app.modelResource.getBoundingBox(i.url);if(t)e=t.size.concat();else{var r=new THREE.Box3;i._traverseSelfNodes(function(e){e.isMesh&&r.union((new THREE.Box3).setFromObject(e))}),e=new THREE.Vector3,r.getSize(e),e=e.toArray()}i._initBoxSize=THING.Math.scaleVector(e,i._initScale)}return i._initBoxSize}}}),t}},{key:"radius",get:function(){return this.boundingBox.radius}},{key:"size",get:function(){return this.boundingBox.size}},{key:"center",get:function(){return this.boundingBox.center}},{key:"style",get:function(){return this._getStyle()}},{key:"catchEventAnyTime",set:function(e){this._catchEventAnyTime=e},get:function(){return this._catchEventAnyTime}},{key:"draggable",set:function(e){this._draggable!=e&&((this._draggable=e)?this.on("dragging",function(e){if(e.picked){var t=e.object;t==this&&(t.position=THING.Math.addVector(t.position,e.offsetPosition),this.trigger("drag",e))}},"__object_drag__"):this.off("dragging",null,"__object_drag__"))},get:function(){return this._draggable}},{key:"dragState",get:function(){return this._dragState}},{key:"tickable",set:function(e){this.isTickable!=e&&(this.isTickable=e,this.synTickableObject(),this.app.needUpdate=!0)},get:function(){return this.isTickable}},{key:"renderDistance",set:function(e){this._renderDistance=e,Z.isNull(e)?this.app.objectManager.removeRenderDistanceObject(this):this.app.objectManager.addRenderDistanceObject(this)},get:function(){return this._renderDistance}},{key:"shadowDistance",set:function(e){this._shadowDistance=e,Z.isNull(e)?this.app.objectManager.removeShadowDistanceObject(this):this.app.objectManager.addShadowDistanceObject(this)},get:function(){return this._shadowDistance}},{key:"visible",set:function(e){this._setVisible(e)},get:function(){return this.node.ensureVisible()}},{key:"pivot",set:function(e){if(this.node.removeBeforeRenderFunction("pivot"),e){this._pivot={},this._pivot.offset=Z.parseVector3(e);var a=this;this.node.addBeforeRenderFunction("pivot",function(e,t,r){var i=a.box.clone(),n=new THREE.Matrix4;n.getInverse(a.node.matrixWorld),i.applyMatrix4(n);var o=new THREE.Vector3;o.subVectors(i.max,i.min),o.multiply(a._pivot.offset),o.applyMatrix4(a.node.matrixWorld),this.matrixWorld.setPosition(o)}),this.tickable=!0}},get:function(){var e=this._pivot;return e?e.offset:null}},{key:"dirty",set:function(e){e?(this._setDirtyFlag(!0,!0),this.app.needUpdate=!0):this._dirtyFlags.clearFlags()},get:function(){return this._dirtyFlags.hasAnyFlags()}},{key:"boundingBoxDirty",set:function(e){this._dirtyFlags.enableFlags(E.boundingBoxDirtyFlag,e),e&&(this.app.needUpdate=!0)},get:function(){return!!this._dirtyFlags.hasFlags(E.boundingBoxDirtyFlag)||!this._box}},{key:"orientedBoundingBoxDirty",set:function(e){this._dirtyFlags.enableFlags(E.orientedBoundingBoxDirtyFlag,e),e&&(this.app.needUpdate=!0)},get:function(){return!!this._dirtyFlags.hasFlags(E.orientedBoundingBoxDirtyFlag)}},{key:"static",get:function(){return this.app.root.static}},{key:"children",get:function(){return this._children}},{key:"brothers",get:function(){var e=[],t=this._parent;if(t)for(var r=0;r<t._children.length;r++){var i=t._children[r];i!=this&&e.push(i)}var n=new ye(this.app,e);return n.buildReturnObject(e),n}},{key:"parents",get:function(){for(var e=[],t=this._parent;t;t=t.parent)e.push(t);var r=new ye(this.app,e);return r.buildReturnObject(e),r}},{key:"parent",get:function(){return this._parent}},{key:"levelFromRoot",get:function(){for(var e=0,t=this.parent;t;t=t.parent)e++;return e}},{key:"verticesNumber",get:function(){return Z.isFunction(this.node.verticesCount)?this.node.verticesCount():0}},{key:"meshNames",get:function(){return this.node.getMeshNames()}},{key:"inheritStyle",set:function(e){this.enableIndependentControl(THING.IndependentControlType.Style,e)},get:function(){return this._independentControlFlags.hasFlags(THING.IndependentControlType.Style)}},{key:"inheritPosition",set:function(e){this.enableIndependentControl(THING.IndependentControlType.Position,!e)},get:function(){return!this._independentControlFlags.hasFlags(THING.IndependentControlType.Position)}},{key:"inheritAngles",set:function(e){this.enableIndependentControl(THING.IndependentControlType.Rotation,!e)},get:function(){return!this._independentControlFlags.hasFlags(THING.IndependentControlType.Rotation)}},{key:"inheritScale",set:function(e){this.enableIndependentControl(THING.IndependentControlType.Scale,!e)},get:function(){return!this._independentControlFlags.hasFlags(THING.IndependentControlType.Scale)}},{key:"owner",get:function(){return this.parent}},{key:"CSG",get:function(){return new xe(this)}},{key:"self",get:function(){return console.warn("[BaseObject] Please do not use '.self'"),this}},{key:"custom",get:function(){return console.warn("[BaseObject] Please use '.userData' to replace '.custom'"),this.userData}},{key:"boxSize",get:function(){return console.warn("[BaseObject] Please use '.size' to replace '.boxSize'"),this.size}},{key:"boxRadius",get:function(){return console.warn("[BaseObject] Please use '.radius' to replace '.boxRadius'"),this.radius}},{key:"localAngles",set:function(e){console.warn("[BaseObject] Please use '.angles' to replace '.localAngles'"),this.angles=e},get:function(){return console.warn("[BaseObject] Please use '.angles' to replace '.localAngles'"),this.angles}},{key:"isShowBoundingBox",get:function(){return console.warn("[BaseObject] Please use '.hasShowBoundingBox()' to replace '.isShowBoundingBox'"),this.hasShowBoundingBox()}},{key:"building",get:function(){return console.warn("[BaseObject] Please use '.getAncestor('.Building')[0]' to replace '.building'"),this.parents.query(".Building")[0]}},{key:"ancestors",get:function(){return console.warn("[BaseObject] Please use '.parents' to replace '.ancestors'"),this.parents}},{key:"root",get:function(){return console.warn("[BaseObject] Please use 'this.parents.query('.Campus')[0]')' to replace '.root'"),this.parents.query(".Campus")[0]}},{key:"boxCenter",get:function(){return console.warn("[BaseObject] Please use '.center' to replace '.boxCenter'"),this.center}},{key:"lockOffset",set:function(e){console.warn("[BaseObject] Please use '.inheritPosition' to replace '.lockOffset'"),this.inheritPosition=!e},get:function(){return console.warn("[BaseObject] Please use '.inheritPosition' to replace '.lockOffset'"),!this.inheritPosition}},{key:"showDetail",set:function(e){console.warn('[BaseObject] we do not support ".showDetail" anymore, please do not use it')}}]),E}(),_e=function(){function t(e){y(this,t),this.object=null,this.app=null,this.needResponeAddEvent=e,this._textureAnimations=new Map,this._textureChecks=[{name:"baseColorTexture",property:"map"},{name:"alphaTexture",property:"alphaMap"}]}return t.prototype._init=function(e){var d=this;e&&(this._textureAnimations.clear(),e.traverse(function(e){e.material&&(Array.isArray(e.material)?e.material:[e.material]).forEach(function(p){p.userData.gltfExtensions&&d._textureChecks.forEach(function(e){var t=p.userData.gltfExtensions[e.name];if(t&&(t.scrollAnim||t.rotateAnim||t.scaleAnim||t.multiFramesAnim||t.scroll)){var r={offset:[0,0],repeat:[1,1],rotation:0},i={offset:[0,0],repeat:[0,0],rotation:0,update:null};if(t.scroll&&(r.offset[0]=t.scroll[0],r.offset[1]=t.scroll[1]),t.scrollAnim&&(i.offset[0]-=t.scrollAnim[0],i.offset[1]-=t.scrollAnim[1]),t.rotateAnim&&(i.rotation+=t.rotateAnim/180*Math.PI),t.scaleAnim,t.multiFramesAnim){var n=t.multiFramesAnim.tilesX,o=t.multiFramesAnim.tilesY,a=n*o,s=1/t.multiFramesAnim.animSpeed||1;r.repeat[0]=1/n,r.repeat[1]=1/o;var l=0,c=0;i.update=function(e,t){for(l+=t;s<l;){l-=s,++c==a&&(c=0);var r=c%n;e.offset.x=r/n;var i=Math.floor(c/n);e.offset.y=i/o}}}var u=p[e.property];if(u){var h=u.clone();h.needsUpdate=!0,h.offset.set(r.offset[0],r.offset[1]),h.repeat.set(r.repeat[0],r.repeat[1]),h.wrapS=h.wrapT=THREE.RepeatWrapping,p[e.property]=h,p.needsUpdate=!0,i.texture=h,d._textureAnimations.set(h.uuid,i)}}})})}),this._textureAnimations.size&&(this.object.tickable=!0))},t.prototype.onAdd=function(e){if(this.object=e,this.app=e.app,this._init(this.object.node),this.needResponeAddEvent){var t=this.object.node.children[0];if(t){var r=this;t.addEventListener("addedChild",function(e){r._init(e.object)})}}delete this.needResponeAddEvent},t.prototype.onRemove=function(){this._textureAnimations.clear()},t.prototype.onUpdate=function(r){return 0<this._textureAnimations.size&&(this._textureAnimations.forEach(function(e){var t=e.texture;t&&(e.update?e.update(t,r):(t.offset.x+=e.offset[0]*r,t.offset.y+=e.offset[1]*r,t.repeat.x+=e.repeat[0]*r,t.repeat.y+=e.repeat[1]*r,t.rotation+=e.rotation*r,0!==e.rotation&&t.center.set(.5,.5)))}),!0)},t}(),we=function(){function r(e,t){y(this,r),this.object=null,this.app=null,this.param=e,this.callback=t,this.loadingBox=null}return r.prototype.loadComplete=function(e,t,r){var i=(t.model=e).cloneNode();this.object.setupNode(i),this.object.synPickable(),this.object._processModel(),this.object._synEffectRefCounts();var n=t.nodeReady;n&&n.call(this.object,{object:this.object}),null!=r&&r(),this.object.removeControl(this)},r.prototype.loadModelFromURL=function(c,t){var u=this,h=this.object,e=c.url;h._url=e._trimRight("/");var r=this.app.modelResource,i=r.get(e);i?this.loadComplete(i,c,t):(h.setupUserData(),c.force=!0,h.setupParent(c),h.setupTranslation(c),h.node.updateMatrixWorld(),r.download(e,function(e){var t=h.app.options.showLoadingBox,r=e.size;if(t&&r){var i=r[0],n=r[2],o=r[1],a=new THREE.BoxGeometry(i,n,o,1,1,1),s=new THREE.MeshPhongMaterial({color:2200782,transparent:!0});u.loadingBox=new THREE.Mesh(a,s),u.loadingBox.material.opacity=.01,u.loadingBox.position.y+=n/2,u.loadingBox.userData.size=[i,n,o],u.loadingBox.userData.curProgress=.01,h.pickable||(u.loadingBox.userData.skipPick=!0),u.loadingBox.userData.skipStyle=!0,h.setupParent(c),h.node.add(u.loadingBox)}var l=c.nodeReady;l&&l.call(h,{object:h,jsonData:e})},function(e){return!h.destroyed&&(u.loadingBox&&(u.loadingBox.material.dispose(),u.loadingBox.geometry.dispose(),u.loadingBox.removeBySelf()),Z.backupValue(c,"nodeReady"),c.nodeReady=null,u.loadComplete(e,c,function(){t&&t()}),Z.revertValue(c,"nodeReady"),!0)},function(e){var t=Math.max(.01,e.progress),r=u.loadingBox;r&&r.material&&(r.userData.curProgress=Math.max(r.userData.curProgress,t),r.material.opacity=r.userData.curProgress);var i=c.progress;i&&i.call(h,{object:h,progress:t}),u.object.trigger("progress",{object:h,progress:t})},function(e){var t=c.error;t&&t()}))},r.prototype.onAdd=function(e){this.object=e,this.app=e.app,this.loadModelFromURL(this.param,this.callback),delete this.param,delete this.callback},r}(),Te=function(r){function i(e){y(this,i);var t=p(this,r.call(this,e));return t._textureAnimationControl=null,t}return u(i,r),i.prototype.setupTextureAnimations=function(){this._textureAnimationControl=new _e(!0),this.addControl(this._textureAnimationControl)},i.prototype.customSetup=function(e){this.setupTextureAnimations(e)},i.prototype.loadFromURL=function(e,t){this.addControl(new we(e,t))},l(i,[{key:"isFacade",get:function(){return!0}},{key:"isOutdoors",get:function(){return!0}},{key:"building",get:function(){return this.parents.query(".Building")[0]}}]),i}(Ee),Me=function(){function t(e){y(this,t),this.object=null,this.animations=e,this.animationClips=null,this.animationPlayingActions=[],this.animationActions=[],this.animationMixer=null}return t.prototype.init=function(e){var n=this;this.animationClips=e,this.animationMixer=new THREE.AnimationMixer(this.object.node);for(var t=0;t<this.animationClips.length;t++){var r=this.animationMixer.clipAction(this.animationClips[t]);this.animationActions.push(r)}this.animationMixer.addEventListener("loop",function(e){}),this.animationMixer.addEventListener("finished",function(e){var t=e.action;t.setEffectiveTimeScale(0);var r=t.complete;if(r){var i=t.getClip().name;r.call(n.object,i)}})},t.prototype.onAdd=function(e){this.object=e,this.app=e.app,this.init(this.animations),delete this.animations},t.prototype.onRemove=function(){this.animationMixer&&(this.animationClips=null,this.animationActions=[],this.animationMixer=null)},t.prototype.onUpdate=function(e){var t=this.animationMixer;if(t){var r=t.isRunning();if(this.app.root.static&&r){var i=this.object.box;this.app.camera.frustum.intersectsBox(i)&&this.object.node._synMatrixWorld()}return t.update(e),r}return!1},t.prototype.containAnimation=function(e){if(this.animationClips)for(var t=0;t<this.animationClips.length;t++)if(this.animationClips[t].name===e)return!0;return!1},t.prototype._updatePlayingAnimation=function(e){for(var t=0;t<this.animationPlayingActions.length;++t)if(this.animationPlayingActions[t]==e)return;this.animationPlayingActions.push(e)},t.prototype.stopAnimation=function(e){if(e){if(Z.isArray(e))for(n=0;n<this.animationPlayingActions.length;n++){for(var t=this.animationPlayingActions[n],r=!1,i=0;i<e.length;i++)if(e[i]==t.getClip().name){r=!0;break}r||(t.stop(),this.animationPlayingActions.splice(n,1),n--)}else if(Z.isString(e)){for(n=0;n<this.animationPlayingActions.length;n++)e!=(t=this.animationPlayingActions[n]).getClip().name&&(t.stop(),this.animationPlayingActions.splice(n,1),n--);for(n=0;n<this.animationPlayingActions.length;++n)this.animationPlayingActions[n].stop()}}else for(var n=0;n<this.animationPlayingActions.length;++n)this.animationPlayingActions[n].stop()},t.prototype.playAnimation=function(e,t){var r=(t=t||{}).speed||1,i=Z.parseValue(t.reverse,!1),n=Z.parseLoopType(t.loopType||t.loop),o=t.loopTimes||1/0,a=t.frames||null,s=t.complete,l=THREE.AnimationClip.findByName(this.animationClips,e);if(!l)return console.error("The '"+e+"' animation is not existing"),!1;var c=this.animationMixer.clipAction(l);if(!c)return!1;r=1/r;var u=i?-r:r,h=u,p=c.isRunning();if(i&&n==THREE.LoopOnce&&(o=p?0:1,n=THREE.LoopRepeat),c.complete=s,c.paused=!1,c.clampWhenFinished=!0,c.setEffectiveTimeScale(u),c.setEffectiveWeight(1),c.setDuration(h),c.setLoop(n,o),a){var d=0,f=1;Z.isArray(a)?(d=a[0],f=1<a.length?a[1]:1):Z.isNumber(a)?d=a:console.error("animation frames is invalid"),c.warp(d,f,h)}else c.stopWarping();return p||(c.isScheduled()?c.reset():c.play(),this._updatePlayingAnimation(c)),!0},t.prototype.isPlayingAnimation=function(e){return!!this.animationMixer&&this.animationMixer.isRunning(e)},l(t,[{key:"animationNames",get:function(){var e=[];if(this.animationClips)for(var t=0;t<this.animationClips.length;t++)e.push(this.animationClips[t].name);return e}}]),t}(),Se=function(r){function i(e){y(this,i);var t=p(this,r.call(this,e));return t._url="",t._textureAnimationControl=null,t._animationControl=null,t}return u(i,r),i.prototype.loadModelResource=function(r){var i=(r=r||{}).url;if(i){var e=this.style,n={renderOrder:0,opacity:1,color:null,outlineColor:null,edgeColor:null,alwaysOnTop:!1,image:null};for(var t in n){var o=n[t];n[t]=e[t],e[t]=o}this._url&&(this.app.modelResource.unload(this._url),this._url=null);for(var a=this.node.children.concat(),s=0;s<a.length;s++)this.app.resourceManager.remove(a[s],!1);var l=this;this.loadFromURL(r,function(){for(var e in l._initBoxSize=null,l.customSetup(r),n)l.style[e]=n[e];var t=r.complete;t&&t.call(l,{object:l,url:i})})}},i.prototype.setupCustomKeys=function(e){var t=Z.parseValue(e.ON_IU,"oniu"),r=Z.parseValue(e.SJGN_IHT,"sjgniht"),i=Z.parseValue(e.IJ_EKOU_NUOY,"ijekounuoy"),n=Z.parseValue(e.RE_ISRAT,"reisrat");"naijil"!=t&&"NA_IJ_IL"!=t||(this.userData.bindFeatureOn=t),"auhnujuw"!=r&&"AU_HN_UJ_UW"!=r||(this.userData.SightTestOn=r),"nahoanehc"!=i&&"NA_HO_AN_EHC"!=i||(this.userData.LoopControlOn=i),"eilam"!=n&&"EI_LAM"!=n||(this.userData.bindFeatureOn=n)},i.prototype.setupAnimations=function(e){this.removeControl(this._animationControl);var t=e.animations,r=e.model;if(r&&(t||(t=r.animations)),t&&t.length){this._animationControl=new Me(t),this.addControl(this._animationControl);var i=e.animation;i&&this.playAnimation(i)}},i.prototype.setupTextureAnimations=function(){this.removeControl(this._textureAnimationControl),this._textureAnimationControl=new _e,this.addControl(this._textureAnimationControl)},i.prototype.setupRoomOwner=function(e){var t=e.belongRoomUserID;t&&(this._belongRoomUserID=t)},i.prototype.customSetup=function(e){this.setupAnimations(e),this.setupTextureAnimations(e),this.setupCustomKeys(e),this.setupRoomOwner(e)},i.prototype.loadFromURL=function(e,t){this.addControl(new we(e,t))},i.prototype.containAnimation=function(e){return!!this._animationControl&&this._animationControl.containAnimation(e)},i.prototype.playAnimation=function(e){if(e=e||{},this.loaded){if(Z.isString(e))return this._stopAnimation(e),void this._playAnimation(e,null);var t=e.name;if(Z.isString(t))return this._stopAnimation(t),void this._playAnimation(t,e);if(Z.isArray(t)&&t.length){if(1==t.length)return this._stopAnimation(t[0]),void this._playAnimation(t[0],e);e=Z.cloneObject(e);var r=Z.parseArrayArgument(t,e,"speed"),i=Z.parseArrayArgument(t,e,"reverse"),n=Z.parseArrayArgument(t,e,"loop"),o=Z.parseArrayArgument(t,e,"loopType"),a=Z.parseArrayArgument(t,e,"loopTimes"),s=Z.parseArrayArgument(t,e,"frames");this._stopAnimation(t);for(var l=0;l<t.length;l++)Z.getArrayArgumentValue(e,"speed",r,l),Z.getArrayArgumentValue(e,"reverse",i,l),Z.getArrayArgumentValue(e,"loop",n,l),Z.getArrayArgumentValue(e,"loopType",o,l),Z.getArrayArgumentValue(e,"loopTimes",a,l),Z.getArrayArgumentValue(e,"frames",s,l),this._playAnimation(t[l],e)}}else this.waitCommands.push({type:"PlayObjectAnimation",object:this,params:e})},i.prototype._stopAnimation=function(e){this._animationControl&&this._animationControl.stopAnimation(e)},i.prototype._playAnimation=function(e,t){this._animationControl&&!this._animationControl.playAnimation(e,t)||(this.tickable=!0)},i.prototype.stopAnimation=function(){this._animationControl&&this._animationControl.stopAnimation(),this.tickable=!1},i.prototype.isPlayingAnimation=function(e){return!!this._animationControl&&this._animationControl.isPlayingAnimation(e)},i.prototype.toJSON=function(){var e=r.prototype.toJSON.call(this);return e.type="Thing",this._url&&(e.url=this._url),e},l(i,[{key:"isThing",get:function(){return!0}},{key:"animationNames",get:function(){return this._animationControl?this._animationControl.animationNames:[]}},{key:"url",get:function(){return this._url}},{key:"isOutdoors",get:function(){return!this.parents.query(".Building").length}},{key:"floor",get:function(){return this.parents.query(".Floor")[0]}},{key:"building",get:function(){return this.parents.query(".Building")[0]}},{key:"_temp_roomID",get:function(){return this._belongRoomUserID}}]),i}(Ee),Re=function(r){function i(e){y(this,i);var t=p(this,r.call(this,e));return t.sprite=null,t.spriteVisible=!0,t.onTop=!1,t.progress=0,t}return u(i,r),i.prototype.canNotQueryFromSelector=function(){return!0},i.prototype.customSetup=function(e){var t=e.scene,r=e.height,i=e.onTop,n=this.app.calcRect();this.onTop=i;var o=new THREE.SpriteMaterial({opacity:.8,color:34816,transparent:!0});this.sprite=new THREE.Sprite(o),this.sprite.scale.set(2*n.width,r,1),this.updatePosition(n.width,n.height),t.add(this.sprite)},i.prototype.updatePosition=function(e,t){if(void 0===e||void 0===t){var r=this.app.calcRect();e=r.width,t=r.height}var i=this.sprite,n=-e/2,o=this.onTop?t/2-i.scale.y/2:-t/2+i.scale.y/2;i.position.set(n,o,-10)},i.prototype.updateProgress=function(e){if(!this.sprite)return!1;if(this.progress==e)return!1;this.progress=e;var t=this.app.calcRect();if(e<1&&0!=e)this.sprite.visible=this.spriteVisible;else{var r=this;setTimeout(function(){r.sprite&&(r.spriteVisible=!1,r.sprite.visible=!1)},1e3)}var i=Math.max(1,2*t.width*e);return this.sprite.scale.x=i,!0},i.prototype.resize=function(e,t){if(this.sprite){this.updatePosition(e,t);var r=Math.max(1,2*e*this.progress);this.sprite.scale.x=r}},i.prototype.prepare=function(){this.sprite.scale.x=1e-4,this.spriteVisible=!0},l(i,[{key:"visible",set:function(e){this.spriteVisible=e},get:function(){return this.spriteVisible}},{key:"height",set:function(e){this.sprite.scale.y=e},get:function(){return this.sprite.scale.y}}]),i}(Ee),Pe={};me=Pe,ge=Math.PI/180,me.transformSVGPath=function(n){var e,t,r,i,o=new THREE.ShapePath,a=1,s=n.length,l=0,c=0,u=0,h=0,p=null,d=null,f=0,m=0,g=0,v=0,y=0,b=0,x=0,E=0,_=0;function w(){for(var e,t,r,i=!1;a<s&&(44===(t=n.charCodeAt(a))||32===t);)a++;for(e=45===t?a++:a;a<s;)if(48<=(t=n.charCodeAt(a))&&t<=57)a++;else{if(46!==t)return r=n.substring(e,a),i?parseFloat(r):parseInt(r);a++,i=!0}return r=n.substring(e),i?parseFloat(r):parseInt(r)}function T(){for(var e;a<s&&(44===(e=n.charCodeAt(a))||32===e);)a++;return 45===(e=n.charCodeAt(a))||48<=e&&e<=57}for(e=n[0];a<=s;){switch(i=!0,e){case"M":l=w(),c=w(),o.moveTo(l,c),e="L",p=l,d=c;break;case"m":l+=w(),c+=w(),o.moveTo(l,c),e="l",p=l,d=c;break;case"Z":case"z":i=!1,l===p&&c===d||o.lineTo(p,d);break;case"L":case"H":case"V":u="V"===e?l:w(),h="H"===e?c:w(),o.lineTo(u,h),l=u,c=h;break;case"l":case"h":case"v":u="v"===e?l:l+w(),h="h"===e?c:c+w(),o.lineTo(u,h),l=u,c=h;break;case"C":f=w(),g=w();case"S":"S"===e&&(f=2*l-m,g=2*c-v),m=w(),v=w(),u=w(),h=w(),o.bezierCurveTo(f,g,m,v,u,h),l=u,c=h;break;case"c":f=l+w(),g=c+w();case"s":"s"===e&&(f=2*l-m,g=2*c-v),m=l+w(),v=c+w(),u=l+w(),h=c+w(),o.bezierCurveTo(f,g,m,v,u,h),l=u,c=h;break;case"Q":f=w(),g=w();case"T":"T"===e&&(f=2*l-f,g=2*c-g),u=w(),h=w(),o.quadraticCurveTo(f,g,u,h),l=u,c=h;break;case"q":f=l+w(),g=c+w();case"t":"t"===e&&(f=2*l-f,g=2*c-g),u=l+w(),h=c+w(),o.quadraticCurveTo(f,g,u,h),l=u,c=h;break;case"A":y=w(),b=w(),x=w()*ge,E=w(),_=w(),u=w(),h=w(),y!==b&&console.warn("Forcing elliptical arc to be a circular one:",y,b),f=Math.cos(x)*(l-u)/2+Math.sin(x)*(c-h)/2,g=-Math.sin(x)*(l-u)/2+Math.cos(x)*(c-h)/2;var M=Math.sqrt((y*y*b*b-y*y*g*g-b*b*f*f)/(y*y*g*g+b*b*f*f));E===_&&(M=-M),m=M*y*g/b,v=M*-b*f/y,t=Math.cos(x)*m-Math.sin(x)*v+(l+u)/2,r=Math.sin(x)*m+Math.cos(x)*v+(c+h)/2;var S=new THREE.Vector2(1,0),R=new THREE.Vector2((f-m)/y,(g-v)/b),P=Math.acos(S.dot(R)/S.length()/R.length());S.x*R.y-S.y*R.x<0&&(P=-P),S.x=(-f-m)/y,S.y=(-g-v)/b;var A=Math.acos(R.dot(S)/R.length()/S.length());R.x*S.y-R.y*S.x<0&&(A=-A),!_&&0<A&&(A-=2*Math.PI),_&&A<0&&(A+=2*Math.PI),o.absarc(t,r,y,P,P+A,_),l=u,c=h;break;default:throw new Error("Wrong path command: "+e)}i&&T()||(e=n[a++])}return o};var Ae=function(n){function t(e){return y(this,t),p(this,n.call(this,e))}return u(t,n),t.prototype.createMaterial=function(e){if(!e)return new THREE.MeshPhongMaterial({color:2200782});var t=Z.parseColor(e.color,2200782),r=e.opacity||1,i=r<1,n=e.doubleSide||!1,o=void 0;(o=e.disableLight?new THREE.MeshBasicMaterial({color:t}):new THREE.MeshPhongMaterial({color:t})).transparent=i,o.opacity=r,n&&(o.side=THREE.DoubleSide);var a=e.image;if(a){var s=null;if(Z.isString(a)){var l=this.app.confirmURL(a);if(l){var c=new THREE.TextureLoader;c.setCrossOrigin("anonymous"),s=c.load(l)}}else a.width&&a.height&&(s=this.app.resourceManager.loadTexture(a));s&&(o.map=s)}return o},t.prototype.createGeometry=function(e){return null},t.prototype.createMesh=function(e){var t=this.createGeometry(e);if(t){var r=this.createMaterial(e.style);return new THREE.Mesh(t,r)}return null},t.prototype.setup=function(e){var t=this.createMesh(e);if(t){t.castShadow=!0,t.receiveShadow=!0;var r=e.center;if(r&&"Bottom"==r){var i=e.height||1;t.translateY(.5*i)}this.node.add(t)}this.style.skipEnvMap=!0,n.prototype.setup.call(this,e)},t.prototype.addPickableGround=function(e){var t=this.app.create({type:"Plane",width:e,height:e,visible:!1,parent:this,style:{doubleSide:!0}}),r=t.node;return r.skipBoundingBox(!0),r.userData.topNode=!0,r.userData.skipOutline=!0,r.userData.independent=!0,r.userData.alwaysPickable=!0,r.canNotQueryFromSelector=!0,this.app.objectManager.addInteractableNode(r),t},t.prototype.pickGroundWorldPosition=function(e,t,r){if(Z.isArray(t)&&void 0===r){var i=t;t=i[0],r=i[1]}var n=this.app.camera.getRaycaster(t,r).intersectObjectForcible(e.node,!0);return n.length?n[0].point.toArray():null},t}(Se),Ce=function(r){function i(e){y(this,i);var t=p(this,r.call(this,e));return t._width=0,t._height=0,t._depth=0,t._center="",t}return u(i,r),i.prototype.createGeometry=function(e){this._width=e.width||1,this._height=e.height||1,this._depth=e.depth||1,this._center=e.center;var t=e.widthSegments||1,r=e.heightSegments||1,i=e.depthSegments||1;return new THREE.BoxGeometry(this._width,this._height,this._depth,t,r,i)},l(i,[{key:"isBox",get:function(){return console.warn("[Box] Please use 'instanceof THING.Box' to replace '.isBox'"),this instanceof THING.Box}}]),i}(Ae),Le=function(t){function r(e){return y(this,r),p(this,t.call(this,e))}return u(r,t),r.prototype.createGeometry=function(e){var t=e.radius,r=e.segments,i=e.thetaStart,n=e.thetaLength;return new THREE.CircleGeometry(t,r,i,n)},r}(Ae),Oe=function(t){function r(e){return y(this,r),p(this,t.call(this,e))}return u(r,t),r.prototype.createGeometry=function(e){var t=e.radius||1,r=e.widthSegments||8,i=e.heightSegments||6,n=e.phiStart||0,o=e.phiLength||2*Math.PI,a=e.thetaStart||0,s=e.thetaLength||Math.PI;return new THREE.SphereGeometry(t,r,i,n,o,a,s)},l(r,[{key:"isSphere",get:function(){return console.warn("[Sphere] Please use 'instanceof THING.Sphere' to replace '.isSphere'"),this instanceof THING.Sphere}}]),r}(Ae),He=function(r){function i(e){y(this,i);var t=p(this,r.call(this,e));return t._ground=null,t._groundSize=0,t}return u(i,r),i.prototype.destroy=function(){this._ground&&this.app.objectManager.removeInteractableNode(this._ground.node),r.prototype.destroy.call(this)},i.prototype.createGeometry=function(e){var t=e.width||1,r=e.height||1,i=e.widthSegments||1,n=e.heightSegments||1;return new THREE.PlaneGeometry(t,r,i,n)},i.prototype.addPickableGround=function(e){this._groundSize=e.size,this._groundSize&&(this._ground=r.prototype.addPickableGround.call(this,this._groundSize))},i.prototype.pickGroundWorldPosition=function(e,t){return this._ground?r.prototype.pickGroundWorldPosition.call(this,this._ground,e,t):null},l(i,[{key:"isPlane",get:function(){return console.warn("[Plane] Please use 'instanceof THING.Plane' to replace '.isPlane'"),this instanceof THING.Plane}}]),i}(Ae),Fe=function(r){function i(e){y(this,i);var t=p(this,r.call(this,e));return t._color1=null,t._color2=null,t._size=0,t._divisions=0,t}return u(i,r),i.prototype.createMesh=function(e){return this._color1=Z.parseColor(e.color1,16777215),this._color2=Z.parseColor(e.color2,16777215),this._size=e.size||10,this._divisions=e.divisions||10,new THREE.GridHelper(this._size,this._divisions,this._color1,this._color2)},l(i,[{key:"size",get:function(){return this._size}}]),i}(Ae),ke=function(t){function r(e){return y(this,r),p(this,t.call(this,e))}return u(r,t),r.prototype.createGeometry=function(e){var t=e.height||1,r=e.radius||.5,i=e.radiusTop?e.radiusTop:r,n=e.radiusBottom?e.radiusBottom:r,o=e.radiusSegments||8,a=e.heightSegments||1,s=e.heightSegments||!1,l=e.heightSegments||0,c=e.heightSegments||2*Math.PI;return new THREE.CylinderGeometry(i,n,t,o,a,s,l,c)},l(r,[{key:"isCylinder",get:function(){return console.warn("[Cylinder] Please use 'instanceof THING.Cylinder' to replace '.isCylinder'"),this instanceof THING.Cylinder}}]),r}(Ae),Ie=function(t){function r(e){return y(this,r),p(this,t.call(this,e))}return u(r,t),r.prototype.createGeometry=function(e){var t=e.radius||1,r=e.detail||0;return new THREE.TetrahedronGeometry(t,r)},l(r,[{key:"isTetrahedron",get:function(){return console.warn("[Tetrahedron] Please use 'instanceof THING.Tetrahedron' to replace '.isTetrahedron'"),this instanceof THING.Tetrahedron}}]),r}(Ae),je=function(t){function r(e){return y(this,r),p(this,t.call(this,e))}return u(r,t),r.prototype.createMaterial=function(e){return new THREE.MeshBasicMaterial({color:"#0aa5ff",opacity:.5,transparent:!0,side:THREE.DoubleSide})},r.prototype.createGeometry=function(e){var t=e.fov||45,r=e.aspect||2,i=e.length||10,n=i*Math.tan(.5*t*.017453293),o=r*n,a=new THREE.Geometry;return a.vertices=[new THREE.Vector3(0,0,0),new THREE.Vector3(o,-n,-i),new THREE.Vector3(o,n,-i),new THREE.Vector3(-o,n,-i),new THREE.Vector3(-o,-n,-i)],a.faces=[new THREE.Face3(0,1,2),new THREE.Face3(0,2,3),new THREE.Face3(0,3,4),new THREE.Face3(0,4,1),new THREE.Face3(3,4,1),new THREE.Face3(3,1,2)],a},r}(Ae),Ne=function(s){function r(e){y(this,r);var t=p(this,s.call(this,e));return t._vertices=null,t._height=0,t}return u(r,s),r.prototype.addGeoObject=function(e,t){for(var r={generateTopUV:function(e,t,r,i,n){var o=t[3*r],a=t[3*r+1],s=t[3*i],l=t[3*i+1],c=t[3*n],u=t[3*n+1];return[new THREE.Vector2(o,a),new THREE.Vector2(s,l),new THREE.Vector2(c,u)]},generateSideWallUV:function(e,t,r,i,n,o){return[new THREE.Vector2(0,0),new THREE.Vector2(0,1),new THREE.Vector2(1,1),new THREE.Vector2(1,0)]}},i=Pe.transformSVGPath(t.path),n=[new THREE.MeshPhongMaterial({transparent:!0}),new THREE.MeshPhongMaterial({transparent:!0})],o=i.toShapes(!0),a=0;a<o.length;a++){var s=o[a],l=new THREE.ExtrudeBufferGeometry(s,{depth:t.height,bevelEnabled:!1,UVGenerator:r}),c=new THREE.Matrix4;c.makeRotationFromEuler(Z.parseEuler([90,0,0]));var u=new THREE.Matrix4;u.makeTranslation(t.center[0],t.height,t.center[1]),u.multiply(c);for(var h=l.attributes.position.array,p=0;p<h.length;p+=3){var d=new THREE.Vector3(h[p],h[p+1],h[p+2]);d.applyMatrix4(u),h[p]=d.x,h[p+1]=d.y,h[p+2]=d.z}l.computeVertexNormals();var f=new THREE.Mesh(l,n);e.add(f)}},r.prototype.createMesh=function(e){var t=e.csg;if(t&&t.isCSG){var r=t.bsp.toMesh(),i=(new THREE.Matrix4).getInverse(t._object.node.matrixWorld);return r._premultiplyMatrix(i),r}return s.prototype.createMesh.call(this,e)},r.prototype.setup=function(e){var t=e.vertices,r=e.center||[0,0],i=e.height;if(t){for(var n={center:r,height:i,path:""},o=0;o<t.length;o++){var a=Z.parseVector3(t[o]);n.path?n.path+="L":n.path+="M",n.path+=a.x.toString(),n.path+=",",n.path+=a.z.toString(),n.path+=" "}n.path+=" Z",this._vertices=t,this._height=i,this.addGeoObject(this.node,n)}s.prototype.setup.call(this,e)},r}(Ae),De=function(r){function i(e){y(this,i);var t=p(this,r.call(this,e));return t.isOpen=!1,t}return u(i,r),i.prototype.setup=function(e){r.prototype.setup.call(this,e),this.node&&null==this.node.parent&&this.parent.node.add(this.node)},i.prototype.open=function(){0!==this.animationNames.length&&this.playAnimation("Auto_Open"),this.isOpen=!0},i.prototype.close=function(){0!==this.animationNames.length&&this.playAnimation("Auto_Close"),this.isOpen=!1},l(i,[{key:"isDoor",get:function(){return!0}},{key:"floor",get:function(){return this.parents.query(".Floor")[0]}}]),i}(Se),Ue=function(r){function i(e){y(this,i);var t=p(this,r.call(this,e));return t.elevator=null,t}return u(i,r),i.prototype.setup=function(e){r.prototype.setup.call(this,e),this.levelNum=this.parent.levelNum},l(i,[{key:"owner",get:function(){return this.elevator}}]),i}(De),Ve=function(r){function i(e){y(this,i);var t=p(this,r.call(this,e));return t.doors=[],t}return u(i,r),i.prototype.setup=function(e){if(r.prototype.setup.call(this,e),e.doors){this.doors=e.doors;for(var t=0;t<this.doors.length;t++)this.doors[t].elevator=this}},i.prototype.getDoor=function(e){for(var t=0;t<this.doors.length;t++){var r=this.doors[t];if(r.floor==e)return r}return r},i}(Ee),Be=function(r){function i(e){y(this,i);var t=p(this,r.call(this,e));return t.stair=null,t}return u(i,r),i.prototype.setup=function(e){r.prototype.setup.call(this,e)},l(i,[{key:"owner",get:function(){return this.stair}},{key:"isStairDoor",get:function(){return console.warn("[StairDoor] Please use 'instanceof THING.StairDoor' to replace '.StairDoor'"),this instanceof THING.StairDoor}}]),i}(De),ze=function(r){function i(e){y(this,i);var t=p(this,r.call(this,e));return t.doors=[],t}return u(i,r),i.prototype.setup=function(e){if(r.prototype.setup.call(this,e),e.doors){this.doors=e.doors;for(var t=0;t<this.doors.length;t++)this.doors[t].stair=this}},i.prototype.getDoor=function(e){for(var t=0;t<this.doors.length;t++){var r=this.doors[t];if(r.floor==e)return r}return r},l(i,[{key:"isStair",get:function(){return console.warn("[Stair] Please use 'instanceof THING.Stair' to replace '.Stair'"),this instanceof THING.Stair}}]),i}(Ee),qe=function(t){function r(e){return y(this,r),p(this,t.call(this,e))}return u(r,t),r.prototype.customSetup=function(e){var t=e.width,r=e.height;if(t&&r){var i=new THREE.PlaneBufferGeometry(t,r),n=new THREE.MeshLambertMaterial({polygonOffset:!0,polygonOffsetFactor:10,polygonOffsetUnits:10}),o=new THREE.Mesh(i,n);o.rotation.x=-.5*Math.PI,o.position.x=0,o.position.y=-.1,o.position.z=0,o.receiveShadow=!0,o.skipBoundingBox(!0);var a=e.repeatUV||[100,100],s=e.image;if(s){var l=this.app.confirmURL(s,"https://static.3dmomoda.com/textures");o.material.map=(new THREE.TextureLoader).load(l),o.material.map.repeat.fromArray(a),o.material.map.wrapT=o.material.map.wrapS=THREE.RepeatWrapping}this.node.add(o)}},l(r,[{key:"isGround",get:function(){return!0}}]),r}(Ee),Ge=function(r){function i(e){y(this,i);var t=p(this,r.call(this,e));return t._aspect=2,t._fov=45,t._near=.1,t._far=10,t._camera=null,t._lineMesh=null,t._frustumMesh=null,t._frustum=new THREE.Frustum,t._projScreenMatrix=new THREE.Matrix4,t}return u(i,r),i.prototype._updateFrustum=function(){this._projScreenMatrix.multiplyMatrices(this._camera.projectionMatrix,this._camera.matrixWorldInverse),this._frustum.setFromMatrix(this._projScreenMatrix)},i.prototype._buildLineMesh=function(e,t){var r=new THREE.EdgesGeometry(e.geometry),i=new THREE.LineSegments(r);return i.material.color=Z.parseColor(t),i},i.prototype._buildFrustumMesh=function(){var e=this.far*Math.tan(.5*this.fov*.017453293),t=this.aspect*e,r=new THREE.Geometry;r.vertices=[new THREE.Vector3(0,0,0),new THREE.Vector3(t,-e,-this.far),new THREE.Vector3(t,e,-this.far),new THREE.Vector3(-t,e,-this.far),new THREE.Vector3(-t,-e,-this.far)],r.faces=[new THREE.Face3(0,1,2),new THREE.Face3(0,2,3),new THREE.Face3(0,3,4),new THREE.Face3(0,4,1),new THREE.Face3(3,4,1),new THREE.Face3(3,1,2)];var i=new THREE.MeshBasicMaterial({color:"#0aa5ff",opacity:.5,transparent:!0,side:THREE.DoubleSide});return new THREE.Mesh(r,i)},i.prototype._build=function(){var e=this.app.resourceManager;e.remove(this._frustumMesh),e.remove(this._lineMesh),this._frustumMesh=this._buildFrustumMesh(),this.node.add(this._frustumMesh);var t=this.style._lineColor||16777215;this._lineMesh=this._buildLineMesh(this._frustumMesh,t),this.node.add(this._lineMesh),this._camera=new THREE.PerspectiveCamera(this.fov,this.aspect,this.near,this.far),this._camera.position.set(this.position[0],this.position[1],this.position[2]),this._camera.rotation.copy(this.node.rotation),this._camera.updateMatrixWorld(!0),this._updateFrustum()},i.prototype.customSetup=function(e){this._aspect=e.aspect||this._aspect,this._fov=e.fov||this._fov,this._near=e.near||this._near,this._far=e.far||this._far,this._build()},i.prototype.setWorldPosition=function(e){r.prototype.setWorldPosition.call(this,e),this._camera.position.set(e[0],e[1],e[2]),this._camera.updateMatrixWorld(!0),this._updateFrustum()},i.prototype.intersectsObject=function(e){return this._updateFrustum(),this._frustum.intersectsObject(e.node)},l(i,[{key:"aspect",set:function(e){this._aspect=e,this._build()},get:function(){return this._aspect}},{key:"fov",set:function(e){this._fov=e,this._build()},get:function(){return this._fov}},{key:"far",set:function(e){this._far=e,this._build()},get:function(){return this._far}}]),i}(Ee),We={uniforms:{tDiffuse:{value:null},brightness:{value:0},contrast:{value:1},exposure:{value:0},gamma:{value:1},saturation:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","varying vec2 vUv;","uniform float brightness;","uniform float contrast;","uniform float exposure;","uniform float gamma;","uniform float saturation;","const vec3 w = vec3(0.2125, 0.7154, 0.0721);","void main() {","vec4 tex = texture2D( tDiffuse, vUv );","vec3 color = clamp(tex.rgb + vec3(brightness), 0.0, 1.0);","color = clamp( (color-vec3(0.5))*contrast+vec3(0.5), 0.0, 1.0);","color = clamp( color * pow(2.0, exposure), 0.0, 1.0);","color = clamp( pow(color, vec3(gamma)), 0.0, 1.0);","float luminance = dot( color, w );","color = mix(vec3(luminance), color, saturation);","gl_FragColor = vec4(color, tex.a);","}"].join("\n")},Xe={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float opacity;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","gl_FragColor = opacity * texel;","}"].join("\n")},Ye={uniforms:{tDiffuse:{value:null},resolution:{value:new THREE.Vector2(1/1024,1/512)}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["precision highp float;","","uniform sampler2D tDiffuse;","","uniform vec2 resolution;","","varying vec2 vUv;","","// FXAA 3.11 implementation by NVIDIA, ported to WebGL by Agost Biro (biro@archilogic.com)","","//----------------------------------------------------------------------------------","// File:        es3-keplerFXAAassetsshaders/FXAA_DefaultES.frag","// SDK Version: v3.00","// Email:       gameworks@nvidia.com","// Site:        http://developer.nvidia.com/","//","// Copyright (c) 2014-2015, NVIDIA CORPORATION. All rights reserved.","//","// Redistribution and use in source and binary forms, with or without","// modification, are permitted provided that the following conditions","// are met:","//  * Redistributions of source code must retain the above copyright","//    notice, this list of conditions and the following disclaimer.","//  * Redistributions in binary form must reproduce the above copyright","//    notice, this list of conditions and the following disclaimer in the","//    documentation and/or other materials provided with the distribution.","//  * Neither the name of NVIDIA CORPORATION nor the names of its","//    contributors may be used to endorse or promote products derived","//    from this software without specific prior written permission.","//","// THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS ``AS IS'' AND ANY","// EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE","// IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR","// PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR","// CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,","// EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,","// PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR","// PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY","// OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT","// (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE","// OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.","//","//----------------------------------------------------------------------------------","","#define FXAA_PC 1","#define FXAA_GLSL_100 1","#define FXAA_QUALITY_PRESET 12","","#define FXAA_GREEN_AS_LUMA 1","","/*--------------------------------------------------------------------------*/","#ifndef FXAA_PC_CONSOLE","    //","    // The console algorithm for PC is included","    // for developers targeting really low spec machines.","    // Likely better to just run FXAA_PC, and use a really low preset.","    //","    #define FXAA_PC_CONSOLE 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_GLSL_120","    #define FXAA_GLSL_120 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_GLSL_130","    #define FXAA_GLSL_130 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_HLSL_3","    #define FXAA_HLSL_3 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_HLSL_4","    #define FXAA_HLSL_4 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_HLSL_5","    #define FXAA_HLSL_5 0","#endif","/*==========================================================================*/","#ifndef FXAA_GREEN_AS_LUMA","    //","    // For those using non-linear color,","    // and either not able to get luma in alpha, or not wanting to,","    // this enables FXAA to run using green as a proxy for luma.","    // So with this enabled, no need to pack luma in alpha.","    //","    // This will turn off AA on anything which lacks some amount of green.","    // Pure red and blue or combination of only R and B, will get no AA.","    //","    // Might want to lower the settings for both,","    //    fxaaConsoleEdgeThresholdMin","    //    fxaaQualityEdgeThresholdMin","    // In order to insure AA does not get turned off on colors","    // which contain a minor amount of green.","    //","    // 1 = On.","    // 0 = Off.","    //","    #define FXAA_GREEN_AS_LUMA 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_EARLY_EXIT","    //","    // Controls algorithm's early exit path.","    // On PS3 turning this ON adds 2 cycles to the shader.","    // On 360 turning this OFF adds 10ths of a millisecond to the shader.","    // Turning this off on console will result in a more blurry image.","    // So this defaults to on.","    //","    // 1 = On.","    // 0 = Off.","    //","    #define FXAA_EARLY_EXIT 1","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_DISCARD","    //","    // Only valid for PC OpenGL currently.","    // Probably will not work when FXAA_GREEN_AS_LUMA = 1.","    //","    // 1 = Use discard on pixels which don't need AA.","    //     For APIs which enable concurrent TEX+ROP from same surface.","    // 0 = Return unchanged color on pixels which don't need AA.","    //","    #define FXAA_DISCARD 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_FAST_PIXEL_OFFSET","    //","    // Used for GLSL 120 only.","    //","    // 1 = GL API supports fast pixel offsets","    // 0 = do not use fast pixel offsets","    //","    #ifdef GL_EXT_gpu_shader4","        #define FXAA_FAST_PIXEL_OFFSET 1","    #endif","    #ifdef GL_NV_gpu_shader5","        #define FXAA_FAST_PIXEL_OFFSET 1","    #endif","    #ifdef GL_ARB_gpu_shader5","        #define FXAA_FAST_PIXEL_OFFSET 1","    #endif","    #ifndef FXAA_FAST_PIXEL_OFFSET","        #define FXAA_FAST_PIXEL_OFFSET 0","    #endif","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_GATHER4_ALPHA","    //","    // 1 = API supports gather4 on alpha channel.","    // 0 = API does not support gather4 on alpha channel.","    //","    #if (FXAA_HLSL_5 == 1)","        #define FXAA_GATHER4_ALPHA 1","    #endif","    #ifdef GL_ARB_gpu_shader5","        #define FXAA_GATHER4_ALPHA 1","    #endif","    #ifdef GL_NV_gpu_shader5","        #define FXAA_GATHER4_ALPHA 1","    #endif","    #ifndef FXAA_GATHER4_ALPHA","        #define FXAA_GATHER4_ALPHA 0","    #endif","#endif","","","/*============================================================================","                        FXAA QUALITY - TUNING KNOBS","------------------------------------------------------------------------------","NOTE the other tuning knobs are now in the shader function inputs!","============================================================================*/","#ifndef FXAA_QUALITY_PRESET","    //","    // Choose the quality preset.","    // This needs to be compiled into the shader as it effects code.","    // Best option to include multiple presets is to","    // in each shader define the preset, then include this file.","    //","    // OPTIONS","    // -----------------------------------------------------------------------","    // 10 to 15 - default medium dither (10=fastest, 15=highest quality)","    // 20 to 29 - less dither, more expensive (20=fastest, 29=highest quality)","    // 39       - no dither, very expensive","    //","    // NOTES","    // -----------------------------------------------------------------------","    // 12 = slightly faster then FXAA 3.9 and higher edge quality (default)","    // 13 = about same speed as FXAA 3.9 and better than 12","    // 23 = closest to FXAA 3.9 visually and performance wise","    //  _ = the lowest digit is directly related to performance","    // _  = the highest digit is directly related to style","    //","    #define FXAA_QUALITY_PRESET 12","#endif","","","/*============================================================================","","                           FXAA QUALITY - PRESETS","","============================================================================*/","","/*============================================================================","                     FXAA QUALITY - MEDIUM DITHER PRESETS","============================================================================*/","#if (FXAA_QUALITY_PRESET == 10)","    #define FXAA_QUALITY_PS 3","    #define FXAA_QUALITY_P0 1.5","    #define FXAA_QUALITY_P1 3.0","    #define FXAA_QUALITY_P2 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 11)","    #define FXAA_QUALITY_PS 4","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 3.0","    #define FXAA_QUALITY_P3 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 12)","    #define FXAA_QUALITY_PS 5","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 4.0","    #define FXAA_QUALITY_P4 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 13)","    #define FXAA_QUALITY_PS 6","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 4.0","    #define FXAA_QUALITY_P5 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 14)","    #define FXAA_QUALITY_PS 7","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 4.0","    #define FXAA_QUALITY_P6 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 15)","    #define FXAA_QUALITY_PS 8","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 4.0","    #define FXAA_QUALITY_P7 12.0","#endif","","/*============================================================================","                     FXAA QUALITY - LOW DITHER PRESETS","============================================================================*/","#if (FXAA_QUALITY_PRESET == 20)","    #define FXAA_QUALITY_PS 3","    #define FXAA_QUALITY_P0 1.5","    #define FXAA_QUALITY_P1 2.0","    #define FXAA_QUALITY_P2 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 21)","    #define FXAA_QUALITY_PS 4","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 22)","    #define FXAA_QUALITY_PS 5","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 23)","    #define FXAA_QUALITY_PS 6","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 24)","    #define FXAA_QUALITY_PS 7","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 3.0","    #define FXAA_QUALITY_P6 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 25)","    #define FXAA_QUALITY_PS 8","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 4.0","    #define FXAA_QUALITY_P7 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 26)","    #define FXAA_QUALITY_PS 9","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 4.0","    #define FXAA_QUALITY_P8 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 27)","    #define FXAA_QUALITY_PS 10","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 4.0","    #define FXAA_QUALITY_P9 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 28)","    #define FXAA_QUALITY_PS 11","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 2.0","    #define FXAA_QUALITY_P9 4.0","    #define FXAA_QUALITY_P10 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 29)","    #define FXAA_QUALITY_PS 12","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 2.0","    #define FXAA_QUALITY_P9 2.0","    #define FXAA_QUALITY_P10 4.0","    #define FXAA_QUALITY_P11 8.0","#endif","","/*============================================================================","                     FXAA QUALITY - EXTREME QUALITY","============================================================================*/","#if (FXAA_QUALITY_PRESET == 39)","    #define FXAA_QUALITY_PS 12","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.0","    #define FXAA_QUALITY_P2 1.0","    #define FXAA_QUALITY_P3 1.0","    #define FXAA_QUALITY_P4 1.0","    #define FXAA_QUALITY_P5 1.5","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 2.0","    #define FXAA_QUALITY_P9 2.0","    #define FXAA_QUALITY_P10 4.0","    #define FXAA_QUALITY_P11 8.0","#endif","","","","/*============================================================================","","                                API PORTING","","============================================================================*/","#if (FXAA_GLSL_100 == 1) || (FXAA_GLSL_120 == 1) || (FXAA_GLSL_130 == 1)","    #define FxaaBool bool","    #define FxaaDiscard discard","    #define FxaaFloat float","    #define FxaaFloat2 vec2","    #define FxaaFloat3 vec3","    #define FxaaFloat4 vec4","    #define FxaaHalf float","    #define FxaaHalf2 vec2","    #define FxaaHalf3 vec3","    #define FxaaHalf4 vec4","    #define FxaaInt2 ivec2","    #define FxaaSat(x) clamp(x, 0.0, 1.0)","    #define FxaaTex sampler2D","#else","    #define FxaaBool bool","    #define FxaaDiscard clip(-1)","    #define FxaaFloat float","    #define FxaaFloat2 float2","    #define FxaaFloat3 float3","    #define FxaaFloat4 float4","    #define FxaaHalf half","    #define FxaaHalf2 half2","    #define FxaaHalf3 half3","    #define FxaaHalf4 half4","    #define FxaaSat(x) saturate(x)","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_GLSL_100 == 1)","  #define FxaaTexTop(t, p) texture2D(t, p, 0.0)","  #define FxaaTexOff(t, p, o, r) texture2D(t, p + (o * r), 0.0)","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_GLSL_120 == 1)","    // Requires,","    //  #version 120","    // And at least,","    //  #extension GL_EXT_gpu_shader4 : enable","    //  (or set FXAA_FAST_PIXEL_OFFSET 1 to work like DX9)","    #define FxaaTexTop(t, p) texture2DLod(t, p, 0.0)","    #if (FXAA_FAST_PIXEL_OFFSET == 1)","        #define FxaaTexOff(t, p, o, r) texture2DLodOffset(t, p, 0.0, o)","    #else","        #define FxaaTexOff(t, p, o, r) texture2DLod(t, p + (o * r), 0.0)","    #endif","    #if (FXAA_GATHER4_ALPHA == 1)","        // use #extension GL_ARB_gpu_shader5 : enable","        #define FxaaTexAlpha4(t, p) textureGather(t, p, 3)","        #define FxaaTexOffAlpha4(t, p, o) textureGatherOffset(t, p, o, 3)","        #define FxaaTexGreen4(t, p) textureGather(t, p, 1)","        #define FxaaTexOffGreen4(t, p, o) textureGatherOffset(t, p, o, 1)","    #endif","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_GLSL_130 == 1)",'    // Requires "#version 130" or better',"    #define FxaaTexTop(t, p) textureLod(t, p, 0.0)","    #define FxaaTexOff(t, p, o, r) textureLodOffset(t, p, 0.0, o)","    #if (FXAA_GATHER4_ALPHA == 1)","        // use #extension GL_ARB_gpu_shader5 : enable","        #define FxaaTexAlpha4(t, p) textureGather(t, p, 3)","        #define FxaaTexOffAlpha4(t, p, o) textureGatherOffset(t, p, o, 3)","        #define FxaaTexGreen4(t, p) textureGather(t, p, 1)","        #define FxaaTexOffGreen4(t, p, o) textureGatherOffset(t, p, o, 1)","    #endif","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_HLSL_3 == 1)","    #define FxaaInt2 float2","    #define FxaaTex sampler2D","    #define FxaaTexTop(t, p) tex2Dlod(t, float4(p, 0.0, 0.0))","    #define FxaaTexOff(t, p, o, r) tex2Dlod(t, float4(p + (o * r), 0, 0))","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_HLSL_4 == 1)","    #define FxaaInt2 int2","    struct FxaaTex { SamplerState smpl; Texture2D tex; };","    #define FxaaTexTop(t, p) t.tex.SampleLevel(t.smpl, p, 0.0)","    #define FxaaTexOff(t, p, o, r) t.tex.SampleLevel(t.smpl, p, 0.0, o)","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_HLSL_5 == 1)","    #define FxaaInt2 int2","    struct FxaaTex { SamplerState smpl; Texture2D tex; };","    #define FxaaTexTop(t, p) t.tex.SampleLevel(t.smpl, p, 0.0)","    #define FxaaTexOff(t, p, o, r) t.tex.SampleLevel(t.smpl, p, 0.0, o)","    #define FxaaTexAlpha4(t, p) t.tex.GatherAlpha(t.smpl, p)","    #define FxaaTexOffAlpha4(t, p, o) t.tex.GatherAlpha(t.smpl, p, o)","    #define FxaaTexGreen4(t, p) t.tex.GatherGreen(t.smpl, p)","    #define FxaaTexOffGreen4(t, p, o) t.tex.GatherGreen(t.smpl, p, o)","#endif","","","/*============================================================================","                   GREEN AS LUMA OPTION SUPPORT FUNCTION","============================================================================*/","#if (FXAA_GREEN_AS_LUMA == 0)","    FxaaFloat FxaaLuma(FxaaFloat4 rgba) { return rgba.w; }","#else","    FxaaFloat FxaaLuma(FxaaFloat4 rgba) { return rgba.y; }","#endif","","","","","/*============================================================================","","                             FXAA3 QUALITY - PC","","============================================================================*/","#if (FXAA_PC == 1)","/*--------------------------------------------------------------------------*/","FxaaFloat4 FxaaPixelShader(","    //","    // Use noperspective interpolation here (turn off perspective interpolation).","    // {xy} = center of pixel","    FxaaFloat2 pos,","    //","    // Used only for FXAA Console, and not used on the 360 version.","    // Use noperspective interpolation here (turn off perspective interpolation).","    // {xy_} = upper left of pixel","    // {_zw} = lower right of pixel","    FxaaFloat4 fxaaConsolePosPos,","    //","    // Input color texture.","    // {rgb_} = color in linear or perceptual color space","    // if (FXAA_GREEN_AS_LUMA == 0)","    //     {__a} = luma in perceptual color space (not linear)","    FxaaTex tex,","    //","    // Only used on the optimized 360 version of FXAA Console.",'    // For everything but 360, just use the same input here as for "tex".',"    // For 360, same texture, just alias with a 2nd sampler.","    // This sampler needs to have an exponent bias of -1.","    FxaaTex fxaaConsole360TexExpBiasNegOne,","    //","    // Only used on the optimized 360 version of FXAA Console.",'    // For everything but 360, just use the same input here as for "tex".',"    // For 360, same texture, just alias with a 3nd sampler.","    // This sampler needs to have an exponent bias of -2.","    FxaaTex fxaaConsole360TexExpBiasNegTwo,","    //","    // Only used on FXAA Quality.","    // This must be from a constant/uniform.","    // {x_} = 1.0/screenWidthInPixels","    // {_y} = 1.0/screenHeightInPixels","    FxaaFloat2 fxaaQualityRcpFrame,","    //","    // Only used on FXAA Console.","    // This must be from a constant/uniform.","    // This effects sub-pixel AA quality and inversely sharpness.","    //   Where N ranges between,","    //     N = 0.50 (default)","    //     N = 0.33 (sharper)","    // {x__} = -N/screenWidthInPixels","    // {_y_} = -N/screenHeightInPixels","    // {_z_} =  N/screenWidthInPixels","    // {__w} =  N/screenHeightInPixels","    FxaaFloat4 fxaaConsoleRcpFrameOpt,","    //","    // Only used on FXAA Console.","    // Not used on 360, but used on PS3 and PC.","    // This must be from a constant/uniform.","    // {x__} = -2.0/screenWidthInPixels","    // {_y_} = -2.0/screenHeightInPixels","    // {_z_} =  2.0/screenWidthInPixels","    // {__w} =  2.0/screenHeightInPixels","    FxaaFloat4 fxaaConsoleRcpFrameOpt2,","    //","    // Only used on FXAA Console.","    // Only used on 360 in place of fxaaConsoleRcpFrameOpt2.","    // This must be from a constant/uniform.","    // {x__} =  8.0/screenWidthInPixels","    // {_y_} =  8.0/screenHeightInPixels","    // {_z_} = -4.0/screenWidthInPixels","    // {__w} = -4.0/screenHeightInPixels","    FxaaFloat4 fxaaConsole360RcpFrameOpt2,","    //","    // Only used on FXAA Quality.","    // This used to be the FXAA_QUALITY_SUBPIX define.","    // It is here now to allow easier tuning.","    // Choose the amount of sub-pixel aliasing removal.","    // This can effect sharpness.","    //   1.00 - upper limit (softer)","    //   0.75 - default amount of filtering","    //   0.50 - lower limit (sharper, less sub-pixel aliasing removal)","    //   0.25 - almost off","    //   0.00 - completely off","    FxaaFloat fxaaQualitySubpix,","    //","    // Only used on FXAA Quality.","    // This used to be the FXAA_QUALITY_EDGE_THRESHOLD define.","    // It is here now to allow easier tuning.","    // The minimum amount of local contrast required to apply algorithm.","    //   0.333 - too little (faster)","    //   0.250 - low quality","    //   0.166 - default","    //   0.125 - high quality","    //   0.063 - overkill (slower)","    FxaaFloat fxaaQualityEdgeThreshold,","    //","    // Only used on FXAA Quality.","    // This used to be the FXAA_QUALITY_EDGE_THRESHOLD_MIN define.","    // It is here now to allow easier tuning.","    // Trims the algorithm from processing darks.","    //   0.0833 - upper limit (default, the start of visible unfiltered edges)","    //   0.0625 - high quality (faster)","    //   0.0312 - visible limit (slower)","    // Special notes when using FXAA_GREEN_AS_LUMA,","    //   Likely want to set this to zero.","    //   As colors that are mostly not-green","    //   will appear very dark in the green channel!","    //   Tune by looking at mostly non-green content,","    //   then start at zero and increase until aliasing is a problem.","    FxaaFloat fxaaQualityEdgeThresholdMin,","    //","    // Only used on FXAA Console.","    // This used to be the FXAA_CONSOLE_EDGE_SHARPNESS define.","    // It is here now to allow easier tuning.","    // This does not effect PS3, as this needs to be compiled in.","    //   Use FXAA_CONSOLE_PS3_EDGE_SHARPNESS for PS3.","    //   Due to the PS3 being ALU bound,","    //   there are only three safe values here: 2 and 4 and 8.","    //   These options use the shaders ability to a free *|/ by 2|4|8.","    // For all other platforms can be a non-power of two.","    //   8.0 is sharper (default!!!)","    //   4.0 is softer","    //   2.0 is really soft (good only for vector graphics inputs)","    FxaaFloat fxaaConsoleEdgeSharpness,","    //","    // Only used on FXAA Console.","    // This used to be the FXAA_CONSOLE_EDGE_THRESHOLD define.","    // It is here now to allow easier tuning.","    // This does not effect PS3, as this needs to be compiled in.","    //   Use FXAA_CONSOLE_PS3_EDGE_THRESHOLD for PS3.","    //   Due to the PS3 being ALU bound,","    //   there are only two safe values here: 1/4 and 1/8.","    //   These options use the shaders ability to a free *|/ by 2|4|8.","    // The console setting has a different mapping than the quality setting.","    // Other platforms can use other values.","    //   0.125 leaves less aliasing, but is softer (default!!!)","    //   0.25 leaves more aliasing, and is sharper","    FxaaFloat fxaaConsoleEdgeThreshold,","    //","    // Only used on FXAA Console.","    // This used to be the FXAA_CONSOLE_EDGE_THRESHOLD_MIN define.","    // It is here now to allow easier tuning.","    // Trims the algorithm from processing darks.","    // The console setting has a different mapping than the quality setting.","    // This only applies when FXAA_EARLY_EXIT is 1.","    // This does not apply to PS3,","    // PS3 was simplified to avoid more shader instructions.","    //   0.06 - faster but more aliasing in darks","    //   0.05 - default","    //   0.04 - slower and less aliasing in darks","    // Special notes when using FXAA_GREEN_AS_LUMA,","    //   Likely want to set this to zero.","    //   As colors that are mostly not-green","    //   will appear very dark in the green channel!","    //   Tune by looking at mostly non-green content,","    //   then start at zero and increase until aliasing is a problem.","    FxaaFloat fxaaConsoleEdgeThresholdMin,","    //","    // Extra constants for 360 FXAA Console only.","    // Use zeros or anything else for other platforms.","    // These must be in physical constant registers and NOT immedates.","    // Immedates will result in compiler un-optimizing.","    // {xyzw} = float4(1.0, -1.0, 0.25, -0.25)","    FxaaFloat4 fxaaConsole360ConstDir",") {","/*--------------------------------------------------------------------------*/","    FxaaFloat2 posM;","    posM.x = pos.x;","    posM.y = pos.y;","    #if (FXAA_GATHER4_ALPHA == 1)","        #if (FXAA_DISCARD == 0)","            FxaaFloat4 rgbyM = FxaaTexTop(tex, posM);","            #if (FXAA_GREEN_AS_LUMA == 0)","                #define lumaM rgbyM.w","            #else","                #define lumaM rgbyM.y","            #endif","        #endif","        #if (FXAA_GREEN_AS_LUMA == 0)","            FxaaFloat4 luma4A = FxaaTexAlpha4(tex, posM);","            FxaaFloat4 luma4B = FxaaTexOffAlpha4(tex, posM, FxaaInt2(-1, -1));","        #else","            FxaaFloat4 luma4A = FxaaTexGreen4(tex, posM);","            FxaaFloat4 luma4B = FxaaTexOffGreen4(tex, posM, FxaaInt2(-1, -1));","        #endif","        #if (FXAA_DISCARD == 1)","            #define lumaM luma4A.w","        #endif","        #define lumaE luma4A.z","        #define lumaS luma4A.x","        #define lumaSE luma4A.y","        #define lumaNW luma4B.w","        #define lumaN luma4B.z","        #define lumaW luma4B.x","    #else","        FxaaFloat4 rgbyM = FxaaTexTop(tex, posM);","        #if (FXAA_GREEN_AS_LUMA == 0)","            #define lumaM rgbyM.w","        #else","            #define lumaM rgbyM.y","        #endif","        #if (FXAA_GLSL_100 == 1)","          FxaaFloat lumaS = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 0.0, 1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0, 0.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaN = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 0.0,-1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0, 0.0), fxaaQualityRcpFrame.xy));","        #else","          FxaaFloat lumaS = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 0, 1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1, 0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaN = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 0,-1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 0), fxaaQualityRcpFrame.xy));","        #endif","    #endif","/*--------------------------------------------------------------------------*/","    FxaaFloat maxSM = max(lumaS, lumaM);","    FxaaFloat minSM = min(lumaS, lumaM);","    FxaaFloat maxESM = max(lumaE, maxSM);","    FxaaFloat minESM = min(lumaE, minSM);","    FxaaFloat maxWN = max(lumaN, lumaW);","    FxaaFloat minWN = min(lumaN, lumaW);","    FxaaFloat rangeMax = max(maxWN, maxESM);","    FxaaFloat rangeMin = min(minWN, minESM);","    FxaaFloat rangeMaxScaled = rangeMax * fxaaQualityEdgeThreshold;","    FxaaFloat range = rangeMax - rangeMin;","    FxaaFloat rangeMaxClamped = max(fxaaQualityEdgeThresholdMin, rangeMaxScaled);","    FxaaBool earlyExit = range < rangeMaxClamped;","/*--------------------------------------------------------------------------*/","    if(earlyExit)","        #if (FXAA_DISCARD == 1)","            FxaaDiscard;","        #else","            return rgbyM;","        #endif","/*--------------------------------------------------------------------------*/","    #if (FXAA_GATHER4_ALPHA == 0)","        #if (FXAA_GLSL_100 == 1)","          FxaaFloat lumaNW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0,-1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0, 1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0,-1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0, 1.0), fxaaQualityRcpFrame.xy));","        #else","          FxaaFloat lumaNW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1,-1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1, 1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1,-1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 1), fxaaQualityRcpFrame.xy));","        #endif","    #else","        FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(1, -1), fxaaQualityRcpFrame.xy));","        FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 1), fxaaQualityRcpFrame.xy));","    #endif","/*--------------------------------------------------------------------------*/","    FxaaFloat lumaNS = lumaN + lumaS;","    FxaaFloat lumaWE = lumaW + lumaE;","    FxaaFloat subpixRcpRange = 1.0/range;","    FxaaFloat subpixNSWE = lumaNS + lumaWE;","    FxaaFloat edgeHorz1 = (-2.0 * lumaM) + lumaNS;","    FxaaFloat edgeVert1 = (-2.0 * lumaM) + lumaWE;","/*--------------------------------------------------------------------------*/","    FxaaFloat lumaNESE = lumaNE + lumaSE;","    FxaaFloat lumaNWNE = lumaNW + lumaNE;","    FxaaFloat edgeHorz2 = (-2.0 * lumaE) + lumaNESE;","    FxaaFloat edgeVert2 = (-2.0 * lumaN) + lumaNWNE;","/*--------------------------------------------------------------------------*/","    FxaaFloat lumaNWSW = lumaNW + lumaSW;","    FxaaFloat lumaSWSE = lumaSW + lumaSE;","    FxaaFloat edgeHorz4 = (abs(edgeHorz1) * 2.0) + abs(edgeHorz2);","    FxaaFloat edgeVert4 = (abs(edgeVert1) * 2.0) + abs(edgeVert2);","    FxaaFloat edgeHorz3 = (-2.0 * lumaW) + lumaNWSW;","    FxaaFloat edgeVert3 = (-2.0 * lumaS) + lumaSWSE;","    FxaaFloat edgeHorz = abs(edgeHorz3) + edgeHorz4;","    FxaaFloat edgeVert = abs(edgeVert3) + edgeVert4;","/*--------------------------------------------------------------------------*/","    FxaaFloat subpixNWSWNESE = lumaNWSW + lumaNESE;","    FxaaFloat lengthSign = fxaaQualityRcpFrame.x;","    FxaaBool horzSpan = edgeHorz >= edgeVert;","    FxaaFloat subpixA = subpixNSWE * 2.0 + subpixNWSWNESE;","/*--------------------------------------------------------------------------*/","    if(!horzSpan) lumaN = lumaW;","    if(!horzSpan) lumaS = lumaE;","    if(horzSpan) lengthSign = fxaaQualityRcpFrame.y;","    FxaaFloat subpixB = (subpixA * (1.0/12.0)) - lumaM;","/*--------------------------------------------------------------------------*/","    FxaaFloat gradientN = lumaN - lumaM;","    FxaaFloat gradientS = lumaS - lumaM;","    FxaaFloat lumaNN = lumaN + lumaM;","    FxaaFloat lumaSS = lumaS + lumaM;","    FxaaBool pairN = abs(gradientN) >= abs(gradientS);","    FxaaFloat gradient = max(abs(gradientN), abs(gradientS));","    if(pairN) lengthSign = -lengthSign;","    FxaaFloat subpixC = FxaaSat(abs(subpixB) * subpixRcpRange);","/*--------------------------------------------------------------------------*/","    FxaaFloat2 posB;","    posB.x = posM.x;","    posB.y = posM.y;","    FxaaFloat2 offNP;","    offNP.x = (!horzSpan) ? 0.0 : fxaaQualityRcpFrame.x;","    offNP.y = ( horzSpan) ? 0.0 : fxaaQualityRcpFrame.y;","    if(!horzSpan) posB.x += lengthSign * 0.5;","    if( horzSpan) posB.y += lengthSign * 0.5;","/*--------------------------------------------------------------------------*/","    FxaaFloat2 posN;","    posN.x = posB.x - offNP.x * FXAA_QUALITY_P0;","    posN.y = posB.y - offNP.y * FXAA_QUALITY_P0;","    FxaaFloat2 posP;","    posP.x = posB.x + offNP.x * FXAA_QUALITY_P0;","    posP.y = posB.y + offNP.y * FXAA_QUALITY_P0;","    FxaaFloat subpixD = ((-2.0)*subpixC) + 3.0;","    FxaaFloat lumaEndN = FxaaLuma(FxaaTexTop(tex, posN));","    FxaaFloat subpixE = subpixC * subpixC;","    FxaaFloat lumaEndP = FxaaLuma(FxaaTexTop(tex, posP));","/*--------------------------------------------------------------------------*/","    if(!pairN) lumaNN = lumaSS;","    FxaaFloat gradientScaled = gradient * 1.0/4.0;","    FxaaFloat lumaMM = lumaM - lumaNN * 0.5;","    FxaaFloat subpixF = subpixD * subpixE;","    FxaaBool lumaMLTZero = lumaMM < 0.0;","/*--------------------------------------------------------------------------*/","    lumaEndN -= lumaNN * 0.5;","    lumaEndP -= lumaNN * 0.5;","    FxaaBool doneN = abs(lumaEndN) >= gradientScaled;","    FxaaBool doneP = abs(lumaEndP) >= gradientScaled;","    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P1;","    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P1;","    FxaaBool doneNP = (!doneN) || (!doneP);","    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P1;","    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P1;","/*--------------------------------------------------------------------------*/","    if(doneNP) {","        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","        doneN = abs(lumaEndN) >= gradientScaled;","        doneP = abs(lumaEndP) >= gradientScaled;","        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P2;","        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P2;","        doneNP = (!doneN) || (!doneP);","        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P2;","        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P2;","/*--------------------------------------------------------------------------*/","        #if (FXAA_QUALITY_PS > 3)","        if(doneNP) {","            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","            doneN = abs(lumaEndN) >= gradientScaled;","            doneP = abs(lumaEndP) >= gradientScaled;","            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P3;","            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P3;","            doneNP = (!doneN) || (!doneP);","            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P3;","            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P3;","/*--------------------------------------------------------------------------*/","            #if (FXAA_QUALITY_PS > 4)","            if(doneNP) {","                if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                doneN = abs(lumaEndN) >= gradientScaled;","                doneP = abs(lumaEndP) >= gradientScaled;","                if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P4;","                if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P4;","                doneNP = (!doneN) || (!doneP);","                if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P4;","                if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P4;","/*--------------------------------------------------------------------------*/","                #if (FXAA_QUALITY_PS > 5)","                if(doneNP) {","                    if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                    if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                    if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                    if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                    doneN = abs(lumaEndN) >= gradientScaled;","                    doneP = abs(lumaEndP) >= gradientScaled;","                    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P5;","                    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P5;","                    doneNP = (!doneN) || (!doneP);","                    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P5;","                    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P5;","/*--------------------------------------------------------------------------*/","                    #if (FXAA_QUALITY_PS > 6)","                    if(doneNP) {","                        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                        doneN = abs(lumaEndN) >= gradientScaled;","                        doneP = abs(lumaEndP) >= gradientScaled;","                        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P6;","                        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P6;","                        doneNP = (!doneN) || (!doneP);","                        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P6;","                        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P6;","/*--------------------------------------------------------------------------*/","                        #if (FXAA_QUALITY_PS > 7)","                        if(doneNP) {","                            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                            doneN = abs(lumaEndN) >= gradientScaled;","                            doneP = abs(lumaEndP) >= gradientScaled;","                            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P7;","                            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P7;","                            doneNP = (!doneN) || (!doneP);","                            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P7;","                            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P7;","/*--------------------------------------------------------------------------*/","    #if (FXAA_QUALITY_PS > 8)","    if(doneNP) {","        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","        doneN = abs(lumaEndN) >= gradientScaled;","        doneP = abs(lumaEndP) >= gradientScaled;","        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P8;","        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P8;","        doneNP = (!doneN) || (!doneP);","        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P8;","        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P8;","/*--------------------------------------------------------------------------*/","        #if (FXAA_QUALITY_PS > 9)","        if(doneNP) {","            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","            doneN = abs(lumaEndN) >= gradientScaled;","            doneP = abs(lumaEndP) >= gradientScaled;","            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P9;","            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P9;","            doneNP = (!doneN) || (!doneP);","            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P9;","            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P9;","/*--------------------------------------------------------------------------*/","            #if (FXAA_QUALITY_PS > 10)","            if(doneNP) {","                if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                doneN = abs(lumaEndN) >= gradientScaled;","                doneP = abs(lumaEndP) >= gradientScaled;","                if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P10;","                if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P10;","                doneNP = (!doneN) || (!doneP);","                if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P10;","                if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P10;","/*--------------------------------------------------------------------------*/","                #if (FXAA_QUALITY_PS > 11)","                if(doneNP) {","                    if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                    if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                    if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                    if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                    doneN = abs(lumaEndN) >= gradientScaled;","                    doneP = abs(lumaEndP) >= gradientScaled;","                    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P11;","                    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P11;","                    doneNP = (!doneN) || (!doneP);","                    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P11;","                    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P11;","/*--------------------------------------------------------------------------*/","                    #if (FXAA_QUALITY_PS > 12)","                    if(doneNP) {","                        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                        doneN = abs(lumaEndN) >= gradientScaled;","                        doneP = abs(lumaEndP) >= gradientScaled;","                        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P12;","                        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P12;","                        doneNP = (!doneN) || (!doneP);","                        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P12;","                        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P12;","/*--------------------------------------------------------------------------*/","                    }","                    #endif","/*--------------------------------------------------------------------------*/","                }","                #endif","/*--------------------------------------------------------------------------*/","            }","            #endif","/*--------------------------------------------------------------------------*/","        }","        #endif","/*--------------------------------------------------------------------------*/","    }","    #endif","/*--------------------------------------------------------------------------*/","                        }","                        #endif","/*--------------------------------------------------------------------------*/","                    }","                    #endif","/*--------------------------------------------------------------------------*/","                }","                #endif","/*--------------------------------------------------------------------------*/","            }","            #endif","/*--------------------------------------------------------------------------*/","        }","        #endif","/*--------------------------------------------------------------------------*/","    }","/*--------------------------------------------------------------------------*/","    FxaaFloat dstN = posM.x - posN.x;","    FxaaFloat dstP = posP.x - posM.x;","    if(!horzSpan) dstN = posM.y - posN.y;","    if(!horzSpan) dstP = posP.y - posM.y;","/*--------------------------------------------------------------------------*/","    FxaaBool goodSpanN = (lumaEndN < 0.0) != lumaMLTZero;","    FxaaFloat spanLength = (dstP + dstN);","    FxaaBool goodSpanP = (lumaEndP < 0.0) != lumaMLTZero;","    FxaaFloat spanLengthRcp = 1.0/spanLength;","/*--------------------------------------------------------------------------*/","    FxaaBool directionN = dstN < dstP;","    FxaaFloat dst = min(dstN, dstP);","    FxaaBool goodSpan = directionN ? goodSpanN : goodSpanP;","    FxaaFloat subpixG = subpixF * subpixF;","    FxaaFloat pixelOffset = (dst * (-spanLengthRcp)) + 0.5;","    FxaaFloat subpixH = subpixG * fxaaQualitySubpix;","/*--------------------------------------------------------------------------*/","    FxaaFloat pixelOffsetGood = goodSpan ? pixelOffset : 0.0;","    FxaaFloat pixelOffsetSubpix = max(pixelOffsetGood, subpixH);","    if(!horzSpan) posM.x += pixelOffsetSubpix * lengthSign;","    if( horzSpan) posM.y += pixelOffsetSubpix * lengthSign;","    #if (FXAA_DISCARD == 1)","        return FxaaTexTop(tex, posM);","    #else","        return FxaaFloat4(FxaaTexTop(tex, posM).xyz, lumaM);","    #endif","}","/*==========================================================================*/","#endif","","void main() {","  gl_FragColor = FxaaPixelShader(","    vUv,","    vec4(0.0),","    tDiffuse,","    tDiffuse,","    tDiffuse,","    resolution,","    vec4(0.0),","    vec4(0.0),","    vec4(0.0),","    0.75,","    0.166,","    0.0833,","    0.0,","    0.0,","    0.0,","    vec4(0.0)","  );","","  // TODO avoid querying texture twice for same texel","  gl_FragColor.a = texture2D(tDiffuse, vUv).a;","}"].join("\n")};function Qe(){this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}function Je(e,t){Qe.call(this),this.textureID=void 0!==t?t:"tDiffuse",e instanceof THREE.ShaderMaterial?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=THREE.UniformsUtils.clone(e.uniforms),this.material=new THREE.ShaderMaterial({defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.camera=new THREE.OrthographicCamera(-1,1,1,-1,0,1),this.scene=new THREE.Scene,this.quad=new THREE.Mesh(new THREE.PlaneBufferGeometry(2,2),null),this.quad.frustumCulled=!1,this.scene.add(this.quad)}Object.assign(Qe.prototype,{setSize:function(e,t){},render:function(e,t,r,i,n){console.error("Pass: .render() must be implemented in derived pass.")}}),Je.prototype=Object.assign(Object.create(Qe.prototype),{constructor:Je,render:function(e,t,r,i,n){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=r.texture),this.quad.material=this.material,this.renderToScreen?e.render(this.scene,this.camera,void 0,this.clear):e.render(this.scene,this.camera,t,this.clear)}});var Ze=0;function Ke(e,t){this.id=++Ze,this._renderTarget=new THREE.WebGLRenderTarget(e,t,{minFilter:THREE.NearestFilter,magFilter:THREE.NearestFilter,format:THREE.RGBAFormat,type:THREE.HalfFloat}),this._renderTarget.depthTexture=new THREE.DepthTexture(e,t),this._renderTarget.depthTexture.format=THREE.DepthStencilFormat,this._renderTarget.depthTexture.type=THREE.UnsignedInt248Type,this._normalMaterial=new THREE.MeshNormalMaterial,this.ignoreTransparent=!0}Ke.prototype=Object.assign(Ke.prototype,{setSize:function(e,t){this._renderTarget.setSize(e,t)},render:function(e,t,r,i){if(!e.materialManager.hasStrategy("NormalDepthPrePass"+this.id)){var a=this;e.materialManager.addStrategy("NormalDepthPrePass"+this.id,function(e,t,r,i,n,o){return a.ignoreTransparent&&n.transparent?null:a.ignoreTransparent&&0<n.alphaTest?null:a._normalMaterial})}this.ignoreTransparent=i;var n=e.getClearColor().getHex(),o=e.getClearAlpha();e.setClearColor(7829503,1),e.materialManager.setMode("NormalDepthPrePass"+this.id);var s=t.autoUpdate,l=t.background,c=e.shadowMap.enable;t.autoUpdate=!1,t.background=null,e.shadowMap.enable=!1,e.render(t,r,this._renderTarget,!0),t.autoUpdate=s,t.background=l,e.shadowMap.enable=c,e.materialManager.setMode(0),e.setClearColor(n,o)},getNormalTexture:function(){return this._renderTarget.texture},getDepthTexture:function(){return this._renderTarget.depthTexture}});var $e={defines:{DEPTH_PACKING:1,KERNEL_SIZE:64,EPSILON:1e-6},uniforms:{normalTex:{value:null},depthTex:{value:null},noiseTex:{value:null},texSize:{value:new THREE.Vector2},noiseTexSize:{value:new THREE.Vector2(4,4)},projection:{value:new THREE.Matrix4},projectionInv:{value:new THREE.Matrix4},kernel:{value:null},radius:{value:.2},power:{value:1},bias:{value:.004},intensity:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["precision highp sampler2D;","#include <packing>","varying vec2 vUv;","uniform sampler2D normalTex;","uniform sampler2D depthTex;","uniform vec2 texSize;","uniform sampler2D noiseTex;","uniform vec2 noiseTexSize;","uniform mat4 projection;","uniform mat4 projectionInv;","uniform vec3 kernel[KERNEL_SIZE];","uniform float radius;","uniform float power;","uniform float bias;","uniform float intensity;","float getDepth( const in vec2 screenPosition ) {","#if DEPTH_PACKING == 1","return unpackRGBAToDepth( texture2D( depthTex, screenPosition ) );","#elif DEPTH_PACKING == 2","return texture2D( depthTex, screenPosition ).w;","#else","return texture2D( depthTex, screenPosition ).x;","#endif","}","vec3 getViewNormal( const in vec2 screenPosition ) {","return unpackRGBToNormal( texture2D( normalTex, screenPosition ).xyz );","}","float ssaoEstimator(in mat3 kernelBasis, in vec3 originPos, in vec3 N) {","float occlusion = 0.0;","for (int i = 0; i < KERNEL_SIZE; i++) {","vec3 samplePos = kernel[i];","samplePos = kernelBasis * samplePos;","samplePos = samplePos * radius + originPos;","vec4 texCoord = projection * vec4(samplePos, 1.0);","texCoord.xy /= texCoord.w;","texCoord.xy = texCoord.xy * 0.5 + 0.5;","float sampleDepth = getDepth(texCoord.xy);","float z = sampleDepth * 2.0 - 1.0;","#ifdef ALCHEMY","vec4 projectedPos = vec4(texCoord.xy * 2.0 - 1.0, z, 1.0);","vec4 p4 = projectionInv * projectedPos;","p4.xyz /= p4.w;","vec3 cDir = p4.xyz - originPos;","float vv = dot(cDir, cDir);","float vn = dot(cDir, N);","float radius2 = radius * radius;","vn = max(vn + p4.z * bias, 0.0);","float f = max(radius2 - vv, 0.0) / radius2;","occlusion += f * f * f * max(vn / (0.01 + vv), 0.0);","#else","if (projection[3][3] == 0.0) {","z = projection[3][2] / (z * projection[2][3] - projection[2][2]);","} else {","z = (z - projection[3][2]) / projection[2][2];","}","float factor = step(samplePos.z, z - bias);","float rangeCheck = smoothstep(0.0, 1.0, radius / abs(originPos.z - z));","occlusion += rangeCheck * factor;","#endif","}","occlusion = 1.0 - occlusion / float(KERNEL_SIZE);","return pow(occlusion, power);","}","void main() {","float centerDepth = getDepth( vUv );","if( centerDepth >= ( 1.0 - EPSILON ) ) {","\tdiscard;","}","vec3 N = getViewNormal( vUv );","vec2 noiseTexCoord = texSize / vec2(noiseTexSize) * vUv;","vec3 rvec = texture2D(noiseTex, noiseTexCoord).rgb * 2.0 - 1.0;","vec3 T = normalize(rvec - N * dot(rvec, N));","vec3 BT = normalize(cross(N, T));","mat3 kernelBasis = mat3(T, BT, N);","float z = centerDepth * 2.0 - 1.0;","vec4 projectedPos = vec4(vUv * 2.0 - 1.0, z, 1.0);","vec4 p4 = projectionInv * projectedPos;","vec3 position = p4.xyz / p4.w;","float ao = ssaoEstimator(kernelBasis, position, N);","ao = clamp(1.0 - (1.0 - ao) * intensity, 0.0, 1.0);","gl_FragColor = vec4(vec3(ao), 1.0);","}"].join("\n")};function et(e){for(var t=new Uint8Array(e*e*4),r=0,i=new THREE.Vector3,n=0;n<e;n++)for(var o=0;o<e;o++)i.set(2*Math.random()-1,2*Math.random()-1,0).normalize(),t[r++]=255*(.5*i.x+.5),t[r++]=255*(.5*i.y+.5),t[r++]=0,t[r++]=255;return t}function tt(e,t){for(var r=0,i=1/t,n=e;0<n;)r+=i*(n%t),n=Math.floor(n/t),i/=t;return r}function rt(e,t){this._tempRenderTarget=new THREE.WebGLRenderTarget(e,t,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat}),this._tempRenderTarget2=new THREE.WebGLRenderTarget(e,t,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat}),this.ssaoMaterial=new THREE.ShaderMaterial({defines:Object.assign({},$e.defines),fragmentShader:$e.fragmentShader,vertexShader:$e.vertexShader,uniforms:THREE.UniformsUtils.clone($e.uniforms),depthTest:!1,depthWrite:!1}),this.blurMaterial=new THREE.ShaderMaterial({defines:Object.assign({},THREE.SuperSSAOBlurShader.defines),fragmentShader:THREE.SuperSSAOBlurShader.fragmentShader,vertexShader:THREE.SuperSSAOBlurShader.vertexShader,uniforms:THREE.UniformsUtils.clone(THREE.SuperSSAOBlurShader.uniforms),depthTest:!1,depthWrite:!1,transparent:!0,blending:THREE.CustomBlending,blendSrc:THREE.ZeroFactor,blendDst:THREE.SrcColorFactor,blendEquation:THREE.AddEquation,blendSrcAlpha:THREE.ZeroFactor,blendDstAlpha:THREE.SrcColorFactor,blendEquationAlpha:THREE.AddEquation}),this.quadCamera=new THREE.OrthographicCamera(-1,1,1,-1,0,1),this.quadScene=new THREE.Scene,this.quad=new THREE.Mesh(new THREE.PlaneGeometry(2,2),null),this.quadScene.add(this.quadCamera),this.quadScene.add(this.quad),this._kernels={},this.setNoiseSize(4),this.setKernelSize(12),this.setParameter("radius",.2),this.setParameter("bias",.004),this.setParameter("power",1),this.setParameter("intensity",.8),this.ssaoMaterial.uniforms.texSize.value.set(e,t),this.blurMaterial.uniforms.textureSize.value.set(e,t)}THREE.SuperSSAOBlurShader={defines:{NORMALTEX_ENABLED:1,DEPTHTEX_ENABLED:1,DEPTH_PACKING:1},uniforms:{tDiffuse:{value:null},textureSize:{value:new THREE.Vector2},direction:{value:0},blurSize:{value:1},depthTex:{value:null},normalTex:{value:null},projection:{value:new THREE.Matrix4},depthRange:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#include <packing>","varying vec2 vUv;","uniform vec2 textureSize;","uniform float blurSize;","uniform sampler2D tDiffuse;","uniform int direction;","#if NORMALTEX_ENABLED == 1","uniform sampler2D normalTex;","vec3 getViewNormal( const in vec2 screenPosition ) {","return unpackRGBToNormal( texture2D( normalTex, screenPosition ).xyz );","}","#endif","#if DEPTHTEX_ENABLED == 1","uniform sampler2D depthTex;","uniform mat4 projection;","uniform float depthRange;","float getDepth( const in vec2 screenPosition ) {","#if DEPTH_PACKING == 1","return unpackRGBAToDepth( texture2D( depthTex, screenPosition ) );","#elif DEPTH_PACKING == 2","return texture2D( depthTex, screenPosition ).w;","#else","return texture2D( depthTex, screenPosition ).x;","#endif","}","float getLinearDepth(vec2 coord) {","float depth = getDepth(coord) * 2.0 - 1.0;","return projection[3][2] / (depth * projection[2][3] - projection[2][2]);","}","#endif","void main() {","float kernel[5];","kernel[0] = 0.122581;","kernel[1] = 0.233062;","kernel[2] = 0.288713;","kernel[3] = 0.233062;","kernel[4] = 0.122581;","vec2 off = vec2(0.0);","if (direction == 0) {","off[0] = blurSize / textureSize.x;","}","else {","off[1] = blurSize / textureSize.y;","}","float sum = 0.0;","float weightAll = 0.0;","#if NORMALTEX_ENABLED == 1","vec3 centerNormal = getViewNormal(vUv);","#endif","#if DEPTHTEX_ENABLED == 1","float centerDepth = getLinearDepth(vUv);","#endif","for (int i = 0; i < 5; i++) {","vec2 coord = clamp(vUv + vec2(float(i) - 2.0) * off, vec2(0.0), vec2(1.0));","float w = kernel[i];","#if NORMALTEX_ENABLED == 1","vec3 normal = getViewNormal(coord);","w *= clamp(dot(normal, centerNormal), 0.0, 1.0);","#endif","#if DEPTHTEX_ENABLED == 1","float d = getLinearDepth(coord);","w *= (1.0 - smoothstep(0.0, 1.0, abs(centerDepth - d) / depthRange));","#endif","weightAll += w;","sum += w * texture2D(tDiffuse, coord).r;","}","gl_FragColor = vec4(vec3(sum / weightAll), 1.0);","}"].join("\n")},rt.prototype=Object.assign(rt.prototype,{constructor:rt,setSize:function(e,t){this._tempRenderTarget.setSize(e,t),this._tempRenderTarget2.setSize(e,t),this.ssaoMaterial.uniforms.texSize.value.set(e,t),this.blurMaterial.uniforms.textureSize.value.set(e,t)},render:function(e,t,r,i,n,o){this.ssaoMaterial.uniforms.normalTex.value=e,this.ssaoMaterial.uniforms.depthTex.value=t,this.ssaoMaterial.uniforms.projection.value.copy(i.projectionMatrix),this.ssaoMaterial.uniforms.projectionInv.value.getInverse(i.projectionMatrix),this.blurMaterial.uniforms.normalTex.value=e,this.blurMaterial.uniforms.depthTex.value=t,this.blurMaterial.uniforms.projection.value.copy(i.projectionMatrix),t===e?(this.ssaoMaterial.defines.DEPTH_PACKING=2,this.blurMaterial.defines.DEPTH_PACKING=2):t.isDepthTexture?(this.ssaoMaterial.defines.DEPTH_PACKING=0,this.blurMaterial.defines.DEPTH_PACKING=0):(this.ssaoMaterial.defines.DEPTH_PACKING=1,this.blurMaterial.defines.DEPTH_PACKING=1);var a=r.getClearColor().getHex(),s=r.getClearAlpha(),l=r.autoClear;r.autoClear=!1,this.quad.material=this.ssaoMaterial,r.setClearColor(16777215,1),r.render(this.quadScene,this.quadCamera,this._tempRenderTarget,!0),this.quad.material=this.blurMaterial,this.blurMaterial.uniforms.tDiffuse.value=this._tempRenderTarget.texture,this.blurMaterial.uniforms.direction.value=0,this.blurMaterial.uniforms.blurSize.value=1,this.blurMaterial.transparent=!1,r.setClearColor(16777215,1),r.render(this.quadScene,this.quadCamera,this._tempRenderTarget2,!0),this.blurMaterial.uniforms.tDiffuse.value=this._tempRenderTarget2.texture,this.blurMaterial.uniforms.direction.value=1,this.blurMaterial.uniforms.blurSize.value=1,this.blurMaterial.transparent=!o,this.blurMaterial.blending=o?THREE.NoBlending:THREE.CustomBlending,o&&r.setClearColor(0,0),r.render(this.quadScene,this.quadCamera,n,o),r.setClearColor(a,s),r.autoClear=l},setKernelSize:function(e,t){t=void 0!==t?t:0,this._kernels[e+"_"+t]||(this._kernels[e+"_"+t]=function(e,t,r){var i=new Float32Array(3*e);t=t||0;for(var n=0;n<e;n++){var o=1*tt(n+t,2)*Math.PI,a=tt(n+t,3)*Math.PI,s=Math.random(),l=Math.cos(o)*Math.sin(a)*s,c=Math.cos(a)*s,u=Math.sin(o)*Math.sin(a)*s;i[3*n]=l,i[3*n+1]=c,i[3*n+2]=u}return i}(e,e*t)),this.ssaoMaterial.defines.KERNEL_SIZE=e,this.ssaoMaterial.uniforms.kernel.value=this._kernels[e+"_"+t]},setNoiseSize:function(e){var t,r,i=this.ssaoMaterial.uniforms.noiseTex.value;i?(i.image.data=et(e),i.image.width=e,i.image.height=e,i.needsUpdate=!0):(t=e,(r=new THREE.DataTexture(et(t),t,t,THREE.RGBAFormat,THREE.UnsignedByteType,THREE.UVMapping,THREE.RepeatWrapping,THREE.RepeatWrapping)).needsUpdate=!0,i=r,this.ssaoMaterial.uniforms.noiseTex.value=i),this.ssaoMaterial.uniforms.noiseTexSize.value.set(e,e)},setParameter:function(e,t){"noiseTexSize"===e?this.setNoiseSize(t):"kernelSize"===e?this.setKernelSize(t):"blurSize"===e?this.blurMaterial.uniforms.blurSize.value=1:this.ssaoMaterial.uniforms[e].value=t}});var it={shaderID:"luminosityHighPass",uniforms:{tDiffuse:{type:"t",value:null},luminosityThreshold:{type:"f",value:1},smoothWidth:{type:"f",value:1},defaultColor:{type:"c",value:new THREE.Color(0)},defaultOpacity:{type:"f",value:0}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform vec3 defaultColor;","uniform float defaultOpacity;","uniform float luminosityThreshold;","uniform float smoothWidth;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","vec3 luma = vec3( 0.299, 0.587, 0.114 );","float v = dot( texel.xyz, luma );","vec4 outputColor = vec4( defaultColor.rgb, defaultOpacity );","float alpha = smoothstep( luminosityThreshold, luminosityThreshold + smoothWidth, v );","gl_FragColor = mix( outputColor, texel, alpha );","}"].join("\n")};function nt(e,t,r,i){Qe.call(this),this.strength=void 0!==t?t:1,this.radius=r,this.threshold=i,this.resolution=void 0!==e?new THREE.Vector2(e.x,e.y):new THREE.Vector2(256,256),this.clearColor=new THREE.Color(0,0,0);var n={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat};this.renderTargetsHorizontal=[],this.renderTargetsVertical=[],this.nMips=5;var o=Math.round(this.resolution.x/2),a=Math.round(this.resolution.y/2);this.renderTargetBright=new THREE.WebGLRenderTarget(o,a,n),this.renderTargetBright.texture.name="UnrealBloomPass.bright",this.renderTargetBright.texture.generateMipmaps=!1;for(var s=0;s<this.nMips;s++){var l=new THREE.WebGLRenderTarget(o,a,n);l.texture.name="UnrealBloomPass.h"+s,l.texture.generateMipmaps=!1,this.renderTargetsHorizontal.push(l);var c=new THREE.WebGLRenderTarget(o,a,n);c.texture.name="UnrealBloomPass.v"+s,c.texture.generateMipmaps=!1,this.renderTargetsVertical.push(c),o=Math.round(o/2),a=Math.round(a/2)}this.highPassUniforms=THREE.UniformsUtils.clone(it.uniforms),this.highPassUniforms.luminosityThreshold.value=i,this.highPassUniforms.smoothWidth.value=.01,this.materialHighPassFilter=new THREE.ShaderMaterial({uniforms:this.highPassUniforms,vertexShader:it.vertexShader,fragmentShader:it.fragmentShader,defines:{}}),this.separableBlurMaterials=[];var u=[3,5,7,9,11];for(o=Math.round(this.resolution.x/2),a=Math.round(this.resolution.y/2),s=0;s<this.nMips;s++)this.separableBlurMaterials.push(this.getSeperableBlurMaterial(u[s])),this.separableBlurMaterials[s].uniforms.texSize.value=new THREE.Vector2(o,a),o=Math.round(o/2),a=Math.round(a/2);this.compositeMaterial=this.getCompositeMaterial(this.nMips),this.compositeMaterial.uniforms.blurTexture1.value=this.renderTargetsVertical[0].texture,this.compositeMaterial.uniforms.blurTexture2.value=this.renderTargetsVertical[1].texture,this.compositeMaterial.uniforms.blurTexture3.value=this.renderTargetsVertical[2].texture,this.compositeMaterial.uniforms.blurTexture4.value=this.renderTargetsVertical[3].texture,this.compositeMaterial.uniforms.blurTexture5.value=this.renderTargetsVertical[4].texture,this.compositeMaterial.uniforms.bloomStrength.value=t,this.compositeMaterial.uniforms.bloomRadius.value=.1,this.compositeMaterial.needsUpdate=!0,this.compositeMaterial.uniforms.bloomFactors.value=[1,.8,.6,.4,.2],this.bloomTintColors=[new THREE.Vector3(1,1,1),new THREE.Vector3(1,1,1),new THREE.Vector3(1,1,1),new THREE.Vector3(1,1,1),new THREE.Vector3(1,1,1)],this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,this.copyUniforms=THREE.UniformsUtils.clone(Xe.uniforms),this.copyUniforms.opacity.value=1,this.materialCopy=new THREE.ShaderMaterial({uniforms:this.copyUniforms,vertexShader:Xe.vertexShader,fragmentShader:Xe.fragmentShader,blending:THREE.CustomBlending,blendSrc:THREE.SrcAlphaFactor,blendDst:THREE.OneFactor,blendEquation:THREE.AddEquation,blendSrcAlpha:THREE.ZeroFactor,blendDstAlpha:THREE.OneFactor,blendEquationAlpha:THREE.AddEquation,depthTest:!1,depthWrite:!1,transparent:!0}),this.enabled=!0,this.needsSwap=!1,this.oldClearColor=new THREE.Color,this.oldClearAlpha=1,this.camera=new THREE.OrthographicCamera(-1,1,1,-1,0,1),this.scene=new THREE.Scene,this.basic=new THREE.MeshBasicMaterial,this.quad=new THREE.Mesh(new THREE.PlaneBufferGeometry(2,2),null),this.quad.frustumCulled=!1,this.scene.add(this.quad)}nt.prototype=Object.assign(Object.create(Qe.prototype),{constructor:nt,dispose:function(){for(var e=0;e<this.renderTargetsHorizontal.length;e++)this.renderTargetsHorizontal[e].dispose();for(e=0;e<this.renderTargetsVertical.length;e++)this.renderTargetsVertical[e].dispose();this.renderTargetBright.dispose()},setSize:function(e,t){var r=Math.round(e/2),i=Math.round(t/2);this.renderTargetBright.setSize(r,i);for(var n=0;n<this.nMips;n++)this.renderTargetsHorizontal[n].setSize(r,i),this.renderTargetsVertical[n].setSize(r,i),this.separableBlurMaterials[n].uniforms.texSize.value=new THREE.Vector2(r,i),r=Math.round(r/2),i=Math.round(i/2)},render:function(e,t,r,i,n){this.oldClearColor.copy(e.getClearColor()),this.oldClearAlpha=e.getClearAlpha();var o=e.autoClear;e.autoClear=!1,e.setClearColor(this.clearColor,0),n&&e.context.disable(e.context.STENCIL_TEST),this.renderToScreen&&(this.quad.material=this.basic,this.basic.map=r.texture,e.render(this.scene,this.camera,void 0,!0)),this.highPassUniforms.tDiffuse.value=r.texture,this.highPassUniforms.luminosityThreshold.value=this.threshold,this.quad.material=this.materialHighPassFilter,e.render(this.scene,this.camera,this.renderTargetBright,!0);for(var a=this.renderTargetBright,s=0;s<this.nMips;s++)this.quad.material=this.separableBlurMaterials[s],this.separableBlurMaterials[s].uniforms.colorTexture.value=a.texture,this.separableBlurMaterials[s].uniforms.direction.value=nt.BlurDirectionX,e.render(this.scene,this.camera,this.renderTargetsHorizontal[s],!0),this.separableBlurMaterials[s].uniforms.colorTexture.value=this.renderTargetsHorizontal[s].texture,this.separableBlurMaterials[s].uniforms.direction.value=nt.BlurDirectionY,e.render(this.scene,this.camera,this.renderTargetsVertical[s],!0),a=this.renderTargetsVertical[s];this.quad.material=this.compositeMaterial,this.compositeMaterial.uniforms.bloomStrength.value=this.strength,this.compositeMaterial.uniforms.bloomRadius.value=this.radius,this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,e.render(this.scene,this.camera,this.renderTargetsHorizontal[0],!0),this.quad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=this.renderTargetsHorizontal[0].texture,n&&e.context.enable(e.context.STENCIL_TEST),this.renderToScreen?e.render(this.scene,this.camera,void 0,!1):e.render(this.scene,this.camera,r,!1),e.setClearColor(this.oldClearColor,this.oldClearAlpha),e.autoClear=o},getSeperableBlurMaterial:function(e){return new THREE.ShaderMaterial({defines:{KERNEL_RADIUS:e,SIGMA:e},uniforms:{colorTexture:{value:null},texSize:{value:new THREE.Vector2(.5,.5)},direction:{value:new THREE.Vector2(.5,.5)}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"#include <common>\t\t\t\tvarying vec2 vUv;\n\t\t\t\tuniform sampler2D colorTexture;\n\t\t\t\tuniform vec2 texSize;\t\t\t\tuniform vec2 direction;\t\t\t\t\t\t\t\tfloat gaussianPdf(in float x, in float sigma) {\t\t\t\t\treturn 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;\t\t\t\t}\t\t\t\tvoid main() {\n\t\t\t\t\tvec2 invSize = 1.0 / texSize;\t\t\t\t\tfloat fSigma = float(SIGMA);\t\t\t\t\tfloat weightSum = gaussianPdf(0.0, fSigma);\t\t\t\t\tvec3 diffuseSum = texture2D( colorTexture, vUv).rgb * weightSum;\t\t\t\t\tfor( int i = 1; i < KERNEL_RADIUS; i ++ ) {\t\t\t\t\t\tfloat x = float(i);\t\t\t\t\t\tfloat w = gaussianPdf(x, fSigma);\t\t\t\t\t\tvec2 uvOffset = direction * invSize * x;\t\t\t\t\t\tvec3 sample1 = texture2D( colorTexture, vUv + uvOffset).rgb;\t\t\t\t\t\tvec3 sample2 = texture2D( colorTexture, vUv - uvOffset).rgb;\t\t\t\t\t\tdiffuseSum += (sample1 + sample2) * w;\t\t\t\t\t\tweightSum += 2.0 * w;\t\t\t\t\t}\t\t\t\t\tgl_FragColor = vec4(diffuseSum/weightSum, 1.0);\n\t\t\t\t}"})},getCompositeMaterial:function(e){return new THREE.ShaderMaterial({defines:{NUM_MIPS:e},uniforms:{blurTexture1:{value:null},blurTexture2:{value:null},blurTexture3:{value:null},blurTexture4:{value:null},blurTexture5:{value:null},dirtTexture:{value:null},bloomStrength:{value:1},bloomFactors:{value:null},bloomTintColors:{value:null},bloomRadius:{value:0}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"varying vec2 vUv;\t\t\t\tuniform sampler2D blurTexture1;\t\t\t\tuniform sampler2D blurTexture2;\t\t\t\tuniform sampler2D blurTexture3;\t\t\t\tuniform sampler2D blurTexture4;\t\t\t\tuniform sampler2D blurTexture5;\t\t\t\tuniform sampler2D dirtTexture;\t\t\t\tuniform float bloomStrength;\t\t\t\tuniform float bloomRadius;\t\t\t\tuniform float bloomFactors[NUM_MIPS];\t\t\t\tuniform vec3 bloomTintColors[NUM_MIPS];\t\t\t\t\t\t\t\tfloat lerpBloomFactor(const in float factor) { \t\t\t\t\tfloat mirrorFactor = 1.2 - factor;\t\t\t\t\treturn mix(factor, mirrorFactor, bloomRadius);\t\t\t\t}\t\t\t\t\t\t\t\tvoid main() {\t\t\t\t\tgl_FragColor = bloomStrength * ( lerpBloomFactor(bloomFactors[0]) * vec4(bloomTintColors[0], 1.0) * texture2D(blurTexture1, vUv) + \t\t\t\t\t\t\t\t\t\t\t\t\t lerpBloomFactor(bloomFactors[1]) * vec4(bloomTintColors[1], 1.0) * texture2D(blurTexture2, vUv) + \t\t\t\t\t\t\t\t\t\t\t\t\t lerpBloomFactor(bloomFactors[2]) * vec4(bloomTintColors[2], 1.0) * texture2D(blurTexture3, vUv) + \t\t\t\t\t\t\t\t\t\t\t\t\t lerpBloomFactor(bloomFactors[3]) * vec4(bloomTintColors[3], 1.0) * texture2D(blurTexture4, vUv) + \t\t\t\t\t\t\t\t\t\t\t\t\t lerpBloomFactor(bloomFactors[4]) * vec4(bloomTintColors[4], 1.0) * texture2D(blurTexture5, vUv) );\t\t\t\t}"})}}),nt.BlurDirectionX=new THREE.Vector2(1,0),nt.BlurDirectionY=new THREE.Vector2(0,1);var ot={defines:{USE_VIGNETTE_TEXTURE:!1},uniforms:{tDiffuse:{value:null},vignetteOffset:{value:1},vignetteColor:{value:new THREE.Color(0)},vignetteTexture:{value:null}},vertexShader:"\n        varying vec2 vUv;\n        void main() {\n            vUv = uv;\n            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n        }\n    ",fragmentShader:"\n\t    uniform sampler2D tDiffuse;\n\n\t\tuniform float vignetteOffset;\n        uniform vec3 vignetteColor;\n        \n        #ifdef USE_VIGNETTE_TEXTURE\n            uniform sampler2D vignetteTexture;\n        #endif\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvec4 color = texture2D(tDiffuse, vUv);\n            vec2 uv = (vUv - vec2(0.5)) * vec2(vignetteOffset);\n            \n            vec3 color2 = vignetteColor;\n\n            #ifdef USE_VIGNETTE_TEXTURE\n                color2 *= texture2D(vignetteTexture, vUv).rgb;\n            #endif\n\n\t\t\tcolor.rgb = mix(color.rgb, color2, clamp(dot(uv, uv), 0.0, 1.0));\n\t\t\tgl_FragColor = color;\n\n\t\t}\n    "};function at(e,t){Qe.call(this),this.type="color",this.color=new THREE.Color(0),this.offset=1;var r={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat};this.tempRenderTarget=new THREE.WebGLRenderTarget(e/2,t/2,r),this.tempRenderTarget2=new THREE.WebGLRenderTarget(e/2,t/2,r),this.effectHBlur=new Je(lt),this.effectVBlur=new Je(st),this.effectHBlur.clear=!0,this.effectVBlur.clear=!0,this.effectHBlur.uniforms.h.value=4/e,this.effectVBlur.uniforms.v.value=4/t,this.material=new THREE.ShaderMaterial({defines:Object.assign({},ot.defines),uniforms:THREE.UniformsUtils.clone(ot.uniforms),vertexShader:ot.vertexShader,fragmentShader:ot.fragmentShader}),this.camera=new THREE.OrthographicCamera(-1,1,1,-1,0,1),this.scene=new THREE.Scene,this.quad=new THREE.Mesh(new THREE.PlaneBufferGeometry(2,2),null),this.quad.frustumCulled=!1,this.scene.add(this.quad)}at.prototype=Object.assign(Object.create(Qe.prototype),{constructor:at,setSize:function(e,t){this.tempRenderTarget.setSize(e/2,t/2),this.tempRenderTarget2.setSize(e/2,t/2),this.effectHBlur.uniforms.h.value=4/e,this.effectVBlur.uniforms.v.value=4/t},render:function(e,t,r,i,n){"color"===this.type?(this.material.uniforms.vignetteOffset.value=this.offset,this.material.uniforms.tDiffuse.value=r.texture,this.material.uniforms.vignetteColor.value.copy(this.color),this.material.defines.USE_VIGNETTE_TEXTURE&&(this.material.defines.USE_VIGNETTE_TEXTURE=!1,this.material.needsUpdate=!0),this.quad.material=this.material,this.renderToScreen?e.render(this.scene,this.camera,void 0,!0):e.render(this.scene,this.camera,t,!0)):"blur"===this.type&&(this.effectHBlur.render(e,this.tempRenderTarget2,r),this.effectVBlur.render(e,this.tempRenderTarget,this.tempRenderTarget2),this.material.uniforms.vignetteOffset.value=this.offset,this.material.uniforms.tDiffuse.value=r.texture,this.material.uniforms.vignetteTexture.value=this.tempRenderTarget.texture,this.material.uniforms.vignetteColor.value.setRGB(1,1,1),this.material.defines.USE_VIGNETTE_TEXTURE||(this.material.defines.USE_VIGNETTE_TEXTURE=!0,this.material.needsUpdate=!0),this.quad.material=this.material,this.renderToScreen?e.render(this.scene,this.camera,void 0,!0):e.render(this.scene,this.camera,t,!0))}});var st={uniforms:{tDiffuse:{value:null},v:{value:1/512}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform float v;","varying vec2 vUv;","void main() {","vec4 sum = vec4( 0.0 );","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * v ) ) * 0.051;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * v ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * v ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * v ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * v ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * v ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * v ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * v ) ) * 0.051;","gl_FragColor = sum;","}"].join("\n")},lt={uniforms:{tDiffuse:{value:null},h:{value:1/512}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform float h;","varying vec2 vUv;","void main() {","vec4 sum = vec4( 0.0 );","sum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * h, vUv.y ) ) * 0.051;","sum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * h, vUv.y ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * h, vUv.y ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * h, vUv.y ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;","sum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * h, vUv.y ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * h, vUv.y ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * h, vUv.y ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * h, vUv.y ) ) * 0.051;","gl_FragColor = sum;","}"].join("\n")},ct={vertexShader:"#include <skinning_pars_vertex>\n    void main() {\n        #include <skinbase_vertex>\n        #include <begin_vertex>\n        #include <skinning_vertex>\n        #include <project_vertex>\n    }",fragmentShader:"void main() {        gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);    }"};function ut(e,t,r,i){nt.call(this,e,t,r,i),this.prepareMaskMaterial=new THREE.ShaderMaterial(ct),this.prepareMaskSkinningMaterial=new THREE.ShaderMaterial(ct),this.prepareMaskSkinningMaterial.skinning=!0;var n={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat},o=Math.round(this.resolution.x/2),a=Math.round(this.resolution.y/2);this.renderTargetTemp=new THREE.WebGLMultisampleRenderTarget(o,a,n),this.renderTargetTemp.samples=5,this.renderTargetTemp.texture.name="UnrealGlowPass.temp",this.renderTargetTemp.texture.generateMipmaps=!1,this._dirty=!0,this.enable=!1}ut.prototype=Object.assign(Object.create(nt.prototype),{constructor:ut,dispose:function(){nt.prototype.dispose.call(this),this.renderTargetTemp.dispose()},setSize:function(e,t){nt.prototype.setSize.call(this,e,t);var r=Math.round(e/2),i=Math.round(t/2);this.renderTargetTemp.setSize(r,i)},render:function(e,t,r,i){if(this.enable){var a=this;e.materialManager.hasStrategy("GlowPass")||e.materialManager.addStrategy("GlowPass",function(e,t,r,i,n,o){return this.technique&&"skip"==this.technique.glow?null:this.technique&&this.technique.glow?this.technique.glow.isMaterial?this.technique.glow:n:this.isSkinnedMesh?(a.prepareMaskSkinningMaterial.side=n.side,a.prepareMaskSkinningMaterial):(a.prepareMaskMaterial.side=n.side,a.prepareMaskMaterial)});var n=e.autoClear;if(e.autoClear=!1,this._dirty){this.oldClearColor.copy(e.getClearColor()),this.oldClearAlpha=e.getClearAlpha(),e.setClearColor(new THREE.Color(0,0,0),0),e.materialManager.setMode("GlowPass");var o=t.autoUpdate,s=t.background,l=e.shadowMap.enable;t.autoUpdate=!1,t.background=null,e.shadowMap.enable=!1,e.render(t,r,this.renderTargetTemp,!0),t.autoUpdate=o,t.background=s,e.shadowMap.enable=l,e.materialManager.setMode(0),this.highPassUniforms.tDiffuse.value=this.renderTargetTemp.texture,this.highPassUniforms.luminosityThreshold.value=this.threshold,this.quad.material=this.materialHighPassFilter,e.render(this.scene,this.camera,this.renderTargetBright,!0);for(var c=this.renderTargetBright,u=0;u<this.nMips;u++)this.quad.material=this.separableBlurMaterials[u],this.separableBlurMaterials[u].uniforms.colorTexture.value=c.texture,this.separableBlurMaterials[u].uniforms.direction.value=nt.BlurDirectionX,e.render(this.scene,this.camera,this.renderTargetsHorizontal[u],!0),this.separableBlurMaterials[u].uniforms.colorTexture.value=this.renderTargetsHorizontal[u].texture,this.separableBlurMaterials[u].uniforms.direction.value=nt.BlurDirectionY,e.render(this.scene,this.camera,this.renderTargetsVertical[u],!0),c=this.renderTargetsVertical[u];this.quad.material=this.compositeMaterial,this.compositeMaterial.uniforms.bloomStrength.value=this.strength,this.compositeMaterial.uniforms.bloomRadius.value=this.radius,this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,e.render(this.scene,this.camera,this.renderTargetsHorizontal[0],!0),this.quad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=this.renderTargetsHorizontal[0].texture,e.setClearColor(this.oldClearColor,this.oldClearAlpha),this._dirty=!1}e.render(this.scene,this.camera,i,!1),e.autoClear=n}},dirty:function(){this._dirty=!0}});var ht={uniforms:{scene:{value:null},texSize:{value:new THREE.Vector2(1,1)},Stride:{value:10}},vertexShader:"\n\tvarying vec2 vUv;\n\tvoid main() {\n\t\tvUv = uv;\n\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t}\n    ",fragmentShader:"\n\t#define WT9_0 1.0\n\t#define WT9_1 0.8\n\t#define WT9_2 0.6\n\t#define WT9_3 0.4\n\t#define WT9_4 0.2\n\t#define WT9_NORMALIZE 5.2\n\tvarying vec2 vUv;\n\tuniform sampler2D scene;\n\tuniform vec2 texSize;\n\tuniform float Stride;\n\tvoid main() {\n\t\tfloat TexelIncrement =0.25 * Stride /texSize.x;\n\n\t\tfloat colour = texture2D(scene,vec2(vUv.x + TexelIncrement, vUv.y) ).x * (0.8/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x +2.0 * TexelIncrement, vUv.y)).x * (WT9_2/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x +3.0 * TexelIncrement, vUv.y)).x * (WT9_3/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x +4.0 * TexelIncrement, vUv.y)).x * (WT9_4/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x, vUv.y)).x * (WT9_0/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x - 1.0 * TexelIncrement, vUv.y)).x * (WT9_1/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x - 2.0 * TexelIncrement, vUv.y)).x * (WT9_2/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x - 3.0 * TexelIncrement, vUv.y)).x * (WT9_3/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x - 4.0 * TexelIncrement, vUv.y)).x * (WT9_3/WT9_NORMALIZE);\n\n\t\tTexelIncrement =0.5 * Stride /texSize.x;\n\t\tcolour += texture2D(scene,vec2(vUv.x + TexelIncrement, vUv.y) ).x * (0.8/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x +2.0 * TexelIncrement, vUv.y)).x * (WT9_2/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x +3.0 * TexelIncrement, vUv.y)).x * (WT9_3/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x +4.0 * TexelIncrement, vUv.y)).x * (WT9_4/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x, vUv.y)).x * (WT9_0/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x - 1.0 * TexelIncrement, vUv.y)).x * (WT9_1/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x - 2.0 * TexelIncrement, vUv.y)).x * (WT9_2/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x - 3.0 * TexelIncrement, vUv.y)).x * (WT9_3/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x - 4.0 * TexelIncrement, vUv.y)).x * (WT9_3/WT9_NORMALIZE);\n\n\t\tTexelIncrement =0.75 * Stride /texSize.x;\n\t\tcolour += texture2D(scene,vec2(vUv.x + TexelIncrement, vUv.y) ).x * (0.8/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x +2.0 * TexelIncrement, vUv.y)).x * (WT9_2/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x +3.0 * TexelIncrement, vUv.y)).x * (WT9_3/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x +4.0 * TexelIncrement, vUv.y)).x * (WT9_4/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x, vUv.y)).x * (WT9_0/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x - 1.0 * TexelIncrement, vUv.y)).x * (WT9_1/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x - 2.0 * TexelIncrement, vUv.y)).x * (WT9_2/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x - 3.0 * TexelIncrement, vUv.y)).x * (WT9_3/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x - 4.0 * TexelIncrement, vUv.y)).x * (WT9_3/WT9_NORMALIZE);\n\n\t\tTexelIncrement =Stride /texSize.x;\n\t\tcolour += texture2D(scene,vec2(vUv.x + TexelIncrement, vUv.y) ).x * (0.8/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x +2.0 * TexelIncrement, vUv.y)).x * (WT9_2/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x +3.0 * TexelIncrement, vUv.y)).x * (WT9_3/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x +4.0 * TexelIncrement, vUv.y)).x * (WT9_4/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x, vUv.y)).x * (WT9_0/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x - 1.0 * TexelIncrement, vUv.y)).x * (WT9_1/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x - 2.0 * TexelIncrement, vUv.y)).x * (WT9_2/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x - 3.0 * TexelIncrement, vUv.y)).x * (WT9_3/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x - 4.0 * TexelIncrement, vUv.y)).x * (WT9_3/WT9_NORMALIZE);\n\n\t\tfloat col = 1.0-colour*0.25;\n\n\t\tgl_FragColor = vec4(col,col,col,col);\n\t}\n    "},pt={uniforms:{blurX:{value:null},scene:{value:null},texSize:{value:new THREE.Vector2(1,1)},Stride:{value:10},Glowness:{value:2},GlowColor:{value:new THREE.Vector4(1,0,0,1)}},vertexShader:"\n\tvarying vec2 vUv;\n\tvoid main() {\n\t\tvUv = uv;\n\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t}\n\t",fragmentShader:"\n\t#define WT9_0 1.0\n\t#define WT9_1 0.8\n\t#define WT9_2 0.6\n\t#define WT9_3 0.4\n\t#define WT9_4 0.2\n\t#define WT9_NORMALIZE 5.2\n\tvarying vec2 vUv;\n\tuniform vec2 texSize;\n\tuniform float Stride;\n\tuniform float Glowness;\n\tuniform vec4 GlowColor;\n\tuniform sampler2D blurX;\n\tuniform sampler2D scene;\n\tvoid main() {\n\n\t\tfloat TexelIncrement = 0.25 * Stride / texSize.y;\n\n\t\tfloat colour = texture2D(blurX, vec2(vUv.x , vUv.y+TexelIncrement)).x * (0.8/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x, vUv.y +2.0 * TexelIncrement)).x* (WT9_2/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x , vUv.y+3.0 * TexelIncrement)).x * (WT9_3/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x , vUv.y+4.0 * TexelIncrement)).x * (WT9_4/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x, vUv.y)).x * (WT9_0/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x , vUv.y- 1.0 * TexelIncrement)).x * (WT9_1/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x, vUv.y - 2.0 * TexelIncrement)).x * (WT9_2/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x, vUv.y - 3.0 * TexelIncrement)).x* (WT9_3/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x , vUv.y- 4.0 * TexelIncrement)).x * (WT9_3/WT9_NORMALIZE);\n\n\t\tTexelIncrement = 0.5 * Stride / texSize.y;\n\t\tcolour += texture2D(blurX, vec2(vUv.x , vUv.y+TexelIncrement)).x * (0.8/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x, vUv.y +2.0 * TexelIncrement)).x* (WT9_2/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x , vUv.y+3.0 * TexelIncrement)).x * (WT9_3/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x , vUv.y+4.0 * TexelIncrement)).x * (WT9_4/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x, vUv.y)).x * (WT9_0/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x , vUv.y- 1.0 * TexelIncrement)).x * (WT9_1/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x, vUv.y - 2.0 * TexelIncrement)).x * (WT9_2/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x, vUv.y - 3.0 * TexelIncrement)).x* (WT9_3/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x , vUv.y- 4.0 * TexelIncrement)).x * (WT9_3/WT9_NORMALIZE);\n\n\t\tTexelIncrement = 0.75 * Stride / texSize.y;\n\t\tcolour += texture2D(blurX, vec2(vUv.x , vUv.y+TexelIncrement)).x * (0.8/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x, vUv.y +2.0 * TexelIncrement)).x* (WT9_2/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x , vUv.y+3.0 * TexelIncrement)).x * (WT9_3/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x , vUv.y+4.0 * TexelIncrement)).x * (WT9_4/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x, vUv.y)).x * (WT9_0/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x , vUv.y- 1.0 * TexelIncrement)).x * (WT9_1/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x, vUv.y - 2.0 * TexelIncrement)).x * (WT9_2/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x, vUv.y - 3.0 * TexelIncrement)).x* (WT9_3/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x , vUv.y- 4.0 * TexelIncrement)).x * (WT9_3/WT9_NORMALIZE);\n\n\t\tTexelIncrement = Stride / texSize.y;\n\t\tcolour += texture2D(blurX, vec2(vUv.x , vUv.y+TexelIncrement)).x * (0.8/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x, vUv.y +2.0 * TexelIncrement)).x* (WT9_2/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x , vUv.y+3.0 * TexelIncrement)).x * (WT9_3/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x , vUv.y+4.0 * TexelIncrement)).x * (WT9_4/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x, vUv.y)).x * (WT9_0/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x , vUv.y- 1.0 * TexelIncrement)).x * (WT9_1/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x, vUv.y - 2.0 * TexelIncrement)).x * (WT9_2/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x, vUv.y - 3.0 * TexelIncrement)).x* (WT9_3/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x , vUv.y- 4.0 * TexelIncrement)).x * (WT9_3/WT9_NORMALIZE);\n\n\t\tvec4 glo = (0.25 * Glowness * colour) * GlowColor;\n\t\tvec4 OldCol = texture2D(scene, vec2(vUv.x , vUv.y));\n\t\t\n\t\tgl_FragColor = vec4(OldCol.x*glo.xyz,1);\n\t}\n\t"},dt={vertexShader:"\n        #include <skinning_pars_vertex>\n        void main() {\n            #include <skinbase_vertex>\n            #include <begin_vertex>\n            #include <skinning_vertex>\n            #include <project_vertex>\n        }\n    ",fragmentShader:"\n        void main() {\n            gl_FragColor = vec4(1.0, 1.0, 1.0, 1.0);\n        }\n    "},ft={vertexShader:"\n        #include <skinning_pars_vertex>\n        void main() {\n            #include <skinbase_vertex>\n            #include <begin_vertex>\n            #include <skinning_vertex>\n            #include <project_vertex>\n        }\n    ",fragmentShader:"\n        void main() {\n            gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\n        }\n    "};function mt(e,t){this.color=new THREE.Vector4(1,0,0,1),this.strength=2,this.stride=10;var r={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat};this.markRenderTarget=new THREE.WebGLRenderTarget(e,t,r),this.markRenderTarget.texture.name="InnerGlowPass.mark",this.markRenderTarget.texture.generateMipmaps=!1,this.tempRenderTarget=new THREE.WebGLRenderTarget(e,t,r),this.tempRenderTarget.texture.name="InnerGlowPass.temp",this.tempRenderTarget.texture.generateMipmaps=!1,this.resultRenderTarget=new THREE.WebGLRenderTarget(e,t,r),this.resultRenderTarget.texture.name="InnerGlowPass.result",this.resultRenderTarget.texture.generateMipmaps=!1,this.prepareMarkMaterial=new THREE.ShaderMaterial(dt),this.prepareMarkSkinningMaterial=new THREE.ShaderMaterial(dt),this.prepareMarkSkinningMaterial.skinning=!0,this.prepareMaskMaterial=new THREE.ShaderMaterial(ft),this.prepareMaskSkinningMaterial=new THREE.ShaderMaterial(ft),this.prepareMaskSkinningMaterial.skinning=!0,this.innerGlowXMaterial=new THREE.ShaderMaterial({uniforms:THREE.UniformsUtils.clone(ht.uniforms),vertexShader:ht.vertexShader,fragmentShader:ht.fragmentShader}),this.innerGlowXMaterial.uniforms.texSize.value.set(e,t),this.innerGlowYMaterial=new THREE.ShaderMaterial({uniforms:THREE.UniformsUtils.clone(pt.uniforms),vertexShader:pt.vertexShader,fragmentShader:pt.fragmentShader}),this.innerGlowYMaterial.uniforms.texSize.value.set(e,t),this.copyUniforms=THREE.UniformsUtils.clone(Xe.uniforms),this.copyUniforms.opacity.value=1,this.materialCopy=new THREE.ShaderMaterial({uniforms:this.copyUniforms,vertexShader:Xe.vertexShader,fragmentShader:Xe.fragmentShader,blending:THREE.CustomBlending,blendSrc:THREE.SrcAlphaFactor,blendDst:THREE.OneFactor,blendEquation:THREE.AddEquation,blendSrcAlpha:THREE.ZeroFactor,blendDstAlpha:THREE.OneFactor,blendEquationAlpha:THREE.AddEquation,depthTest:!1,depthWrite:!1,transparent:!0}),this.oldClearColor=new THREE.Color,this.oldClearAlpha=1,this.camera=new THREE.OrthographicCamera(-1,1,1,-1,0,1),this.scene=new THREE.Scene,this.basic=new THREE.MeshBasicMaterial,this.quad=new THREE.Mesh(new THREE.PlaneBufferGeometry(2,2),null),this.quad.frustumCulled=!1,this.scene.add(this.quad),this._dirty=!0,this.enable=!1}Object.assign(mt.prototype,{dispose:function(){this.markRenderTarget.dispose(),this.tempRenderTarget.dispose(),this.resultRenderTarget.dispose()},setSize:function(e,t){this.markRenderTarget.setSize(e,t),this.tempRenderTarget.setSize(e,t),this.resultRenderTarget.setSize(e,t),this.innerGlowXMaterial.uniforms.texSize.value.set(e,t),this.innerGlowYMaterial.uniforms.texSize.value.set(e,t)},render:function(e,t,r,i){if(this.enable){var s=this;e.materialManager.hasStrategy("InnerGlowPass")||e.materialManager.addStrategy("InnerGlowPass",function(e,t,r,i,n,o){if(this.technique&&"skip"==this.technique.innerGlow)return null;var a=void 0;return(a=this.technique&&this.technique.innerGlow?this.technique.innerGlow.isMaterial?this.technique.innerGlow:this.isSkinnedMesh?s.prepareMarkSkinningMaterial:s.prepareMarkMaterial:this.isSkinnedMesh?s.prepareMaskSkinningMaterial:s.prepareMaskMaterial).side=n.side,a});var n=e.autoClear;if(e.autoClear=!1,this._dirty){this.oldClearColor.copy(e.getClearColor()),this.oldClearAlpha=e.getClearAlpha(),e.setClearColor(new THREE.Color(0,0,0),0),e.materialManager.setMode("InnerGlowPass");var o=t.autoUpdate,a=t.background,l=e.shadowMap.enable;t.autoUpdate=!1,t.background=null,e.shadowMap.enable=!1,e.render(t,r,this.markRenderTarget,!0),t.autoUpdate=o,t.background=a,e.shadowMap.enable=l,e.materialManager.setMode(0),this.innerGlowXMaterial.uniforms.scene.value=this.markRenderTarget.texture,this.innerGlowXMaterial.uniforms.Stride.value=this.stride,this.quad.material=this.innerGlowXMaterial,e.render(this.scene,this.camera,this.tempRenderTarget,!0),this.innerGlowYMaterial.uniforms.blurX.value=this.tempRenderTarget.texture,this.innerGlowYMaterial.uniforms.scene.value=this.markRenderTarget.texture,this.innerGlowYMaterial.uniforms.Stride.value=this.stride,this.innerGlowYMaterial.uniforms.Glowness.value=this.strength,this.innerGlowYMaterial.uniforms.GlowColor.value.copy(this.color),this.quad.material=this.innerGlowYMaterial,e.render(this.scene,this.camera,this.resultRenderTarget,!0),this.quad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=this.resultRenderTarget.texture,e.setClearColor(this.oldClearColor,this.oldClearAlpha),this._dirty=!1}e.render(this.scene,this.camera,i,!1),e.autoClear=n}},dirty:function(){this._dirty=!0}});var gt={vertexShader:"#include <skinning_pars_vertex>\n    void main() {\n        #include <skinbase_vertex>\n        #include <begin_vertex>\n        #include <skinning_vertex>\n        #include <project_vertex>\n    }",fragmentShader:"void main() {        gl_FragColor = vec4(0.0, 1.0, 1.0, 1.0);    }"},vt={uniforms:{maskTexture:{value:null},texSize:{value:new THREE.Vector2(.5,.5)},edgeColor:{value:new THREE.Vector3(1,1,1)}},vertexShader:"#include <skinning_pars_vertex>\n    varying vec2 vUv;\n    void main() {\n        vUv = uv;\n        #include <skinbase_vertex>\n        #include <begin_vertex>\n        #include <skinning_vertex>\n        #include <project_vertex>\n    }",fragmentShader:"varying vec2 vUv;    uniform sampler2D maskTexture;    uniform vec2 texSize;    uniform vec3 edgeColor;        void main() {\n        vec2 invSize = 1.0 / texSize;        vec4 uvOffset = vec4(1.0, 0.0, 0.0, 1.0) * vec4(invSize, invSize);        vec4 c1 = texture2D( maskTexture, vUv + uvOffset.xy);        vec4 c2 = texture2D( maskTexture, vUv - uvOffset.xy);        vec4 c3 = texture2D( maskTexture, vUv + uvOffset.yw);        vec4 c4 = texture2D( maskTexture, vUv - uvOffset.yw);        float b1 = max(c1.b, c2.b);        float b2 = max(c3.b, c4.b);        float a = max(b1, b2);        gl_FragColor = vec4(edgeColor, a);    }"},yt={defines:{MAX_RADIUS:4},uniforms:{colorTexture:{value:null},texSize:{value:new THREE.Vector2(.5,.5)},direction:{value:new THREE.Vector2(.5,.5)},kernelRadius:{value:1}},vertexShader:"#include <skinning_pars_vertex>\n    varying vec2 vUv;\n    void main() {\n        vUv = uv;\n        #include <skinbase_vertex>\n        #include <begin_vertex>\n        #include <skinning_vertex>\n        #include <project_vertex>\n    }",fragmentShader:"#include <common>    varying vec2 vUv;    uniform sampler2D colorTexture;    uniform vec2 texSize;    uniform vec2 direction;    uniform float kernelRadius;        float gaussianPdf(in float x, in float sigma) {        return 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;    }    void main() {        vec2 invSize = 1.0 / texSize;        float weightSum = gaussianPdf(0.0, kernelRadius);        vec4 diffuseColor = texture2D( colorTexture, vUv);        vec4 diffuseSum = diffuseColor * weightSum;        vec2 delta = direction * invSize * kernelRadius/float(MAX_RADIUS);        vec2 uvOffset = delta;        for( int i = 1; i <= MAX_RADIUS; i ++ ) {            float w = gaussianPdf(uvOffset.x, kernelRadius);            vec4 sample1 = texture2D( colorTexture, vUv + uvOffset);            vec4 sample2 = texture2D( colorTexture, vUv - uvOffset);            diffuseSum += ((sample1 + sample2) * w);            weightSum += (2.0 * w);            uvOffset += delta;        }        vec4 color = diffuseSum/weightSum;         gl_FragColor = color;    }"},bt={maskTexture:{value:null},edgeTexture1:{value:null},edgeTexture2:{value:null},edgeStrength:{value:1},edgeGlow:{value:1}};function xt(e,t,r){this.edgeColor=(new THREE.Color).setHex(void 0!==r?r:16777215),this.edgeColorString=this.edgeColor.getHexString(),this.edgeGlow=0,this.edgeThickness=1,this.edgeStrength=1.5,this.downSampleRatio=2;var i={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat},n=Math.round(e/this.downSampleRatio),o=Math.round(t/this.downSampleRatio);this.renderTargetMaskBuffer0=new THREE.WebGLMultisampleRenderTarget(e,t,i),this.renderTargetMaskBuffer0.texture.name="OutlinePass.mask0",this.renderTargetMaskBuffer0.samples=5,this.renderTargetMaskBuffer0.texture.generateMipmaps=!1,this.renderTargetMaskBuffer=new THREE.WebGLRenderTarget(e,t,i),this.renderTargetMaskBuffer.texture.name="OutlinePass.mask",this.renderTargetMaskBuffer.texture.generateMipmaps=!1,this.renderTargetMaskDownSampleBuffer=new THREE.WebGLRenderTarget(n,o,i),this.renderTargetMaskDownSampleBuffer.texture.name="OutlinePass.depthDownSample",this.renderTargetMaskDownSampleBuffer.texture.generateMipmaps=!1,this.renderTargetBlurBuffer1=new THREE.WebGLRenderTarget(n,o,i),this.renderTargetBlurBuffer1.texture.name="OutlinePass.blur1",this.renderTargetBlurBuffer1.texture.generateMipmaps=!1,this.renderTargetBlurBuffer2=new THREE.WebGLRenderTarget(Math.round(n/2),Math.round(o/2),i),this.renderTargetBlurBuffer2.texture.name="OutlinePass.blur2",this.renderTargetBlurBuffer2.texture.generateMipmaps=!1,this.renderTargetEdgeBuffer1=new THREE.WebGLRenderTarget(n,o,i),this.renderTargetEdgeBuffer1.texture.name="OutlinePass.edge1",this.renderTargetEdgeBuffer1.texture.generateMipmaps=!1,this.renderTargetEdgeBuffer2=new THREE.WebGLRenderTarget(Math.round(n/2),Math.round(o/2),i),this.renderTargetEdgeBuffer2.texture.name="OutlinePass.edge2",this.renderTargetEdgeBuffer2.texture.generateMipmaps=!1,this.prepareMaskMaterial=new THREE.ShaderMaterial(gt),this.prepareMaskMaterial.side=THREE.DoubleSide,this.prepareMaskMaterial.renderingOutline=!0,this.prepareMaskSkinningMaterial=new THREE.ShaderMaterial(gt),this.prepareMaskSkinningMaterial.side=THREE.DoubleSide,this.prepareMaskSkinningMaterial.skinning=!0,this.edgeDetectionMaterial=new THREE.ShaderMaterial({uniforms:THREE.UniformsUtils.clone(vt.uniforms),vertexShader:vt.vertexShader,fragmentShader:vt.fragmentShader}),this.separableBlurMaterial1=new THREE.ShaderMaterial({defines:Object.assign({},yt.defines),uniforms:THREE.UniformsUtils.clone(yt.uniforms),vertexShader:yt.vertexShader,fragmentShader:yt.fragmentShader}),this.separableBlurMaterial1.defines.MAX_RADIUS=4,this.separableBlurMaterial1.uniforms.texSize.value=new THREE.Vector2(n,o),this.separableBlurMaterial1.uniforms.kernelRadius.value=1,this.separableBlurMaterial2=new THREE.ShaderMaterial({defines:Object.assign({},yt.defines),uniforms:THREE.UniformsUtils.clone(yt.uniforms),vertexShader:yt.vertexShader,fragmentShader:yt.fragmentShader}),this.separableBlurMaterial2.defines.MAX_RADIUS=4,this.separableBlurMaterial2.uniforms.texSize.value=new THREE.Vector2(Math.round(n/2),Math.round(o/2)),this.separableBlurMaterial2.uniforms.kernelRadius.value=4,this.overlayMaterial=new THREE.ShaderMaterial({uniforms:THREE.UniformsUtils.clone(bt),vertexShader:"#include <skinning_pars_vertex>\n    varying vec2 vUv;\n    void main() {\n        vUv = uv;\n        #include <skinbase_vertex>\n        #include <begin_vertex>\n        #include <skinning_vertex>\n        #include <project_vertex>\n    }",fragmentShader:"varying vec2 vUv;    uniform sampler2D maskTexture;    uniform sampler2D edgeTexture1;    uniform sampler2D edgeTexture2;    uniform float edgeStrength;    uniform float edgeGlow;        void main() {        vec4 edgeValue1 = texture2D(edgeTexture1, vUv);        vec4 edgeValue2 = texture2D(edgeTexture2, vUv);        vec4 maskColor = texture2D(maskTexture, vUv);        vec4 edgeValue = edgeValue1 + edgeValue2 * edgeGlow;        vec4 finalColor = edgeStrength * edgeValue;        float a = finalColor.a * (1.0 - maskColor.b);        gl_FragColor = vec4(finalColor.rgb, a);    }",blending:THREE.NormalBlending,depthTest:!1,depthWrite:!1,transparent:!0}),this.copyUniforms=THREE.UniformsUtils.clone(Xe.uniforms),this.copyUniforms.opacity.value=1,this.materialCopy=new THREE.ShaderMaterial({uniforms:this.copyUniforms,vertexShader:Xe.vertexShader,fragmentShader:Xe.fragmentShader,blending:THREE.NoBlending,depthTest:!1,depthWrite:!1,transparent:!0}),this.camera=new THREE.OrthographicCamera(-1,1,1,-1,0,1),this.scene=new THREE.Scene,this.quad=new THREE.Mesh(new THREE.PlaneBufferGeometry(2,2),null),this.quad.frustumCulled=!1,this.scene.add(this.quad),this.tempPulseColor1=new THREE.Color,this.tempPulseColor2=new THREE.Color,this.textureMatrix=new THREE.Matrix4,this.oldClearColor=new THREE.Color,this.oldClearAlpha=1,this._dirty=!0,this.enable=!1}Object.assign(xt.prototype,{dispose:function(){this.renderTargetMaskBuffer.dispose(),this.renderTargetMaskBuffer0.dispose(),this.renderTargetMaskDownSampleBuffer.dispose(),this.renderTargetBlurBuffer1.dispose(),this.renderTargetBlurBuffer2.dispose(),this.renderTargetEdgeBuffer1.dispose(),this.renderTargetEdgeBuffer2.dispose()},setSize:function(e,t){this.renderTargetMaskBuffer.setSize(e,t),this.renderTargetMaskBuffer0.setSize(e,t);var r=Math.round(e/this.downSampleRatio),i=Math.round(t/this.downSampleRatio);this.renderTargetMaskDownSampleBuffer.setSize(r,i),this.renderTargetBlurBuffer1.setSize(r,i),this.renderTargetEdgeBuffer1.setSize(r,i),this.separableBlurMaterial1.uniforms.texSize.value.set(r,i),r=Math.round(r/2),i=Math.round(i/2),this.renderTargetBlurBuffer2.setSize(r,i),this.renderTargetEdgeBuffer2.setSize(r,i),this.separableBlurMaterial2.uniforms.texSize.value.set(r,i)},render:function(e,t,r,i){if(this.enable){if(!e.materialManager.hasStrategy("OutlinePass_"+this.edgeColorString)){var s=this;e.materialManager.addStrategy("OutlinePass_"+this.edgeColorString,function(e,t,r,i,n,o){var a="outline_0x"+s.edgeColorString;return this.technique&&this.technique[a]&&"skip"!==this.technique[a]?this.technique[a].isMaterial?this.technique[a]:this.isSkinnedMesh?s.prepareMaskSkinningMaterial:s.prepareMaskMaterial:null})}this.oldClearColor.copy(e.getClearColor()),this.oldClearAlpha=e.getClearAlpha();var n=e.autoClear;if(e.autoClear=!1,this._dirty){var o=e.capabilities.isWebGL2;e.setClearColor(0,0),e.materialManager.setMode("OutlinePass_"+this.edgeColorString);var a=t.autoUpdate,l=t.background,c=e.shadowMap.enable;t.autoUpdate=!1,t.background=null,e.shadowMap.enable=!1,r.layers.enable(1),e.render(t,r,o?this.renderTargetMaskBuffer0:this.renderTargetMaskBuffer,!0),r.layers.disable(1),t.autoUpdate=a,t.background=l,e.shadowMap.enable=c,e.materialManager.setMode(0),this.quad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=o?this.renderTargetMaskBuffer0.texture:this.renderTargetMaskBuffer.texture,e.render(this.scene,this.camera,this.renderTargetMaskDownSampleBuffer,!0),this.quad.material=this.edgeDetectionMaterial,this.edgeDetectionMaterial.uniforms.maskTexture.value=this.renderTargetMaskDownSampleBuffer.texture,this.edgeDetectionMaterial.uniforms.texSize.value.set(this.renderTargetMaskDownSampleBuffer.width,this.renderTargetMaskDownSampleBuffer.height),this.edgeDetectionMaterial.uniforms.edgeColor.value=this.edgeColor,e.render(this.scene,this.camera,this.renderTargetEdgeBuffer1,!0),this.quad.material=this.separableBlurMaterial1,this.separableBlurMaterial1.uniforms.colorTexture.value=this.renderTargetEdgeBuffer1.texture,this.separableBlurMaterial1.uniforms.direction.value=xt.BlurDirectionX,this.separableBlurMaterial1.uniforms.kernelRadius.value=this.edgeThickness,e.render(this.scene,this.camera,this.renderTargetBlurBuffer1,!0),this.separableBlurMaterial1.uniforms.colorTexture.value=this.renderTargetBlurBuffer1.texture,this.separableBlurMaterial1.uniforms.direction.value=xt.BlurDirectionY,e.render(this.scene,this.camera,this.renderTargetEdgeBuffer1,!0),this.quad.material=this.separableBlurMaterial2,this.separableBlurMaterial2.uniforms.colorTexture.value=this.renderTargetEdgeBuffer1.texture,this.separableBlurMaterial2.uniforms.direction.value=xt.BlurDirectionX,e.render(this.scene,this.camera,this.renderTargetBlurBuffer2,!0),this.separableBlurMaterial2.uniforms.colorTexture.value=this.renderTargetBlurBuffer2.texture,this.separableBlurMaterial2.uniforms.direction.value=xt.BlurDirectionY,e.render(this.scene,this.camera,this.renderTargetEdgeBuffer2,!0),this.quad.material=this.overlayMaterial,this.overlayMaterial.uniforms.maskTexture.value=o?this.renderTargetMaskBuffer0.texture:this.renderTargetMaskBuffer.texture,this.overlayMaterial.uniforms.edgeTexture1.value=this.renderTargetEdgeBuffer1.texture,this.overlayMaterial.uniforms.edgeTexture2.value=this.renderTargetEdgeBuffer2.texture,this.overlayMaterial.uniforms.edgeStrength.value=this.edgeStrength,this.overlayMaterial.uniforms.edgeGlow.value=this.edgeGlow,this._dirty=!1}e.render(this.scene,this.camera,i,!1),e.setClearColor(this.oldClearColor,this.oldClearAlpha),e.autoClear=n}},dirty:function(){this._dirty=!0}}),xt.BlurDirectionX=new THREE.Vector2(1,0),xt.BlurDirectionY=new THREE.Vector2(0,1);var Et={uniforms:{tDiffuse1:{value:null},tDiffuse2:{value:null},mixRatio:{value:.5},opacity:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float opacity;","uniform float mixRatio;","uniform sampler2D tDiffuse1;","uniform sampler2D tDiffuse2;","varying vec2 vUv;","void main() {","vec4 texel1 = texture2D( tDiffuse1, vUv );","vec4 texel2 = texture2D( tDiffuse2, vUv );","gl_FragColor = opacity * mix( texel1, texel2, mixRatio );","}"].join("\n")},_t=function(e,t){for(var r=0,i=1/t,n=e;0<n;)r+=i*(n%t),n=Math.floor(n/t),i/=t;return r};function wt(e,t,r){this._samplingSize=r||30;for(var i=[],n=0;n<this._samplingSize;n++)i.push([_t(n,2),_t(n,3)]);this._haltonSequence=i,this._prevFrame=new THREE.WebGLRenderTarget(e,t,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat}),this._output=new THREE.WebGLRenderTarget(e,t,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat}),this._frame=0,this.quadCamera=new THREE.OrthographicCamera(-1,1,1,-1,0,1),this.quadScene=new THREE.Scene,this.quad=new THREE.Mesh(new THREE.PlaneGeometry(2,2),new THREE.ShaderMaterial({uniforms:THREE.UniformsUtils.clone(Et.uniforms),vertexShader:Et.vertexShader,fragmentShader:Et.fragmentShader,depthTest:!1,depthWrite:!1})),this.quadScene.add(this.quadCamera),this.quadScene.add(this.quad)}wt.prototype=Object.assign(wt.prototype,{constructor:wt,setSize:function(e,t){this._prevFrame.setSize(e,t),this._output.setSize(e,t)},setSamplingSize:function(e){this._samplingSize=e||30;for(var t=[],r=0;r<this._samplingSize;r++)t.push([_t(r,2),_t(r,3)]);this._haltonSequence=t,this._frame=0},start:function(){this._frame=0},finished:function(){return this._frame>=this._samplingSize},frame:function(){return this._frame},jitterProjection:function(e,t,r){var i=this._haltonSequence[this._frame];i||console.error("THREE.SuperSampler: try to jitter camera after finished!",this._frame,this._haltonSequence.length),e.setViewOffset&&e.setViewOffset(t,r,.5*(2*i[0]-1),.5*(2*i[1]-1),t,r)},sample:function(e,t){var r=0===this._frame;this.quad.material.uniforms.tDiffuse1.value=t,this.quad.material.uniforms.tDiffuse2.value=this._prevFrame.texture,this.quad.material.uniforms.mixRatio.value=r?0:.9,this.quad.material.uniforms.opacity.value=1;var i=e.getClearColor().getHex(),n=e.getClearAlpha();e.setClearColor(0,0),e.render(this.quadScene,this.quadCamera,this._output,!0),e.setClearColor(i,n);var o=this._prevFrame;return this._prevFrame=this._output,this._output=o,this._frame++,this._prevFrame},output:function(){return this._prevFrame}});var Tt={temporalSuperSampling:{enable:!0,size:30},postEffect:{enable:!0,bloom:{enable:!0,strength:.14,radius:.4,threshold:.7},screenSpaceAmbientOcclusion:{enable:!0,radius:.2,quality:"medium",intensity:.8,temporalFilter:!0,ignoreTransparent:!1},colorCorrection:{enable:!0,exposure:0,brightness:0,contrast:1.2,saturation:1.2,gamma:1},vignette:{enable:!0,type:"color",color:0,offset:1},FXAA:{enable:!0}}};function Mt(e,t){if("[object Object]"!==t.toString())return t;for(var r in t)t.hasOwnProperty(r)&&(e||(e={}),e[r]=Mt(e[r],t[r]));return e}function St(e,t){this._superSampler=new wt(e,t,30);var r={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat};this._tempRenderTarget0=new THREE.WebGLMultisampleRenderTarget(e,t,r),this._tempRenderTarget0.samples=5,this._tempRenderTarget=new THREE.WebGLRenderTarget(e,t,r),this._tempRenderTarget2=new THREE.WebGLRenderTarget(e,t,r),this._ssaoPrePass=new rt(e,t),this._ssaoKernalSize=12,this._normalDepthPrePass=new Ke(e,t),this._bloomPass=new nt({x:e,y:t},.14,.4,.6),this._colorPass=new Je(We),this._colorPass.clear=!0,this._vignettePass=new at(e,t),this._fxaaPass=new Je(Ye),this._fxaaPass.uniforms.resolution.value.set(1/e,1/t),this._fxaaPass.clear=!0,this._copyPass=new Je(Xe),this._copyPass.clear=!0,this._glowPass=new ut({x:e,y:t},1.5,.4,.2),this._innerGlowPass=new mt(e,t),this._outlinePasses=new Map,this._config=Mt({},Tt),this.setConfig({}),this.width=e,this.height=t,this.onlyAO=!1}St.prototype=Object.assign(St.prototype,{constructor:St,setConfig:function(e){this._config=Mt(this._config,e),this._superSampler.setSamplingSize(this._config.temporalSuperSampling.size);var t=this._config.postEffect.bloom;this._bloomPass.strength=t.strength,this._bloomPass.radius=t.radius,this._bloomPass.threshold=t.threshold,t=this._config.postEffect.screenSpaceAmbientOcclusion,this._ssaoPrePass.setParameter("radius",t.radius),this._ssaoPrePass.setParameter("bias",t.radius/50),this._ssaoPrePass.setParameter("intensity",t.intensity),this._ssaoKernalSize={low:6,medium:12,high:32,ultra:64}[t.quality]||12,this._ssaoPrePass.setKernelSize(this._ssaoKernalSize),t=this._config.postEffect.colorCorrection,this._colorPass.uniforms.exposure.value=t.exposure,this._colorPass.uniforms.brightness.value=t.brightness,this._colorPass.uniforms.contrast.value=t.contrast,this._colorPass.uniforms.saturation.value=t.saturation,this._colorPass.uniforms.gamma.value=t.gamma,t=this._config.postEffect.vignette,this._vignettePass.type=t.type,this._vignettePass.color.setHex(t.color),this._vignettePass.offset=t.offset,this.dirty()},enable:function(e){if(-1<e.indexOf("outline")){var t=e.split("_"),r=t[1];if(e=t[0],this._outlinePasses.has(r))this._outlinePasses.get(r).enable=!0;else{var i=new xt(this.width,this.height,r);i.enable=!0,this._outlinePasses.set(r,i)}}else this["_"+e+"Pass"].enable=!0},disable:function(e){if(-1<e.indexOf("outline")){var t=e.split("_"),r=t[1];e=t[0],this._outlinePasses.has(r)&&(this._outlinePasses.get(r).enable=!1)}else this["_"+e+"Pass"].enable=!1},setSize:function(t,r){this._superSampler.setSize(t,r),this._tempRenderTarget0.setSize(t,r),this._tempRenderTarget.setSize(t,r),this._tempRenderTarget2.setSize(t,r),this._ssaoPrePass.setSize(t,r),this._bloomPass.setSize(t,r),this._colorPass.setSize(t,r),this._vignettePass.setSize(t,r),this._fxaaPass.setSize(t,r),this._fxaaPass.uniforms.resolution.value.set(1/t,1/r),this._copyPass.setSize(t,r),this._glowPass.setSize(t,r),this._innerGlowPass.setSize(t,r),this._outlinePasses.forEach(function(e){e.setSize(t,r)}),this.width=t,this.height=r,this.dirty()},render:function(t,r,i){var e=this._config.temporalSuperSampling.enable,n=this._config.postEffect.enable,o=!1;if(n||e){var a,s;a=e?this._superSampler.finished()?this._superSampler.output():(this._superSampler.jitterProjection(i,this._tempRenderTarget.width,this._tempRenderTarget.height),o=!0,s=t.capabilities.isWebGL2?this._tempRenderTarget0:this._tempRenderTarget,t.render(r,i,s),n&&this._config.postEffect.screenSpaceAmbientOcclusion.enable&&(this._normalDepthPrePass.render(t,r,i,this._config.postEffect.screenSpaceAmbientOcclusion.ignoreTransparent),this._config.postEffect.screenSpaceAmbientOcclusion.temporalFilter&&this._ssaoPrePass.setKernelSize(this._ssaoKernalSize,this._superSampler.frame()),this._ssaoPrePass.render(this._normalDepthPrePass.getNormalTexture(),this._normalDepthPrePass.getDepthTexture(),t,i,s,this.onlyAO)),this._superSampler.sample(t,s.texture)):(s=t.capabilities.isWebGL2?this._tempRenderTarget0:this._tempRenderTarget,t.render(r,i,s),n&&this._config.postEffect.screenSpaceAmbientOcclusion.enable&&(this._normalDepthPrePass.render(t,r,i,this._config.postEffect.screenSpaceAmbientOcclusion.ignoreTransparent),this._ssaoPrePass.render(this._normalDepthPrePass.getNormalTexture(),this._normalDepthPrePass.getDepthTexture(),t,i,s,this.onlyAO)),s),this._copyPass.render(t,this._tempRenderTarget2,a);var l=this._tempRenderTarget2,c=this._tempRenderTarget;if(n&&this._config.postEffect.colorCorrection.enable){this._colorPass.render(t,c,l);var u=l;l=c,c=u}n&&this._config.postEffect.vignette.enable&&(this._vignettePass.render(t,c,l),u=l,l=c,c=u),n&&this._config.postEffect.bloom.enable&&this._bloomPass.render(t,c,l),this._innerGlowPass.render(t,r,i,l),this._glowPass.render(t,r,i,l),this._outlinePasses.forEach(function(e){return e.render(t,r,i,l)}),n&&this._config.postEffect.FXAA.enable&&(this._fxaaPass.render(t,c,l),u=l,l=c,c=u);var h=t.autoClear;t.autoClear=!1,this._copyPass.render(t,void 0,l),t.autoClear=h,o&&i.clearViewOffset()}else t.capabilities.isWebGL2?(t.render(r,i,this._tempRenderTarget0),this._copyPass.render(t,void 0,this._tempRenderTarget0)):t.render(r,i),this._innerGlowPass.render(t,r,i),this._glowPass.render(t,r,i),this._outlinePasses.forEach(function(e){return e.render(t,r,i)})},dirty:function(){this._config.temporalSuperSampling.enable&&this._superSampler.start(),this._innerGlowPass.dirty(),this._glowPass.dirty(),this._outlinePasses.forEach(function(e){return e.dirty()})}});var Rt=new THREE.Vector3,Pt=new THREE.Vector3,At={vertexShader:"\n        #include <skinning_pars_vertex>\n        void main() {\n            #include <skinbase_vertex>\n            #include <begin_vertex>\n            #include <skinning_vertex>\n            #include <project_vertex>\n        }\n    ",fragmentShader:"\n        void main() {\n            gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\n        }\n    "},Ct=new THREE.ShaderMaterial(At),Lt=new THREE.ShaderMaterial(At);Lt.skinning=!0;var Ot,Ht,Ft=new THREE.Color,kt=function(){function u(e,t){y(this,u),this.camera=new THREE.OrthographicCamera;var r={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat};this.tempRenderTarget=new THREE.WebGLRenderTarget(e,t,r),this.radius=.1,this.renderTargetsHorizontal=[],this.renderTargetsVertical=[],this.nMips=5;for(var i=Math.round(e/2),n=Math.round(t/2),o=0;o<this.nMips;o++){var a=new THREE.WebGLRenderTarget(i,n,r);a.texture.name="AOBaker.h"+o,a.texture.generateMipmaps=!1,this.renderTargetsHorizontal.push(a);var s=new THREE.WebGLRenderTarget(i,n,r);s.texture.name="AOBaker.v"+o,s.texture.generateMipmaps=!1,this.renderTargetsVertical.push(s),i=Math.round(i/2),n=Math.round(n/2)}this.separableBlurMaterials=[];var l=[3,5,7,9,11];i=Math.round(e/2),n=Math.round(t/2);for(var c=0;c<this.nMips;c++)this.separableBlurMaterials.push(this.getSeperableBlurMaterial(l[c])),this.separableBlurMaterials[c].uniforms.texSize.value=new THREE.Vector2(i,n),i=Math.round(i/2),n=Math.round(n/2);this.compositeMaterial=this.getCompositeMaterial(this.nMips),this.compositeMaterial.uniforms.blurTexture1.value=this.renderTargetsVertical[0].texture,this.compositeMaterial.uniforms.blurTexture2.value=this.renderTargetsVertical[1].texture,this.compositeMaterial.uniforms.blurTexture3.value=this.renderTargetsVertical[2].texture,this.compositeMaterial.uniforms.blurTexture4.value=this.renderTargetsVertical[3].texture,this.compositeMaterial.uniforms.blurTexture5.value=this.renderTargetsVertical[4].texture,this.compositeMaterial.uniforms.bloomRadius.value=.1,this.compositeMaterial.needsUpdate=!0,this.compositeMaterial.uniforms.bloomFactors.value=[.5,.7,.8,.9,1],this._camera=new THREE.OrthographicCamera(-1,1,1,-1,0,1),this.scene=new THREE.Scene,this.quad=new THREE.Mesh(new THREE.PlaneBufferGeometry(2,2),null),this.quad.frustumCulled=!1,this.scene.add(this.quad)}return u.prototype.bake=function(e,t,r,i){r&&this.fit(r,i),e.materialManager.hasStrategy("AOBaker")||e.materialManager.addStrategy("AOBaker",function(e,t,r,i,n,o){return this.userData.ground?null:n.skinning?Lt:Ct});var n=e.autoClear;e.autoClear=!1,Ft.copy(e.getClearColor());var o=e.getClearAlpha();e.setClearColor(new THREE.Color(1,1,1),1),e.materialManager.setMode("AOBaker");var a=t.autoUpdate,s=t.background,l=e.shadowMap.enable;t.autoUpdate=!1,t.background=null,e.shadowMap.enable=!1,e.render(t,this.camera,this.tempRenderTarget,!0),t.autoUpdate=a,t.background=s,e.shadowMap.enable=l,e.materialManager.setMode(0);for(var c=this.tempRenderTarget,u=0;u<this.nMips;u++)this.quad.material=this.separableBlurMaterials[u],this.separableBlurMaterials[u].uniforms.colorTexture.value=c.texture,this.separableBlurMaterials[u].uniforms.direction.value=new THREE.Vector2(1,0),e.render(this.scene,this._camera,this.renderTargetsHorizontal[u],!0),this.separableBlurMaterials[u].uniforms.colorTexture.value=this.renderTargetsHorizontal[u].texture,this.separableBlurMaterials[u].uniforms.direction.value=new THREE.Vector2(0,1),e.render(this.scene,this._camera,this.renderTargetsVertical[u],!0),c=this.renderTargetsVertical[u];this.quad.material=this.compositeMaterial,this.compositeMaterial.uniforms.bloomRadius.value=1-this.radius,e.render(this.scene,this._camera,this.tempRenderTarget,!0),e.setClearColor(Ft,o),e.autoClear=n},u.prototype.fit=function(e,t){var r=e.getCenter(Rt),i=e.getSize(Pt);this.camera.position.set(r.x,r.y+i.y,r.z),this.camera.rotation.set(-Math.PI/2,0,0),this.camera.matrixAutoUpdate=!1,this.camera.updateMatrix(),this.camera.matrix.premultiply(t),this.camera.near=i.y/3,this.camera.far=2*i.y,this.camera.left=-i.x/2+.075,this.camera.right=i.x/2-.075,this.camera.top=i.z/2-.075,this.camera.bottom=-i.z/2+.075,this.camera.updateProjectionMatrix(),i.x=1024,i.z=1024,this.tempRenderTarget.setSize(i.x,i.z);for(var n=Math.round(i.x/2),o=Math.round(i.z/2),a=0;a<this.nMips;a++)this.renderTargetsHorizontal[a].setSize(n,o),this.renderTargetsVertical[a].setSize(n,o),this.separableBlurMaterials[a].uniforms.texSize.value=new THREE.Vector2(n,o),n=Math.round(n/2),o=Math.round(o/2)},u.prototype.dispose=function(){this.tempRenderTarget.dispose();for(var e=0;e<this.renderTargetsHorizontal.length;e++)this.renderTargetsHorizontal[e].dispose();for(var t=0;t<this.renderTargetsVertical.length;t++)this.renderTargetsVertical[t].dispose()},u.prototype.getSeperableBlurMaterial=function(e){return new THREE.ShaderMaterial({defines:{KERNEL_RADIUS:e,SIGMA:e},uniforms:{colorTexture:{value:null},texSize:{value:new THREE.Vector2(.5,.5)},direction:{value:new THREE.Vector2(.5,.5)}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"#include <common>\t\t\t\tvarying vec2 vUv;\n\t\t\t\tuniform sampler2D colorTexture;\n\t\t\t\tuniform vec2 texSize;\t\t\t\tuniform vec2 direction;\t\t\t\t\t\t\t\tfloat gaussianPdf(in float x, in float sigma) {\t\t\t\t\treturn 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;\t\t\t\t}\t\t\t\tvoid main() {\n\t\t\t\t\tvec2 invSize = 1.0 / texSize;\t\t\t\t\tfloat fSigma = float(SIGMA);\t\t\t\t\tfloat weightSum = gaussianPdf(0.0, fSigma);\t\t\t\t\tvec3 diffuseSum = texture2D( colorTexture, vUv).rgb * weightSum;\t\t\t\t\tfor( int i = 1; i < KERNEL_RADIUS; i ++ ) {\t\t\t\t\t\tfloat x = float(i);\t\t\t\t\t\tfloat w = gaussianPdf(x, fSigma);\t\t\t\t\t\tvec2 uvOffset = direction * invSize * x;\t\t\t\t\t\tvec3 sample1 = texture2D( colorTexture, vUv + uvOffset).rgb;\t\t\t\t\t\tvec3 sample2 = texture2D( colorTexture, vUv - uvOffset).rgb;\t\t\t\t\t\tdiffuseSum += (sample1 + sample2) * w;\t\t\t\t\t\tweightSum += 2.0 * w;\t\t\t\t\t}\t\t\t\t\tgl_FragColor = vec4(diffuseSum/weightSum, 1.0);\n\t\t\t\t}"})},u.prototype.getCompositeMaterial=function(e){return new THREE.ShaderMaterial({defines:{NUM_MIPS:e},uniforms:{blurTexture1:{value:null},blurTexture2:{value:null},blurTexture3:{value:null},blurTexture4:{value:null},blurTexture5:{value:null},bloomFactors:{value:null},bloomRadius:{value:0}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"\n\t\t\t\tvarying vec2 vUv;\n\t\t\t\tuniform sampler2D blurTexture1;\n\t\t\t\tuniform sampler2D blurTexture2;\n\t\t\t\tuniform sampler2D blurTexture3;\n\t\t\t\tuniform sampler2D blurTexture4;\n\t\t\t\tuniform sampler2D blurTexture5;\n\t\t\t\tuniform float bloomRadius;\n\t\t\t\tuniform float bloomFactors[NUM_MIPS];\n\t\t\t\t\n\t\t\t\tfloat lerpBloomFactor(const in float factor) { \n\t\t\t\t\tfloat mirrorFactor = 1.2 - factor;\n\t\t\t\t\treturn mix(factor, mirrorFactor, bloomRadius);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tvoid main() {\n\t\t\t\t\tfloat factor0 = lerpBloomFactor(bloomFactors[0]);\n\t\t\t\t\tfloat factor1 = lerpBloomFactor(bloomFactors[1]);\n\t\t\t\t\tfloat factor2 = lerpBloomFactor(bloomFactors[2]);\n\t\t\t\t\tfloat factor3 = lerpBloomFactor(bloomFactors[3]);\n\t\t\t\t\tfloat factor4 = lerpBloomFactor(bloomFactors[4]);\n\t\t\t\t\tgl_FragColor = (factor0 * texture2D(blurTexture1, vUv) +\n\t\t\t\t\t\t\t\t\t\tfactor1 * texture2D(blurTexture2, vUv) +\n\t\t\t\t\t\t\t\t\t\tfactor2 * texture2D(blurTexture3, vUv) +\n\t\t\t\t\t\t\t\t\t\tfactor3 * texture2D(blurTexture4, vUv) +\n\t\t\t\t\t\t\t\t\t\tfactor4 * texture2D(blurTexture5, vUv)) / (factor0 + factor1 + factor2 + factor3 + factor4);\n\t\t\t\t}\t\n\t\t\t"})},l(u,[{key:"ao",get:function(){return this.tempRenderTarget.texture}}]),u}(),It=function(c){function r(e){y(this,r);var t=p(this,c.call(this,e));return t._height=3,t.miscNode=null,t.miscObject=null,t.wallNode=null,t.wallObject=null,t.roofNode=null,t.roofObject=null,t.ceilingNode=null,t.ceilingObject=null,t._marker=null,t._navigation=null,t._groundAOBaker=null,t}return u(r,c),r.prototype.destroy=function(){this._groundAOBaker&&(this.plan.node.traverse(function(e){var t=e.material;t&&(t.aoMap=null,t.needsUpdate=!0)}),this._groundAOBaker.dispose(),this._groundAOBaker=null),c.prototype.destroy.call(this)},r.prototype.synTransform=function(e){this.setupUserData(e),this.setupParent(e),this.setupTranslation(e)},r.prototype.setupFromData=function(e){var t=this,r=e.data,i=e.options||{};i.complete=function(){t._setup(e),t._synStyle(!0)},this.synTransform(e),this.app._floorLoaderManager.loadFromData(this,r,i)},r.prototype.setupFromURL=function(e){var t=this,r=this.app.confirmURL(e.url),i=e.options||{};i.complete=function(){t._setup(e)},this.synTransform(e),this.app._floorLoaderManager.load(this,r,i)},r.prototype.customSetup=function(e){this._height=e.height||this._height},r.prototype.clone=function(e,t){var r=c.prototype.clone.call(this,e,t);return r.miscNode=r.node.getChildNodeByIndexPath(this.miscNode.getIndexPath(this.node)),r.wallNode=r.node.getChildNodeByIndexPath(this.wallNode.getIndexPath(this.node)),r.roofNode=r.node.getChildNodeByIndexPath(this.roofNode.getIndexPath(this.node)),r.ceilingNode=r.node.getChildNodeByIndexPath(this.ceilingNode.getIndexPath(this.node)),r},r.prototype._getDoors=function(e){for(var t=[],r=0;r<this.doors.length;r++){var i=this.doors[r];i[e]&&t.push(i)}return t},r.prototype._createMarker=function(e){var t=(e=e||{}).connectorName||/connector/,r=e.markerName||/marker/,i=this.attachPoints.query(t),n=this.attachPoints.query(r);if(0!=i.length||0!=n.length){var o=i[0],a=n[0];e.type="Marker",e.parent=this,Z.isNull(e.size)?console.error("floor's marker must provide size to show"):Z.isNull(e.canvas)&&Z.isNull(e.url)?console.error("floor's marker must provide 'canvas' or 'url' to show"):(a&&(e.position=a.position),o?e.lineToPosition=o.position:e.lineColor&&console.error("Please make sure connector is avaliable for showing connection line of marker"),this._marker=this.app.create(e))}},r.prototype.showAllRoofs=function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];this.roofNode&&(this.roofNode.visible=e);for(var t=this.rooms,r=0;r<t.length;r++)t[r].roof.visible=e},r.prototype.showAllCeilings=function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];this.ceilingNode&&(this.ceilingNode.visible=e);for(var t=this.rooms,r=0;r<t.length;r++)t[r].ceiling.visible=e},r.prototype.showMarker=function(e){this._marker||this._createMarker(e),Z.isBoolean(e)?this._marker.visible=e:this._marker.setParams(e)},r.prototype.getRoomFromLocalPosition=function(e){return this.getRoomFromWorldPosition(this.selfToWorld(e))},r.prototype.getRoomFromWorldPosition=function(e){for(var t=this.rooms,r=0;r<t.length;r++){var i=t[r];if(i.getRayCastPosition(e))return i}return null},r.prototype.bake=function(e){var t=this.plan;if(t)if(null===e){var r=function(e){var t=e.material;t&&(t.aoMap=null,e.material.needsUpdate=!0)};t.node.traverseAll(function(e){r(e)}),this.rooms.forEach(function(e){var t=e.plan;t&&t.node.traverseAll(function(e){r(e)})})}else{e=e||{};var i=Z.parseValue(e.intensity,1.4);this._groundAOBaker||(this._groundAOBaker=new kt);var n=new THREE.Matrix4;n.getInverse(this.node.matrixWorld);var o=(new THREE.Box3).setFromObjectInLocalSpace(this.node,n);this._groundAOBaker.bake(this.app.renderer,this.wallNode,o,this.node.matrixWorld);var a=this,s=function(e){if(e.material){e.material=e.material.clone();var t=e.material;t&&(t.aoMap=a._groundAOBaker.ao,t.aoMapIntensity=i,t.needsUpdate=!0)}};t.node.traverseAll(function(e){s(e)}),this.rooms.forEach(function(e){var t=e.plan;t&&t.node.traverseAll(function(e){s(e)})})}},r.prototype.canNavigation=function(){return!0},r.prototype._getLinkableObjects=function(){var e=this.rooms;return e.concat(c.prototype._getLinkableObjects.call(this))},r.prototype._getLinkableDoors=function(){var e=this.elevatorDoors;return(e=e.concat(this.stairDoors)).concat(c.prototype._getLinkableDoors.call(this))},r.prototype._setupNavigationGraph=function(e,t){c.prototype._setupNavigationGraph.call(this,e,t);for(var r=this._getLinkableObjects(),i=0;i<r.length;i++)for(var n=r[i],o=n._getLinkableDoors(),a=0;a<o.length;a++)e[(s=o[a]).id]=e[s.id]||{},e[n.id]=e[n.id]||{},e[n.id][s.id]=e[s.id][n.id]=t;for(e[this.id]=e[this.id]||{},o=this._getLinkableDoors(),i=0;i<o.length;i++){var s,l=(s=o[i]).owner;l&&(e[s.id]=e[s.id]||{},e[l.id]=e[l.id]||{},e[this.id][s.id]=e[s.id][this.id]=t,e[l.id][s.id]=e[s.id][l.id]=t)}},r.prototype.onBeforeCapture=function(){var e=this.plan;if(e){var r=function(e){var t=e.material;t&&(Z.backupValue(t,"aoMap"),t.aoMap=null,t.needsUpdate=!0)};e.node.traverseAll(function(e){r(e)}),this.rooms.forEach(function(e){var t=e.plan;t&&t.node.traverseAll(function(e){r(e)})})}},r.prototype.onAfterCapture=function(){var e=this.plan;if(e){var r=function(e){var t=e.material;t&&(Z.revertValue(t,"aoMap"),t.needsUpdate=!0)};e.node.traverseAll(function(e){r(e)}),this.rooms.forEach(function(e){var t=e.plan;t&&t.node.traverseAll(function(e){r(e)})})}},r.prototype.showThings=function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];console.warn("[Floor] Please use '.things.visible=true/false' to replace '.showThings'"),this.things.visible=e},r.prototype.showDoors=function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];console.warn("[Floor] Please use '.things.visible=true/false' to replace '.showThings'"),this.doors.visible=e},r.prototype.hideMarker=function(){console.warn("[Floor] Please use '.showMarker(false)' to replace '.hideMarker'"),this.showMarker(!1)},r.prototype.setMarker=function(e){console.warn("[Floor] Please use '.showMarker(params)' to replace '.setMarker'"),this.showMarker(e)},r.prototype.showRoof=function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];console.warn("[Floor] Please use '.showAllRoofs()' to replace '.showRoof()'"),this.showAllRoofs(e)},r.prototype.showCeiling=function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];console.warn("[Floor] Please use '.showAllCeilings()' to replace '.showCeiling()'"),this.showAllCeilings(e)},l(r,[{key:"isFloor",get:function(){return!0}},{key:"isOutdoors",get:function(){var e=this.building;return!(!e||e.hasFacades())}},{key:"building",get:function(){return this.parents.query(".Building")[0]}},{key:"indexOfBuilding",get:function(){return this.indexOfParent(!0)}},{key:"levelNumber",get:function(){return this.indexOfParent(!0)+1}},{key:"things",get:function(){return this.query(".Thing",!1)}},{key:"doors",get:function(){return this.query(".Door",!1)}},{key:"elevatorDoors",get:function(){return this.doors.query(".ElevatorDoor",!1)}},{key:"stairDoors",get:function(){return this.doors.query(".StairDoor",!1)}},{key:"stairs",get:function(){return this.query(".Stair",!1)}},{key:"rooms",get:function(){return this.query(".Room",!1)}},{key:"misc",get:function(){return this.miscObject=this.miscObject||new Ee(this.app)._init(this.miscNode,this),this.miscObject}},{key:"plan",get:function(){return this.floorObject=this.floorObject||new Ee(this.app)._init(this.floorNode,this),this.floorObject}},{key:"wall",get:function(){return this.wallObject=this.wallObject||new Ee(this.app)._init(this.wallNode,this),this.wallObject}},{key:"roof",get:function(){return this.roofObject=this.roofObject||new Ee(this.app)._init(this.roofNode,this),this.roofObject}},{key:"ceiling",get:function(){return this.ceilingObject=this.ceilingObject||new Ee(this.app)._init(this.ceilingNode,this),this.ceilingObject}},{key:"marker",get:function(){return this._marker}},{key:"height",get:function(){return this._height}},{key:"isFloorPlan",get:function(){return console.warn("[Floor] Please use '.isFloor' to replace '.isFloorPlan'"),!0}},{key:"levelNum",get:function(){return console.warn("[Floor] Please use '.levelNumber' to replace '.levelNum'"),this.levelNumber}}]),r}(Ee),jt=function(r){function i(e){y(this,i);var t=p(this,r.call(this,e));return t.name="Outdoors",t._floorNode=null,t}return u(i,r),i.prototype.destroy=function(){this._floorNode=null,r.prototype.destroy.call(this)},i.prototype.setup=function(e){this.setupID(e),this.setupParent(e),(this.parent.outdoors=this).setupUserData()},i.prototype.setPolygonOffset=function(e){var t=this._floorNode;t&&new Ee(this.app)._init(t).style.setPolygonOffset(e)},l(i,[{key:"floorNode",set:function(e){this._floorNode=e},get:function(){return this._floorNode}},{key:"canNotQueryFromSelector",get:function(){return!0}},{key:"isOutdoors",get:function(){return console.warn("[Outdoors] Please do not use 'outdoors.isOutdoors', we will delete is soon in the future"),!0}}]),i}(It),Nt=function(){function t(e){y(this,t),this.app=e,this._style=null,this._id="",this._name="",this._queryID=THING.Math.generateUUID(),this._userData={},this._angles=[0,0,0],this._events={},this._tags=[],this._groups=[],this._children=new ye(this.app)}return t.prototype.isGroup=function(){return!0},t.prototype.setup=function(e){this._id=e.id||"",this._name=e.name||"",this._tags=e.tags||[]},t.prototype.destroy=function(){this.app.objectManager.destroy(this);var o=this;this._children.forEach(function(e){var t=e.groups.indexOf(o);for(var r in-1!==t&&e.groups.splice(t,1),o._events){var i=o._events[r];for(var n in i)e.off(n)}})},t.prototype.destroyAll=function(){this.destroy(),this._children.destroyAll()},t.prototype.hasAttribute=function(e){return Z.hasAttribute(this,e)},t.prototype.getAttribute=function(e){return Z.getAttribute(this,e)},t.prototype.setAttribute=function(e,t){return Z.setAttribute(this,e,t)},t.prototype.setAttributes=function(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];for(var r in e=e||{})(t||Z.isUndefined(this[r]))&&this.setAttribute(r,e[r])},t.prototype.add=function(e){var t=this;if(e instanceof ye)e.forEach(function(e){t.add(e)});else for(var r in this._children.add(e),-1===e.groups.indexOf(this)&&e.groups.push(this),this._children.forEach(function(e){e.groups.sort(function(e,t){return t.children.length-e.children.length})}),this._events){var i=this._events[r];for(var n in i){var o=i[n];this.on(r,o.selector,o.userData,o.callback,null,o.priority)}}},t.prototype.remove=function(e){var t=this;if(e instanceof ye)e.forEach(function(e){t.remove(e)});else{this._children.remove(e);var r=e.groups.indexOf(this);for(var i in-1!==r&&e.groups.splice(r,1),this._events){var n=this._events[i];for(var o in n){var a=n[o];this.off(i,a.selector,a.tag)}}}},t.prototype._transform=function(e){var t=new THREE.Group;t.position.copy(Z.parseVector3(this.position)),this.app.scene.add(t),t.updateMatrixWorld();for(var r=[],i=0;i<this._children.length;i++){var n=this._children[i];r.push(n.node.parent),n.node.attach(t,this.app.scene)}for(e(t),t.updateWorldMatrix(!1,!1),i=0;i<this._children.length;i++)(n=this._children[i]).node.attach(r[i],this.app.scene),n.static&&n.node._synMatrixWorld();this.app.scene.remove(t)},t.prototype.translate=function(t){this._transform(function(e){e.translateX(t[0]),e.translateY(t[1]),e.translateZ(t[2])})},t.prototype.translateX=function(e){this.translate([e,0,0])},t.prototype.translateY=function(e){this.translate([0,e,0])},t.prototype.translateZ=function(e){this.translate([0,0,e])},t.prototype.query=function(t){var e=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],r=new ye(this.app,this._children);return r.select(t),e&&this._children.forEach(function(e){r.add(e.query(t))}),r},t.prototype._parseEvent=function(e,t,r,i,n){var o=Z.parseEvent(e,t,r,i,n);o._callback=o.callback;var a=this;return o.callback=function(e){o._callback&&o._callback.call(a,e)},o.tag=o.tag||"",o.tag+="_"+this._queryID,o},t.prototype._updateEvents=function(e){this._events[e.eventType]=this._events[e.eventType]||[],this._events[e.eventType][e.tag]=e},t.prototype._removeEvents=function(e){var t=this._events[e.eventType];t&&delete t[e.tag]},t.prototype.on=function(e,t,r,i,n,o){var a=this._parseEvent(t,r,i,n,o);return a.eventType=e,this._updateEvents(a),this.children.on(e,a.selector,a.userData,a.callback,a.tag,a.priority),this},t.prototype.off=function(e,t,r){var i=this._parseEvent(t,null,r);return i.eventType=e,this._removeEvents(i),this.children.off(e,i.selector,i.tag),this},t.prototype.one=function(e,t,r,i,n,o){var a=this._parseEvent(t,r,i,n,o);return a.eventType=e,this._updateEvents(a),this.children.one(e,a.selector,a.userData,a.callback,a.tag,a.priority),this},t.prototype._getAvgVector3=function(r){if(!this._children.length)return[0,0,0];var i=new THREE.Vector3;return this._children.forEach(function(e){var t=Z.parseVector3(e[r]);i.add(t)}),i.divideScalar(this._children.length),i.toArray()},l(t,[{key:"type",get:function(){return"Group"}},{key:"style",get:function(){return this._children.style}},{key:"id",set:function(e){this._id=e},get:function(){return this._id}},{key:"name",set:function(e){this._name=e},get:function(){return this._name}},{key:"queryID",set:function(e){this._queryID=e},get:function(){return this._queryID}},{key:"userData",set:function(e){this._userData=e},get:function(){return this._userData}},{key:"tags",set:function(e){this._tags=e},get:function(){return this._tags}},{key:"groups",get:function(){return this._groups}},{key:"position",set:function(e){var t=Z.parseVector3(e),r=this;this._transform(function(e){e._setWorldPosition(t,!1,r.app.root.static)})},get:function(){return this._getAvgVector3("position")}},{key:"angles",set:function(e){var t=THING.Math.subVector(this._angles,e);this._angles=e;var r=Z.parseEuler(t);this._transform(function(e){e.quaternion.setFromEuler(r)})},get:function(){return this._angles}},{key:"parents",get:function(){var t=new THING.Selector(this.app,[]);return this._children.forEach(function(e){t.add(e.parents)}),t}},{key:"children",get:function(){return this._children}},{key:"visible",set:function(e){this.children.visible=e}},{key:"pickable",set:function(e){this.children.pickable=e}},{key:"boundingBox",get:function(){for(var e=new THREE.Box3,t=0;t<this.children.length;t++){var r=this.children[t];e.union(r.box)}var i=new THREE.Vector3;e.getCenter(i);var a=new THREE.Vector3;e.getSize(a);var s=this;return{min:e.min.toArray(),max:e.max.toArray(),center:i.toArray(),size:a.toArray(),radius:a.length(),getOffsetWorldPosition:function(e){var t=Z.parseValue(e.yAngle,0),r=Z.parseValue(e.xAngle,0),i=Z.parseValue(e.distance||e.radius,a.length()),n=e.radiusFactor;n&&(i=a.length()*n);var o=(new THREE.Vector3).getDirectionFromAngles(t,r,i);return o.add(Z.parseVector3(s.position)),o.toArray()}}}}]),t}(),Dt=function e(t,r,i,n){y(this,e),this.positionArray=t.geometry.getAttribute("position").array.slice();var o=t.geometry.getAttribute("normal");o?this.normalArray=o.array.slice():console.warn("not has normal");var a=t.geometry.getAttribute("uv");a&&(this.uvArray=a.array);var s=t.geometry.getAttribute("uv2");s&&(this.uv2Array=s.array);var l=t.geometry.getAttribute("color");l&&(this.colorArray=l.array),this.indexArray=t.geometry.index.array,this.material=t.material;for(var c=this.positionArray,u=this.normalArray,h=0;h<c.length;){for(var p=n.length-1;-1<p;p--){var d=r[p],f=i[p],m=n[p];c[h]*=d.x,c[h+1]*=d.y,c[h+2]*=d.z;var g=new THREE.Vector3(c[h],c[h+1],c[h+2]);if((g=g.applyQuaternion(f)).x+=m.x,g.y+=m.y,g.z+=m.z,c[h]=g.x,c[h+1]=g.y,c[h+2]=g.z,u){var v=new THREE.Vector3(u[h],u[h+1],u[h+2]);v=v.applyQuaternion(f),u[h]=v.x,u[h+1]=v.y,u[h+2]=v.z}}h+=3}this.vertexCount=this.positionArray.length/3,this.indexCount=this.indexArray.length},Ut=function(){function t(e){y(this,t),this.bundeObj=e,this.materialMap=new Map,this.combineBundleMeshs=[]}return t.prototype.combine=function(){this._combine(this.bundeObj,[],[],[])},t.prototype._combine=function(e,t,r,i){if(t.push(e.scale),i.push(e.position),r.push(e.quaternion),e instanceof THREE.Mesh){var n=new Dt(e,t,r,i);0!==n.vertexCount&&(this.combineBundleMeshs.push(n),void 0===this.materialMap.get(n.material)&&this.materialMap.set(n.material,[]),this.materialMap.get(n.material).push(n))}if(0!==e.children.length)for(var o=0;o<e.children.length;o++){var a=r.slice(),s=t.slice(),l=i.slice();this._combine(e.children[o],s,a,l)}},t}(),Vt=function e(){y(this,e),this.positions=[],this.scales=[],this.quaternions=[]},Bt=function(){function t(e){y(this,t),this.vertexCount=0,this.indexCount=0,this.material=e,this.bundeMeshs=[],this.transformations=[],this.maxCount=65534,this.combineMesh=null}return t.prototype.isExceed=function(e){return this.vertexCount+e>this.maxCount},t.prototype.add=function(e,t){if(this.isExceed(e.vertexCount))return console.error("combine exceed vertex count "),!1;this.vertexCount+=e.vertexCount,this.indexCount+=e.indexCount,this.bundeMeshs.push(e),this.transformations.push(t)},t.prototype.build=function(){for(var e=this.bundeMeshs,t=this.indexCount,r=this.vertexCount,i=new Float32Array(3*r),n=new Float32Array(3*r),o=new Float32Array(2*r),a=new Float32Array(4*r),s=new Float32Array(2*r),l=new Uint16Array(t),c=0,u=0,h=0,p=0,d=0,f=new THREE.BufferGeometry,m=0;m<e.length;m++){for(var g=e[m],v=this.transformations[m],y=v.positions,b=v.scales,x=v.quaternions,E=g.indexArray,_=0;_<E.length;_++)l[_+p]=c/3+E[_];p+=E.length;var w=g.positionArray;for(_=0;_<w.length;){for(var T=new THREE.Vector3(w[_],w[_+1],w[_+2]),M=y.length-1;-1<M;M--){var S=y[M],R=b[M],P=x[M];T.x*=R.x,T.y*=R.y,T.z*=R.z,(T=T.applyQuaternion(P)).x+=S.x,T.y+=S.y,T.z+=S.z}i[_+c]=T.x,i[_+c+1]=T.y,i[_+c+2]=T.z,_+=3}c+=w.length;var A=g.normalArray;for(_=0;_<A.length;){var C=new THREE.Vector3(A[_],A[_+1],A[_+2]);for(M=x.length-1;-1<M;M--)P=x[M],C=C.applyQuaternion(P);n[_+u]=C.x,n[_+u+1]=C.y,n[_+u+2]=C.z,_+=3}u+=A.length;var L=g.uvArray;if(L)for(_=0;_<L.length;_++)o[_+h]=L[_];var O=g.uv2Array;if(O)for(_=0;_<O.length;_++)s[_+h]=O[_];L&&(h+=L.length);var H=g.colorArray;if(H){for(_=0;_<H.length;_++)a[_+d]=H[_];d+=H.length}}f.addAttribute("position",new THREE.BufferAttribute(i,3)),f.addAttribute("normal",new THREE.BufferAttribute(n,3)),f.addAttribute("uv",new THREE.BufferAttribute(o,2)),0!==s.length&&f.addAttribute("uv2",new THREE.BufferAttribute(s,2)),0!==a.length&&f.addAttribute("color",new THREE.BufferAttribute(a,4)),f.setIndex(new THREE.BufferAttribute(l,1));var F=new THREE.Mesh(f,this.material);this.material.defines&&this.material.defines.USE_ALPHAINDEX&&delete this.material.defines.USE_ALPHAINDEX,F.name="combine",this.combineMesh=F},t}(),zt=function(){function t(e){y(this,t),this.app=e,this.combineBundleObjectMap={},this.processorMap=new Map,this.floorMaterialMap=new Map,this.processors=[]}return t.prototype.combineModels=function(){var n=this.app.modelResource.models,e=[],o=this;for(var a in n)e.push(new Promise(function(e,t){var r=performance.now(),i=new Ut(n[a].node);(o.combineBundleObjectMap[a]=i).combine(),.1<performance.now()-r?setTimeout(function(){e()},10):e()}));return Promise.all(e)},t.prototype.getModelObject=function(e){return this.combineBundleObjectMap[e]||null},t.prototype.addPlacement=function(e,t,r,i,n){var l=this.floorMaterialMap.get(e);l||(l=new Map,this.floorMaterialMap.set(e,l));var c=this.processorMap.get(e);c||(this.processorMap.set(e,[]),c=this.processorMap.get(e));var u=new Vt;u.positions=r,u.scales=i,u.quaternions=n,this.combineBundleObjectMap[t].materialMap.forEach(function(e,t,r){for(var i=e,n=t,o=0;o<i.length;o++){var a=i[o],s=l.get(n);s&&!s.isExceed(a.vertexCount)||(s=new Bt(n),l.set(n,s),c.push(s)),s.add(a,u)}})},t.prototype.getCombineProcessors=function(e,t,r,i){var l=[],c=new Map;for(var n in e){var o=e[n];if(!o.uid&&!o.name){var a=this.app.modelResource.bundleIDArray[o.bIdx],s=(this.app.modelResource.get(a).node,new THREE.Vector3(0,0,0)),u=new Vt;if(o.pos){var h=o.pos.split(" ");s.x=parseFloat(h[0]),s.y=parseFloat(h[1]),s.z=-parseFloat(h[2])}var p=new THREE.Vector3(1,1,1);if(o.scl){var d=o.scl.split(" ");p.x=parseFloat(d[0]),p.y=parseFloat(d[1]),p.z=parseFloat(d[2])}var f=new THREE.Quaternion(0,0,0,1);if(o.rot){var m=o.rot.split(" ");f.x=parseFloat(m[0]),f.y=parseFloat(m[1]),f.z=-parseFloat(m[2]),f.w=-parseFloat(m[3])}var g=t.slice(),v=r.slice(),y=i.slice();y.push(f),v.push(p),g.push(s),u.positions=g,u.scales=v,u.quaternions=y,this.combineBundleObjectMap[a].materialMap.forEach(function(e,t,r){for(var i=e,n=t,o=0;o<i.length;o++){var a=i[o],s=c.get(n);s&&!s.isExceed(a.vertexCount)||(s=new Bt(n),c.set(n,s),l.push(s)),s.add(a,u)}})}}return l},t}(),qt=function(){function r(e,t){y(this,r),this.app=e,this.nodes=[],this.scene=this.app.scene,this.outdoors=this.app.outdoors,this.objectPool=this.app.objectPool,this.worldNode=new THREE.Object3D,this.campus=null,this.baseURL=null,this.curLoadGLTFIndex=0,this.splitLoadedGLTFCount=0,this.allLoadedGLTFCount=0,this.sliceRootNodeArray=[],this.sceneJsonData=null,this.states=null,this.combineManager=new zt(this.app),this.loadSpeed=.1,this.isCamFitScene=!0,t&&(t.position&&(this.campusPosition=t.position),t.rotation&&(this.campusRotation=t.rotation),void 0!==t.isCamFitScene&&null!==t.isCamFitScene&&(this.isCamFitScene=t.isCamFitScene),void 0!==t.isDelayLoadFloorPlan&&null!==t.isDelayLoadFloorPlan&&(this.isDelayLoadFloorPlan=t.isDelayLoadFloorPlan),t.campus&&(this.campus=t.campus))}return r.prototype.load=function(e){var i=this;return this.baseURL=e,this.scene.add(this.worldNode),new Promise(function(t,r){i.loadSceneJson().then(function(e){i.parseObjects().then(function(){t(i.campus)})}).then(function(){t(i.campus)}).catch(function(e){r(e)})})},r.prototype.loadSceneJson=function(){var i=this;return new Promise(function(r,t){new THREE.FileLoader(i.app.loadingManager).load(i.baseURL+"/scene.json",function(e){var t=JSON.parse(e);i.sceneJsonData=t,r(t)},function(e){},function(e){t("cant not load file: scene.json")})})},r.prototype.parseObjects=function(){var r=this.sceneJsonData,i=this;return new Promise(function(e,t){i.parse(r).then(function(){i.sliceRootNodeArray=[],e()}).catch(function(e){t(e)})})},r.prototype.parse=function(r){var i=this;return new Promise(function(e,t){i.parseWorld(r),e()})},r.prototype.parseWorld=function(e){var t=this.worldNode;if(null==this.campus&&(this.campus=this.app.objectManager.create({type:"Campus",name:"Campus",node:t}),this.app.scene.add(this.campus.node)),this.campusRotation&&this.campus.node.quaternion.set(this.campusRotation.x,this.campusRotation.y,this.campusRotation.z,this.campusRotation.w),this.campusPosition&&(this.campus.position=this.campusPosition),e.outdoors&&this.parseOutdoors(e.outdoors,t),e.buildings){var r=e.buildings;for(var i in r){var n=r[i],o=new THREE.Vector3(0,0,0),a=i,s=void 0;n.name&&(a=n.name),n.id&&(s=n.id);var l=new THREE.Object3D,c=this.app.objectManager.create({type:"Building",name:a,id:s,parent:this.campus,node:l});if(c.app=this.app,c.node.position.x=o.x,c.node.position.y=o.y,c.node.position.z=o.z,n.plans&&this.parseFloorPlans(n.plans,c),n.facades){var u=n.facades;for(var h in u)this.createThing(u[h],c,"Facade")}if(n.facadegroups){var p=n.facadegroups;for(var d in p)n=p[d],this.createGroup(n,c,"Facade")}if(n.groups)for(var d in p=n.groups)n=p[d],this.createGroup(n,c)}}},r.prototype.parseOutdoors=function(e){var t=new THREE.Object3D;this.outdoors=this.app.objectManager.create({type:"Outdoors",name:"Outdoors",parent:this.campus,node:t}),this.app.outdoors||(this.app.outdoors=this.outdoors,this.app.currentParentObject=this.outdoors),this.processFloorPlanData(e,this.outdoors)},r.prototype.processFloorPlanData=function(e,t){t.app=this.app,e.placements&&this.parseThings(e.placements,t),e.videoprobes&&this.parseThings(e.videoprobes,t),e.groups&&this.parseGroups(e.groups,t),e.doororwindows&&this.parseDoorWins(e.doororwindows,t),e.rooms&&this.parseRooms(e.rooms,t)},r.prototype.parseRooms=function(e,t){for(var r=0;r<e.length;r++){var i=e[r],n=null;i.name&&(n=i.name);var o=new THREE.Object3D("room_temp"),a=null,s=i.properties;if(s)for(var l in a={},s){var c=s[l];a[l]=c}var u=null,h=null,p=null,d={};if(i.area&&(h=i.area,d.area=h),i.circumference&&(p=i.circumference,d.circumference=p),i.center){var f=i.center;(u=new THREE.Vector3).set(f[0],f[1],-f[2]),d.center=u}this.app.objectManager.create({type:"Room",name:n,node:o,id:void 0,parent:t,properties:a,auxiliaryInfo:d})}},r.prototype.parseDoorWins=function(e,t){for(var r in new THREE.Group("doors"),e){var i=e[r],n=r,o=void 0;i.name&&(n=i.name),i.id&&(o=i.id);var a=new THREE.Object3D("doororwin_temp"),s=null;if(i.properties){var l=i.properties;for(var c in s={},l){var u=l[c];s[c]=u}}this.app.objectManager.create({type:"Door",name:n,node:a,id:o,parent:t,properties:s})}},r.prototype.parseGroups=function(e,t){for(var r in e){var i=e[r];(i.name||i.properties)&&this.createGroup(i,t)}},r.prototype.createGroup=function(e,t){var r,i,n,o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"Thing",a=new THREE.Object3D("group_temp");e.id&&(r=e.id),e.name&&(i=e.name);var s=e.properties;if(s)for(var l in n={},s){var c=s[l];n[l]=c}return this.app.objectManager.create({type:o,name:i,id:r,node:a,parent:t,properties:n})},r.prototype.parseFloorPlans=function(e,t){var r=[];for(var i in e){var n=e[i],o=n.id,a="";n.name&&(a=n.name);var s=new THREE.Object3D,l=this.app.objectManager.create({type:"Floor",name:a,id:o,node:s,parent:t});s.name="floorPlan",t.node.add(l.node),this.processFloorPlanData(n,l),r.push(l)}return r},r.prototype.parseThings=function(e,t,r){for(var i in e){var n=e[i];(n.name||n.properties)&&this.createThing(n,t,r)}},r.prototype.createThing=function(e,t,r){var i,n,o,a=3<arguments.length&&void 0!==arguments[3]?arguments[3]:"Thing";e.id&&(i=e.id),e.name&&(n=e.name);var s=e.properties;if(s)for(var l in o={},s){var c=s[l];o[l]=c}var u=new THREE.Object3D("temp_cannotuse");return this.app.objectManager.create({type:a,name:n,node:u,id:i,parent:t,properties:o})},r}(),Gt=function(){function i(e,t){if(y(this,i),this.app=e,this.resourceUrl=null,this.relativeResourceUrl=null,this.sceneJson=null,this.scale=1,this.curFloorPlan=null,this.tempTexture=null,this.indexJson=t,this.sceneJsonUri="scene.json",this.defaultWallTextureUri="Textures/RoomWall.jpg",this.defaultWallEdgeTextureUri="Textures/WallEdge.jpg",this.defaultFloorTextureUri="Textures/FloorDefault.jpg",this.defaultCeilingTextureUri="Textures/CeilingDefault.jpg",this.defaultRoofTextureUri="Textures/RoofDefault.jpg",this.defaultWallTexture=null,this.defaultCeilingTexture=null,this.defaultFloorTexture=null,this.defaultRoofTexture=null,this.defaultWallEdgeTexture=null,this.worldNode=new THREE.Object3D("world"),this.isCamFitScene=!0,this.campus=null,this.outdoorsVisible=!0,this.campusVisible=!0,this.enableUseHighestVersionResource=!0,this.worldNode,t&&(t.position&&(this.campusPosition=t.position),t.rotation&&(this.campusRotation=t.rotation),void 0!==t.isCamFitScene&&null!==t.isCamFitScene&&(this.isCamFitScene=t.isCamFitScene),t.scale&&(this.campusScale=t.scale),void 0!==t.outdoorsVisible&&(this.outdoorsVisible=t.outdoorsVisible),void 0!==t.campusVisible&&(this.campusVisible=t.campusVisible),t.campus&&(this.campus=t.campus),void 0!==t.enableUseHighestVersionResource&&(this.enableUseHighestVersionResource=t.enableUseHighestVersionResource,json2mesh.DefaultSetting.enableUseHighestVersionResource=this.enableUseHighestVersionResource)),this.campus&&(this.campusRotation&&this.campus.node.quaternion.set(this.campusRotation.x,this.campusRotation.y,this.campusRotation.z,this.campusRotation.w),this.campusPosition&&(this.campus.position=this.campusPosition),this.campusScale&&(this.campus.scale=this.campusScale)),t&&t.default){var r=t.default;r.sceneJson&&(this.sceneJson="export.json"),r.wallTexture&&(this.defaultWallTextureUri=r.wallTexture),r.wallEdgeTexture&&(this.defaultWallEdgeTextureUri=r.wallEdgeTexture),r.floorTexture&&(this.defaultFloorTextureUri=r.floorTexture),r.ceilingTexture&&(this.defaultCeilingTextureUri=r.ceilingTexture),r.roofTexture&&(this.defaultRoofTextureUri=r.roofTexture)}this.app.options.loaderResourceUrl&&(this.resourceUrl=this.app.options.loaderResourceUrl),null!=this.app.options.enableUseHighestVersionResource&&(this.enableUseHighestVersionResource=this.app.options.enableUseHighestVersionResource,json2mesh.DefaultSetting.enableUseHighestVersionResource=this.enableUseHighestVersionResource),this.app.options.resourceLibraryUrl&&(this.resourceUrl=this.app.options.resourceLibraryUrl),this.indexJson&&this.indexJson.resourceLibrary&&(this.relativeResourceUrl=this.indexJson.resourceLibrary)}return i.prototype.parseCamInfo=function(e){var t=e.eye,r=e.target,i=t.split(" "),n=r.split(" "),o=[Number(i[0]),Number(i[1]),Number(i[2])];o[2]=-o[2];var a=[Number(n[0]),Number(n[1]),Number(n[2])];a[2]=-a[2],this.app.camera.position=o,this.app.camera.target=a},i.prototype.exportJsonString=function(e){for(var t=e.outdoors,r=e.buildings,i=[],n=[],o=0;o<t.things.length;o++){var a=t.things[o];i.push({id:a.id,name:a.name})}for(o=0;o<t.rooms.length;o++){var s=t.rooms[o];n.push({id:s.id,name:s.name})}var l=[];for(o=0;o<r.length;o++){for(var c=r[o],u=[],h=0;h<c.floors.length;h++){for(var p=c.floors[h],d=[],f=[],m=0;m<p.things.length;m++){var g=p.things[m];d.push({id:g.id,name:g.name})}for(m=0;m<p.rooms.length;m++)s=p.rooms[m],f.push({id:s.id,name:s.name});u.push({id:p.id,name:p.name,placements:d,rooms:f})}l.push({id:c.id,name:c.name,plans:u})}return{id:e.id,name:e.name,outdoors:{id:t.id,name:t.name,placements:i,rooms:n},buildings:l}},i.prototype.load=function(e){var i=this;return this.sceneURL=e,this.relativeResourceUrl&&(this.resourceUrl=this.sceneURL+this.relativeResourceUrl),new Promise(function(r,e){i.updateProgress(.1),i.loadSceneJson().then(function(e){i.sceneJson=JSON.parse(e),i.sceneJson.camInfo&&i.isCamFitScene&&i.parseCamInfo(i.sceneJson.camInfo),i.updateProgress(.15);var t=new json2mesh.UBuilderSceneSimpleLoader;i.resourceUrl&&(t.resourceManager.baseTextureUrl=i.resourceUrl+"/texture/",t.resourceManager.baseModelUrl=i.resourceUrl+"/model/"),t.load({json:i.sceneJson,customModeBaseUrl:i.sceneURL+"/"}).then(function(e){i.parseWorld(e),i.updateProgress(.2),i.updateProgress(1),r(i.campus)})})})},i.prototype.loadSceneJson=function(){var r=this;return new Promise(function(t,e){new THREE.FileLoader(r.app.loadingManager).load(r.sceneURL+"/"+r.sceneJsonUri,function(e){t(e)})})},i.prototype.updateProgress=function(e){this.app.mainUI.updateLoadingProcess(e)},i.prototype.createTextureLoaderPromise=function(r){var i=this;return new Promise(function(t,e){(new THREE.TextureLoader).load(i.sceneURL+"/"+r,function(e){t(e)},function(e){console.log(r+" "+e.loaded/e.total*100+"% loaded")},function(e){console.log(r+"load error")})})},i.prototype.loadDefaultTexture=function(){var s=this;return new Promise(function(t,e){var r=s.createTextureLoaderPromise(s.defaultWallTextureUri),i=s.createTextureLoaderPromise(s.defaultWallEdgeTextureUri),n=s.createTextureLoaderPromise(s.defaultFloorTextureUri),o=s.createTextureLoaderPromise(s.defaultRoofTextureUri),a=s.createTextureLoaderPromise(s.defaultCeilingTextureUri);Promise.all([r,i,n,o,a]).then(function(e){DefaultResource.wallTexture=e[0],DefaultResource.wallEdgeTexture=e[1],DefaultResource.floorTexture=e[2],DefaultResource.ceilinngTexture=e[3],DefaultResource.roofTexture=e[4],t()})})},i.prototype.parseWorld=function(e){null===this.campus&&(this.campus=this.app.objectManager.create({uuid:e.id,id:e.userID,type:"Campus",name:"Campus",node:this.worldNode}),this.campus.visible=this.campusVisible,this.campusRotation&&this.campus.node.quaternion.set(this.campusRotation.x,this.campusRotation.y,this.campusRotation.z,this.campusRotation.w),this.campusPosition&&(this.campus.position=this.campusPosition),this.campusScale&&(this.campus.scale=this.campusScale));for(var t=0;t<e.buildings.length;t++){var r=e.buildings[t];this.parseBuilding(r)}if(e.outdoors){var i=new THREE.Object3D("outdoors");i.name="plan",this.outdoors=this.app.objectManager.create({uuid:e.outdoors.id,id:e.outdoors.userID,type:"Outdoors",name:e.outdoors.name,parent:this.campus,node:i}),this.outdoors.visible=this.outdoorsVisible,this.parseFloorPlan(e.outdoors,this.outdoors)}},i.prototype.parseBuilding=function(e){var t=new THREE.Object3D("building");t.name="building";var r=this.app.objectManager.create({uuid:e.id,id:e.userID,type:"Building",name:e.name,parent:this.campus,node:t,properties:e.properties});r.localPosition=e.position;for(var i=e.floorplans,n=e.facades,o=e.facadeGroups,a=0;a<n.length;a++){var s=n[a];this.app.objectManager.create({type:"Facade",id:s.userID,name:s.name,uuid:s.id,node:s.delayObject,parent:r,properties:s.properties})}for(a=0;a<o.length;a++)s=o[a],this.app.objectManager.create({type:"Facade",uuid:s.id,id:s.userID,name:s.name,node:s.delayObject,parent:r,properties:s.properties});for(var l=0;l<i.length;l++){var c=i[l],u=new THREE.Object3D("floorplan");u.name="plan";var h=this.app.objectManager.create({id:c.userID,uuid:c.id,type:"Floor",name:c.name,node:u,parent:r});h.localPosition=c.position,this.parseFloorPlan(c,h),0!==r.facades.length&&(h.node.visible=!1)}},i.prototype.placementInitCallback=function(e){this.app.objectManager.create({id:e.id,name:e.name,node:e.mesh,parent:plan,animations:e.resource.animations,properties:e.properties})},i.prototype.parseOutdoors=function(e){},i.prototype.parseFloorPlan=function(e,n){for(var t=0;t<e.walls.length;t++)for(var r=e.walls[t],i=0;i<r.doorOrWindows.length;i++){var o=r.doorOrWindows[i],a="Door";if(o.jsonData&&o.jsonData.type&&(a=o.jsonData.type),o.mesh){var s=this.app.objectManager.create({type:"Door",uuid:o.id,id:o.userID,name:o.name,node:o.delayObject,parent:n,animations:o.resource.animations,properties:o.properties});if(o.isOpen&&s.open(),s.animationClips)for(i=0;i<s.animationClips.length;i++){var l=s.animationClips[i];if("_defaultAnim_"===l.name){s.playAnimation({name:l.name,loop:!0,speed:.15});break}}}else o.initCompleteCallback=function(e){e.jsonData&&e.jsonData.type&&e.jsonData.type;var t=b.app.objectManager.create({type:"Door",uuid:e.id,id:e.userID,name:e.name,node:e.mesh,parent:n,animations:e.resource.animations,properties:e.properties});if(n.miscNode.add(t.node),e.isOpen&&t.open(),t.animationClips)for(var r=0;r<t.animationClips.length;r++){var i=t.animationClips[r];if("_defaultAnim_"===i.name){t.playAnimation({name:i.name,loop:!0,speed:.15});break}}}}var c=new THREE.Object3D("combineFloor");for(t=0;t<e.combineFloors.length;t++){var u=e.combineFloors[t];c.add(u)}n.node.add(c),n.floorNode=c;var h=new THREE.Object3D("combineCeiling");for(t=0;t<e.combineCeilings.length;t++){var p=e.combineCeilings[t];h.add(p)}n.node.add(h),n.ceilingNode=h;var d=new THREE.Object3D("combineRoof");for(t=0;t<e.combineRoofs.length;t++){var f=e.combineRoofs[t];d.add(f)}n.node.add(d),n.roofNode=d;var m=new THREE.Object3D("combinePlacement");for(t=0;t<e.combinePlacements.length;t++){var g=e.combinePlacements[t];m.add(g)}n.node.add(m),n.miscNode=m;for(var v=new THREE.Object3D("combineWall"),y=0;y<e.combineStraightManualWalls.length;y++)r=e.combineStraightManualWalls[y],v.add(r);for(y=0;y<e.combineModelWalls.length;y++)r=e.combineModelWalls[y],v.add(r);for(y=0;y<e.combineDoorOrWins.length;y++)g=e.combineDoorOrWins[y],v.add(g);for(n.node.add(v),n.wallNode=v,t=0;t<e.groups.length;t++)g=e.groups[t],a="Thing",g.jsonData&&g.jsonData.type&&(a=g.jsonData.type),s=this.app.objectManager.create({uuid:g.id,id:g.userID,name:g.name,node:g.delayObject,belongRoomUserID:g.belongRoomUserID,type:a,parent:n,properties:g.properties});var b=this;for(t=0;t<e.placements.length;t++)if(g=e.placements[t],a="Thing",g.jsonData&&g.jsonData.type&&(a=g.jsonData.type),g.mesh){if((s=this.app.objectManager.create({uuid:g.id,id:g.userID,name:g.name,type:a,belongRoomUserID:g.belongRoomUserID,node:g.delayObject,parent:n,url:g.resource.getModelUrl(),animations:g.resource.animations,properties:g.properties})).bundleID=g.resource.modelID,s.bundleName=g.resource.modelName,g.isPlayAnim&&s.containAnimation(g.animClip)){var x={name:g.animClip,loop:!1,speed:.15};g.hasSkin&&(x.loop=!0),s.playAnimation(x)}}else g.initCompleteCallback=function(e){a="Thing",e.jsonData&&e.jsonData.type&&(a=e.jsonData.type);var t=b.app.objectManager.create({uuid:e.id,id:e.userID,belongRoomUserID:e.belongRoomUserID,name:e.name,node:e.mesh,parent:n,type:a,url:e.resource.getModelUrl(),animations:e.resource.animations,properties:e.properties});if(t.bundleID=e.resource.modelID,t.bundleName=e.resource.modelName,n.miscNode.add(t.node),e.isPlayAnim&&t.containAnimation(e.animClip)){var r={name:e.animClip,loop:!1,speed:.15};e.hasSkin&&(r.loop=!0),t.playAnimation(r)}};for(t=0;t<e.videoprobes.length;t++)(g=e.videoprobes[t]).mesh?s=this.app.objectManager.create({id:g.userID,name:g.name,uuid:g.id,belongRoomUserID:g.belongRoomUserID,node:g.delayObject,parent:n,url:g.resource.getModelUrl(),animations:g.resource.animations,properties:g.properties}):g.initCompleteCallback=function(e){var t=b.app.objectManager.create({id:e.userID,name:e.name,uuid:e.id,belongRoomUserID:e.belongRoomUserID,node:e.mesh,parent:n,url:e.resource.getModelUrl(),animations:e.resource.animations,properties:e.properties});n.miscNode.add(t.node)};for(t=0;t<e.rooms.length;t++){var E=e.rooms[t];u=this.app.objectManager.create({type:"Room",name:E.name,node:E.mesh,uuid:E.id,id:E.userID,ceilingNode:E.ceiling.mesh,roofNode:E.roof.mesh,floorNode:E.floor.mesh,parent:n,properties:E.properties})}for(t=0;t<e.curvelines.length;t++){var _=e.curvelines[t];this.parseCurveLines(_,n)}for(t=0;t<e.pipelines.length;t++)_=e.pipelines[t],this.parsePipeLines(_,n)},i.prototype.parsePipeLines=function(r,e){var i={type:"PolygonLine",name:r.name,points:r.points,id:r.userID,uuid:r.id,parent:e,style:{}};r.color&&(i.style.color="#"+r.color.getHexString());var n=this;if(r.resource)r.initCompleteCallback=function(e){i.image=e.resource.getTextureUrl();var t=n.app.objectManager.create(i);t.node.position.set(r.position.x,r.position.y,r.position.z),r.sectionType&&"Triangle"===r.sectionType&&(t.pathRadialSegments=3,t._updateByPoints()),r.radius&&(t.width=r.radius)};else{var t=n.app.objectManager.create(i);t.node.position.set(r.position.x,r.position.y,r.position.z),r.sectionType&&"Triangle"===r.sectionType&&(t.pathRadialSegments=3,t._updateByPoints()),r.radius&&(t.width=r.radius)}},i.prototype.parseCurveLines=function(i,e){var n={type:"RouteLine",parent:e,name:i.name,uuid:i.id,id:i.userID,points:i.points,arrowFlag:!1,style:{}},o=this;if(i.color&&(n.style.color="#"+i.color.getHexString()),i.resource)i.initCompleteCallback=function(e){if(e.resource.texture){var t=e.resource.texture.clone();t.rotation=Math.PI/2,n.image=t}var r=o.app.objectManager.create(n);null!==i.width&&(r.width=i.width),r.node.position.set(i.position.x,i.position.y,i.position.z)};else{var t=o.app.objectManager.create(n);null!==i.width&&(t.width=i.width),t.node.position.set(i.position.x,i.position.y,i.position.z)}},i}(),Wt=(Ht=Ot={exports:{}},function(e){var l,t=Object.prototype,c=t.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",i=r.asyncIterator||"@@asyncIterator",o=r.toStringTag||"@@toStringTag",a=e.regeneratorRuntime;if(a)Ht.exports=a;else{(a=e.regeneratorRuntime=Ht.exports).wrap=y;var h="suspendedStart",p="suspendedYield",d="executing",f="completed",m={},s={};s[n]=function(){return this};var u=Object.getPrototypeOf,g=u&&u(u(A([])));g&&g!==t&&c.call(g,n)&&(s=g);var v=_.prototype=x.prototype=Object.create(s);E.prototype=v.constructor=_,_.constructor=E,_[o]=E.displayName="GeneratorFunction",a.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===E||"GeneratorFunction"===(t.displayName||t.name))},a.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,_):(e.__proto__=_,o in e||(e[o]="GeneratorFunction")),e.prototype=Object.create(v),e},a.awrap=function(e){return{__await:e}},w(T.prototype),T.prototype[i]=function(){return this},a.AsyncIterator=T,a.async=function(e,t,r,i){var n=new T(y(e,t,r,i));return a.isGeneratorFunction(t)?n:n.next().then(function(e){return e.done?e.value:n.next()})},w(v),v[o]="Generator",v[n]=function(){return this},v.toString=function(){return"[object Generator]"},a.keys=function(r){var i=[];for(var e in r)i.push(e);return i.reverse(),function e(){for(;i.length;){var t=i.pop();if(t in r)return e.value=t,e.done=!1,e}return e.done=!0,e}},a.values=A,P.prototype={constructor:P,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=l,this.done=!1,this.delegate=null,this.method="next",this.arg=l,this.tryEntries.forEach(R),!e)for(var t in this)"t"===t.charAt(0)&&c.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=l)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(r){if(this.done)throw r;var i=this;function e(e,t){return o.type="throw",o.arg=r,i.next=e,t&&(i.method="next",i.arg=l),!!t}for(var t=this.tryEntries.length-1;0<=t;--t){var n=this.tryEntries[t],o=n.completion;if("root"===n.tryLoc)return e("end");if(n.tryLoc<=this.prev){var a=c.call(n,"catchLoc"),s=c.call(n,"finallyLoc");if(a&&s){if(this.prev<n.catchLoc)return e(n.catchLoc,!0);if(this.prev<n.finallyLoc)return e(n.finallyLoc)}else if(a){if(this.prev<n.catchLoc)return e(n.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<n.finallyLoc)return e(n.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;0<=r;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&c.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var n=i;break}}n&&("break"===e||"continue"===e)&&n.tryLoc<=t&&t<=n.finallyLoc&&(n=null);var o=n?n.completion:{};return o.type=e,o.arg=t,n?(this.method="next",this.next=n.finallyLoc,m):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),R(r),m}},catch:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var i=r.completion;if("throw"===i.type){var n=i.arg;R(r)}return n}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:A(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=l),m}}}function y(e,t,r,i){var o,a,s,l,n=t&&t.prototype instanceof x?t:x,c=Object.create(n.prototype),u=new P(i||[]);return c._invoke=(o=e,a=r,s=u,l=h,function(e,t){if(l===d)throw new Error("Generator is already running");if(l===f){if("throw"===e)throw t;return C()}for(s.method=e,s.arg=t;;){var r=s.delegate;if(r){var i=M(r,s);if(i){if(i===m)continue;return i}}if("next"===s.method)s.sent=s._sent=s.arg;else if("throw"===s.method){if(l===h)throw l=f,s.arg;s.dispatchException(s.arg)}else"return"===s.method&&s.abrupt("return",s.arg);l=d;var n=b(o,a,s);if("normal"===n.type){if(l=s.done?f:p,n.arg===m)continue;return{value:n.arg,done:s.done}}"throw"===n.type&&(l=f,s.method="throw",s.arg=n.arg)}}),c}function b(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}function x(){}function E(){}function _(){}function w(e){["next","throw","return"].forEach(function(t){e[t]=function(e){return this._invoke(t,e)}})}function T(l){var t;this._invoke=function(r,i){function e(){return new Promise(function(e,t){!function t(e,r,i,n){var o=b(l[e],l,r);if("throw"!==o.type){var a=o.arg,s=a.value;return s&&"object"==typeof s&&c.call(s,"__await")?Promise.resolve(s.__await).then(function(e){t("next",e,i,n)},function(e){t("throw",e,i,n)}):Promise.resolve(s).then(function(e){a.value=e,i(a)},n)}n(o.arg)}(r,i,e,t)})}return t=t?t.then(e,e):e()}}function M(e,t){var r=e.iterator[t.method];if(r===l){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=l,M(e,t),"throw"===t.method))return m;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return m}var i=b(r,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,m;var n=i.arg;return n?n.done?(t[e.resultName]=n.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=l),t.delegate=null,m):n:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,m)}function S(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function R(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function P(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(S,this),this.reset(!0)}function A(t){if(t){var e=t[n];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,i=function e(){for(;++r<t.length;)if(c.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=l,e.done=!0,e};return i.next=i}}return{next:C}}function C(){return{value:l,done:!0}}}(function(){return this}()||Function("return this")()),Ot.exports),Xt=function(){return this}()||Function("return this")(),Yt=Xt.regeneratorRuntime&&0<=Object.getOwnPropertyNames(Xt).indexOf("regeneratorRuntime"),Qt=Yt&&Xt.regeneratorRuntime;Xt.regeneratorRuntime=void 0;var Jt=Wt;if(Yt)Xt.regeneratorRuntime=Qt;else try{delete Xt.regeneratorRuntime}catch(vi){Xt.regeneratorRuntime=void 0}var Zt=Jt,Kt=function(){function t(e){y(this,t),this.app=e,this.nodes=[],this.scene=this.app.scene,this.objectPool=this.app.objectPool,this.worldNode=new THREE.Object3D,this.app.scene.add(this.worldNode),this.baseURL=e.sceneURL,this.curLoadGLTFIndex=0,this.splitLoadedGLTFCount=0,this.allLoadedGLTFCount=0,this.sliceRootNodeArray=[],this.sceneJsonData=null,this.states=null,this.combineManager=new zt(this.app),this.combineProcessorMap=new Map,this.loadSpeed=.1}return t.prototype.load=function(){var i=this;return new Promise(function(e,t){i.loadSceneJson().then(function(e){return e.camInfo&&(i.parseCamInfo(e.camInfo),i.app.camera.update()),i.sceneJsonData=e,i.loadStructureJson()}).then(function(e){var r=i.getSortedStructureGLTFs(e);return new Promise(function(e,t){i.loadStructure(r,function(){i.parseObjects().then(function(){e(i.worldNode)})})})}).then(function(){e(i.worldNode)}).catch(function(e){t(e)})})},t.prototype.loadSceneJson=function(){var e=this;return new Promise(function(r,t){(new THREE.FileLoader).load(e.baseURL+"/scene.json",function(e){var t=JSON.parse(e);r(t)},function(e){},function(e){t("cant not load file: scene.json")})})},t.prototype.loadStructureJson=function(){var e=this;return new Promise(function(r,t){(new THREE.FileLoader).load(e.baseURL+"/structure.json",function(e){var t=JSON.parse(e);r(t)},function(){},function(e){t("cant not load file: structure.json")})})},t.prototype.loadStructure=function(r,i,n){this.splitLoadedGLTFCount=0;var o=this,e=0;if(0==r.length)i&&i();else for(var t=o.curLoadGLTFIndex;t<r.length&&(0==e||e%10!=0);t++){e++,o.curLoadGLTFIndex++;var a=new THREE.GLTFLoader(o.app.loadingManager);a.setCrossOrigin("anonymous"),a.load(o.baseURL+"/"+r[t].path,function(e){var t=e.scene.children[0].children[0];o.nodes[t.name]=t,o.sliceRootNodeArray.push(t),t.traverse(function(e){o.nodes[e.name]=e}),o.splitLoadedGLTFCount++,o.allLoadedGLTFCount++,10===o.splitLoadedGLTFCount&&o.loadStructure(r,i,n),o.app.scene.add(t),o.allLoadedGLTFCount==r.length&&i&&i()},function(){},function(e){n&&n("load "+o.baseURL+"/"+r[t].path+" failed")})}},t.prototype.parseObjects=function(){var r=this.sceneJsonData,i=this;return r.bIdList?new Promise(function(e,t){i.parseBundleList(r.bIdList).then(function(){return i.parse(r)}).then(function(){i.sliceRootNodeArray=[],e()}).catch(function(e){t(e)})}):new Promise(function(e,t){i.parse(r).then(function(){i.sliceRootNodeArray=[],e()}).catch(function(e){t(e)})})},t.prototype.getSortedStructureGLTFs=function(e){var t=[],r=[],i=[],n=e.outdoors,o=e.buildings;for(var a in n){var s=n[a];t.push(s)}for(var l=0;l<t.length;l++){var c=t[l];if(0!=r.length)for(var u=0;u<r.length;u++){var h=r[u];if(c.size<h.size){r.splice(u,0,c);break}if(u==r.length-1){r.push(c);break}}else r.push(t[l])}for(var a in t=[],o)t.push(o[a]);for(l=0;l<t.length;l++)if(c=t[l],0!=i.length)for(u=0;u<i.length;u++){if(h=i[u],c.size<h.size){i.splice(u,0,c);break}if(u==i.length-1){i.push(c);break}}else i.push(t[l]);return r.concat(i)},t.prototype._nestingLoopYield=function(t,r,i){var n=this,e=t.next();if(e.done)return r&&r(),e.value;var o=e.value;e.done,o instanceof Promise?o.then(function(e){return n._nestingLoopYield(t,r,i)}).catch(function(e){i(e)}):this._nestingLoopYield(t,r,i)},t.prototype.parse=function(a){var s=this;return this.combineManager.combineModels().then(function(){return new Promise(function(e,t){if(a.objects){var r=a.objects,i=null;for(var n in r){i=r[n];break}s._nestingLoopYield(s.parseWorld(i),function(){e()})}if(a.camInfo){var o=a.camInfo;s.parseCamInfo(o)}})})},t.prototype.parseCamInfo=function(e){var t=e.eye,r=e.target,i=t.split(" "),n=r.split(" "),o=[Number(i[0]),Number(i[1]),Number(i[2])];o[2]=-o[2];var a=[Number(n[0]),Number(n[1]),Number(n[2])];a[2]=-a[2],this.app.camera.position=o,this.app.camera.target=a},t.prototype.parseWorld=function(e){var h=Zt.mark(v),t=this.worldNode;if(e.plan&&this.parseOutdoors(e.plan,t),e.bds){var r=e.bds;for(var i in r){var n=r[i],o=new THREE.Vector3(0,0,0);if(n.pos){var a=n.pos.split(" ");o.x=parseFloat(a[0]),o.y=parseFloat(a[1]),o.z=-parseFloat(a[2])}var s=new THREE.Object3D,l=this.app.objectManager.create({type:"Building",name:i,node:s});if(l.name=i,l.app=this.app,l.id=i,t.add(s),n.plans&&this.parseFloorPlans(n.plans,l),n.facades){var c=n.facades;for(var u in c){var p=this.createThing(c[u],l,null,"Facade"),d=p.node.position;d.x+=o.x,d.y+=o.y,d.z+=o.z,p.node.position.set(d.x,d.y,d.z)}}if(n.groups){var f=n.groups;for(var m in f)n=f[m],this.createGroup(n,l)}}}var g=this;function v(t){var o,a,r,i,n,s,l,c,u;return Zt.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:o=g.loadSpeed,a=10,r=t.keys(),i=Array.isArray(r),n=0,r=i?r:r[Symbol.iterator]();case 3:if(!i){e.next=9;break}if(n>=r.length)return e.abrupt("break",24);e.next=6;break;case 6:s=r[n++],e.next=13;break;case 9:if((n=r.next()).done)return e.abrupt("break",24);e.next=12;break;case 12:s=n.value;case 13:l=s,c=t.get(l),u=0;case 16:if(u<c.length)return e.next=19,new Promise(function(e,t){var r=performance.now();c[u].build();var i=c[u].combineMesh;l.node.add(i);var n=performance.now()-r;o<n?setTimeout(function(){e()},a):e()});e.next=22;break;case 19:u++,e.next=16;break;case 22:e.next=3;break;case 24:case"end":return e.stop()}},h,this)}return v(this.combineProcessorMap)},t.prototype.parseOutdoors=function(e,t){var r,i;for(var n in e){i=e[n],r=n;break}var o=this.app.outdoors;this.worldNode.add(o.node),this.processFloorPlanData(r,i,o)},t.prototype.processFloorPlanData=function(e,t,r){r.name=e,r.app=this.app,r.id=e;var i=new THREE.Vector3(0,0,0);if(t.pos){var n=t.pos.split(" ");i.x=parseFloat(n[0]),i.y=parseFloat(n[1]),i.z=-parseFloat(n[2])}var o=t.cwalls;if(o){var a=new THREE.Group;for(var s in a.name="combinewall",o){var l=o[s].gltfid,c=this.nodes[l];c&&a.add(c)}r.node.add(a),a.updateMatrixWorld(),r.wallNode=a}var u=t.croofs;if(u){var h=new THREE.Group;for(var s in h.name="combineroof",u){l=u[s].gltfid;var p=this.nodes[l];p&&h.add(p)}r.node.add(h),r.roofNode=h}var d=t.cceilings;if(d){var f=new THREE.Group;for(var s in f.name="combineceiling",d){l=d[s].gltfid;var m=this.nodes[l];m&&f.add(m)}r.node.add(f),r.ceilNode=f}if(v=t.cfloors){var g=new THREE.Group;for(var s in g.name="combinefloor",v){var v;if(l=(v=v[s]).gltfid){var y=this.nodes[l];y&&g.add(y)}}r.node.add(g),r.floorNode=g}var b=new THREE.Group;b.name="combinePlacement",r.miscNode=b,r.node.add(b);var x=t.cplcs;if(x)for(var s in x){l=x[s].gltfid;var E=this.nodes[l];E&&(b.add(E),E.updateMatrixWorld())}if(t.plcs){var _=this.combineManager.getCombineProcessors(t.plcs,[i],[new THREE.Vector3(1,1,1)],[new THREE.Quaternion(0,0,0,1)]);this.combineProcessorMap.set(r,_),this.parseThings(t.plcs,r,i)}t.routes&&this.parseStructureThing(t.routes,r),t.pipelines&&this.parseStructureThing(t.pipelines,r),t.curvelines&&this.parseStructureThing(t.curvelines,r),t.arrowlines&&this.parseStructureThing(t.arrowlines,r),t.arrowdatalines&&this.parseStructureThing(t.arrowdatalines,r),t.leakwaterlines&&this.parseStructureThing(t.leakwaterlines,r),t.vps&&this.parseThings(t.vps,r,i),t.groups&&this.parseGroups(t.groups,r,[new THREE.Vector3(1,1,1)],[new THREE.Quaternion(0,0,0,1)],[i],i),t.dws&&this.parseDoorWins(t.dws,r,i)},t.prototype.parseDoorWins=function(e,t,r){for(var i in e){var n=e[i],o=i;n.uid&&(o=n.uid);var a=null;if(n.gltfid){var s=n.gltfid;this.nodes[s]&&((a=this.nodes[s]).position.x+=r.x,a.position.y+=r.y,a.position.z+=r.z,t.node.add(a))}var l=null;if(n.prop){var c=n.prop;for(var u in l={},c){var h=c[u];l[u]=h}}this.app.objectManager.create({type:"Door",name:o,node:a,parent:t,properties:l})}},t.prototype.parseGroups=function(e,t,r,i,n,o){for(var a in e){var s=e[a];s.uid?this.createGroup(s,t):this.combineGroup(s,t,r,i,n,o)}},t.prototype.createGroup=function(e,t){var r,i,n=this.instanceGroup(e);e.id&&e.id,e.uid&&(r=e.uid);var o=e.prop;if(o)for(var a in i={},o){var s=o[a];i[a]=s}return this.app.objectManager.create({type:"Thing",name:r,node:n,parent:t,properties:i})},t.prototype.parseFloorPlans=function(e,t){var r=[];for(var i in e){var n=e[i],o=new THREE.Object3D,a=this.app.objectManager.create({type:"Floor",name:i,node:o,parent:t});a.id=i,o.name="floorPlan",t.node.add(a.node),this.processFloorPlanData(i,n,a),a._parent=t,r.push(a)}return r},t.prototype.parseBundleList=function(n){this.app.modelResource.bundleIDArray=n;var o=0,a=this;return new Promise(function(r,i){0!=n.length?n.forEach(function(t){var e=new THREE.GLTFLoader(a.app.loadingManager);e.setCrossOrigin("anonymous"),e.load(a.baseURL+"/"+t+"/scene.gltf",function(e){o++,a.app.modelResource.set(t,e.scene.children[0].children[0]),o==n.length&&r()},function(){},function(e){i("can not load "+a.baseURL+"/"+t+"/scene.gltf")})}):r()})},t.prototype.combineGroup=function(e,t,r,i,n,o){var a=e,s=new THREE.Vector3(0,0,0);if(a.pos){var l=a.pos.split(" ");s.x=parseFloat(l[0]),s.y=parseFloat(l[1]),s.z=-parseFloat(l[2])}var c=new THREE.Vector3(1,1,1);if(a.scl){var u=a.scl.split(" ");c.x=parseFloat(u[0]),c.y=parseFloat(u[1]),c.z=parseFloat(u[2])}var h,p,d,f=new THREE.Quaternion(0,0,0,1);if(a.rot&&(u=a.rot.split(" "),f.x=parseFloat(u[0]),f.y=parseFloat(u[1]),f.z=-parseFloat(u[2]),f.w=-parseFloat(u[3])),n?(h=r.slice(),d=i.slice(),p=n.slice()):(h=[],p=[],d=[]),h.push(c),p.push(s),d.push(f),a.plcs){var m=this.combineManager.getCombineProcessors(a.plcs,p,h,d),g=this.combineProcessorMap.get(t);g&&(m=g.concat(m)),this.combineProcessorMap.set(t,m)}if(a.groups)for(var v in a.groups)this.combineGroup(a.groups[v],t,h,d,p,o)},t.prototype.instanceGroup=function(e){var t=new THREE.Vector3(0,0,0);if(e.pos){var r=e.pos.split(" ");t.x=parseFloat(r[0]),t.y=parseFloat(r[1]),t.z=-parseFloat(r[2])}var i=new THREE.Vector3(1,1,1);if(e.scl){var n=e.scl.split(" ");i.x=parseFloat(n[0]),i.y=parseFloat(n[1]),i.z=parseFloat(n[2])}var o=new THREE.Quaternion(0,0,0,1);e.rot&&(n=e.rot.split(" "),o.x=parseFloat(n[0]),o.y=parseFloat(n[1]),o.z=-parseFloat(n[2]),o.w=-parseFloat(n[3]));var a=new THREE.Group;if(e.plcs)for(var s in e.plcs){var l=this.instanceChildOfGroup(e.plcs[s]);a.add(l)}if(e.groups)for(var s in e.groups)l=this.instanceGroup(e.plcs[s]),a.add(l);return a.scale.copy(i),a.setRotationFromQuaternion(o),a.position.copy(t),a},t.prototype.instanceChildOfGroup=function(e){var t=this.app.modelResource.bundleIDArray[e.bIdx],r=this.app.modelResource.get(t).node.clone();if(e.pos){var i=e.pos.split(" ");r.position.x=parseFloat(i[0]),r.position.y=parseFloat(i[1]),r.position.z=-parseFloat(i[2])}if(e.rot){i=e.rot.split(" ");var n=new THREE.Quaternion;n.x=parseFloat(i[0]),n.y=parseFloat(i[1]),n.z=-parseFloat(i[2]),n.w=-parseFloat(i[3]),r.setRotationFromQuaternion(n)}return r},t.prototype.parseThings=function(e,t,r){for(var i in e){var n=e[i];(n.uid||n.prop)&&this.createThing(n,t,r)}},t.prototype.createThing=function(e,t,r){var i,n,o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:"Thing";e.id&&e.id,e.uid&&(i=e.uid);var a=e.prop;if(a)for(var s in n={},a){var l=a[s];n[s]=l}var c=this.app.modelResource.bundleIDArray[e.bIdx],u=this.app.modelResource.get(c).node.clone();if(e.pos){var h=e.pos.split(" "),p=new THREE.Vector3(parseFloat(h[0]),parseFloat(h[1]),-parseFloat(h[2]));r&&(p.x+=r.x,p.y+=r.y,p.z+=r.z),u.position.x=p.x,u.position.y=p.y,u.position.z=p.z}if(e.rot){h=e.rot.split(" ");var d=new THREE.Quaternion;d.x=parseFloat(h[0]),d.y=parseFloat(h[1]),d.z=-parseFloat(h[2]),d.w=-parseFloat(h[3]),u.setRotationFromQuaternion(d)}if(e.scl){h=e.scl.split(" ");var f=new THREE.Vector3;f.x=parseFloat(h[0]),f.y=parseFloat(h[1]),f.z=-parseFloat(h[2]),u.scale.x=f.x,u.scale.y=f.y,u.scale.z=f.z}return this.app.objectManager.create({type:o,name:i,node:u,parent:t,properties:n})},t.prototype.parseStructureThing=function(e,t,r){for(var i in e){var n=e[i];if(n.gltfid){var o=new Se(this.app);o.name=i,o.app=this.app,n.id&&(o.id=n.id),n.uid&&(o.name=n.uid);var a=n.gltfid;if(this.nodes[a]){var s=this.nodes[a];o.node=s,t.add(o),r&&(s.position.x=r.x,s.position.y=r.y,s.position.z=r.z)}}}},t}(),$t=function(){function i(e,t){y(this,i),this.app=e,this.nodes=[],this.outdoors=this.app.outdoors,this.objectPool=this.app.objectPool,this.worldNode=new THREE.Object3D,this.worldNode.name="world",this.campus=null,this.baseURL=null,this.curLoadGLTFIndex=0,this.splitLoadedGLTFCount=0,this.allLoadedGLTFCount=0,this.sliceRootNodeArray=[],this.sceneJsonData=null,this.states=null,this.combineManager=new zt(this.app),this.loadSpeed=.1,this.isCamFitScene=!0,this.loadStageWeight=[.1,.1,.3,.5],this.loadedProgress=0,this.curStageLoadProgress=0,this.isDelayLoadFloorPlan=!1,this.envMap=null,this.appFirstTimeLoad=!1,this.outdoors?this.appFirstTimeLoad=!1:this.appFirstTimeLoad=!0,t&&(t.position&&(this.campusPosition=t.position),t.rotation&&(this.campusRotation=t.rotation),void 0!==t.isCamFitScene&&null!==t.isCamFitScene&&(this.isCamFitScene=t.isCamFitScene),void 0!==t.isDelayLoadFloorPlan&&null!==t.isDelayLoadFloorPlan&&(this.isDelayLoadFloorPlan=t.isDelayLoadFloorPlan),t.campus&&(this.campus=t.campus));var r=this.worldNode;null==this.campus&&(this.campus=this.app.objectManager.create({type:"Campus",name:"Campus",node:r}),this.app.scene.add(this.campus.node)),this.campusRotation&&this.campus.node.quaternion.set(this.campusRotation.x,this.campusRotation.y,this.campusRotation.z,this.campusRotation.w),this.campusPosition&&(this.campus.position=this.campusPosition),this.scene=this.campus.node}return i.prototype.updateProgress=function(e){this.app.mainUI.updateLoadingProcess(e)},i.prototype.loadSkybox=function(){if(this.sceneJsonData.skybox){for(var r=this.sceneJsonData.skybox,e=0;e<r.length;e++){var t=r[e];t=this.baseURL+t,r[e]=t}var i=this;return new Promise(function(t,e){(new THREE.CubeTextureLoader).load(r,function(e){e.flipY=!0,i.envMap=e,t()},null,function(){console.warn("load skybox fail"),t()})})}return new Promise(function(e,t){e()})},i.prototype.load=function(e){var i=this;return this.baseURL=e,new Promise(function(e,t){i.loadSceneJson().then(function(e){return e.camInfo&&i.isCamFitScene&&i.parseCamInfo(e.camInfo),i.sceneJsonData=e,i.updateProgress(.1),i.loadSkybox().then(function(){return i.loadStructureJson()})}).then(function(e){i.updateProgress(.2);var r=i.getSortedStructureGLTFs(e);return new Promise(function(e,t){i.updateProgress(.3),i.loadStructure(r,function(){i.updateProgress(.7),i.parseObjects().then(function(){i.updateProgress(.8),e(i.campus)})})})}).then(function(){i.updateProgress(1),e(i.campus)}).catch(function(e){t(e)})})},i.prototype.loadSceneJson=function(){var e=this;return new Promise(function(r,t){(new THREE.FileLoader).load(e.baseURL+"/scene.json",function(e){var t=JSON.parse(e);r(t)},function(e){},function(e){t("cant not load file: scene.json")})})},i.prototype.loadStructureJson=function(){var e=this;return new Promise(function(r,t){(new THREE.FileLoader).load(e.baseURL+"/structure.json",function(e){var t=JSON.parse(e);r(t)},function(){},function(e){t("cant not load file: structure.json")})})},i.prototype.addEnvMap=function(e){var t=this;this.envMap&&e.traverse(function(e){e.material&&(e.material.opacity<1&&!e.material.transparent&&(e.material.transparent=!0,e.material.needsUpdate=!0),e.material.transparent&&(e.material.metalness=1,e.material.roughness=0,e.material.envMap=t.envMap,e.material.envMapIntensity=2,e.material.refractionRatio=1,e.material.needsUpdate=!0),e.material.isMeshStandardMaterial&&(e.material.envMap=t.envMap,e.material.envMapIntensity=1,e.material.refractionRatio=1,e.material.needsUpdate=!0))})},i.prototype.loadStructure=function(r,i,n){this.splitLoadedGLTFCount=0;var o=this,e=0;if(0==r.length)i&&i();else for(var t=o.curLoadGLTFIndex;t<r.length&&(0==e||e%10!=0);t++){e++,o.curLoadGLTFIndex++;var a=new thingjs.GLTFLoader;a.setCrossOrigin("anonymous");var s=r[t];a.load(o.baseURL+"/"+s.path,function(e){var t=e.scene.children[0].children[0];o.nodes[t.name]=t,o.sliceRootNodeArray.push(t),t.traverse(function(e){o.nodes[e.name]=e}),o.splitLoadedGLTFCount++,o.allLoadedGLTFCount++,10===o.splitLoadedGLTFCount&&o.loadStructure(r,i,n),(void 0===s.show||s.show)&&o.scene.add(t),o.addEnvMap(t),t.updateMatrixWorld(),o.scene.updateMatrixWorld(!0),o.allLoadedGLTFCount==r.length&&i&&i()},function(){},function(e){n?n("load "+o.baseURL+"/"+r[t].path+" failed"):console.error("load "+o.baseURL+"/"+s.path+" failed"),console.error(e)})}},i.prototype.parseObjects=function(){var r=this.sceneJsonData,i=this;return r.models?new Promise(function(e,t){i.parseBundleList(r.models).then(function(){return i.parse(r)}).then(function(){i.sliceRootNodeArray=[],e()}).catch(function(e){t(e)})}):new Promise(function(e,t){i.parse(r).then(function(){i.sliceRootNodeArray=[],e()}).catch(function(e){t(e)})})},i.prototype.getSortedStructureGLTFs=function(e){var t=[],r=[],i=[],n=e.outdoors,o=e.buildings;for(var a in n){var s=n[a];t.push(s)}for(var l=0;l<t.length;l++){var c=t[l];if(0!=r.length)for(var u=0;u<r.length;u++){var h=r[u];if(c.size<h.size){r.splice(u,0,c);break}if(u==r.length-1){r.push(c);break}}else r.push(t[l])}for(var a in t=[],o)t.push(o[a]);for(l=0;l<t.length;l++)if(c=t[l],0!=i.length)for(u=0;u<i.length;u++){if(h=i[u],c.size<h.size){i.splice(u,0,c);break}if(u==i.length-1){i.push(c);break}}else i.push(t[l]);return r.concat(i)},i.prototype._nestingLoopYield=function(t,r,i){var n=this,e=t.next();if(e.done)return r&&r(),e.value;var o=e.value;e.done,o instanceof Promise?o.then(function(e){return n._nestingLoopYield(t,r,i)}).catch(function(e){i(e)}):this._nestingLoopYield(t,r,i)},i.prototype.parse=function(n){var o=this;return this.combineManager.combineModels().then(function(){return new Promise(function(e,t){var r=o.parseWorld(n);if(r?o._nestingLoopYield(r,function(){e()},function(e){t(e)}):e(),n.camInfo&&o.isCamFitScene){var i=n.camInfo;o.parseCamInfo(i)}})})},i.prototype.parseCamInfo=function(e){var t=e.eye,r=e.target,i=t.split(" "),n=r.split(" "),o=[Number(i[0]),Number(i[1]),Number(i[2])];o[2]=-o[2];var a=[Number(n[0]),Number(n[1]),Number(n[2])];a[2]=-a[2],this.app.camera.position=o,this.app.camera.target=a},i.prototype.parseWorld=function(e){var h=Zt.mark(E);if(e.outdoors&&this.parseOutdoors(e.outdoors),e.buildings){var t=e.buildings;for(var r in t){var i=t[r],n=new THREE.Vector3(0,0,0),o=r,a=void 0;i.id&&(a=i.id),i.name&&(o=i.name);var s=i.properties,l=null;if(s)for(var c in l={},s){var u=s[c];l[c]=u}if(i.position){var p=i.position;n.x=p[0],n.y=p[1],n.z=-p[2]}var d=new THREE.Object3D,f=this.app.objectManager.create({type:"Building",name:o,id:a,properties:l,parent:this.campus,node:d});if(f.app=this.app,f.node.position.x=n.x,f.node.position.y=n.y,f.node.position.z=n.z,i.facades){var m=i.facades;for(var g in m)this.createThing(m[g],f,null,"Facade")}if(i.facadegroups){var v=i.facadegroups;for(var y in v){var b=v[y];this.createGroup(b,f,"Facade")}}i.plans&&this.parseFloorPlans(i.plans,f)}}var x=this;function E(t){var o,a,r,i,n,s,l,c,u;return Zt.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:o=x.loadSpeed,a=10,r=t.keys(),i=Array.isArray(r),n=0,r=i?r:r[Symbol.iterator]();case 3:if(!i){e.next=9;break}if(n>=r.length)return e.abrupt("break",24);e.next=6;break;case 6:s=r[n++],e.next=13;break;case 9:if((n=r.next()).done)return e.abrupt("break",24);e.next=12;break;case 12:s=n.value;case 13:l=s,c=t.get(l),u=0;case 16:if(u<c.length)return e.next=19,new Promise(function(e,t){var r=performance.now();c[u].build();var i=c[u].combineMesh;l.miscNode.add(i);var n=performance.now()-r;o<n?setTimeout(function(){e()},a):e()});e.next=22;break;case 19:u++,e.next=16;break;case 22:e.next=3;break;case 24:case"end":return e.stop()}},h,this)}if(this.isDelayLoadFloorPlan){var _=new Map,w=this.combineManager.processorMap.get(this.outdoors);w&&_.set(this.outdoors,w);var T=this.combineManager.processorMap.keys(),M=Array.isArray(T),S=0;for(T=M?T:T[Symbol.iterator]();;){var R;if(M){if(S>=T.length)break;R=T[S++]}else{if((S=T.next()).done)break;R=S.value}var P=R;P!=this.outdoors&&(P.isLoaded=!1)}return E(_)}return E(this.combineManager.processorMap)},i.prototype.parseOutdoors=function(e){var t=new THREE.Object3D;this.outdoors=this.app.objectManager.create({type:"Outdoors",name:"Outdoors",parent:this.campus,node:t}),this.app.outdoors||(this.app.outdoors=this.outdoors,this.app.currentParentObject=this.outdoors),this.processFloorPlanData(e,this.outdoors)},i.prototype.processFloorPlanData=function(e,t){t.app=this.app;var r=new THREE.Vector3(0,0,0);if(e.position){var i=e.position;r.x=i[0],r.y=i[1],r.z=-i[2]}t.node.position.x=r.x,t.node.position.y=r.y,t.node.position.z=r.z,t.node.updateMatrixWorld(),t.node.updateMatrix(),this.parseStructure(e,t),e.placements&&(this.parseCombineProcessors(t,e.placements,[],[],[]),this.parseThings(e.placements,t,r)),e.videoprobes&&this.parseThings(e.videoprobes,t,r),e.groups&&this.parseGroups(e.groups,t,[],[],[],r),e.doororwindows&&this.parseDoorWins(e.doororwindows,t,r),e.rooms&&this.parseRooms(e.rooms,t),e.routes&&this.parseStructureThing(e.routes,t),e.pipelines&&this.parseStructureThing(e.pipelines,t),e.curvelines&&this.parseStructureThing(e.curvelines,t),e.arrowlines&&this.parseStructureThing(e.arrowlines,t),e.arrowdatalines&&this.parseStructureThing(e.arrowdatalines,t),e.leakwaterlines&&this.parseStructureThing(e.leakwaterlines,t)},i.prototype.parseRooms=function(e,t){for(var r=0;r<e.length;r++){var i=e[r],n=null;i.name&&(n=i.name),e.id&&e.id;var o=null,a=i.gltfid;a&&this.nodes[a]&&(o=this.nodes[a]);var s=null,l=i.properties;if(l)for(var c in s={},l){var u=l[c];s[c]=u}var h=null,p=null,d=null;i.floor&&(a=i.floor.gltfid,this.nodes[a]&&(d=this.nodes[a])),i.ceiling&&(a=i.ceiling.gltfid,this.nodes[a]&&(h=this.nodes[a])),i.roof&&(a=i.roof.gltfid,this.nodes[a]&&(p=this.nodes[a]));var f=i.isShown;if(f){var m="false"!==(f=f.toLowerCase());o.visible=m}var g=null,v=null,y=null,b={};if(i.area&&(v=i.area,b.area=v),i.circumference&&(y=i.circumference,b.circumference=y),i.center){var x=i.center;(g=new THREE.Vector3).set(x[0],x[1],-x[2]),b.center=g}this.app.objectManager.create({type:"Room",name:n,node:o,ceilingNode:h,roofNode:p,floorNode:d,parent:t,properties:s,auxiliaryInfo:b})}},i.prototype.parseCombineProcessors=function(e,t,r,i,n){for(var o in t){var a=t[o];if(!a.name&&!a.properties){var s=this.app.modelResource.bundleIDArray[a.model].uri;s||(s=this.app.modelResource.bundleIDArray[a.model].id);var l=new THREE.Vector3(0,0,0);if(a.position){var c=a.position;l.x=c[0],l.y=c[1],l.z=-c[2]}var u=new THREE.Vector3(1,1,1);if(a.scale){var h=a.scale;u.x=h[0],u.y=h[1],u.z=h[2]}var p=new THREE.Quaternion(0,0,0,1);if(a.rotation){var d=a.rotation;p.x=d[0],p.y=d[1],p.z=-d[2],p.w=-d[3]}var f=r.slice(),m=i.slice(),g=n.slice();g.push(p),m.push(u),f.push(l),this.combineManager.addPlacement(e,s,f,m,g)}}},i.prototype.parseStructure=function(e,t){t.node.updateMatrixWorld();var r=t.node.position,i=new THREE.Vector3;t.parent&&!t.isOutdoors&&(i=t.parent.node.position);var n=new THREE.Vector3(i.x+r.x,i.y+r.y,i.z+r.z);if(e.structure){var o=(e=e.structure).walls;if(o){var a=new THREE.Group;for(var s in a.name="structurnWall",o){var l=o[s].gltfid,c=this.nodes[l];c.traverse(function(e){e.material&&(e.material.onBeforeCompile=function(e){e.fragmentShader=e.fragmentShader.replace("#include <aomap_fragment>",["#ifdef USE_AOMAP","float ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 3.0;","#if defined( USE_ENVMAP ) && defined( PHYSICAL )","float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );","reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );","#endif","#endif"].join("\n"))},e.material.needsUpdate=!0)}),c&&a.add(c)}t.node.add(a),a.position.set(-n.x,-n.y,-n.z),t.wallNode=a}var u=e.roofs;if(u){var h=new THREE.Group;for(var s in h.name="structurnRoof",u){l=u[s].gltfid;var p=this.nodes[l];p&&h.add(p)}t.node.add(h),h.position.set(-n.x,-n.y,-n.z),t.roofNode=h}var d=e.ceilings;if(d){var f=new THREE.Group;for(var s in f.name="structureCeiling",d){l=d[s].gltfid;var m=this.nodes[l];m&&f.add(m)}t.node.add(f),f.position.set(-n.x,-n.y,-n.z),t.ceilNode=f}if(v=e.floors){var g=new THREE.Group;for(var s in g.name="structureFloor",v){var v;if(l=(v=v[s]).gltfid){var y=this.nodes[l];y.traverse(function(e){e.material&&(e.material.roughness=.9,e.material.needsUpdate=!0)}),y&&g.add(y)}}t.node.add(g),g.position.set(-n.x,-n.y,-n.z),t.floorNode=g}var b=new THREE.Group;b.name="structurePlacement",t.miscNode=b,t.node.add(b),t.floorNode||(t.floorNode=b),b.updateMatrixWorld(),b.updateMatrix(),b.position.set(0,0,0);var x=e.placements;if(x)for(var s in x){l=x[s].gltfid;var E=this.nodes[l];E&&b.add(E)}e.routes&&this.parseStructureThing(e.routes,t),e.pipelines&&this.parseStructureThing(e.pipelines,t),e.curvelines&&this.parseStructureThing(e.curvelines,t),e.arrowlines&&this.parseStructureThing(e.arrowlines,t),e.arrowdatalines&&this.parseStructureThing(e.arrowdatalines,t),e.leakwaterlines&&this.parseStructureThing(e.leakwaterlines,t)}},i.prototype.parseDoorWins=function(e,t,r){for(var i in new THREE.Group("doors"),e){var n=e[i],o=i;n.name&&(o=n.name);var a=null;if(n.gltfid){var s=n.gltfid;this.nodes[s]&&(a=this.nodes[s],t.node.add(a))}var l=null;if(n.properties){var c=n.properties;for(var u in l={},c){var h=c[u];l[u]=h}}this.app.objectManager.create({type:"Door",name:o,node:a,parent:t,properties:l})}},i.prototype.parseGroups=function(e,t,r,i,n,o){for(var a in e){var s=e[a];s.name||s.properties?this.createGroup(s,t):this.combineGroup(s,t,r,i,n,o)}},i.prototype.createGroup=function(e,t){var r,i,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"Thing",o=this.instanceGroup(e);e.id&&e.id,e.name&&(r=e.name);var a=e.properties;if(a)for(var s in i={},a){var l=a[s];i[s]=l}return this.app.objectManager.create({type:n,name:r,node:o,parent:t,properties:i})},i.prototype.parseFloorPlans=function(e,t){for(var r=[],i=0;i<e.length;i++){var n=e[i],o=n.id,a="";n.name&&(a=n.name);var s=new THREE.Object3D,l=this.app.objectManager.create({type:"Floor",name:a,id:o,node:s,parent:t});s.name="floorPlan",0!=t.facades.length&&(l.node.visible=!1),t.node.add(l.node),t.node.updateMatrixWorld(),t.node.updateMatrix(),this.processFloorPlanData(n,l),r.push(l)}return r},i.prototype.parseBundleList=function(l){this.app.modelResource.bundleIDArray=l;var c=0,u=this;return new Promise(function(a,s){0!==l.length?l.forEach(function(e){if(n=e.uri){var t=new thingjs.GLTFLoader;t.setCrossOrigin("anonymous"),t.load(u.baseURL+"/"+n,function(e){c++;var t;t=-1!==e.asset.generator.indexOf("Unity")?e.scene.children[0].children[0]:e.scene.children[0],u.app.modelResource.set(n,t,e.animations),u.addEnvMap(t),c===l.length&&a()},function(){},function(e){s("can not load "+u.baseURL+"/"+n)})}else{var i=e.id,r=e.version,n="http://model.3dmomoda.cn/models/"+i+"/"+r+"/gltf/",o=new THREE.FileLoader;o.setResponseType("json"),o.load(n+"index.json",function(e){var t=e.gltfFiles[0],r=new thingjs.GLTFLoader;r.setCrossOrigin("anonymous"),r.load(n+t,function(e){c++,u.app.modelResource.set(i,e.scene.children[0],e.animations),c===l.length&&a()},function(){},function(e){s("can not load "+u.baseURL+"/"+n)})})}}):a()})},i.prototype.combineGroup=function(e,t,r,i,n,o){var a=e,s=new THREE.Vector3(0,0,0);if(a.position){var l=a.position;s.x=l[0],s.y=l[1],s.z=-l[2]}var c=new THREE.Vector3(1,1,1);if(a.scale){var u=a.scale;c.x=u[0],c.y=u[1],c.z=u[2]}var h,p=new THREE.Quaternion(0,0,0,1);if(a.rotation){u=a.rotation;p.x=u[0],p.y=u[1],p.z=-u[2],p.w=-u[3]}if(n?(h=r.slice(),u=i.slice(),l=n.slice()):(h=[],l=[],u=[]),h.push(c),l.push(s),u.push(p),a.placements&&this.parseCombineProcessors(t,a.placements,l,h,u),a.groups)for(var d in a.groups)this.combineGroup(a.groups[d],t,h,u,l,o)},i.prototype.instanceGroup=function(e){var t=new THREE.Vector3(0,0,0);if(e.position){var r=e.position;t.x=r[0],t.y=r[1],t.z=-r[2]}var i=new THREE.Vector3(1,1,1);if(e.scale){var n=e.scale;i.x=n[0],i.y=n[1],i.z=n[2]}var o=new THREE.Quaternion(0,0,0,1);e.rotation&&(n=e.rotation,o.x=n[0],o.y=n[1],o.z=-n[2],o.w=-n[3]);var a=new THREE.Group;if(e.placements)for(var s in e.placements){var l=this.instanceChildOfGroup(e.placements[s]);a.add(l)}if(e.groups)for(var s in e.groups)l=this.instanceGroup(e.groups[s]),a.add(l);return a.scale.copy(i),a.setRotationFromQuaternion(o),a.position.copy(t),a},i.prototype.instanceChildOfGroup=function(e){var t=this.app.modelResource.bundleIDArray[e.model].uri;t||(t=this.app.modelResource.bundleIDArray[e.model].id);var r=this.app.modelResource.get(t).node.clone();if(e.scale){var i=e.scale;r.scale.x=i[0],r.scale.y=i[1],r.scale.z=i[2]}if(e.rotation){i=e.rotation;var n=new THREE.Quaternion;n.x=i[0],n.y=i[1],n.z=-i[2],n.w=-i[3],r.setRotationFromQuaternion(n)}return e.position&&(i=e.position,r.position.x=i[0],r.position.y=i[1],r.position.z=-i[2]),r},i.prototype.parseThings=function(e,t,r){for(var i in e){var n=e[i];(n.name||n.properties||n.type)&&this.createThing(n,t,r)}},i.prototype.createThing=function(e,t,r){var i,n,o,a=3<arguments.length&&void 0!==arguments[3]?arguments[3]:"Thing";e.id&&(i=e.id);var s=e.type||a;e.name&&(n=e.name);var l=e.properties;if(l)for(var c in o={},l){var u=l[c];o[c]=u}var h=this.app.modelResource.bundleIDArray[e.model].uri;h||(h=this.app.modelResource.bundleIDArray[e.model].id);var p=this.app.modelResource.get(h).node.clone(),d=this.app.modelResource.get(h).animations;if(e.position){var f=e.position,m=new THREE.Vector3(f[0],f[1],-f[2]);p.position.x=m.x,p.position.y=m.y,p.position.z=m.z}if(e.rotation){var g=e.rotation,v=new THREE.Quaternion;v.x=g[0],v.y=g[1],v.z=-g[2],v.w=-g[3],p.setRotationFromQuaternion(v)}if(e.scale){var y=e.scale,b=new THREE.Vector3;b.x=y[0],b.y=y[1],b.z=y[2],p.scale.x=b.x,p.scale.y=b.y,p.scale.z=b.z}var x=e.isShown;if(x){var E="false"!==(x=x.toLowerCase());p.visible=E}return this.app.objectManager.create({type:s,id:i,name:n,node:p,parent:t,animations:d,properties:o})},i.prototype.parseStructureThing=function(e,t,r){for(var i in e){var n=e[i];if(n.gltfid){var o=new Se(this.app);o.name=i,o.app=this.app,n.id&&(o.id=n.id),n.name&&(o.name=n.name);var a=n.gltfid;if(this.nodes[a]){var s=this.nodes[a];t.node.add(s),o.node=s,t.add(o),r&&(s.position.x=r.x,s.position.y=r.y,s.position.z=r.z)}}}},i.prototype.delayLoadFloorPlan=function(c){var e=Zt.mark(t),r=this;function t(o){var a,s,l;return Zt.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:a=r.loadSpeed,s=10,l=0;case 3:if(l<o.length)return e.next=6,new Promise(function(e,t){var r=performance.now();o[l].build();var i=o[l].combineMesh;c.miscNode.add(i);var n=performance.now()-r;a<n?setTimeout(function(){e()},s):e()});e.next=9;break;case 6:l++,e.next=3;break;case 9:case"end":return e.stop()}},e,this)}var i=null,n=null;return c.isLoaded||(i=this.combineManager.processorMap.get(c),n=t(i)),new Promise(function(e,t){n?r._nestingLoopYield(n,function(){c.isLoaded=!0,e()},function(e){t(e)}):c.isLoaded?console.warn("floorplan "+c.id+" has been loaded!"):t()})},i}(),er=function(r){function i(e,t){return y(this,i),p(this,r.call(this,e,t))}return u(i,r),i.prototype.parseDoorWins=function(e,t,r){for(var i in new THREE.Group("doors"),e){var n=e[i];n.type||(n.type="Door"),this.createThing(n,t,r)}},i}($t),tr=function(){function t(e){y(this,t),this.app=e,this.nodes=[],this.scene=this.app.scene,this.objectPool=this.app.objectPool,this.rootNode=null,this.campus=null,this.sceneURL=null,this.sceneJsonData=null,this.loadedSceneGLTF=null,this.worldNode=new THREE.Object3D,this.fitCamInfo=null}return t.prototype.parse=function(e){for(var t in e)if("objects"==t){var r=e.objects;for(var i in r){var n=r[i];this.parseWorld(n);break}}else if("camInfo"==t){var o=e[t];this.fitCamInfo=o}else console.log("unkown other parser: "+t)},t.prototype.parseCamInfo=function(e){var t=e.eye,r=e.target,i=t.split(" "),n=r.split(" "),o=[Number(i[0]),Number(i[1]),Number(i[2])];o[2]=-o[2];var a=[Number(n[0]),Number(n[1]),Number(n[2])];a[2]=-a[2],this.app.camera.position=o,this.app.camera.target=a},t.prototype.parseWorld=function(e){var t=this.worldNode;if(null==this.campus&&(this.campus=this.app.objectManager.create({type:"Campus",name:"Campus",node:t}),this.campus.node.name="campus",this.app.scene.add(this.campus.node)),e.plan&&this.parseOutdoors(e.plan),e.bds){var r=e.bds;this.parseBuildings(r)}},t.prototype.parseOutdoors=function(e){var t=null;for(var r in e){t=e[r];break}var i=new THREE.Object3D;this.outdoors=this.app.objectManager.create({type:"Outdoors",name:"Outdoors",parent:this.campus,node:i});var n=this.outdoors,o=t.gltfid;if(o&&this.nodes[o]){var a=this.nodes[o];THREE.SceneUtils.detach(a,a.parent,this.app.scene),THREE.SceneUtils.attach(a,this.app.scene,n.node),n.node.updateMatrixWorld()}this.parseFloorPlan(t,n)},t.prototype.parseBuildings=function(e){for(var t in e){var r=e[t],i=null;if(r.gltfid){var n=r.gltfid;this.nodes[n]&&(i=this.nodes[n])}var o=this.app.objectManager.create({type:"Building",name:t,parent:this.campus,node:i});r.plans&&this.parseFloorPlans(r.plans,o),r.facades&&this.parseFacades(r.facades,o)}},t.prototype.parseFloorPlans=function(e,t){for(var r in e){var i=null,n=e[r],o=n.gltfid;o&&this.nodes[o]&&(i=this.nodes[o]);var a=this.app.objectManager.create({type:"Floor",name:r,node:i,parent:t});this.parseFloorPlan(n,a)}},t.prototype.parseFloorPlan=function(e,t){e.plcs&&this.parseThings(e.plcs,t),e.vps&&this.parseThings(e.vps,t),e.dws&&this.parseDoorWins(e.dws,t),e.routes&&this.parseThings(e.routes,t),e.pipelines&&this.parseThings(e.pipelines,t),e.curvelines&&this.parseThings(e.curvelines,t),e.arrowlines&&this.parseThings(e.arrowlines,t),e.arrowdatalines&&this.parseThings(e.arrowdatalines,t),e.leakwaterlines&&this.parseThings(e.leakwaterlines,t);var r=e.cplcs;if(r)for(var i in r){var n=r[i].gltfid,o=this.nodes[n];if(o){t.miscNode=o.parent;break}}var a=e.cwalls;if(a)for(var i in a){n=a[i].gltfid;var s=this.nodes[n];if(s){t.wallNode=s.parent;break}}var l=e.croofs;if(l)for(var i in l){n=l[i].gltfid;var c=this.nodes[n];if(c){t.roofNode=c.parent;break}}var u=e.cceilings;if(u)for(var i in u){n=u[i].gltfid;var h=this.nodes[n];if(h){t.ceilingNode=h.parent;break}}if(p=e.cfloors)for(var i in p){var p;if(n=(p=p[i]).gltfid){var d=this.nodes[n];if(d){t.floorNode=d.parent;break}}}var f=e.groups;f&&this.parseGroup(f,t)},t.prototype.parseGroup=function(e,t){for(var r in e){var i=e[r],n=r;i.uid&&(n=i.uid);var o=i.type||"Thing",a=null,s=i.gltfid;s&&this.nodes[s]&&(a=this.nodes[s]);var l=null,c=i.prop;if(c)for(var u in l={},c){var h=c[u];l[u]=h}this.app.objectManager.create({type:o,name:n,node:a,parent:t,properties:l}),i.plcs&&this.parseThings(i.plcs,t)}},t.prototype.parseFacades=function(e,t){for(var r in e){var i=e[r],n=r;i.uid&&(n=i.uid);var o=null,a=i.gltfid;a&&this.nodes[a]&&(o=this.nodes[a]);var s=null,l=i.prop;if(l)for(var c in s={},l){var u=l[c];s[c]=u}var h=i.isShown;if(h){var p="false"!==(h=h.toLowerCase());o.visible=p}this.app.objectManager.create({type:"Facade",name:n,node:o,parent:t,properties:s}),t.node.add(o)}},t.prototype.parseThings=function(e,t){for(var r in e){var i=e[r],n=r;i.uid&&(n=i.uid);var o=null,a=i.gltfid;a&&this.nodes[a]&&(o=this.nodes[a]);var s=null,l=i.prop;if(l)for(var c in s={},l){var u=l[c];s[c]=u}var h=i.isShown;if(h){var p="false"!==(h=h.toLowerCase());o.visible=p}this.app.objectManager.create({type:"Thing",name:n,node:o,parent:t,properties:s})}},t.prototype.parseDoorWins=function(e,t){for(var r in e){var i=e[r],n=r;i.uid&&(n=i.uid);var o=null;if(i.gltfid){var a=i.gltfid;this.nodes[a]&&(o=this.nodes[a])}var s=null;if(i.prop){var l=i.prop;for(var c in s={},l){var u=l[c];s[c]=u}}this.app.objectManager.create({type:"Door",name:n,node:o,parent:t,properties:s})}},t.prototype.load=function(e){var r=this;return this.sceneURL=e,new Promise(function(t,e){r.loadGLTF().then(function(e){return(r.loadedSceneGLTF=e).scene.traverse(function(e){r.nodes[e.name]=e}),r.parseSceneJson()}).then(function(e){r.fitCamInfo?r.parseCamInfo(r.fitCamInfo):r.campus.node&&r.app.camera.fit(r.campus),t(r.campus)}).catch(function(){r.campus.node.add(r.loadedSceneGLTF.scene.children[0]),r.campus&&r.app.camera.fit(r.campus),t(r.campus)})})},t.prototype.loadGLTF=function(){var i=this;return new Promise(function(t,e){var r=new THREE.GLTFLoader(i.app.loadingManager);r.setCrossOrigin("anonymous"),r.load(i.sceneURL+"/Unity2GLTF.gltf",function(e){t(e)})})},t.prototype.parseSceneJson=function(){var l=this;return new Promise(function(s,e){new THREE.FileLoader(l.app.loadingManager).load(l.sceneURL+"/scene.json",function(e){var t=JSON.parse(e);for(var r in l.sceneJsonData=t)if("objects"==r){var i=t.objects;for(var n in i){var o=i[n];l.parseWorld(o);break}}else if("camInfo"==r){var a=t[r];l.fitCamInfo=a}else console.log("unkown other parser: "+r);s(t)},function(){},function(){console.error("not find file scene.json "),e()})})},t}(),rr=function(){function i(e,t){if(y(this,i),this.app=e,this.resourceUrl=null,this.relativeResourceUrl=null,this.sceneJson=null,this.scale=1,this.curFloorPlan=null,this.tempTexture=null,this.indexJson=t,this.sceneJsonUri="scene.json",this.defaultWallTextureUri="Textures/RoomWall.jpg",this.defaultWallEdgeTextureUri="Textures/WallEdge.jpg",this.defaultFloorTextureUri="Textures/FloorDefault.jpg",this.defaultCeilingTextureUri="Textures/CeilingDefault.jpg",this.defaultRoofTextureUri="Textures/RoofDefault.jpg",this.defaultWallTexture=null,this.defaultCeilingTexture=null,this.defaultFloorTexture=null,this.defaultRoofTexture=null,this.defaultWallEdgeTexture=null,this.worldNode=new THREE.Object3D("world"),this.isCamFitScene=!0,this.campus=null,this.outdoorsVisible=!0,this.campusVisible=!0,this.enableUseHighestVersionResource=!0,this.enableDownloadSceneJsonCache=!0,this.worldNode,t&&(t.position&&(this.campusPosition=t.position),t.rotation&&(this.campusRotation=t.rotation),void 0!==t.isCamFitScene&&null!==t.isCamFitScene&&(this.isCamFitScene=t.isCamFitScene),t.scale&&(this.campusScale=t.scale),void 0!==t.outdoorsVisible&&(this.outdoorsVisible=t.outdoorsVisible),void 0!==t.campusVisible&&(this.campusVisible=t.campusVisible),t.campus&&(this.campus=t.campus),void 0!==t.enableUseHighestVersionResource&&(this.enableUseHighestVersionResource=t.enableUseHighestVersionResource,json2mesh.DefaultSetting.enableUseHighestVersionResource=this.enableUseHighestVersionResource),void 0!==t.enableDownloadSceneJsonCache&&(this.enableDownloadSceneJsonCache=t.enableDownloadSceneJsonCache)),this.campus&&(this.campusRotation&&this.campus.node.quaternion.set(this.campusRotation.x,this.campusRotation.y,this.campusRotation.z,this.campusRotation.w),this.campusPosition&&(this.campus.position=this.campusPosition),this.campusScale&&(this.campus.scale=this.campusScale)),t.default){var r=t.default;r.sceneJson&&(this.sceneJson="export.json"),r.wallTexture&&(this.defaultWallTextureUri=r.wallTexture),r.wallEdgeTexture&&(this.defaultWallEdgeTextureUri=r.wallEdgeTexture),r.floorTexture&&(this.defaultFloorTextureUri=r.floorTexture),r.ceilingTexture&&(this.defaultCeilingTextureUri=r.ceilingTexture),r.roofTexture&&(this.defaultRoofTextureUri=r.roofTexture)}this.app.options.loaderResourceUrl&&(this.resourceUrl=this.app.options.loaderResourceUrl),null!=this.app.options.enableUseHighestVersionResource&&(this.enableUseHighestVersionResource=this.app.options.enableUseHighestVersionResource,json2mesh.DefaultSetting.enableUseHighestVersionResource=this.enableUseHighestVersionResource),this.app.options.resourceLibraryUrl&&(this.resourceUrl=this.app.options.resourceLibraryUrl),this.indexJson.resourceLibrary&&(this.relativeResourceUrl=this.indexJson.resourceLibrary),this.enableDownloadSceneJsonCache||(this.sceneJsonUri+="?_t="+(new Date).getTime())}return i.prototype.parseCamInfo=function(e){var t=e.eye,r=e.target,i=t.split(" "),n=r.split(" "),o=[Number(i[0]),Number(i[1]),Number(i[2])];o[2]=-o[2];var a=[Number(n[0]),Number(n[1]),Number(n[2])];a[2]=-a[2],this.app.camera.position=o,this.app.camera.target=a},i.prototype.exportJsonString=function(e){for(var t=e.outdoors,r=e.buildings,i=[],n=[],o=0;o<t.things.length;o++){var a=t.things[o];i.push({id:a.id,name:a.name})}for(o=0;o<t.rooms.length;o++){var s=t.rooms[o];n.push({id:s.id,name:s.name})}var l=[];for(o=0;o<r.length;o++){for(var c=r[o],u=[],h=0;h<c.floors.length;h++){for(var p=c.floors[h],d=[],f=[],m=0;m<p.things.length;m++){var g=p.things[m];d.push({id:g.id,name:g.name})}for(m=0;m<p.rooms.length;m++)s=p.rooms[m],f.push({id:s.id,name:s.name});u.push({id:p.id,name:p.name,placements:d,rooms:f})}l.push({id:c.id,name:c.name,plans:u})}return{id:e.id,name:e.name,outdoors:{id:t.id,name:t.name,placements:i,rooms:n},buildings:l}},i.prototype.load=function(e){var n=this;return this.sceneURL=e,this.relativeResourceUrl&&(0===this.relativeResourceUrl.indexOf("./")?this.resourceUrl=this.sceneURL+this.relativeResourceUrl.replace("./","/"):this.resourceUrl=this.relativeResourceUrl),new Promise(function(i,e){n.updateProgress(.1),n.loadSceneJson().then(function(e){n.sceneJson=JSON.parse(e),n.sceneJson.camInfo&&n.isCamFitScene&&n.parseCamInfo(n.sceneJson.camInfo),n.updateProgress(.15);var r=new json2mesh.UBuilderSceneDelayLoader;n.resourceUrl&&(r.resourceManager.baseTextureUrl=n.resourceUrl+"/texture/",r.resourceManager.baseModelUrl=n.resourceUrl+"/model/"),(n.loader=r).delayLoad({json:n.sceneJson,customModeBaseUrl:n.sceneURL+"/"}).then(function(e){n.sceneJson.camInfo&&n.isCamFitScene&&n.parseCamInfo(n.sceneJson.camInfo),n.parseWorld(e),n.updateProgress(.2);var t=setInterval(function(){n.updateProgress(.2+.8*r.downloadResourceProgress)},10);r.loadResources().then(function(){n.updateProgress(1),clearInterval(t),i(n.campus)})})})})},i.prototype.loadSceneJson=function(){var r=this;return new Promise(function(t,e){new THREE.FileLoader(r.app.loadingManager).load(r.sceneURL+"/"+r.sceneJsonUri,function(e){t(e)})})},i.prototype.updateProgress=function(e){this.app.mainUI.updateLoadingProcess(e)},i.prototype.createTextureLoaderPromise=function(r){var i=this;return new Promise(function(t,e){(new THREE.TextureLoader).load(i.sceneURL+"/"+r,function(e){t(e)},function(e){console.log(r+" "+e.loaded/e.total*100+"% loaded")},function(e){console.log(r+"load error")})})},i.prototype.loadDefaultTexture=function(){var s=this;return new Promise(function(t,e){var r=s.createTextureLoaderPromise(s.defaultWallTextureUri),i=s.createTextureLoaderPromise(s.defaultWallEdgeTextureUri),n=s.createTextureLoaderPromise(s.defaultFloorTextureUri),o=s.createTextureLoaderPromise(s.defaultRoofTextureUri),a=s.createTextureLoaderPromise(s.defaultCeilingTextureUri);Promise.all([r,i,n,o,a]).then(function(e){DefaultResource.wallTexture=e[0],DefaultResource.wallEdgeTexture=e[1],DefaultResource.floorTexture=e[2],DefaultResource.ceilinngTexture=e[3],DefaultResource.roofTexture=e[4],t()})})},i.prototype.parseWorld=function(e){null===this.campus&&(this.campus=this.app.objectManager.create({uuid:e.id,id:e.userID,type:"Campus",name:"Campus",node:this.worldNode}),this.campus.visible=this.campusVisible,this.campusRotation&&this.campus.node.quaternion.set(this.campusRotation.x,this.campusRotation.y,this.campusRotation.z,this.campusRotation.w),this.campusPosition&&(this.campus.position=this.campusPosition),this.campusScale&&(this.campus.scale=this.campusScale),this.app.scene.add(this.campus.node));for(var t=0;t<e.buildings.length;t++){var r=e.buildings[t];this.parseBuilding(r)}if(e.outdoors){var i=new THREE.Object3D("outdoors");i.name="plan",this.outdoors=this.app.objectManager.create({uuid:e.outdoors.id,id:e.outdoors.userID,type:"Outdoors",name:e.outdoors.name,parent:this.campus,node:i}),this.app.outdoors||(this.app.outdoors=this.outdoors,this.app.currentParentObject=this.outdoors),this.outdoors.visible=this.outdoorsVisible,this.parseFloorPlan(e.outdoors,this.outdoors)}},i.prototype.parseBuilding=function(e){var t=new THREE.Object3D("building");t.name="building";var r=this.app.objectManager.create({uuid:e.id,id:e.userID,type:"Building",name:e.name,parent:this.campus,node:t,properties:e.properties});r.localPosition=e.position;var i=e.floorplans;this.parseFacades(e,r);for(var n=0;n<i.length;n++){var o=i[n],a=new THREE.Object3D("floorplan");a.name="plan";var s=this.app.objectManager.create({id:o.userID,uuid:o.id,type:"Floor",height:o.height,name:o.name,node:a,parent:r});s.localPosition=o.position,this.parseFloorPlan(o,s),0!==r.facades.length&&(s.node.visible=!1)}},i.prototype.parseFacades=function(e,t){var r=this.getFacadeRelation(e);if(r.children&&r.facades){var i=r.children,n=r.facades,o=this.createFacade(n,t);this.createFacadeChildren(i,o)}},i.prototype.getFacadeRelation=function(e){var t=e.facades,r=e.facadeGroups;if(0===t.length&&0===r.length)return{};for(var i=[],n=[],o=0;o<t.length;o++){var a=t[o];this.isFacadeShouldBeChild(a)?i.push(a):n.push(a)}for(var s=0;s<r.length;s++){var l=r[s];this.isFacadeShouldBeChild(l)?i.push(l):n.push(l)}return{facades:n,children:i}},i.prototype.isFacadeShouldBeChild=function(e){return!this.isNullOrUndefined(e.name)||!this.isNullOrUndefined(e.userID)||!this.isNullOrUndefined(e.properties)},i.prototype.isNullOrUndefined=function(e){return null==e},i.prototype.createFacade=function(e,t){for(var r=new THREE.Object3D,i=0;i<e.length;i++){var n=e[i];r.add(n.delayObject)}return this.app.objectManager.create({uuid:THING.Math.generateUUID(),type:"Facade",node:r,parent:t})},i.prototype.createFacadeChildren=function(e,t){for(var r=0;r<e.length;r++){var i=e[r];this.app.objectManager.create({type:"Thing",uuid:i.id,id:i.userID,name:i.name,node:i.delayObject,parent:t,properties:i.properties})}},i.prototype.placementInitCallback=function(e){this.app.objectManager.create({id:e.id,name:e.name,node:e.mesh,parent:plan,animations:e.resource.animations,properties:e.properties})},i.prototype.parseOutdoors=function(e){},i.prototype.parseFloorPlan=function(e,o){for(var t=0;t<e.walls.length;t++)for(var r=e.walls[t],i=0;i<r.doorOrWindows.length;i++){var n=r.doorOrWindows[i],a="Door";if(n.isWindow&&(a="Thing"),n.jsonData&&n.jsonData.type&&(a=n.jsonData.type),n.mesh){var s=this.app.objectManager.create({type:a,uuid:n.id,id:n.userID,name:n.name,node:n.delayObject,parent:o,initBoxSize:[n.size.x,n.size.y,n.size.z],animations:n.resource.animations,properties:n.properties});if(!n.isWindow&&n.isOpen&&s.open(),s.animationClips)for(i=0;i<s.animationClips.length;i++){var l=s.animationClips[i];if("_defaultAnim_"===l.name){s.playAnimation({name:l.name,loop:!0,speed:.15});break}}}else n.initCompleteCallback=function(e){var t="Door";e.isWindow&&(t="Thing"),e.jsonData&&e.jsonData.type&&(t=e.jsonData.type);var r=w.app.objectManager.create({type:t,uuid:e.id,id:e.userID,name:e.name,node:e.mesh,parent:o,initBoxSize:[e.size.x,e.size.y,e.size.z],animations:e.resource.animations,properties:e.properties});if(!e.isWindow&&e.isOpen&&r.open(),r.animationClips)for(var i=0;i<r.animationClips.length;i++){var n=r.animationClips[i];if("_defaultAnim_"===n.name){r.playAnimation({name:n.name,loop:!0,speed:.15});break}}}}var c=new THREE.Object3D("combineFloor");for(t=0;t<e.combineFloors.length;t++){var u=e.combineFloors[t];c.add(u)}o.node.add(c),o.floorNode=c;var h=new THREE.Object3D("combineCeiling");for(t=0;t<e.combineCeilings.length;t++){var p=e.combineCeilings[t];h.add(p)}o.node.add(h),o.ceilingNode=h;var d=new THREE.Object3D("combineRoof");for(t=0;t<e.combineRoofs.length;t++){var f=e.combineRoofs[t];d.add(f)}o.node.add(d),o.roofNode=d;var m=new THREE.Object3D("combinePlacement");for(t=0;t<e.combinePlacements.length;t++){var g=e.combinePlacements[t];m.add(g)}o.node.add(m),o.miscNode=m;var v=new THREE.Object3D("combineWall"),y=new THREE.Object3D("manualWalls");y.isModelWall=!1;var b=new THREE.Object3D("modelWalls");b.isModelWall=!0;var x=new THREE.Object3D("doororwins");v.add(y),v.add(b),o.miscNode.add(x);for(var E=0;E<e.combineStraightManualWalls.length;E++)r=e.combineStraightManualWalls[E],y.add(r);for(E=0;E<e.combineModelWalls.length;E++)r=e.combineModelWalls[E],b.add(r);for(E=0;E<e.combineDoorOrWins.length;E++)g=e.combineDoorOrWins[E],x.add(g);for(o.node.add(v),o.wallNode=v,t=0;t<e.groups.length;t++){g=e.groups[t];var _="Thing";g.jsonData&&g.jsonData.type&&(_=g.jsonData.type),s=this.app.objectManager.create({uuid:g.id,id:g.userID,name:g.name,node:g.delayObject,belongRoomUserID:g.belongRoomUserID,type:_,hideByScene:!g.isShow,parent:o,properties:g.properties})}var w=this;for(t=0;t<e.placements.length;t++)if(g=e.placements[t],_="Thing",g.jsonData&&g.jsonData.type&&(_=g.jsonData.type),g.mesh){if((s=this.app.objectManager.create({uuid:g.id,id:g.userID,name:g.name,type:_,node:g.delayObject,parent:o,belongRoomUserID:g.belongRoomUserID,hideByScene:!g.isShow,url:g.resource.getModelUrl(),animations:g.resource.animations,initBoxSize:[g.size.x,g.size.y,g.size.z],properties:g.properties})).bundleID=g.resource.modelID,s.bundleName=g.resource.modelName,g.isPlayAnim&&s.containAnimation(g.animClip)){var T={name:g.animClip,loop:!1,speed:.15};g.hasSkin&&(T.loop=!0),s.playAnimation(T)}}else g.initCompleteCallback=function(e){_="Thing",e.jsonData&&e.jsonData.type&&(_=e.jsonData.type);var t=w.app.objectManager.create({uuid:e.id,id:e.userID,name:e.name,node:e.mesh,parent:o,belongRoomUserID:e.belongRoomUserID,hideByScene:!e.isShow,type:_,initBoxSize:[e.size.x,e.size.y,e.size.z],url:e.resource.getModelUrl(),animations:e.resource.animations,properties:e.properties});if(t.bundleID=e.resource.modelID,t.bundleName=e.resource.modelName,e.isPlayAnim&&t.containAnimation(e.animClip)){var r={name:e.animClip,loop:!1,speed:.15};e.hasSkin&&(r.loop=!0),t.playAnimation(r)}};for(t=0;t<e.videoprobes.length;t++)(g=e.videoprobes[t]).mesh?s=this.app.objectManager.create({id:g.userID,name:g.name,uuid:g.id,node:g.delayObject,belongRoomUserID:g.belongRoomUserID,parent:o,hideByScene:!g.isShow,url:g.resource.getModelUrl(),animations:g.resource.animations,initBoxSize:[g.size.x,g.size.y,g.size.z],properties:g.properties}):g.initCompleteCallback=function(e){w.app.objectManager.create({id:e.userID,name:e.name,uuid:e.id,node:e.mesh,belongRoomUserID:e.belongRoomUserID,parent:o,hideByScene:!e.isShow,initBoxSize:[e.size.x,e.size.y,e.size.z],url:e.resource.getModelUrl(),animations:e.resource.animations,properties:e.properties})};for(t=0;t<e.rooms.length;t++){var M=e.rooms[t];u=this.app.objectManager.create({type:"Room",name:M.name,node:M.mesh,uuid:M.id,id:M.userID,ceilingNode:M.ceiling.mesh,roofNode:M.roof.mesh,floorNode:M.floor.mesh,parent:o,properties:M.properties})}for(t=0;t<e.curvelines.length;t++){var S=e.curvelines[t];this.parseCurveLines(S,o)}for(t=0;t<e.pipelines.length;t++)S=e.pipelines[t],this.parsePipeLines(S,o)},i.prototype.parsePipeLines=function(r,e){for(var t=[],i=0;i<r.points.length;i++){var n=r.points[i].clone();n.add(r.position),t.push(n)}var o={type:"PolygonLine",name:r.name,points:t,id:r.userID,uuid:r.id,parent:e,spaceType:THING.SpaceType.Local,style:{}};r.color&&(o.style.color="#"+r.color.getHexString());var a=this;if(r.resource)r.initCompleteCallback=function(e){o.image=e.resource.getTextureUrl();var t=a.app.objectManager.create(o);r.sectionType&&"Triangle"===r.sectionType&&(t.pathRadialSegments=3,t._updateByPoints()),r.radius&&(t.width=r.radius)};else{var s=a.app.objectManager.create(o);r.sectionType&&"Triangle"===r.sectionType&&(s.pathRadialSegments=3,s._updateByPoints()),r.radius&&(s.width=r.radius)}},i.prototype.parseCurveLines=function(i,e){var n={type:"RouteLine",parent:e,name:i.name,uuid:i.id,id:i.userID,points:i.points,arrowFlag:!1,spaceType:THING.SpaceType.Local,style:{}},o=this;if(i.color&&(n.style.color="#"+i.color.getHexString()),i.resource)i.initCompleteCallback=function(e){if(e.resource.texture){var t=e.resource.texture.clone();t.rotation=-Math.PI/2,n.image=t}var r=o.app.objectManager.create(n);null!==i.width&&(r.width=i.width),r.node.position.set(i.position.x,i.position.y,i.position.z)};else{var t=o.app.objectManager.create(n);null!==i.width&&(t.width=i.width),t.node.position.set(i.position.x,i.position.y,i.position.z)}},i}(),ir=function(){function t(e){y(this,t),this.app=e,this.nodes=[],this.scene=this.app.scene,this.objectPool=this.app.objectPool,this.rootNode=null,this.campus=null,this.sceneURL=null,this.sceneJsonData=null,this.loadedSceneGLTF=null,this.worldNode=new THREE.Object3D,this.fitCamInfo=null}return t.prototype.parse=function(e){if(this.parseWorld(e),e.camInfo){var t=e.camInfo;this.fitCamInfo=t}},t.prototype.parseCamInfo=function(e){var t=e.eye,r=e.target,i=t.split(" "),n=r.split(" "),o=[Number(i[0]),Number(i[1]),Number(i[2])];o[2]=-o[2];var a=[Number(n[0]),Number(n[1]),Number(n[2])];a[2]=-a[2],this.app.camera.position=o,this.app.camera.target=a},t.prototype.parseWorld=function(e){var t=this.worldNode;if(null==this.campus&&(this.campus=this.app.objectManager.create({type:"Campus",name:"Campus",node:t}),this.campus.node.name="campus",this.app.scene.add(this.campus.node)),e.outdoors&&this.parseOutdoors(e.outdoors),e.buildings){var r=e.buildings;this.parseBuildings(r)}},t.prototype.parseOutdoors=function(e){var t=e,r=new THREE.Object3D;this.outdoors=this.app.objectManager.create({type:"Outdoors",name:"Outdoors",parent:this.campus,node:r});var i=this.outdoors;this.app.outdoors||(this.app.outdoors=this.outdoors,this.app.currentParentObject=this.outdoors);var n=t.gltfid;if(n&&this.nodes[n]){var o=this.nodes[n];THREE.SceneUtils.detach(o,o.parent,this.app.scene),THREE.SceneUtils.attach(o,this.app.scene,i.node),i.node.updateMatrixWorld()}this.parseFloorPlan(t,i)},t.prototype.parseBuildings=function(e){for(var t in e){var r=e[t],i=t;r.name&&(i=r.name);var n=null;if(r.gltfid){var o=r.gltfid;this.nodes[o]&&(n=this.nodes[o])}var a=this.app.objectManager.create({type:"Building",name:i,parent:this.campus,node:n});r.plans&&this.parseFloorPlans(r.plans,a),r.facades&&this.parseFacades(r.facades,a)}},t.prototype.parseFloorPlans=function(e,t){for(var r in e){var i=null,n=e[r],o=r;n.name&&(o=n.name);var a=n.gltfid;a&&this.nodes[a]&&(i=this.nodes[a]);var s=this.app.objectManager.create({type:"Floor",name:o,node:i,parent:t});this.parseFloorPlan(n,s)}},t.prototype.parseFloorPlan=function(e,t){e.placements&&this.parseThings(e.placements,t),e.videoprobes&&this.parseThings(e.videoprobes,t),e.doororwindows&&this.parseDoorWins(e.doororwindows,t),e.routes&&this.parseThings(e.routes,t),e.pipelines&&this.parseThings(e.pipelines,t),e.curvelines&&this.parseThings(e.curvelines,t),e.arrowlines&&this.parseThings(e.arrowlines,t),e.arrowdatalines&&this.parseThings(e.arrowdatalines,t),e.leakwaterlines&&this.parseThings(e.leakwaterlines,t),e.rooms&&this.parseRooms(e.rooms,t),this.parseStructure(e,t);var r=e.groups;r&&this.parseGroup(r,t)},t.prototype.parseRooms=function(e,t){for(var r=0;r<e.length;r++){var i=e[r],n=null;i.name&&(n=i.name);var o=null,a=i.gltfid;a&&this.nodes[a]&&(o=this.nodes[a]);var s=null,l=i.properties;if(l)for(var c in s={},l){var u=l[c];s[c]=u}var h=null,p=null,d=null;i.floor&&(a=i.floor.gltfid,this.nodes[a]&&(d=this.nodes[a])),i.ceiling&&(a=i.ceiling.gltfid,this.nodes[a]&&(h=this.nodes[a])),i.roof&&(a=i.roof.gltfid,this.nodes[a]&&(p=this.nodes[a]));var f=null,m=null,g=null,v={};if(i.area&&(m=i.area,v.area=m),i.circumference&&(g=i.circumference,v.circumference=g),i.center){var y=i.center;(f=new THREE.Vector3).set(y[0],y[1],-y[2]),v.center=f}var b=i.isShown;if(b){var x="false"!==(b=b.toLowerCase());o.visible=x}this.app.objectManager.create({type:"Room",name:n,node:o,ceilingNode:h,roofNode:p,floorNode:d,parent:t,properties:s,auxiliaryInfo:v})}},t.prototype.parseStructure=function(e,t){if(e.structure){var r=(e=e.structure).placements;if(r)for(var i in r){var n=r[i].gltfid,o=this.nodes[n];if(o){t.miscNode=o.parent;break}}var a=e.walls;if(a)for(var i in a){n=a[i].gltfid;var s=this.nodes[n];if(s){t.wallNode=s.parent;break}}var l=e.roofs;if(l)for(var i in l){n=l[i].gltfid;var c=this.nodes[n];if(c){t.roofNode=c.parent;break}}var u=e.ceilings;if(u)for(var i in u){n=u[i].gltfid;var h=this.nodes[n];if(h){t.ceilingNode=h.parent;break}}if(p=e.floors)for(var i in p){var p;if(n=(p=p[i]).gltfid){var d=this.nodes[n];if(d){t.floorNode=d.parent;break}}}}},t.prototype.parseGroup=function(e,t){for(var r in e){var i=e[r],n=r;i.name&&(n=i.name);var o=null,a=i.gltfid;a&&this.nodes[a]&&(o=this.nodes[a]);var s=null,l=i.properties;if(l)for(var c in s={},l){var u=l[c];s[c]=u}this.app.objectManager.create({type:"Thing",name:n,node:o,parent:t,properties:s}),i.placements&&this.parseThings(i.placements,t)}},t.prototype.parseFacades=function(e,t){for(var r in e){var i=e[r],n=r;i.name&&(n=i.name);var o=null,a=i.gltfid;a&&this.nodes[a]&&(o=this.nodes[a]);var s=null,l=i.properties;if(l)for(var c in s={},l){var u=l[c];s[c]=u}var h=i.isShown;if(h){var p="false"!==(h=h.toLowerCase());o.visible=p}this.app.objectManager.create({type:"Facade",name:n,node:o,parent:t,properties:s}),t.node.add(o)}},t.prototype.parseThings=function(e,t){for(var r in e){var i=e[r],n=i.name||r,o=i.type||"Thing",a=null,s=i.gltfid;s&&this.nodes[s]&&(a=this.nodes[s]);var l=null,c=i.properties;if(c)for(var u in l={},c){var h=c[u];l[u]=h}var p=i.isShown;if(p){var d="false"!==(p=p.toLowerCase());a.visible=d}this.app.objectManager.create({type:o,name:n,node:a,parent:t,properties:l})}},t.prototype.parseDoorWins=function(e,t){for(var r in e){var i=e[r],n=r;i.name&&(n=i.name);var o=null;if(i.gltfid){var a=i.gltfid;this.nodes[a]&&(o=this.nodes[a])}var s=null;if(i.properties){var l=i.properties;for(var c in s={},l){var u=l[c];s[c]=u}}this.app.objectManager.create({type:"Door",name:n,node:o,parent:t,properties:s})}},t.prototype.load=function(e){var r=this;return this.sceneURL=e,new Promise(function(t,e){r.loadGLTF().then(function(e){return(r.loadedSceneGLTF=e).scene.traverse(function(e){r.nodes[e.name]=e}),r.parseSceneJson()}).then(function(e){r.fitCamInfo?r.parseCamInfo(r.fitCamInfo):r.campus.node&&r.app.camera.fit(r.campus),t(r.campus)}).catch(function(){r.campus.node.add(r.loadedSceneGLTF.scene.children[0]),r.campus&&r.app.camera.fit(r.campus),t(r.campus)})})},t.prototype.loadGLTF=function(){var i=this;return new Promise(function(t,e){var r=new THREE.GLTFLoader(i.app.loadingManager);r.setCrossOrigin("anonymous"),r.load(i.sceneURL+"/Unity2GLTF.gltf",function(e){t(e)})})},t.prototype.parseSceneJson=function(){var i=this;return new Promise(function(r,e){new THREE.FileLoader(i.app.loadingManager).load(i.sceneURL+"/scene.json",function(e){var t=JSON.parse(e);i.sceneJsonData=t,i.parseWorld(t),r(t)},function(){},function(){console.error("not find file scene.json "),e()})})},t}(),nr=function(){function t(e){y(this,t),this.app=e,this.supportVersion={1:1,2:1,3:0},this.versionLib={1:{0:{0:tr},1:{0:ir}},2:{0:{0:Kt},1:{0:$t,1:er}},3:{0:{0:rr,1:rr}}}}return t.prototype.getLoader=function(e){if(e){var t=e.version,r=0,i=0,n=0;if(t){var o=t.split(".");r=parseInt(o[0]),i=parseInt(o[1]),n=parseInt(o[2])}var a=null,s=this.versionLib[r];if(s){var l=s[i];l&&(a=l[n])}if(!a)return console.error("can not find right version "+t+" to load scenejson"),null;if(1===r)h=new a(this.app);else if(2===r)switch(i){case 1:var c={},u=e.position;u&&(c.position=u),e.rotation&&(c.rotation=e.rotation),e.campus&&(c.campus=e.campus),c.isCamFitScene=Z.parseValue(e.isCamFitScene,!0),c.isDelayLoadFloorPlan=Z.parseValue(e.isDelayLoadFloorPlan,!1),h=new a(this.app,c);break;default:h=new a(this.app)}else 3===r&&(h=new a(this.app,e));return h}var h=new tr(this.app);return h},t}(),or=function(){function t(e){y(this,t),this.app=e}return t.prototype.load=function(e,t){var r=void 0,i=void 0;null!==e&&(i=Z.isString(e)?r=e:Z.isArray(e)?(r=e[0],e[1]):(r=this.app.skyBoxName||null,null));var n=null,o=null;if(i){var a=this.app.confirmURL(Z.parseCubeTextureUrls(i));a&&(n=(new THREE.CubeTextureLoader).load(a,function(){}))}if(r){var s=this.app.confirmURL(Z.parseCubeTextureUrls(r));s&&(o=(new THREE.CubeTextureLoader).load(s,function(){}))}return{indoorsEnvMap:n,outdoorsEnvMap:o}},t}(),ar=function(h){function r(e){y(this,r);var t=p(this,h.call(this,e));t.name="Campus",t.outdoors=null,t._url="",t._sceneJSONData={},t._envMapResources=null;var l=t;return t.one("beforeload",null,function(e){var t=new or(l.app);l._envMapResources=t.load(l.app.options.env,e.indexJson.resourceLibrary)}),t.one("load",null,function(){if(l.outdoors){var e=l.outdoors.node;e.userData={},e.removeBySelf();var t=l.outdoors.id,r=l.outdoors.uuid,i=l.app.create({type:"Ground",id:t,uuid:r,node:e,parent:l.outdoors.parent});l.outdoors.node=new THREE.Group,l.outdoors.destroy(),l.outdoors=i}l.getEnvMapResources()&&l.query(".Thing || .Facade").forEach(function(e){e.setupEnvMap(e.isFacade)}),l.query(".Building").forEach(function(e){e.setupNavigationObjects()});for(var n=l._getLinkableDoors(),o=0;o<n.length;o++){var a=n[o];if(t=a.userData._Portal_){var s=l.app.query(t)[0];s&&(s.userData._Portal_=a.id)}}}),t}return u(r,h),r.prototype.setupFromURL=function(e){e.isCamFitScene=Z.parseValue(e.isCamFitScene,!1),this._url=this.app.confirmURL(e.url),this.app.campusLoader.load(this,e)},r.prototype.setupFromData=function(o){o.url="./",o.fileloader={load:function(e,t,r,i){var n=o.data[e.getFileName()];n?t&&t(n):i&&i()}},this.setupFromURL(o)},r.prototype.customSetup=function(e){this.setupID(e);var t=e.basePosition,r=e.baseAngles;if(t||r){var i=Z.parseVector3(t,new THREE.Vector3(0,0,0)),n=Z.parseQuaternion(r,new THREE.Quaternion),o=(new THREE.Matrix4).compose(i,n,new THREE.Vector3(1,1,1));this.node.userData._baseMatrix=o;var s=this;THREE.Object3D.prototype.onBeforeUpdateModelViewMatrix=function(e,t,r,i,n,o){var a=function(e){for(var t=e;t;t=t.parent){var r=t.userData._baseMatrix;if(r)return r}return null}(this);if(a&&(this.frustumCulled=!1,this.__matrixWorld=this.__matrixWorld||new THREE.Matrix4,this.__matrixWorld.copy(this.matrixWorld),this.matrixWorld.premultiply(a),!n.isShaderMaterial&&!s.app.camera.frustum.intersectsObject(this)))return null},THREE.Object3D.prototype.onAfterUpdateModelViewMatrix=function(e,t,r,i,n,o){this.__matrixWorld&&this.matrixWorld.copy(this.__matrixWorld)}}},r.prototype.destroy=function(){this._url&&this.app.trigger("unload",{url:this._url}),this._floorNode=null,this.outdoors&&(this.outdoors.destroy(),this.outdoors=null),this.buildings.destroyAll(),this.app.resourceManager.disposeTextures(this._envMapResources),h.prototype.destroy.call(this)},r.prototype._setVisible=function(e){h.prototype._setVisible.call(this,e),this.outdoors&&(this.outdoors.visible=e)},r.prototype._setupNavigationGraph=function(t,r){var i=this;h.prototype._setupNavigationGraph.call(this,t,r);for(var e=this._getLinkableDoors(),n=0;n<e.length;n++){var o=e[n];t[o.id]=t[o.id]||{};for(var a=o._getLinkableObjects(),s=0;s<a.length;s++){var l=a[s];t[l.id]=t[l.id]||{},t[l.id][o.id]=t[o.id][l.id]=r;var c=l.parents.query(".Floor")[0];if(c){var u=c.getRoomFromWorldPosition(l.position);u&&(t[u.id]=t[u.id]||{},t[l.id][u.id]=t[u.id][l.id]=r)}}}this.query(".Building").forEach(function(e){e.query(".Floor").forEach(function(e){e._setupNavigationGraph(t,r)})}),this._queryChild(".Room").forEach(function(e){t[e.id]=t[e.id]||{},t[i.id][e.id]=t[e.id][i.id]=r})},r.prototype.canNavigation=function(){return!0},r.prototype.getNavigationData=function(){var s=this;function e(e,t){e.push(t.min.x),e.push(t.min.z),e.push(t.min.x),e.push(t.max.z),e.push(t.max.x),e.push(t.max.z),e.push(t.max.x),e.push(t.min.z)}function l(e,t){for(var r=0;r<e.length;r++){var i=e[r];if(i.intersectsBox(t))return void i.union(t)}e.push(t)}function c(e,t){if(t!=e){if(t.isBuilding)return!0;if(t.isThing)return!0}return!1}var t=[];e(t,(new THREE.Box3).setFromObject(this.node));for(var r=function(e){for(var t=[],r=e.children,i=0;i<r.length;i++){var n=r[i];if(c(e,n)){var o=(new THREE.Box3).setFromObject(n.node),a=new THREE.Vector3;o.getSize(a),a.equals(new THREE.Vector3)||l(t,o)}}return function(e){for(var t=0;t<e.length;t++)for(var r=e[t],i=t+1;i<e.length;i++)if(r.intersectsBox(e[i])){r.union(e[i]),e.splice(i,1),t=-1;break}for(t=0;t<e.length;t++){var n=e[t],o=s.worldToLocal(n.min.toArray()),a=s.worldToLocal(n.max.toArray());n.min=Z.parseVector3(o),n.max=Z.parseVector3(a)}}(t),t}(this),i=0;i<r.length;i++)e(t,r[i]);var n=[];for(i=0;i<r.length;i++)n.push(4*(n.length+1));return{data:t,holes:n}},r.prototype.getNavigationMesh=function(){var e=this.getNavigationData(),t=EarCut(e.data,e.holes);if(!t)return null;for(var r=[],i=0;i<e.data.length;i+=2)r.push(e.data[i]),r.push(0),r.push(e.data[i+1]);var n=new THREE.BufferGeometry;n.setIndex(t),n.addAttribute("position",new THREE.BufferAttribute(new Float32Array(r),3));var o=new THREE.MeshBasicMaterial({side:THREE.DoubleSide,transparent:!0,opacity:.5});return new THREE.Mesh(n,o)},l(r,[{key:"isCampus",get:function(){return!0}},{key:"envMapResources",get:function(){return this._envMapResources}},{key:"url",get:function(){return this._url}},{key:"floorNode",set:function(e){this._floorNode=e},get:function(){return this._floorNode}},{key:"ground",get:function(){return this.outdoors}},{key:"sceneJSONData",get:function(){return this._sceneJSONData},set:function(e){e=e||{},this._sceneJSONData=e}},{key:"buildings",get:function(){return this.query(".Building",!1)}},{key:"things",get:function(){return this.query(".Thing",!1)}}]),r}(Ee),sr=function(){function r(e){y(this,r),this._major=0,this._minor=0,this._modified=0;var t=e.split(".");this._major=parseInt(1<=t.length?t[0]:0),this._minor=parseInt(2<=t.length?t[1]:0),this._modified=parseInt(3<=t.length?t[2]:0)}return r.prototype.compare=function(e){return Z.isString(e)&&(e=new r(e)),this._major!=e._major?this._major>e._major?1:-1:this._minor!=e._minor?this._minor>e._minor?1:-1:this._modified!=e._modified?this._modified>e._modified?1:-1:0},l(r,[{key:"major",get:function(){return this._major}},{key:"minor",get:function(){return this._minor}},{key:"modified",get:function(){return this._modified}}]),r}(),lr=function(){function r(e){y(this,r),this.app=e,this.waitingLoadCampuses=[],this.loadingCampus=!1,this._loadAllPluginsComplete=!1;var t=this;this.app.one("loadallpluginscomplete",function(){t._loadAllPluginsComplete=!0})}return r.prototype._loadViewPointFile=function(e){var t=this.app.sceneManager,r=Z.parseValue(e.enableDeafultViewPointFile,t.enableDeafultViewPointFile),i=e.defaultViewPointFileName||t.defaultViewPointFileName;if(r&&i){var n=e.url.appendPath(i),o=this;(new THREE.FileLoader).load(n,function(e){o.app.viewPointManger.loadJSON(e)})}},r.prototype._moveToBuilding=function(e,t,r){var i=r.buildings;if(i.length){var n=i[0];e.name=n.name,e.userData=n.userData;for(var o=n.floors,a=0;a<o.length;a++){var s=o[a];e.add(s)}}},r.prototype._moveToCampus=function(e,t,r){var i=e._id;e._id=r._id,e._name=r._name,e._uuid=r._uuid,e.position=r.position,e.angles=r.angles,e.scale=r.scale,e.visible=r.visible,e._sceneJSONData=r._sceneJSONData,e.node=r.node,e._floorNode=r._floorNode,e.outdoors=r.outdoors,e.remove(r);var n=e._children.concat();e._children=[];for(var o=0;o<n.length;o++)e.add(n[o]);if(r.outdoors)for(o=0;o<r.outdoors._children.length;o++)e.add(r.outdoors._children[o]);for(o=0;o<r._children.length;o++){var a=r._children[o];(a._parent=e)._children.push(a)}r._id=i,r.node=new THREE.Group,r._floorNode=null,r.outdoors=null,r._children=[];var s=e.outdoors;if(s){var l=s._children.concat();for(o=0;o<l.length;o++)e.add(l[o])}this.app.objectManager.objects.set(r.queryID,r),this.app.objectManager.objects.set(e.queryID,e),e.node.parent||this.app.scene.add(e.node)},r.prototype._moveFromUBuilder=function(e,t,r,i,n){r.scene&&r.scene.parent===this.app.scene&&this.app.scene.remove(r.scene),e instanceof cr?this._moveToBuilding(e,i,t):e instanceof ar&&this._moveToCampus(e,i,t),t.destroy(),n&&n()},r.prototype._runScript=function(e){var t,r;(t=Z.isString(e)?e:(r=e,c?c.decodeString(r):""))&&X(t)},r.prototype.loadFromUBuilder=function(i,e,n,o,a){var s=this,l=o.position,c=o.rotation||o.angles,t=o.scale,r=Z.parseValue(o.outdoorsVisible||o.visible,!0),u=Z.parseValue(o.campusVisible||o.visible,!0),h=Z.parseValue(o.isCamFitScene,!0),p=Z.parseValue(o.isDelayLoadFloorPlan,!1),d=o.splitLoadSpeed,f=Z.parseValue(o.disableCache,!1);l&&(n.position=l),c&&(n.rotation=Z.parseQuaternion(c)),t&&(n.scale=t),void 0!==r&&(n.outdoorsVisible=r),void 0!==u&&(n.campusVisible=u),n.isCamFitScene=h,n.isDelayLoadFloorPlan=p,n.enableDownloadSceneJsonCache=!f;var m=new nr(this.app).getLoader(n);m.loadSpeed=d;var g=n.camInfo;g&&(m.fitCamInfo=g),this.app.root._staticEnableFlag.enable(!1,!0),m.load(e).then(function(e){var t=m.sceneJson?m.sceneJson:n;if(t){var r=t.camInfo;r&&(r.eye=Z.parseVector3(r.eye),r.eye.z*=-1,r.eye=r.eye.toArray(),r.target=Z.parseVector3(r.target),r.target.z*=-1,r.target=r.target.toArray())}e.sceneJSONData=t,e.position=e.position||l,e.angles=e.angles||c,s._moveFromUBuilder(i,e,m,o,a),s.app.root._staticEnableFlag.resume()})},r.prototype._notifyLoadingProgress=function(e){var t=(e.loadedNumber+e.resourceLoadedNumber)/(e.totalNumber+e.resourceTotalNumber);this.app.mainUI.updateLoadingProcess(t)},r.prototype.updateResourceItemNumber=function(e){e.resourceLoadedNumber++,this._notifyLoadingProgress(e)},r.prototype.updateTotalResourceItemNumber=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1;e.resourceTotalNumber+=t},r.prototype.updateItemNumber=function(t){if(t.loadedNumber++,this._notifyLoadingProgress(t),t.loadedNumber==t.totalNumber){var r=function(){var e=t.complete;e&&e(),t.complete=null},e=t.afterLoadScript;if(e){var i=url.appendPath(e);q(i,function(e){that._runScript(e),r()})}else r()}},r.prototype.updateTotalItemNumber=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1;e.totalNumber+=t},r.prototype.getBundleData=function(e,t){if(Z.isNull(e)||e>=t.length)return!1;var r=t[e],i=r.id;return!!i&&{id:i,url:this.app.confirmModelURL(i),name:r.name,size:r.size}},r.prototype.getTextureData=function(e,t){if(Z.isNull(e)||e>=t.length)return!1;var r=t[e],i=r.id;if(!i)return!1;var n=r.ext;return!!n&&{id:i,url:"https://static.3dmomoda.com/textures/"+i+"."+n,name:r.name}},r.prototype.parseFloorPlan=function(e,t,r,i,n){var o=this,a=r.data.models||[],s=r.data.textures||[];if(e.setupFromData({data:{data:t,res:{models:a,textures:s}},complete:function(){var e=this.internalUserData.edgeShape;e&&(o.app.resourceManager.remove(e,!1,!0),delete this.internalUserData.edgeShape)}}),a){var l=r.data.objects;if(l)for(var c in l){var u=l[c];this.updateTotalItemNumber(i,u.length);for(var h=0;h<u.length;h++){var p=u[h];this.parseThing(e,p,a,s,i,n),this.updateItemNumber(i)}}}},r.prototype.parseFloorPlanByMeshData=function(e,t,r,i){if(e&&t&&t.data){var n=e.internalUserData.height,o=t.data.structure;if(!o)return;o.planheight=n,this.parseFloorPlan(e,o,t,r,i)}},r.prototype.parseFloorPlans=function(e,t,r,i){for(var n=e.buildings,o=0;o<n.length;o++){var a=n[o],s=t[a.id]||null;if(s){if(!this.parseFloorShapes(a,s,r,i))return!1;var l=a.floors;this.updateTotalItemNumber(r,l.length);for(var c=0;c<l.length;c++){var u=l[c],h=s.floors[c];this.parseFloorPlanByMeshData(u,h,r,i),this.updateItemNumber(r)}}}return!0},r.prototype.parseFloorShapes=function(e,t,r,i){var n=t.floors;if(!n)return!1;for(var o=0,a=0;a<n.length;a++){var s,l=n[a],c=l.uuid,u=l.name||c,h=l.height||3,p=new THREE.Color(1,1,1),d=l.outlineData;if(d)(s=this.app.create({type:"Shape",vertices:d,height:1,parent:e})).scale=[1,h,1],s.style.setMaterial({index:0,side:THREE.FrontSide,color:p,opacity:.5,depthTest:!1,depthWrite:!0,transparent:!0}),s.style.setMaterial({index:1,side:THREE.FrontSide,color:p,opacity:.5,depthTest:!1,depthWrite:!0,transparent:!0});else{var f=t.size;(s=this.app.create({type:"Box",width:f[0],height:h,depth:f[2],center:"Bottom",parent:e})).style.setMaterial({side:THREE.FrontSide,color:p,opacity:.5,depthTest:!1,depthWrite:!0,transparent:!0})}s.style.edgeColor=16777215;var m=this.app.create({type:"Floor",name:u,localPosition:[0,o,0],parent:e,visible:!1,uuid:c});m.internalUserData.edgeShape=s.node,m.node.add(s.node),s.style.skipStyle=!0,s.node=new THREE.Group,s.destroy(),o+=m.internalUserData.height=h}return!0},r.prototype.parseBuilding=function(e,t,r,i,n){var o=this,a=Z.cloneObject(t);a.type=t.type,a.parent=e;var s=a.rotation;s&&(s=THING.Utils.parseAngles(new THREE.Quaternion(s[0],s[1],s[2],s[3])),delete a.rotation,(a.angles=s)[0]=Z.parseValue(s[0],0),s[1]=Z.parseValue(s[1],0),s[2]=Z.parseValue(s[2],0)),a.scale&&delete a.scale;var l=this.app.create(a),c=a.facades;if(c)for(var u=0;u<c.length;u++){var h=c[u],p=h.model;null!=p&&(r=this.getBundleData(p,r))&&(h.url=r.url,h.parent=l,h.complete=function(){o.updateItemNumber(n)},this.updateTotalItemNumber(n,1),this.app.create(h))}return!0},r.prototype.parseFloorDoor=function(e,t,r){var i=this,n=t.key.split("_"),o=t.suspendpercent?3*t.suspendpercent:0,a=[.01*t.pos[0],o,.01*t.pos[1]],s={uuid:n[1],type:"Door",url:this.app.confirmModelURL(t.typeId),localPosition:a,parent:e,complete:function(){this.scale=[.01*t.width/this.boundingBox.initSize[0],.01*t.height/this.boundingBox.initSize[1],1],this.angles=[0,-t.rotation,0],i.updateItemNumber(r)}};this.app.create(s)},r.prototype.parseThing=function(e,t,r,i,n){var o=this;if(!(r=this.getBundleData(t.model,r)))return!1;var a=Z.cloneObject(t);a.url=r.url,a.type=t.type,a.parent=e;var s=a.complete;a.complete=function(){s&&s(),o.updateResourceItemNumber(n)},a.position&&(a.localPosition=a.position,delete a.position);var l=a.rotation;l&&(l=THING.Utils.parseAngles(new THREE.Quaternion(l[0],l[1],l[2],l[3])),delete a.rotation,(a.angles=l)[0]=Z.parseValue(l[0],0),l[1]=Z.parseValue(l[1],0),l[2]=Z.parseValue(l[2],0));var c=a.scale;return c&&(c[0]=c[0]||1,c[1]=c[1]||1,c[2]=c[2]||1),this.updateTotalResourceItemNumber(n,1),this.app.create(a),!0},r.prototype.parseFence=function(e,t,r,i,n,o){var a=this,s=this.getBundleData(t.model,r);if(!s)return!1;var l=Z.cloneObject(t);l.url=s.url,l.type=t.type,l.parent=e;var c=o[l.start];if(c){l.startPoint=c;var u=o[l.end];if(u){l.endPoint=u;var h=l.control;if(void 0!==h){var p=o[h];if(!(l.controlPoint=p))return}var d=l.doors;if(d){this.updateTotalResourceItemNumber(n,d.length);for(var f=[],m=0;m<d.length;m++){var g=d[m],v=g.position;delete g.position,g.localPosition=v;var y=this.getBundleData(g.model,r);delete g.model;var b=new THREE.Vector2(l.startPoint[0],l.startPoint[1]),x=new THREE.Vector2(l.endPoint[0],l.endPoint[1]),E=x.clone().sub(b).normalize().angle();g.angles=[0,180*-E/Math.PI,0];var _=new THREE.Vector2(v[0],v[2]),w=b.distanceTo(_)/b.distanceTo(x);g.url=y.url,g.complete=function(){a.updateResourceItemNumber(n)},g.parent=e;var T=this.app.create(g),M=y.size[0]*T.scale[0];f.push({width:M,percent:w})}l.doors=f}var S=l.complete;l.complete=function(){S&&S(),a.updateResourceItemNumber(n)},l.localPosition&&l.position&&delete l.position;var R=l.angles;R&&(R[0]=Z.parseValue(R[0],0),R[1]=Z.parseValue(R[1],0),R[2]=Z.parseValue(R[2],0));var P=l.scale;return P&&(P[0]=P[0]||1,P[1]=P[1]||1,P[2]=P[2]||1),this.updateTotalResourceItemNumber(n,1),this.app.create(l),!0}}},r.prototype.parseRegion=function(e,t,r,i,n,o){var a=this,s=this.getTextureData(t.texture,i);if(s){var l=Z.cloneObject(t);l.type=t.type,l.parent=e,l.url=s.url;var c=l.points;if(c)for(var u=0;u<c.length;u++){var h=o[c[u].pos];if(!h)return!1;l.points[u].pos=h}var p=l.complete;return l.complete=function(){p&&p(),a.updateResourceItemNumber(n)},this.updateTotalResourceItemNumber(n,1),this.app.create(l),!0}},r.prototype.parseGroup=function(e,t,l,r,i){var c=this,n=(l=l,Z.cloneObject(t));function u(e){return e.type="Thing",c.app.create(e)}n.parent=e,function e(t,r){for(var i=0;i<r.length;i++){var n=r[i];if("Group"==n.type){var o=u(n);t.add({object:o}),e(o,n.children)}else{var a=c.getBundleData(n.model,l);if(!a)return!1;n.url=a.url;var s=c.app.create(n);t.add({object:s})}}}(u(n),n.children)},r.prototype.parseObject=function(e,t,r,i,n,o){var a=t.type;return"Building"==a?this.parseBuilding(e,t,r,i,n):"Thing"==a||"Door"==a||"Window"==a?this.parseThing(e,t,r,i,n):"Fence"==a||"CurveFence"==a?this.parseFence(e,t,r,i,n,o):"Region"==a?this.parseRegion(e,t,r,i,n,o):"Group"==a?this.parseGroup(e,t,r,i,n):(console.error('Parse object failed, due to "'+a+'" unknown object type'),!1)},r.prototype.parseGround=function(e,t){t.image&&(t.type="Ground",t.parent=e,this.app.create(t).style.setPolygonOffset({polygonOffset:!0,polygonOffsetFactor:0,polygonOffsetUnits:1100}))},r.prototype.parseEffects=function(e,t){var r=t.fog;r&&(this.app.fog=r);var i=t.lighting;i&&(this.app.lighting=i);var n=t.postEffect;n&&(this.app.postEffect=n);var o=t.skyBox;o&&(this.app.skyBox=o);var a=t.ground;a&&(Z.isString(a)&&(a={width:1e3,height:1e3,image:a,repeatUV:[100,100]}),this.parseGround(e,a))},r.prototype.parseScene=function(r,i,e,n){var o=this;if(Z.parseValue(n.isCamFitScene,!1)){var t=e.camInfo;if(t){var a=Z.parseVector3(t.eye);a&&(this.app.camera.position=a.toArray());var s=Z.parseVector3(t.target);s&&(this.app.camera.target=s.toArray()),r.sceneJSONData.camInfo={eye:a.toArray(),target:s.toArray()}}}var l=i.models;if(l){var c=i.textures;if(c){var u=e.style;u&&r.changeStyle(u),r.node.visible=Z.parseValue(n.visible,!0),i.loadedNumber=0,i.totalNumber=0,i.resourceLoadedNumber=0,i.resourceTotalNumber=0;var h=e.afterLoadScript||n.afterLoadScript;h&&(i.totalNumber++,i.afterLoadScript=h);var p=e.files.floors;p&&this.updateTotalItemNumber(i,1);var d=i.corners,f=i.objects;if(f)for(var m in f){var g=f[m];this.updateTotalItemNumber(i,g.length);for(var v=0;v<g.length;v++){var y=g[v];this.parseObject(r,y,l,c,i,d),this.updateItemNumber(i)}}var b=e.effects;if(b&&this.parseEffects(r,b),p){var x=i.url.appendPath(p);(n.fileloader||new THREE.FileLoader).load(x,function(e){var t=JSON.parse(e);t&&o.parseFloorPlans(r,t,i,n),o.updateItemNumber(i)},function(){},function(){o.updateItemNumber(i)})}}}},r.prototype._loadScene=function(r,e,i,n,o,a){var s=this,t=r.appendPath(e);(o.fileloader||new THREE.FileLoader).load(t,function(e){var t=JSON.parse(e);t.url=r,t.complete=a,s.parseScene(i,t,n,o)},function(){},function(){})},r.prototype.loadFromCampusBuildier=function(t,r,i,n,o){var a=this,e=(r=this.app.confirmURL(r),i.files);if(e){var s=e.campus;if(s){var l=n.parent||this.app.root;l&&l.add(t);var c=i.beforeLoadScript||n.beforeLoadScript;if(c){var u=r.appendPath(c);q(u,function(e){a._runScript(e),a._loadScene(r,s,t,i,n,o)})}else this._loadScene(r,s,t,i,n,o)}else console.error('load "'+r+'" failed, due to scene file name of index.json is missing')}else console.error('load "'+r+'" failed, due to files of index.json is missing')},r.prototype._loadCampusFinished=function(e,t){e._processModel(),e._synEffectRefCounts(),this._loadViewPointFile(t),this.app.lightManager.getCurrentControl().update(),this._removeTypeMap(t),console.log("ThingJS: "+THING.VERSION)},r.prototype._loadFinished=function(e,t){e instanceof ar?(t.parent=t.parent||this.app.root,e._setup(t)):e instanceof Buliding&&e._setup(t),this._loadCampusFinished(e,t)},r.prototype.load=function(r,i){var n=this,o=this.app.confirmURL(i.url),e=o.appendPath("index.json");Z.parseValue(i.disableCache,!1)&&(e=e.appendRandomSuffix()),(i.fileloader||new THREE.FileLoader).load(e,function(e){var t=JSON.parse(e);n._loadAllPluginsComplete?new sr(t.version).major<4?n.waitingLoadCampuses.push({owner:r,url:o,indexJson:t,params:i}):n.loadCampus(r,o,t,i):n.waitingLoadCampuses.push({owner:r,url:o,indexJson:t,params:i})},function(){},function(){var e=i.error||i.errorCallback;e&&e({url:o});var t=new nr(n.app).getLoader();t.load(o).then(function(e){n._moveFromUBuilder(r,e,t,i,function(){n._loadFinished(r,i)})})})},r.prototype._setupTypeMap=function(e){var t=e.typeMap;if(t)for(var r=0;r<t.length;r++){var i=t[r];Z.addCastType(i.type,i.condition,i.params)}},r.prototype._removeTypeMap=function(e){var t=e.typeMap;if(t)for(var r=0;r<t.length;r++){var i=t[r];Z.removeCastType(i.type,i.condition,i.params)}},r.prototype.loadCampus=function(e,t,r,i){var n=this,o=function(e,t){n._loadFinished(e,t),n.loadingCampus=!1,setTimeout(function(){n.app.trigger("campusready",{object:e})},500)};r.resourceLibrary=i.loadResourceUrl||r.resourceLibrary,r.enableUseHighestVersionResource=i.enableUseHighestVersionResource,this.loadingCampus=!0,json2mesh.DefaultSetting.enableFloorLightMap=Z.parseValue(i.enableFloorLightMap,!1),i.indexJson=r,e.trigger(O.BeforeLoad,i),this.app.loadingProgressBar.prepare(),this._setupTypeMap(i),new sr(r.version).major<4?this.loadFromUBuilder(e,t,r,i,function(){o(e,i)}):this.loadFromCampusBuildier(e,t,r,i,function(){o(e,i)})},r.prototype.update=function(){if(this._loadAllPluginsComplete&&!this.loadingCampus)for(var e=0;e<this.waitingLoadCampuses.length;e++){var t=this.waitingLoadCampuses[e];this.loadCampus(t.owner,t.url,t.indexJson,t.params),this.waitingLoadCampuses.splice(e,1)}},r.prototype._buildCampusStructure=function(e,t){t.app=this.app,t.type=e.type,t.name=e.name?e.name:e.id,t.id=e.id?e.id:e.uuid,t.uuid=e.uuid,t.userData=e.userData,t.children=[],t.getAttribute=function(e){return Z.getAttribute(this,e)},t.getPath=function(){for(var e=this.id,t=this.parent;t&&t.parent&&t.parent.parent;)e=t.id+"/"+e,t=t.parent;return e},t._traverseObjects=function(e,t){for(var r=0;r<this.children.length;r++){var i=this.children[r];Z.isFunction(e)?e(i):Z.isArray(e)&&e.push(i),t&&i._traverseObjects(e,t)}},t.query=function(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],r=[];this._traverseObjects(r,t);var i=new ye(this.app,r);return i.select(e),i};var r=0;e instanceof THING.Floor&&(r=1);for(var i=r;i<e.children.length;i++){var n=e.children[i],o={id:n.id,parent:t};t.children.push(o),this._buildCampusStructure(n,o)}},r.prototype._peekJSONBySimpleLoader=function(r,e,t){var i=t.complete,n=t.errorCallback||t.error,o=this;e.load(r).then(function(e){var t={url:r,id:e.id,children:[]};o._buildCampusStructure(e,t),e.destroy(),i&&i(t)}).catch(function(e){console.error(e),n&&n()})},r.prototype.peekJSON=function(i,n){n=n||{};var e=(i=this.app.confirmURL(i)).appendPath("index.json");Z.parseValue(n.disableCache,!1)&&(e=e.appendRandomSuffix());var t=n.fileloader||new THREE.FileLoader,o=this;t.load(e,function(e){var t=JSON.parse(e),r=new sr(t.version);4==r.major||(3==r.major?o._peekJSONBySimpleLoader(i,new Gt(o.app),n):o._peekJSONBySimpleLoader(i,new qt(o.app),n))},function(){},function(){o._peekJSONBySimpleLoader(i,new qt(o.app),n)})},r.prototype.onUpdate=function(e){this.update(e)},r}(),cr=function(i){function r(e){y(this,r);var t=p(this,i.call(this,e));return t._graph=null,t._expanded=!1,t}return u(r,i),r.prototype.canResponeEventFrom=function(e){var t=e.object;if(t.isChildOf(this)){var r=e.type;if(r==O.MouseEnter||"mouseon"==r){if(t instanceof It)return!0;if(t instanceof Te)return!0}}return i.prototype.canResponeEventFrom.call(this,e)},r.prototype._addFromCampus=function(e){if(e.buildings.length){this.floors.destroy();var t=e.buildings[0].floors,r=this;t.forEach(function(e){r.add(e)})}},r.prototype.setupElevators=function(){var r={};for(var e in this.query(".ElevatorDoor").forEach(function(e){var t=e.userData._ELEVATOR_;r[t]||(r[t]=[]),r[t].push(e)}),r){var t=r[e];this.app.create({type:"Elevator",name:e,parent:this,doors:t})}},r.prototype.setupStairs=function(){this.query("[type=stairway]").forEach(function(e){e.floorNode.visible=!1});var r={};for(var e in this.query(".StairDoor").forEach(function(e){var t=e.userData._STAIR_;r[t]=r[t]||[],r[t].push(e)}),r){var t=r[e];this.app.create({type:"Stair",name:e,parent:this,doors:t})}},r.prototype.canNavigation=function(){return!0},r.prototype.setupNavigationObjects=function(){this.setupElevators(),this.setupStairs()},r.prototype.setupGraph=function(){if(this._graph)return this._graph;var t={};return this.floors.forEach(function(e){e._setupNavigationGraph(t,1e4)}),this._graph=new Graph(t),this._graph},r.prototype.destroy=function(){this._graph=null,i.prototype.destroy.call(this)},r.prototype.hasAnyFacadesVisible=function(){for(var e=this.facades,t=0;t<e.length;t++)if(e[t].visible)return!0;return!1},r.prototype.hasFacades=function(){return 0!==this.facades.length},r.prototype.showAllRoofs=function(){var t=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];this.floors.forEach(function(e){e.showAllRoofs(t)})},r.prototype.expandFloors=function(e){e=e||{},this.expandCmd||(this.expandCmd=this.app.commandManager.create({type:"ExpandObjects",objects:this.floors.objects})),this.expandCmd.setParam(e),this.expandCmd.execute(),this._expanded=!0},r.prototype.unexpandFloors=function(e){e=e||{},this.expandCmd&&(e.hideRoof&&(e.hideRoof=!e.hideRoof),this.expandCmd.setParam(e),this.expandCmd.undo(),this._expanded=!1)},r.prototype.showFacades=function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];console.warn("[Building] Please use '.facades.visible=true/false' to replace '.showFacades()'"),this.facades.visible=e},r.prototype.showFloors=function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];console.warn("[Building] Please use '.floors.visible=true/false' to replace '.showFloors()'"),this.floors.visible=e},r.prototype.showRoof=function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];console.warn("[Building] Please use '.showAllRoofs()' to replace '.showRoof()'"),this.showAllRoofs(e)},l(r,[{key:"isBuilding",get:function(){return!0}},{key:"expanded",get:function(){return this._expanded}},{key:"facade",get:function(){return this.query(".Facade",!1)[0]}},{key:"facades",get:function(){return this.query(".Facade",!1)}},{key:"elevators",get:function(){return this.query(".Elevator",!1)}},{key:"stairs",get:function(){return this.query(".Stair",!1)}},{key:"floors",get:function(){return this.query(".Floor",!1)}},{key:"things",get:function(){return this.query(".Thing",!1)}}]),r}(Ee),ur=function(s){function r(e){y(this,r);var t=p(this,s.call(this,e));return t._ceilingNode=null,t._ceilingObject=null,t._roofNode=null,t._roofObject=null,t._floorNode=null,t._floorObject=null,t._auxiliaryInfo=null,t._textRegion=null,t}return u(r,s),r.prototype.setup=function(e){s.prototype.setup.call(this,e),this._ceilingNode=e.ceilingNode||this._ceilingNode,this._roofNode=e.roofNode||this._roofNode,this._floorNode=e.floorNode||this._floorNode,this._auxiliaryInfo=e.auxiliaryInfo||this._auxiliaryInfo},r.prototype.getMode=function(e){return e.geometry instanceof THREE.ShapeGeometry?"xy":"xz"},r.prototype.getFloorMesh=function(){var e=this._floorNode;if(!e)return null;var t=e.getMeshes();return t.length?t[0]:null},r.prototype.getRoomHeight=function(){return 3},r.prototype.localToWorld=function(e){var t=Z.parseVector3(this.center),r=Z.parseVector3(this.position),i=Z.parseVector3(s.prototype.localToWorld.call(this,e));return t.sub(r),i.add(t),i.toArray()},r.prototype.selfToWorld=function(e){var t=this.labelPosition;return THING.Math.addVector(t,e)},r.prototype.showGrid=function(e,t,r,i,n){var o=5<arguments.length&&void 0!==arguments[5]?arguments[5]:.01;s.prototype.showGrid.call(this,e,t,r,i,n,o);var a=Z.parseVector3(this.labelPosition);this._grid._setWorldPosition(a,!1,this.static)},r.prototype.getLabelPosition=function(e){var t=this.getFloorMesh();if(!t)return null;var r=t.getLabelPosition(e,this.getMode(t));return r?r.toArray():null},r.prototype.getAvaliablePositions=function(e,t,r){if(Z.isNumber(e)){for(var i=[],n=0;n<e;n++)i.push(t);t=i}var o=this.getFloorMesh();if(!o)return null;var a=o.getAvaliableLabelPosition(t,this.getMode(o),r);if(!a)return null;for(n=0;n<a.length;n++)a[n]=a[n].toArray();return a},r.prototype.getRayCastPosition=function(e){if(!(e=Z.parseVector3(e)))return null;var t=this.getFloorMesh();if(!t)return null;var r=t.getRayCastPosition(e);return r?r.toArray():null},r.prototype.getPoints=function(e){},r.prototype._synTextRegion=function(){if(this._textRegion){var e=this._textRegion.position;if(this.style._volumeNode){var t=new THREE.Vector3;this.style._volumeNode.getWorldPosition(t),e[1]=t.y}else e[1]=this.position[1];e[1]+=.01,this._textRegion.position=e}},r.prototype.getNavigationMesh=function(){var e=this._floorNode;if(!e)return null;if(!this.area)return null;var t=e.getMeshes();return t.length?t[0]:null},r.prototype._getLinkableDoors=function(){var e=s.prototype._getLinkableDoors.call(this);return e.add(this.doors),e},r.prototype.showCeiling=function(e){console.warn("[Room] Please use '.ceiling.visible=true/false' to replace '.showCeiling()'"),this.ceiling.visible=e},r.prototype.showRoof=function(e){console.warn("[Room] Please use '.roof.visible=true/false' to replace '.showRoof()'"),this.roof.visible=e},r.prototype.showFloor=function(e){console.warn("[Room] Please use '.floorNode.visible=true/false' to replace '.showFloor()'"),this.floorNode.visible=e},r.prototype.showRoof=function(e){console.warn("[Room] Please use '.roof.visible=true/false' to replace '.showRoof()'"),this.roof.visible=e},r.prototype.setFloor=function(e){console.warn("[Room] Please use '.floorNode.style.' to replace '.setFloor()'"),e=e||{};var t=this.floorNode.style,r=e.color;r&&(t.color=r);var i=e.opacity;i&&(t.opacity=i)},r.prototype.getAvaliableFloorPos=function(e,t){return console.warn("[Room] Please use '.floor.getAvaliablePositions()' to replace '.getAvaliableFloorPos()'"),this.getAvaliablePositions(e,t)},l(r,[{key:"isRoom",get:function(){return!0}},{key:"labelPosition",get:function(){var e=this.getLabelPosition(null);if(e)return e;var t=this._auxiliaryInfo;return t&&t.center?t.center.toArray():null}},{key:"perimeter",get:function(){var e=this.getFloorMesh();return e?e.getPerimeter():0}},{key:"area",get:function(){var e=this.getFloorMesh();return e?e.getArea():0}},{key:"ceiling",get:function(){return this._ceilingObject=this._ceilingObject||new Ee(this.app)._init(this._ceilingNode),this._ceilingObject}},{key:"roof",get:function(){return this._roofObject=this._roofObject||new Ee(this.app)._init(this._roofNode),this._roofObject}},{key:"plan",get:function(){return this._floorObject=this._floorObject||new Ee(this.app)._init(this.getFloorMesh()),this._floorObject}},{key:"floor",get:function(){return this.parents.query(".Floor")[0]}},{key:"points",get:function(){var e=this.getFloorMesh();return e?e.getPoints():null}},{key:"things",get:function(){var e=this.floor;if(!e)return new ye(this.app,[]);for(var t=[],r=e.things,i=0;i<r.length;i++){var n=r[i];this.getRayCastPosition(n.position)&&t.push(n)}return new ye(this.app,t).buildReturnObject(t).add(this.query(".Thing"))}},{key:"doors",get:function(){for(var e=this.floor.doors,t=[],r=0;r<e.length;r++){var i=e[r],n=Z.parseVector3(i.forward),o=Z.parseVector3(i.position),a=1;i instanceof Be&&(a*=2);var s=new THREE.Vector3;n.multiplyScalar(a),s.addVectors(o,n),(this.getRayCastPosition(s)||(n.multiplyScalar(-a),s.addVectors(o,n),this.getRayCastPosition(s)))&&t.push(i)}return new ye(this.app,t).buildReturnObject(t)}},{key:"textRegion",get:function(){return this._textRegion||(this._textRegion=this.app.create({type:"TextRegion",text:this.name,parent:this,position:this.labelPosition,angles:[-90,0,0]}),this._textRegion.translateY(.1),this._textRegion.renderOrder=1),this._synTextRegion(),this._textRegion},set:function(e){e?(this._textRegion=e,this._synTextRegion()):(this._textRegion.destroy(),this._textRegion=null)}},{key:"floorIndex",get:function(){return console.warn("[Room] Please use '.floor.indexOfParent()' to replace '.floorIndex()'"),this.floor.indexOfParent()}},{key:"center",get:function(){return console.warn("[Room] Please use '.labelPosition' to replace '.center' or if you want to use .boundingBox.center to get center of boundingBox?"),this.labelPosition}},{key:"floorNode",get:function(){return console.warn("[Room] Please use '.plan' to replace '.floorNode'"),this.plan}}]),r}(Ee),hr=function(){function i(e,t){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:60;y(this,i),this.object=null,this.app=null,this._size=Z.parseVector2(e),this._node=t,this._factor=r}return i.prototype._updateSize=function(e){var t=Z.parseVector3(this.app.camera.position);this._node.keepSize(t,this._size,this._factor,e,this.object.static),this.object.synIndependentWorldScale()},i.prototype.onAdd=function(e){this.object=e,this._node=this._node||this.object.node,this.app=e.app,this.object.tickable=!0,this._node&&this._node.updateWorldMatrix(!0),this._updateSize()},i.prototype.onRemove=function(){},i.prototype.onUpdate=function(e){return this._updateSize(),!0},l(i,[{key:"size",set:function(e){this._size=Z.parseVector2(e),this.object.synIndependentWorldScale(),this._updateSize(!0)},get:function(){return this._size.toArray()}},{key:"node",set:function(e){this._node=e},get:function(){return this._node}}]),i}(),pr=function(){function t(e){y(this,t),this.obj=e,this._renderOrder=0,this._opacity=1,this._color=null,this._outlineColor=null,this._edgeColor=null,this._alwaysOnTop=!1,this._wireframe=!1,this._glow=!1,this._innerGlow=!1,this._image="",this._doubleSide=!1,this._uvAnimationParams=null,this._boundingBoxNode=null,this._orientedBoundingBoxNode=null,this._axisNode=null,this._vertexNormalNode=null,this._edgeNode=null,this._defaultOutlineColor=null,this._synStyle=null}return t.prototype._syn=function(){var e=this._synStyle;e&&(delete this._synStyle,e.execute())},t.prototype._setSynValue=function(e,t){return!this.obj.loaded&&(this._synStyle||(this._synStyle=this.obj.app.commandManager.create({type:"SetObjectStyle",object:this.obj})),this._synStyle.setAttribute(e,t),!0)},t.prototype._getSynValue=function(e){return this._synStyle?this.obj.loaded?null:this._synStyle.getAttribute(e):null},t.prototype._setMaterial=function(e,t){var r=e.material;r&&(Z.isArray(r)?r.forEach(function(e){t(e)}):t(r))},t.prototype._traverse=function(i,e){var n=this;(e=e||this.obj.node).traverse(function(e){var t=e.userData;if(!t.skipStyle){var r=t.__independent_style_object__;r&&r!=n.obj||i(e)}})},t.prototype._onEnter=function(){},t.prototype._onLeave=function(){},t.prototype.cloneMaterial=function(){this._traverse(function(e){var t=e.userData,r=e.material;if(r){if(t._prev_material)return;if(Z.isArray(r)){t._prev_material=[],e.material=[];for(var i=0;i<r.length;i++)t._prev_material.push(r[i]),e.material.push(r[i].clone())}else t._prev_material=r,e.material=r.clone()}})},t.prototype.revertMaterial=function(){this._traverse(function(e){var t=e.userData,r=e.material;if(r){var i=t._prev_material;i?(e.material=i,e.material.needsUpdate=!0,delete t._prev_material):(Z.revertValue(r,"opacity"),Z.revertValue(r,"color"),Z.revertValue(r,"depthTest"),Z.revertValue(r,"depthWrite"),Z.revertValue(r,"onBeforeRender"),Z.revertValue(r,"wireframe"),Z.revertValue(r,"wireframeMap","map"))}Z.revertValue(e,"renderOrder")})},t.prototype.isNeedRevertMaterials=function(){return!this.isNeedCloneMaterials()},t.prototype.isNeedCloneMaterials=function(){var e=this._opacity,t=this._color,r=this._alwaysOnTop,i=this._wireframe;return!Z.isNull(e)&&1!==e||!Z.isNull(t)||!!r||!!i},t.prototype.setOpacity=function(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];if(this._opacity!=e)if(this._opacity=Z.isNull(e)?1:THING.Math.clamp(e,0,1),this.obj.app.needUpdate=!0,t&&this.isNeedRevertMaterials())this.revertMaterial();else{t&&this.isNeedCloneMaterials()&&this.cloneMaterial();var r=this;this._traverse(function(e){r._setMaterial(e,function(e){Z.backupValue(e,"opacity"),e.opacity=r._opacity,e.alphaTest&&Z.backupValue(e,"alphaTest");var t=e._prev_alphaTest;t&&(e.alphaTest=t*r._opacity),e.transparent=!0})})}},t.prototype.setColor=function(t){var e=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],r=this;if(t){if(!(t=Z.parseColor(t)))return;if(this._color&&this._color.equals(t))return;this._color=t,e&&this.isNeedCloneMaterials()&&this.cloneMaterial(),this._traverse(function(e){r._setMaterial(e,function(e){Z.backupValue(e,"color"),e.color=t})})}else{if(!this._color)return;this._color=t,e&&this.isNeedRevertMaterials()?this.revertMaterial():this._traverse(function(e){var t=e.material;t&&Z.revertValue(t,"color")})}this.obj.app.needUpdate=!0},t.prototype.setOutlineColor=function(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1];Z.isNull(e)?(this._outlineColor&&(this._setEffectRefCounts("outline_0x"+this._outlineColor.getHexString(),!1),this.obj.node.traverse(function(e){e.layers.disable(1)}),this._outlineColor=null),this._defaultOutlineColor&&this._setEffectRefCounts("outline_0x"+this._defaultOutlineColor.getHexString(),!0)):(this._outlineColor&&this._setEffectRefCounts("outline_0x"+this._outlineColor.getHexString(),!1),e=Z.parseColor(e),this._outlineColor=e,this._setEffectRefCounts("outline_0x"+e.getHexString(),!0),t&&(this.obj.node.ensureParentsVisible(!0),this.obj.node.visible=!0),this.obj.node.traverse(function(e){e.isSprite||e.layers.enable(1)})),this.obj.app.needUpdate=!0},t.prototype.setDefaultOutlineColor=function(e){var t=Z.parseColor(e);t?(this._defaultOutlineColor=t,this.outlineColor||this._setEffectRefCounts("outline_0x"+t.getHexString(),!0),this.obj.app.needUpdate=!0):(this._defaultOutlineColor=null,this._outlineColor||this._defaultOutlineColor||this._clearAllOutlineColor())},t.prototype.setSkipBoundingBox=function(e){this.obj.node.skipBoundingBox(e),this.obj.parents.forEach(function(e){e.boundingBoxDirty=!0})},t.prototype._setNodesAttribute=function(t,r){var i=2<arguments.length&&void 0!==arguments[2]&&arguments[2];this._traverse(function(e){!e.isRenderableObject()&&i||(e.userData[t]=r)})},t.prototype._setAlwaysOnTop=function(e,t){if(this._alwaysOnTop!=e){this._alwaysOnTop=e,t&&this.isNeedRevertMaterials()?this.revertMaterial():t&&this.isNeedCloneMaterials()&&this.cloneMaterial();var r=this;if(e){Z.backupValue(this.obj.node,"parent");var i=new THREE.MeshStandardMaterial({transparent:!0,opacity:1e-4});(n=new THREE.Mesh(new THREE.Geometry,i)).name="AlwaysOnTopRootMesh",n.userData=Z.mergeObject({keepOutline:!0},this.obj.node.userData),n.frustumCulled=!1,n.renderOrder=1e6,n.onAfterRender=function(e){e.clearDepth()},this.obj.node.parent.add(n),this.obj.node.attach(n,this.obj.app.scene,!0),this._traverse(function(e){Z.backupValue(e,"renderOrder"),e.renderOrder=10000001,r._setMaterial(e,function(e){Z.backupValue(e,"transparent"),e.transparent=!0})})}else{var n,o=Z.getValue(this.obj.node,"parent",!0);(n=this.obj.node.parent).removeBySelf(),o.add(this.obj.node),this._traverse(function(e){Z.revertValue(e,"renderOrder"),r._setMaterial(e,function(e){Z.revertValue(e,"transparent")})})}}},t.prototype.setAlwaysOnTop=function(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];this._setAlwaysOnTop(e,t),this.obj.app.needUpdate=!0},t.prototype.setBoundingBox=function(e,t){if(e){if(this.obj.updateBounds(),!this._boundingBoxNode){this._boundingBoxNode=new THREE.Box3Helper(this.obj._box,16777215),this._boundingBoxNode.frustumCulled=!1,this._boundingBoxNode.name=this.obj.name+"_BoundingBox",this._boundingBoxNode.skipBoundingBox(!0);var n=this;this._boundingBoxNode.addBeforeRenderFunction("_boundingBoxNode",function(e,t,r){var i=new THREE.Matrix4;i.getInverse(n.obj.node.matrixWorld),n.obj.static&&this.updateMatrixWorld(),this.matrixWorld.premultiply(i)})}this._boundingBoxNode.material.color=Z.parseColor(t),this.obj.node.add(this._boundingBoxNode),this.obj.tickable=!0}this._boundingBoxNode&&(this._boundingBoxNode.visible=e)},t.prototype.setOrientedBoundingBox=function(e,t){if(e){this.obj.updateBounds(),this._orientedBoundingBoxNode||(this._orientedBoundingBoxNode=new THREE.Box3Helper(this.obj._orientedBox.box,16777215),this._orientedBoundingBoxNode.frustumCulled=!1,this._orientedBoundingBoxNode.name=this.obj.name+"_OrientedBoundingBox",this._orientedBoundingBoxNode.skipBoundingBox(!0));var r=this._orientedBoundingBoxNode.material;r.color=Z.parseColor(t,r.color),this.obj.node.add(this._orientedBoundingBoxNode),this.obj.tickable=!0}this._orientedBoundingBoxNode&&(this._orientedBoundingBoxNode.visible=e)},t.prototype.setVertexNormalHelper=function(e){if(e){this.obj.node.updateMatrixWorld();var t=new THREE.Matrix4;t.getInverse(this.obj.node.matrixWorld),this._vertexNormalNode=new THREE.Group,this._vertexNormalNode.name=this.obj.name+"_VertexNormal",this._vertexNormalNode.applyMatrix(t);var r=this;this.obj.node.traverse(function(e){if(e.isMesh&&e.geometry){var t=new THREE.VertexNormalsHelper(e,1,16711680);r._vertexNormalNode.add(t)}}),this.obj.node.add(this._vertexNormalNode)}else this.obj.app.resourceManager.remove(this._vertexNormalNode),this._vertexNormalNode=null},t.prototype.setAxisHelper=function(e){if(e){this._axisNode=new THREE.AxesHelper(this.obj.boundingBox.radius),this._axisNode.name=this.obj.name+"_Axis";var t=this._axisNode.material;t.depthTest=!1,t.transparent=!0;var r=new THREE.Vector3;this.obj.node.getWorldScale(r),this._axisNode.scale.set(1/r.x,1/r.y,1/r.z),this.obj.node.add(this._axisNode)}else this.obj.app.resourceManager.remove(this._axisNode),this._axisNode=null},t.prototype._setEffectRefCounts=function(t,e){var r=this.obj.app.sceneManager;e?this._traverse(function(e){e.userData&&e.userData.skipOutline&&-1<t.indexOf("outline")||(e.technique=e.technique||{},!0!==e.technique[t]&&(e.technique[t]=!0,r._updatEffectRefCounts(t,1)))}):this._traverse(function(e){e.technique&&e.technique[t]&&(delete e.technique[t],r._updatEffectRefCounts(t,-1))}),this.obj.app.needUpdate=!0},t.prototype._clearAllOutlineColor=function(){var r=this.obj.app.sceneManager;this._traverse(function(e){if(e.technique)for(var t in e.technique)e.technique[t]&&-1<t.indexOf("outline")&&(delete e.technique[t],r._updatEffectRefCounts(t,-1))})},t.prototype.setGlow=function(e){this._glow=e,this._setEffectRefCounts("glow",e)},t.prototype.setInnerGlow=function(e){this._innerGlow=e,this._setEffectRefCounts("innerGlow",e)},t.prototype.setEdgeColor=function(e){var i=this;if(this._edgeColor=Z.parseColor(e),e)if(this._edgeNode)this._edgeNode.traverse(function(e){var t=e.material;t&&(t.color=i._edgeColor)});else{this._edgeNode=new THREE.Group,this.obj.node.updateMatrixWorld();var n=new THREE.Matrix4;n.getInverse(this.obj.node.matrixWorld),this.obj.node.traverse(function(e){if(e.isMesh&&e.geometry){var t=new THREE.EdgesGeometry(e.geometry),r=new THREE.LineSegments(t);r.material.color=i._edgeColor,r.applyMatrix(e.matrixWorld),r.applyMatrix(n),i._edgeNode.add(r)}}),this.obj.node.add(this._edgeNode)}else this.obj.app.resourceManager.remove(this._edgeNode),this._edgeNode=null},t.prototype.setImage=function(e){if(this._image!=e){var t;if(e){if(Z.isString(e)){var r=this.obj.app.confirmURL(e);if(this._image==r)return;this._image=r;var i=new THREE.TextureLoader;i.setCrossOrigin("anonymous"),t=i.load(r)}else e.width&&e.height&&(t=this.obj.app.resourceManager.loadTexture(e));if(!t)return}else this._image="";this._traverse(function(e){e.material&&(e.material.map=t)}),this.obj.app.needUpdate=!0}},t.prototype.flipOutlineColor=function(e){e=Z.parseColor(e).getHex();var t=this.outlineColor;this.outlineColor=t&&t==e?null:e},t.prototype.setLightMap=function(e){var t=(e=e||{}).intensity||0,r=Z.parseColor(e.color,new THREE.Color),i=e.image;i&&((i=(new THREE.TextureLoader).load(this.obj.app.confirmURL(i))).anisotropy=16),this._traverse(function(e){e.material&&(e.material.lightMap=i,e.material.lightMapIntensity=t,e.material.color.copy(r),e.material.needsUpdate=!0)}),this.obj.app.needUpdate=!0},t.prototype.setMaterial=function(r){var e=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],u=this;if(r){var i=function(e,t){var r=Z.parseColor(t.color);r&&e.color.copy(r);var i=t.image;if(i){(i=(new THREE.TextureLoader).load(u.obj.app.confirmURL(i),function(){u.obj.app.needUpdate=!0})).anisotropy=16;var n=Z.parseWrapType(t.wrap||t.wrapType);n&&(i.wrapT=n,i.wrapS=n),e.map=i}else null===i&&(e.map=null);var o=t.map;o?e.map=o:null===o&&(e.map=null);var a=t.envMap;if(a){var s=this.app.confirmURL(Z.parseCubeTextureUrls(value));e.envMap=(new THREE.CubeTextureLoader).load(s,function(){u.obj.app.needUpdate=!0})}else null===a&&(e.envMap=null);e.envMapIntensity=Z.parseValue(t.envMapIntensity,e.envMapIntensity);var l=t.doubleSide;void 0!==l&&(e.side=l?THREE.DoubleSide:THREE.FrontSide),e.transparent=Z.parseValue(t.transparent,e.transparent),e.opacity=Z.parseValue(t.opacity,e.opacity);var c=Z.parseColor(t.emissive);c&&e.emissive.copy(c),e.metalness=Z.parseValue(t.metalness,e.metalness),e.roughness=Z.parseValue(t.roughness,e.roughness),e.depthWrite=Z.parseValue(t.depthWrite,e.depthWrite),e.depthTest=Z.parseValue(t.depthTest,e.depthTest),e.needsUpdate=!0},n=r.index;e&&this.cloneMaterial(),this._traverse(function(e){if(e.material)if(Z.isArray(e.material))if(void 0!==n)n<e.material.length&&i(e.material[n],r);else for(var t=0;t<e.material.length;t++)i(e.material[t],r);else i(e.material,r)})}else this.revertMaterial();this.obj.app.needUpdate=!0},t.prototype.changeMaterial=function(n){n?this._traverse(function(t){var r=t.userData,e=t.material;if(e){var i=r._prev_material;i&&(Z.isArray(e)?e.forEach(function(e){return e.dispose()}):e.dispose(),e=i),Z.isArray(e)?(r._prev_material=[],t.material=[],e.forEach(function(e){r._prev_material.push(e),t.material.push(n(e,t))})):(r._prev_material=e,t.material=n(e,t))}}):this.revertMaterial(),this.obj.app.needUpdate=!0},t.prototype.setPolygonOffset=function(e){e=e||{};var r=Z.parseValue(e.polygonOffset,!1),i=Z.parseValue(e.polygonOffsetFactor,0),n=Z.parseValue(e.polygonOffsetUnits,0);this._traverse(function(e){var t=e.material;t&&(t.polygonOffset=r,t.polygonOffsetFactor=i,t.polygonOffsetUnits=n)}),this.obj.app.needUpdate=!0},t.prototype.setWireframe=function(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];this._wireframe=e;var r=this;e?(t&&this.isNeedCloneMaterials()&&this.cloneMaterial(),this._traverse(function(e){r._setMaterial(e,function(e){Z.backupValue(e,"wireframe"),Z.backupValue(e,"wireframeMap","map"),e.wireframe=!0,e.map=null})})):this.isNeedRevertMaterials()?this.revertMaterial():this._traverse(function(e){r._setMaterial(e,function(e){Z.revertValue(e,"wireframe"),Z.revertValue(e,"wireframeMap","map")})}),this.obj.app.needUpdate=!0},t.prototype.setRenderOrder=function(t){(this._renderOrder=t)?this.obj.node.traverse(function(e){Z.backupValue(e,"renderOrder"),e.renderOrder=t}):this.obj.node.traverse(function(e){Z.revertValue(e,"renderOrder")}),this.obj.app.needUpdate=!0},t.prototype._setTextureUVAnimation=function(n){var o=this;Z.setValue(n,"updateMatrix",function(){var e=o._uvAnimationParams,t=e.repeat||[1,1],r=e.center||[0,0],i=e.offset||[0,0];n.matrix.setUvTransform(i[0],i[1],t[0],t[1],e.rotation,r[0],r[1])})},t.prototype.setUVAnimation=function(e){if(this._uvAnimationParams=e,this._uvAnimationParams){var t=this._uvAnimationParams;t.wrapType=Z.parseWrapType(t.wrapType);var r=t.offset;if(r&&(r.isVector2&&(r=r.toArray()),r=r.concat()),t.baseOffset=r,t.baseRotation=t.rotation,!r||0==r[0]&&0==r[1]){var i=t.rotation;if(!i||0==i)return}t.baseRotation&&(t.center=[.5,.5]),t.offset=[0,0],t.rotation=0;for(var n=this.obj.node.getTextures(),o=0;o<n.length;o++){var a=n[o];Z.setValue(a,"wrapS",t.wrapType),Z.setValue(a,"wrapT",t.wrapType),this._setTextureUVAnimation(a)}this.obj.tickable=!0}else for(n=this.obj.node.getTextures(),o=0;o<n.length;o++)a=n[o],Z.revertValue(a,"wrapS"),Z.revertValue(a,"wrapT"),Z.revertValue(a,"updateMatrix")},t.prototype.hasUVAnimation=function(){return!!this._uvAnimationParams},t.prototype.update=function(e){if(this._uvAnimationParams){var t=this._uvAnimationParams,r=t.offset,i=t.baseOffset,n=t.baseRotation;return i&&r&&(r[0]+=i[0]*e,r[1]+=i[1]*e),n&&(t.rotation+=n*e),!0}return!1},l(t,[{key:"renderOrder",set:function(e){this.setRenderOrder(e)},get:function(){return this._renderOrder}},{key:"wireframe",set:function(e){this.setWireframe(e)},get:function(){return this._wireframe}},{key:"opacity",set:function(e){this._setSynValue("opacity",e)||this.setOpacity(e)},get:function(){return this._getSynValue("opacity")||this._opacity}},{key:"color",set:function(e){this._setSynValue("color",e)||this.setColor(e)},get:function(){return this._getSynValue("color")||(this._color?this._color.toHexString():null)}},{key:"emissive",set:function(e){e=e||"#000000",this.setMaterial({emissive:e})}},{key:"roughness",set:function(e){this.setMaterial({roughness:e})}},{key:"outlineColor",set:function(e){this._setSynValue("outlineColor",e)||this.setOutlineColor(e)},get:function(){return this._getSynValue("color")||(this._outlineColor?this._outlineColor.toHexString():null)}},{key:"defaultOutlineColor",set:function(e){this.setDefaultOutlineColor(e)},get:function(){return this._defaultOutlineColor}},{key:"skipBoundingBox",set:function(e){this.setSkipBoundingBox(e)}},{key:"skipOutline",set:function(e){this._setNodesAttribute("skipOutline",e,!0),e&&(this._outlineColor=null,this._defaultOutlineColor=null,this._clearAllOutlineColor())}},{key:"skipStyle",set:function(e){this._setNodesAttribute("skipStyle",e)}},{key:"skipEnvMap",set:function(e){this._setNodesAttribute("skipEnvMap",e)}},{key:"glow",set:function(e){this.setGlow(e)},get:function(){return this._glow}},{key:"innerGlow",set:function(e){this.setInnerGlow(e)},get:function(){return this._innerGlow}},{key:"vertexNormalHelper",set:function(e){this.setVertexNormalHelper(e)},get:function(){return!!this._vertexNormalNode&&this._vertexNormalNode.visible}},{key:"axisHelper",set:function(e){this.setAxisHelper(e)},get:function(){return!!this._axisNode&&this._axisNode.visible}},{key:"edgeColor",set:function(e){this.setEdgeColor(e)},get:function(){return this._edgeColor?this._edgeColor.toHexString():null}},{key:"boundingBox",set:function(e){this.setBoundingBox(e,16777215)},get:function(){return!!this._boundingBoxNode&&this._boundingBoxNode.visible}},{key:"boundingBoxColor",set:function(e){this.setBoundingBox(!0,e)},get:function(){return this._boundingBoxNode?this._boundingBoxNode.material.color.toHexString():0}},{key:"orientedBoundingBox",set:function(e){this.setOrientedBoundingBox(e)},get:function(){return!!this._orientedBoundingBoxNode&&this._orientedBoundingBoxNode.visible}},{key:"orientedBoundingBoxColor",set:function(e){this.setOrientedBoundingBox(!0,e)},get:function(){return this._orientedBoundingBoxNode?this._orientedBoundingBoxNode.material.color.toHexString():0}},{key:"alwaysOnTop",set:function(e){this.setAlwaysOnTop(e)},get:function(){return this._alwaysOnTop}},{key:"image",set:function(e){this.setImage(e)},get:function(){return this._image}},{key:"doubleSide",set:function(e){this._doubleSide=e,this.setMaterial({doubleSide:e})},get:function(){return this._doubleSide}}]),t}(),dr=function(t){function r(e){return y(this,r),p(this,t.call(this,e))}return u(r,t),r}(pr),fr=function(r){function i(e){y(this,i);var t=p(this,r.call(this,e));return t._textColor=Z.parseColor("#1e90ff"),t._textSize=26,t._textLineWidth=65536,t._textLineHeight=20,t._textType="Arial",t._dropShadow=!0,t._dropShadowAlpha=1,t._dropShadowAngle=45,t._dropShadowBlur=1,t._dropShadowColor=Z.parseColor("#000000"),t._dropShadowDistance=2,t._strokeMode=!1,t}return u(i,r),l(i,[{key:"fontColor",set:function(e){this._textColor=Z.parseColor(e),this.obj.refreshTextMesh()},get:function(){return this._textColor.toHexString()}},{key:"fontSize",set:function(e){e&&(this._scale=e/26,this._textSize=e,this.obj.refreshTextMesh())},get:function(){return this._textSize}},{key:"fontType",set:function(e){this._textType=e,this.obj.refreshTextMesh()},get:function(){return this._textType}},{key:"dropShadow",set:function(e){this._dropShadow=e,this.obj.refreshTextMesh()},get:function(){return this._dropShadow}},{key:"dropShadowAlpha",set:function(e){this._dropShadowAlpha=e,this.obj.refreshTextMesh()},get:function(){return this._dropShadowAlpha}},{key:"dropShadowAngle",set:function(e){this._dropShadowAngle=e,this.obj.refreshTextMesh()},get:function(){return this._dropShadowAngle}},{key:"dropShadowBlur",set:function(e){this._dropShadowBlur=e,this.obj.refreshTextMesh()},get:function(){return this._dropShadowBlur}},{key:"dropShadowColor",set:function(e){this._dropShadowColor=Z.parseColor(e),this.obj.refreshTextMesh()},get:function(){return this._dropShadowColor.toHexString()}},{key:"dropShadowDistance",set:function(e){this._dropShadowDistance=e,this.obj.refreshTextMesh()},get:function(){return this._dropShadowDistance}},{key:"textLineWidth",set:function(e){this._textLineWidth=e,this.obj.refreshTextMesh()},get:function(){return this._textLineWidth}},{key:"textLineHeight",set:function(e){this._textLineHeight=e,this.obj.refreshTextMesh()},get:function(){return this._textLineHeight}},{key:"strokeMode",set:function(e){this._strokeMode=e,this.obj.refreshTextMesh()},get:function(){return this._strokeMode}}]),i}(dr),mr=function(r){function i(e){y(this,i);var t=p(this,r.call(this,e));return t._text="",t._factor=16/26*.1,t._keepSize=!1,t._mesh=null,t}return u(i,r),i.prototype.setupContext=function(e){var t=this.style;if(e.font=this.style.fontSize.toString(10)+"px "+this.style.fontType,e.fillStyle=this.style.fontColor,e.textAlign="center",e.textBaseline="middle",t._dropShadow){var r=t._dropShadowColor.toRGBArray(),i=THING.Math.degToRad(t._dropShadowAngle),n=t._dropShadowDistance*t._scale;e.shadowColor="rgba("+255*r[0]+","+255*r[1]+","+255*r[2]+","+t._dropShadowAlpha+")",e.shadowBlur=t._dropShadowBlur,e.shadowOffsetX=Math.cos(i)*n,e.shadowOffsetY=Math.sin(i)*n}else e.shadowColor=0,e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0},i.prototype.getTextRows=function(e,t,r,i,n){for(var o=t.split(""),a="",s=[],l=0;l<o.length;l++){var c=o[l];("\n"==c||e.measureText(a).width>=n)&&(s.push(a),a=""),a+=c}return s.push(a),s},i.prototype.drawText=function(e,t,r,i){for(var n=this.style.textLineHeight,o=0;o<i.length;o++)this.style.strokeMode?e.strokeText(i[o],t,r+o*n):e.fillText(i[o],t,r+o*n)},i.prototype.createTextMesh=function(){var e=document.createElement("canvas"),t=this.style.fontSize/72*96*2,r=Math.max(64,THING.Math.roundUpPowerOf2(t)),i=e.getContext("2d");this.setupContext(i);for(var n=this.getTextRows(i,this._text,r/2,r/2,this.style.textLineWidth),o=n.length*t,a=0,s=0;s<n.length;s++)a=Math.max(a,n[0].length*t);var l=Z.system.getPixelRatio(i),c=Math.max(r,THING.Math.roundUpPowerOf2(a)),u=Math.max(r,THING.Math.roundUpPowerOf2(o));r=Math.max(c,u),e.width=r,e.height=r,e.style.width=e.width+"px",e.style.height=e.height+"px",i.scale(l,l),this.setupContext(i),this.drawText(i,e.width/2,e.height/2,n);var h=new THREE.Texture(e);h.minFilter=THREE.LinearFilter,h.magFilter=THREE.LinearFilter,h.generateMipmaps=!0,h.needsUpdate=!0;var p=r*this._factor,d=new THREE.PlaneGeometry(p,p),f=new THREE.MeshBasicMaterial({map:h,transparent:!0,side:THREE.DoubleSide,depthWrite:!1}),m=new THREE.Mesh(d,f);return m.userData.skipBoundingBox=!0,m.userData.skipOutline=!0,m.userData.noBlending=!0,m},i.prototype.refreshTextMesh=function(){this.app.resourceManager.remove(this._mesh),this._mesh=this.createTextMesh(),this._mesh.renderOrder=1,this.node.add(this._mesh);var e=this.getControl("TextRegionSizeAdjustmentControl");e&&(e.node=this._mesh)},i.prototype.customSetup=function(e){var t=this.style;t.fontColor=Z.parseColor(e.textColor||e.fontColor||t.fontColor),t.fontSize=e.textSize||e.fontSize||t.fontSize,t.fontType=e.textType||e.fontType||t.fontType,t.textLineWidth=e.textLineWidth||e.fontLineWidth||t.textLineWidth,t.textLineHeight=e.textLineHeight||e.fontLineHeight||t.textLineHeight,t.strokeMode=e.storkeMode||t.strokeMode,this._text=e.text||e.fontText||this._text,this._factor=e.factor||this._factor;var r=e.keepSize;r&&(this.keepSize=r),this.refreshTextMesh(),this.node.skipBoundingBox(!0)},l(i,[{key:"text",set:function(e){this._text=e,this.refreshTextMesh()},get:function(){return this._text}},{key:"keepSize",set:function(e){if(this._keepSize!=e)if(this._keepSize=e){var t=Z.parseVector3(this.app.camera.position),r=60/this._mesh.getDistanceFromCamera(t);this.addControl(new hr([r,r],this._mesh),"TextRegionSizeAdjustmentControl")}else this.removeControl("TextRegionSizeAdjustmentControl")},get:function(){return this._keepSize}},{key:"style",get:function(){return r.prototype._getStyle.call(this)}},{key:"textColor",set:function(e){console.warn('[TextRegion]Please use ".style.fontColor" to replace ".fontColor"'),this.style.fontColor=e},get:function(){return console.warn('[TextRegion]Please use ".style.fontColor" to replace ".fontColor"'),this.style.fontColor}},{key:"dropShadow",set:function(e){console.warn('[TextRegion]Please use ".style.dropShadow" to replace ".dropShadow"'),this.style.dropShadow=e},get:function(){return console.warn('[TextRegion]Please use ".style.dropShadow" to replace ".dropShadow"'),this.style.dropShadow}},{key:"dropShadowAlpha",set:function(e){console.warn('[TextRegion]Please use ".style.dropShadowAlpha" to replace ".dropShadowAlpha"'),this.style.dropShadowAlpha=e},get:function(){return console.warn('[TextRegion]Please use ".style.dropShadowAlpha" to replace ".dropShadowAlpha"'),this.style.dropShadowAlpha}},{key:"dropShadowAngle",set:function(e){console.warn('[TextRegion]Please use ".style.dropShadowAngle" to replace ".dropShadowAngle"'),this.style.dropShadowAngle=e},get:function(){return console.warn('[TextRegion]Please use ".style.dropShadowAngle" to replace ".dropShadowAngle"'),this.style.dropShadowAngle}},{key:"dropShadowBlur",set:function(e){console.warn('[TextRegion]Please use ".style.dropShadowBlur" to replace ".dropShadowBlur"'),this.style.dropShadowBlur=e},get:function(){return console.warn('[TextRegion]Please use ".style.dropShadowBlur" to replace ".dropShadowBlur"'),this.style.dropShadowBlur}},{key:"dropShadowColor",set:function(e){console.warn('[TextRegion]Please use ".style.dropShadowColor" to replace ".dropShadowColor"'),this.style.dropShadowColor=e},get:function(){return console.warn('[TextRegion]Please use ".style.dropShadowColor" to replace ".dropShadowColor"'),this.style.dropShadowColor}},{key:"dropShadowDistance",set:function(e){console.warn('[TextRegion]Please use ".style.dropShadowDistance" to replace ".dropShadowDistance"'),this.style.dropShadowDistance=e},get:function(){return console.warn('[TextRegion]Please use ".style.dropShadowDistance" to replace ".dropShadowDistance"'),this.style.dropShadowDistance}},{key:"textSize",set:function(e){console.warn('[TextRegion]Please use ".style.fontSize" to replace ".fontSize"'),this.style.fontSize=e},get:function(){return console.warn('[TextRegion]Please use ".style.fontSize" to replace ".fontSize"'),this.style.fontSize}},{key:"textLineWidth",set:function(e){console.warn('[TextRegion]Please use ".style.textLineWidth" to replace ".textLineWidth"'),this.style.textLineWidth=e},get:function(){return console.warn('[TextRegion]Please use ".style.textLineWidth" to replace ".textLineWidth"'),this.style.textLineWidth}},{key:"textLineHeight",set:function(e){console.warn('[TextRegion]Please use ".style.textLineHeight" to replace ".textLineHeight"'),this.style.textLineHeight=e},get:function(){return console.warn('[TextRegion]Please use ".style.textLineHeight" to replace ".textLineHeight"'),this.style.textLineHeight}},{key:"strokeMode",set:function(e){console.warn('[TextRegion]Please use ".style.strokeMode" to replace ".strokeMode"'),this.style.strokeMode=e},get:function(){return console.warn('[TextRegion]Please use ".style.strokeMode" to replace ".strokeMode"'),this.style.strokeMode}}]),i}(Ee),gr=function(r){function i(e){y(this,i);var t=p(this,r.call(this,e));return t._lineCurve=null,t._startPoint=null,t._endPoint=null,t._doors=null,t._doors_self=null,t._collisionBox=null,t._models=[],t._modelSize=null,t._combineModel=[],t._fenceUpdating=!1,t._startVertex=null,t._endVertex=null,t}return u(i,r),i.prototype.loadFromURL=function(e,t){var r=this;this._url=e.url,this._setupModel(function(){r.combineFence(t)})},i.prototype.setupFromURL=function(e){if(e.node)this._setup(e);else{var t=this;this.loadFromURL(e,function(){t._setup(e)})}},i.prototype.setup=function(e){this.setupID(e),e.url?this.setupFromURL(e):this._setup(e)},i.prototype.setupCommonInfo=function(e){r.prototype.setupCommonInfo.call(this,e),this._startPoint=e.startPoint,this._endPoint=e.endPoint,this._doors=e.doors,this.sortDoor()},i.prototype.setupComplete=function(e){r.prototype.setupComplete.call(this,e)},i.prototype._setupModel=function(i){var S=this;!function(){for(var e=0;e<S._models.length;e++)S._models[e].destroy();S._models=[]}(),this._setupVertexNode(),this.app.create({type:"Thing",visible:!1,url:this._url,parent:this,complete:function(e){var t,r;S._modelSize=e.object.boundingBox.initSize,t=Z.parseVector2([S._startVertex.localPosition[0],S._startVertex.localPosition[2]]),r=Z.parseVector2([S._endVertex.localPosition[0],S._endVertex.localPosition[2]]),S._lineCurve=new THREE.LineCurve(t,r),function(){var e,t,r,i,n=[],o=S._lineCurve.getLength();if(S._doors&&0<S._doors.length){for(var a=null,s=0;s<S._doors.length;s++){var l=S._doors[s],c=l.width/o/2;if(a){var u=S._lineCurve.getPoint(a),h=S._lineCurve.getPoint(l.percent-c);n.push(new THREE.LineCurve(u,h))}else{var p=S._lineCurve.getPoint(0);h=S._lineCurve.getPoint(l.percent-c);n.push(new THREE.LineCurve(p,h))}a=l.percent+c}if(a<1){var d=S._lineCurve.getPoint(a),f=S._lineCurve.getPoint(1);n.push(new THREE.LineCurve(d,f))}}else n.push(S._lineCurve);for(var m=S._modelSize[0],g=0,v=[],y=0;y<n.length;y++){var b=n[y];g+=_=(e=m,t=b.getLength(),r=void 0,i=(r=t/e)%1,r=Math.floor(r),.05<i&&(r+=1),r),v.push(_)}!function(e){if(0<e)for(var t=0;t<e;t++)S._models.push(S.app.create({url:S._url,type:"Thing",parent:S}));else if(e<0)for(var r=Math.abs(e)-1;0<=r;r--)S._models[r].destroy(),S._models.splice(r,1)}(g-S._models.length);for(var x=0,E=0;E<n.length;E++){var _,w=n[E],T=x+(_=v[E]);M(w,_,S._models.slice(x,T)),x=T}function M(e,t,r){for(var i=e.getLengths(t),n=e.getPoints(t),o=new THREE.Vector3(S._startPoint[0],0,S._startPoint[1]),a=new THREE.Vector3(S._endPoint[0],0,S._endPoint[1]).clone().sub(o).normalize(),s=null,l=0;l<r.length;l++){var c=r[l],u=null;s?(u=i[l+1]-s,s=i[l+1]):u=s=i[l+1];var h=new THREE.Vector3(n[l].x,0,n[l].y),p=new THREE.Vector3(n[l+1].x,0,n[l+1].y);p=h.clone().add(a.clone().multiplyScalar(u/2)),c.localPosition=[p.x,0,p.z],c.node.quaternion.setFromUnitVectors(new THREE.Vector3(1,0,0),a),c.scale=[u/m,1,1]}}}(),i&&i()}})},i.prototype._setupVertexNode=function(){this._startVertex&&this._startVertex.destroy(),this._endVertex&&this._endVertex.destroy(),this._startVertex=this.app.create({type:"Thing"}),this.add(this._startVertex),this._startVertex.localPosition=[this._startPoint[0],0,this._startPoint[1]],this._endVertex=this.app.create({type:"Thing"}),this.add(this._endVertex),this._endVertex.localPosition=[this._endPoint[0],0,this._endPoint[1]]},i.prototype.updateFence=function(e){if(this.loaded&&!this._fenceUpdating){this._fenceUpdating=!0;var t=this;this._setupModel(function(){t._fenceUpdating=!1,t.combineFence(e)})}},i.prototype.sortDoor=function(){var e=this._doors;if(e&&0<e.length)for(var t=0;t<e.length-1;t++)for(var r=0;r<e.length-1-t;r++)if(e[r].percent>e[r+1].percent){var i=e[r];e[r]=e[r+1],e[r+1]=i}return e},i.prototype.addDoor=function(e,t){this._doors||(this._doors=[]),this._doors.push({percent:e,width:t}),this.sortDoor()},i.prototype.removeDoor=function(e){for(var t=0;t<this._doors.length;t++)if(this._doors[t].percent-e<=.001)return this._doors.splice(t,1),!0;return!1},i.prototype.getDoor=function(e){if(this._doors)for(var t=0;t<this._doors.length;t++){var r=this._doors[t];if(r.percent-e<=.001)return Z.cloneObject(r)}return null},i.prototype.combineFence=function(t){var n=this;if(this._combineModel)for(var e=0;e<this._combineModel.length;e++){var r=this._combineModel[e];this.app.resourceManager.remove(r)}this._combineModel=[];for(var i=new combine.Processor,o=0;o<this._models.length;o++){var a=this._models[o].node;i.addModel(a)}i.delayBuild(function(e){n.node.add(e),n._combineModel.push(e);for(var t=e.getMaterials(),r=0;r<t.length;r++){var i=t[r];i.defines&&i.defines.USE_ALPHAINDEX&&delete i.defines.USE_ALPHAINDEX}}).then(function(){for(var e=0;e<n._models.length;e++)n._models[e].destroy();n.static&&n.node._synMatrixWorld(),n._models=[],t&&t()})},l(i,[{key:"worldStartPoint",get:function(){return[this._startVertex.position[0],this._startVertex.position[2]]},set:function(e){if(e instanceof Array&&2<=e.length){var t=[e[0]-this.position[0],e[1]-this.position[2]];this.startPoint=t}}},{key:"worldEndPoint",get:function(){return[this._endVertex.position[0],this._endVertex.position[2]]},set:function(e){if(e instanceof Array&&2<=e.length){var t=[e[0]-this.position[0],e[1]-this.position[2]];this.endPoint=t}}},{key:"startPoint",get:function(){return this._startPoint=[this._startVertex.localPosition[0],this._startVertex.localPosition[2]],this._startPoint},set:function(e){this._startVertex&&(this._startVertex.localPosition=[e[0],0,e[1]]),this._startPoint=e}},{key:"endPoint",get:function(){return this._endPoint=[this._endVertex.localPosition[0],this._endVertex.localPosition[2]],this._endPoint},set:function(e){this._endVertex&&(this._endVertex.localPosition=[e[0],0,e[1]]),this._endPoint=e}},{key:"fenceLength",get:function(){return this._lineCurve.getLength()}},{key:"doors",get:function(){return this._doors}},{key:"collisionBox",get:function(){return this._collisionBox}},{key:"fenceUpdating",get:function(){return this._fenceUpdating}},{key:"url",get:function(){return this._url},set:function(e){this._url=e}},{key:"worldlineCurve",get:function(){var e=Z.parseVector2(this.worldStartPoint),t=Z.parseVector2(this.worldEndPoint);return new THREE.LineCurve(e,t)}},{key:"lineCurve",get:function(){var e=Z.parseVector2(this.startPoint),t=Z.parseVector2(this.endPoint);return this._lineCurve=new THREE.LineCurve(e,t),this._lineCurve}}]),i}(Ee),vr=function(r){function i(e){y(this,i);var t=p(this,r.call(this,e));return t._controlPoint=null,t._controlVertex=null,t}return u(i,r),i.prototype.setupCommonInfo=function(e){r.prototype.setupCommonInfo.call(this,e),this._controlPoint=e.controlPoint},i.prototype._setupModel=function(o){var h=this;!function(){for(var e=0;e<h._models.length;e++)h._models[e].destroy();h._models=[]}(),this._setupVertexNode(),this.app.create({type:"Thing",visible:!1,url:this._url,complete:function(e){var t,r,i,n;h._modelSize=e.object.boundingBox.initSize,t=Z.parseVector2(h._startVertex.position),r=Z.parseVector2(h._controlVertex.position),i=Z.parseVector2(h._endVertex.position),n=new THREE.QuadraticBezierCurve(t,r,i),h._lineCurve?h._lineCurve.getLength()!=n.getLength()&&(h._lineCurve=n):h._lineCurve=n,function(){var e=h._lineCurve.getLength(),c=h._modelSize[0],u=e/c,t=u%1;u=Math.floor(u),.1<t&&(u+=1);var r=u-h._models.length;(function(){if(0<r)for(var e=0;e<r;e++)h._models.push(h.app.create({url:h._url,type:"Thing",parent:h}));else if(r<0)for(var t=Math.abs(r)-1;0<=t;t--)h._models[t].destroy(),h._models.splice(t,1)})(),function(){for(var e=h._lineCurve.getLengths(u),t=h._lineCurve.getPoints(u),r=null,i=0;i<h._models.length;i++){var n=h._models[i],o=null;r?(o=e[i+1]-r,r=e[i+1]):o=r=e[i+1];var a=new THREE.Vector3(t[i].x,0,t[i].y),s=new THREE.Vector3(t[i+1].x,0,t[i+1].y),l=s.clone().sub(a).normalize();s=a.clone().add(l.clone().multiplyScalar(o/2)),n.position=[s.x,0,s.z],n.node.quaternion.setFromUnitVectors(new THREE.Vector3(1,0,0),l),n.scale=[o/c,1,1]}}()}(),o&&o()}})},i.prototype._setupVertexNode=function(){r.prototype._setupVertexNode.call(this),this._controlVertex&&this._controlVertex.destroy(),this._controlVertex=this.app.create({type:"Thing"}),this.add(this._controlVertex),this._controlVertex.localPosition=[this._controlPoint[0],0,this._controlPoint[1]]},l(i,[{key:"worldControlPoint",get:function(){return[this._startVertex.position[0],this._startVertex.position[2]]},set:function(e){if(e instanceof Array&&2<=e.length){var t=[e[0]-this.position[0],e[1]-this.position[2]];this.controlPoint=t}}},{key:"controlPoint",get:function(){return this._controlPoint=[this._controlVertex.localPosition[0],this._controlVertex.localPosition[2]],this._controlPoint},set:function(e){this._controlVertex&&(this._controlVertex.localPosition=[e[0],0,e[1]]),this._controlPoint=e}}]),i}(gr),yr=function(r){function i(e){y(this,i);var t=p(this,r.call(this,e));return t._points=[],t._shape=null,t._ground=null,t._level=1,t._repeatUV=[],t._vertexNode=[],t._textureUrl=null,t._regionPoints=[],t}return u(i,r),i.prototype.loadFromURL=function(e,t){this._url=e.url,this._setupGround(),t()},i.prototype.setupFromURL=function(e){if(e.node)this._setup(e);else{var t=this;this.loadFromURL(e,function(){t._setup(e)})}},i.prototype._setup=function(e){this.setupUserData();var t=e.node;if(t){if(this._stateFlags.hasFlags(Ee.stateHideBySceneFlag)){var r=new THREE.Group;r.position.copy(t.position),r.quaternion.copy(t.quaternion),r.scale.copy(t.scale),(this._hideNodesInScene=t).removeBySelf(),t=r}this.setupNode(t)}this.setupParent(e),this.customSetup(e),this.setupComplete(e)},i.prototype.setup=function(e){this.setupID(e),e.url?this.setupFromURL(e):this._setup(e)},i.prototype.setupCommonInfo=function(e){r.prototype.setupCommonInfo.call(this,e),this._points=e.points,this._repeatUV=e.repeatUV,this._level=e.level},i.prototype.setupComplete=function(e){r.prototype.setupComplete.call(this,e)},i.prototype._setupGround=function(){var o=this;this._regionPoints=this._points,o._ground&&(o.app.resourceManager.remove(o._ground),o._ground=null),function(e){if(o._vertexNode&&0<o._vertexNode.length)for(var t=0;t<o._vertexNode.length;t++){o._vertexNode[t].destroy()}o._vertexNode=[];for(var r=0;r<e.length;r++){var i=e[r],n=o.app.create({type:"Thing"});o.add(n),n.ratio=i.ratio||0,n.localPosition=[i.pos[0],0,i.pos[1]],o._vertexNode.push(n)}}(this._points),this._setupShape(),function(){var e=(new THREE.TextureLoader).load(o._url);e.wrapS=e.wrapT=THREE.RepeatWrapping;var t=new THREE.ShapeGeometry(o._shape);t.rotateX(Math.PI/2);var r=new THREE.MeshLambertMaterial({side:THREE.DoubleSide,map:e});r.polygonOffset=!0,o._ground=new THREE.Mesh(t,r),o._ground.receiveShadow=!0,o.node.add(o._ground),o._textureUrl=null}(),this._setupRepeatUV(),this._setupLevel()},i.prototype._setupTexture=function(){if(this._textureUrl!=this._url){this._textureUrl=this._url;var e=(new THREE.TextureLoader).load(this._url);e.wrapS=e.wrapT=THREE.RepeatWrapping,this._ground.material.map=e}},i.prototype._setupLevel=function(){var e=this._ground.material;e.polygonOffsetFactor=0,e.polygonOffsetUnits=10*this._level},i.prototype._setupRepeatUV=function(){if(this._repeatUV&&0<this._repeatUV.length){var e=this._ground.material,t=this._repeatUV[0]/this.boundingBox.size[0],r=this._repeatUV[1]/this.boundingBox.size[2];e.map.repeat.fromArray([t,r]),e.map.wrapT=e.map.wrapS=THREE.RepeatWrapping}else{t=(e=this._ground.material).map.repeat.x*this.boundingBox.size[0];var i=e.map.repeat.y*this.boundingBox.size[2];this._repeatUV=[t,i]}},i.prototype._setupShape=function(){var S=this;if(this._vertexNode){for(var e=!1,t=0;t<this._vertexNode.length;t++)if(0<this._vertexNode[t].ratio){e=!0;break}e?function(){S._shape=new THREE.Shape;for(var e=[],t=[],r=0;r<S._vertexNode.length;r++){var i=S._vertexNode[0==r?S._vertexNode.length-1:r-1],n=S._vertexNode[r],o=S._vertexNode[r==S._vertexNode.length-1?0:r+1];0<n.ratio?(e.push((a=[i.localPosition[0],i.localPosition[2]],s=[n.localPosition[0],n.localPosition[2]],l=[o.localPosition[0],o.localPosition[2]],c=n.ratio,g=m=p=h=u=void 0,u=Z.parseVector2(a),h=Z.parseVector2(s),p=Z.parseVector2(l),d=h.distanceTo(u)/2,f=h.distanceTo(p)/2,m=h.clone().add(u.clone().sub(h).normalize().multiplyScalar(d*c)),g=h.clone().add(p.clone().sub(h).normalize().multiplyScalar(f*c)),{a:m.toArray(),b:s,c:g.toArray()})),t.push(!0)):(e.push({point:[n[0],n[2]]}),t.push(!1))}for(var a,s,l,c,u,h,p,d,f,m,g,v=null,y=0;y<e.length;y++){var b=e[y],x=e[y==e.length-1?0:y+1],E=t[y],_=t[y==t.length-1?0:y+1];if(0==y&&(v=E?b.a:b.point,S._shape.moveTo(v[0],v[1])),E){var w=b.b,T=b.c;S._shape.quadraticCurveTo(w[0],w[1],T[0],T[1]);var M=_?x.a:x.point;S._shape.lineTo(M[0],M[1])}else{M=_?x.a:x.point;S._shape.lineTo(M[0],M[1])}y==e.length-1&&S._shape.lineTo(v[0],v[1])}}():function(){S._shape=new THREE.Shape;var e=S._vertexNode[0];S._shape.moveTo(e.localPosition[0],e.localPosition[2]);for(var t=0;t<S._vertexNode.length;t++){var r=S._vertexNode[t==S._vertexNode.length-1?0:t+1];S._shape.lineTo(r.localPosition[0],r.localPosition[2])}S._shape.lineTo(e.localPosition[0],e.localPosition[2])}()}},i.prototype.updateRegion=function(){this._setupGround(),this._setupTexture(),this._setupLevel(),this._setupRepeatUV()},i.prototype.getFencesData=function(){this._setupShape();for(var e=this._shape.curves,t=[],r=null,i=null,n=0;n<e.length;n++){var o=e[n];if(0==n)r=o;else if(n==e.length-1){if(0==o.getLength())return t;i=o}var a={};"LineCurve"==o.type?(a.startPoint=o.v1.toArray(),a.endPoint=o.v2.toArray(),a.type="Fence"):(a.startPoint=o.v0.toArray(),a.controlPoint=o.v1.toArray(),a.endPoint=o.v2.toArray(),a.type="CurveFence"),t.push(a)}return a={},"LineCurve"!=r.type?a.endPoint=r.v0.toArray():a.endPoint=r.v1.toArray(),a.type="Fence",a.startPoint=i.v2.toArray(),t.push(a),t},l(i,[{key:"repeatUV",get:function(){return this._repeatUV},set:function(e){this._repeatUV=e}},{key:"level",get:function(){return this._level},set:function(e){this._level=e}},{key:"worldPoints",get:function(){for(var e=[],t=0;t<this._vertexNode.length;t++){var r=this._vertexNode[t];this._points[t].pos=[r.position[0],r.position[2]],e.push({pos:[r.position[0],r.position[2]],ratio:this.points[t].ratio})}return e},set:function(e){for(var t=0;t<this._vertexNode.length;t++){var r=this._vertexNode[t],i=e[t].pos;r.position=[i[0],this.position[1],i[1]],this._points[t].pos=[r.localPosition[0],r.localPosition[2]]}}},{key:"points",get:function(){for(var e=0;e<this._vertexNode.length;e++){var t=this._vertexNode[e];this._points[e].pos=[t.localPosition[0],t.localPosition[2]]}return this._points},set:function(e){this._points=e;for(var t=0;t<this._vertexNode.length;t++){var r=this._vertexNode[t],i=e[t];r.localPosition=[i[0],this.position[1],i[1]]}}},{key:"url",get:function(){return this._url},set:function(e){this._url!=e&&(this._url=e)}}]),i}(Ee),br=function(r){function i(e){y(this,i);var t=p(this,r.call(this,e));return t._points=[],t}return u(i,r),i.prototype._updateByPoints=function(){},i.prototype._createPolygonVertices=function(e){for(var t=[],r=0;r<this._points.length;r++){var i=this._points[r],n=new THREE.Vector3(i.x,i.z,i.y);t.push(n)}THREE.ShapeUtils.isClockWise(t)||(t=t.reverse());var o=[],a=THREE.ShapeUtils.triangulateShape(t,[]);for(r=0;r<a.length;r++)o.push(new THREE.Face3(a[r][0],a[r][1],a[r][2]));var s=new THREE.Matrix4;for(this.node.updateWorldMatrix(!0),s.getInverse(this.node.matrixWorld),r=0;r<t.length;r++){if(n=t[r],!e){var l=n.z;n.z=n.y,n.y=l}n.applyMatrix4(s)}return{vertices:t,faces:o}},i.prototype._createPolygonGeometry=function(e,t){var r=new THREE.Geometry;return r.vertices=e,r.faces=t,r.genFaceVertexUVs(),r},i.prototype.clearPoints=function(){this._points=[],this._updateByPoints()},i.prototype.insertPoint=function(e,t){t=Z.parseVector3(t),this._points.splice(e,0,t),this._updateByPoints()},i.prototype.setPoint=function(e,t){return!(e>=this._points.length||!t||(t=Z.parseVector3(t),this._points[e]=t,this._updateByPoints(),0))},i.prototype.getPoint=function(e){return e>=this._points.length?null:this._points[e].toArray()},i.prototype.addPoint=function(e){return e=Z.parseVector3(e),this._points.push(e),this._updateByPoints(),this._points.length-1},i.prototype.addPoints=function(e){for(var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:_.World,r=0;r<e.length;r++){var i=Z.parseVector3(e[r]);t==_.Local?i=Z.parseVector3(this.localToWorld(i.toArray())):t==_.Self&&(i=Z.parseVector3(this.selfToWorld(i.toArray()))),this._points.push(i)}this._updateByPoints()},i.prototype.removePoints=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1;this._points.splice(e,t),this._updateByPoints()},i.prototype.inside=function(e){for(var t=this.planePoints,r=e[0],i=e[1],n=!1,o=0,a=t.length,s=a-1;o<a;s=o,o++){var l=t[o][0],c=t[o][1],u=t[s][0],h=t[s][1];if((l===r&&c===i||u===r&&h===i)&&(n=!n),c<i&&i<=h||i<=c&&h<i){var p=l+(i-c)*(u-l)/(h-c);p===r&&(n=!n),r<p&&(n=!n)}}return!!n},i.prototype.clearPathPoints=function(){console.warn("[PointsBase] Please use '.clearPoints()' to replace 'clearPathPoints()'"),this.clearPoints()},i.prototype.removePoint=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1;console.warn("[LineBase] Please use '.removePoints' to replace '.removePoint'"),this.removePoints(e,t)},l(i,[{key:"points",get:function(){for(var e=[],t=0;t<this._points.length;t++)e.push(this._points[t].toArray());return e}},{key:"planePoints",get:function(){for(var e=[],t=0;t<this._points.length;t++){var r=this._points[t];e.push([r.x,r.z])}return e}},{key:"area",get:function(){for(var e=[],t=0;t<this._points.length;t++){var r=this._points[t];e.push(new THREE.Vector2(r.x,r.z))}var i=THREE.ShapeUtils.area(e);return Math.abs(i)}},{key:"centerPos",get:function(){return new polylabel([this.planePoints])}},{key:"avgHeight",get:function(){if(!this._points.length)return 0;for(var e=0,t=0;t<this._points.length;t++)e+=this._points[t].y;return e/this._points.length}}]),i}(Ee),xr=function(r){function i(e){y(this,i);var t=p(this,r.call(this,e));return t._lineMesh=null,t._areaMesh=null,t._textRegion=null,t}return u(i,r),i.prototype._updateTextPosition=function(){if(this._textRegion){var e=this.centerPos;this._textRegion.position=[e[0],this.position.y,e[1]],this._textRegion.translateY(.01)}},i.prototype._updateByPoints=function(){if(!(this._points.length<3)){var e=new THREE.MeshBasicMaterial({color:this.style.regionColor,opacity:this.style.regionOpacity,transparent:!0,side:THREE.DoubleSide,depthWrite:!1}),t=this._createPolygonVertices(),r=this._createPolygonGeometry(t.vertices,t.faces);this.app.resourceManager.remove(this._areaMesh),this._areaMesh=new THREE.Mesh(r,e),this.node.add(this._areaMesh);var i=new THREE.LineBasicMaterial({color:this.style.lineColor});this.app.resourceManager.remove(this._lineMesh),(r=new THREE.Geometry).vertices=t.vertices,r.vertices.push(t.vertices[0]),this._lineMesh=new THREE.Line(r,i),this._lineMesh.userData.skipPick=!0,this.node.add(this._lineMesh)}},i.prototype._beforeSetupComplete=function(e){var t=e.points||e.vertices;t&&this.addPoints(t);var r=e.fontText||e.text;r&&(this.text=r),Z.parseValue(e.alwaysOnTop,!0)&&(this.style.alwaysOnTop=!0);var i=this.style;i.lineColor=Z.parseColor(e.lineColor,i.lineColor),i.regionOpacity=Z.parseValue(e.regionOpacity||e.opacity,i.regionOpacity),i.regionColor=Z.parseColor(e.regionColor,i.regionColor)},l(i,[{key:"textRegion",get:function(){if(!this._textRegion){var e={type:"TextRegion",parent:this};this._textRegion=this.app.create(e),this._textRegion._mesh.renderOrder=1,this._textRegion.angleX=-90,this._textRegion.translateY(.1)}return this._textRegion}},{key:"text",set:function(e){this._textRegion.text=e,this._updateTextPosition()},get:function(){return this._textRegion.text}},{key:"style",get:function(){return r.prototype._getStyle.call(this)}},{key:"lineColor",set:function(e){console.warn('[PolygonRegion]Please use ".style.lineColor" to replace ".lineColor"'),this.style.lineColor=e},get:function(){return console.warn('[PolygonRegion]Please use ".style.lineColor" to replace ".lineColor"'),this.style.lineColor}},{key:"regionColor",set:function(e){console.warn('[PolygonRegion]Please use ".style.regionColor" to replace ".regionColor"'),this.style.regionColor=e},get:function(){return console.warn('[PolygonRegion]Please use ".style.regionColor" to replace ".regionColor"'),this.style.regionColor}},{key:"regionOpacity",set:function(e){console.warn('[PolygonRegion]Please use ".style.regionOpacity" to replace ".regionOpacity"'),this.style.regionOpacity=e},get:function(){return this.style.regionOpacity}}]),i}(br),Er=null,_r=function(a){function r(e){y(this,r);var t=p(this,a.call(this,e));return t.node=new THREE.Group,t._map=null,t._tex=null,t._params={},t}return u(r,a),r.prototype.setup=function(e){a.prototype.setup.call(this,e),null==this._parent&&(this._parent=this.app.outdoors),this.node&&null==this.node.parent&&this.parent.node.add(this.node),this._map=(Er||(Er=new SimpleHeatmap),Er);var t=void 0!==e.opacity?e.opacity:1,r=this._tex=new THREE.Texture(this._map.canvas()),i=this._material=new THREE.MeshBasicMaterial({map:r,side:THREE.DoubleSide,transparent:!0,opacity:t}),n=new THREE.PlaneGeometry(e.width||10,e.height||10),o=new THREE.Mesh(n,i);this.node.add(o),this._initParameter(e),this._refresh()},r.prototype._initParameter=function(e){var t=this._params;t.areaWidth=e.width||10,t.areaHeight=e.height||10,t.mapSize=e.mapSize||256,t.alpha=!!e.alpha,t.gradient=e.gradient||{.4:"blue",.6:"cyan",.7:"lime",.8:"yellow",1:"red"},t.minValue=e.minValue||10,t.maxValue=e.maxValue||50,t.radius=e.radius||.8,t.blur=e.blur||.8,t.data=e.data||[]},r.prototype.setParameter=function(e){var t=this._params;t.areaWidth=e.width||t.areaWidth,t.areaHeight=e.height||t.areaHeight,t.mapSize=e.mapSize||t.mapSize,t.alpha=void 0!==e.alpha?e.alpha:t.alpha,t.gradient=e.gradient||t.gradient,t.minValue=e.minValue||t.minValue,t.maxValue=e.maxValue||t.maxValue,t.radius=e.radius||t.radius,t.blur=e.blur||t.blur,t.data=e.data||t.data,this._refresh()},r.prototype.addData=function(e){this._params.data.push(e),this._refresh()},r.prototype.setData=function(e){this._params.data=e,this._refresh()},r.prototype.setAlpha=function(e){this._params.alpha=e,this._refresh()},r.prototype.setRadius=function(e,t){this._params.radius=e,void 0!==t&&(this._params.blur=t),this._refresh()},r.prototype.setGradient=function(e){this._params.gradient=e,this._refresh()},r.prototype.randomData=function(){for(var e=this._params,t=[],r=0;r<Math.round(e.areaWidth*e.areaHeight);r++)t.push([(Math.random()-.5)*e.areaWidth,(Math.random()-.5)*e.areaHeight,Math.pow(Math.random(),3)*(e.maxValue-e.minValue)+e.minValue]);this.setData(t)},r.prototype._refresh=function(){var e=this._params,t=1,r=1,i=e.mapSize/e.areaWidth;e.areaWidth!=e.areaHeight&&(e.areaWidth>e.areaHeight?(t=1,r=e.areaHeight/e.areaWidth):(t=e.areaWidth/e.areaHeight,r=1,i=e.mapSize/e.areaHeight));var n=1;e.radius*i<1&&(n=1/e.radius*i+1e-4);var o=e.data.map(function(e){return[e[0]*n,e[1]*n,e[2]]});this._map.setCanvasSize(Math.floor(e.mapSize*t),Math.floor(e.mapSize*r)).setAreaSize(e.areaWidth*n,e.areaHeight*n).min(e.minValue).max(e.maxValue).alpha(e.alpha).gradient(e.gradient).radius(Math.floor(e.radius*i*n),Math.floor(e.blur*i*n)).data(o).draw(),this._tex.needsUpdate=!0,this.app.renderer.setTexture2D(this._tex,0)},l(r,[{key:"isHeatmap",get:function(){return console.warn("[Heatmap] Please use 'instanceof THING.Heatmap' to replace '.isHeatmap'"),this instanceof THING.Heatmap}}]),r}(Ee),wr=function(r){function i(e){y(this,i);var t=p(this,r.call(this,e));return t.pathTexture=null,t.pathWidth=1,t.pathCornerRadius=.3,t.pathCornerSplit=10,t.pathScrollUV=!1,t.pathScrollSpeed=10,t.pathPlayingTween=null,t.pathUp=new THREE.Vector3(0,1,0),t.pathPointList=null,t.pathGeometry=null,t.pathLine=null,t}return u(i,r),i.prototype.synPathTexture=function(e){this.pathTexture=e,this.pathLine&&(this.pathLine.material.map=this.pathTexture,this.pathLine.material.needsUpdate=!0)},i.prototype._setupPoints=function(e){var t=e.points;if(t){var r=e.spaceType,i=e.local;!r&&i&&(r=SpaceType.Local),this.addPoints(t,r)}},i.prototype._setupPathLine=function(e){this.scrollUV=Z.parseValue(e.scrollUV,!1),this.uvRatio=e.uvRatio||1,this.width=Z.parseValue(e.width,this.width),this.side=Z.parseValue(e.side,"both"),this.close=Z.parseValue(e.close,!1);var t=Z.parseValue(e.doubleSide,!0),r=new THREE.MeshBasicMaterial({depthWrite:!0,transparent:!0,side:t?THREE.DoubleSide:THREE.BackSide}),i=Z.parseValue(e.drawMode,THREE.TriangleStripDrawMode);this.pathLine=new THREE.Mesh(this.pathGeometry,r),this.pathLine.drawMode=i;var n=e.image;n&&(this.style.image=n)},i.prototype._addPathLine=function(){this.node.add(this.pathLine)},i.prototype.customSetup=function(e){this._setupPathLine(e),this._setupPoints(e),this._addPathLine()},i.prototype._updateByPoints=function(){this.node.updateWorldMatrix(!0,!1);for(var e=[],t=0;t<this._points.length;t++){var r=this._points[t].clone();e.push(this.node.parent.worldToLocal(r))}2<=e.length&&this.pathPointList.set(e,this.pathCornerRadius,this.pathCornerSplit,this.pathUp,this.close)},i.prototype.updatePath=function(){if(this.pathScrollUV&&this.pathTexture){var e=this.scrollSpeed/1e3;return this.pathTexture.offset.x-=e,!0}return!1},i.prototype.update=function(e){return r.prototype.update.call(this,e)|this.updatePath()},i.prototype.play=function(e){var t=(e=e||{}).time||1e3,r=Z.parseValue(e.startProgress,0),i=Z.parseValue(e.endProgress,1),n=e.lerpType||S.Linear.None,o=e.complete,a=this,s={progress:r},l={progress:i};this.pathPlayingTween=new TWEEN.Tween(s).to(l,t).easing(n).onUpdate(function(){a.pathGeometry.update(a.pathPointList,{width:a.pathWidth,radius:a.pathWidth,arrow:!!this.arrowFlag,progress:this._object.progress})}).onComplete(function(){o&&o.call(a)}).start()},i.prototype.stop=function(){this.pathPlayingTween&&(this.pathPlayingTween.stop(),this.pathPlayingTween=null)},i.prototype.toJSON=function(){var e=r.prototype.toJSON.call(this);return e.image=this.image,e.scrollUV=this.scrollUV,e.points=this.points,e},l(i,[{key:"uvRatio",set:function(e){this.pathTexture&&(this.pathTexture.repeat.x=1/e)}},{key:"useTexture",set:function(e){var t=this.pathLine.material;t.map=e?this.pathTexture:null,t.needsUpdate=!0},get:function(){return null!==this.pathLine.material.map}},{key:"width",set:function(e){this.pathWidth=e,this._updateByPoints()},get:function(){return this.pathWidth}},{key:"scrollUV",set:function(e){this.pathScrollUV=e,this.tickable=!0},get:function(){return this.pathScrollUV}},{key:"scrollSpeed",set:function(e){this.pathScrollSpeed=THING.Math.clamp(e,-99,99)},get:function(){return this.pathScrollSpeed}},{key:"cornerRadius",set:function(e){this.pathCornerRadius=e,this._updateByPoints()},get:function(){return this.pathCornerRadius}},{key:"cornerSegments",set:function(e){this.pathCornerSplit=e,this._updateByPoints()},get:function(){return this.pathCornerSplit}},{key:"length",get:function(){if(this._points.length<=1)return 0;for(var e=0,t=this._points[0],r=1;r<this._points.length;r++){var i=this._points[r];e+=i.distanceTo(t),t=i}return e}},{key:"cornerSplit",set:function(e){console.warn("[LineBase] Please use '.cornerSegments' to replace '.cornerSplit'"),this.cornerSegments=e},get:function(){return console.warn("[LineBase] Please use '.cornerSegments' to replace '.cornerSplit'"),this.cornerSegments}}]),i}(br),Tr=function(){function t(e){y(this,t),this.app=e,this._points=[]}return t.prototype.set=function(e,t,r,i){this._points=e},l(t,[{key:"vertices",get:function(){for(var e=[],t=0;t<this._points.length;t++)e.push(Z.parseVector3(this._points[t]));return e}}]),t}(),Mr=function(r){function i(e){y(this,i);var t=p(this,r.call(this,e));return t.dotNode=null,t.pathGeometry=new THREE.BufferGeometry,t.pathGeometry.update=function(e,t){},t.dotGeometry=null,t.dotMaterial=null,t.pathPointList=new Tr,t}return u(i,r),i.prototype._updateByPoints=function(){r.prototype._updateByPoints.call(this);var e=this.pathPointList.vertices;e.length&&(this.pathGeometry.setFromPoints(e),this.pathLine.computeLineDistances(),this.dotGeometry&&this.dotGeometry.setFromPoints(e),this.node.setFrustumCulled(!1))},i.prototype._setupPathLine=function(e){var t,r=e.style||{},i=e.lineOpacity||1,n=Z.parseValue(e.lineDashSize||r.lineDashSize,0),o=Z.parseValue(e.lineGapSize||r.lineGapSize,0),a=e.lineWidth||1,s=e.color||255,l=this.pathPointList.vertices;t=n||o?new THREE.LineDashedMaterial({color:s,opacity:i,dashSize:n,gapSize:o,linewidth:a,transparent:!0}):new THREE.LineBasicMaterial({color:s,opacity:i,linewidth:a,transparent:!0}),this.pathGeometry.setFromPoints(l),this.pathLine=new THREE.Line(this.pathGeometry,t),this.pathLine.computeLineDistances();var c=e.dotColor||16777215,u=e.dotSize;u&&(this.dotGeometry=(new THREE.BufferGeometry).setFromPoints(l),this.dotMaterial=new THREE.PointsMaterial({color:c,size:u,sizeAttenuation:!1}),this.dotNode=new THREE.Points(this.dotGeometry,this.dotMaterial),this.node.add(this.dotNode))},i.prototype.showLines=function(e){this.pathLine.visible=e},i.prototype.showPoints=function(e){this.dotNode.visible=e},l(i,[{key:"isLine",get:function(){return console.warn("[Line] Please use 'instanceof THING.Line' to replace '.isLine'"),this instanceof THING.Line}}]),i}(wr),Sr=function(){this.pos=new THREE.Vector3,this.dir=new THREE.Vector3,this.right=new THREE.Vector3,this.up=new THREE.Vector3,this.dist=0,this.widthScale=1};Sr.prototype.lerpPathPoints=function(e,t,r){this.pos.lerpVectors(e.pos,t.pos,r),this.dir.lerpVectors(e.dir,t.dir,r),this.up.lerpVectors(e.up,t.up,r),this.right.lerpVectors(e.right,t.right,r),this.dist=(t.dist-e.dist)*r+e.dist,this.widthScale=(t.widthScale-e.widthScale)*r+e.widthScale},Sr.prototype.copy=function(e){this.pos.copy(e.pos),this.dir.copy(e.dir),this.up.copy(e.up),this.right.copy(e.right),this.dist=e.dist,this.widthScale=e.widthScale};var Rr=function(){this.array=[],this.count=0};Rr.prototype.set=function(e,t,r,i,n){if((e=e.slice(0)).length<2)return this.count=0,void console.warn("PathPointList: points length less than 2.");t=void 0!==t?t:.1,r=void 0!==r?r:10,(n=void 0!==n&&n)&&!e[0].equals(e[e.length-1])&&e.push((new THREE.Vector3).copy(e[0]));for(var o=0,a=e.length;o<a;o++)if(0===o)this._start(e[o],e[o+1],i);else if(o===a-1)if(n){this._corner(e[o],e[1],t,r,i);var s=this.array[0].dist;this.array[0].copy(this.array[this.count-1]),this.array[0].dist=s}else this._end(e[o]);else this._corner(e[o],e[o+1],t,r,i)},Rr.prototype.distance=function(){return 0==this.count?0:this.array[this.count-1].dist},Rr.prototype._start=function(e,t,r){this.count=0;var i=this._getByIndex(this.count);if(i.pos.copy(e),i.dir.subVectors(t,e),r)i.up.copy(r);else{var n=Number.MAX_VALUE,o=Math.abs(i.dir.x),a=Math.abs(i.dir.y),s=Math.abs(i.dir.z);o<n&&(n=o,i.up.set(1,0,0)),a<n&&(n=a,i.up.set(0,1,0)),s<n&&i.up.set(0,0,1)}i.right.crossVectors(i.dir,i.up).normalize(),i.up.crossVectors(i.right,i.dir).normalize(),i.dist=0,i.widthScale=1,i.dir.normalize(),this.count++};var Pr=new THREE.Vector3,Ar=new THREE.Vector3,Cr=new THREE.Vector3,Lr=new THREE.Matrix4,Or=new THREE.QuadraticBezierCurve3;Rr.prototype._corner=function(e,t,r,i,n){if(0<r&&0<i){for(var o=this.array[this.count-1],a=this._getCornerBezierCurve(o.pos,e,t,r,Or).getPoints(i),s=0;s<i;s+=1)this._hardCorner(a[s],a[s+1],n);a[i].equals(t)||this._hardCorner(a[i],t,n)}else this._hardCorner(e,t,n)},Rr.prototype._hardCorner=function(e,t,r){var i=this.array[this.count-1],n=this._getByIndex(this.count),o=Pr.subVectors(e,i.pos),a=Ar.subVectors(t,e),s=o.length();if(o.normalize(),a.normalize(),n.pos.copy(e),n.dir.addVectors(o,a),n.dir.normalize(),r)1===n.dir.dot(r)?n.right.crossVectors(a,r).normalize():n.right.crossVectors(n.dir,r).normalize(),n.up.crossVectors(n.right,n.dir).normalize();else{n.up.copy(i.up);var l=Cr.crossVectors(i.dir,n.dir);if(l.length()>Number.EPSILON){l.normalize();var c=Math.acos(Math.min(Math.max(i.dir.dot(n.dir),-1),1));n.up.applyMatrix4(Lr.makeRotationAxis(l,c))}n.right.crossVectors(n.dir,n.up).normalize()}n.dist=i.dist+s;var u=o.dot(a);n.widthScale=Math.min(1/Math.sqrt((1+u)/2),1.414213562373)||1,this.count++},Rr.prototype._end=function(e){var t=this.array[this.count-1],r=this._getByIndex(this.count);r.pos.copy(e),r.dir.subVectors(e,t.pos);var i=r.dir.length();r.dir.normalize(),r.up.copy(t.up);var n=Pr.crossVectors(t.dir,r.dir);if(n.length()>Number.EPSILON){n.normalize();var o=Math.acos(Math.min(Math.max(t.dir.dot(r.dir),-1),1));r.up.applyMatrix4(Lr.makeRotationAxis(n,o))}r.right.crossVectors(r.dir,r.up).normalize(),r.dist=t.dist+i,r.widthScale=1,this.count++},Rr.prototype._getByIndex=function(e){return this.array[e]||(this.array[e]=new Sr),this.array[e]},Rr.prototype._getCornerBezierCurve=function(e,t,r,i,n){var o=Pr.subVectors(t,e),a=Ar.subVectors(r,t),s=o.length(),l=a.length();return o.normalize(),a.normalize(),i<s?n.v0.copy(t).sub(o.multiplyScalar(i)):n.v0.copy(e),n.v1.copy(t),i<l?n.v2.copy(t).add(a.multiplyScalar(i)):n.v2.copy(r),n};var Hr=function(){this._drawing=!1,this._includeDrawingPoint=!1,this._points=[],this._lastPoint=new THREE.Vector3,this._lastFixedPoint=new THREE.Vector3,this.fixRadius=.5,this.height=.1,this._cornerRadius=.2,this._cornerSplit=10,this._pathPointList=new Rr,this._dirty=!0,this.up=new THREE.Vector3(0,1,0)};Object.defineProperty(Hr.prototype,"cornerRadius",{set:function(e){this._cornerRadius=e,this._dirty=!0},get:function(){return this._cornerRadius}}),Object.defineProperty(Hr.prototype,"cornerSplit",{set:function(e){this._cornerSplit=e,this._dirty=!0},get:function(){return this._cornerSplit}}),Hr.prototype.getPoints=function(){if(this._includeDrawingPoint&&(this._points.pop(),this._includeDrawingPoint=!1),this._drawing&&0<this._points.length){var e=this._getLastFixedPoint();e&&(this._points.push(e),this._includeDrawingPoint=!0)}return this._points},Hr.prototype.getPathPointList=function(){return(this._drawing||this._dirty)&&(this._pathPointList.set(this.getPoints(),this._cornerRadius,this._cornerSplit,this.up),this._dirty=!1),this._pathPointList},Hr.prototype.update=function(e){this._lastPoint.copy(e),this._lastPoint.y+=this.height},Hr.prototype.confirm=function(){this._drawing=!0;var e=this._getLastFixedPoint();e&&(this._includeDrawingPoint&&(this._points.pop(),this._includeDrawingPoint=!1),this._points.push(e.clone())),this._dirty=!0},Hr.prototype.start=function(){this._drawing=!0,this._dirty=!0},Hr.prototype.stop=function(){this._drawing=!1,this._dirty=!0},Hr.prototype.clear=function(){this._drawing=!1,this._includeDrawingPoint=!1,this._points=[],this._dirty=!0};var Fr=new THREE.Vector3,kr=new THREE.Vector3,Ir=new THREE.Vector3;Hr.prototype._getLastFixedPoint=function(){if(this._lastFixedPoint.copy(this._lastPoint),0<this._points.length){var e=this._includeDrawingPoint?this._points[this._points.length-2]:this._points[this._points.length-1];if(r=e,i=this._lastFixedPoint,Fr.copy(i).sub(r).length()<this.fixRadius&&(Fr.normalize().multiplyScalar(this.fixRadius),this._lastFixedPoint.copy(e).add(Fr)),this._includeDrawingPoint?2<this._points.length:1<this._points.length){var t=this._includeDrawingPoint?this._points[this._points.length-3]:this._points[this._points.length-2];if(kr.subVectors(e,t),Ir.subVectors(this._lastFixedPoint,e),kr.normalize(),Ir.normalize(),.99<kr.multiplyScalar(-1).dot(Ir))return null}}var r,i;return this._lastFixedPoint};var jr=function(e){THREE.BufferGeometry.call(this),e=e||3e3,this.addAttribute("position",new THREE.BufferAttribute(new Float32Array(3*e),3).setDynamic(!0)),this.addAttribute("normal",new THREE.BufferAttribute(new Float32Array(3*e),3).setDynamic(!0)),this.addAttribute("uv",new THREE.BufferAttribute(new Float32Array(2*e),2).setDynamic(!0)),this.drawRange.start=0,this.drawRange.count=0};jr.prototype=Object.assign(Object.create(THREE.BufferGeometry.prototype),{constructor:jr,update:function(e,t){t=t||{};var r=this._updateAttributes(e,t);this.drawRange.count=r},_resizeAttribute:function(e,t,r){for(;t.array.length<r;){var i=t.array.length;(t=t.clone()).setArray(new Float32Array(2*i)),this.addAttribute(e,t)}},_updateAttributes:function(e,t){var r=t.width||.1,i=void 0!==t.progress?t.progress:1,n=void 0===t.arrow||t.arrow,o=void 0!==t.side?t.side:"both",a=0,s=[],l=[],c=[],u=new THREE.Vector3,h=new THREE.Vector3;function p(e,t,r){e.dir;var i=e.up,n=e.right;"left"!==o?u.copy(n).multiplyScalar(t*e.widthScale):u.set(0,0,0),"right"!==o?h.copy(n).multiplyScalar(-t*e.widthScale):h.set(0,0,0),u.add(e.pos),h.add(e.pos),s.push(h.x,h.y,h.z,u.x,u.y,u.z),l.push(i.x,i.y,i.z,i.x,i.y,i.z),c.push(r,0,r,1),a+=2}var d=new THREE.Vector3,f=e.distance();if(0==f)return 0;var m,g,v,y,b,x,E,_=i*f;if(0<_)for(var w=0;w<e.count;w++){var T=e.array[w];if(T.dist>_){var M=e.array[w-1];m=new Sr;var S=(_-M.dist)/(T.dist-M.dist);m.lerpPathPoints(M,T,S),p(m,r/2,m.dist/("both"!==o?r/2:r));break}p(T,r/2,T.dist/("both"!==o?r/2:r))}else m=e.array[0];n&&(v=r/2,y=(g=m=m||e.array[e.count-1]).dist/("both"!==o?r/2:r),b=g.dir,x=g.up,E=g.right,"left"!==o?u.copy(E).multiplyScalar(2*v):u.set(0,0,0),"right"!==o?h.copy(E).multiplyScalar(2*-v):h.set(0,0,0),d.copy(b).setLength(3*v),u.add(g.pos),h.add(g.pos),d.add(g.pos),s.push(h.x,h.y,h.z,u.x,u.y,u.z,d.x,d.y,d.z),l.push(x.x,x.y,x.z,x.x,x.y,x.z,x.x,x.y,x.z),c.push(y,"both"!==o?"right"!==o?-2:0:-.5,y,"both"!==o?"left"!==o?2:0:1.5,y+3*v/("both"!==o?v:2*v),"both"!==o?0:.5),a+=3);var R=this.getAttribute("position"),P=this.getAttribute("normal"),A=this.getAttribute("uv");return this._resizeAttribute("position",R,s.length),this._resizeAttribute("normal",P,l.length),this._resizeAttribute("uv",A,c.length),R=this.getAttribute("position"),P=this.getAttribute("normal"),A=this.getAttribute("uv"),R.array.set(s,0),P.array.set(l,0),A.array.set(c,0),R.updateRange.count=s.length,P.updateRange.count=l.length,A.updateRange.count=c.length,R.needsUpdate=!0,P.needsUpdate=!0,A.needsUpdate=!0,a}});var Nr=function(e){jr.call(this,e||1e3),this.setIndex(new Array(2*(e||1e3)))};Nr.prototype=Object.assign(Object.create(jr.prototype),{constructor:Nr,_resizeIndex:function(e,t){for(;e.array.length<t;){var r=e.array.length;(e=e.clone()).setArray(65535<2*r?new Uint32Array(2*r):new Uint16Array(2*r)),this.setIndex(e)}},_updateAttributes:function(e,t){var r=t.radius||.1,i=t.radialSegments||8;i=Math.max(2,i);var n=void 0!==t.progress?t.progress:1,u=0,h=[],p=[],d=[],f=[],m=0,g=new THREE.Vector3;function o(e,t,r,i){for(var n=0===h.length,o=0;o<=r;o++){var a=o;a==r&&(a=0),g.copy(e.up).applyAxisAngle(e.dir,2*Math.PI*a/r).normalize(),h.push(e.pos.x+g.x*t*e.widthScale,e.pos.y+g.y*t*e.widthScale,e.pos.z+g.z*t*e.widthScale),p.push(g.x,g.y,g.z),d.push(i,o/r),m++}if(!n)for(var s=m-2*(r+1),l=m-(r+1),c=0;c<r;c++)f.push(s+c+1,s+c,l+c,l+c+1,s+c+1,l+c),u+=6}var a=n*e.distance();if(0==a)return 0;if(0<a)for(var s=0;s<e.count;s++){var l=e.array[s];if(l.dist>a){var c=e.array[s-1],v=new Sr,y=(a-c.dist)/(l.dist-c.dist);v.lerpPathPoints(c,l,y),o(v,r,i,v.dist/(2*r*Math.PI));break}o(l,r,i,l.dist/(2*r*Math.PI))}var b=this.getAttribute("position"),x=this.getAttribute("normal"),E=this.getAttribute("uv"),_=this.getIndex();return this._resizeAttribute("position",b,h.length),this._resizeAttribute("normal",x,p.length),this._resizeAttribute("uv",E,d.length),this._resizeIndex(_,f.length),b=this.getAttribute("position"),x=this.getAttribute("normal"),E=this.getAttribute("uv"),_=this.getIndex(),b.array.set(h,0),x.array.set(p,0),E.array.set(d,0),_.set(f,0),b.updateRange.count=h.length,x.updateRange.count=p.length,E.updateRange.count=d.length,_.updateRange.count=f.length,b.needsUpdate=!0,x.needsUpdate=!0,E.needsUpdate=!0,_.needsUpdate=!0,u}});var Dr=function(r){function i(e){y(this,i);var t=p(this,r.call(this,e));return t.arrowFlag=!0,t.side="both",t.pathGeometry=new jr,t.pathPointList=new Rr,t}return u(i,r),i.prototype._updateByPoints=function(){r.prototype._updateByPoints.call(this),this.pathGeometry.update(this.pathPointList,{width:this.pathWidth,side:this.side,arrow:this.arrowFlag}),this.pathGeometry.computeBoundingSphere()},i.prototype.setup=function(e){var t=Z.parseValue(e.arrowFlag,e.arrowCap);this.arrowFlag=Z.parseValue(t,!0),r.prototype.setup.call(this,e)},l(i,[{key:"progress",set:function(e){this.pathGeometry.update(this.pathPointList,{width:this.pathWidth,arrow:this.arrowFlag,side:this.side,progress:THING.Math.clamp(e,0,1)})}},{key:"scorllUVRange",set:function(e){var t=this.length/this.pathWidth;this.uvRatio=t*e}},{key:"arrowCap",set:function(e){this.arrowFlag=e,this.pathGeometry.update(this.pathPointList,{width:this.pathWidth,arrow:this.arrowFlag,side:this.side})},get:function(){return this.arrowFlag}},{key:"isRouteLine",get:function(){return console.warn("[RouteLine] Please use 'instanceof THING.RouteLine' to replace '.RouteLine'"),this instanceof THING.RouteLine}}]),i}(wr),Ur=function(r){function i(e){y(this,i);var t=p(this,r.call(this,e));return t.pathWidth=.2,t.pathRadialSegments=8,t.pathGeometry=new Nr,t.pathPointList=new Rr,t.pathUp=void 0,t}return u(i,r),i.prototype._setupPathLine=function(e){(e=e||{}).drawMode=THREE.TrianglesDrawMode,r.prototype._setupPathLine.call(this,e)},i.prototype._updateByPoints=function(){r.prototype._updateByPoints.call(this),this.pathGeometry.update(this.pathPointList,{radius:this.pathWidth,radialSegments:this.pathRadialSegments}),this.pathGeometry.computeBoundingSphere()},l(i,[{key:"progress",set:function(e){this.pathGeometry.update(this.pathPointList,{radius:this.pathWidth,radialSegments:this.pathRadialSegments,progress:THING.Math.clamp(e,0,1)})}},{key:"scorllUVRange",set:function(e){var t=this.length/(2*this.pathWidth*Math.PI);this.uvRatio=t*e}},{key:"isPolygonLine",get:function(){return console.warn("[PolygonLine] Please use 'instanceof THING.PolygonLine' to replace '.PolygonLine'"),this instanceof THING.PolygonLine}}]),i}(wr),Vr=function e(){y(this,e),this.strId="",this.fPPAfterImageValue=0,this.listGroups=new Array;var t=new Br;this.listGroups[0]=t,this._attr="ParticleData"};Vr.prototype={getAttr:function(){return this._attr}};var Br=function e(){y(this,e),this.strId="",this.texture=new qr,this.fFixedTimeStep=.33,this.strUseMesh="false",this.strMeshUrl="BuildIn/Box",this.arrayMeshParams=new Array,this.arrayMeshParams.push(1),this.arrayMeshParams.push(1),this.arrayMeshParams.push(1),this.arrayMeshParams.push(1),this.arrayMeshParams.push(1),this.arrayMeshParams.push(1),this.strHasPerspective="true",this.strIsColorize="true",this.iBlendingMode=1,this.strIsTransparent="true",this.fAlphaTest=0,this.strIsDepthWrite="false",this.strIsDepthTest="false",this.strIsFog="false",this.strEnableTrail="false",this.textureTrail=new qr,this.fTrailLife=.5,this.fTrailWidthStart=1,this.fTrailWidthEnd=1,this.fScale=window.innerHeight/2,this.iMaxParticleCount=500,this.vec4Quaternion=new THREE.Vector4(0,0,0,1),this.listEmitters=new Array;var t=new zr;this.listEmitters[0]=t},zr=function e(){y(this,e),this.strId="",this.iDistribution=1,this.iParticleCount=100,this.fDuration=-1,this.strIsStatic="false",this.strIsLookAtCamera="false",this.strIsLookAtCameraOnlyY="false",this.fActiveMultiplier=1,this.iDirection=1,this.maxAge=new Gr,this.position=new Wr,this.velocity=new Xr,this.acceleration=new Yr,this.drag=new Qr,this.wiggle=new Jr,this.rotation=new Kr,this.trail=new Zr,this.listColor=new Array;var t=new $r;this.listColor[0]=t,this.listOpacity=new Array;var r=new ei;this.listOpacity[0]=r,this.listSize=new Array;var i=new ti;this.listSize[0]=i,this.listAngle=new Array;var n=new ri;this.listAngle[0]=n},qr=function e(){y(this,e),this.name="32x32_star.png",this.url="http://static.3dmomoda.com/textures/18092617nyspq5moaka1i2fhvs1hh66s.png",this.vec2Frames=new THREE.Vector2(1,1),this.iFrameCount=1,this.iLoop=1},Gr=function e(){y(this,e),this.fValue=1,this.fSpread=1},Wr=function e(){y(this,e),this.vec3Value=new THREE.Vector3(0,0,0),this.vec3Spread=new THREE.Vector3(0,0,0),this.vec3SpreadClamp=new THREE.Vector3(0,0,0),this.fRadius=0,this.vec3RadiusScale=new THREE.Vector3(1,1,1),this.iDistribution=1,this.strIsRandomise="false"},Xr=function e(){y(this,e),this.vec3Value=new THREE.Vector3(0,10,0),this.vec3Spread=new THREE.Vector3(10,0,10),this.iDistribution=1,this.strIsRandomise="false"},Yr=function e(){y(this,e),this.vec3Value=new THREE.Vector3(0,0,0),this.vec3Spread=new THREE.Vector3(0,0,0),this.iDistribution=1,this.strIsRandomise="false"},Qr=function e(){y(this,e),this.fValue=0,this.fSpread=0,this.strIsRandomise="false"},Jr=function e(){y(this,e),this.fValue=0,this.fSpread=0},Zr=function e(){y(this,e),this.fValue=0,this.fSpread=0,this.fStep=0,this.fStepSpread=0},Kr=function e(){y(this,e),this.vec3Axis=new THREE.Vector3(0,0,0),this.vec3AxisSpread=new THREE.Vector3(0,0,0),this.fAngle=0,this.fAngleSpread=0,this.strIsStatic="false",this.vec3Center=new THREE.Vector3(0,0,0),this.strIsRandomise="false"},$r=function e(){y(this,e),this.vec3Value=new THREE.Vector3(1,1,1),this.vec3Spread=new THREE.Vector3(0,0,0),this.strIsRandomise="false"},ei=function e(){y(this,e),this.fValue=1,this.fSpread=0,this.strIsRandomise="false"},ti=function e(){y(this,e),this.fValue=1,this.fSpread=0,this.strIsRandomise="false"},ri=function e(){y(this,e),this.fValue=0,this.fSpread=0,this.strIsRandomise="false"},ii=function(){var s="[BufferGeometryHelper.js] : ";this.bEnableLog=!0,this.bufferGeometry=null,this.jsonLoader=new THREE.BufferGeometryLoader,this.objLoader=new THREE.OBJLoader,this.strMeshUrl=null;var l=this;this.init=function(o,a){if(l.bEnableLog&&console.log(s+"[init];"),null!=a&&null!=a){if(null==o||null==o||"object"!=(void 0===o?"undefined":h(o)))return console.error(s+"[init] : options == null;"),void a(null);if(null==o.strMeshUrl||null==o.strMeshUrl||"string"!=typeof o.strMeshUrl)return console.error(s+"[init] : options.strMeshUrl == null;"),void a(null);if(l.strMeshUrl=o.strMeshUrl,null!=l.bufferGeometry&&null!=l.bufferGeometry&&(l.bufferGeometry.dispose(),l.bufferGeometry=null),0<=o.strMeshUrl.indexOf("BuildIn")){var e=!1;return 0<=o.strMeshUrl.indexOf("Box")&&(l.bEnableLog&&console.log(s+"[init] : it's a BoxBufferGeometry;"),e=!l.checkParams(o.params,3),l.bufferGeometry=e?new THREE.BoxBufferGeometry(1,1,1):new THREE.BoxBufferGeometry(o.params[0],o.params[1],o.params[2])),0<=o.strMeshUrl.indexOf("Cylinder")&&(l.bEnableLog&&console.log(s+"[init] : it's a CylinderBufferGeometry;"),e=!l.checkParams(o.params,4),l.bufferGeometry=e?new THREE.CylinderBufferGeometry(1,1,1,6):new THREE.CylinderBufferGeometry(o.params[0],o.params[1],o.params[2],o.params[3]<=12?o.params[3]:12)),0<=o.strMeshUrl.indexOf("Cone")&&(l.bEnableLog&&console.log(s+"[init] : it's a ConeBufferGeometry;"),e=!l.checkParams(o.params,3),l.bufferGeometry=e?new THREE.ConeBufferGeometry(1,1,6):new THREE.ConeBufferGeometry(o.params[0],o.params[1],o.params[2]<=12?o.params[2]:12)),0<=o.strMeshUrl.indexOf("Circle")&&(l.bEnableLog&&console.log(s+"[init] : it's a CircleBufferGeometry;"),e=!l.checkParams(o.params,2),l.bufferGeometry=e?new THREE.CircleBufferGeometry(1,6):new THREE.CircleBufferGeometry(o.params[0],o.params[1]<=12?o.params[1]:12)),0<=o.strMeshUrl.indexOf("Dodecahedron")&&(l.bEnableLog&&console.log(s+"[init] : it's a DodecahedronBufferGeometry;"),e=!l.checkParams(o.params,2),l.bufferGeometry=e?new THREE.DodecahedronBufferGeometry(1,0):new THREE.DodecahedronBufferGeometry(o.params[0],o.params[1]<=1?o.params[1]:1)),0<=o.strMeshUrl.indexOf("Icosahedron")&&(l.bEnableLog&&console.log(s+"[init] : it's a IcosahedronBufferGeometry;"),e=!l.checkParams(o.params,2),l.bufferGeometry=e?new THREE.IcosahedronBufferGeometry(1,0):new THREE.IcosahedronBufferGeometry(o.params[0],o.params[1]<=1?o.params[1]:1)),0<=o.strMeshUrl.indexOf("Octahedron")&&(l.bEnableLog&&console.log(s+"[init] : it's a OctahedronBufferGeometry;"),e=!l.checkParams(o.params,2),l.bufferGeometry=e?new THREE.OctahedronBufferGeometry(1,0):new THREE.OctahedronBufferGeometry(o.params[0],o.params[1]<=2?o.params[1]:1)),0<=o.strMeshUrl.indexOf("Plane")&&(l.bEnableLog&&console.log(s+"[init] : it's a PlaneBufferGeometry;"),e=!l.checkParams(o.params,2),l.bufferGeometry=e?new THREE.PlaneBufferGeometry(1,0):new THREE.PlaneBufferGeometry(o.params[0],o.params[1])),0<=o.strMeshUrl.indexOf("Ring")&&(l.bEnableLog&&console.log(s+"[init] : it's a RingBufferGeometry;"),e=!l.checkParams(o.params,3),l.bufferGeometry=e?new THREE.RingBufferGeometry(1,2,12,1):new THREE.RingBufferGeometry(o.params[0],o.params[1],o.params[2]<=12?o.params[2]:12,1)),0<=o.strMeshUrl.indexOf("Sphere")&&(l.bEnableLog&&console.log(s+"[init] : it's a SphereBufferGeometry;"),e=!l.checkParams(o.params,3),l.bufferGeometry=e?new THREE.SphereBufferGeometry(1,8,8):new THREE.SphereBufferGeometry(o.params[0],o.params[1]<=12?o.params[1]:12,o.params[2]<=12?o.params[2]:12)),0<=o.strMeshUrl.indexOf("Tetrahedron")&&(l.bEnableLog&&console.log(s+"[init] : it's a TetrahedronBufferGeometry;"),e=!l.checkParams(o.params,2),l.bufferGeometry=e?new THREE.TetrahedronBufferGeometry(1,0):new THREE.TetrahedronBufferGeometry(o.params[0],o.params[1]<=2?o.params[1]:2)),0<=o.strMeshUrl.indexOf("Torus")&&o.strMeshUrl.indexOf("TorusKnot")<0&&(l.bEnableLog&&console.log(s+"[init] : it's a TorusBufferGeometry;"),e=!l.checkParams(o.params,4),l.bufferGeometry=e?new THREE.TorusBufferGeometry(1,1,8,8):new THREE.TorusBufferGeometry(o.params[0],o.params[1],o.params[2]<=12?o.params[2]:12,o.params[3]<=12?o.params[3]:12)),0<=o.strMeshUrl.indexOf("TorusKnot")&&(l.bEnableLog&&console.log(s+"[init] : it's a TorusKnotBufferGeometry;"),e=!l.checkParams(o.params,6),l.bufferGeometry=e?new THREE.TorusKnotBufferGeometry(1,1,32,8,2,3):new THREE.TorusKnotBufferGeometry(o.params[0],o.params[1],o.params[2]<=32?o.params[2]:32,o.params[3]<=12?o.params[3]:12,o.params[4]<=12?o.params[4]:12,o.params[5]<=12?o.params[5]:12)),void a(l.bufferGeometry)}var t=o.strMeshUrl.indexOf(".json");0<=t&&t+".json".length==o.strMeshUrl.length&&(l.bEnableLog&&console.log(s+"[init] : it's a .json file to BufferGeometry;"),l.jsonLoader.load(Globals.strParticleMeshRootPath+o.strMeshUrl,function(e){return null!=e&&null!=e?(l.bufferGeometry=e,void a(l.bufferGeometry)):(console.error(s+"[init] : failed load the .json file to BufferGeometry; strMeshUrl = "+o.strMeshUrl),void a(null))}));var r=o.strMeshUrl.indexOf(".obj");0<=r&&r+".obj".length==o.strMeshUrl.length&&(l.bEnableLog&&console.log(s+"[init] : it's a .obj file to BufferGeometry;"),l.objLoader.load(Globals.strParticleMeshRootPath+o.strMeshUrl,function(e){if(null!=e&&null!=e&&null!=e.children){for(var t=null,r=0,i=e.children.length;r<i;r++)if(e.children[r]instanceof THREE.Mesh){t=e.children[r];break}if(null==t)return console.error(s+"[init] : failed load the .obj file to BufferGeometry; can not find a mesh; strMeshUrl = "+o.strMeshUrl),void a(null);var n=(new THREE.BufferGeometry).fromGeometry(t.geometry);return null!=n&&null!=n?(l.bufferGeometry=n,void a(l.bufferGeometry)):(console.error(s+"[init] : failed transform the .obj file to BufferGeometry; strMeshUrl = "+o.strMeshUrl),void a(null))}},function(e){},function(e){console.error(s+"[init] : failed load the .obj file to BufferGeometry; strMeshUrl = "+o.strMeshUrl+"; error = "+e),a(null)}))}else console.error(s+"[init] : onFinished == null;")},this.checkParams=function(e,t){if(null==e||null==e||"object"!=(void 0===e?"undefined":h(e)))return console.warn(s+"[checkParams] : params == null;"),!1;if(e.length<t)return console.warn(s+"[checkParams] : params.length < "+t),!1;for(var r=0;r<t;r++)if(null==e[r]||null==e[r]||"number"!=typeof e[r])return console.warn(s+"[checkParams] : error params["+r+"];"),!1;return!0}},ni=function(){function i(e,t,r){y(this,i),this._options=e,this._emitter=t,this._particleGroup=r,this._emitter||this.refresh()}return i.prototype.cloneOptions=function(){return Z.cloneObject(this._options,!1,null,function(e,t){if(Z.isFunction(e.clone))return e.clone()})},i.prototype.refresh=function(){this._emitter&&(this._particleGroup._group.removeEmitter(this._emitter),this._emitter=null);var e=this.cloneOptions();this._particleGroup._options.useMesh?this._emitter=new MSPE.Emitter(e):this._emitter=new SPE.Emitter(e),this._particleGroup._group.addEmitter(this._emitter)},l(i,[{key:"options",set:function(e){e&&(Z.mergeObject(this._options,e,!0),this.refresh())},get:function(){return this._options}}]),i}(),oi=function(){function i(e,t,r){y(this,i),this._options=e,this._group=t,this._particleSystem=r,this._emitters=[],this._group||this.refresh()}return i.prototype.cloneOptions=function(){var e=Z.cloneObject(this._options,!1,function(e){return"texture"!=e&&"bufferGeometry"!=e},function(e,t){if(Z.isFunction(e.clone))return e.clone()}),t=this._options.vec4Quaternion;return t&&(e.vec4Quaternion=t.clone()),e},i.prototype.refresh=function(){-1===this._particleSystem._groups.indexOf(this)&&this._particleSystem._groups.push(this),this._group&&this._group.mesh&&this._particleSystem.node.remove(this._group.mesh);for(var e=0;e<this._emitters.length;e++){var t=this._emitters[e];this._group.removeEmitter(t._emitter)}var r=this.cloneOptions();for(r.useMesh?this._group=new MSPE.Group(r):this._group=new SPE.Group(r),e=0;e<this._emitters.length;e++){var i=this._emitters[e],n=i.cloneOptions();r.useMesh?i._emitter=new MSPE.Emitter(n):i._emitter=new SPE.Emitter(n),this._group.addEmitter(i._emitter)}var o=this._group.mesh;o&&(this._particleSystem.node.add(o),o.setFrustumCulled(!1))},i.prototype.tick=function(e,t){this._group.tick(e,t)},i.prototype.addEmitter=function(e){return new ni(e,null,this)},i.prototype.removeEmitter=function(e){for(var t=0;t<this._emitters.length;t++)if(e==this._emitters[t]){this._emitters.splice(t,1),this._group.removeEmitter(e._emitter);break}},l(i,[{key:"options",set:function(e){e&&(Z.mergeObject(this._options,e,!0),this.refresh())},get:function(){return this._options}}]),i}(),ai=function(r){function i(e){y(this,i);var t=p(this,r.call(this,e));return t._groups=[],t}return u(i,r),i.prototype.loadFromURL=function(t,r){var i=this;t.node||(t.node=new THREE.Group);var e=t.url,n=this.app.particleResource.get(e);n?this.loadComplete(n,t,r):this.app.particleResource.download(e,function(e){i.loadComplete(e,t,r)})},i.prototype.loadComplete=function(e,t,r){this.setupParticleData(e,t),this.setupUserData(),null!=r&&r()},i.prototype.customSetup=function(e){this.tickable=!0},i.prototype.update=function(e){for(var t=0;t<this._groups.length;t++)this._groups[t].tick(e,this.app.renderCamera);return!0},i.prototype.parseEmitterOptions=function(e,t){var r,i=new THREE.Vector3(e.position.vec3Value.x,e.position.vec3Value.y,e.position.vec3Value.z),n=new THREE.Vector3(e.position.vec3Spread.x,e.position.vec3Spread.y,e.position.vec3Spread.z),o=new THREE.Vector3(e.position.vec3SpreadClamp.x,e.position.vec3SpreadClamp.y,e.position.vec3SpreadClamp.z);r="true"==e.position.strIsRandomise.valueOf();var a=new THREE.Vector3(e.velocity.vec3Value.x,e.velocity.vec3Value.y,e.velocity.vec3Value.z),s=new THREE.Vector3(e.velocity.vec3Spread.x,e.velocity.vec3Spread.y,e.velocity.vec3Spread.z);e.velocity.strIsRandomise.valueOf();var l,c=new THREE.Vector3(e.acceleration.vec3Value.x,e.acceleration.vec3Value.y,e.acceleration.vec3Value.z),u=new THREE.Vector3(e.acceleration.vec3Spread.x,e.acceleration.vec3Spread.y,e.acceleration.vec3Spread.z);l="true"==e.acceleration.strIsRandomise.valueOf();var h;h="true"==e.strIsStatic.valueOf();var p,d=new THREE.Vector3(e.rotation.vec3Axis.x,e.rotation.vec3Axis.y,e.rotation.vec3Axis.z),f=new THREE.Vector3(e.rotation.vec3AxisSpread.x,e.rotation.vec3AxisSpread.y,e.rotation.vec3AxisSpread.z),m=new THREE.Vector3(e.rotation.vec3Center.x,e.rotation.vec3Center.y,e.rotation.vec3Center.z);p="true"==e.rotation.strIsStatic.valueOf();var g;g="true"==e.rotation.strIsRandomise.valueOf();var v=new Array,y=new Array,b=new Array;if(0<e.listColor.length)for(var x=0,E=e.listColor.length;x<E;x++)v.push(new THREE.Color(e.listColor[x].vec3Value.x,e.listColor[x].vec3Value.y,e.listColor[x].vec3Value.z)),y.push(new THREE.Vector3(e.listColor[x].vec3Spread.x,e.listColor[x].vec3Spread.y,e.listColor[x].vec3Spread.z)),"true"==e.listColor[x].strIsRandomise.valueOf()?b.push(!0):b.push(!1);else v.push(new THREE.Color("white")),y.push(new THREE.Vector3(0,0,0)),b.push(!1);var _=new Array,w=new Array,T=new Array;if(0<e.listOpacity.length)for(x=0,E=e.listOpacity.length;x<E;x++)_.push(e.listOpacity[x].fValue),w.push(e.listOpacity[x].fSpread),"true"==e.listOpacity[x].strIsRandomise.valueOf()?T.push(!0):T.push(!1);else _.push(1),w.push(0),T.push(!1);var M=new Array,S=new Array,R=new Array;if(0<e.listSize.length)for(x=0,E=e.listSize.length;x<E;x++)M.push(e.listSize[x].fValue),S.push(e.listSize[x].fSpread),"true"==e.listSize[x].strIsRandomise.valueOf()?R.push(!0):R.push(!1);else M.push(1),S.push(0),R.push(!1);var P=new Array,A=new Array,C=new Array;if(0<e.listAngle.length)for(x=0,E=e.listAngle.length;x<E;x++)P.push(e.listAngle[x].fValue),A.push(e.listAngle[x].fSpread),"true"==e.listAngle[x].strIsRandomise.valueOf()?R.push(!0):C.push(!1);else P.push(0),A.push(0),C.push(!1);return{type:e.iDistribution,particleCount:e.iParticleCount,duration:e.fDuration<=0?void 0:e.fDuration,isStatic:h,isLookAtCamera:"true"==e.strIsLookAtCamera,isLookAtCameraOnlyY:"true"==e.strIsLookAtCameraOnlyY,activeMultiplier:e.fActiveMultiplier,direction:e.iDirection,trail:{value:e.trail.fValue,spread:e.trail.fSpread,step:e.trail.fStep,stepSpread:e.trail.fStepSpread},maxAge:{value:e.maxAge.fValue,spread:e.maxAge.fSpread},position:{value:i,spread:n,spreadClamp:o,radius:e.position.fRadius,radiusScale:new THREE.Vector3(1,1,1),randomise:r},radius:{value:5,spread:0,scale:new THREE.Vector3(1,1,1),spreadClamp:new THREE.Vector3(2,2,2)},velocity:{value:a,spread:s,randomise:!1},acceleration:{value:c,spread:u,randomise:l},drag:{value:e.drag.fValue,spread:e.drag.fSpread},wiggle:{value:e.wiggle.fValue,spread:e.wiggle.fSpread},rotation:{axis:d,axisSpread:f,angle:e.rotation.fAngle,angleSpread:e.rotation.fAngleSpread,static:p,center:m,randomise:g},color:{value:v,spread:y,randomise:b},opacity:{value:_,spread:w,randomise:T},size:{value:M,spread:S,randomise:R},angle:{value:P,spread:A,randomise:C}}},i.prototype.parseGroupOptions=function(e,t){var r=this.app.calcRect(),i={texture:{value:t,frames:e.texture.vec2Frames,frameCount:e.texture.iFrameCount,loop:e.texture.iLoop},fixedTimeStep:e.fFixedTimeStep,hasPerspective:"true"==e.strHasPerspective,colorize:"true"==e.strIsColorize,blending:e.iBlendingMode,transparent:"true"==e.strIsTransparent,alphaTest:e.fAlphaTest,depthWrite:"true"==e.strIsDepthWrite,depthTest:"true"==e.strIsDepthTest,fog:"true"==e.strIsFog,scale:r.height/2,maxParticleCount:e.iMaxParticleCount,useMesh:"true"==e.strUseMesh},n=e.vec4Quaternion;return n&&(i.vec4Quaternion=new THREE.Quaternion(n.x,n.y,n.z,n.w)),i},i.prototype.setupParticleEmitter=function(e,t,r){var i=this.parseEmitterOptions(e,t),n=new ni(i,null,r);r._emitters.push(n)},i.prototype.setupParticleEmitters=function(e,t){for(var r=0;r<e.listEmitters.length;r++){var i=e.listEmitters[r];this.setupParticleEmitter(i,e,t)}this.static&&this.node._synMatrixWorld()},i.prototype.createParticleGroup=function(e){return new oi(e,null,this)},i.prototype.setupParticleGroup=function(n){var o=this,e=new THREE.TextureLoader;e.setCrossOrigin("anonymous");var t=n.texture.url;e.load(t,function(e){var r=o.parseGroupOptions(n,e);if(r.useMesh){var t=new ii;t.bEnableLog=!1,t.init({strMeshUrl:n.strMeshUrl,params:n.arrayMeshParams},function(e){r.bufferGeometry=e;var t=o.createParticleGroup(r);o.setupParticleEmitters(n,t)})}else{var i=o.createParticleGroup(r);o.setupParticleEmitters(n,i)}})},i.prototype.setupParticleData=function(e,t){var r=new Vr;(r=e).__proto__=Vr.prototype;for(var i=0;i<r.listGroups.length;i++){var n=r.listGroups[i];this.setupParticleGroup(n)}},i.prototype.refresh=function(){for(var e=0;e<this._groups.length;e++)this._groups[e].refresh()},l(i,[{key:"gravityPosition",set:function(e){var t=Z.parseVector3(e),r=Z.parseVector3(this.position),i=new THREE.Vector3;i.subVectors(t,r).normalize();var n=new THREE.Quaternion;n.setFromUnitVectors(new THREE.Vector3(0,-1,0),i);for(var o=0;o<this._groups.length;o++){var a=this._groups[o];a.options.vec4Quaternion=new THREE.Vector4(n.x,n.y,n.z,n.w),a.refresh()}}}]),i}(Ee),si=function(r){function i(e){y(this,i);var t=p(this,r.call(this,e));return t._scale=4,t._color="#FFFFFF",t._flowDirection=new THREE.Vector2(1,1),t._textureWidth=1024,t._textureHeight=1024,t._normalMaps=[],t._normalMapsURL=[],t.water=null,t}return u(i,r),i.prototype._updateByPoints=function(){if(this._points.length){var e=this._createPolygonVertices(!0),t=this._createPolygonGeometry(e.vertices,e.faces),r=0;if(e.vertices.length){for(var i=0;i<e.vertices.length;i++)r+=e.vertices[i].z;r/=e.vertices.length}this.app.resourceManager.remove(this.water),this.water=new THREE.Water(t,{color:this._color,scale:this._scale,flowDirection:this._flowDirection,textureWidth:this._textureWidth,textureHeight:this._textureHeight,normalMap0:this._normalMaps[0],normalMap1:this._normalMaps[1]}),this.water.position.y=r,this.water.scale.y*=-1,this.water.rotation.x=-.5*Math.PI,this.node.add(this.water)}},i.prototype._setupTextures=function(e){for(var t=new THREE.TextureLoader,r=[e.normalMap0||"images/water/Water_1_M_Normal.jpg",e.normalMap1||"images/water/Water_2_M_Normal.jpg"],i=0;i<r.length;i++){var n=r[i];n&&(this._normalMapsURL.push(n),this._normalMaps.push(t.load(this.app.confirmURL(n))))}this._textureWidth=1024,this._textureHeight=1024},i.prototype.customSetup=function(e){r.prototype.customSetup.call(this,e),this._scale=Z.parseValue(e.waterScale,4),this._color=Z.parseColor(e.waterColor,"#FFFFFF"),this._flowDirection=Z.parseVector2(e.flowDirection,new THREE.Vector2(1,1)),this._setupTextures(e);var t=e.points;t&&this.addPoints(t)},i.prototype.toJSON=function(){var e=r.prototype.toJSON.call(this);e.waterScale=this._scale,e.waterColor=this._color,e.flowDirection=this._flowDirection,e.points=this.points;for(var t=0;t<this._normalMapsURL.length;t++)e["normalMap"+t]=this._normalMapsURL[t];return e},i.prototype.setEffect=function(e){console.warn("[Water] Please use '.style.setEffect()' to replace '.setEffect()'"),this.style.setEffect(e)},l(i,[{key:"isWater",get:function(){return console.warn("[Water] Please use 'instanceof THING.Water' to replace '.Water'"),!0}}]),i}(br),li=function(r){function i(e){y(this,i);var t=p(this,r.call(this,e));return t._lightAngle=Math.PI/3,t.spotLight=null,t.centerObject=null,t}return u(i,r),i.prototype._syn=function(){if(this.spotLight.angle=this.lightAngle,this.spotLight.intensity=this.intensity,this.spotLight.penumbra=this.penumbra,this.spotLight.castShadow=this.castShadow,this.spotLight.distance=this.distance,this.centerObject){var e=THING.Math.clamp(this.intensity,0,1);this.centerObject.node.material.emissive.setRGB(e,e,e)}},i.prototype.customSetup=function(e){var t=e.centerNodeName;t&&(this.centerNodeName=t),this.spotLight=new THREE.SpotLight,this.node.add(this.spotLight),this._syn()},l(i,[{key:"lightAngle",set:function(e){this._lightAngle=e,this._syn()},get:function(){return this._lightAngle}},{key:"lightOffset",set:function(e){e=Z.parseVector3(e),this.spotLight.position.copy(e)},get:function(){return this.spotLight.position.toArray()}},{key:"lightTarget",set:function(e){e instanceof BaseObject?this.spotLight.target=e.node:(e=Z.parseVector3(e),this.spotLight.target=new THREE.Object3D,this.spotLight.target.position.copy(e),this.spotLight.target.updateMatrixWorld(!0))},get:function(){var e=new THREE.Vector3;return this.spotLight.target.getWorldPosition(e),e.toArray()}},{key:"centerNodeName",set:function(e){var t=this.query("/"+e);t.length&&(this.centerObject=t[0],this._syn())}}]),i}(function(r){function i(e){y(this,i);var t=p(this,r.call(this,e));return t._prevIntensity=1,t._intensity=1,t._penumbra=.5,t._castShadow=!1,t._distance=5,t._turnOn=!0,t}return u(i,r),i.prototype._syn=function(){},i.prototype.customSetup=function(e){this._intensity=e.intensity||1,this._penumbra=e.penumbra||.5,this._castShadow=e.castShadow||!1,this._distance=e.distance||5},i.prototype.update=function(e){r.prototype.update.call(this,e)},i.prototype.toJSON=function(){return r.prototype.toJSON.call(this)},l(i,[{key:"intensity",set:function(e){this._turnOn?this._intensity=e:this._prevIntensity=e,this._syn()},get:function(){return this._intensity}},{key:"penumbra",set:function(e){this._penumbra=e,this._syn()},get:function(){return this._penumbra}},{key:"castShadow",set:function(e){this._castShadow=e,this._syn()},get:function(){return this._castShadow}},{key:"distance",set:function(e){this._distance=e,this._syn()},get:function(){return this._distance}},{key:"turnOn",set:function(e){this._turnOn=e,this._intensity=e?this._prevIntensity:(this._prevIntensity=this._intensity,0),this._syn()},get:function(){return this._turnOn}}]),i}(Ee)),ci=function(o){function r(e){y(this,r);var t=p(this,o.call(this,e));return t._image="",t._texture=null,t._width=10,t._scrollSpeed=0,t._resolution=new THREE.Vector2,t._updateResolutionFunc=t._updateResolution.bind(t),t._helpGeometry=new THREE.Geometry,t._helpGeometry.vertices=t._points,t._meshline=new THREE.MeshLine,t._material=null,t._uvTransformDirty=!0,t}return u(r,o),r.prototype._updateResolution=function(e){this._resolution.set(e.size[0],e.size[1])},r.prototype.customSetup=function(e){o.prototype.customSetup.call(this,e);var t=e.image;t&&(t.isTexture?(this._image=t.name,this._texture=t):(this._image=t,this._texture=(new THREE.TextureLoader).load(t,function(e){e.wrapS=e.wrapT=THREE.RepeatWrapping,e.anisotropy=16})));var r=e.points;r&&this.addPoints(r),this._width=e.width||this._width,this.uvRatio=e.uvRatio||1,this.scrollSpeed=e.scrollSpeed||this._scrollSpeed;var i=this.app.calcRect();this._resolution.set(i.width,i.height),this._material=new THREE.MeshLineMaterial({map:this._texture,useMap:!!this._texture,color:new THREE.Color(1,1,1),opacity:1,resolution:this._resolution,sizeAttenuation:!1,lineWidth:this._width,near:this.app.renderCamera.near,far:this.app.renderCamera.far,side:THREE.DoubleSide}),this._material.extensions.derivatives=!this.app.renderer.capabilities.isWebGL2,this.app.on("resize",this._updateResolutionFunc);var n=new THREE.Mesh(this._meshline.geometry,this._material);this.node.add(n)},r.prototype.destroy=function(){o.prototype.destroy.call(this),this.app.off("resize",this._updateResolutionFunc)},r.prototype.update=function(e){var t=o.prototype.update.call(this,e);if(this._texture){var r=this._texture;return 0!==this._scrollSpeed&&(r.offset.x+=this._scrollSpeed*e,this._uvTransformDirty=!0),this._uvTransformDirty&&(r.matrix.setUvTransform(r.offset.x,r.offset.y,r.repeat.x,r.repeat.y,r.rotation,r.center.x,r.center.y),this._material.uniforms.uvTransform.value.copy(r.matrix)),!0}return t},r.prototype._updateByPoints=function(){this._meshline.setGeometry(this._helpGeometry)},r.prototype.toJSON=function(){var e=o.prototype.toJSON.call(this);return e.image=this._image,e.scrollSpeed=this._scrollSpeed,e.points=this.points,e},l(r,[{key:"uvRatio",set:function(e){this._texture&&(this._texture.repeat.x=e,this._uvTransformDirty=!0)}},{key:"width",set:function(e){this._width=e,this._material&&(this._material.uniforms.lineWidth.value=e)},get:function(){return this._width}},{key:"scrollSpeed",set:function(e){this._scrollSpeed=THING.Math.clamp(e,-99,99)},get:function(){return this._scrollSpeed}}]),r}(br),ui={defines:{WORLD:!1,COLOR_LINEAR:!0,ALPHA_LINEAR:!0,ANIM:!1,SCROLL:!1},uniforms:{color1:{value:new THREE.Color(255)},color2:{value:new THREE.Color(255)},opacity1:{value:1},opacity2:{value:0},range:{value:new THREE.Vector2(0,3)},colorStep:{value:new THREE.Vector2(.3,.7)},opacityStep:{value:new THREE.Vector2(.3,.7)},time:{value:0}},vertexShader:"\n        varying vec3 vNormal;\n        varying float vYFactor;\n        varying float vSeed;\n\n        uniform vec2 range;\n\n        void main() {\n            vNormal = (vec4(normalMatrix * normal, 0.0) * viewMatrix).xyz;\n            #ifdef WORLD\n                vec3 worldPosition = (modelMatrix * vec4( position, 1.0 )).xyz;\n                vYFactor = (worldPosition.y - range.x) / (range.y - range.x);\n            #else\n                vYFactor = (position.y - range.x) / (range.y - range.x);\n            #endif\n            vSeed = -position.x + position.z;\n            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n        }\n    ",fragmentShader:"\n        varying vec3 vNormal;\n        varying float vYFactor;\n        varying float vSeed;\n\n        uniform vec3 color1;\n        uniform vec3 color2;\n\n        uniform float opacity1;\n        uniform float opacity2;\n\n        #ifndef COLOR_LINEAR\n            uniform vec2 colorStep;\n        #endif\n        #ifndef ALPHA_LINEAR\n            uniform vec2 opacityStep;\n        #endif\n\n        #if defined(ANIM) || defined(SCROLL)\n            uniform float time;\n        #endif\n        \n        void main() {\n            float yFactor = vYFactor;\n\n            #ifdef SCROLL\n                yFactor = fract(yFactor - (time * 2. / 3.14));\n            #endif\n\n            float colorFactor = yFactor;\n            #ifndef COLOR_LINEAR\n                colorFactor = smoothStep(colorStep.x, colorStep.y, colorFactor);\n            #endif\n            #ifdef ANIM\n                colorFactor *= abs(sin(time + vSeed));\n            #endif\n            \n            float opacityFactor = yFactor;\n            #ifndef ALPHA_LINEAR\n                opacityFactor = smoothStep(opacityStep.x, opacityStep.y, opacityFactor);\n            #endif\n            #ifdef ANIM\n                opacityFactor *= abs(sin(time + vSeed));\n            #endif\n            \n            gl_FragColor = vec4(mix(color1, color2, colorFactor), mix(opacity1, opacity2, opacityFactor));\n        }\n    "},hi=function(i){function r(e){y(this,r);var t=p(this,i.call(this,e));return t._height=10,t._geometry=new THREE.Geometry,t._material=new THREE.ShaderMaterial({defines:Object.assign({},ui.defines),uniforms:THREE.UniformsUtils.clone(ui.uniforms),vertexShader:ui.vertexShader,fragmentShader:ui.fragmentShader,side:THREE.DoubleSide,transparent:!0,depthWrite:!1}),t._material.uniforms.opacity1.value=.8,t._material.uniforms.opacity2.value=0,t}return u(r,i),r.prototype.customSetup=function(e){i.prototype.customSetup.call(this,e),this._height=e.height||this._height,this._material.uniforms.range.value.set(0,.8*this._height);var t=e.points;t&&this.addPoints(t),this.color=e.color||16711680,this.scroll=e.scroll||!1;var r=new THREE.Mesh(this._geometry,this._material);this.node.add(r)},r.prototype.destroy=function(){i.prototype.destroy.call(this),this.app.off("resize",this._updateResolutionFunc)},r.prototype.update=function(e){var t=i.prototype.update.call(this,e);return this._material.defines.SCROLL?(this._material.uniforms.time.value+=e,this._material.uniforms.time.value>Math.PI&&(this._material.uniforms.time.value=0),!0):t},r.prototype._updateByPoints=function(){var r=this,i=[],n=[],e=[],o=void 0,a=void 0,s=new THREE.Vector3,l=0;this.points.forEach(function(e,t){o=(new THREE.Vector3).fromArray(e),(a=(new THREE.Vector3).fromArray(e)).y+=r._height,i.push(o,a),0<t&&(l+=o.distanceTo(s)),n.push(new THREE.Vector2(l/r._height,0),new THREE.Vector2(l/r._height,1)),s.copy(o)});for(var t=0;t<i.length-2;t+=2)e.push(new THREE.Face3(t+1,t+0,t+2)),e.push(new THREE.Face3(t+2,t+3,t+1));this._geometry.vertices=i,this._geometry.uvs=n,this._geometry.faces=e,this._geometry.verticesNeedUpdate=!0,this._geometry.uvsNeedUpdate=!0,this._geometry.elementsNeedUpdate=!0,this._geometry.computeBoundingSphere(),this._geometry.computeFaceNormals()},r.prototype.toJSON=function(){var e=i.prototype.toJSON.call(this);return e.height=this._height,e.points=this.points,e},l(r,[{key:"height",set:function(e){this._height=e,this._material.uniforms.range.value.set(0,.8*this._height),this._updateByPoints()},get:function(){return this._height}},{key:"color",set:function(e){this._material.uniforms.color1.value.setHex(e),this._material.uniforms.color2.value.setHex(e)},get:function(){return this._material.uniforms.color1.value.getHex()}},{key:"scroll",set:function(e){this._material.defines.SCROLL!=e&&(this._material.defines.SCROLL=e,this._material.needsUpdate=!0),this.tickable=!0},get:function(){return this._material.defines.SCROLL}}]),r}(br),pi=function(){function i(e,t,r){y(this,i),this.object=null,this.useSpriteMaterial=e,this.node=t,this.domElement=r,this.cssObject=null}return i.prototype.onUpdate=function(e){var t=this.node,r=this.cssObject;t.updateMatrixWorld();var i=new THREE.Vector3,n=new THREE.Vector3,o=new THREE.Quaternion;t.matrixWorld.decompose(i,o,n),r.quaternion.copy(o),r.position.copy(i);var a=new THREE.Vector3;this.object._independentWorldScale?a=this.object._independentWorldScale.clone():this.object.node.getWorldScale(a);var s=t.userData.cssFactor||1;return this.cssObject.scale.copy(a),this.cssObject.scale.multiplyScalar(s/30),this.onVisible(this.object.node.ensureVisible()),!0},i.prototype.onAdd=function(e){this.object=e,this.useSpriteMaterial?this.cssObject=new THREE.CSS3DSprite(this.domElement):this.cssObject=new THREE.CSS3DObject(this.domElement),this.object.app.cssScene.add(this.cssObject),this.onUpdate(),this.object.tickable=!0},i.prototype.onRemove=function(){this.cssObject&&(this.object.app.cssScene.remove(this.cssObject),this.cssObject=null),this.object=null},i.prototype.onVisible=function(e){this.cssObject.visible=e;var t=this.domElement.style;e?"visible"!=t.visibility&&(t.visibility="visible"):"hidden"!=t.visibility&&(t.visibility="hidden")},i}(),di=function(r){function i(e){y(this,i);var t=p(this,r.call(this,e));return t._line=null,t._lineOffset=[0,0,0],t._factor=.01,t._initialSize=[1,1],t._size=[1,1],t._keepSize=!1,t._plane=null,t._planeSprite=null,t._sprite=null,t._canvas=null,t._url="",t}return u(i,r),i.prototype.updateConnectionLine=function(){if(!this._line)return!1;if(!this.parent)return!1;var e=THING.Math.addVector(this._lineOffset,this.position),t=this._lineToObject?this._lineToObject.position:this._lineToPosition;return this._line.setPoint(0,e),this._line.setPoint(1,t),!0},i.prototype._setupMaterial=function(e){var t=e.canvas,r=e.image,i=e.url;t?this.setCanvas(t):r?this.setImage(r):i&&(this._url=i)},i.prototype._setupSprite=function(i){var l=this,e=i.element;if(e){var t=e.cloneNode(!0),r=Z.parseSize(i),c=Z.parseValue(i.useSpriteMaterial,!0),n=new THREE.MeshBasicMaterial({opacity:.001,colorWrite:!1,transparent:!0,side:THREE.DoubleSide}),o=new THREE.PlaneGeometry(1,1);this._plane=new THREE.Mesh(o,n),this._plane.frustumCulled=!1,this._plane.renderOrder=1,this._plane.userData.domElement=t,this._plane.userData.skipOutline=!0,this._plane.userData.skipStyle=!0,this._plane.addBeforeRenderFunction("anchor",function(e,t,r){var i=this.userData.domElement,n=i.offsetWidth/i.offsetHeight,o=new THREE.Vector3;o.x=l._size[0]*n,o.y=l._size[1],o.z=1;var a=new THREE.Matrix4;if(c&&(a.copy(r.matrixWorldInverse),a.transpose()),a.copyPosition(this.matrixWorld),l._independentWorldScale)a.scale(l._independentWorldScale);else{var s=new THREE.Vector3;this.getWorldScale(s),a.scale(s)}a.scale(o),c&&(a.elements[3]=0,a.elements[7]=0,a.elements[11]=0,a.elements[15]=1),this.matrixWorld.copy(a)}),this.node.add(this._plane);var a=new THREE.SpriteMaterial({opacity:.001,colorWrite:!1,depthWrite:!1,transparent:!0});this._planeSprite=new THREE.Sprite(a),this._planeSprite.userData.cssFactor=r[0],this._planeSprite.userData.skipOutline=!0,this._planeSprite.userData.skipStyle=!0,this._planeSprite.userData.skipPick=!0,this.node.add(this._planeSprite),this.addControl(new pi(c,this._planeSprite,t))}else{var s;i.loadTextureComplete=function(e){var t=e.material,r=t._userData.bindMarkers;r&&r.forEach(function(e){e.synSize(),e._callComplete(i),s&&s()}),t._userData={}};var u=this.app.spriteResource.getMaterial(i);if((a=u.material)._userData=a._userData||{},a._userData.bindMarkers=a._userData.bindMarkers||[],a._userData.bindMarkers.push(this),(c=a.isSpriteMaterial)?this._sprite=new THREE.Sprite(a):(o=new THREE.PlaneGeometry(this._size[0],this._size[1]),this._sprite=new THREE.Mesh(o,a)),u.needLoadTexture){var h=Z.parseValue(i.visible,!0);h&&(this._sprite.setLayerVisible(!1),s=function(){setTimeout(function(){l._sprite.setLayerVisible(h)},10)})}this._sprite.renderOrder=1,this._sprite.userData.skipOutline=!0,this._setupMaterial(i),this.synSize(),this.node.add(this._sprite)}},i.prototype._setupLineNode=function(e){if(this._lineToPosition=e.lineToPosition,this._lineToObject=e.lineToObject,void 0!==this._lineToPosition||void 0!==this._lineToObject){var t=e.lineColor,r=this._lineToObject?this._lineToObject.position:this._lineToPosition;this._line=this.app.create({type:"Line",parent:this,points:[this.position,r],color:t,style:{lineOpacity:e.lineOpacity,lineDashSize:e.lineDashSize,lineGapSize:e.lineGapSize,lineWidth:e.lineWidth}}),this.tickable=!0}},i.prototype._setupLocalPosition=function(e){var t=e.parentBoundingBox;t||(t=this.parent.boundingBox);var r=this.worldToLocal(t.center),i=(e.offset||e.localPosition||[0,0,0]).concat();i[0]+=r[0],i[1]+=t.size[1],i[2]+=r[2];var n=Z.parseValue(e.ignoreParentScale,!1);this.setLocalPosition(i,n)},i.prototype.setupParent=function(e){var t=e.parent;t&&(e.parentBoundingBox=t.boundingBox),r.prototype.setupParent.call(this,e)},i.prototype.customSetup=function(e){this.setupTranslation(e),this._setupSprite(e),this._setupLineNode(e),this._factor=e.factor||this._factor,this._initialSize=Z.parseSize(e),this._size=this._initialSize.concat(),this.synSize()},i.prototype._afterSetupComplete=function(e){var t=e.alwaysOnTop;t&&(this.style.alwaysOnTop=t);var r=e.keepSize;r&&(this.keepSize=r)},i.prototype._callComplete=function(e){(this.image||this.canvas)&&r.prototype._callComplete.call(this,e)},i.prototype.destroy=function(){this._plane&&this._plane.removeBeforeRenderFunction("marker_element_plane"),this._sprite&&this._sprite.material&&(this._sprite.material._userData={}),this.app.spriteResource.unload(this.url),r.prototype.destroy.call(this)},i.prototype.update=function(e){return r.prototype.update.call(this,e)|this.updateConnectionLine()},i.prototype.synSize=function(){if(this._sprite){var e=this._sprite.material.map;if(e){var t=e.image;t&&(this._size[0]=this._factor*t.width*this._initialSize[0],this._size[1]=this._factor*t.height*this._initialSize[1])}}else this._planeSprite&&(this._planeSprite.userData.cssFactor=this._size[0]);if(this._keepSize){var r=this.getControl("MarkerSizeAdjustmentControl");r&&(r.size=this._size)}else this._sprite&&(this._sprite.scale.set(this._size[0],this._size[1],1),this.synIndependentWorldScale());this.static&&this.node._synMatrixWorld()},i.prototype._getIndependentControlRenderNode=function(){return this._sprite?this._sprite:r.prototype._getIndependentControlRenderNode.call(this)},i.prototype.cloneSelf=function(e){return e.localPosition=this.localPosition,e.size=this.size,this.url?e.url=this.url:this.canvas?e.canvas=this.canvas.clone():this.image&&(e.image=this.image.clone()),this.app.create(e)},i.prototype.setCanvas=function(e){if(e&&this._sprite){this._url=null,this._canvas=e;var t=new THREE.Texture(e);t.needsUpdate=!0,this._sprite.material.map=t}},i.prototype.setUrl=function(e){if(e){this.url&&this.app.spriteResource.unload(this.url),this._canvas=null,this._url=e;var t=this,r={url:e,alwaysOnTop:this.style.alwaysOnTop,loadTextureComplete:function(e){t.synSize(),t.trigger("urlchange",{image:t.image})}},i=this.app.spriteResource.getMaterial(r);if(i){var n=i.material;this._sprite.material=n,this.synSize()}}},i.prototype.setImage=function(e){e&&(e.width&&e.height?(this._url=null,this._sprite.material.map=this.app.resourceManager.loadTexture(e),this.synSize()):console.error("[Marker] set image failed, please make sure image has width and height attribute"))},i.prototype._setScale=function(e){var t=THING.Math.scaleVector(e,[this._size[0],this._size[1],1]);r.prototype._setScale.call(this,t)},i.prototype._getScale=function(){return THING.Math.divideVector(r.prototype._getScale.call(this),[this._size[0],this._size[1],1])},l(i,[{key:"isMarker",get:function(){return!0}},{key:"canvas",set:function(e){this._sprite.material=this._sprite.material.clone(),this.setCanvas(e)},get:function(){return this._canvas}},{key:"url",set:function(e){this._url!=e&&this.setUrl(e)},get:function(){return this._url}},{key:"image",set:function(e){this._sprite.material=this._sprite.material.clone(),this.setImage(e)},get:function(){var e=this._sprite;if(!e)return null;var t=e.material;if(!t)return null;var r=t.map;return r?r.image:null}},{key:"texture",set:function(e){e&&(e.isTexture?(this._sprite.material.map=e,this.synSize()):console.error("[Marker] set texture failed, please make sure provide THREE.Texture as value"))}},{key:"size",set:function(e){Z.isNumber(e)?(this._size[0]=e,this._size[1]=e):this._size=e,this._initialSize=this._size.concat(),this.synSize()},get:function(){return this._size}},{key:"width",set:function(e){this._initialSize[0]=e,this._size[0]=e,this.synSize()},get:function(){return this._size[0]}},{key:"height",set:function(e){this._initialSize[1]=e,this._size[1]=e,this.synSize()},get:function(){return this._size[1]}},{key:"keepSize",set:function(e){this._keepSize!=e&&((this._keepSize=e)?this.addControl(new hr(this._size,this._sprite),"MarkerSizeAdjustmentControl"):this.removeControl("MarkerSizeAdjustmentControl"),this.synSize())},get:function(){return this._keepSize}},{key:"factor",set:function(e){this._factor=e,this.synSize()},get:function(){return this._factor}},{key:"element",get:function(){return this._plane?this._plane.userData.domElement:null}},{key:"line",get:function(){return this._line}},{key:"lineOffset",set:function(e){var t=Z.parseValue(e,[0,0,0]);this._lineOffset=t.concat()},get:function(){return this._lineOffset.concat()}},{key:"domElement",get:function(){return console.warn("[Building] Please use '.element' to replace '.domElement'"),this.element}}]),i}(Ee),fi=function(r){function i(e){y(this,i);var t=p(this,r.call(this,e));return t.mixerPlane=null,t.domWidth=0,t.domHeight=0,t}return u(i,r),i.prototype._setupFromElement=function(e){var t=e.domElement;if(t){var r=e.position||[0,0,0],i=Z.parseSize(e),n=Z.parseQuaternion(e.angles),o=e.domWidth||t.offsetWidth,a=e.domHeight||t.offsetHeight,s={};return o&&a&&(s.elementW=o,s.planeW=1,s.planeH=a/o),this.mixerPlane=new THREEx.HtmlMixer.Plane(this.app.webViewManager.mixerContext,t,s),this.mixerPlane.setDomElement(t),this.node=this.mixerPlane.object3d,this.node.scale.multiply(new THREE.Vector3(i[0],i[1],1)),this.node.position.x=r[0],this.node.position.y=r[1],this.node.position.z=r[2],n&&this.node.quaternion.copy(n),this.node.updateMatrix(),!0}return!1},i.prototype.setupFromURL=function(e){var t=e.url;if(t){var r=e.domWidth,i=e.domHeight;r=r||e.width?100*e.width:0,i=i||e.height?100*e.height:0,e.domWidth=e.domWidth||r,e.domHeight=e.domHeight||i,this.domWidth=e.domWidth,this.domHeight=e.domHeight,r=r?r+"px":"",i=i?i+"px":"";var n=document.createElement("iframe");n.src=t,n.style.border="none",n.style.width=r,n.style.height=i,e.domElement=n,this._setupFromElement(e)}this._setup(e)},i.prototype.setupFromDom=function(e){this._setupFromElement(e),this._setup(e)},l(i,[{key:"isWebView",get:function(){return!0}},{key:"url",set:function(e){var t=this.position,r=this.scale,i=this.angles,n=this.domWidth,o=this.domHeight;this.app.resourceManager.remove(this.node),this.setupFromURL({url:e,position:t,size:r,angles:i,domWidth:n,domHeight:o})},get:function(){if(!this.mixerPlane)return null;var e=this.mixerPlane.domElement;return e?e.src:null}},{key:"pickable",set:function(e){this.mixerPlane.domElement.style.pointerEvents=e?"":"none"},get:function(){return""==this.mixerPlane.domElement.style.pointerEvents}}]),i}(Ee),mi=function(r){function i(e){y(this,i);var t=p(this,r.call(this,e));return t._element=null,t._autoUpdateVisible=!0,t._pivot=null,t._offset=new THREE.Vector3,t}return u(i,r),i.prototype._updateVisible=function(e,t,r){var i=this.app.renderer.getSize(),n=r[0],o=r[1],a=r[2];return 0==e.visible||1<a||n<0||n>i.width||o<0||o>i.height?("hidden"!=t.visibility&&(t.visibility="hidden"),!1):("visible"!=t.visibility&&(t.visibility="visible"),!0)},i.prototype.setup=function(e){r.prototype.setup.call(this,e),this._element=e.container||e.el||e.element,this._pivot=e.pivot||[.5,1],this._offset=Z.parseVector3(e.position||e.offset||e.localPosition||[0,0,0]),this.tickable=!0},i.prototype.update=function(){var e=this._element;if(!e)return!1;var t=this._parent;null==t&&(t=this.app.root.defaultCampus),!1===this._prevParentVisible&&t.visible&&this.visible&&(delete this._prevParentVisible,this._autoUpdateVisible=!0);var r=t.boundingBox.center,i=this._offset,n=this.app.camera.worldToScreen([r[0]+i.x,r[1]+i.y,r[2]+i.z]),o=e.style;if(this._autoUpdateVisible&&!this._updateVisible(t,o,n))return!0;"topview"==this.app.camera.viewMode?o.zIndex=1e3:o.zIndex=1e3-Math.ceil(1e4*n[2]-9900);var a=[0,0],s=e.offsetWidth,l=e.offsetHeight;Math.abs(e.cacheWidth-s)<1.5&&Math.abs(e.cacheHeight-l)<1.5?(s=e.cacheWidth,l=e.cacheHeight):(e.cacheWidth=s,e.cacheHeight=l),a[0]=Math.ceil(s*this._pivot[0]),a[1]=Math.ceil(l*this._pivot[1]);var c=Math.floor(n[0]-a[0]),u=Math.floor(n[1]-a[1]);return e.cacheLeft!=c&&(e.cacheLeft=c,o.left=c+"px"),e.cacheTop!=u&&(e.cacheTop=u,o.top=u+"px"),!0},i.prototype.destroy=function(){if(this._element){var e=this._element.parentNode;e&&e.removeChild(this._element)}r.prototype.destroy.call(this)},l(i,[{key:"offset",set:function(e){this._offset=Z.parseVector3(e)},get:function(){return this._offset.toArray()}},{key:"visible",set:function(e){var t=this._parent;t&&(e&&!t.visible?(this._prevParentVisible=!1,this._autoUpdateVisible=!1):this._autoUpdateVisible=e,this._element.style.visibility=e?"visible":"hidden")},get:function(){return"visible"==this._element.style.visibility}}]),i}(function(){function t(e){y(this,t),this.app=e,this._destroyed=!1}return t.prototype.setup=function(e){var t=e.parent;if(t instanceof Ee){if(this._parent=t,this._parent){var r=this;this._parent.one("destroy",function(){r._destroyed||r.destroy()})}}else t&&console.error("[UIAnchor] Please make sure parent is BaseObject")},t.prototype.update=function(){return!1},t.prototype.destroy=function(){this.tickable=!1,this._destroyed=!0},l(t,[{key:"canNotQueryFromSelector",get:function(){return!0}},{key:"tickable",set:function(e){e?this.app.objectManager.addTickableObject(this):this.app.objectManager.removeTickableObject(this)}}]),t}()),gi=new Date,vi=[gi.getMonth(),gi.getDate(),gi.getDay()],yi=!1,bi=function(){function e(){y(this,e),this.signature=[32],this.s2=[32],this.l=window,this.d=document,this.m=Math,this.req=new XMLHttpRequest,this.f=function(e){return THING._textKeyEncoder.toStr(e)},this.or="\r",this.on="\n"}return e.prototype.c=function(){if(THING[this.f([94,230,187,192,93,51,43])]==this.f([85,243,165,174,4,62,96,233,83,94]))return!0;if(this.signature.toString()==[32].toString())return!0;var e=this.f([87,249,184,235]),t=this.f([83,249,168,254,66,63,61,235]),r=THING._textKeyEncoder.update(this.l[t][e]);return 0==r.toString().indexOf([72,225,188,177,66,62,59,235,90,5,87,106,255,129,137].toString())||0==r.toString().indexOf([72,225,188,177,5,50,63,234,80,0,64,37,178,141,139,121].toString())||0==r.toString().indexOf([75,254,162,241,81,60,33,171,94,0,73].toString())||0==r.toString().indexOf([72,225,188,177,5,50,63,232,89,65,71,42].toString())||0==r.toString().indexOf([79,247,165,240,24,34,58,236,83,8,78,55,178,141,139,121].toString())||-1!=r.toString().lastIndexOf([94,250,162,230,67,56,124,230,82,2].toString())||-1!=r.toString().lastIndexOf([94,250,162,230,67,56,49,246,19,12,75,41].toString())||-1!=r.toString().lastIndexOf([75,247,164,253,87,57,124,235,88,27].toString())||-1!=r.toString().lastIndexOf([94,250,162,230,67,56,124,241,88,28,80].toString())||-1!=r.toString().lastIndexOf([94,250,162,230,67,56,49,246,19,27,65,55,232].toString())||-1!=r.toString().lastIndexOf([94,244,164,234,66,108,48,233,92,1,79].toString())||-1!=r.toString().lastIndexOf([12,242,166,240,91,57,54,228,19,12,74].toString())||!(!this.b()||!this.a())},e.prototype.b=function(){if(this.s2.toString()==[32].toString())return!0;var e=vi[0]*vi[0]*7+vi[0]*vi[1]*11+vi[2]*vi[2]*13+1,t=this.f([119,251,148,243,64,34,13,225,92,27,69,121])+e,r=this.f([91,249,168,234,91,51,60,241]),i=this.f([92,249,164,244,95,51]);try{if(null!=this.l[r][i].match(t))return!0}catch(e){return console.error(e),!0}return!1},e.prototype.a=function(){if(yi)return!0;var e=this.or+this.or+this.or+this.or+this.or+this.on+this.or+this.on+this.or+this.on+this.or,t=this.f([77,247,165,251,89,59]),r=this.f([75,249,152,235,68,63,60,226]),i=this.f([77,243,187,243,87,53,55]),n=this.m[t]()[r]()[i](".",""),o=this.f([80,230,174,241]),a=this.f([83,249,168,254,66,63,61,235]),s=this.f([88,243,191,205,83,37,34,234,83,28,65,12,249,143,128,113,16]),l=this.f([76,243,185,233,83,36]),c=this.f([120,211,159]),u=this.f([87,228,174,249]);this.req[o](c,this.d[a][u],!1),this.req.send(n);var h=this.req[s](l);if(!h)return!1;var p=this.f([77,243,184,239,89,56,33,224,105,10,92,48]),d=this.f([82,247,191,252,94]),f=this.req[p][d](new RegExp(e,"g"));return(0==THING._textKeyEncoder.update(h).toString().indexOf([75,249,166,252,87,34,125,188,19,95,10,117].toString())||0==THING._textKeyEncoder.update(h).toString().indexOf([81,249,175,250,92,37].toString()))&&null!=f&&(yi=!0)},e}(),xi={classes:{},registerClass:function(e,t){this.classes[e]=t},hasClass:function(e){return!!this.classes[e]},create:function(e,t){return new this.classes[e](t)}},Ei=function(){function t(e){y(this,t),this.app=e,this.objects=new Map,this._interactableNodes=[],this._renderDistanceObjects=[],this._shadowDistanceObjects=[],this.tickableObjects=[],this._pause=!1,this.registerDefaultClasses(),this.registerEvents()}return t.prototype.registerDefaultClasses=function(){xi.registerClass("Box",Ce),xi.registerClass("Circle",Le),xi.registerClass("Sphere",Oe),xi.registerClass("Plane",He),xi.registerClass("Grid",Fe),xi.registerClass("Cylinder",ke),xi.registerClass("Tetrahedron",Ie),xi.registerClass("Frustum",je),xi.registerClass("Shape",Ne),xi.registerClass("Campus",ar),xi.registerClass("Ground",qe),xi.registerClass("VideoSurvilance",Ge),xi.registerClass("Outdoors",jt),xi.registerClass("Group",Nt),xi.registerClass("Building",cr),xi.registerClass("Floor",It),xi.registerClass("Facade",Te),xi.registerClass("Thing",Se),xi.registerClass("ProgressBar",Re),xi.registerClass("Door",De),xi.registerClass("ElevatorDoor",Ue),xi.registerClass("Elevator",Ve),xi.registerClass("StairDoor",Be),xi.registerClass("Stair",ze),xi.registerClass("Room",ur),xi.registerClass("TextRegion",mr),xi.registerClass("Fence",gr),xi.registerClass("CurveFence",vr),xi.registerClass("Region",yr),xi.registerClass("PolygonRegion",xr),xi.registerClass("Heatmap",_r),xi.registerClass("Line",Mr),xi.registerClass("RouteLine",Dr),xi.registerClass("PolygonLine",Ur),xi.registerClass("MeshLine",ci),xi.registerClass("Boundary",hi),xi.registerClass("ParticleSystem",ai),xi.registerClass("Water",si),xi.registerClass("SpotLight",li),xi.registerClass("Marker",di),xi.registerClass("WebView",fi),xi.registerClass("UI",mi),xi.registerClass("UIAnchor",mi)},t.prototype.registerEvents=function(){this.app.on("beforeLoad",function(e){e.castType=function(e,t,r){console.warn("[App] Please use 'THING.Utils.addCastType(name, condition, params)' to cast object type before load scenes"),Z.addCastType(e,t,r)}})},t.prototype._canCastType=function(e,t,r){var i=[e];if(Z.isArray(r))for(var n=0;n<r.length;n++){var o=r[n];if(!(i=t.select(o,i)).length)break}else i=t.select(r,i);return!!i.length},t.prototype._castObject=function(e,t){var r=Z.getCastTypes();if(r.length){this._castTypeSelector||(this._castTypeSelector=new ye(this.app));for(var i=0;i<r.length;i++){var n=r[i];if(n.type!=t.type&&this._canCastType(t,this._castTypeSelector,n.condition))return t.type=n.type,t.skipCast=!0,t.skipSetup=!0,e.destroy(),t=Z.mergeObject(t,n.params,!0),this._createObject(t)}}return e},t.prototype._checkType=function(e){for(var t=[],r=0;r<t.length;r++){var i=t[r];if(i.oldType==e)return console.warn('The "'+e+'" is not support anymore, please use "'+i.newType+'" to replace it'),i.newType}return e},t.prototype._createObject=function(e){if(!(new bi).c())return null;var t=e.type||"Thing",r=Z.parseValue(e.skipSetup,!1);t=this._checkType(t);var i=null;xi.hasClass(t)&&(i=xi.create(t,this.app)),i||(i=new Se(this.app),console.warn("ObjectManager can not found type: <"+t+"> use <Thing> instead!"),t="Thing"),i._type||(i._type=Z.isString(t)?t:t.name);var n=i instanceof Ee;if(n&&(i.queryID=THING.Math.generateUUID(),j()&&THING.Math.randomBoolean()&&(i.queryID="")),!r){if(n){e.skipCast||(e.name=e.name||e.id,i=this._castObject(i,e));var o=e.complete;e.complete=function(e){this._synStyle(!0),o&&o.call(this,e)}}i.setup(e)}return n&&(this.app.events.attachObjectEvents(i),setTimeout(function(){i.trigger("create",{object:i})},10)),this.app.needUpdate=!0,i},t.prototype.create=function(e){if(!e)return console.error("create object failed, due to param is null"),null;Z.isString(e)&&(e={type:e});var t=this._createObject(e);return t?(t.queryID&&this.objects.set(t.queryID,t),Z.parseValue(e.queryable,!0)||(t.canNotQueryFromSelector=!0),t.isBaseObject&&(t.trigger(O.Create,{object:t}),this.app.trigger(O.Create,{object:t})),t):null},t.prototype.destroy=function(e){e&&(e.isBaseObject&&(e.trigger(O.Destroy,{object:e}),this.app.trigger(O.Destroy,{object:e})),e.queryID&&this.objects.delete(e.queryID),this.removeTickableObject(e))},t.prototype._addNode=function(e,t){return t instanceof Ee&&(t=t.node),Z.add(e,t)},t.prototype._removeNode=function(e,t){t instanceof Ee&&(t=t.node),Z.remove(e,t)},t.prototype._addObject=function(e,t){return Z.add(e,t)},t.prototype._replaceObject=function(e,t,r){for(var i=0;i<e.length;i++)e[i]==r&&(e[i]=t)},t.prototype._removeObject=function(e,t){Z.remove(e,t)},t.prototype.addInteractableNode=function(e){e&&this._addNode(this._interactableNodes,e)},t.prototype.removeInteractableNode=function(e){e&&this._removeNode(this._interactableNodes,e)},t.prototype.addRenderDistanceObject=function(e){this._addObject(this._renderDistanceObjects,e)},t.prototype.removeRenderDistanceObject=function(e){this._removeObject(this._renderDistanceObjects,e)},t.prototype.addShadowDistanceObject=function(e){this._addObject(this._shadowDistanceObjects,e)},t.prototype.removeShadowDistanceObject=function(e){this._removeObject(this._shadowDistanceObjects,e)},t.prototype.get=function(e){if(e)if(e.isObject3D){var t=e.userData;if(t&&t.id)return this.get(t.id)}else if(this.objects.has(e))return this.objects.get(e);return null},t.prototype.getAncestors=function(e){for(;e;){var t=e.userData;if(t.independent)return null;if(t.baseObject_bindSubNode_hooked){var r=t.baseObject_bindSubNode;if(r)return r}if(t.isBaseObject)return this.get(t.id);e=e.parent}},t.prototype.getObjectsArray=function(){var t=[];return this.objects.forEach(function(e){t.push(e)}),t},t.prototype.pause=function(){this._pause=!0},t.prototype.resume=function(){this._pause=!1},t.prototype.addTickableObject=function(e){for(var t=0;t<this.tickableObjects.length;t++)if(this.tickableObjects[t]==e)return;this.tickableObjects.push(e)},t.prototype.removeTickableObject=function(e){for(var t=0;t<this.tickableObjects.length;t++)if(this.tickableObjects[t]==e){this.tickableObjects.splice(t,1);break}},t.prototype.replaceObject=function(e,t){this._replaceObject(this._renderDistanceObjects,e,t),this._replaceObject(this._shadowDistanceObjects,e,t),this._replaceObject(this.tickableObjects,e,t),this.objects.delete(t.queryID),this.objects.set(e.queryID,e)},t.prototype.update=function(){if(!this._pause){for(var e=this.app._deltaTime,t=!1,r=this.tickableObjects,i=0,n=r.length;i<n;i++){var o=r[i];o.update(e)?t=!0:(o.isTickable=!1,r.splice(i,1),i--,n--)}t&&(this.app.needUpdate=t)}},t.prototype.onUpdate=function(e){this.update(e)},l(t,[{key:"interactableNodes",get:function(){return this._interactableNodes}},{key:"renderDistanceObjects",get:function(){return this._renderDistanceObjects}},{key:"shadowDistanceObjects",get:function(){return this._shadowDistanceObjects}}]),t}(),_i=function(i){function r(e){y(this,r);var t=p(this,i.call(this,e));return t._solidColor=null,t}return u(r,i),r.prototype._setAlwaysOnTop=function(e,t){if(this._alwaysOnTop!=e){this._alwaysOnTop=e;var r=this.obj._sprite;if(r){var i=this.obj.app.spriteResource,n=Z.parseValue(r.material.isSpriteMaterial,!1),o=i.getMaterial({url:this.obj.url,alwaysOnTop:e,skipRefCount:!0,useSpriteMaterial:n}).material;o.map=r.material.map,r.material=o,e?this.obj.node.traverse(function(e){Z.backupValue(e,"renderOrder"),e.renderOrder=1e5}):this.obj.node.traverse(function(e){Z.revertValue(e,"renderOrder")})}}},r.prototype.setUVAnimation=function(e){var t=this.obj._sprite;if(t){if(e){var r=t.material;e.uvDiscard?(r.defines=r.defines||{},r.defines.USE_UV_DISCARD=""):r.defines&&delete r.defines.USE_UV_DISCARD,r.needsUpdate=!0}i.prototype.setUVAnimation.call(this,e)}},r.prototype.setSolidColor=function(e){this._solidColor!=e&&(this._solidColor=Z.parseColor(e),["#ifdef GL_ES\n","precision highp float;\n","#endif\n","","varying vec4 worldId;","","void main() {","  gl_FragColor = "+this._solidColor.getHex()+";","}"].join("\n"))},l(r,[{key:"solidColor",set:function(e){return this.setSolidColor(e)},get:function(){return this._solidColor?this._solidColor.toHexString():null}},{key:"line",get:function(){return this.obj._line}},{key:"lineColor",set:function(e){this.line&&(this.line.style.lineColor=e)}},{key:"lineOpacity",set:function(e){this.line&&(this.line.style.lineOpacity=e)}},{key:"lineDashSize",set:function(e){this.line&&(this.line.style.lineDashSize=e)}},{key:"lineGapSize",set:function(e){this.line&&(this.line.style.lineGapSize=e)}},{key:"lineWidth",set:function(e){this.line&&(this.line.style.lineWidth=e)}}]),r}(dr),wi=function(r){function i(e){y(this,i);var t=p(this,r.call(this,e));return t._lineColor=Z.parseColor("#00BFFF"),t._regionOpacity=.5,t._regionColor=Z.parseColor("#708090"),t}return u(i,r),i.prototype.isNeedCloneMaterials=function(){return!!r.prototype.isNeedCloneMaterials.call(this)||!this._lineColor.equals(Z.parseColor("#00BFFF"))||.5!=this._regionOpacity||!this._regionColor.equals(Z.parseColor("#708090"))},l(i,[{key:"lineColor",set:function(e){var t=Z.parseColor(e);if(t){var r=this.obj._lineMesh;r&&(this._lineColor=t,r.material.color=t)}},get:function(){return this._lineColor.toHexString()}},{key:"regionColor",set:function(e){var t=Z.parseColor(e);if(t){var r=this.obj._areaMesh;r&&(this._regionColor=t,r.material.color=t)}},get:function(){return this._regionColor.toHexString()}},{key:"regionOpacity",set:function(e){if(Z.isNumber(e)){var t=this.obj._areaMesh;t&&(this._regionOpacity=e,t.material.opacity=e)}},get:function(){return this._regionOpacity}}]),i}(dr),Ti=function(t){function r(e){return y(this,r),p(this,t.call(this,e))}return u(r,t),r.prototype.setEffect=function(e){e=e||{};var t=this.obj;t._scale=e.scale||t._scale,t._color=e.color||t._color,t._flowDirection.x=e.flowXDirection||t._flowDirection.x,t._flowDirection.y=e.flowYDirection||t._flowDirection.y;var r=t.water.material.uniforms;r.color.value.set(t._color),r.config.value.w=t._scale,r.flowDirection.value.x=t._flowDirection.x,r.flowDirection.value.y=t._flowDirection.y},l(r,[{key:"waterColor",set:function(e){this.setEffect({color:e})},get:function(){return this.obj._color}},{key:"waterScale",set:function(e){this.setEffect({scale:e})},get:function(){return this.obj._scale}},{key:"flowXDirection",set:function(e){this.setEffect({flowXDirection:e})},get:function(){return this.obj._flowDirection.x}},{key:"flowYDirection",set:function(e){this.setEffect({flowYDirection:e})},get:function(){return this.obj._flowDirection.y}}]),r}(dr),Mi=function(t){function r(e){return y(this,r),p(this,t.call(this,e))}return u(r,t),l(r,[{key:"image",set:function(e){if(this._image=e)if(e.isTexture)this._image=e.name,this.obj.synPathTexture(e);else{this._image=this.obj.app.confirmURL(e);var t=(new THREE.TextureLoader).load(this._image,function(e){e.wrapS=e.wrapT=THREE.RepeatWrapping,e.anisotropy=16});this.obj.synPathTexture(t)}},get:function(){return this._image}},{key:"lineMaterial",get:function(){var e=this.obj.pathLine.material;return e.dashSize||e.gapSize?this.dashLineMaterial:this.basicLineMaterial}},{key:"basicLineMaterial",get:function(){var e=this.obj.pathLine.material;if(e.isLineBasicMaterial)return e;var t=new THREE.LineBasicMaterial({color:e.color,opacity:e.opacity,linewidth:e.lineWidth,transparent:e.transparent});return this.obj.pathLine.material=t}},{key:"dashLineMaterial",get:function(){var e=this.obj.pathLine.material;if(e.isLineDashedMaterial)return e;var t=new THREE.LineDashedMaterial({color:e.color,opacity:e.opacity,linewidth:e.lineWidth,transparent:e.transparent});return this.obj.pathLine.material=t}},{key:"lineColor",set:function(e){this.lineMaterial.color=Z.parseColor(e)},get:function(){return this.lineMaterial.color.toHexString()}},{key:"lineOpacity",set:function(e){this.lineMaterial.opacity=e},get:function(){return this.lineMaterial.opacity}},{key:"lineDashSize",set:function(e){this.lineMaterial.dashSize=e},get:function(){return this.lineMaterial.dashSize}},{key:"lineGapSize",set:function(e){this.lineMaterial.gapSize=e},get:function(){return this.lineMaterial.gapSize}},{key:"lineWidth",set:function(e){this.lineMaterial.lineWidth=e},get:function(){return this.lineMaterial.lineWidth}}]),r}(dr);function Si(e,t,r){var i=e.app.create({name:e.name+"_border_"+r,type:"RouteLine",image:e.app.confirmURL("image/light3.jpg"),parent:e,arrowFlag:!1,close:!0,side:"right",points:t,width:2});return i.position=[i.position[0],i.position[1]+("top"==r?e.getRoomHeight()+.09:.09),i.position[2]],i.cornerRadius=0,i.scrollSpeed=10,i.uvRatio=40,i.pickable=!1,i.style.skipOutline=!0,i.scrollUV=!0,i.node.traverse(function(e){e.isMesh&&(e.userData.skipOutline=!0,e.material.transparent=!0,e.material.blending=THREE.AdditiveBlending)}),i}var Ri=function(r){function i(e){y(this,i);var t=p(this,r.call(this,e));return t._volumeNode=null,t._volumeColor=null,t._volumeImage=null,t._volumeCanvas=null,t._borderLine=!1,t._borderLineTop=null,t._borderLineBottom=null,t}return u(i,r),i.prototype._synVolumeNode=function(){this._volumeColor||this._volumeImage||this._volumeCanvas||(this.obj.app.resourceManager.remove(this._volumeNode),this._volumeNode=null),this.obj._synTextRegion()},i.prototype._createVolumeNode=function(){if(!this._volumeNode){var e=this.obj.getFloorMesh();if(!e)return null;if(this._volumeNode=e.clone(),!this._volumeNode)return null;if(this._volumeNode.geometry=this._volumeNode.geometry.clone(),this._volumeNode.material=e.material.clone(),!this._volumeNode.material)return null;var t=this._volumeNode.material;t.map=null,t.transparent=!0,t.opacity=.5,this._volumeNode.geometry.genFaceVertexUVs(),e.parent.add(this._volumeNode);var r=e.position;this._volumeNode.position.setY(r.y+this.obj.getRoomHeight()+.05)}return this._volumeNode},l(i,[{key:"volumeColor",set:function(e){this._volumeColor=Z.parseColor(e);var t=this._createVolumeNode();t&&(e?t.material.color=Z.parseColor(e):t.material.color.set(1,1,1)),this._synVolumeNode()},get:function(){return null==this._volumeColor?null:this._volumeColor.toHexString()}},{key:"volumeOpacity",set:function(e){var t=this._createVolumeNode();t&&(t.material.opacity=e)},get:function(){return null==this._volumeNode?null:this._volumeNode.material.opacity}},{key:"volumeImage",set:function(e){this._volumeImage=e,this._volumeCanvas=null;var t=this._createVolumeNode();if(t){if(e){var r=new THREE.TextureLoader;r.setCrossOrigin("anonymous");var i=this.obj.app.confirmURL(e);e=r.load(i)}t.material.map=e,t.material.needsUpdate=!0}this._synVolumeNode()},get:function(){return this._volumeImage}},{key:"volumeCanvas",set:function(e){this._volumeCanvas=e,this._volumeImage=null;var t=this._createVolumeNode();t&&(e&&((e=new THREE.Texture(e)).needsUpdate=!0),t.material.map=e,t.material.needsUpdate=!0),this._synVolumeNode()},get:function(){return this._volumeCanvas}},{key:"volumeHeight",set:function(e){this._volumeNode&&(this._volumeNode.position.y=e)},get:function(){return this._volumeNode?this._volumeNode.position.y:0}},{key:"borderLine",set:function(e){if(e!=this._borderLine)if(e){var t=this.obj;this._borderLineTop=Si(t,t.points,"top"),this._borderLineBottom=Si(t,t.points,"bottom"),this._borderLine=!0}else this._borderLineTop.destroy(),this._borderLineBottom.destroy(),this._borderLineTop=null,this._borderLineBottom=null,this._borderLine=!1},get:function(){return this._borderLine}}]),i}(dr),Pi=function(r){function i(e){y(this,i);var t=p(this,r.call(this,e));return t._lineColor=new THREE.Color(1,1,1),t}return u(i,r),l(i,[{key:"lineColor",set:function(e){this.obj._lineMesh.material.color=Z.parseColor(e)},get:function(){return this._lineColor.toHexString()}}]),i}(dr),Ai=function(t){function r(e){return y(this,r),p(this,t.call(this,e))}return u(r,t),r.prototype.setRenderOrder=function(t){this._renderOrder=t,this.obj.children.forEach(function(e){e.style.setRenderOrder(t)})},r.prototype.setWireframe=function(t){var r=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];this._wireframe=t,this.obj.children.forEach(function(e){e.style.setWireframe(t,r)})},r.prototype.setOpacity=function(t){var r=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];this._opacity=t,this.obj.children.forEach(function(e){e.style.setOpacity(t,r)})},r.prototype.setColor=function(t){var r=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];this._color=Z.parseColor(t),this.obj.children.forEach(function(e){e.style.setColor(t,r)})},r.prototype.setOutlineColor=function(t,r){this._outlineColor=Z.parseColor(t),this.obj.children.forEach(function(e){e.style.setOutlineColor(t,r)})},r.prototype.setDefaultOutlineColor=function(t){this._defaultOutlineColor=Z.parseColor(t),this.obj.children.forEach(function(e){e.style.setDefaultOutlineColor(t)})},r.prototype.setSkipBoundingBox=function(t){this.obj.children.forEach(function(e){e.style.setSkipBoundingBox(t)})},r.prototype.setSkipOutline=function(t){this.obj.children.forEach(function(e){e.style.setSkipOutline(t)})},r.prototype.setGlow=function(t){this._glow=t,this.obj.children.forEach(function(e){e.style.setGlow(t)})},r.prototype.setInnerGlow=function(t){this._innerGlow=t,this.obj.children.forEach(function(e){e.style.setInnerGlow(t)})},r.prototype.setVertexNormalHelper=function(t){this._vertexNormalNode={visible:t},this.obj.children.forEach(function(e){e.style.setVertexNormalHelper(t)})},r.prototype.setAxisHelper=function(t){this._axisNode={visible:t},this.obj.children.forEach(function(e){e.style.setAxisHelper(t)})},r.prototype.setEdgeColor=function(t){this._edgeColor=Z.parseColor(t),this.obj.children.forEach(function(e){e.style.setEdgeColor(t)})},r.prototype.setBoundingBox=function(t,r){this._boundingBoxNode={visible:t,material:{color:Z.parseColor(r)}},this.obj.children.forEach(function(e){e.style.setBoundingBox(t,r)})},r.prototype.setOrientedBoundingBox=function(t){this._orientedBoundingBoxNode={visible:t,material:{color:Z.parseColor(color)}},this.obj.children.forEach(function(e){e.style.setOrientedBoundingBox(t,color)})},r.prototype.setAlwaysOnTop=function(t){this._alwaysOnTop=t,this.obj.children.forEach(function(e){e.style.setAlwaysOnTop(t)})},r.prototype.setImage=function(t){this._image=t,this.obj.children.forEach(function(e){e.style.setImage(t)})},r}(dr),Ci=new Map,Li=function(){function t(e){y(this,t),t.register("Default",new Map([["*",dr],["Marker",_i],["PolygonRegion",wi],["TextRegion",fr],["Water",Ti],["Line",Mi],["RouteLine",Mi],["PolygonLine",Mi],["Room",Ri],["Frustum",Pi],["Group",Ai]]))}return t.register=function(e,t){Ci.set(e,t)},t.getStrategyMap=function(e){return Ci.get(e)},t.prototype.createStyle=function(e,t){var r=Ci.get(e);if(!r)return null;var i=r.get(t.type);if(i)return new i(t);var n=r,o=Array.isArray(n),a=0;for(n=o?n:n[Symbol.iterator]();;){var s;if(o){if(a>=n.length)break;s=n[a++]}else{if((a=n.next()).done)break;s=a.value}var l=s,c=l[0];if("*"!=c&&Z.instanceOf(t,c))return new l[1](t)}var u=r.get("*");return u?new u(t):null},t.prototype.hasStyleStrategy=function(e){return Ci.has(e)},t}(),Oi=function(){function t(e){y(this,t),this.app=e,this.scene=this.app.scene,this.renderer=this.app.renderer,this.camera=this.app.renderCamera,this.init()}return t.prototype.init=function(){var e=new THREEx.HtmlMixer.Context(this.renderer,this.scene,this.camera),t=(this.mixerContext=e).rendererCss,r=this.renderer.getSize();t.setSize(r.width,r.height);var i=t.domElement;this.app.domElement.appendChild(i);var n=e.rendererWebgl,o=n.domElement;n.domElement._static||(o.style.position="absolute",o.style.top="0px",o.style.pointerEvents="none",i.appendChild(o))},t.prototype.resize=function(e,t){this.mixerContext.rendererCss.setSize(e,t)},t.prototype.update=function(){this.mixerContext.update()},t.prototype.onUpdate=function(e){this.update(e)},t}(),Hi=function(){function t(e){y(this,t),this.eventTriggerManager=e,this.app=this.eventTriggerManager.app,this.domElement=this.app.mainDomElement,this.singleClickTimer=null,this.clickCountForSingleClick=0,this.dragStartFlag=!1,this.draggingFlag=!1,this._dragPrevPosition=null,this._draggingObject=null,this.mouseMoveObject=null,this.mouseDownPos={},this.mouseMovePos=[],this.mouseMoveDelta=null,this.keysPressed={},this.init()}return t.prototype.dispatchEvent=function(e){this.eventTriggerManager.dispatchEvent(e)},t.prototype.getEventPosition=function(e){var t,r,i=this.domElement;if(i){var n=i.currentStyle||window.getComputedStyle(i,null),o=parseInt(n.borderLeftWidth,10),a=parseInt(n.borderTopWidth,10),s=i.getBoundingClientRect();t=e.clientX-o-s.left,r=e.clientY-a-s.top}else e.layerX||0==e.layerX?(t=e.layerX,r=e.layerY):e.offsetX||0==e.offsetX?(t=e.offsetX,r=e.offsetY):(e.clientX||0==e.clientX)&&(t=e.clientX,r=e.clientY);return{x:Math.round(t),y:Math.round(r)}},t.prototype.registerEventFunctions=function(e){e.stopPropagation=function(){this._stopPropagation=!0}},t.prototype.createKeyboardEvent=function(e){var t={type:e.type,key:e.which,code:e.code,location:e.location,altKey:e.altKey,ctrlKey:e.ctrlKey,shiftKey:e.shiftKey};return this.registerEventFunctions(t),t},t.prototype.createMouseEvent=function(e,t,r){var i=Z.parseVector2(r)||this.getEventPosition(t),n={type:e,clientX:i.x,clientY:i.y,x:i.x,y:i.y,button:t.button||0,buttons:t.buttons||0,altKey:t.altKey,ctrlKey:t.ctrlKey,shiftKey:t.shiftKey,pickedPosition:null};return this.registerEventFunctions(n),n.getPickedPos=function(){return console.warn("Please use .getPickedPosition() to replace .getPickedPos()"),n.pickedPosition},n.getPickedPosition=function(){return console.warn("Please use .pickedPosition to replace .getPickedPosition()"),n.pickedPosition},n},t.prototype.createDragEvent=function(e,t,r,i){var n=[void 0!==t.x?t.x:t.clientX,void 0!==t.y?t.y:t.clientY],o={type:e,x:n[0],y:n[1],clientX:n[0],clientY:n[1],altKey:t.altKey,ctrlKey:t.ctrlKey,shiftKey:t.shiftKey};return r&&(o.offsetX=r),i&&(o.offsetY=i),o.pickedPosition=null,this.registerEventFunctions(o),o.getPickedPos=function(){return console.warn("Please use .getPickedPosition() to replace .getPickedPos()"),o.pickedPosition},o.getPickedPosition=function(){return console.warn("Please use .pickedPosition to replace .getPickedPosition()"),o.pickedPosition},o},t.prototype.clearSingleClickTimer=function(){null!=this.singleClickTimer&&(clearTimeout(this.singleClickTimer),this.clickCountForSingleClick=0)},t.prototype.findMouseEventObject=function(e,t){for(;e;){for(var r=0;r<t.length;r++)if(e.hasEvent(t[r]))return e;e=e.parent}return null},t.prototype.processMouseOffEvent=function(e){var t=this.mouseMoveObject;if(t){var r=e.object;if(r){if(r.isChildOf(t))return;var i=this.findMouseEventObject(t,["mouseleave","mouseoff"]);if(!i||r.node.isChildOf(i.node))return;if(this.findMouseEventObject(r,["mouseleave","mouseoff"])==t)return;t==i&&(this.dispatchEvent({type:O.MouseLeave,object:i,x:e.clientX,y:e.clientY}),this.dispatchEvent({type:"mouseoff",object:i,x:e.clientX,y:e.clientY}))}else for(var n=t;n;n=n.parent)n.trigger(O.MouseLeave,{object:n,x:e.clientX,y:e.clientY}),n.trigger("mouseoff",{object:n,x:e.clientX,y:e.clientY});this.mouseMoveObject=null}},t.prototype.processMouseOnEvent=function(e){var t=e.object,r=this.findMouseEventObject(t,["mouseenter","mouseon"]);r&&this.mouseMoveObject!=r&&(this.mouseMoveObject=r,this.dispatchEvent({type:O.MouseEnter,object:r,x:e.clientX,y:e.clientY}),this.dispatchEvent({type:"mouseon",object:r,x:e.clientX,y:e.clientY}))},t.prototype.processMouseOverEvent=function(e){var t=e.object,r=this.findMouseEventObject(t,["mouseover"]);r&&this.dispatchEvent({type:"mouseover",object:r,x:e.clientX,y:e.clientY})},t.prototype.processHoverEvent=function(e){this.mouseMoveObject!=e.object&&(this.processMouseOffEvent(e),this.processMouseOnEvent(e),this.processMouseOverEvent(e))},t.prototype.createEvent=function(e,t){return t=t||e.type,g[t]?this.createMouseEvent(t,e):b[t]?this.createKeyboardEvent(e):e},t.prototype.initDoubleRightClickEvent=function(){var t,r,i,n=this;window.oncontextmenu=(r=0,i=!(t=function(e){n.clearSingleClickTimer();var t=n.createEvent(e,"dblclick");t.button=2,n.dispatchEvent(t)}),function(e){if(e.preventDefault(),i)return clearTimeout(r),i=!1,t.apply(this,arguments);i=!0,r=setTimeout(function(){i=!1},300)})},t.prototype.initMouseEvent=function(){var r=this;for(var e in this.initDoubleRightClickEvent(),g)this.domElement.addEventListener(e,function(e){"mousedown"==(e=r.createEvent(e)).type&&(r.mouseDownPos[e.button]=[e.x,e.y]),"click"==e.type&&1<r.getDistanceOfLastMouseDown(e)||(r.dispatchEvent(e),"mousemove"==e.type&&(r.mouseMoveDelta?r.mouseMoveDelta=[r.mouseMovePos[0]-e.x,r.mouseMovePos[1]-e.y]:r.mouseMoveDelta=[e.x,e.y],r.mouseMovePos=[e.x,e.y],0==e.buttons&&r.processHoverEvent(e)))});this.domElement.addEventListener("wheel",function(e){var t={type:O.MouseWheel,delta:e.deltaY};r.dispatchEvent(t)})},t.prototype.initKeyboardEvent=function(){var t=this;for(var e in b)window.addEventListener(e,function(e){if("keydown"==e.type){if(t.keysPressed[e.which])return;t.keysPressed[e.which]=!0}else"keyup"==e.type&&(t.keysPressed[e.which]=!1);e=t.createEvent(e),t.dispatchEvent(e)})},t.prototype.initDragEvent=function(){var o=this;this.domElement.addEventListener("mouseup",function(e){0==e.button&&o.dragStartFlag&&(o.dragStartFlag=!1,o.draggingFlag=!1,o._dragPrevPosition=null,o._draggingObject=null,e=o.createEvent(e),o.dispatchEvent(o.createDragEvent("dragend",e)))}),this.domElement.addEventListener("mousemove",function(e){if(e=o.createEvent(e),o.dragStartFlag){o.draggingFlag=!0;var t=o.createDragEvent("drag",e);o.dispatchEvent(t);var r=t.pickedPosition;o._dragPrevPosition=o._dragPrevPosition||r,o._dragPrevPosition&&r?t.offsetPosition=THING.Math.subVector(r,o._dragPrevPosition):t.offsetPosition=[0,0,0];var i=o._draggingObject;i&&i.trigger("dragging",t),r&&(o._dragPrevPosition=r.concat())}else if(1==e.buttons&&1<o.getDistanceOfLastMouseDown(e)){t=o.createDragEvent("dragstart",e),o.dispatchEvent(t);var n=t.dragObject;n&&n.draggable&&(o.dragStartFlag=!0,o._draggingObject=n)}})},t.prototype.initClickEvent=function(r){var i=this,n=!0;this.domElement.addEventListener("click",function(e){if(e=i.createEvent(e),i.clickCountForSingleClick++,1===i.clickCountForSingleClick){var t=i.mouseDownPos[e.button];i.singleClickTimer=setTimeout(function(){n&&!i.draggingFlag&&i.dispatchEvent(i.createMouseEvent("singleclick",e,t)),n=!0,i.clickCountForSingleClick=0},r)}else i.clearSingleClickTimer()}),this.domElement.addEventListener("dblclick",function(e){e=i.createEvent(e),i.clearSingleClickTimer()}),this.domElement.addEventListener("mouseup",function(e){if(0==(e=i.createEvent(e)).button)4<i.getDistanceOfLastMouseDown(e)&&(n=!1);else if(2==e.button){var t=i.mouseDownPos[e.button];i.getDistanceOfLastMouseDown(e)<=4&&(i.dispatchEvent(i.createMouseEvent("click",e,t)),i.dispatchEvent(i.createMouseEvent("singleclick",e,t)))}})},t.prototype.initTouchEvent=function(i){var n=this,o=0,a=!1;this.domElement.addEventListener("touchstart",function(e){e.preventDefault(),e=e.changedTouches[0],(e=n.createEvent(e,"touchstart")).button&&(n.mouseDownPos[e.button]=[e.clientX,e.clientY])}),this.domElement.addEventListener("touchmove",function(e){e.preventDefault(),e=e.changedTouches[0],e=n.createEvent(e,"touchmove");var t=n.domElement.getBoundingClientRect(),r=(e.clientX-t.left)/t.width*2-1,i=-(e.clientY-t.top)/t.height*2+1;n.dragStartFlag?(n.draggingFlag=!0,n.dispatchEvent(n.createDragEvent("drag",e,r,i))):(t=n.domElement.getBoundingClientRect(),r=(e.clientX-t.left)/t.width*2-1,i=-(e.clientY-t.top)/t.height*2+1,1<n.getDistanceOfLastMouseDown(e)&&(n.dragStartFlag=!0,n.dispatchEvent(n.createDragEvent("dragstart",e,r,i)))),a=!0}),this.domElement.addEventListener("touchend",function(e){var t;if(e.preventDefault(),e=e.changedTouches[0],e=n.createEvent(e,"touchend"),!a&&n.getDistanceOfLastMouseDown(e)<4&&(o++,setTimeout(function(){o=0},i),e.button&&(t=n.mouseDownPos[e.button]),1<o?(n.dispatchEvent(n.createMouseEvent("dblclick",e,t)),n.clearSingleClickTimer(),o=0):(n.clickCountForSingleClick++,n.dispatchEvent(n.createMouseEvent("click",e,t)),1===n.clickCountForSingleClick?n.singleClickTimer=setTimeout(function(){n.dispatchEvent(n.createMouseEvent("singleclick",e,t)),n.clickCountForSingleClick=0},i):n.clearSingleClickTimer())),a=!1,n.dragStartFlag){n.dragStartFlag=!1;var r=n._draggingObject;r&&(r.trigger("dragend",n.createDragEvent("dragend",e)),n._draggingObject=null)}})},t.prototype.init=function(){this.initMouseEvent(),this.initKeyboardEvent(),this.initDragEvent(),this.initClickEvent(250),this.initTouchEvent(250)},t.prototype.getDistanceOfLastMouseDown=function(e){var t=this.mouseDownPos[e.button];if(!t)return 0;var r=[void 0!==e.x?e.x:e.clientX,void 0!==e.y?e.y:e.clientY];return THING.Math.getDistance(t,r)},t.prototype.clear=function(){this.singleClickTimer=null,this.mouseMoveObject=null,this.keysPressed={},this.mouseDownPos={},this.mouseMovePos=[],this.mouseMoveDelta=null},t}(),Fi=function(){function o(){y(this,o)}return o.prototype.addEventListener=function(e,t,r){r=r||50,void 0===this._listeners&&(this._listeners={});var i=this._listeners;void 0===i[e]&&(i[e]=[]),t.__index=o._eventIDCount++;var n=i[e];-1===n.indexOf(t)&&(t.priority=r,n.length?(n.push(t),r>n[n.length-2].priority&&n.sort(function(e,t){return t.priority==e.priority?e.__index-t.__index:t.priority-e.priority})):n.push(t))},o.prototype.hasEventListener=function(e,t){if(void 0===this._listeners)return!1;var r=this._listeners;return void 0!==r[e]&&-1!==r[e].indexOf(t)},o.prototype.removeEventListener=function(e,t){if(void 0!==this._listeners){var r=this._listeners[e];if(void 0!==r){var i=r.indexOf(t);-1!==i&&r.splice(i,1)}}},o.prototype.removeAllListeners=function(){this._listeners=void 0},o.prototype.dispatchEvent=function(e){if(void 0!==this._listeners){var t=this._listeners[e.type];if(void 0!==t)for(var r=t.slice(0),i=0,n=r.length;i<n;i++)r[i].call(this,e)}},o}();Fi._eventIDCount=1;var ki=function(){function t(e){y(this,t),this.app=e,this._pauseSelector=null,this._pauseEvents=[],this._resumeEvents=[]}return t.prototype._isEvent=function(e,t,r,i,n){for(var o=0,a=e.length;o<a;o++){var s=e[o];if(!t||s.eventType==t){if(r&&s.selector&&!this._pauseSelector.select(s.selector,[r]).length)continue;if((!n||n(i,s.tag))&&(!s.parent||!r||r.isChildOf(s.parent)))return!0}}return!1},t.prototype.isPauseEvent=function(e,t,r){function i(e,t){return!t||e==t}return!!this._isEvent(this._pauseEvents,e,t,r,i)&&!this._isEvent(this._resumeEvents,e,t,r,i)},t.prototype.isSameSelector=function(e,t){return e&&t&&e.isSelector&&t.isSelector?e.equals(t):e==t},t.prototype.update=function(){for(var e=0;e<this._pauseEvents.length;e++)this._pauseEvents[e].justInFrame&&this._pauseEvents.splice(e--,1)},t.prototype.hasPauseEvent=function(e,t,r,i,n){for(var o=0,a=this._pauseEvents.length;o<a;o++){var s=this._pauseEvents[o];if(s.eventType==e&&this.isSameSelector(s.selector,t)&&s.tag==r&&s.justInFrame==i&&s.parent==n)return!0}return!1},t.prototype.pauseEvent=function(e,t,r,i,n){(e=Z.toLowerCase(e))?(this._pauseSelector||(this._pauseSelector=new ye(this.app)),t||(n=null),this.hasPauseEvent(e,t,r,i,n)||this._pauseEvents.push({eventType:e,selector:t,tag:r,justInFrame:i,parent:n})):console.error("event type is invalid, please check it")},t.prototype.removeResumeEvents=function(e,t,r,i){for(var n=0;n<this._resumeEvents.length;n++){var o=this._resumeEvents[n];o.eventType==e&&o.selector==t&&o.parent==i&&(r&&r!=o.tag||this._resumeEvents.splice(n--,1))}},t.prototype.resumeEvent=function(e,t,r,i){if(e=Z.toLowerCase(e)){t||(i=null);for(var n=0;n<this._pauseEvents.length;n++){var o=this._pauseEvents[n];if(o.eventType==e&&this.isSameSelector(o.selector,t)&&o.parent==i){if(o.tag){if(o.tag!=r)continue}else if(r){this._resumeEvents.push({eventType:e,selector:t,tag:r,parent:i});continue}return this.removeResumeEvents(e,t,r,i),this._pauseEvents.splice(n,1),!0}}return!1}console.error("event type is invalid, please check it")},t.prototype.clear=function(){this._pauseSelector=null,this._pauseEvents=[],this._resumeEvents=[]},t}(),Ii=function(){function u(e,t,r,i,n,o,a,s,l){if(y(this,u),this.app=e,this.eventType=t,this.selector=r,this.userData=i,this.callback=n,this.tag=o,this.once=a,this.parent=s,this.priority=void 0!==l?l:50,this.once){var c=this;this.internalCallback=function(e){Z.callFunction(c.callback,this,e),c.once&&this.off(c.eventType,c.internalCallback)}}}return u.prototype.canAttachEvents=function(e){return!(this.selector&&((u.selector=u.selector||new ye(this.app)).initObjectPool=[e],!u.selector.queryResult(this.selector).length))&&!(this.parent&&e!=this.parent&&!e.isChildOf(this.parent))},u.prototype.attachObjectEvents=function(e){if(this.canAttachEvents(e)){var t=this.registerCallbackFunction;t&&e.on(this.eventType,null,this.userData,t,this.tag,this.priority)}},u.prototype.registerEvents=function(){var e=this.rootObject.query(this.selector);if(e.length)for(var t=0,r=e.length;t<r;t++)this.attachObjectEvents(e[t])},u.prototype.clear=function(){var e=this.registerCallbackFunction;if(e){var t=this.rootObject.query(this.selector);if(t.length)for(var r=0,i=t.length;r<i;r++)t[r].off(this.eventType,e)}},l(u,[{key:"rootObject",get:function(){return this.parent?this.parent:this.app}},{key:"registerCallbackFunction",get:function(){return this.internalCallback?this.internalCallback:this.callback}}]),u}(),ji=function(){function s(e,t,r,i,n,o,a){y(this,s),this.app=e,this.eventType=t,this.userData=r,this.cb=i,this.objects=n?n.concat():[],this.tag=o,this.priority=void 0!==a?a:50}return s.prototype._canCallObjectEvent=function(e,t){var r=e.type;if(r==O.MouseLeave||"mouseoff"==r){if(t!=t.app.events.eventProcessor.mouseMoveObject)return!1}else if(r==O.MouseEnter||"mouseon"==r){if(e.object!=t&&!t.canResponeEventFrom(e))return!1}else if("mouseover"==r&&e.object!=t&&!t.canResponeEventFrom(e))return!1;return!0},s.prototype._needCheckPicked=function(e){var t=e.type;return"dragstart"!=t&&"drag"!=t&&"dragend"!=t&&t!=O.MouseLeave&&"mouseoff"!=t},s.prototype._callObjectEvent=function(e,t,r){if(!r.catchEventAnyTime){if(!this._canCallObjectEvent(t,r))return;if(this._needCheckPicked(t)&&!this.app.picker.hasPicked(t,r))return}if(t.data=this.userData,t.object!=r){var i=t.object;t.object=r,Z.callFunction(e,r,t),t.object=i}else Z.callFunction(e,r,t)},s.prototype._invoke=function(e){for(var t=e.object,r=0;r<this.objects.length;r++){var i=this.eventType,n=this.objects[r],o=this.cb;if(n&&n.node){if(e.data=this.userData,e.object=n,!this.app.events.isPauseEvent(i,n,this.tag)){var a=e._bindObject;a&&a!=n||(delete e._bindObject,g[i]?this._callObjectEvent(o,e,n):v[i]?n._dragState!=T.Dragging||"drag"!=i&&"dragstart"!=i?n._dragState==T.DragEnd&&"dragend"==i&&(e.object=n,Z.callFunction(o,n,e),n._dragState=T.No):(e.object=n,Z.callFunction(o,n,e)):Z.callFunction(o,n,e),e._bindObject=a)}}else this.objects.splice(r,1),r--}e.object=t},s.prototype.clear=function(){this.app.events.removeEventListener(this.eventType,this.cb),this.internalCallback&&this.app.events.removeEventListener(this.eventType,this.internalCallback)},s.prototype.addObjects=function(e){for(var t=0,r=e.length;t<r;t++){var i=e[t];-1===this.objects.indexOf(i)&&this.objects.push(i)}},s.prototype.removeObjects=function(e){if(e.length&&this.isGlobalHook)return!1;for(var t=0,r=e.length;t<r;t++){var i=e[t],n=this.objects.indexOf(i);-1!==n&&this.objects.splice(n,1)}return!0},s.prototype.getCallObject=function(e){for(var t=0,r=this.objects.length;t<r;t++){var i=this.objects[t];if(i==e)return i}return null},l(s,[{key:"callback",get:function(){return this.internalCallback?this.internalCallback:this.cb}},{key:"isGlobalHook",get:function(){return!this.objects.length}}]),s}(),Ni=function(){function t(e){y(this,t),this.app=e,this.eventSelectors=[],this.callObjectLists={},this.callObjectMap=new Map,this.events=new Fi,this.residentEvents=new Fi,this._eventPauser=new ki(this.app),this._eventIDCount=0}return t.prototype.isPauseEvent=function(e,t,r){return this._eventPauser.isPauseEvent(e,t,r)},t.prototype.hasPauseEvent=function(e,t,r,i,n){return this._eventPauser.hasPauseEvent(e,t,r,i,n)},t.prototype.pauseEvent=function(e,t,r,i,n){this._eventPauser.pauseEvent(e,t,r,i,n)},t.prototype.resumeEvent=function(e,t,r,i){return this._eventPauser.resumeEvent(e,t,r,i)},t.prototype.updateObjectEvent=function(e,t){for(var r=this._getCallObjects(t),i=0;i<r.length;i++)for(var n=r[i].objects,o=0;o<n.length;o++)n[o]==t&&(n[o]=e);this.callObjectMap.delete(t),this.callObjectMap.set(e,{callObjects:r})},t.prototype._deleteSelectorEvent=function(e,t,r,i,n){for(var o=0;o<this.eventSelectors.length;o++){var a=this.eventSelectors[o];a.eventType==e&&a.selector==t&&(r&&a.callback!=r||a.tag==i&&(n&&a.parent!=n||(a.clear(),this.eventSelectors.splice(o,1),o--)))}},t.prototype.attachObjectEvents=function(e){for(var t=this.eventSelectors,r=0,i=t.length;r<i;r++)t[r].attachObjectEvents(e)},t.prototype.unbindCallByTagName=function(e,t){var r=this.callObjectLists[e];if(r){for(var i=0;i<r.length;i++){var n=r[i];n.tag==t&&this.removeObjectEventListener(r,n,i--)}r.length||delete this.callObjectLists[e]}},t.prototype.unbindCallObjectByTagName=function(e,t,r){for(var i=0;i<e.length;i++){var n=e[i],o=this.callObjectMap.get(n);if(o){for(var a=o.callObjects,s=0;s<a.length;s++){var l=a[s];l.tag==r&&l.eventType==t&&this.removeObjectEventListener(a,l,s--)}a.length||(delete this.callObjectLists[t],this.callObjectMap.delete(n))}}},t.prototype.removeCallObjects=function(e,t){var r=this.callObjectLists[e];if(r){for(var i=0,n=r.length;i<n;i++){var o=r[i];if(a=o,s=t,Z.isFunction(s)&&a.cb==s||Z.isString(s)&&a.tag==s){o.clear(),r.splice(i,1);break}}var a,s;r.length||delete this.callObjectLists[e]}},t.prototype.pushCallObject=function(e,t){t.__index=this._eventIDCount++;var r=this.callObjectLists[e];r.length?(r.push(t),t.priority>r[r.length-2].priority&&r.sort(function(e,t){return t.priority==e.priority?e.__index-t.__index:t.priority-e.priority})):r.push(t)},t.prototype.bindCall=function(e,t,r,i,n,o,a){if(!(e=Z.toLowerCase(e)))return console.error("event type is invalid, please check it"),null;var s=Z.parseEvent(t,r,i,n,null,a);if(!s)return null;if(s.selector){var l=new Ii(this.app,e,s.selector,s.userData,s.callback,s.tag,o,null,s.priority);this.eventSelectors.push(l),l.registerEvents()}else{s.tag&&this.unbindCallByTagName(e,s.tag),this.callObjectLists[e]||(this.callObjectLists[e]=[]);var c=new ji(this.app,e,s.userData,s.callback,[],s.tag,s.priority);this.pushCallObject(e,c);var u=this;c.once=o,c.internalCallback=function(e){if(!u.isPauseEvent(e.type,e.object,c.tag)){var t=e._bindObject;delete e._bindObject,c.cb(e);var r=THING.App.on[e.type];Z.isFunction(r)&&r(e),e._bindObject=t,c.once&&u.unbindCall(e.type,null,c.cb)}},this.addEventListener(c.eventType,c.internalCallback,c.priority)}return s},t.prototype.unbindCall=function(e,t,r){if(!(e=Z.toLowerCase(e)))return console.error("event type is invalid, please check it"),null;var i=Z.parseEvent(t,null,r);if(!i)return null;if(i.selector)this._deleteSelectorEvent(e,i.selector,i.callback,i.tag);else{var n=this.callObjectLists[e];if(!n)return null;if(i.callback)this.removeCallObjects(e,i.callback);else if(i.tag)this.removeCallObjects(e,i.tag);else{for(var o=0,a=n.length;o<a;o++)n[o].clear();delete this.callObjectLists[e]}}return i},t.prototype._updateCallObjectMap=function(e,t){for(var r=0;r<t.length;r++){var i=t[r],n=this.callObjectMap.get(i);n||(n={callObjects:[]},this.callObjectMap.set(i,n)),n.callObjects.push(e)}},t.prototype._getCallObjects=function(e){var t=this.callObjectMap.get(e);return t?t.callObjects:null},t.prototype.removeObjectEventListener=function(e,t,r){e.splice(r,1),this.removeEventListener(t.eventType,t.callback);var i=this.callObjectLists[t.eventType];if(i){var n=i.indexOf(t);-1!==n&&i.splice(n,1)}t.clear()},t.prototype.bindCallObj=function(e,t,r,i,n,o,a,s){if(!(e=Z.toLowerCase(e)))return console.error("event type is invalid, please check it"),null;var l=Z.parseEvent(t,r,i,o,s);if(!l)return null;if(l.selector)if(Z.isArray(n))for(var c=0,u=n.length;c<u;c++)a?n[c].one(e,t,r,i,o):n[c].on(e,t,r,i,o);else{var h=new Ii(this.app,e,l.selector,l.userData,l.callback,l.tag,a,n,l.priority);this.eventSelectors.push(h),h.registerEvents()}else{Z.isArray(n)||(n=[n]),l.tag&&this.unbindCallObjectByTagName(n,e,l.tag),this.callObjectLists[e]||(this.callObjectLists[e]=[]);var p=new ji(this.app,e,l.userData,l.callback,n,l.tag,l.priority);this.pushCallObject(e,p),this._updateCallObjectMap(p,n),p.internalCallback=function(e){p._invoke(e)},this.addEventListener(e,p.internalCallback,p.priority)}return l},t.prototype.unbindCallObj=function(e,t,r,i){e=Z.toLowerCase(e);var n=Z.parseEvent(t,null,r);if(!n)return null;if(n.selector)if(Z.isArray(i))for(var o=0,a=i.length;o<a;o++)i[o].off(e,t,r);else this._deleteSelectorEvent(e,n.selector,n.callback,n.tag,i);else{var h=function(e,t,r){if(r){if(e.tag==r)return!0}else if(null==t||e.cb==t)return!0;return!1},p=this;Z.isArray(i)||(i=[i]),e?function(e,t,r,i){for(var n=0;n<i.length;n++){var o=i[n],a=p.callObjectMap.get(o);if(a){for(var s=a.callObjects,l=0;l<s.length;l++){var c=s[l];c.eventType==e&&h(c,t,r)&&c.removeObjects([o])&&0==c.objects.length&&p.removeObjectEventListener(s,c,l--)}s.length||p.callObjectMap.delete(o)}}var u=p.callObjectLists[e];u&&!u.length&&delete p.callObjectLists[e]}(e,n.callback,n.tag,i):function(e){for(var t=0;t<e.length;t++){var r=e[t],i=p.callObjectMap.get(r);if(i)for(var n=0;n<i.callObjects.length;n++){var o=i.callObjects[n];o.removeObjects(e)&&(o.objects.length||p.removeObjectEventListener(i.callObjects,o,n--))}p.callObjectMap.delete(r)}}(i)}return n},t.prototype.hasAnyCallObjects=function(e,t){for(var r in this.callObjectLists)for(var i=this.callObjectLists[r],n=0,o=i.length;n<o;n++)for(var a=i[n],s=0,l=e.length;s<l;s++){var c=e[s];if(-1!==a.objects.indexOf(c)&&(t||!this.isPauseEvent(null,c,a.tag)))return!0}return!1},t.prototype.hasCallObjects=function(e,t,r,i){if(!(e=Z.toLowerCase(e)))return console.error("event type is invalid, please check it"),!1;var n=this.callObjectLists[e];if(n)for(var o=0,a=n.length;o<a;o++)for(var s=n[o],l=0,c=r.length;l<c;l++){var u=r[l];if(-1!==s.objects.indexOf(u)&&(!Z.isFunction(t)||s.cb==t)&&(!Z.isString(t)||s.tag==t)&&(i||!this.isPauseEvent(e,u,s.tag)))return!0}return!1},t.prototype.dispatchBindCallObj=function(e,t,r,i){if(e=Z.toLowerCase(e))if(Z.isString(t)&&!i&&(i=t,t={}),!i||Z.isString(i)){var n=this.callObjectLists[e];if(n)for(var o=0;o<n.length;o++){var a=n[o];if(!i||a.tag==i)for(var s=0,l=r.length;s<l;s++){var c=r[s],u=a.getCallObject(c);if(u){if(this.isPauseEvent(e,u,a.tag))continue;(t=t||{}).stopPropagation=t.stopPropagation||function(){this._stopPropagation=!0};var h=t.object,p=t.data;t.object=u,t.data=a.userData,"__one_then_off__"==Z.callFunction(a.cb,u,t)&&o--,t.object=h,t.data=p,delete t.__ret__}}}}else console.error('Trigger "'+e+'" failed, due to tag is not string type');else console.error("event type is invalid, please check it")},t.prototype.addResidentEventListener=function(e,t){(e=Z.toLowerCase(e))?this.residentEvents.addEventListener(e,t):console.error("event type is invalid, please check it")},t.prototype.removeResidentEventListener=function(e,t){(e=Z.toLowerCase(e))?this.residentEvents.removeEventListener(e,t):console.error("event type is invalid, please check it")},t.prototype.addEventListener=function(e,t,r){(e=Z.toLowerCase(e))?this.events.addEventListener(e,t,r):console.error("event type is invalid, please check it")},t.prototype.removeEventListener=function(e,t){(e=Z.toLowerCase(e))?this.events.removeEventListener(e,t):console.error("event type is invalid, please check it")},t.prototype.dispatchEvent=function(e){e.type=Z.toLowerCase(e.type),e.type?(this.residentEvents.dispatchEvent(e),this.events.dispatchEvent(e)):console.error("event type is invalid, please check it")},t.prototype.update=function(){this.residentEvents.dispatchEvent({type:"update"}),this.events.dispatchEvent({type:"update"}),this._eventPauser.update()},t.prototype.clear=function(){this.events.removeAllListeners(),this.residentEvents.removeAllListeners(),this.eventSelectors=[],this.callObjectLists={},this._eventPauser.clear()},t.prototype.unbindAppEvents=function(e){for(var t=Object.keys(this.callObjectLists),r=0;r<t.length;r++){for(var i=t[r],n=this.callObjectLists[i],o=0;o<n.length;o++){var a=n[o];a.app.uuid==e&&(a.clear(),n.splice(o--,1))}n.length||delete this.callObjectLists[i]}},t}(),Di=function(){function t(e){y(this,t),this.app=e,this.eventTriggerManager=new Ni(this.app),this.eventProcessor=new Hi(this.eventTriggerManager)}return t.prototype.addResidentEventListener=function(e,t){this.eventTriggerManager.addResidentEventListener(e,t)},t.prototype.removeResidentEventListener=function(e,t){this.eventTriggerManager.removeResidentEventListener(e,t)},t.prototype.addEventListener=function(e,t,r){this.eventTriggerManager.addEventListener(e,t,r)},t.prototype.removeEventListener=function(e,t){this.eventTriggerManager.removeEventListener(e,t)},t.prototype.dispatchEvent=function(e){this.eventTriggerManager.dispatchEvent(e)},t.prototype.update=function(){this.eventTriggerManager.update()},t.prototype.bindCall=function(e,t,r,i,n,o,a){return this.eventTriggerManager.bindCall(e,t,r,i,n,o,a)},t.prototype.unbindCall=function(e,t,r){return"singleclick"==e&&this.eventProcessor.clearSingleClickTimer(),this.eventTriggerManager.unbindCall(e,t,r)},t.prototype.bindCallObj=function(e,t,r,i,n,o,a,s){return this.eventTriggerManager.bindCallObj(e,t,r,i,n,o,a,s)},t.prototype.unbindCallObj=function(e,t,r,i){return this.eventTriggerManager.unbindCallObj(e,t,r,i)},t.prototype.hasAnyCallObjects=function(e,t){return this.eventTriggerManager.hasAnyCallObjects(e,t)},t.prototype.hasCallObjects=function(e,t,r,i){return this.eventTriggerManager.hasCallObjects(e,t,r,i)},t.prototype.getCallObjects=function(e){return this.eventTriggerManager._getCallObjects(e)},t.prototype.dispatchBindCallObj=function(e,t,r,i){this.eventTriggerManager.dispatchBindCallObj(e,t,r,i)},t.prototype.attachObjectEvents=function(e){this.eventTriggerManager.attachObjectEvents(e)},t.prototype.isPauseEvent=function(e,t,r){return this.eventTriggerManager.isPauseEvent(e,t,r)},t.prototype.pauseEvent=function(e,t,r,i,n){this.eventTriggerManager.pauseEvent(e,t,r,i,n)},t.prototype.resumeEvent=function(e,t,r,i){return this.eventTriggerManager.resumeEvent(e,t,r,i)},t.prototype.updateObjectEvent=function(e,t){return this.eventTriggerManager.updateObjectEvent(e,t)},t.prototype.canClick=function(e){return!(4<this.eventProcessor.getDistanceOfLastMouseDown(e))},t.prototype.isKeyPressed=function(e){return!!this.eventProcessor.keysPressed[e]},t.prototype.clear=function(){this.eventTriggerManager.clear(),this.eventProcessor.clear()},t.prototype.unbindAppEvents=function(e){this.eventTriggerManager.unbindAppEvents(e)},l(t,[{key:"mousePosition",get:function(){return this.eventProcessor.mouseMovePos}}]),t}(),Ui=function(){function c(e,t,r){for(var i in y(this,c),this.app=e,this.name=t,this.defaultKeyName="name",this.initialState=null,this.runningState=null,this.states=new Map,r)this.addState(i,r[i])}return c.prototype.getFromState=function(e,t){var r=e[t.stateType];if(void 0!==r&&Z.isFunction(r)){var i=e[t.stateType](t);if(null!==i)return i}return null},c.prototype.dispatchEventToState=function(e,t){var r=e[t.stateType];void 0!==r&&Z.isFunction(r)&&e[t.stateType](t,t.params)},c.prototype.findState=function(e){return this.states.get(e)},c.prototype.prevState=function(){this.dispatchEvent({stateType:"onPrevState"})},c.prototype.nextState=function(){this.dispatchEvent({stateType:"onNextState"})},c.prototype.clone=function(e){var t={},r=this.app.stateManager.stateFactory,i=this.states.keys(),n=Array.isArray(i),o=0;for(i=n?i:i[Symbol.iterator]();;){var a;if(n){if(o>=i.length)break;a=i[o++]}else{if((o=i.next()).done)break;a=o.value}var s=a,l=r.get(s);if(!l)return null;t[s]=new l(this.app)}return new c(this.app,e,t)},c.prototype.get=function(e){if(this.runningState)return this.getFromState(this.runningState,e);if(1<this.states.length){var t=this.states,r=Array.isArray(t),i=0;for(t=r?t:t[Symbol.iterator]();;){var n;if(r){if(i>=t.length)break;n=t[i++]}else{if((i=t.next()).done)break;n=i.value}var o=n,a=this.getFromState(o,e);if(null!==a)return a}}return null},c.prototype.dispatchEvent=function(t){var r=this;this.runningState?this.dispatchEventToState(this.runningState,t):1<this.states.length&&this.states.forEach(function(e){r.dispatchEventToState(e,t)})},c.prototype.enter=function(e,t){t=t||{};var r=this.findState(e);if(!r)return null;this.initialState||(this.initialState=r);var i=this.runningState;return this.leave(),this.app.trigger("beforeEnterState",{state:i,nextState:r}),i&&(t.prevState=i),this.runningState=r,this.dispatchEventToState(this.runningState,{stateType:"onEnter",params:t}),this.app.trigger("afterEnterState",{state:r,prevState:t.prevState}),delete t.prevState,this.runningState},c.prototype.leave=function(){if(this.runningState){var e={};this.runningState&&(e.state=this.runningState,e.stateName=this.runningState[this.defaultKeyName]),this.app.trigger("beforeLeaveState",e),this.dispatchEventToState(this.runningState,{stateType:"onLeave"}),this.runningState=null,this.app.trigger("afterLeaveState",e)}},c.prototype.addState=function(e,t){void 0===t[this.defaultKeyName]&&(t[this.defaultKeyName]=e),t.isState=!0,(t.stateGroup=this).states.set(e,t)},c.prototype.isInitialState=function(){return this.runningState==this.initialState},c.prototype.isRunningState=function(e){var t=this.findState(e);return!!t&&t==this.runningState},c.prototype.getRunningStateName=function(){if(this.runningState){var e=this.states.keys(),t=Array.isArray(e),r=0;for(e=t?e:e[Symbol.iterator]();;){var i;if(t){if(r>=e.length)break;i=e[r++]}else{if((r=e.next()).done)break;i=r.value}var n=i;if(this.runningState==this.states.get(n))return n}}return""},c.prototype.hasState=function(e){if(Z.isString(e))return this.states.has(e);var t=this.states.keys(),r=Array.isArray(t),i=0;for(t=r?t:t[Symbol.iterator]();;){var n;if(r){if(i>=t.length)break;n=t[i++]}else{if((i=t.next()).done)break;n=i.value}var o=n;if(e==this.states.get(o))return!0}return!1},c.prototype.clear=function(){this.leave();for(var e=[].concat(this.states.values()),t=0;t<e.length;t++)delete e[t];delete this.states},c}(),Vi=function(){function t(e){y(this,t),this.app=e,this.eventManager=e.events,this.stateFactory=new Map,this.stateGroupID=1,this.stateGroups=new Array,this.init()}return t.prototype.init=function(){var t={click:"onClick",dblclick:"onDoubleClick",singleclick:"onSingleClick",mouseover:"onMouseOver",mouseout:"onMouseOut",mouseup:"onMouseUp",mousedown:"onMouseDown",mousemove:"onMouseMove",dragstart:"onDragStart",drag:"onDrag",dragend:"onDragEnd",keydown:"onKeyDown",keypress:"onKeyPress",keyup:"onKeyUp"},r=this;for(var e in t)this.eventManager.addResidentEventListener(e,function(e){e.stateType=t[e.type],r.dispatchEvent(e),delete e.stateType})},t.prototype.clear=function(){this.stateFactory.clear(),this.stateGroupID=1,this.stateGroups=[]},t.prototype.findState=function(e){var t=this.stateGroups,r=Array.isArray(t),i=0;for(t=r?t:t[Symbol.iterator]();;){var n;if(r){if(i>=t.length)break;n=t[i++]}else{if((i=t.next()).done)break;n=i.value}var o=n.findState(e);if(o)return o}return null},t.prototype.findStateGroup=function(e){var t=this.stateGroups,r=Array.isArray(t),i=0;for(t=r?t:t[Symbol.iterator]();;){var n;if(r){if(i>=t.length)break;n=t[i++]}else{if((i=t.next()).done)break;n=i.value}var o=n;if(o.name==e||o.hasState(e))return o}return null},t.prototype.get=function(e){for(var t=0;t<this.stateGroups.length;t++){var r=this.stateGroups[t].get(e);if(r)return r}return null},t.prototype.dispatchEvent=function(t){Z.isString(t)?this.dispatchEvent({type:t}):this.stateGroups.forEach(function(e){e.dispatchEvent(t)})},t.prototype._genGroupName=function(){var e="StateManagerInternal_"+this.stateGroupID.toString();return this.stateGroupID++,e},t.prototype.clone=function(e){var t=this.findStateGroup(e);if(!t)return null;e=this._genGroupName();var r=t.clone(e);return this.stateGroups.push(r),r},t.prototype.remove=function(e){for(var t=0;t<this.stateGroups.length;t++)if(this.stateGroups[t]==e)return e.leave(),this.stateGroups[t].clear(),this.stateGroups.splice(t,1),!0;return!1},t.prototype.register=function(e,t){if(Z.isNull(e))return null;if(Z.isArray(e))return console.error("states should not be array type, use {} instead"),null;var r=Object.keys(e);1==r.length&&void 0===t&&(t=r[0]),Z.isBlank(t)&&(t=this._genGroupName());var i=this.findStateGroup(t);if(i)for(var n in e)i.addState(n,e[n]);else i=new Ui(this.app,t,e),this.stateGroups.push(i);return i},t.prototype.registerEx=function(e,t){for(var r in e)this.stateFactory.set(r,e[r]),e[r]=new e[r](this.app);return this.register(e,t)},t.prototype.unregister=function(e){for(var t=0;t<this.stateGroups.length;t++)if(this.stateGroups[t].name==e)return this.stateGroups[t].clear(),this.stateGroups.splice(t,1),!0;return!1},t.prototype.change=function(e,t){var r=this.findStateGroup(e);return r?r.enter(e,t)||null:(console.error("state group not found: "+e),null)},t.prototype.leave=function(e){var t=this.findStateGroup(e);return t?!!t.isRunningState(e)&&(t.leave(),!0):(console.error("state group not found: "+e),!1)},t.prototype.getRunningState=function(e){var t=this.findStateGroup(e);return t?t.runningState:(console.error("state group not found: "+name),null)},t.prototype.getRunningStateName=function(e){var t=this.findStateGroup(e);return t?t.getRunningStateName():(console.error("state group not found: "+name),null)},t.prototype.hasRunningState=function(e){var t=this.findStateGroup(e);return!!t&&!!t.runningState},t.prototype.update=function(){this.dispatchEvent({stateType:"onUpdate"})},t.prototype.onUpdate=function(e){this.update(e)},t}(),Bi=function(){function r(e,t){y(this,r),this.app=e,this.reverseMode=t,this.commands=[]}return r.prototype.execute=function(){for(var e=0;e<this.commands.length;e++)this.commands[e].execute();this.app.events.dispatchEvent({type:"executeCommand",cmd:this}),this.reverseMode&&this.commands.reverse()},r.prototype.undo=function(){for(var e=0;e<this.commands.length;e++)this.commands[e].undo();this.reverseMode&&this.commands.reverse()},r.prototype.add=function(e){e&&this.commands.push(e)},r.prototype.remove=function(e){if(e){var t=this.commands.indexOf(e);-1<t&&this.commands.slice(t,1)}},r.prototype.clear=function(){this.commands.clear()},r}(),zi=function(){function t(e){y(this,t),this.app=e,this.registerTypes={},this.undoList=[],this.redoList=[],this._doing=!1}return t.prototype.register=function(e,t){this.registerTypes[e]=t},t.prototype._create=function(e){var t=e.type,r=this.registerTypes[t];if(r){e.app=this.app;var i=new r(e);return i.type=t,i}console.error("command not found: "+t)},t.prototype.create=function(e,t){if(Z.isArray(e)){for(var r=new Bi(this.app,t),i=0;i<e.length;i++){var n=this._create(e[i]);r.add(n)}if(r.commands.length)return r}else{if(Z.isObject(e))return this._create(e);Z.isString(e)}return null},t.prototype.execute=function(e,t){var r=this.create(e,t);return r?(r.execute(),this._push(r),this.app.events.dispatchEvent({type:"executeCommand",cmd:r}),r):null},t.prototype._push=function(e){this._doing||(this.undoList.push(e),this.redoList.splice(0,this.redoList.length),this.app.events.dispatchEvent({type:"push"}))},t.prototype.push=function(e){this._push(e)},t.prototype.redo=function(){if(0!=this.redoList.length){this._doing=!0;var e=this.redoList.pop();e.execute(),this.undoList.push(e),this.app.events.dispatchEvent({type:"executeCommand",cmd:e}),this.app.events.dispatchEvent({type:"redo",cmd:e}),this._doing=!1}},t.prototype.undo=function(){if(0!=this.undoList.length){this._doing=!0;var e=this.undoList.pop();e.undo(),this.redoList.push(e),this.app.events.dispatchEvent({type:"executeCommand",cmd:e}),this.app.events.dispatchEvent({type:"undo",cmd:e}),this._doing=!1}},t.prototype.getRedoCount=function(){return this.redoList.length},t.prototype.getUndoCount=function(){return this.undoList.length},t.prototype.toJson=function(){for(var e=0;e<this.undoList.length;e++)this.undoList[e];return"not impl~"},t}(),qi={showHelper:!1,ambientLight:{intensity:.45,color:16777215},hemisphereLight:{intensity:0,color:16777215,groundColor:2236962},mainLight:{shadow:!1,shadowQuality:"high",intensity:.5,color:16777215,alpha:30,beta:30},secondaryLight:{shadow:!1,shadowQuality:"high",intensity:0,color:16777215,alpha:138,beta:0},tertiaryLight:{shadow:!1,shadowQuality:"high",intensity:0,color:16777215,alpha:0,beta:0}},Gi={showHelper:!1,ambientLight:{intensity:0},hemisphereLight:{intensity:0},mainLight:{intensity:0},secondaryLight:{intensity:0},tertiaryLight:{intensity:0}},Wi={showHelper:!1,ambientLight:{intensity:0,color:16777215},hemisphereLight:{intensity:0,color:3310847,groundColor:16763007},mainLight:{shadow:!0,shadowQuality:"high",intensity:.5,color:16777215,alpha:30,beta:30},secondaryLight:{shadow:!1,shadowQuality:"high",intensity:0,color:16777215,alpha:138,beta:0},tertiaryLight:{shadow:!1,shadowQuality:"high",intensity:0,color:16777215,alpha:0,beta:0}},Xi=function(){function t(e){y(this,t),this.app=e,this.events=e.events,this.baseURL=e.baseURL,this.scene=e.scene,this.renderer=e.renderer,this.objectManager=e.objectManager,this.resourceManager=e.resourceManager,this._background=null,this._backgroundResource=null,this._backgroundAdditiveColor=new THREE.Color(0,0,0),this._backgroundColorScaleFactor=new THREE.Vector3(1,1,1),this._skyBox=null,this._skyBoxResource=null,this.sky=null,this._skyLights=e.lightManager.createControl(Wi),this._fogEnable=!1,this._fogConfig={},this._fogLinear=null,this._fogExp2=null,this._enableDeafultViewPointFile=!1,this._defaultViewPointFileName="viewpoint.json",this._effectRefCounts={},this.init()}return t.prototype.init=function(){this.initRenderControl()},t.prototype.initRenderControl=function(){var n=new THREE.Vector3,o=new THREE.Vector3;function r(r,i){r.node.traverse(function(e){if(e.material){n.setFromMatrixPosition(i.matrixWorld),o.setFromMatrixPosition(e.matrixWorld);var t=n.distanceTo(o);0<r.renderDistance&&(e.visible=t<r.renderDistance),0<r.shadowDistance&&(e.castShadow=t<r.shadowDistance)}})}var e=this;this.app.scene.onBeforeRender=function(){var t=e.app.renderCamera;e.objectManager.renderDistanceObjects.forEach(function(e){r(e,t)}),e.objectManager.shadowDistanceObjects.forEach(function(e){r(e,t)})}},t.prototype.synBackgroundColor=function(){var e=this._skyBoxResource;if(e&&e.isCubeTexture){e.colorMatrix=e.colorMatrix||new THREE.Matrix4;var t=this._backgroundAdditiveColor;if(t){var r=new THREE.Vector3(t.r,t.g,t.b);e.colorMatrix.setPosition(r)}var i=this._backgroundColorScaleFactor;if(i){var n=new THREE.Vector3(i.x,i.y,i.z);e.colorMatrix.setScale(n)}}},t.prototype.closeSkyEffect=function(){this.setSkyEffect(null)},t.prototype.setSkyEffect=function(e){if(e){this.sky||(this.sky=new THREE.Sky,this.sky.name="sky",this.sky.frustumCulled=!1,this.sky.scale.setScalar(45e4),this.app.scene.add(this.sky),this.app.scene.__thingSky=this.sky),e=Z.cloneObject(e,!1),Z.mergeObject(e,this._skyEffectConfig||{turbidity:10,rayleigh:2,luminance:1,mieCoefficient:.005,mieDirectionalG:.95,time:9,beta:45,showHelper:!1,auhnujuw:!1}),this._skyEffectConfig=e;var t=this.sky.material.uniforms;t.turbidity.value=e.turbidity||10,t.rayleigh.value=e.rayleigh||2,t.luminance.value=e.luminance||1,t.mieCoefficient.value=e.mieCoefficient||.005,t.mieDirectionalG.value=e.mieDirectionalG||.95,t.mieFowardG_AVON_NIU={value:"avonniu"};var r=Z.parseValue(e.showHelper,!1);Z.parseValue(e.auhnujuw,!1)&&(t.mieWithSkyBox={value:"#A180EA"});var i=e.time,n=i/24*360-90,o=e.beta,a=Z.parseVector3(THING.Math.directionFromAlphaBeta(n,o));a.normalize(),t.sunPosition.value.copy(a),t.moonPosition={value:"naijil"},t.moonDirection={value:"#148158"};var s=(new THREE.Color).setHex(16777215),l=(new THREE.Color).setHex(16746816),c=new THREE.Color,u=i<6||18<i,h=1-Math.abs(i-12)/6,p=c.copy(l).lerp(s,h);this._skyLights.mergeWithSavedConfig({showHelper:r,hemisphereLight:{intensity:Math.min(Math.max(u?0:h+.3,.2),.7)},mainLight:{color:p.getHex(),alpha:n,beta:o}}).mergeConfig(e.lights||{}).lock().active()}else this.app.resourceManager.remove(this.sky),this.app.scene.__thingSky=null,this.sky=null,this._skyEffectConfig=null,this._skyLights.unlock(),this.app.lightManager.getCurrentControl().update()},t.prototype.setFogLinear=function(e,t,r){e=Z.parseColor(e),this._fogLinear?(this._fogLinear.color.set(e),this._fogLinear.near=t,this._fogLinear.far=r):this._fogLinear=new THREE.Fog(e,t,r),this.app.scene.fog=this._fogLinear},t.prototype.clearFogLinear=function(){this._fogLinear&&(this._fogLinear=null,this.app.scene.fog=null)},t.prototype.setFogExp2=function(e,t){e=Z.parseColor(e),this._fogExp2?(this._fogExp2.color.set(e),this._fogExp2.density=t):this._fogExp2=new THREE.FogExp2(e,t),this.app.scene.fog=this._fogExp2},t.prototype.clearFogExp2=function(){this._fogExp2&&(this._fogExp2=null,this.app.scene.fog=null)},t.prototype.closeFog=function(){this.clearFogLinear(),this.clearFogExp2(),this._fogEnable=!1},t.prototype.setFog=function(e){e=e||{},this._fogConfig=Z.mergeObject(this._fogConfig,e,!0);var t=e.type,r=e.color||8421504;if("Exp2"==t){var i=e.density||.1;this.setFogExp2(r,i)}else{var n=e.near||10,o=e.far||100;this.setFogLinear(r,n,o)}this._fogEnable=!0,this.app.needUpdate=!0},t.prototype._updatEffectRefCounts=function(e,t){void 0===this._effectRefCounts[e]&&(this._effectRefCounts[e]=0);var r=this._effectRefCounts[e];this._effectRefCounts[e]+=t;var i=this.app.rendererManager._mainRenderer;0==r&&0<t?Z.isFunction(i.enable)&&i.enable(e):0<r&&0==this._effectRefCounts[e]&&Z.isFunction(i.disable)&&i.disable(e)},t.prototype.showLightHelper=function(e){console.warn("[SceneManager] Please use app.lighting={ showHelper: "+e+" } instead"),this.app.lights.mergeConfig({showHelper:e}).update()},t.prototype.closeSceneLights=function(){console.warn("[SceneManager] Please use app.lighting=null instead"),this.app.lights.mergeConfig(Gi).update()},l(t,[{key:"background",set:function(e){if(this._background=e,this._backgroundResource&&(this._backgroundResource.isTexture&&this._backgroundResource.dispose(),this._backgroundResource=null),e){var t=Z.parseColor(e,null);if(t)this.scene.background=t,this._backgroundResource=t;else if(Z.isString(e))var r=this.app.confirmURL(e),i=this,n=(new THREE.TextureLoader).load(r,function(){i.scene.background=n,i._backgroundResource=n});this.skyBox=null}else this.scene.background=this._skyBoxResource},get:function(){return this._background}},{key:"backgroundAdditiveColor",set:function(e){this._backgroundAdditiveColor=Z.parseColor(e),this.synBackgroundColor()},get:function(){return this._backgroundAdditiveColor.toHexString()}},{key:"backgroundColorScaleFactor",set:function(e){this._backgroundColorScaleFactor=Z.parseVector3(e),this.synBackgroundColor()},get:function(){return this._backgroundColorScaleFactor.toArray()}},{key:"skyBox",set:function(a){if(this._skyBox!=a){this._skyBox=a,this.app.trigger("skyboxchange",{skyBox:a}),this._skyBoxResource&&(this._skyBoxResource.dispose(),this._skyBoxResource=null);var e=this.app.confirmURL(Z.parseCubeTextureUrls(a));if(e)var s=this,l=(new THREE.CubeTextureLoader).load(e,function(e){if(s.skyBox==a){var t=e.image;if(t&&6===t.length){for(var r=t[0].width,i=t[0].height,n=1;n<t.length;n++){var o=t[n];if(o.width!=r||o.height!=i)return void console.error("Load sky box failed, due to image size is invalid, please make sure all size of images must be the same")}l.format=THREE.RGBFormat,s.scene.background=l,s._skyBoxResource=l,s.synBackgroundColor()}}});else this.scene.background=this._backgroundResource}},get:function(){return this._skyBox}},{key:"enableDeafultViewPointFile",set:function(e){this._enableDeafultViewPointFile=e},get:function(){return this._enableDeafultViewPointFile}},{key:"defaultViewPointFileName",set:function(e){this._defaultViewPointFileName=e},get:function(){return this._defaultViewPointFileName}},{key:"fogEnable",get:function(){return this._fogEnable}},{key:"skyEffectEnable",get:function(){return!!this.sky}}]),t}(),Yi=function(){function r(e,t){y(this,r),this.app=e,this.textures=new Map,this._canvas=null,this._enableFileNameAsKey=t,this.loader=new THREE.TextureLoader(this.app.loadingManager)}return r.prototype.isPowerOf2=function(e){return THING.Math.isPowerOf2(e.width)&&THING.Math.isPowerOf2(e.height)},r.prototype.makePowerOf2=function(e){return e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof ImageBitmap?(this._canvas||(this._canvas=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),this._canvas.width=THING.Math.floorPowerOf2(e.width),this._canvas.height=THING.Math.floorPowerOf2(e.height),this._canvas.getContext("2d").drawImage(e,0,0,this._canvas.width,this._canvas.height),this._canvas):e},r.prototype.load=function(e,a,t,r){var i,n=e.getNormalize();i=this._enableFileNameAsKey?n.getFileName(!1):n;var o=this.textures.get(i);if(o)return o.refCount++,a&&(o.image?setTimeout(function(){a(o)},10):(o.delayLoadCallbacks=o.delayLoadCallbacks||[],o.delayLoadCallbacks.push(a))),o;var s=this;if(!(o=this.loader.load(n,function(e){var t=e.image,r=s.textures.get(e.key);if(r){var i=r.delayLoadCallbacks;if(i){for(var n=0;n<i.length;n++)i[n](e);r.delayLoadCallbacks=[]}}var o=s.app.options.maxTextureSize;(t.width>o||t.height>o)&&console.warn("The '"+t.src+"' texture is too big("+t.width+"x"+t.height+"), max size: ("+o+"x"+o+")"),a(e)},t,r)))return null;o.key=i;var l=this.textures.get(i);return l?l.refCount++:(o.refCount=o.refCount||1,this.textures.set(i,o)),o},r.prototype.setCrossOrigin=function(e){return this.loader.setCrossOrigin(e),this},r.prototype.setPath=function(e){return this.loader.setPath(e),this},r.prototype.removeTexture=function(e){var t=this.textures.get(e.key);if(t){if(t.refCount&&t.refCount--,t.refCount)return!1;e.dispose(),this.textures.delete(e.key)}else e.dispose();return!0},r.prototype.loadFromImage=function(e){var t=this.textures.get(e);return t?t.refCount++:((t=new THREE.Texture).image=e,t.needsUpdate=!0,t.key=e),t},l(r,[{key:"enableFileNameAsKey",set:function(e){this._enableFileNameAsKey=e},get:function(){return this._enableFileNameAsKey}},{key:"repetitionRate",get:function(){if(!this.textures.size)return 0;var t=0;return this.textures.forEach(function(e){t+=e.refCount}),t/this.textures.size-1}}]),r}(),Qi=function(){function t(e){y(this,t),this.app=e,this.init()}return t.prototype.init=function(){this.textureLoader=new Yi(this.app),THREE.Loader.Handlers.add(/.*(.jpg|.png)$/,this.textureLoader)},t.prototype.disposeMaterial=function(e,t){if(void 0!==e.refCount){if(e.refCount--,e.refCount)return!1;e.dispose(),t||this.disposeTextures(e)}return!0},t.prototype.disposeTextures=function(e){if(e)for(var t in e){var r=e[t];r&&r.isTexture&&this.textureLoader.removeTexture(r)&&(e[t]=null)}},t.prototype.disposeGeometry=function(e){return!(void 0!==e.refCount&&(e.refCount--,e.refCount)||(e.dispose(),0))},t.prototype.doDispose=function(e,t){var r=2<arguments.length&&void 0!==arguments[2]&&arguments[2];if(null!==e){if(e.children){for(var i=e.children.concat(),n=0;n<i.length;n++)this.doDispose(i[n],t,r);e.children=[]}var o=e.geometry;if(o&&!e.isSprite&&this.disposeGeometry(o),e.material){var a=!1;if(Z.isArray(e.material)){var s=e.material.concat();for(e.material=[],n=0;n<s.length;n++){var l=s[n];r||(a=this.disposeMaterial(l,t))}}else r||(a=this.disposeMaterial(e.material,t));a&&this.app.picker.removePickingMaterial(e)}e.isSkinnedMesh&&(t||this.disposeTextures(e.skeleton))}},t.prototype.remove=function(e,t,r){e&&(e.removeBySelf(),this.unload(e,t,r))},t.prototype.unload=function(e,t,r){e&&(e.isObject3D?this.doDispose(e,t,r):console.error("must provide Object3D to unload"))},t.prototype.loadTexture=function(e){return this.textureLoader.loadFromImage(e)},t}(),Ji=function(){function t(e){y(this,t),this.app=e;var i=this;this.loadingManager=new THREE.LoadingManager(function(){},function(e,t,r){0!=r&&i.app.mainUI.updateDownloadingProgress(t/r)},function(e){console.error("[onError] url: "+e)})}return t.prototype.itemStart=function(e){this.loadingManager.itemStart(e)},t.prototype.itemEnd=function(e){this.loadingManager.itemEnd(e)},t.prototype.itemError=function(e){this.loadingManager.itemError(e)},t.prototype.resolveURL=function(e){return this.loadingManager.resolveURL(e)},t.prototype.setURLModifier=function(e){return this.loadingManager.setURLModifier(e)},t}(),Zi={temporalSuperSampling:{enable:!1,size:30},postEffect:{enable:!1,bloom:{enable:!1,strength:.14,radius:.4,threshold:.7},screenSpaceAmbientOcclusion:{enable:!1,radius:.2,quality:"medium",intensity:.8,temporalFilter:!0,ignoreTransparent:!1},colorCorrection:{enable:!0,exposure:0,brightness:0,contrast:1.15,saturation:1.2,gamma:1},vignette:{enable:!1,type:"blur",color:0,offset:1.5},FXAA:{enable:!1}}},Ki=function(){function r(e,t){y(this,r),this._manager=e,this._defaultConfig=Z.cloneObject(t,!1),this._config=Z.cloneObject(t,!1)}return r.prototype.setConfig=function(e){return this._config=Z.cloneObject(e,!1),this},r.prototype.getConfig=function(){return this._config},r.prototype.save=function(){return this._defaultConfig=Z.cloneObject(this._config,!1),this},r.prototype.mergeConfig=function(e){return e=Z.cloneObject(e,!1),Z.mergeObject(e,this._config),this._config=e,this},r.prototype.mergeWithSavedConfig=function(e){return e=Z.cloneObject(e,!1),Z.mergeObject(e,this._defaultConfig),this._config=e,this},r.prototype.lock=function(){return this._manager.lock(this),this},r.prototype.unlock=function(){return this._manager.unlock(this),this},r.prototype.update=function(e){return this._manager._update(this,e),this},r.prototype.active=function(e){return this._manager._active(this,e),this},r.prototype.destroy=function(){this._manager=null,this._config=null,this._defaultConfig=null},r}(),$i=function(){function e(){y(this,e),this._lockedControl=null,this._control=null}return e.prototype.createControl=function(e){return new Ki(this,e)},e.prototype.lock=function(e){this._lockedControl=e},e.prototype.unlock=function(e){this._lockedControl===e&&(this._lockedControl=null)},e.prototype.getActiveControl=function(){return this._control},e.prototype.getCurrentControl=function(){return this._lockedControl||this._control},e.prototype._active=function(e,t){return this._lockedControl!==e&&(this._control=e),this._lockedControl||this._control},e.prototype._update=function(e,t){var r=this.getCurrentControl();return r===e?r:null},e.prototype.destroy=function(){this._lockedControl=null,this._control=null},e}(),en=function(i){function n(e){y(this,n);var t=p(this,i.call(this));(t.app=e).renderer.localClippingEnabled=!0;var r=e.renderer.getDrawingBufferSize();return t._mainRenderer=new St(r.width,r.height),t}return u(n,i),n.prototype.createControl=function(e){return new tn(this,e)},n.prototype._active=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this.app.root.box;e=i.prototype._active.call(this,e),this._mainRenderer.setConfig(e._config,t)},n.prototype._update=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this.app.root.box,r=i.prototype._update.call(this,e);r&&this._mainRenderer.setConfig(r._config,t)},n.prototype.update=function(){this._mainRenderer.render(this.app.renderer,this.app.scene,this.app.renderCamera);var e=this.app.cssScene;e.children.length&&this.app.cssRenderer.render(e,this.app.renderCamera),this.app.picker.render(this.app.renderer)},n.prototype.resize=function(e,t){this.app.renderer.setSize(e,t),this.app.cssRenderer.setSize(e,t);var r=this.app.renderer.getDrawingBufferSize();this._mainRenderer.setSize(r.width,r.height)},n.prototype.replaceRenderer=function(e){this._mainRenderer=e},n.prototype.closePostEffect=function(){console.warn("[RendererManager] Please use app.postEffect={} instead"),this.app.renderEffects.mergeConfig({postEffect:{enable:!1}}).update()},l(n,[{key:"renderOutline",set:function(e){this._mainRenderer.enableOutline=e}},{key:"needUpdate",set:function(e){e&&this._mainRenderer.dirty()}},{key:"temporalSuperSampling",set:function(e){console.warn("[RendererManager] Please use app.postEffect={} instead"),this.app.renderEffects.mergeConfig({temporalSuperSampling:{enable:e}}).update()},get:function(){return console.warn("[RendererManager] Please use app.postEffect instead"),this.app.renderEffects.getConfig().temporalSuperSampling.enable}},{key:"SSAO",set:function(e){console.warn("[RendererManager] Please use app.postEffect={} instead"),this.app.renderEffects.mergeConfig({postEffect:{screenSpaceAmbientOcclusion:{enable:e}}}).update()},get:function(){return console.warn("[RendererManager] Please use app.postEffect instead"),this.app.renderEffects.getConfig().postEffect.screenSpaceAmbientOcclusion.enable}},{key:"postEffectEnable",get:function(){return console.warn("[RendererManager] Please use app.postEffect instead"),this.app.renderEffects.getConfig().postEffect.enable}}]),n}($i),tn=function(r){function i(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:Zi;return y(this,i),p(this,r.call(this,e,t))}return u(i,r),i}(Ki),rn=function(){function t(e){y(this,t),this.app=e,this.xmlhttp=null,this.time=1500,this.simulate=!0,this.url="",this.cache=!0,this._stop=!1,this._curInterval=null,this.callback=null}return t.prototype.start=function(e){if(this._stop=!1,(this.url=null)!=e&&(null!=e.interval&&(this.time=e.interval),null!=e.url&&(this.url=e.url),null!=e.simulate&&(this.simulate=e.simulate),null!=e.cache&&(this.cache=e.cache),null!=e.callback&&(this.callback=e.callback)),null==this.url||1==this.simulate){var t=parent.getUserPath();if(!t)return void console.log("Service Data Path Error");this.url=t}this._ajax(),console.log("Service startup complete")},t.prototype.stop=function(){this._stop=!0,null!=this._curInterval&&window.clearTimeout(this._curInterval),console.log("Service stop complete")},t.prototype._ajax=function(){var e,a=this;e=a.url,a.xmlhttp=null,window.XMLHttpRequest&&(a.xmlhttp=new XMLHttpRequest),null!=a.xmlhttp?(a.xmlhttp.onreadystatechange=function(){4==a.xmlhttp.readyState&&(200==a.xmlhttp.status?(function(e){var t;for(var r in t=1==Array.isArray(e)?e[0]:e){var i=a.app.query(r);if(0<i.length){var n=t[r];for(var o in n)i[0].attr(o,n[o])}}}(JSON.parse(a.xmlhttp.responseText)),null!=a.callback&&a.callback(a.xmlhttp.getResponseHeader("last-modified"))):console.log("Problem retrieving XML data:"+a.xmlhttp.statusText),0==a._stop&&(a._curInterval=window.setTimeout(function(){a._ajax()},a.time)))},0==a.cache&&(e=-1==e.lastIndexOf("?")?e+"?time="+(new Date).getTime():e+"&time="+(new Date).getTime()),a.xmlhttp.open("GET",e,!0),a.xmlhttp.send(null)):console.error("Your browser does not support XMLHTTP.")},t}(),nn=function(){function t(e){y(this,t),this.app=e,this.viewPointList=[],this.timeoutNumer=null,this._flyCallback=null,this._playIndex=0,this.playLoop=!1,this._pickedObjects=new Set}return t.prototype.start=function(){var t=this;this.app.on(O.Pick,function(e){t._pickedObjects.add(e.object)})},t.prototype.create=function(e,t){null==e&&(e={name:""}),null==e.flyTime?e.flyTime=1e3:"string"==typeof e.flyTime&&(e.flyTime=Number(e.flyTime)),null==e.waitTime?e.waitTime=0:"string"==typeof e.waitTime&&(e.waitTime=Number(e.waitTime));var r=this._take(e);null==t?this.viewPointList.push(r):this.viewPointList.splice(t,0,r)},t.prototype.delete=function(e){0<=e&&e<this.viewPointList.length&&this.viewPointList.splice(e,1)},t.prototype.recover=function(e){try{var o=this,a=this.viewPointList[e],t=null;null!=a.events&&(t=function(){for(var e=a.events,t=0;t<e.length;t++){var r=e[t],i=o.app.query("#"+r.id);if(0<i.length)for(var n=0;n<r.event.length;n++)i[0].dispatch(r.event[n])}}),0!=a.waitTime?(null!=o.timeoutNumer&&clearTimeout(o.timeoutNumer),this.timeoutNumer=setTimeout(function(){o._fly(a,t),o.timeoutNumer=null},a.waitTime)):this._fly(a,t)}catch(e){console.log(e)}},t.prototype.update=function(e,t,r){if(null!=e){null==t&&(t={}),"string"==typeof t.flyTime&&(t.flyTime=Number(t.flyTime)),"string"==typeof t.waitTime&&(t.waitTime=Number(t.waitTime));var i={};return r?i=this._take(t,e):(i=this.viewPointList[e],null!=t.flyTime&&(i.flyTime=t.flyTime),null!=t.waitTime&&(i.waitTime=t.waitTime),null!=t.flyTime&&(i.name=t.name)),this.viewPointList[e]=i}},t.prototype.play=function(e){null!=e&&(this.playLoop=e),this._playIndex=0,this._flyCallback=null,0<this.viewPointList.length&&this._next()},t.prototype.pause=function(e){void 0===e&&(e=!0),e?(null!=this.timeoutNumer&&clearTimeout(this.timeoutNumer),this.app.camera.flying&&this.app.camera.stopFlying()):0<this.viewPointList.length&&this._next()},t.prototype.swap=function(e,t){var r=this.viewPointList[e][e];return this.viewPointList[e][e]=this.viewPointList[e][t],this.viewPointList[e][t]=r,this.viewPointList[e]},t.prototype.stop=function(){null!=this.timeoutNumer&&clearTimeout(this.timeoutNumer),this.app.camera.flying&&this.app.camera.stopFlying(),this._flyCallback=null,this._pickedObjects.clear()},t.prototype.saveJSON=function(){var e={name:"",pointList:this.viewPointList};return JSON.stringify(e)},t.prototype.loadJSON=function(e){var t=e;"string"==typeof e&&(t=JSON.parse(e)),null!=t.pointList&&(this.viewPointList=t.pointList)},t.prototype.clearAll=function(){stop(),this.viewPointList=[]},t.prototype._take=function(e,t){var r={};null!=t&&(r=this.viewPointList[t]),null!=e.flyTime&&(r.flyTime=e.flyTime),null!=e.waitTime&&(r.waitTime=e.waitTime),null!=e.name&&(r.name=e.name),r.position=this.app.camera.position,r.target=this.app.camera.target,r.up=this.app.camera.up,r.image=this.app.captureScreenshotToImage(140,118,"jpeg",.1);var i=this._getPickedEvents();return 0<i.length&&(r.events=i),r},t.prototype._getPickedEvents=function(){for(var e=[],t=this._pickedObjects,r=0,i=t.length;r<i;r++){var n=t[r];if(n){var o={id:n.id,event:[]};n.hasEvent("click")&&o.event.push("click"),n.hasEvent("singleclick")&&o.event.push("singleclick"),0!=o.event.length&&e.push(o)}}return this._pickedObjects.clear(),e},t.prototype._fly=function(e,t){var r=this,i={position:e.position,target:e.target,time:e.flyTime,complete:function(e){null!=t&&t(),null!=r._flyCallback&&r._flyCallback()}};e.up&&(i.up=e.up),r.app.camera.flyTo(i)},t.prototype._next=function(){var e=this;if(this._playIndex>this.viewPointList.length-1){if(0==this.playLoop)return void(this._flyCallback=null);this.play()}this._flyCallback=function(){e._playIndex+=1,e._next()},this.recover(this._playIndex)},t}(),on=function(){function t(e){y(this,t),this.app=e,this._modelBaseURL="http://model.3dmomoda.cn/models/"}return t.prototype.initOptions=function(e){this.app.resourceManager.textureLoader},t.prototype.parseDoorOrWindow=function(r,e,t){var o=this;function i(e,t){var r=o.app.objectManager.create({type:"Door",id:t.id,name:t.name,node:t.delayObject,parent:e,animations:t.resource.animations,properties:t.properties});if(t.isOpen&&r.open(),r.animationClips)for(var i=0;i<r.animationClips.length;i++){var n=r.animationClips[i];if("_defaultAnim_"===n.name){r.playAnimation({name:n.name,loop:!0,speed:.15});break}}return r}e.mesh?i():e.initCompleteCallback=function(e){var t=i(r,e);r.miscNode.add(t.node)}},t.prototype.parseWall=function(e,t,r){for(var i=0;i<t.doorOrWindows.length;i++){var n=t.doorOrWindows[i];this.parseDoorOrWindow(e,n,r)}},t.prototype.parseGroups=function(e,t,r){for(var i=0;i<t.groups.length;i++){var n=t.groups[i],o="Thing";n.jsonData&&n.jsonData.type&&(o=n.jsonData.type),this.app.objectManager.create({id:n.id,name:n.name,node:n.delayObject,type:o,parent:e,properties:n.properties})}},t.prototype.parsePlacements=function(e,t,r){for(var i=0;i<t.placements.length;i++){var n=t.placements[i],o="Thing";if(n.jsonData&&n.jsonData.type&&(o=n.jsonData.type),n.mesh){var a=this.app.objectManager.create({id:n.id,type:o,name:n.name,node:n.delayObject,parent:e,url:n.resource.getModelUrl(),animations:n.resource.animations,properties:n.properties});if(a.bundleID=n.resource.modelID,a.bundleName=n.resource.modelName,n.isPlayAnim&&a.containAnimation(n.animClip)){var s={name:n.animClip,loop:!1,speed:.15};n.hasSkin&&(s.loop=!0),a.playAnimation(s)}}}},t.prototype.parseRooms=function(e,t,r){for(var i=0;i<t.rooms.length;i++){var n=t.rooms[i];this.app.objectManager.create({type:"Room",name:n.name,node:n.mesh,ceilingNode:n.ceiling.mesh,roofNode:n.roof.mesh,floorNode:n.floor.mesh,parent:e,properties:n.properties})}},t.prototype.parsePlan=function(e,t,r){for(var i=new THREE.Object3D("combineFloor"),n=0;n<t.combineFloors.length;n++){var o=t.combineFloors[n];i.add(o)}e.node.add(i),e.floorNode=i;var a=new THREE.Object3D("combineCeiling");for(n=0;n<t.combineCeilings.length;n++){var s=t.combineCeilings[n];a.add(s)}e.node.add(a),e.ceilingNode=a;var l=new THREE.Object3D("combineRoof");for(n=0;n<t.combineRoofs.length;n++){var c=t.combineRoofs[n];l.add(c)}e.node.add(l),e.roofNode=l;var u=new THREE.Object3D("combinePlacement");for(n=0;n<t.combinePlacements.length;n++){var h=t.combinePlacements[n];u.add(h)}e.node.add(u),e.miscNode=u;for(var p=new THREE.Object3D("combineWall"),d=0;d<t.combineStraightManualWalls.length;d++){var f=t.combineStraightManualWalls[d];p.add(f)}for(d=0;d<t.combineModelWalls.length;d++)f=t.combineModelWalls[d],p.add(f);for(d=0;d<t.combineDoorOrWins.length;d++)h=t.combineDoorOrWins[d],p.add(h);e.node.add(p),e.wallNode=p},t.prototype.parseFloor=function(e,t,r){var i=t.buildings[0].floorplans[0];this.parsePlan(e,i,r),this.parseGroups(e,i,r),this.parsePlacements(e,i,r),this.parseRooms(e,i,r);for(var n=0;n<i.walls.length;n++){var o=i.walls[n];this.parseWall(e,o,r)}},t.prototype._generateWindow=function(e,t){var r=void 0!==e.typeId?e.typeId:"15DA293545E84A3680F93CF7D4227BD9";this.app.create({type:"Door",name:e.key,url:this._modelBaseURL+r+"/0/gltf/",localPosition:[.01*e.pos[0],3*e.suspendpercent,.01*e.pos[1]],parent:t,complete:function(){this.scale=[.01*e.width/this.boundingBox.size[0],.01*e.height/this.boundingBox.size[1],1],this.angles=[0,-e.rotation,0]}})},t.prototype._generateDoor=function(e,t){var r=void 0!==e.typeId?e.typeId:"d8ff0aaa4e87439bbededc8c6590491c";this.app.create({type:"Door",name:e.key,url:this._modelBaseURL+r+"/0/gltf/",localPosition:[.01*e.pos[0],0,.01*e.pos[1]],parent:t,complete:function(){this.scale=[.01*e.width/this.boundingBox.size[0],.01*e.height/this.boundingBox.size[1],1],this.angles=[0,-e.rotation,0]}})},t.prototype.parseFloorThings=function(t,e,r){var i=this;e.doors.forEach(function(e){e.suspendpercent?i._generateWindow(e,t):i._generateDoor(e,t)})},t.prototype.load=function(r,e,i){e=this.app.confirmURL(e);var n=this;new THREE.FileLoader(this.app.loadingManager).load(e+"/scene.json",function(e){var t=JSON.parse(e);n.loadFromData(r,t,i)})},t.prototype.loadFromData=function(t,r,i){var e,s,l;i=i||{},this.initOptions(i),s={version:"2",unit:1,walls:[],rooms:[],doors:[],textures:[],models:[]},l=(e=r).data,s.textures=e.res.textures,s.models=e.res.models,s.walls=l.walls.map(function(e){return void 0===e.sourceType?{weight:e.thickness,start:[e.points[0],e.points[1]],end:[e.points[2],e.points[3]],height:e.height,type:0,model:0,lefttexture:0,righttexture:0,edgetexture:1}:{weight:e.thickness,start:[e.points[0],e.points[1]],end:[e.points[2],e.points[3]],height:e.height,type:e.sourceType,model:e.model,lefttexture:e.lefttexture,righttexture:e.righttexture,edgetexture:e.edgetexture}}),s.rooms=l.rooms.map(function(e){var n={points:[],holes:[],center:[e.textLoc[0],e.textLoc[1]]};return e.polygons.forEach(function(e,t){for(var r=0===t?n.points:[],i=0;i<e.length/2;i++)r.push([e[2*i+0],e[2*i+1]]);0!==t&&n.holes.push(r)}),n}),l.doors.forEach(function(e){var t=l.walls[e.wallIndex];e.loc;var r=[t.points[0],t.points[1]],i=[t.points[2],t.points[3]],n=[r[0]+(i[0]-r[0])*e.loc,r[1]+(i[1]-r[1])*e.loc],o=s.models[e.typeIndex],a={key:e.key,typeId:o.id,width:e.size[0],height:180,pos:n,rotation:sn(t)};s.doors.push(a)}),l.windows.forEach(function(e){var t=l.walls[e.wallIndex],r=[t.points[0],t.points[1]],i=[t.points[2],t.points[3]],n=[r[0]+(i[0]-r[0])*e.loc,r[1]+(i[1]-r[1])*e.loc],o=s.models[e.typeIndex],a={key:e.key,typeId:o.id,width:e.size[0],height:100,suspendpercent:.4,pos:n,rotation:sn(t)};s.doors.push(a)}),r=s;var n=i.complete;json2mesh.DefaultSetting.enableFloorLightMap=Z.parseValue(i.enableFloorLightMap,!1);var o=r.version,a=this,c=this._createLoader(o);c.delayLoad({json:r}).then(function(e){a.parseFloor(t,e,i),c.loadResources().then(function(){n&&n(t),a.parseFloorThings(t,r,i)})})},t.prototype._createLoader=function(e){return e&&2<=new sr(e).major?new json2mesh.ThingjsEditorSceneLoader_2_0:new json2mesh.ThingjsEditorSceneLoader},t}(),an=new THREE.Vector2;function sn(e){return an.set(e.points[0]-e.points[2],e.points[1]-e.points[3]),an.angle()/Math.PI*180}var ln=function(){function t(e){y(this,t),this.app=e,this._loading=!1,this._updateTime=0,this._loadingFloors=[],this._initEvents()}return t.prototype._initEvents=function(){var t=this;this.app.on("levelchange",function(e){var r=e.current;r instanceof cr?t._loadingFloors.sort(function(e,t){return e.owner.parent!=r?1:t.owner.parent!=r?-1:e.owner.indexOfBuilding-t.owner.indexOfBuilding}):r instanceof It&&t._loadingFloors.sort(function(e,t){return e.owner==r?-1:t.owner==r?1:e.owner.node.id-t.owner.node.id})})},t.prototype.update=function(){if(this._loadingFloors.length&&!(this._loading||(this._updateTime+=this.app._deltaTime,this._updateTime<.25))){this._updateTime=0;var e=this._loadingFloors[0],t=e.owner,r=e.url,i=e.jsonData,n=e.options,o=this,a=n.complete;n.complete=function(e){a&&a(e),o._loading=!1},this._loading=!0;var s=new on(this.app);r?s.load(t,r,n):s.loadFromData(t,i,n),this._loadingFloors.splice(0,1)}},t.prototype.load=function(e,t,r){this._loadingFloors.push({owner:e,url:t,options:r})},t.prototype.loadFromData=function(e,t,r){this._loadingFloors.push({owner:e,jsonData:t,options:r})},t.prototype.onUpdate=function(e){this.update(e)},t}(),cn=function(){function t(e){y(this,t),this.app=e,this._outputLog=!1}return t.prototype.outputPathLog=function(e){for(var t="",r=0;r<e.length;r++){var i=this.app.query("#"+e[r])[0];i&&(t+="("+i.type+":"+i.name+":"+i.id+")=>")}t=t._trimRight("=>"),console.log(t)},t.prototype._getParentObject=function(e,t){if(e.getNavigation(t))return e;for(var r=e.parents,i=0;i<r.length;i++){var n=r[i];if(n.getNavigation(t))return n}return null},t.prototype._getObject=function(e,t){var r=e.isFloor?e:e.parents.query(".Floor")[0];return r&&t?r.getRoomFromWorldPosition(t):e},t.prototype._getObjectRoot=function(e,t){function r(e,t){if(t==e)return e;if(t.isChildOf(e))return e;for(var r=e.parents,i=0;i<r.length;i++){var n=r[i];if(t==n)return n;if(t.isChildOf(n))return n}return null}var i=r(e,t),n=r(t,e);return i.isChildOf(n)?n:i},t.prototype._setupGraph=function(e,t){var r=this._getObjectRoot(e,t);if(!r)return null;for(var i=r;i;i=i.parent)if(Z.isFunction(i.setupGraph))return i.setupGraph();return null},t.prototype._buildPathes=function(e){for(var t=[],r=null,i=0;i<e.length;i++){var n=this.app.query("#"+e[i])[0];if(!n.isCampus){var o=n.parent;r!=o?(t.push({startObject:n,endObject:n}),r=o):t[t.length-1].endObject=n}}return t},t.prototype.findPath=function(e){var t=(e=e||{}).clipAreas,r=e.startObject||e.startRoom||e.start,i=e.endObject||e.endRoom||e.end;if(!r||!i)return console.error("Needs start and end objects to find path in navigation"),null;var n=e.startPosition||r.position,o=e.endPosition||i.position;if(!n||!o)return console.error("Needs start and end positions to find path in navigation"),null;var a=this._getParentObject(r,t),s=this._getParentObject(i,t);if(!a||!s)return console.error("The parents are not support navigation"),null;if(r=this._getObject(r,n),i=this._getObject(i,o),!r||!i)return console.error("The objects are not support navigation"),null;var l=this._setupGraph(a,s);if(!l)return null;var c=[];if(a==s){var u=a.findPath(n,o);if(!u)return null;c.push({entrance:a,points:u})}else{var h=l.findShortestPath(r.id,i.id);if(!h||!h.length)return null;this._outputLog&&this.outputPathLog(h);var p=this._buildPathes(h);if(!p.length)return null;var d,f=p[0].endObject;if(!(d=a.findPath(n,f.position)))return null;c.push({points:d,entrance:f});for(var m=1;m<p.length-1;m++){var g=p[m];if(g.startObject!=g.endObject){var v=this.findPath({startObject:g.startObject,endObject:g.endObject});if(!v)return null;c.push(v)}}var y,b=p[p.length-1].startObject;if(!(y=s.findPath(b.position,o)))return null;c.push({points:y,entrance:b})}return c},l(t,[{key:"outputLog",set:function(e){this._outputLog=e},get:function(){return this._outputLog}}]),t}(),un=function(){function t(e){y(this,t),this.app=e,this.renderer=null,this.enable=!1,this.interval=0,this.time=0,this.renderableNodes=[],this.renderableNodeIndex=0}return t.prototype.updateMeshes=function(){this.renderableNodeIndex=0,this.renderableNodes=[];var t=this;this.app.scene.traverseRenderableNodes(function(e){e.onBeforeRender=function(){t.renderableNodes.push({node:this,visible:this.visible}),this.visible=!1,this.onBeforeRender=function(){}}})},t.prototype.start=function(e,t){this.renderer=e,this.enable=!0,this.interval=t,this.renderableNodeIndex=0,this.updateMeshes()},t.prototype.end=function(){this.renderer=null,this.enable=!1;for(var e=this.interval=0;e<this.renderableNodes.length;e++){var t=this.renderableNodes[e].node,r=this.renderableNodes[e].visible;t.visible=r}this.renderableNodes=[]},t.prototype.dirty=function(){this.renderer.dirty()},t.prototype.setConfig=function(e){this.renderer.setConfig(e)},t.prototype.setSize=function(e,t){this.renderer.setSize(e,t)},t.prototype.render=function(e,t,r){if(this.time+=this.app.deltaTime,this.time>=this.interval)if(this.time=0,this.renderableNodeIndex<this.renderableNodes.length-1){var i=this.renderableNodes[this.renderableNodeIndex++].node,n=0;new TWEEN.Tween({progress:0}).to({progress:1},.9*this.interval).onStart(function(){if(i.visible=!0,i._debugger_prevMaterial=i.material,Z.isArray(i._debugger_prevMaterial)){i.material=[];for(var e=0;e<i._debugger_prevMaterial.length;e++)i.material.push(i._debugger_prevMaterial[e].clone())}else i.material=i.material.clone();i.material.depthTest=!1,i.material.color=new THREE.Color(1,0,0),i.material.side=THREE.DoubleSide}).onUpdate(function(){this._object.progress>n&&(n+=.25,1==i.material.color.r?i.material.color.set(65280):i.material.color.set(16711680))}).onComplete(function(){i.material=i._debugger_prevMaterial,delete i._debugger_prevMaterial}).start()}else this.updateMeshes();this.renderer.render(e,t,r)},t}(),hn=function(){function t(e){y(this,t),this.app=e,this._renderStepByStep=!1,this._enable=!1,this.stats=null,this._statsFlag=0,this.panel=null,this.renderConfig={name:"",lights:!0,shadow:!0,wireframe:!1,renderStepByStep:!1,renderStepByStepInterval:500},this.pickConfig={name:"",raycaster:!1,objectID:"",nodeName:"",uuid:"",x:0,y:0,z:0,local_x:0,local_y:0,local_z:0,node:null},this.navigationConfig={name:"",enable:!1,showHelper:!1,positions:[],pathFinder:null,pathLines:[],objects:[]},this.rendererDebugger=new un(e),this.prevMainRenderer=null,window.performance=window.performance||{},performance.now=performance.now||performance.mozNow||performance.msNow||performance.oNow||performance.webkitNow||function(){return(new Date).getTime()}}return t.prototype.outputLog=function(){var e=Z.system.getBrowserInfo();e&&console.log("browser: ["+e.type+", "+e.version+"]");var t=Z.system.getOSVersion();t&&console.log("OSVersion: ["+t.type+", "+t.version+"]")},t.prototype.setupFunctions=function(e){var r=this;if(e){this._Box3_expandByPoint=THREE.Box3.prototype.expandByPoint,THREE.Box3.prototype.expandByPoint=function(e){return isNaN(e.x)||isNaN(e.y)||isNaN(e.z)?console.error("point is NaN for box3::expandByPoint()"):(this.min.min(e),this.max.max(e)),this};var i=function(){return r.app.renderer.context};this._WebGL2RenderingContext_shaderSource=WebGL2RenderingContext.prototype.shaderSource,WebGL2RenderingContext.prototype.shaderSource=function(e,t){return r._WebGL2RenderingContext_shaderSource.call(i(),e,t)},this._WebGL2RenderingContext_compileShader=WebGL2RenderingContext.prototype.compileShader,WebGL2RenderingContext.prototype.compileShader=function(e){return r._WebGL2RenderingContext_compileShader.call(i(),e)}}else THREE.Box3.prototype.expandByPoint=this._Box3_expandByPoint||THREE.Box3.prototype.expandByPoint,WebGL2RenderingContext.prototype.shaderSource=this._WebGL2RenderingContext_shaderSource||WebGL2RenderingContext.prototype.shaderSource,WebGL2RenderingContext.prototype.compileShader=this._WebGL2RenderingContext_compileShader||WebGL2RenderingContext.prototype.compileShader},t.prototype.setupEvents=function(e){var x=this;e?(this.app.domElement.onfocus=function(e){console.log("THING dom element focus on")},this.app.domElement.oninvalid=function(e){console.log("THING dom element invalid on")},this.app.domElement.onerror=function(e){console.log("THING dom element error on")},this.app.domElement.onsuspend=function(e){console.log("THING dom element suspend on")},this.app.on("update",function(){x.renderStepByStep=x.app.events.isKeyPressed(C.Shift),x.renderStepByStep&&(x.app._deltaTime=.001)},"debugger::setupEvents::update"),this.app.on("click",function(e){var t=x.pickConfig;t.x=0,t.y=0,t.z=0,t.local_x=0,t.local_y=0,t.local_z=0;var r=e.pickedPosition;if(r&&(t.x=r[0],t.y=r[1],t.z=r[2]),t.objectID="",t.nodeName="",t.uuid="",e.intersect){if(s=e.intersect.object){t.objectID=s.id;var i=s.worldToSelf(r);i&&(t.local_x=i[0],t.local_y=i[1],t.local_z=i[2])}var n=e.intersect.node;n&&(t.nodeName=n.name.isBlank()?n.type:n.name,t.uuid=n.uuid)}var o=x.app.isKeyPressed(C.Ctrl),a=x.app.isKeyPressed(C.Alt);if(o){var s;if((s=e.object)&&(console.log(s),e.intersect.node&&console.log(e.intersect.node)),a){var l=e.pickedPosition;l&&console.log("["+l.toString()+"]")}var c=x.navigationConfig;if(c.enable&&e.pickedPosition){var u=c.positions;u.push({object:e.object,position:e.pickedPosition});var h=c.objects;if(1===u.length){for(var p=0;p<h.length;p++)h[p].destroy();c.objects=[],h=c.objects;var d=x.app.create({type:"Sphere",position:e.pickedPosition,style:{color:65280}});h.push(d)}else if(2===u.length){c.pathFinder=c.pathFinder||new cn(x.app),c.pathFinder.outputLog=!0;var f=c.pathLines;for(p=0;p<f.length;p++)f[p].destroy();c.pathLines=[],f=c.pathLines;var m={startObject:u[0].object,startPosition:u[0].position,endObject:u[1].object,endPosition:u[1].position,clipAreas:c.clipAreas};console.log("Start to find (["+m.startPosition+"]->["+m.endPosition+"]) path ...");var g=c.pathFinder.findPath(m);if(g)for(console.log("Found (["+m.startPosition+"]->["+m.endPosition+"]) path completed"),p=0;p<g.length;p++){var v=g[p],y=x.app.create({type:"RouteLine",image:"images/diffuse.jpg",points:v.points,style:{color:"#58DEDE"}});f.push(y)}var b=x.app.create({type:"Sphere",position:e.pickedPosition,style:{color:16711680}});h.push(b),c.positions=[]}}}this.app.trigger("debuggerclick",{pickConfig:t})},"debugger::setupEvents::click")):(this.app.domElement.onfocus=null,this.app.domElement.oninvalid=null,this.app.domElement.onerror=null,this.app.domElement.onsuspend=null,this.app.off("update",null,"debugger::setupEvents::update"),this.app.off("click",null,"debugger::setupEvents::click"))},t.prototype.setupTimers=function(e){var t=this;e?this._objectManagerTimer=this._objectManagerTimer||setInterval(function(){1e4<t.app.objectManager.tickableObjects.length&&console.warn("There are too many update objects, please reduce and check it")},5e3):this._objectManagerTimer&&(clearInterval(this._objectManagerTimer),delete this._objectManagerTimer)},t.prototype.setupParticleEvents=function(e){},t.prototype.setRenderStepByStepInterval=function(e){this.rendererDebugger.interval=e},t.prototype.enableRenderStepByStep=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1e3;if(this.enable&&this.rendererDebugger.enable!=e){var r=this.app.rendererManager;e?(this.prevMainRenderer=r._mainRenderer,this.rendererDebugger.start(r._mainRenderer,t),r.replaceRenderer(this.rendererDebugger)):(this.rendererDebugger.end(),r.replaceRenderer(this.prevMainRenderer),this.prevMainRenderer=null)}},t.prototype.hasEnabledRenderStepByStep=function(){return this.rendererDebugger.enable},t.prototype.begin=function(){this.stats&&this.stats.begin()},t.prototype.end=function(){this.stats&&this.stats.end()},t.prototype._enableMaterialValue=function(e,t,r){if(Z.isArray(t))for(var i=0;i<t.length;i++)this._enableMaterialValue(e,t[i],r);else r?Z.revertValue(t,e):Z.setValue(t,e,!1)},t.prototype.enableLights=function(r){var i=this;this.app.scene.traverse(function(e){var t=e.material;t&&i._enableMaterialValue("lights",t,r)})},t.prototype.enableShadow=function(r){var i=this;this.app.scene.traverse(function(e){var t=e.material;t&&(i._enableMaterialValue("castShadow",t,r),i._enableMaterialValue("receiveShadow",t,r))})},t.prototype.enableWireframe=function(e){this.app.root.wireframeColor=e?0:null},t.prototype.enableNavigation=function(e){},t.prototype.getTableName=function(){for(var e=[this.renderConfig.name,this.pickConfig.name,this.navigationConfig.name],t={},r=0;r<e.length;r++)t[e[r]]={};return t},t.prototype.initRenderPanel=function(){var t=this,e=this.renderConfig.name;this.panel.add(this.renderConfig,"lights").link(e).caption("").on("change",function(){var e=t.renderConfig.lights;t.enableLights(e)}),this.panel.add(this.renderConfig,"shadow").link(e).caption("").on("change",function(){var e=t.renderConfig.shadow;t.enableShadow(e)}),this.panel.add(this.renderConfig,"wireframe").link(e).caption("").on("change",function(){var e=t.renderConfig.wireframe;t.enableWireframe(e)}),this.panel.add(this.renderConfig,"renderStepByStep").link(e).caption("").on("change",function(){var e=!t.hasEnabledRenderStepByStep();t.enableRenderStepByStep(e)}),this.panel.add(this.renderConfig,"renderStepByStepInterval").link(e).step(1).min(10).max(1e3).caption("").isChangeValue(!0).on("change",function(){t.setRenderStepByStepInterval(t.renderConfig.renderStepByStepInterval)})},t.prototype.initPickerPanel=function(){var l=this,e=this.pickConfig.name;this.panel.add(this.pickConfig,"raycaster").link(e).caption("").on("change",function(){l.pickConfig.raycaster?(l.pickConfig.node=new THREE.Group,l.app.scene.add(l.pickConfig.node),l.app.on("click",function(e){var t=l.app.camera.getRaycaster(e.x,e.y),r=t.ray.origin.clone(),i=t.ray.direction.clone();i.normalize();var n=new THREE.Vector3;n.addVectors(r,i.multiplyScalar(1e4));var o=new THREE.Geometry;o.vertices.push(r),o.vertices.push(n);var a=new THREE.LineBasicMaterial({color:16711680}),s=new THREE.Line(o,a);l.pickConfig.node.add(s)},"__debugger_raycaster__")):(l.app.off("click",null,"__debugger_raycaster__"),l.app.resourceManager.remove(l.pickConfig.node),l.pickConfig.node=null)}),this.panel.add(this.pickConfig,"objectID").caption("ID").link(e),this.panel.add(this.pickConfig,"nodeName").caption("").link(e),this.panel.add(this.pickConfig,"uuid").caption("UUID").link(e),this.panel.add(this.pickConfig,"x").caption("-x").link(e),this.panel.add(this.pickConfig,"y").caption("-y").link(e),this.panel.add(this.pickConfig,"z").caption("-z").link(e),this.panel.add(this.pickConfig,"local_x").caption("-x").link(e),this.panel.add(this.pickConfig,"local_y").caption("-y").link(e),this.panel.add(this.pickConfig,"local_z").caption("-z").link(e)},t.prototype.initNavigationPanel=function(){var i=this,e=this.navigationConfig.name;this.panel.add(this.navigationConfig,"enable").link(e).caption("").on("change",function(){}),this.panel.add(this.navigationConfig,"showHelper").link(e).caption("").on("change",function(){app.query(".Floor || .Ground").forEach(function(e){var t=i.navigationConfig.showHelper,r=e.getNavigation();r&&r.showHelper(t)})})},t.prototype.initPanel=function(){if(!this.panel){this.panel=new THING.widget.Panel({isDrag:!0,hasTitle:!0,name:"",width:"680px"});var e=this.panel,t=this.getTableName();e.addTab(t),this.initRenderPanel(),this.initPickerPanel(),this.initNavigationPanel(),e.setPosition(0,180)}},l(t,[{key:"enable",set:function(e){if(this._enable!=e){if(e){this.stats=new Stats,this.stats.showPanel(this._statsFlag),document.body.appendChild(this.stats.dom);var t=this;Z.dynamicLoadJS("https://thingjs.com/static/release/thing.widget.min.js",function(){t.initPanel(),t.panel.visible=!0})}else document.body.removeChild(this.stats.dom),this.stats=null,this.enableRenderStepByStep(!1),this.panel&&(this.panel.visible=!1);this._enable=e,this.setupFunctions(e),this.setupEvents(e),this.setupTimers(e),e&&this.outputLog()}},get:function(){return this._enable}},{key:"statsFlag",set:function(e){this._statsFlag=e,this.stats&&this.stats.showPanel(this._statsFlag)},get:function(){return this._statsFlag}},{key:"renderStepByStep",set:function(e){this._renderStepByStep!=e&&(this._renderStepByStep=e,this.setupParticleEvents(e))},get:function(){return this._renderStepByStep}}]),t}(),pn=function(i){function r(e){y(this,r);var t=p(this,i.call(this));return t.app=e,t._lightGroup=new mn(e),t}return u(r,i),r.prototype.createControl=function(e){return new dn(this,e)},r.prototype._active=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this.app.root.box;this._lightGroup.set(i.prototype._active.call(this,e)._config,t)},r.prototype._update=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this.app.root.box,r=i.prototype._update.call(this,e);r&&this._lightGroup.set(r._config,t)},r.prototype.destroy=function(){i.prototype.destroy.call(this),this.app=null,this._lightGroup.destroy()},r}($i),dn=function(r){function i(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:qi;return y(this,i),p(this,r.call(this,e,t))}return u(i,r),i}(Ki),fn=new THREE.Sphere,mn=function(){function t(e){y(this,t),this.app=e,this.lightGroup=new THREE.Group,this.lightGroup.name="light_group",this.app.scene.add(this.lightGroup),this.ambientLight=new THREE.AmbientLight,this.ambientLight.name="ambient_light",this.lightGroup.add(this.ambientLight),this.hemisphereLight=new THREE.HemisphereLight(16777215,2236962,1),this.hemisphereLight.name="hemisphere_light",this.lightGroup.add(this.hemisphereLight),this.mainLight=new THREE.DirectionalLight,this.mainLight.name="main_light",this.mainLight.helper=new THREE.DirectionalLightHelper(this.mainLight),this.lightGroup.add(this.mainLight),this.lightGroup.add(this.mainLight.helper),this.secondaryLight=new THREE.DirectionalLight,this.secondaryLight.name="secondary_light",this.secondaryLight.helper=new THREE.DirectionalLightHelper(this.secondaryLight),this.lightGroup.add(this.secondaryLight),this.lightGroup.add(this.secondaryLight.helper),this.tertiaryLight=new THREE.DirectionalLight,this.tertiaryLight.name="tertiary_light",this.tertiaryLight.helper=new THREE.DirectionalLightHelper(this.tertiaryLight),this.lightGroup.add(this.tertiaryLight),this.lightGroup.add(this.tertiaryLight.helper)}return t.prototype.destroy=function(){this.app.scene.remove(this.lightGroup),this.app=null,this.mainLight.helper.dispose(),this.secondaryLight.helper.dispose(),this.tertiaryLight.helper.dispose()},t.prototype.set=function(e,t){var r=t.getBoundingSphere(fn);this.ambientLight.intensity=e.ambientLight.intensity,this.ambientLight.color.set(Z.parseColor(e.ambientLight.color)),this.hemisphereLight.intensity=e.hemisphereLight.intensity,this.hemisphereLight.color.set(Z.parseColor(e.hemisphereLight.color)),this.hemisphereLight.groundColor.set(Z.parseColor(e.hemisphereLight.groundColor)),this.app.isMobileDevice&&(e.mainLight.castShadow=!1,e.secondaryLight.castShadow=!1,e.tertiaryLight.castShadow=!1),this._setDirectLight(this.mainLight,e.mainLight,r,e.showHelper),this._setDirectLight(this.secondaryLight,e.secondaryLight,r,e.showHelper),this._setDirectLight(this.tertiaryLight,e.tertiaryLight,r,e.showHelper),this.app.needUpdate=!0},t.prototype._setDirectLight=function(e,t,r,i){if(e.intensity=t.intensity,e.visible=0<t.intensity,e.color.set(Z.parseColor(t.color)),e.position.copy(Z.parseVector3(THING.Math.directionFromAlphaBeta(t.alpha,t.beta))),e.position.normalize().multiplyScalar(r.radius||1).add(r.center),e.target.position.copy(r.center),e.target.updateMatrixWorld(!0),e.helper.visible=e.visible&&i,e.helper.visible&&e.helper.update(),e.castShadow=t.shadow&&!this.app.isMobileDevice,e.castShadow){var n=e.shadow.camera;n.top=n.right=r.radius,n.bottom=n.left=-r.radius,n.near=.1,n.far=2*r.radius,n.updateProjectionMatrix();var o={low:512,medium:1024,high:2048,ultra:4096}[t.shadowQuality]||1024;e.shadow.bias=-.003,e.shadow.radius=.1,e.shadow.mapSize.set(o,o)}this.app.root.static&&e._synMatrixWorld()},l(t,[{key:"enable",set:function(e){this.lightGroup.visible!==e&&(this.lightGroup.visible=e,this.app.needUpdate=!0)},get:function(){return this.lightGroup.visible}}]),t}(),gn=function(){function r(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:512;y(this,r),this._size=e,this._maps=[];for(var t=0;t<this._size;t++)this._maps.push(new Map)}return r.prototype.getMap=function(e){return this._maps[e%this._size]},r.prototype.set=function(e,t){return this.getMap(e).set(e,t)},r.prototype.get=function(e){return this.getMap(e).get(e)},r.prototype.delete=function(e){return this.getMap(e).delete(e)},r.prototype.forEach=function(t){for(var e=0,r=this._maps.length;e<r;e++)this._maps[e].forEach(function(e){t(e)})},r}(),vn=["#include <skinning_pars_vertex>","uniform float size;","uniform float scale;","uniform float baseId;","","varying vec4 worldId;","","void main() {","#include <skinbase_vertex>","#include <begin_vertex>","#include <skinning_vertex>","#include <project_vertex>","  vec3 a = fract(vec3(1.0/255.0, 1.0/(255.0*255.0), 1.0/(255.0*255.0*255.0)) * baseId);","  a -= a.xxy * vec3(0.0, 1.0/255.0, 1.0/255.0);","  worldId = vec4(a,1);","}"].join("\n"),yn=["uniform float size;","uniform float scale;","uniform float baseId;","","varying vec4 worldId;","","void main() {","  vec3 a = fract(vec3(1.0/255.0, 1.0/(255.0*255.0), 1.0/(255.0*255.0*255.0)) * baseId);","  a -= a.xxy * vec3(0.0, 1.0/255.0, 1.0/255.0);","  worldId = vec4(a,1);","  gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),bn=["#ifdef GL_ES\n","precision highp float;\n","#endif\n","","varying vec4 worldId;","","void main() {","  gl_FragColor = worldId;","}"].join("\n"),xn=function(e){THREE.ShaderMaterial.call(this,{uniforms:{baseId:{type:"f",value:0},size:{type:"f",value:.01},scale:{type:"f",value:400}},vertexShader:e?vn:yn,fragmentShader:bn})};((xn.prototype=Object.create(THREE.ShaderMaterial.prototype)).constructor=xn).prototype.setBaseID=function(e){this.uniforms.baseId.value=e},xn.prototype.setPointSize=function(e){this.uniforms.size.value=e},xn.prototype.setPointScale=function(e){this.uniforms.scale.value=e};var En,_n=function(){function r(e,t){y(this,r),t=t||{},this.app=e,this.camera=e.renderCamera,this.renderer=e.renderer,this.needUpdate=!0,this.updateTime=0,this.debugScene=null,this.sprite=null,this.camera2D=null,this.pickingTexture=new THREE.WebGLRenderTarget,this.pickingTexture.texture.minFilter=THREE.LinearFilter,this.pickingTexture.texture.generateMipmaps=!1,this.pickMaterials=new gn(64),this.lineShell=Z.parseValue(t.lineShell,4),this.pointShell=Z.parseValue(t.pointShell,.1),this.debug=Z.parseValue(t.debug,!1),this.init();var l=this;this.app.renderer.materialManager.addStrategy("gpuPicker",function(e,t,r,i,n,o){var a=this.id;if(this.userData.skipPick)return null;if(!n.visible)return null;if(!n.opacity)return null;var s=l.pickMaterials.get(a);return s||(s=l.createPickingMaterial(this,n),l.pickMaterials.set(a,s)),s._node=this,s})}return r.prototype.init=function(){var e=this.renderer.getSize();this.resizeTexture(e.width,e.height)},r.prototype.resizeTexture=function(e,t){this.pickingTexture.setSize(e,t),this.pixelBuffer=new Uint8Array(4*e*t),this.sprite&&this.sprite.scale.set(2*e,2*t,1),this.camera2D&&(this.camera2D.left=-e/2,this.camera2D.right=e/2,this.camera2D.top=t/2,this.camera2D.bottom=-t/2,this.camera2D.updateProjectionMatrix()),this.needUpdate=!0},r.prototype.update=function(e){this.updateTime+=e},r.prototype.removePickingMaterial=function(e){if(e.isObject3D){var t=this;e.traverse(function(e){e.material&&t.removePickingMaterial(e.id)})}else{var r=this.pickMaterials.get(e);if(r){if(r.length)for(var i=0;i<r.length;i++){var n=r[i];n.color=null,n.uniforms=null,n.dispose()}else r.color=null,r.uniforms=null,r.dispose();this.pickMaterials.delete(e)}}this.forceUpdate=!0},r.prototype._createPickingMaterial=function(e,t){var r,i=e.userData,n=t.size||.01,o=t.linewidth||1;return t.isSpriteMaterial||i.noBlending||t.isShaderMaterial&&-1<t.vertexShader.indexOf("USE_GPUPICKER")?((r=t.clone()).alphaTest=.1,r.blending=THREE.NoBlending,r.lights=!1,r.fog=!1,r.visible=!(!t.visible||i.skipPick),r.baseId=e.id,r.defines=r.defines||{},r.defines.USE_GPUPICKER=""):((r=new xn(t.skinning)).map=null,r.color=new THREE.Color,r.uniforms.config={value:{x:0,y:0}},r.linewidth=o+this.lineShell,r.depthTest=t.depthTest,r.depthWrite=t.depthWrite,r.transparent=t.transparent,r.opacity=1,r.side=t.side,r.skinning=t.skinning,r.visible=!(!t.visible||i.skipPick),r.polygonOffset=t.polygonOffset,r.polygonOffsetFactor=t.polygonOffsetFactor,r.polygonOffsetUnits=t.polygonOffsetUnits,r.baseId=e.id,r.setPointSize(n+this.pointShell),r.setPointScale(this.renderer.getSize().height*this.renderer.getPixelRatio()/2)),r},r.prototype.createPickingMaterial=function(e,t){if(t.length){for(var r=[],i=0;i<t.length;i++)r.push(this._createPickingMaterial(e,t[i]));return r}return this._createPickingMaterial(e,t)},r.prototype.updatePickingTexture=function(e){var t=this.app.renderer.materialManager,r=t.getMode();t.setMode("gpuPicker");var i=e.autoUpdate;e.autoUpdate=!1,this.renderer.render(e,this.camera,this.pickingTexture),e.autoUpdate=i,this.renderer.readRenderTargetPixels(this.pickingTexture,0,0,this.pickingTexture.width,this.pickingTexture.height,this.pixelBuffer),t.setMode(r)},r.prototype.pick=function(e,n,t,r,i){var o=5<arguments.length&&void 0!==arguments[5]&&arguments[5];this.needUpdate&&!o&&.25<=this.updateTime&&(this.updatePickingTexture(e),this.needUpdate=!1,this.updateTime=0);var a=this.pickingTexture.width,s=this.pickingTexture.height;if(t=Math.round(t),r=Math.round(r),t<0||a<=t)return null;if(r<0||s<=r)return null;var l=t+(s-r-1)*a,c=255*this.pixelBuffer[4*l+2]*255+255*this.pixelBuffer[4*l+1]+this.pixelBuffer[4*l+0];if(isNaN(c))return null;var u=this.getNode(c);if(null==u)return null;var h=this,p={node:u,object:u,raycaster:i.clone(),getPickedPosition:function(e){e=e||{};var t=this.raycaster.intersectObject(this.node,!1);if(t.length)return t[0].point;var r=function(e,t){for(var r=e.intersectObject(t,!0),i=0;i<r.length;i++){var n=r[i];if(!n.object.userData.skipPick)return n.point}return null},i=r(this.raycaster,this.node.parent);if(i)return i;if(!e.skipOtherPick){if(!e.skipParentPick&&this.node.parent&&(i=r(this.raycaster,this.node.parent)))return i;if(!e.skipObjectPick){var n=h.app.objectManager.getAncestors(this.node);if(n&&(i=r(this.raycaster,n.node)))return i}if(!e.skipScenePick&&(i=r(this.raycaster,h.app.scene)))return i}return new THREE.Vector3}};return Object.defineProperties(p,{pickedPosition:{get:function(){return void 0===p._pickedPosition&&(p._pickedPosition=p.getPickedPosition().toArray()),p._pickedPosition}},distance:{get:function(){if(void 0===p._distance){var e=p.pickedPosition;if(e){var t=new THREE.Vector3(e[0],e[1],e[2]);p._distance=t.distanceTo(n.position)}else{var r=new THREE.Vector3;u.getWorldPosition(r);var i=new THREE.Vector3;n.getWorldPosition(i),p._distance=i.distanceTo(r)}}return p._distance}}}),p},r.prototype.getNode=function(e){var t=this.pickMaterials.get(e);return t?t._node:null},r.prototype.show=function(e){if(e||void 0===e){if(!this.sprite){var t=new THREE.SpriteMaterial({map:this.pickingTexture.texture});this.sprite=new THREE.Sprite(t),this.sprite.scale.set(this.pickingTexture.width,this.pickingTexture.height,1),this.sprite.position.set(0,0,-10),this.debugScene=new THREE.Scene,this.debugScene.add(this.sprite);var r=this.renderer.getSize();this.camera2D=new THREE.OrthographicCamera(-r.width/2,r.width/2,r.height/2,-r.height/2,.1,100)}}else this.debugScene&&this.sprite&&(this.debugScene.remove(this.sprite),this.sprite=null,this.debugScene=null,this.camera2D=null)},r.prototype.render=function(e){this.debugScene&&e.render(this.debugScene,this.camera2D,null,!0)},l(r,[{key:"forceUpdate",set:function(e){e&&(this.needUpdate=!0,this.updateTime=.25)}}]),r}(),wn=function(){function r(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];y(this,r),this._changeFunc=e,this._enable=t,this._prevEnable=t,this._enableCounter=0}return r.prototype.enable=function(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1];return void 0===e?this._enable:(this._enable=e,t?this._prevEnable!=this._enable&&this._enableCounter++:(this._enableCounter=0,this._prevEnable=e),this._changeFunc&&this._changeFunc(e),e)},r.prototype.resume=function(){this._prevEnable!=this._enable&&(1<this._enableCounter?this._enableCounter--:this.enable(this._prevEnable))},r}(),Tn=function(){function o(e){y(this,o),this.app=e;var t=new THREE.PlaneGeometry(1e4,1e4,1,1),r=new THREE.MeshStandardMaterial({color:2200782,side:THREE.DoubleSide,transparent:!0,opacity:.25});this._vertGround=new THREE.Mesh(t,r),this._vertGround.visible=!1,this._vertGround.setAngles([90,0,0]),this._vertGround.updateMatrixWorld();var i=new THREE.PlaneGeometry(1e4,1e4,1,1),n=new THREE.MeshStandardMaterial({color:13538337,side:THREE.DoubleSide,transparent:!0,opacity:.25});this._horzGround=new THREE.Mesh(i,n),this._horzGround.visible=!1,this._horzGround.setAngles([90,0,0]),this._horzGround.updateMatrixWorld(),this.pickingScene=new THREE.Scene,this.pickingScene.add(this._vertGround),this.pickingScene.add(this._horzGround)}return o.prototype.destroy=function(){this.app.resourceManager.remove(this.pickingScene)},o.prototype.update=function(e,t){this._vertGround.lookAt(Z.parseVector3(e)),this._vertGround.position.copy(Z.parseVector3(t)),this._vertGround.updateMatrixWorld()},o.prototype.intersect=function(e,t){var r=this.app.camera.getRaycaster(e,t),i=r.intersectObjectForcible(this._horzGround),n=r.intersectObjectForcible(this._vertGround);return i.length&&n.length?i[0].distance<n[0].distance?i[0]:n[0]:i.length?i[0]:n.length?n[0]:null},l(o,[{key:"visible",set:function(e){e?this.app.scene.add(this.pickingScene):this.app.scene.remove(this.pickingScene),this._vertGround.visible=e,this._horzGround.visible=e}}]),o}(),Mn=function(){function t(e){y(this,t),this.app=e,this.sprite=null,this.spriteLineNode=null,this.started=!1,this.startX=0,this.startY=0,this.distanceX=0,this.distanceY=0,this.region=[],this._areaPickType=M.Auto,this._realTimePicking=!1,this.depth=-10}return t.prototype.initLines=function(){if(!this.spriteLineNode){var e=new THREE.Geometry;e.vertices=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3];var t=new THREE.LineBasicMaterial({color:16777215,opacity:.8,linewidth:1,transparent:!0});this.spriteLineNode=new THREE.Line(e,t),this.spriteLineNode.visible=!1,this.spriteLineNode.computeLineDistances(),this.app.mainUI.scene2D.add(this.spriteLineNode)}},t.prototype.initSprite=function(){if(!this.sprite){var e=new THREE.SpriteMaterial({opacity:.4,color:32768,transparent:!0});this.sprite=new THREE.Sprite(e),this.sprite.visible=!1,this.app.mainUI.scene2D.add(this.sprite)}},t.prototype.setSpritePosition=function(e,t){var r=this.app.calcRect(),i=e-r.width/2,n=t-r.height/2;this.sprite.position.set(i,-n,this.depth)},t.prototype.setSpriteLinePosition=function(e,t,r,i){var n=this.spriteLineNode.geometry,o=n.vertices,a=r/2,s=i/2,l=new THREE.Vector3(e-a,t-s,this.depth),c=new THREE.Vector3(e+a,t-s,this.depth),u=new THREE.Vector3(e+a,t+s,this.depth),h=new THREE.Vector3(e-a,t+s,this.depth);o[0].copy(l),o[1].copy(c),o[2].copy(u),o[3].copy(h),o[4].copy(l),n.verticesNeedUpdate=!0},t.prototype.updateRegion=function(){var e=this.startX,t=this.startX+this.distanceX,r=this.startY,i=this.startY+this.distanceY,n=!1;if(t<e){var o=e;e=t,t=o,n=!0}if(i<r){var a=r;r=i,i=a,n=!0}switch(this._areaPickType){case M.Auto:this._realTimePicking=!n;break;case M.RealTime:this._realTimePicking=!0;break;case M.NotRealTime:this._realTimePicking=!1}this.region=[e,r,t,i]},t.prototype.start=function(e,t){this.initSprite(),this.initLines(),this.started=!0,this.distanceX=1,this.distanceY=1,this.startX=e,this.startY=t,this.setSpritePosition(e,t),this.sprite.scale.set(1,1,1);for(var r=this.sprite.children,i=0;i<r.length;i++)r[i].position.set(0,0,0);this.sprite.visible=!0,this.app.trigger(O.AreaPickStart),this.updateRegion(),this.move(e,t)},t.prototype.move=function(e,t){this.distanceX=e-this.startX,this.distanceY=t-this.startY,this.setSpritePosition(this.startX+this.distanceX/2,this.startY+this.distanceY/2);var r=this.distanceX?this.distanceX:1,i=this.distanceY?this.distanceY:1;this.distanceX<0&&(r*=-1),this.distanceY<0&&(i*=-1),this.sprite.scale.set(r,i,1),this.setSpriteLinePosition(this.sprite.position.x,this.sprite.position.y,r,i),this.spriteLineNode.visible=!0,this.updateRegion()},t.prototype.end=function(){this.started&&(this.started=!1,this.sprite&&(this.sprite.visible=!1),this.spriteLineNode&&(this.spriteLineNode.visible=!1),this.app.trigger(O.AreaPickEnd))},t.prototype.intersectPoint=function(e){var t=e[0],r=e[1],i=this.region;return!(t<i[0]||t>i[2]||r<i[1]||r>i[3])},t.prototype.intersectObject=function(e,t){for(var r=this.app.camera,i=new THREE.Vector3,n=(e.isBaseObject?e.node:e).getMeshes(),o=0;o<n.length;o++){var a=n[o],s=a.geometry,l=a.matrixWorld;if(s.isBufferGeometry){o=s.index;var c=s.attributes.position;if(null!==o){var u=Math.max(1,Math.floor(o.count*t));for(d=0,f=o.count;d<f;d+=u){i.fromBufferAttribute(c,o.getX(d)),i.applyMatrix4(l);var h=r.worldToScreen(i);if(this.intersectPoint(h))return!0}}else if(void 0!==c)for(var p=Math.max(1,Math.floor(c.count*t)),d=0,f=c.count;d<f;d+=p)if(i.fromBufferAttribute(c,d),i.applyMatrix4(l),h=r.worldToScreen(i),this.intersectPoint(h))return!0}else if(s.isGeometry){var m=s.vertices,g=Math.max(1,Math.floor(m.length*t));for(d=0,f=m.length;d<f;d+=g)if((i=m[d].clone()).applyMatrix4(l),h=r.worldToScreen(i),this.intersectPoint(h))return!0}}return!1},t.prototype.processPicking=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:.01,r=this.app.picker,i=[];if(r._results.clear(),e)for(var n=0;n<e.length;n++){var o=e[n];if(this.intersectObject(o,t)){r._results.add(o);var a=r.pickedResultFunc;if(a&&!(o=a(o)))continue;-1===i.indexOf(o)&&i.push(o)}}return i},l(t,[{key:"realTimePicking",get:function(){return this._realTimePicking}}]),t}(),Sn=function(){function r(e,t){y(this,r),this.app=e,this.domElem=e.domElement,this._state=new wn,this._changed=!1,this.intersect=null,this.dragIntersect=null,this.lastPickFrame=-1,this.lastPickPosition=null,this._pickedResultsFunc=null,this._pickedResultFunc=null,this._results=new ye(this.app),this._objects=new ye(this.app),this._previousObjects=new ye(this.app),this.pickingArea=new Mn(this.app),this._areaCandidates=new ye(this.app),this._areaPicking=!1,this.cameraPickingGround=new Tn(this.app),this.floorPickingGround=new Tn(this.app),this._disableGPUPicker=!1,this.gpuPicker=null,t&&(this.gpuPicker=new _n(this.app,{debug:!1})),this.initEvents()}return r.prototype.initEvents=function(){var r=this;this.app.on("destroy",function(e){var t=e.object;r._areaCandidates.remove(t)})},r.prototype.getPickedObject=function(e){return this.app.objectManager.getAncestors(e)},r.prototype.filter=function(e,t){if(null==e)return null;for(var r=[],i=[],n=0;n<e.length;n++){var o=e[n],a=o.object;if(!a.userData.skipPick){var s=this.getPickedObject(a);if(s&&!s.node.userData.skipPick){if(this._results.add(s),this._pickedResultFunc&&!t){var l=this._pickedResultFunc(s);if(!l)continue;o.node=l.node}if(!this._pickedResultsFunc||t){i=[o];break}-1===r.indexOf(s)&&r.push(s),i.push(o)}}}if(this._pickedResultsFunc&&!t){var c={objects:r,result:null};if(this._pickedResultsFunc(c),c.result){var u=r.indexOf(c.result);-1!==u&&(i=[i[u]])}}return i[0]},r.prototype.isTopSprite=function(e){return!e.material.depthTest},r.prototype.sortIntersectObjects=function(e){var l=this;e.sort(function(e,t){var r=e.object,i=t.object,n=r.userData,o=i.userData;if(!n.topNode&&o.topNode)return-1;if(n.topNode&&!o.topNode)return 1;if(n.subNode&&!o.subNode)return-1;if(!n.subNode&&o.subNode)return 1;if(r.isSprite){if(l.isTopSprite(r)&&!i.isSprite)return-1}else if(i.isSprite){if(l.isTopSprite(i)&&!r.isSprite)return 1}else{var a=r.material,s=i.material;if(a.depthTest&&!s.depthTest)return 1;if(!a.depthTest&&s.depthTest)return-1}return e.distance-t.distance})},r.prototype.pickIntersectObjects=function(e,t,r,i,n){var o=[];if(t=this._disableGPUPicker||t,this.gpuPicker&&!t){var a=this.app.objectManager.interactableNodes;a.length&&e.intersectEnsureVisibleObjects(o,a,!0,this.app.renderCamera);var s=this.gpuPicker.pick(this.app.scene,this.app.renderCamera,i,n,e,r);s&&o.push(s)}else{o=e.intersectObject(this.app.scene,!0);for(var l=0;l<o.length;l++){var c=o[l].object.material;c.opacity&&c.visible||o.splice(l--,1)}}return o},r.prototype._checkIntersectResult=function(e){if(e){var t=e.object;t&&(t.isBaseObject&&(t=t.node),t.parent||console.error("Pick unlinkable object, please check whether its parent node: "+t))}},r.prototype.__isSameFrame=function(e,t,r){return!r&&this.lastPickFrame==this.app.currentFrameCount&&!!this.lastPickPosition&&this.lastPickPosition[0]==e&&this.lastPickPosition[1]==t},r.prototype._isSameFrame=function(e,t,r){return!!this.__isSameFrame(e,t,r)||(this.lastPickPosition=this.lastPickPosition||[0,0],this.lastPickPosition=[e,t],this.lastPickFrame=this.app.currentFrameCount,!1)},r.prototype.intersectObject=function(e,t,r){var i=r.disableGPUPicker,n=r.ignoreFrameCheck,o=r.ignoreFilter,a=r.skipUpdateTexture;if(r.forceUpdateTexture){var s=this.gpuPicker;s&&(s.forceUpdate=!0)}if(this._pickedResultsFunc&&(i=!0),!this.enable)return null;if(this._isSameFrame(e,t,n))return this.intersect;this.intersect=null,this._results.clear();var l=this.app.camera.getRaycaster(e,t),c=this.pickIntersectObjects(l,i,a,e,t);if(null==c||0==c.length)return null;this.sortIntersectObjects(c);var u=this.filter(c,o);u?(this.intersect=u,this.intersect.object=this.getPickedObject(u.node||u.object),this.app.debugMode&&this._checkIntersectResult(this.intersect)):this.intersect=c;var h=this.intersect.point;return h&&h.isVector3&&(this.intersect.point=h.toArray()),this.intersect},r.prototype.showPickingGround=function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];this.cameraPickingGround.visible=e},r.prototype.processGroundPicking=function(e,t){if(!this.app.isInScreen([e,t]))return null;var r=this.app.camera;return this.app.renderCamera.updateMatrixWorld(),this.cameraPickingGround.update(r.position,r.target),this.cameraPickingGround.intersect(e,t)},r.prototype.processPicking=function(e){var t=new THREE.Vector2;t.x=e.clientX,t.y=e.clientY;var r=e.offset;r&&(t.x+=r[0],t.y+=r[1]);var i=this.intersectObject(t.x,t.y,e);return null==i?null:(e.intersect=i,e.object=i.object,e.picked=!0,Object.defineProperties(e,{pickedPosition:{get:function(){return this.intersect.pickedPosition||this.intersect.point}}}),e.pickedObj=e.object,e.getPickedPos=function(){return console.warn("Please use .getPickedPosition() to replace .getPickedPos()"),e.getPickedPosition()},e.getPickedPosition=function(){return console.warn("Please use .pickedPosition to replace .getPickedPosition()"),e.pickedPosition},i)},r.prototype.removePickingMaterial=function(e){var t=this.gpuPicker;t&&t.removePickingMaterial(e)},r.prototype.notifyChanged=function(){this.app.trigger(O.PickChange,{objects:this._objects,previousObjects:this._previousObjects});for(var e=this._objects.concat(this._previousObjects),t=0;t<e.length;t++)e[t].trigger(O.PickChange,{objects:this._objects,previousObjects:this._previousObjects});this._previousObjects.buildReturnObject(this._objects)},r.prototype.update=function(e){this.gpuPicker&&this.gpuPicker.update(e),this._changed&&(this.notifyChanged(),this._changed=!1)},r.prototype.resize=function(e,t){this.gpuPicker&&(this.gpuPicker.resizeTexture(e,t),this.gpuPicker.needUpdate=!0)},r.prototype.render=function(e){this.gpuPicker&&this.gpuPicker.render(e)},r.prototype.hasPicked=function(e,t){if(!t)return!1;if(!this.intersect)return!1;var r=this.intersect.object;if(!r)return!1;if(r!=t){if(e._stopPropagation)return!1;if(!r.isChildOf(t))return!1}return!0},r.prototype.setPickedObject=function(e){if(!(e instanceof Ee&&this._objects.has(e))){for(var t=0;t<this._objects.length;t++){var r=this._objects[t];r.trigger(O.Unpick),this.app.trigger(O.Unpick,{object:r})}this._objects.clear(),e&&(this._objects.add(e),e.trigger(O.Pick)),this.app.trigger(O.Pick,{object:e,objects:this._objects,previousObjects:this._previousObjects}),this._previousObjects.equals(this._objects)||(this._changed=!0)}},r.prototype.isChanged=function(){return this._changed},r.prototype.intersectResult=function(e,t,r,i){if(i=i||{},void 0===e||void 0===t){var n=this.app.camera.worldToScreen(this.app.camera.target);e=n[0],t=n[1]}var o={clientX:e,clientY:t,offset:r,disableGPUPicker:Z.parseValue(i.disableGPUPicker,!1),ignoreFrameCheck:Z.parseValue(i.ignoreFrameCheck,!0),ignoreFilter:Z.parseValue(i.ignoreFilter,!0),skipUpdateTexture:Z.parseValue(i.skipUpdateTexture,!1)},a=this.processPicking(o);return a?(o.getPickedPosition=function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];return a.getPickedPosition?a.getPickedPosition(e):[0,0,0]},delete o.offset,delete o.disableGPUPicker,delete o.ignoreFrameCheck,delete o.ignoreFilter,delete o.skipUpdateTexture,o):{picked:!1,pickedPosition:null,object:null}},r.prototype.pickObjects=function(e,t,r,i,n){if(void 0!==r||void 0!==i)return this.pickingArea.startX=e,this.pickingArea.startY=t,this.pickingArea.distanceX=r,this.pickingArea.distanceY=i,this.pickingArea.updateRegion(),this.pickingArea.processPicking(n);if(void 0===e||void 0===t){var o=this.app.camera.worldToScreen(this.app.camera.position);e=o[0],t=o[1]}for(var a=this.app.camera.getRaycaster(e,t),s=this.pickIntersectObjects(a,!0),l=new Set,c=0;c<s.length;c++){var u=this.app.objectManager.getAncestors(s[c].object);u&&l.add(u)}return Array.from(l)},r.prototype.pickWorldPosition=function(e,t,r){return this.intersectResult(e,t,r).pickedPosition},r.prototype.startAreaPicking=function(e){var t=(e=e||{}).x,r=e.y,i=Z.parseValue(e.realTimePicking,!0),n=Z.parseValue(e.drawRegion,!0);Z.isNumber(t)&&Z.isNumber(r)&&(this.app.camera.disable({rotate:!0}),this.pickingArea.start(t,r),this.pickingArea._areaPickType=i?M.RealTime:M.NotRealTime,this.pickingArea.sprite.visible=n,this.pickingArea.spriteLineNode.visible=n,this._areaPicking=!0)},r.prototype.endAreaPicking=function(){if(this.areaPicking){this.pickingArea.end(),this.pickingArea._areaPickType=M.Auto,this.app.camera.resume({rotate:!0});var e=this;setTimeout(function(){e._areaPicking=!1},10)}},l(r,[{key:"enable",set:function(e){this._state.enable(e)},get:function(){return this._state.enable()}},{key:"disableGPUPicker",set:function(e){this._disableGPUPicker=e}},{key:"areaPicking",get:function(){return!!this.enable&&this._areaPicking}},{key:"needUpdate",set:function(e){this.gpuPicker&&(this.gpuPicker.needUpdate=e)}},{key:"areaCandidates",set:function(e){this._areaCandidates.buildReturnObject(e)},get:function(){return this._areaCandidates}},{key:"pickedResultsFunc",set:function(e){this._pickedResultsFunc=e},get:function(){return this._pickedResultsFunc}},{key:"pickedResultFunc",set:function(e){this._pickedResultFunc=e},get:function(){return this._pickedResultFunc}},{key:"results",get:function(){return this._results}},{key:"objects",get:function(){return this._objects}},{key:"previousObjects",get:function(){return this._previousObjects}},{key:"filterPickedResultsFunc",set:function(e){console.warn("[Picker] please use .pickedResultsFunc instead"),this.pickedResultsFunc=e},get:function(){return console.warn("[Picker] please use .pickedResultsFunc instead"),this.pickedResultsFunc}},{key:"pickedObjectFunc",set:function(e){console.warn("[Picker] please use .pickedResultFunc instead"),this.pickedResultFunc=e},get:function(){return console.warn("[Picker] please use .pickedResultFunc instead"),this.pickedResultFunc}},{key:"enabled",set:function(e){console.warn("[Picker] please use .enable instead"),this.enable=e},get:function(){return console.warn("[Picker] please use .enable instead"),this.enable}},{key:"candidates",set:function(e){console.warn("[Picker] please use .areaCandidates instead"),this.areaCandidates=e},get:function(){return console.warn("[Picker] please use .areaCandidates instead"),this.areaCandidates}}]),r}(),Rn=function(){function t(e){y(this,t),this.app=e,this._objects=new ye(this.app),this._previousObjects=new ye(this.app),this._changed=!1}return t.prototype.notifyChanged=function(){this.app.trigger(O.SelectionChange,{objects:this._objects,previousObjects:this._previousObjects});var t=this;this._objects.forEach(function(e){e.trigger(O.SelectionChange,{objects:t._objects,previousObjects:t._previousObjects})}),this._previousObjects.buildReturnObject(this._objects)},t.prototype.update=function(){this._changed&&(this.notifyChanged(),this._changed=!1)},t.prototype.select=function(e){e&&(this._objects.add(e),e.trigger(O.Select,{object:this._objects}),this.app.trigger(O.Select,{object:e,objects:this._objects}),this._changed=!0)},t.prototype.deselect=function(e){this._objects.remove(e);var t=new ye(this.app);e instanceof Ee?t.add(e):t=e;for(var r=0;r<t.length;r++)(e=t[r]).trigger(O.Deselect,{objects:t});this.app.trigger(O.Deselect,{objects:t}),this._changed=!0},t.prototype.has=function(e){return this._objects.has(e)},t.prototype.clear=function(){if(this._objects.length){this.app.trigger(O.Deselect,{objects:this._objects});for(var e=0;e<this._objects.length;e++)this._objects[e].trigger(O.Deselect,{objects:this._objects});this._objects.clear(),this._changed=!0}},t.prototype.isChanged=function(){return this._changed},t.prototype.onUpdate=function(e){this.update(e)},l(t,[{key:"objects",get:function(){return this._objects}},{key:"previousObjects",get:function(){return this._previousObjects}}]),t}(),Pn=function(){function r(e){y(this,r),this.app=e;var t=this.app.calcRect();this.resize(t.width,t.height)}return r.prototype.updateProgress=function(e){return this.loadingProgressBar.updateProgress(e)},r.prototype.updateDownloadingProgress=function(e){},r.prototype.updateLoadingProcess=function(e){this.updateProgress(e)&&this.app.events.dispatchEvent({type:"progress",progress:e})},r.prototype._createLogoSpriteMaterial=function(l,e,t){var r=document.createElement("canvas");r.width=512,r.height=512;var i=r.getContext("2d");i.font="24px Verdana",i.fillStyle="white",i.textAlign="center",i.textBaseline="middle";var n=[0,0,0],o=THING.Math.degToRad(30);i.shadowColor="rgba("+255*n[0]+","+255*n[1]+","+255*n[2]+",1)",i.shadowBlur=1,i.shadowOffsetX=2*Math.cos(o),i.shadowOffsetY=2*Math.sin(o),function(e,t,r,i,n){for(var o=l.split("\n"),a=0;a<o.length;a++){var s=o[a];e.fillText(s,256,i),i+=40}}(i,0,0,256);var a=new THREE.Texture(r);return a.needsUpdate=!0,new THREE.SpriteMaterial({opacity:e,color:16777215,transparent:!0,depthWrite:!1,map:a,rotation:THING.Math.degToRad(t)})},r.prototype._createLogoSprites=function(e,t,r){for(var i=this.app.calcRect(),n=2*i.width,o=2*i.height,a=[],s=-o;s<o;s+=r)for(var l=-n;l<n;l+=t){var c=new THREE.Sprite(e);c.scale.set(512,512,1),c.position.set(l,s,-10),a.push(c)}return a},r.prototype._setupSprite=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:480,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:320;En&&this.app.resourceManager.remove(En);var i=e.t1,n=this._createLogoSpriteMaterial(i,.04,30),o=this._createLogoSprites(n,t,r);En=new THREE.Group;for(var a=0;a<o.length;a++)En.add(o[a]);this.scene2D.add(En)},r.prototype._setup=function(){if(!(new bi).b()&&[32].toString()!=[32].toString()){var e=function(e){e=e||window;var t=THING._textKeyEncoder,r=t.toStr([76,243,170,237,85,62]),i=t.toStr([83,249,168,254,66,63,61,235]),n=t.toStr([80,230,174,241]),o=t.toStr([87,226,191,239,12,121,125,242,74,24,10,48,244,135,138,115,8,255,55,165,90,89,198]),a=t.update(e[i][r]),s=[107,254,162,241,81,28,1,165,95,22,4,49,245,128,138,123,20,237],l=[0,248,170,242,83,107,125];0==a.toString().indexOf(l.toString())&&(s=[107,254,162,241,81,28,1,165,95,22,4,49,245,128,138,123,20,237,19,238,115,70,140,104,130,136,181,43,46,118,51,30,119]);var c=[0,0];return 1==Z.r(0,1)&&(0==Z.r(0,1)?c[1]=Z.r(10,230):c[0]=Z.r(50,400)),{b1:n,c1:o,d1:c,e1:r,f1:l,gs:[[0,248,170,242,83,107,125,240,77,3,75,37,248,157,203,100,3,239,114,167,82,81],[0,248,170,242,83,107,125,245,18],[0,251,246,176,70,121]],h1:a,t1:t.toStr(s)}}(this.l);if(e){var t=e.gs;if(t)for(var r=e.h1.toString(),i=0;i<t.length;i++)if(0==r.indexOf(t[i].toString()))return;this._setupSprite(e)}}},r.prototype.onResize=function(e,t){this.resize(e,t)},r.prototype.onUpdate=function(){this.render()},r.prototype.resize=function(e,t){this.scene2D=this.scene2D||new THREE.Scene,this.camera2D=this.camera2D||new THREE.OrthographicCamera(-e/2,e/2,t/2,-t/2,.1,100),this.camera2D.left=-e/2,this.camera2D.right=e/2,this.camera2D.top=t/2,this.camera2D.bottom=-t/2,this.camera2D.updateProjectionMatrix(),this.loadingProgress&&this.loadingProgress.resize(e,t)},r.prototype.render=function(e){e=e||this.app.renderer,En&&(En.parent!=this.scene2D&&this.scene2D.add(En),En.visible=!0,En.traverse(function(e){e.visible=!0}),this.scene2D.visible=!0),e.clearDepth();var t=this.app.renderer.autoClear;e.autoClear=!1,e.render(this.scene2D,this.camera2D),e.autoClear=t},r.prototype.getRenderPosition=function(e,t,r){var i=(r=r||[this.app.domElement.offsetWidth,this.app.domElement.offsetHeight])[0]/2,n=r[1]/2,o=[e[0]*i,e[1]*n],a=[t[0]/2,t[1]/2];return o[0]=THING.Math.clamp(o[0],-i+a[0],i-a[0]),o[1]=THING.Math.clamp(o[1],-n+a[1],n-a[1]),[o[0],-o[1]]},l(r,[{key:"loadingProgressBar",get:function(){return this.loadingProgress=this.loadingProgress||this.app.create({type:"ProgressBar",height:6,scene:this.scene2D,onTop:!1,parent:null}),this.loadingProgress}}]),r}(),An=function(n){function o(e,t,r){y(this,o);var i=p(this,n.call(this,e));return i.node=t,i.projectionType=R.Perspective,i.controller=r,i.followingObject=null,i.lookingObject=null,i.eyeTween=null,i.targetTween=null,i.upTween=null,i._flying=!1,i._near=i.node.near,i._far=i.node.far,i._frustum=new THREE.Frustum,i._projScreenMatrix=new THREE.Matrix4,i}return u(o,n),o.prototype._lookAt=function(e){var t=Z.parseVector3(e);t&&(this.controller.object.lookAt(t),this.controller.target.set(t.x,t.y,t.z))},o.prototype.getBestLocation=function(e,t){var r=t.box,i=new THREE.Vector3;r.getSize(i);var n=new THREE.Vector3;r.getCenter(n),i.x&&i.y&&i.z||(i.x=5,i.y=5,i.z=5);var o=n.clone(),a=new THREE.Vector3(0,1,0);if(e==R.Perspective)o.x=n.x+i.x,o.y=n.y+i.y,o.z=n.z+i.z;else{var s=i.length();o.y=n.y+s,a=new THREE.Vector3(0,0,-1)}return{lookAt:n,pos:o,up:a,scale:i}},o.prototype.updateFollowingObject=function(){var e=this,t=this.followingObject,r=t.params,i=r.flyStop,n=r.flying,o=r.flyComplete,a=t.object;if(a instanceof Ee){if(!a.visible||a.destroyed)return i&&i(),void this.stopFollowingObject();a=t.centerPos||a.boundingBox.center}a=Z.parseVector3(a);var s=t.dir.clone();s.add(a);var l=Z.parseVector3(this.target),c=Z.parseVector3(this.position),u=t.speed;l=l.lerp(a,1/u),c=c.lerp(s,1/u),this.node.position.copy(c),this._lookAt(l,function(){return e.static}),n&&n();var h=l.distanceTo(a),p=c.distanceTo(s);h<1e-4&&p<1e-4&&(o&&o(),r.once&&this.stopFollowingObject()),this.app.needUpdate=!0},o.prototype.updateLookingObject=function(){var e=this.lookingObject;e instanceof Ee&&(e=e.boundingBox.center);var t=Z.parseVector3(e),r=Z.parseVector3(this.target).lerp(t,.1);this.target=r.toArray()},o.prototype.worldToScreen=function(e){if(!e)return null;e instanceof Ee&&(e=e.boundingBox.center,console.warn("[Camera] please use '.worldToScreen(object.boundingBox.center)' to get screen position"));var t=Z.parseVector3(e);t.project(this.node);var r=this.app.renderer.context.canvas.width/2,i=this.app.renderer.context.canvas.height/2,n=Math.round(t.x*r+r),o=Math.round(-t.y*i+i),a=this.app.pixelRatio;return[n/=a,o/=a,t.z]},o.prototype.screenToWorld=function(e,t,r){if(Z.isArray(e)&&void 0===t&&void 0===r){var i=e;e=i[0],t=i[1],r=i[2]}if(void 0===r){var n=this.app.picker.processGroundPicking(e,t);return n?n.point.toArray():null}var o=this.app.pixelRatio;t*=o;var a=(e*=o)/this.app.renderer.context.canvas.width*2-1,s=-t/this.app.renderer.context.canvas.height*2+1;return new THREE.Vector3(a,s,-1).unproject(this.node).toArray()},o.prototype.getRaycaster=function(e,t){var r=new THREE.Raycaster;if(void 0===e&&void 0===t){var i=new THREE.Vector3;i.subVectors(this.controller.target,this.node.position),i.normalize(),r.set(this.node.position,i)}else{var n=this.app.calcRect(),o=new THREE.Vector2;o.x=e/n.width*2-1,o.y=-t/n.height*2+1,r.setFromCamera(o,this.node)}return r},o.prototype.lerpToPerspective=function(e,t){this.projectionType=R.Perspective,this.node.lerpToPerspective(e,t)},o.prototype.lerpToOrthographic=function(e,t,r,i){this.projectionType=R.Orthographic,this.node.lerpToOrthographic(e,t,r,i)},o.prototype.setSize=function(e,t){this.node.setSize(e,t)},o.prototype.stopFlying=function(){this.flying&&(this._flying=!1,this.stopRotating(),this.stopFollowingObject(),this.eyeTween&&this.eyeTween.stop(),this.targetTween&&this.targetTween.stop(),this.upTween&&this.upTween.stop())},o.prototype.getFlyPos=function(e){var t=Z.parseNumber3(e.position),r=null,i=[0,0,0],n=e.target||e.object;if(n){var o=e.offset,a=e.worldOffset,s=e.xAngle,l=e.yAngle,c=e.distance||e.radius,u=e.radiusFactor;if(n.isBaseObject||n.isGroup){r=n;var h=e.center;if(i=h?(h=Z.parseVector3(h)).toArray():r.labelPosition||r.boundingBox.center||i,Z.isNull(s)&&Z.isNull(l))if(o)E=r.worldToSelf(i),o=THING.Math.addVector(E,o),o=r.selfToWorld(o);else if(a)o=THING.Math.addVector(i,a);else{var p=!1;c&&(p=!0);var d=[],f=r.boundingBox;d.push(f.getOffsetWorldPosition({yAngle:45,xAngle:45,distance:c,radiusFactor:u,ignoreScale:p})),d.push(f.getOffsetWorldPosition({yAngle:45,xAngle:135,distance:c,radiusFactor:u,ignoreScale:p})),d.push(f.getOffsetWorldPosition({yAngle:45,xAngle:225,distance:c,radiusFactor:u,ignoreScale:p})),d.push(f.getOffsetWorldPosition({yAngle:45,xAngle:315,distance:c,radiusFactor:u,ignoreScale:p}));for(var m=0,g=Z.parseVector3(this.position),v=g.distanceTo(Z.parseVector3(d[m])),y=m+1;y<d.length;y++){var b=Z.parseVector3(d[y]),x=g.distanceTo(b);x<v&&(v=x,m=y)}o=d[m]}else{o=o||r.getOffsetPosition({yAngle:s,xAngle:l,distance:c,radiusFactor:u});var E=r.worldToSelf(i);o=THING.Math.addVector(E,o),o=r.selfToWorld(o)}t=t||[0,0,0],this.projectionType==R.Perspective?(t[0]+=o[0],t[1]+=o[1],t[2]+=o[2]):t[1]+=o[1]}else if(i=n,!t)if(o=o||a,Z.isArray(o)||Z.isNumber(o))t=THING.Math.addVector(n,o);else{c=c||10;var _=Z.parseVector3(n);t=l||s?(l=Z.parseValue(l,0),s=Z.parseValue(s,0),_.getDirectionFromAngles(s,l,c).toArray()):_.getDirectionFromPosition(this.node.position,c).toArray()}}var w,T=e.up;if(T)T=THING.Math.normalizeVector(T);else{var M=new THREE.Vector3(0,1,0),S=(w=r||this.app.level.current)?w.isCampus?w:w.parents.query(".Campus")[0]:null;S&&(M.applyQuaternion(S.node.quaternion),M.normalize(),T=M.toArray())}return{obj:r,eyePos:t,lookAtPos:i,up:T}},o.prototype.flyTo=function(e){(e=e||{})instanceof Ee&&(e={object:e});var t=Z.parseValue(e.time,2e3),r=Z.parseValue(e.lerp||e.lerpType,TWEEN.Easing.Linear.None),i=Z.parseValue(e.upLerp,r),n=Z.parseValue(e.positionLerp,r),o=Z.parseValue(e.targetLerp,r),a=e.flyStart,s=e.flyStop,l=e.flying,c=e.flyComplete;if(Z.parseValue(e.keepDirection,!1)){var u=e.cameraTarget||e.target;if(u)return e.object=u,e.radius=e.radius||2*u.boundingBox.radius,e.speed=t/100,e.enableRotate=!0,e.enableZoom=!0,e.once=!0,void this.followObject(e)}var h=this.getFlyPos(e),p=h.eyePos,d=h.lookAtPos;if(this.stopFlying(),p&&d){this._flying=!0;var f=this,m={x:this.node.position.x,y:this.node.position.y,z:this.node.position.z},g={x:p[0],y:p[1],z:p[2]};this.eyeTween=new TWEEN.Tween(m).to(g,t).easing(n).onUpdate(function(){f.position=[this._object.x,this._object.y,this._object.z]}).start();var v={x:this.controller.target.x,y:this.controller.target.y,z:this.controller.target.z},y={x:d[0],y:d[1],z:d[2]};if(this.targetTween=new TWEEN.Tween(v).to(y,t).easing(o).onStart(function(){a&&a()}).onUpdate(function(){f.target=[this._object.x,this._object.y,this._object.z],l&&l()}).onStop(function(){s&&s()}).onComplete(function(){f._flying=!1,c&&c()}).start(),h.up){var b={x:this.node.up.x,y:this.node.up.y,z:this.node.up.z},x={x:h.up[0],y:h.up[1],z:h.up[2]};this.upTween=new TWEEN.Tween(b).to(x,t).easing(i).onUpdate(function(){f.up=[this._object.x,this._object.y,this._object.z]}).start()}}else c&&c()},o.prototype.lookAt=function(e){return e instanceof Array||e instanceof Ee?(this.lookingObject=e,!0):(this.lookingObject=null,!1)},o.prototype.followObject=function(e){(e=e||{})instanceof Ee&&(e={object:e});var t=e.object;if(t){this.stopFollowingObject();var r,i=e.alpha,n=e.beta,o=e.distance||e.radius||this.distance,a=Z.parseVector3(e.offset||[0,0,0]),s=Z.parseVector3(e.worldOffset),l=e.speed||10,c=e.centerPos;if(s)r=s;else{if(r=new THREE.Vector3,i||n)i=i||0,n=n||0,r=Z.parseVector3(THING.Math.directionFromAlphaBeta(i,n));else{var u=Z.parseVector3(this.target),h=Z.parseVector3(this.position);r.subVectors(h,u)}r.normalize(),r.multiplyScalar(o),r.add(a)}var p=e.flyStart;p&&p(),this.followingObject={object:t,dir:r,speed:l,params:e,centerPos:c}}},o.prototype.stopFollowingObject=function(){if(this.followingObject){var e=this.followingObject.params;this.followingObject=null;var t=e.flyStop;t&&t()}},o.prototype.movePath=function(e){var t=this;this.stopFlying();var r=e.complete;e.complete=function(){t._flying=!1;var e=t.node.getForwardPosition(t.distance);t.target=e.toArray(),r&&r()},this._flying=!0,n.prototype.movePath.call(this,e)},o.prototype.rotateAround=function(t){var r=this,e=(t=t||{}).target||t.object;t.target=e||this.target,this.stopFlying(),this.lookAt(t.target);var i=t.complete;t.complete=function(e){t.stop(),i&&i()},t.stop=function(e){r.lookAt(null),r.app.camera.curOrbit.enabled=!0,r.app.camera.resume({rotate:!0,pan:!0,zoom:!0})},t.update=function(e){r.app.camera.curOrbit.update()},this.app.camera.curOrbit.enabled=!1,this.app.camera.disable({rotate:!0,pan:!0,zoom:!0}),n.prototype.rotateAround.call(this,t)},o.prototype.isInView=function(e){return e instanceof Ee&&this.node.isInView(e.box)},o.prototype.update=function(){this._projScreenMatrix.multiplyMatrices(this.node.projectionMatrix,this.node.matrixWorldInverse),this._frustum.setFromMatrix(this._projScreenMatrix),this.followingObject?this.updateFollowingObject():this.lookingObject&&this.updateLookingObject()},l(o,[{key:"flying",get:function(){return!!this._flying||!!this.followingObject}},{key:"isPerspectiveCamera",get:function(){return this.node.isPerspectiveCamera}},{key:"fov",set:function(e){this.node.setFov(e)},get:function(){return this.node.fov}},{key:"near",set:function(e){this._near=e,this.node.setNear(e)},get:function(){return this._near}},{key:"far",set:function(e){this._far=e,this.node.setFar(e)},get:function(){return this._far}},{key:"up",set:function(e){this.node.up.fromArray(e)},get:function(){return this.node.up.toArray()}},{key:"position",set:function(e){this.node.position.fromArray(e)},get:function(){return this.node.position.toArray()}},{key:"target",set:function(e){var t=this;this._lookAt(e,function(){return t.static})},get:function(){return this.controller.target.toArray()}},{key:"distance",set:function(e){var t=Z.parseVector3(this.position),r=Z.parseVector3(this.target),i=new THREE.Vector3;i.subVectors(t,r),i.normalize(),i.multiplyScalar(e),r.add(i),this.position=r.toArray()},get:function(){var e=Z.parseVector3(this.position),t=Z.parseVector3(this.target);return e.distanceTo(t)}},{key:"direction",get:function(){var e=Z.parseVector3(this.position),t=Z.parseVector3(this.target),r=new THREE.Vector3;return r.subVectors(t,e),r.normalize(),r.toArray()}},{key:"rightDirection",get:function(){var e=THING.Utils.parseVector3(this.direction),t=THING.Utils.parseVector3(this.up),r=new THREE.Vector3;return r.crossVectors(e,t),r.normalize(),r.toArray()}}]),o}(Ee),Cn=function(){function r(e){var t=this;y(this,r),this.app=e,this.picker=e.picker,this.orbit=new THREE.OrbitControls(this.app.renderCamera,this.app.mainDomElement),this.curOrbit=this.orbit,this.initOrbit(this.orbit),this.cameraObject=new An(this.app,this.app.renderCamera,this.orbit),this.toggling=!1,this.toggleInitPos=null,this.toggleInitLookAt=null,this.toggleSkyBox=null,this.toggleKeyPanSpeed=this.curOrbit.keyPanSpeed,this.toggleMousePanSpeed=this.curOrbit.panSpeed,this.zoomTween=null,this._autoAdjustNear=!0,this._autoAdjustTarget=!0,this._autoFixTargetOnWheel=!0,this._pushCount=0,this._targetObject=null,this._inputEnableFlag=new wn(function(e){t.curOrbit.enabled=e}),this._panEnableFlag=new wn(function(e){t.curOrbit.enablePan=e}),this._rotateEnableFlag=new wn(function(e){t.curOrbit.enableRotate=e}),this._zoomEnableFlag=new wn(function(e){t.curOrbit.enableZoom=e}),this.cameraObject.isPerspectiveCamera&&(this.cameraFov=this.cameraObject.fov,this.cameraNear=this.cameraObject.near,this.cameraFar=this.cameraObject.far)}return r.prototype.initOrbit=function(e){e.minDistance=1e-4,e.minZoom=.15,e.maxZoom=8,e.autoRotate=!1,e.enableDamping=!0,e.minPolarAngle=0,e.maxPolarAngle=Math.PI,e.keyPanSpeed=.1,e.panSpeed=.1,e.rotateSpeed=.07,e.dampingFactor=.12,e.screenSpacePanning=!0,e.enabled=!0;var t=this;e.addEventListener("mousedownpanevent",function(e){t.onMouseDownPanEvent(e)}),e.addEventListener("mousemoveevent",function(e){t.onMouseMoveEvent(e)}),e.addEventListener("start",function(e){t.onStart(e)}),e.addEventListener("end",function(e){t.onEnd(e)}),e.addEventListener("wheel",function(e){t.onWheel(e)}),e.addEventListener("change",function(e){t.onChange(e)})},r.prototype._isCameraController=function(){return!0},r.prototype._zoom=function(e,t,r){this.zoomTween&&this.zoomTween.stop();var i=this;this.zoomTween=new TWEEN.Tween({zoom:e}).to({zoom:t},r).easing(TWEEN.Easing.Linear.None).onUpdate(function(){i._rotateEnableFlag.enable(!1,!0),i.curOrbit.object.zoom=this._object.zoom,i.curOrbit.object.updateProjectionMatrix()}).onComplete(function(){i._rotateEnableFlag.resume()}).start()},r.prototype._change=function(e){this.app.trigger(e,{position:this.position,target:this.target})},r.prototype._autoFixTarget=function(){var e=this.curOrbit,t=e.target.distanceTo(e.object.position);if(5<t)10<t&&(this._pushCount=0);else{var r=new THREE.Vector3(0,0,0);r.subVectors(e.target,e.object.position).normalize();var i=r.multiplyScalar(10),n=new THREE.Vector3(0,0,0);n.addVectors(e.object.position,i),e.target=n,this._pushCount++,2<this._pushCount&&(this._adjustTarget(),this._pushCount=0)}},r.prototype._adjustTarget=function(){var e=this.app.picker.floorPickingGround.intersect();e&&(this.target=e.point.toArray())},r.prototype.onMouseDownPanEvent=function(e){this._autoAdjustTarget&&this.degreeToWorldYAxis<60&&this._adjustTarget()},r.prototype.onMouseMoveEvent=function(e){this._change("cameraChangeMouseMove")},r.prototype.onStart=function(e){this._change("cameraChangeStart")},r.prototype.onEnd=function(e){this._change("cameraChangeEnd")},r.prototype.onWheel=function(e){this._autoFixTargetOnWheel&&this._autoFixTarget(),this.app.trigger("camerazoom",{delta:e.delta})},r.prototype.onChange=function(e){this.app.trigger("cameracontrollerchanged"),this._change("cameraChange")},r.prototype.zoomIn=function(e){var t=e.zoom||1,r=e.time||1e3,i=t,n=this.curOrbit.object.zoom;this._zoom(i,n,r)},r.prototype.zoomOut=function(e){var t=e.zoom||1,r=e.time||1e3,i=this.curOrbit.object.zoom,n=t;this._zoom(i,n,r)},r.prototype.worldToScreen=function(e){return this.cameraObject.worldToScreen(e)},r.prototype.screenToWorld=function(e,t,r){return this.cameraObject.screenToWorld(e,t,r)},r.prototype.setProjectionType=function(e,t,r,i){var n=4<arguments.length&&void 0!==arguments[4]?arguments[4]:1e3,o=this;switch(e){case R.Perspective:this.cameraObject.lerpToPerspective(n,function(){o.projectionType==R.Perspective&&(o.toggleSkyBox&&(o.app.background=o.toggleSkyBox.background,o.app.skyBox=o.toggleSkyBox.skyBox,o.app.backgroundAdditiveColor=o.toggleSkyBox.backgroundAdditiveColor,o.app.backgroundColorScaleFactor=o.toggleSkyBox.backgroundColorScaleFactor),o.toggleSkyBox=null)}),this.curOrbit.keyPanSpeed=this.toggleKeyPanSpeed,this.curOrbit.panSpeed=this.toggleMousePanSpeed;break;case R.Orthographic:this.toggleSkyBox?(this.toggleSkyBox.backgroundAdditiveColor=this.app.backgroundAdditiveColor,this.toggleSkyBox.backgroundColorScaleFactor=this.app.backgroundColorScaleFactor):this.toggleSkyBox={skyBox:this.app.skyBox,background:this.app.background,backgroundAdditiveColor:this.app.backgroundAdditiveColor,backgroundColorScaleFactor:this.app.backgroundColorScaleFactor},this.app.skyBox&&(this.app.background=null),this.app.skyBox=null,this.toggleKeyPanSpeed=this.curOrbit.keyPanSpeed,this.toggleMousePanSpeed=this.curOrbit.panSpeed,this.curOrbit.keyPanSpeed=t/6400,this.curOrbit.panSpeed=t/6400;var a=Z.parseVector3(r),s=Z.parseVector3(i);this.cameraObject.lerpToOrthographic(a,s,n);break;default:return!1}},r.prototype.setType=function(e,t,r,i){if(this.projectionType==t)return!1;var n=this.cameraObject.getBestLocation(t,e),o=n.pos.distanceTo(n.lookAt),a=this.distanceLimited[1];if(a<=o){var s=n.pos.subVectors(n.pos.clone(),n.lookAt);s.normalize();var l=n.pos.addVectors(n.lookAt,s.multiplyScalar(a));n.pos=l}switch(this.setProjectionType(t,n.scale.length(),n.pos,n.lookAt,r),t){case R.Perspective:n.pos=Z.parseVector3(this.toggleInitPos),n.lookAt=Z.parseVector3(this.toggleInitLookAt);break;case R.Orthographic:this.toggleInitPos=this.position,this.toggleInitLookAt=this.target;break;default:return!1}var c=this.app.rendererManager.getCurrentControl(),u=c.getConfig(),h=u.temporalSuperSampling.enable,p=u.postEffect.screenSpaceAmbientOcclusion.enable;c.mergeConfig({temporalSuperSampling:{enable:!1},postEffect:{screenSpaceAmbientOcclusion:{enable:!1}}}).update();var d=this;return this.flyTo({position:n.pos.toArray(),target:n.lookAt.toArray(),up:n.up.toArray(),time:r,_flyStart:function(){d.toggling=!0},complete:function(){d.toggling=!1,c.mergeConfig({temporalSuperSampling:{enable:h},postEffect:{screenSpaceAmbientOcclusion:{enable:p}}}).update(),i&&i()}}),!0},r.prototype.toggleNormalViewMode=function(e){return this.viewMode!=x.Normal&&(this.toggleObject({object:this.app.root,is3D:!0,complete:function(){e&&e()}}),!0)},r.prototype.toggleObject=function(e){var t=(e=e||{}).object||this.app.root,r=Z.parseValue(e.is3D,!1),i=e.complete,n=e.time||1e3,o=!1;return r?this.projectionType!=R.Perspective&&(this._rotateEnableFlag.resume(),o=this.setType(t,R.Perspective,n,i)):this.projectionType!=R.Orthographic&&(this._rotateEnableFlag.enable(!1,!0),o=this.setType(t,R.Orthographic,n,i)),o&&this.app.trigger("cameraViewChange",{view:this.projectionType}),o},r.prototype.resize=function(e,t){this.cameraObject.setSize(e,t)},r.prototype.getRaycaster=function(e,t){return this.cameraObject.getRaycaster(e,t)},r.prototype.fit=function(e){(e=e||{})instanceof Ee&&(e={object:e}),e.object=e.object||this.app.root,e.time=1,this.cameraObject.flyTo(e)},r.prototype.stopFlying=function(){this.cameraObject.stopFlying()},r.prototype.flyTo=function(r){var i=this,e=r._flyStart,t=r._flying,n=r._flyStop,o=r._flyComplete;r.flyStart=function(){i.picker._state.enable(!1,!0),i._change("cameraChangeStart"),e&&e()},r.flying=function(){Z.isFunction(i.curOrbit.setState)&&i.curOrbit.setState(),i._change("cameraChange"),t&&t()},r.flyStop=function(){i._inputEnableFlag.resume(),Z.isFunction(i.curOrbit.setState)&&i.curOrbit.setState(),i.picker._state.resume(),i._change("cameraChangeEnd"),n&&n()},r.flyComplete=function(){r.flyStop();var e=r.target;e instanceof Ee&&e.trigger("cameraFlyComplete"),i.app.events.dispatchEvent({type:"cameraFlyComplete"});var t=r.complete;t&&t(),o&&o()},this.cameraObject.flyTo(r)},r.prototype.lookAt=function(e){this.cameraObject.lookAt(e)?(this._rotateEnableFlag.enable(!1,!0),this._panEnableFlag.enable(!1,!0)):(this._rotateEnableFlag.resume(),this._panEnableFlag.resume())},r.prototype.stopRotateAround=function(){this.cameraObject.stopRotating()},r.prototype.rotateAround=function(e){var t=this;(e=e||{}).rotateStart=function(){t.picker._state.enable(!1,!0)},e.rotateComplete=function(){t.picker._state.resume()},this.cameraObject.rotateAround(e)},r.prototype.followObject=function(e){e=e||{},this.cameraObject.followObject(e);var t=Z.parseValue(e.enableRotate,!1),r=Z.parseValue(e.enableZoom,!1);t||this._rotateEnableFlag.enable(!1,!0),r||this._zoomEnableFlag.enable(!1,!0)},r.prototype.stopFollowingObject=function(){this.cameraObject.stopFollowingObject(),this._rotateEnableFlag.resume(),this._zoomEnableFlag.resume()},r.prototype.canUpdateOrbit=function(){return!(this.cameraObject.flying||!this.curOrbit.enabled&&!this.curOrbit.autoRotate)},r.prototype.update=function(){this.cameraObject.update(),this.canUpdateOrbit()&&this.curOrbit.update()},r.prototype.onUpdate=function(e){this.update(e)},r.prototype.zoom=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:500;e=Math.min(this.distance-1,e);var r=Z.parseVector3(this.direction);r.multiplyScalar(e);var i=Z.parseVector3(this.position);i.add(r),this.flyTo({position:i.toArray(),target:this.target,time:t})},r.prototype.rotateX=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:500;this.rotateAround({xRotateAngle:e,time:t})},r.prototype.rotateY=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:500;this.rotateAround({yRotateAngle:e,time:t})},r.prototype.move=function(e,t){this.curOrbit.move(-e,t)},r.prototype.loadViewPoint=function(e){this.app.viewPointManger.loadJSON(e)},r.prototype.playViewPoint=function(e){this.app.viewPointManger.play(e)},r.prototype.pauseViewPoint=function(e){this.app.viewPointManger.pause(e)},r.prototype.isInView=function(e){return!!e&&this.cameraObject.isInView(e)},r.prototype.isCovered=function(e){return!!e&&(console.warn("not impl yet"),!0)},r.prototype.disable=function(e){(e=e||{}).rotate=Z.parseValue(e.rotate,!0),e.pan=Z.parseValue(e.pan,!0),e.zoom=Z.parseValue(e.zoom,!0),e.rotate&&this._rotateEnableFlag.enable(!1,!0),e.pan&&this._panEnableFlag.enable(!1,!0),e.zoom&&this._zoomEnableFlag.enable(!1,!0)},r.prototype.resume=function(e){(e=e||{}).rotate=Z.parseValue(e.rotate,!0),e.pan=Z.parseValue(e.pan,!0),e.zoom=Z.parseValue(e.zoom,!0),e.rotate&&this._rotateEnableFlag.resume(),e.pan&&this._panEnableFlag.resume(),e.zoom&&this._zoomEnableFlag.resume()},r.prototype.showTargetNode=function(){0<arguments.length&&void 0!==arguments[0]&&!arguments[0]?this._targetObject&&(this._targetObject.destroy(),this._targetObject=null):this._targetObject||(this._targetObject=this.app.create({type:"Box",position:this.target,style:{color:"#FF0000"}}),this._targetObject.pickable=!1,this._targetObject.style.outlineColor=65535)},r.prototype.log=function(){console.log("["+this.position.toString()+"], ["+this.target.toString()+"]")},r.prototype.dolly=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:500;console.warn("[CameraController] Please use '.zoom()' to replace '.dolly()'"),this.zoom(e,t)},r.prototype.theta=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:500;console.warn("[CameraController] Please use '.rotateX()' to replace '.theta()'"),this.rotateX(e,t)},r.prototype.phi=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:500;console.warn("[CameraController] Please use '.rotateY()' to replace '.theta()'"),this.rotateY(e,t)},l(r,[{key:"frustum",get:function(){return this.cameraObject._frustum}},{key:"camera",get:function(){return this.app.renderCamera}},{key:"viewMode",set:function(e){this.toggleObject({object:this.app.root,is3D:e==x.Normal})},get:function(){return this.projectionType==R.Perspective?x.Normal:x.TopView}},{key:"projectionType",set:function(e){this.setProjectionType(e,this.distance,this.position,this.target)},get:function(){return this.cameraObject.projectionType}},{key:"enableDamping",set:function(e){this.curOrbit.enableDamping=e},get:function(){return this.curOrbit.enableDamping}},{key:"dampingFactor",set:function(e){this.curOrbit.dampingFactor=e},get:function(){return this.curOrbit.dampingFactor}},{key:"fov",set:function(e){this.cameraObject.fov=e},get:function(){return this.cameraObject.fov}},{key:"near",set:function(e){this.cameraObject.near=e},get:function(){return this.cameraObject.near}},{key:"far",set:function(e){this.cameraObject.far=e},get:function(){return this.cameraObject.far}},{key:"zoomLimited",set:function(e){this.curOrbit.minZoom=e[0],this.curOrbit.maxZoom=e[1]},get:function(){return[this.curOrbit.minZoom,this.curOrbit.maxZoom]}},{key:"distanceLimited",set:function(e){this.curOrbit.minDistance=e[0],this.curOrbit.maxDistance=e[1]},get:function(){return[this.curOrbit.minDistance,this.curOrbit.maxDistance]}},{key:"yAngleLimited",set:function(e){this.curOrbit.minPolarAngle=THING.Math.degToRad(e[0]),this.curOrbit.maxPolarAngle=THING.Math.degToRad(e[1])},get:function(){return[THING.Math.radToDeg(this.curOrbit.minPolarAngle),THING.Math.radToDeg(this.curOrbit.maxPolarAngle)]}},{key:"xAngleLimited",set:function(e){this.curOrbit.minAzimuthAngle=THING.Math.degToRad(e[0]),this.curOrbit.maxAzimuthAngle=THING.Math.degToRad(e[1])},get:function(){return[THING.Math.radToDeg(this.curOrbit.minAzimuthAngle),THING.Math.radToDeg(this.curOrbit.maxAzimuthAngle)]}},{key:"keyPanSpeed",set:function(e){this.curOrbit.keyPanSpeed=e},get:function(){return this.curOrbit.keyPanSpeed}},{key:"mousePanSpeed",set:function(e){this.curOrbit.panSpeed=e},get:function(){return this.curOrbit.panSpeed}},{key:"distance",set:function(e){this.cameraObject.distance=e},get:function(){return this.cameraObject.distance}},{key:"direction",get:function(){return this.cameraObject.direction}},{key:"rightDirection",get:function(){return this.cameraObject.rightDirection}},{key:"up",set:function(e){this.cameraObject.up=e},get:function(){return this.cameraObject.up}},{key:"position",set:function(e){e&&(this.cameraObject.position=e)},get:function(){return this.cameraObject.position}},{key:"target",set:function(e){e&&(this.cameraObject.target=e)},get:function(){return this.cameraObject.target}},{key:"inputEnabled",set:function(e){this._inputEnableFlag.enable(e)},get:function(){return this._inputEnableFlag.enable()}},{key:"enableRotate",set:function(e){this._rotateEnableFlag.enable(e)},get:function(){return this._rotateEnableFlag.enable()}},{key:"enableZoom",set:function(e){this._zoomEnableFlag.enable(e)},get:function(){return this._zoomEnableFlag.enable()}},{key:"enablePan",set:function(e){this._panEnableFlag.enable(e)},get:function(){return this._panEnableFlag.enable()}},{key:"flying",get:function(){return this.cameraObject.flying}},{key:"mode",set:function(e){this.mode!=e&&(this.curOrbit.enabled=!1,this.autoAdjustNear="earth"==e?(this.curOrbit=new THREE.EarthOrbitControls(this.app.renderCamera,this.app.mainDomElement),this.curOrbit.app=this.app,this.initOrbit(this.curOrbit),!1):(this.curOrbit.dispose(),this.curOrbit=this.orbit,this.curOrbit.enabled=!0),this.cameraObject.controller=this.curOrbit)},get:function(){return this.curOrbit instanceof THREE.EarthOrbitControls?"earth":"normal"}},{key:"degreeToWorldYAxis",get:function(){var e=Z.parseVector3(this.direction),t=new THREE.Vector3(0,-1,0),r=e.dot(t);return THING.Math.radToDeg(Math.acos(r))}},{key:"autoAdjustNear",set:function(e){(this._autoAdjustNear=e)||(this.cameraObject.near=this.cameraObject._near)},get:function(){return this._autoAdjustNear}},{key:"autoAdjustTarget",set:function(e){this._autoAdjustTarget=e},get:function(){return this._autoAdjustTarget}},{key:"autoFixTargetOnWheel",set:function(e){this._autoFixTargetOnWheel=e},get:function(){return this._autoFixTargetOnWheel}},{key:"mouseButtons",set:function(e){var t=function(e){return{left:THREE.MOUSE.LEFT,middle:THREE.MOUSE.MIDDLE,right:THREE.MOUSE.RIGHT}[e]};e=e||{};var r=this.orbit.mouseButtons,i=t(e.left,r.LEFT),n=t(e.middle,r.MIDDLE),o=t(e.right,r.RIGHT);this.orbit.mouseButtons={LEFT:i,MIDDLE:n,RIGHT:o}},get:function(){var e=function(e){return["left","middle","right"][e]},t=this.orbit.mouseButtons;return{left:e(t.LEFT),middle:e(t.MIDDLE),right:e(t.RIGHT)}}},{key:"toggle3D",set:function(e){console.warn("[CameraController] Please use '.viewMode=THING.CameraView.Normal/TopView' to replace '.toggle3D'"),this.viewMode=e?x.Normal:x.TopView},get:function(){return console.warn("[CameraController] Please use '.viewMode == THING.CameraView.Normal' to replace '.toggle3D'"),this.viewMode==x.Normal}},{key:"enabled",set:function(e){console.warn("[CameraController] Please use '.inputEnabled' to replace '.enabled'"),this.inputEnabled=e},get:function(){return console.warn("[CameraController] Please use '.inputEnabled' to replace '.enabled'"),this.inputEnabled}},{key:"minZoom",set:function(e){console.warn("[CameraController] Please use '.zoomLimited=[min, max]' to replace '.minZoom'"),this.zoomLimited=[e,this.zoomLimited[1]]},get:function(){return console.warn("[CameraController] Please use '.zoomLimited[0]' to replace '.minZoom'"),this.zoomLimited[0]}},{key:"maxZoom",set:function(e){console.warn("[CameraController] Please use '.zoomLimited=[min, max]' to replace '.maxZoom'"),this.zoomLimited=[this.zoomLimited[0],e]},get:function(){return console.warn("[CameraController] Please use '.zoomLimited[0]' to replace '.maxZoom'"),this.zoomLimited[1]}},{key:"minDistance",set:function(e){console.warn("[CameraController] Please use '.distanceLimited=[min, max]' to replace '.minDistance'"),this.distanceLimited=[e,this.distanceLimited[1]]},get:function(){return console.warn("[CameraController] Please use '.distanceLimited[0]' to replace '.minDistance'"),this.distanceLimited[0]}},{key:"maxDistance",set:function(e){console.warn("[CameraController] Please use '.distanceLimited=[min, max]' to replace '.maxDistance'"),this.distanceLimited=[this.distanceLimited[0],e]},get:function(){return console.warn("[CameraController] Please use '.distanceLimited[0]' to replace '.maxDistance'"),this.distanceLimited[1]}},{key:"minPolarAngle",set:function(e){console.warn("[CameraController] Please use '.verticalAngleLimited=[min, max]' to replace '.minPolarAngle'"),this.verticalAngleLimited=[e,this.verticalAngleLimited[1]]},get:function(){return console.warn("[CameraController] Please use '.verticalAngleLimited[0]' to replace '.minPolarAngle'"),this.verticalAngleLimited[0]}},{key:"maxPolarAngle",set:function(e){console.warn("[CameraController] Please use '.verticalAngleLimited=[min, max]' to replace '.maxPolarAngle'"),this.verticalAngleLimited=[this.verticalAngleLimited[0],e]},get:function(){return console.warn("[CameraController] Please use '.verticalAngleLimited[0]' to replace '.maxPolarAngle'"),this.verticalAngleLimited[1]}},{key:"minAzimuthAngle",set:function(e){console.warn("[CameraController] Please use '.horizontalAngleLimited=[min, max]' to replace '.minAzimuthAngle'"),this.horizontalAngleLimited=[e,this.horizontalAngleLimited[1]]},get:function(){return console.warn("[CameraController] Please use '.horizontalAngleLimited[0]' to replace '.minAzimuthAngle'"),this.horizontalAngleLimited[0]}},{key:"maxAzimuthAngle",set:function(e){console.warn("[CameraController] Please use '.horizontalAngleLimited=[min, max]' to replace '.maxAzimuthAngle'"),this.horizontalAngleLimited=[this.horizontalAngleLimited[0],e]},get:function(){return console.warn("[CameraController] Please use '.horizontalAngleLimited[0]' to replace '.maxAzimuthAngle'"),this.horizontalAngleLimited[1]}},{key:"verticalAngleLimited",set:function(e){console.warn("[CameraController] Please use '.yAngleLimited' to replace '.verticalAngleLimited'"),this.yAngleLimited=e},get:function(){return console.warn("[CameraController] Please use '.yAngleLimited' to replace '.verticalAngleLimited'"),this.yAngleLimited}},{key:"horizontalAngleLimited",set:function(e){console.warn("[CameraController] Please use '.xAngleLimited' to replace '.verticalAngleLimited'"),this.xAngleLimited=e},get:function(){return console.warn("[CameraController] Please use '.xAngleLimited' to replace '.verticalAngleLimited'"),this.xAngleLimited}},{key:"rotating",get:function(){return console.warn("[CameraController] Please use '.flying' to replace '.rotating'"),this.flying}},{key:"panSpeed",set:function(e){console.warn("[CameraController] Please use '.keyPanSpeed' to replace '.panSpeed'"),this.keyPanSpeed=e},get:function(){return console.warn("[CameraController] Please use '.keyPanSpeed' to replace '.panSpeed'"),this.keyPanSpeed}}]),r}(),Ln=function(){function t(e){y(this,t),this.app=e,this._currentParentObject=null,this._previous=null,this._current=null,this._root=null,this._options={outlineColor:16744448,autoChangeBackground:!0,autoBakeFloor:!0}}return t.prototype.init=function(){this._root=this.app.root},t.prototype.buildState=function(e){var t=e.type;"Campus"==t&&(t="Outdoors");var r={};r.name=t+"Level";var i=[];e instanceof It?(i.push("floor"),i.push("_floor")):e instanceof cr&&(i.push("building"),i.push("_building"));for(var n=0;n<i.length;n++)r[i[n]]=e;return r},t.prototype.buildAfterEnterState=function(e){var t=e.type;"Campus"==t&&(t="Outdoors");var r=this.previous?this.previous.type:"";"Campus"==r&&(r="Outdoors");var i={prevState:{name:r+"Level"},state:this.buildState(e),stateName:t+"Level"};return this.previous&&(this.previous instanceof cr?(i.prevState.building=this.previous,i.prevState._building=this.previous):this.previous instanceof It&&(i.prevState.floor=this.previous,i.prevState._floor=this.previous)),i},t.prototype.buildBeforeEnterState=function(e){var t=e.type;"Campus"==t&&(t="Outdoors");var r=this.current?this.current.type:"";"Campus"==r&&(r="Outdoors");var i={prevState:{name:r+"Level"},curState:this.buildState(e),stateName:t+"Level"};return this.previous&&(this.previous instanceof cr?(i.prevState.building=this.previous,i.prevState._building=this.previous):this.previous instanceof It&&(i.prevState.floor=this.previous,i.prevState._floor=this.previous)),i},t.prototype.getEventType=function(e,t){var r=t.type;return"Campus"==r&&(r="Outdoors"),e+r+"Level"},t.prototype.buildEventArguments=function(e){var t=e.type;"Campus"==t&&(t="Outdoors");var r={name:t+"Level"};return r.state=this.buildState(e),r},t.prototype.notifyBeforeEnterState=function(e){this.app.trigger("beforeEnterState",this.buildBeforeEnterState(e))},t.prototype.notifyAfterEnterState=function(e){this.app.trigger("afterEnterState",this.buildAfterEnterState(e))},t.prototype.nofityAfterLevelChange=function(e){var t=e.object;this.app.trigger(this.getEventType("enter",t),this.buildEventArguments(t)),this.app.trigger(this.getEventType("afterEnter",t),this.buildEventArguments(t))},t.prototype.notifyBeforeLevelChange=function(e){this.app.trigger(this.getEventType("beforeEnter",e),this.buildEventArguments(e))},t.prototype._getLevelType=function(){var e=this._current;return e?e.type:""},t.prototype._leaveLevel=function(e,t){if(this.app.trigger(O.BeforeLevelChange,{level:this._getLevelType(),current:this._current,previous:this._previous,next:e}),this._current){var r=Z.cloneObject(t);r.level=this._getLevelType(),r.object=e,r.current=e,r.previous=this._current,this._current.trigger(O.LevelChange,r),this._current.trigger(O.LeaveLevel,r),this.app.trigger(O.LeaveLevel,r)}e&&(this.notifyBeforeLevelChange(e),this.notifyBeforeEnterState(e))},t.prototype._enterLevel=function(e,r){var i=this;if(this._previous=this._current,this._current=e,this._currentParentObject=this._current,r.level=this._getLevelType(),r.current=this._current,r.object=this._current,r.previous=this._previous,this.app.trigger(O.LevelChange,r),e){var n=r.lastObject;if(n.internalUserData.level_complete||(n.internalUserData.level_complete=!0,n.one(O.EnterLevel,function(e){delete e.object.internalUserData.level_complete;var t=r.userComplete;t&&t(),n.one("cameraFlyComplete",{lastLevelChanged:!0},function(e){if(e.data.lastLevelChanged&&e.object==n){var t=r.flyComplete;t&&t()}e.object.trigger(O.LevelFlyEnd,{level:i._getLevelType(),object:e.object,current:e.object,previous:i.previous}),i.app.trigger(O.LevelFlyEnd,{level:i._getLevelType(),object:e.object,current:e.object,previous:i.previous})})},"___level_complete___")),e.trigger(O.LevelChange,r),this.notifyAfterEnterState(e),r.jumping){e.pauseEvent(O.EnterLevel,null,L.LevelFly),e.trigger(O.EnterLevel,r),e.resumeEvent(O.EnterLevel,null,L.LevelFly);var t=r.complete;t&&t()}else e.trigger(O.EnterLevel,r);r.object=e,this.app.trigger(O.EnterLevel,r),this.nofityAfterLevelChange(r)}},t.prototype._change=function(e,t){t=t||{};var r=this;this.app.camera.toggleNormalViewMode(function(){r._change(e,t)})||("Outdoors"==e.type&&(console.warn("Please use campus to change, not outdoors"),e=e.parents.query(".Campus")[0]),e.hasEvent(O.EnterLevel,null,!1)&&(this._leaveLevel(e,t),this._enterLevel(e,t)))},t.prototype.updateJumping=function(e,t){var r=this._current;r&&(r.isChildOf(e)||r.isBrotherOf(e))&&(t.jumping=!0,t.skipBackupCameraInfo=!0)},t.prototype.getParents=function(e,t){for(var r=[],i=e.parents,n=0;n<i.length;n++){var o=i[n];if(o==this.app.root)break;if(r.push(o),o==t)break}return r},t.prototype.getLevelPath=function(e,t){if(t.autoEnterSubLevel)for(;1===e.children.length;){var r=e.children[0];if(r instanceof Te)break;e=r}var i=[];if(this._current)if(this._current.isChildOf(e))2<=(i=this.getParents(this._current,e)).length&&(t.jumping=!0);else if(e.isChildOf(this._current))(i=(i=this.getParents(e,this._current)).reverse()).splice(0,1),i.push(e);else{(i=(i=this.getParents(e,null)).reverse()).push(e);for(var n=this._current.parents;2<i.length&&-1!==n.indexOf(i[0])&&-1!==n.indexOf(i[1]);)i.splice(0,1)}else i.push(e),i=(i=i.concat(e.parents.not(this.app.root).toArray())).reverse();return i},t.prototype.jumpLevelPath=function(e){var t=e.levelPath;if(t.splice(0,1),t.length){var r=t[0];if(1==t.length)delete e.jumping,this.app.off("cameraFlyComplete","sceneLevel_cameraFlyComplete");else{var i=t[t.length-1];this.updateJumping(i,e)}this._change(r,e)}},t.prototype.change=function(e,t){if(t=t||{},e){if(e instanceof Te&&(e=e.building),!t.skipCurrentLevel||e!=this._current){var r=this.getLevelPath(e,t);if(r.length){var i=r[0],n=1<r.length?r[r.length-1]:null;if(n&&this.updateJumping(n,t),this.app.off("cameraFlyComplete",null,"sceneLevel_cameraFlyComplete"),t.userComplete=t.complete,t.userFlyComplete=t.flyComplete,1<r.length){t.levelPath=r;var o=this;t.jumping?t.complete=function(){o.jumpLevelPath(t)}:this.app.on("cameraFlyComplete",function(e){o.jumpLevelPath(t)},"sceneLevel_cameraFlyComplete")}t.lastObject=n||e,this._change(i,t)}}}else console.error("Please provide the object to change")},t.prototype.quit=function(e){e=e||{},this._current&&(this._leaveLevel(null,e),this._enterLevel(null,e))},t.prototype.back=function(e){if(e=e||{},this._current){var t=this._current.parent;if(e.autoBackFromSubLevel)for(;t&&t.parent&&1===t.children.length;)t=t.parent;this.backTo(t)}},t.prototype.backTo=function(e){if(e&&e!=this._current&&e.isChildOf(this._root)){var t=this;this.app.camera.toggleNormalViewMode(function(){t.backTo(e)})||this.change(e)}},l(t,[{key:"current",get:function(){return this._current}},{key:"previous",get:function(){return this._previous}},{key:"root",set:function(e){this._root=e},get:function(){return this._root}},{key:"currentParentObject",set:function(e){this._currentParentObject=e},get:function(){return this._currentParentObject}},{key:"options",set:function(e){this._options=Z.mergeObject(this._options,e,!0)},get:function(){return this._options}}]),t}(),On=function(n){function o(e){y(this,o);var t=p(this,n.call(this,e));t._defaultCampus=new ar(e);var r=new or(e);t._envMapResources=r.load(e.options.env);var i=t;return t._staticEnableFlag=new wn(function(e){i.app.scene.autoUpdate!=!e&&(i.app.scene.autoUpdate=!e,e&&i.app.scene.updateMatrixWorld())},!1),t.init(),t}return u(o,n),o.prototype.init=function(){this.loaded=!0,this.campuses.destroyAll(),(this.app.level.currentParentObject=this).app.scene.add(this.node)},o.prototype.destroy=function(){n.prototype.destroy.call(this),this.app.resourceManager.disposeTextures(this._envMapResources)},o.prototype.cleanup=function(){this.app.scene.cleanup()},l(o,[{key:"envMapResources",get:function(){return this._envMapResources}},{key:"box",get:function(){if(this.boundingBoxDirty)this.updateBounds();else if(this.campuses.length){for(var e=new THREE.Box3,t=this.campuses,r=0;r<t.length;r++){var i=t[r];e.union(i.box)}this._box=e}return this._box}},{key:"visible",set:function(e){this.app.scene.visible=e},get:function(){return this.app.scene.visible}},{key:"defaultCampus",get:function(){var e=this.campuses;return e.length?e[0]:this._defaultCampus}},{key:"things",get:function(){return this.query(".Thing",!1)}},{key:"campuses",get:function(){return this.query(".Campus",!1)}},{key:"wireframeColor",set:function(e){var t=Z.parseColor(e);this.app.scene.overrideMaterial=t?new THREE.MeshBasicMaterial({color:t,wireframe:!0,side:THREE.DoubleSide,skinning:!0}):null}},{key:"static",set:function(e){this._staticEnableFlag.enable(e)},get:function(){return this._staticEnableFlag.enable()}}]),o}(Ee),Hn=function(){function t(e){y(this,t),this.app=e,this._backups={camera:{},lighting:{},postEffect:{}},this._campusSkyBox=null,this._campusBackground=null,this._campusSkyBoxColorTween=null,this._levelChanging=!1,this._lastPickedObject=null,this.init()}return t.prototype.setCampusSkyBoxColorScaleFactor=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1e3;this._campusSkyBoxColorTween&&this._campusSkyBoxColorTween.stop();var r=Z.parseVector3(this.app.backgroundColorScaleFactor),i=Z.parseVector3(e),n=this;this._campusSkyBoxColorTween=new TWEEN.Tween(r).to(i,t).onUpdate(function(){n.app.backgroundColorScaleFactor=[this._object.x,this._object.y,this._object.z]}),this._campusSkyBoxColorTween.start()},t.prototype.updatebackupInfo=function(e,t){var r=this._backups[e];r[t]=r[t]||{};var i=r[t];"camera"==e?(i.position=this.app.camera.position,i.target=this.app.camera.target):"lighting"==e?i.value=this.app.lighting:"postEffect"==e&&(i.value=this.app.postEffect)},t.prototype.clearBackupInfo=function(e,t){delete this._backups[e][t]},t.prototype.getBackupInfoValue=function(e,t,r){var i=this._backups[e][t];return i?i[r]:null},t.prototype.initAppEvents=function(){var o=this;this.app.on("cameracontrollerchanged",function(e){o.app.level.current&&o._levelChanging&&o.app.camera.stopFlying()},L.LevelFlyBreak),this.app.on("dblclick",function(e){if(0==e.button){var t=o.app.level,r=t.current;if(r){var i=e.object;if(i!=r&&i){var n=!1;i.isBuilding&&(n=!0),t.change(i,{autoEnterSubLevel:n})}}}},L.LevelEnterOperation),this.app.on("click",function(e){if(2==e.button){var t=o.app.level;if(t.current){var r=e.object;r&&(r.style.outlineColor=null);var i=!1;t.current.isFloor&&(i=!0),t.back({autoBackFromSubLevel:i})}}},L.LevelBackOperation),this.app.on(O.Pick,function(e){var t=o.app.level,r=t.current;if(r){o._lastPickedObject&&(o._lastPickedObject.style.outlineColor=null);var i=e.object;i&&i!=r&&"Ground"!=i.type&&(i.style.outlineColor=t.options.outlineColor),o._lastPickedObject=i}},L.LevelPickOperation),this._campusSkyBox=this.app.skyBox,this._campusBackground=this.app.background,this.app.on("skyboxchange",function(e){var t=o.app.level.current;t&&!t.isCampus||(o._campusSkyBox=e.skyBox)})},t.prototype.buildFlyParams=function(e,t){t=t||{};var r=this;e._flyStart=function(){r._levelChanging=!0},e._flying=function(){r._levelChanging=!0},e._flyStop=function(){r._levelChanging=!1},e._flyComplete=function(){r._levelChanging=!1},e.distance=e.distance||t.distance,e.time=Z.parseValue(e.time||t.time,1e3),e.keepDirection=Z.parseValue(e.keepDirection||t.keepDirection,!1);var i=this.app.level.current;return t.lastObject==i&&(e.offset=e.offset||t.offset,e.worldOffset=e.worldOffset||t.worldOffset,e.radius=e.radius||t.radius||i.boundingBox.radius,e.xAngle=Z.parseValue(e.xAngle||t.xAngle,null),e.yAngle=Z.parseValue(e.yAngle||t.yAngle,null)),e},t.prototype.registerSceneLevelEvents=function(){var t=this;this.app.on(O.EnterLevel,".Campus",function(e){t.onCampusLevelSetBackground(e)},L.LevelSetBackground),this.app.on(O.EnterLevel,".Campus",function(e){t.onCampusLevelSetEffect(e)},L.LevelSetEffect),this.app.on(O.EnterLevel,".Campus",function(e){t.onCampusLevelSceneOperations(e)},L.LevelSceneOperations),this.app.on(O.EnterLevel,".Campus",function(e){t.onCampusLevelPickedResultFunc(e)},L.LevelPickedResultFunc),this.app.on(O.EnterLevel,".Campus",function(e){t.onCampusLevelFly(e)},L.LevelFly),this.app.on(O.LeaveLevel,".Campus",function(e){t.onCampusLevelLeaveSceneOperations(e)},L.LevelSceneOperations),this.app.on(O.EnterLevel,".Building",function(e){t.onBuildingLevelSetBackground(e)},L.LevelSetBackground),this.app.on(O.EnterLevel,".Building",function(e){t.onBuildingLevelSetEffect(e)},L.LevelSetEffect),this.app.on(O.EnterLevel,".Building",function(e){t.onBuildingLevelSceneOperations(e)},L.LevelSceneOperations),this.app.on(O.EnterLevel,".Building",function(e){t.onBuildingLevelPickedResultFunc(e)},L.LevelPickedResultFunc),this.app.on(O.EnterLevel,".Building",function(e){t.onBuildingLevelFly(e)},L.LevelFly),this.app.on(O.LeaveLevel,".Building",function(e){t.onBuildingLevelLeaveSceneOperations(e)},L.LevelSceneOperations),this.app.on(O.EnterLevel,".Floor",function(e){t.onFloorLevelSetBackground(e)},L.LevelSetBackground),this.app.on(O.EnterLevel,".Floor",function(e){t.onFloorLevelSetEffect(e)},L.LevelSetEffect),this.app.on(O.EnterLevel,".Floor",function(e){t.onFloorLevelSceneOperations(e)},L.LevelSceneOperations),this.app.on(O.EnterLevel,".Floor",function(e){t.onFloorLevelPickedResultFunc(e)},L.LevelPickedResultFunc),this.app.on(O.EnterLevel,".Floor",function(e){t.onFloorLevelFly(e)},L.LevelFly),this.app.on(O.LeaveLevel,".Floor",function(e){t.onFloorLevelLeaveSceneOperations(e)},L.LevelSceneOperations),this.app.one(O.Load,".Floor",function(e){t.onFloorLevelLoad(e)},"__onFloorLevelLoad__"),this.app.on(O.EnterLevel,".Room",function(e){t.onRoomLevelSceneOperations(e)},L.LevelSceneOperations),this.app.on(O.EnterLevel,".Room",function(e){t.onRoomLevelPickedResultFunc(e)},L.LevelPickedResultFunc),this.app.on(O.EnterLevel,".Room",function(e){t.onRoomLevelFly(e)},L.LevelFly),this.app.on(O.LeaveLevel,".Room",function(e){t.onRoomLevelLeaveSceneOperations(e)},L.LevelSceneOperations),this.app.on(O.EnterLevel,".Thing",function(e){t.onThingLevelSceneOperations(e)},L.LevelSceneOperations),this.app.on(O.EnterLevel,".Thing",function(e){t.onThingLevelPickedResultFunc(e)},L.LevelPickedResultFunc),this.app.on(O.EnterLevel,".Thing",function(e){t.onThingLevelFly(e)},L.LevelFly),this.app.on(O.LeaveLevel,".Thing",function(e){t.onThingLevelLeaveSceneOperations(e)},L.LevelSceneOperations)},t.prototype.onCampusLevelSetBackground=function(e){this.app.level.options.autoChangeBackground&&(this._campusSkyBox?(this.app.skyBox=this._campusSkyBox,this.setCampusSkyBoxColorScaleFactor([1,1,1])):this._campusBackground&&(this.app.background=this._campusBackground))},t.prototype.onCampusLevelSetEffect=function(e){},t.prototype.onCampusLevelSceneOperations=function(e){var t=e.object;t.style.outlineColor=null,t.visible=!0,t.outdoors&&(t.outdoors.visible=!0);for(var r=0;r<t.children.length;r++)t.children[r].visible=!0;var i=t.buildings;for(r=0;r<i.length;r++){var n=i[r];n.visible=!0,n._queryChild("*").visible=!1;var o=n.floors,a=n.facades;n.hasFacades()?(a.visible=!0,o.visible=!1,n.showAllRoofs(!1)):(o.visible=!0,n.showAllRoofs(!0))}},t.prototype.onCampusLevelPickedResultFunc=function(e){function n(e){return"Outdoors"!=e.type&&!!function(e){var t=e.app.level.current;if(!t)return!0;if(e.isWebView)return!0;if(e.isMarker)return!0;if(e.parent==t){if(e.isGround)return!0;if(e.isBuilding)return!0;if(e.isThing)return!0}return!1}(e)}this.app.picker.pickedResultFunc=function(e){if(n(e))return e;for(var t=e.parents,r=0;r<t.length;r++){var i=t[r];if(n(i))return i}}},t.prototype.onCampusLevelFly=function(e){var t,r,i=e.object,n=e.previous;n&&!n.isCampus&&n.isChildOf(i)||this.clearBackupInfo("camera","Campus");var o=i.sceneJSONData.camInfo;o&&(t=o.eye.concat(),r=o.target.concat(),t=i.selfToWorld(t),r=i.selfToWorld(r));var a=e.position||this.getBackupInfoValue("camera","Campus","position")||t,s=e.target||this.getBackupInfoValue("camera","Campus","target")||r||i,l=e.radius||Math.min(i.boundingBox.radius,300);this.app.camera.flyTo(this.buildFlyParams({position:a,target:s,radius:l},e))},t.prototype.onCampusLevelLeaveSceneOperations=function(e){var t=e.current;if(t){var r=e.object;if(t.isCampus);else if(r.parents.has(t));else if(!r.things.has(t)){r.outdoors&&(r.outdoors.visible=!1);for(var i=0;i<r.children.length;i++){var n=r.children[i];n!=e.current&&(n.visible=!1)}if(t.isThing){var o=r.ground;o&&(o.visible=!1)}}e.skipBackupCameraInfo||this.updatebackupInfo("camera","Campus"),this.updatebackupInfo("lighting","Campus"),this.updatebackupInfo("postEffect","Campus")}},t.prototype.onBuildingLevelSetBackground=function(e){this.app.level.options.autoChangeBackground&&(this.app.background=null,this.app.skyBox="White",this.setCampusSkyBoxColorScaleFactor([.5,.5,.5]))},t.prototype.onBuildingLevelSetEffect=function(e){},t.prototype.onBuildingLevelSceneOperations=function(e){var t=e.object;t.style.outlineColor=null,t.visible=!0,t.parents.query(".Campus")[0].buildings.not(t).visible=!1,t._queryChild("*").visible=!0,t.facades.visible=!1;var r=t.floors;r.visible=!0;for(var i=0;i<r.length;i++){var n=r[i];n.showAllRoofs(!1),n.bake(null)}},t.prototype.onBuildingLevelPickedResultFunc=function(e){function n(e){var t=e.app.level.current;return!(t&&t!=e&&!e.isWebView&&!e.isMarker&&(!e.isFloor||"Outdoors"==e.type))}this.app.picker.pickedResultFunc=function(e){if(n(e))return e;for(var t=e.parents,r=0;r<t.length;r++){var i=t[r];if(n(i))return i}}},t.prototype.onBuildingLevelFly=function(e){var t=e.object;this.app.camera.flyTo(this.buildFlyParams({target:t},e))},t.prototype.onBuildingLevelLeaveSceneOperations=function(e){e.object.style.outlineColor=null,this.updatebackupInfo("lighting","Building"),this.updatebackupInfo("postEffect","Building")},t.prototype.onFloorLevelSetBackground=function(e){this.app.level.options.autoChangeBackground&&(this.app.skyBox="White",this.setCampusSkyBoxColorScaleFactor([.25,.25,.25]))},t.prototype.onFloorLevelSetEffect=function(e){},t.prototype.onFloorLevelSceneOperations=function(e){var t=e.object;t.style.outlineColor=null,t.visible=!0,t.building.floors.not(t).visible=!1,t.showAllRoofs(!1),this.app.level.options.autoBakeFloor&&t.bake()},t.prototype.onFloorLevelPickedResultFunc=function(e){function n(e){var t=e.app.level.current;return!(t&&t!=e&&!e.isWebView&&!e.isMarker&&!e.isRoom&&!e.isThing)}this.app.picker.pickedResultFunc=function(e){if(n(e))return e;for(var t=e.parents,r=0;r<t.length;r++){var i=t[r];if(n(i))return i}}},t.prototype.onFloorLevelFly=function(e){var t=e.object;if(e.previous.isBuilding)this.app.camera.flyTo(this.buildFlyParams({target:t},e)),this.clearBackupInfo("camera","Floor");else{var r=this.getBackupInfoValue("camera","Floor","position"),i=this.getBackupInfoValue("camera","Floor","target");this.app.camera.flyTo(this.buildFlyParams({position:r,target:i},e))}},t.prototype.onFloorLevelLeaveSceneOperations=function(e){e.object.style.outlineColor=null,this.updatebackupInfo("camera","Floor"),this.updatebackupInfo("lighting","Building"),this.updatebackupInfo("postEffect","Building")},t.prototype.onFloorLevelLoad=function(e){e.object.showAllRoofs(!1)},t.prototype.onRoomLevelSceneOperations=function(e){var t=e.object;t.style.outlineColor=null;for(var r=t.brothers.query(".Room"),i=0;i<r.length;i++)r[i].things.style.opacity=.25},t.prototype.onRoomLevelPickedResultFunc=function(e){this.app.picker.pickedResultFunc=function(e){if(!(r=(t=e).app.level.current)||r==t||t.isWebView||t.isMarker||t.isRoom&&t!=t.app.level.current||t.isThing&&t.app.level.current.things.has(t))return e;var t,r}},t.prototype.onRoomLevelFly=function(e){var t=e.object;if(e.previous.isFloor)this.app.camera.flyTo(this.buildFlyParams({target:t},e));else{var r=this.getBackupInfoValue("camera","Room","position"),i=this.getBackupInfoValue("camera","Room","target");this.app.camera.flyTo(this.buildFlyParams({position:r,target:i},e))}},t.prototype.onRoomLevelLeaveSceneOperations=function(e){var t=e.object;if(t.style.outlineColor=null,!e.lastObject.isChildOf(t))for(var r=t.brothers.query(".Room"),i=0;i<r.length;i++)r[i].things.style.opacity=null;this.updatebackupInfo("camera","Room")},t.prototype.onThingLevelSceneOperations=function(e){var t=e.object;t.style.outlineColor=null,t.brothers.query(".Thing").style.opacity=.25},t.prototype.onThingLevelPickedResultFunc=function(e){function n(e){var t=e.app.level.current;return!(t&&!e.isChildOf(t)&&!e.isWebView&&!e.isMarker&&(!e.isThing||!e.isBrotherOf(t)))}this.app.picker.pickedResultFunc=function(e){if(n(e))return e;for(var t=e.parents,r=0;r<t.length;r++){var i=t[r];if(n(i))return i}}},t.prototype.onThingLevelFly=function(e){var t=e.object,r=Z.parseValue(e.keepDirection,!0);this.app.camera.flyTo(this.buildFlyParams({target:t,keepDirection:r,centerPos:t.boundingBox.center},e))},t.prototype.onThingLevelLeaveSceneOperations=function(e){var t=e.object;t.style.outlineColor=null,t.brothers.query(".Thing").style.opacity=null},t.prototype.init=function(){this.initAppEvents(),this.registerSceneLevelEvents()},t}(),Fn=function(){function t(e){y(this,t),this.app=e,this._spriteMaterials={},this._spriteMaterialsAlwaysOnTop={},this._meshMaterials={},this._meshMaterialsAlwaysOnTop={}}return t.prototype.getMaterial=function(r){var i,t=(r=r||{}).url,e=r.alwaysOnTop,n=Z.parseValue(r.useSpriteMaterial,!0);if(t){if((i=n?(this._spriteMaterials[t]||(this._spriteMaterials[t]=new THREE.SpriteMaterial({color:16777215,transparent:!0})),this._spriteMaterials[t]):(this._meshMaterials[t]||(this._meshMaterials[t]=new THREE.MeshBasicMaterial({transparent:!0,side:THREE.DoubleSide,depthWrite:!1})),this._meshMaterials[t])).refCount=i.refCount||1,r.skipRefCount||i.refCount++,e){var o=n?this._spriteMaterialsAlwaysOnTop:this._meshMaterialsAlwaysOnTop;o[t]=o[t]||i.clone(),(i=o[t]).depthTest=!1,i.depthWrite=!1,i.refCount=i.refCount||1,r.skipAlwaysOnTopRefCount||i.refCount++}var a=!i.map;if(a){var s=this.app.resourceManager.textureLoader;i.map=s.load(t,function(e){e.refCount++;var t=r.loadTextureComplete;t&&t({material:i})},function(){},function(e){console.error('[Sprite] load "'+t+'" failed')})}}else i=n?new THREE.SpriteMaterial({color:16777215,transparent:!0}):new THREE.MeshBasicMaterial({transparent:!0,side:THREE.DoubleSide,depthWrite:!1}),e&&(i.depthTest=!1,i.depthWrite=!1);return{material:i,needLoadTexture:a}},t.prototype.unloadMaterial=function(e){return!(!e||!this.app.resourceManager.disposeMaterial(e))},t.prototype.unloadMaterials=function(e,t){var r=t[e];this.unloadMaterial(r)&&delete t[e]},t.prototype.unload=function(e){this.unloadMaterials(e,this._spriteMaterials),this.unloadMaterials(e,this._spriteMaterialsAlwaysOnTop),this.unloadMaterials(e,this._meshMaterials),this.unloadMaterials(e,this._meshMaterialsAlwaysOnTop)},t.prototype.onUpdate=function(e){},t}(),kn=function(){function r(e,t){y(this,r),this.app=e,this.modelResource=e.modelResource,this.refCount=1,this.URL=t,this._boundingBox=null,this._skinnedMeshes=[],this.node=null,this.animations=null,this.geometry=null,this.materials=null}return r.prototype._setupBoundingBox=function(){var e=(new THREE.Box3).setFromVisibleObject(this.node),t=new THREE.Vector3;e.getCenter(t);var r=new THREE.Vector3;e.getSize(r),this._boundingBox={},this._boundingBox.center=t.toArray(),this._boundingBox.size=r.toArray(),this._boundingBox.radius=r.length()},r.prototype.load=function(e){var t=e.node,r=e.animations,i=e.geometry,n=e.materials;if(i)this.animations=i.animations,this.geometry=i,this.materials=n;else if(t){var o=this.node!=t;this.node=t,r?this.animations=r:(o||null===r)&&(this.animations=null)}this._skinnedMeshes=t.getSkinnedMeshes(),this._setupBoundingBox()},r.prototype.get=function(){return this.refCount++,this},r.prototype.unload=function(){return!(0!==this.refCount&&(this.refCount--,this.refCount)||this.modelResource.residentMode||(this.app.resourceManager.unload(this.node),this.node=null,this.animations=null,this.geometry=null,this.materials=null))},r.prototype._cloneNode=function(){if(this.node){var e=this.node.clone(),r=[];if(e.traverse(function(e){var t=e.geometry;t&&(t.refCount=t.refCount||1,t.refCount++),e.isSkinnedMesh&&r.push(e)}),this._skinnedMeshes.length)for(var t=this._skinnedMeshes,i=0;i<t.length;i++){var n=t[i],o=t[i].skeleton,a=e.getBones(this.node,t[i].skeleton),s=r[i],l=new THREE.Skeleton(a,o.boneInverses);s.bind(l,n.bindMatrix)}return e}if(this.geometry)return(s=new THREE.SkinnedMesh(this.geometry,this.materials)).scale.set(1,1,1),s},r.prototype.cloneNode=function(){var e=this._cloneNode(),i=function(e){e.refCount?e.refCount++:e.refCount=1};return e.traverseMaterials(function(e){for(var t in i(e),e){var r=e[t];r&&r.isTexture&&i(r)}}),e},l(r,[{key:"boundingBox",get:function(){return this._boundingBox||this._setupBoundingBox(),this._boundingBox}}]),r}(),In=function(){function t(e){y(this,t),this.app=e,this.isResidentMode=!1,this.models={},this.loadingModels={},this.waitModels=[]}return t.prototype.onBackgroundProgress=function(e){},t.prototype.get=function(e){var t=this.models[e];return t?t.get():null},t.prototype.set=function(e,t,r){var i=this.models[e];return i?i.unload():(i=new kn(this.app,e),this.models[e]=i),t&&r&&i.load({node:t,animations:r}),i},t.prototype.getBoundingBox=function(e){var t=this.models[e];return t?t.boundingBox:null},t.prototype.unload=function(e){if(void 0===e){for(var e in this.models)this.models[e].unload();return this.clear(),!0}if(Z.isString(e)){var t=this.models[e];if(t&&t.unload())return delete this.models[e],!0}return!1},t.prototype.clear=function(e){Z.isNull(e)?this.models={}:delete this.models[e]},t.prototype._download=function(i,t,n,e,r){var o=this.get(i);if(o)delete this.loadingModels[i],n&&n(o);else{var a=this;new thingjs.GLTFLoader(this.app.loadingManager).loadFromURL({url:i,jsonCallback:function(e){t&&t(e)},modelCallback:function(e){var t=e.url,r=a.get(t);r||(r=a.set(t)).load(e),delete a.loadingModels[i],n&&(n(r)||a.unload(i))},errorCallback:function(e){delete a.loadingModels[i],r&&r(e)},progressCallback:e})}},t.prototype.download=function(e,t,r,i,n){this.loadingModels[e]?this.waitModels.push({url:e,jsonCallback:t,modelCallback:r,progressCallback:i,errorCallback:n}):(this.loadingModels[e]={},this._download(e,t,r,i,n))},t.prototype.preload=function(e,t){var r=(t=t||{}).complete;if(Z.isArray(e))for(var i=0,n=e.length,o=0;o<n;o++)this.download(e[o],function(){},function(e){++i==n&&r&&r()},function(){},function(){++i==n&&r&&r()});else Z.isString(e)&&this.download(e,function(){},function(e){r&&r()},function(){},function(){r&&r()})},t.prototype.needWait=function(e){var t=e.url;return!!this.loadingModels[t]},t.prototype.update=function(){for(var e=0;e<this.waitModels.length;e++){var t=this.waitModels[e];this.needWait(t)||(this._download(t.url,t.jsonCallback,t.modelCallback,t.progressCallback,t.errorCallback),this.waitModels.splice(e--,1))}},t.prototype.onUpdate=function(e){this.update(e)},l(t,[{key:"residentMode",set:function(e){if(!(this.isResidentMode=e)){var t=[];for(var r in this.models){var i=this.models[r];if(0===i.refCount){var n=i.URL;i.unload()&&t.push(n)}}for(var o=0;o<t.length;o++)n=t[o],delete this.models[n]}},get:function(){return this.isResidentMode}}]),t}(),jn=function(){function t(e){y(this,t),this.app=e,this.particles={}}return t.prototype.get=function(e){return this.particles[e]},t.prototype.set=function(e,t){this.particles[e]=t},t.prototype.download=function(r,i){var e=r.appendPath("index.json"),n=this;new THREE.FileLoader(this.app.loadingManager).load(e,function(e){var t=JSON.parse(e);n.set(r,t),i&&i(t)},function(){},function(){})},t}(),Nn=function(){function t(e){y(this,t),this.app=e,this.picker=e.picker,this.pickDownPosition=[0,0]}return t.prototype.processPicking=function(e){this.picker.processPicking(e)},t.prototype.processAreaPicking=function(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],r=this.picker,i=r.pickingArea,n=new ye(this.app);t?n.buildReturnObject(i.processPicking(r.areaCandidates)):(this.processPicking(e),r.areaCandidates.has(e.object)?n.buildReturnObject([e.object]):n.buildReturnObject([])),this.picker.setPickedObject(n),this.app.trigger(O.AreaPicking,{objects:n})},t.prototype.onEnter=function(e){},t.prototype.onUpdate=function(e){var t=this.picker;if(!t.areaPicking){var r=t.pickingArea;r.started&&r.end()}t.update(this.app._deltaTime)},t.prototype.onMouseMove=function(e){var t=this.picker;if(t.areaPicking){var r=t.pickingArea;r.started&&(r.move(e.clientX,e.clientY),r.realTimePicking&&(e.areaPicking=!0,this.processAreaPicking(e)))}else this.processPicking(e),this.picker.setPickedObject(e.object)},t.prototype.onMouseUp=function(e){var t=this.picker;if(t.areaPicking){if(0==e.button){var r=4<THING.Math.getDistance(this.pickDownPosition,[e.x,e.y]);e.finishedAreaPicking=!0,this.processAreaPicking(e,r),t.pickingArea.end()}}else e.ignoreFrameCheck=!0,t.processPicking(e)},t.prototype.onMouseDown=function(e){var t=this.picker;this.pickDownPosition=[e.clientX,e.clientY],t.areaPicking?0==e.button&&t.pickingArea.start(e.clientX,e.clientY):(e.ignoreFrameCheck=!0,t.processPicking(e))},t.prototype.onDoubleClick=function(e){e.ignoreFrameCheck=!0,this.processPicking(e)},t.prototype.onSingleClick=function(e){e.ignoreFrameCheck=!0,this.processPicking(e)},t.prototype.onClick=function(e){e.ignoreFrameCheck=!0,this.picker.processPicking(e)},t.prototype.onDragStart=function(e){var t=this.picker,r=t.processPicking(e);if(null!=r){var i=r.object;if(i)if(i.draggable){i._dragState=T.Dragging,i.internalUserData.prevPickable=i.pickable,i.pickable=!1,e.ignoreFrameCheck=!0,e.forceUpdateTexture=!0;var n=t.processPicking(e);t.dragIntersect=n||r,t.dragIntersect.dragObject=i,e.dragObject=i,delete e.ignoreFrameCheck,delete e.forceUpdateTexture,this.app.camera.disable({rotate:!0})}else e.object=null}},t.prototype.onDrag=function(e){var t=this.picker;null!=t.dragIntersect&&(e.disableGPUPicker=!0,t.processPicking(e),delete e.disableGPUPicker,this.app.needUpdate=!0)},t.prototype.onDragEnd=function(e){var t=this.picker;if(null!=t.dragIntersect){e.disableGPUPicker=!0,t.processPicking(e),delete e.disableGPUPicker;var r=t.dragIntersect.dragObject;r&&(r._dragState=T.DragEnd);var i=r.internalUserData.prevPickable;i&&(r.pickable=i),delete r.internalUserData.prevPickable,e.object=r,t.dragIntersect=null,this.app.camera.resume({rotate:!0})}},t}(),Dn=function(){function t(e){y(this,t),this.app=e,this.camera=e.camera,this.updateTime=0,this.lastAdjustCameraNear=0}return t.prototype._getMinDistanceForAdjustCameraNear=function(e,t,r,i){var n=Z.parseVector3(r),o=Z.parseVector3(this.camera.position),a=Math.min(i,n.distanceTo(o));if(e<a){var s=this.app.picker.intersectResult(t[0],t[1],null,{ignoreFrameCheck:!1,skipUpdateTexture:!0});s&&s.picked&&(n=s.getPickedPosition({skipOtherPick:!0}))&&(n=Z.parseVector3(n),a=Math.min(a,o.distanceTo(n)))}return a/e},t.prototype._getAdjustCameraNear=function(e){var t=this.camera.distance;if(10<t){var r=this.camera.worldToScreen(this.camera.target),i=this.camera.screenToWorld(r[0],r[1]);if(i)return.5<=this.updateTime&&(this.updateTime=0,this.lastAdjustCameraNear=this._getMinDistanceForAdjustCameraNear(e,r,i,t)),this.lastAdjustCameraNear}return this.camera.near},t.prototype.processAdjustCameraNear=function(){var e=this.app.camera.flying?80:40,t=Math.max(.1,this._getAdjustCameraNear(e));this.app.renderCamera.setNear(t)},t.prototype.onUpdate=function(){this.updateTime+=this.app._deltaTime;var e=this.camera._targetObject;e&&(e.position=this.camera.target)},t.prototype.onEnter=function(){var t=this;this.app.on("cameraChange",function(e){t.camera.autoAdjustNear&&!t.camera.toggling&&t.processAdjustCameraNear()},"__cameraNearFixed__"),this.app.on("cameraChangeMouseMove",function(e){t.app.camera.inputEnabled&&t.app.pauseEvent(O.Pick,null,L.LevelPickOperation)},"__disable_outline__"),this.app.on("cameraChangeEnd",function(e){t.app.resumeEvent(O.Pick,null,L.LevelPickOperation)},"__disable_outline__")},t.prototype.onLeave=function(){this.app.off("cameraChange","__cameraNearFixed__"),this.app.off("cameraChangeMouseMove","__disable_outline__"),this.app.off("cameraChangeEnd","__disable_outline__")},t}(),Un=function(){function i(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"translate",r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};y(this,i),e&&(this._object=e,this._axis=null,this._disableAxis=[],this._prevPosition=this._object.node.position.clone(),this.init(e.app,t,r),this.control.attach(this._object.node),this.app.scene.add(this.control),this.control.setPickable(!1))}return i.prototype.init=function(e,t,r){this.app=e,this.control=new THREE.TransformControls(this.app.renderCamera,this.app.mainDomElement),this.control.traverse(function(e){e.userData.skipOutline=!0,e.userData.useVisibleOnly=!0});var i=this;this.control.addEventListener("change",function(e){i.onGizmoChange(e)}),this.control.addEventListener("objectChange",function(e){i.onGizmoObjectChange(e)}),this.control.addEventListener("mouseDown",function(e){i.onGizmoMouseDown(e)}),this.control.addEventListener("mouseUp",function(e){i.onGizmoMouseUp(e)}),this.control.getGizomNode=function(){return i.control.children[0]},this.control.getAxisNode=function(){return i.control.children[1]},this.mode="translate",Z.isString(t)?(this.mode=t,this.params=r||{}):this.params=t||{},this.app.on("cameraViewChange",function(e){e.view==R.Orthographic?i.setAxis("XZ"):i.setAxis("XYZ")}),this.app.camera.viewMode==R.Orthographic&&this.setAxis("XZ")},i.prototype.onGizmoChange=function(e){},i.prototype.onGizmoObjectChange=function(e){if(this._object){var t=new THREE.Vector3;t.subVectors(this._object.node.position,this._prevPosition),this._object.updateBox(t),this._prevPosition.copy(this._object.node.position)}this.app.needUpdate=!0;var r=this.params.change;r&&r.call(this,{object:this._object})},i.prototype.onGizmoMouseDown=function(e){this.app.camera.disable({rotate:!0});var t=this.params.changeStart;t&&t.call(this,{object:this._object})},i.prototype.onGizmoMouseUp=function(e){this.app.camera.resume({rotate:!0});var t=this.params.changeEnd;t&&t.call(this,{object:this._object})},i.prototype.onUpdate=function(e){if(this._object.static)return this.control.updateMatrixWorld(),!0},i.prototype.onRemove=function(){this.app.scene.remove(this.control),this.control.detach(),this.control.dispose()},i.prototype.onVisible=function(e){this.control.enabled&&(this.control.visible=e)},i.prototype.setAxis=function(e){if(this._axis=e,this._axis&&"XYZ"!=this._axis){var r=this,i=new THREE.Raycaster;this.control.userData.original_pointerHover=this.control.pointerHover,this.control.axis=e,this.control.pointerHover=function(e){if(void 0!==this.object&&!0!==this.dragging&&(void 0===e.button||0===e.button)){i.setFromCamera(e,this.camera);var t=i.intersectObjects(this.getGizomNode().picker[this.mode].children,!0)[0]||!1;t?-1!=r._axis.search(t.object.name)&&(this.axis=t.object.name):this.axis=""}}}else this.control.userData.original_pointerHover&&(this.control.pointerHover=this.control.userData.original_pointerHover,delete this.control.userData.original_pointerHover)},i.prototype.detach=function(){this.control.detach()},i.prototype.attach=function(e){this.control.attach(e)},i.prototype.enableAxis=function(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];if(e){var r=this._disableAxis.indexOf(e);t?-1!==r&&this._disableAxis.splice(r,1):-1===r&&this._disableAxis.push(e);var i=this.control;if(this._disableAxis.length){var n=this,o=function(e){if(!e)return!0;for(var t=0;t<n._disableAxis.length;t++){var r=n._disableAxis[t];if(-1!==e.indexOf(r))return!0}return!1};Z.setValue(i,"pointerDown",function(e){var t=this.getGizomNode().axis;o(t)||Z.getBackupValue(i,"pointerDown").call(this,e)}),Z.setValue(i,"pointerMove",function(e){var t=this.getGizomNode().axis;o(t)||Z.getBackupValue(i,"pointerMove").call(this,e)}),Z.setValue(i,"pointerUp",function(e){var t=this.getGizomNode().axis;o(t)||Z.getBackupValue(i,"pointerUp").call(this,e)}),Z.setValue(i,"updateMatrixWorld",function(){Z.getBackupValue(i,"updateMatrixWorld").call(this),this.getGizomNode().gizmo[this.getGizomNode().mode].traverse(function(e){for(var t=0;t<n._disableAxis.length;t++){var r=n._disableAxis[t];e.name==r&&(e.visible=!1)}})})}else Z.revertValue(i,"pointerDown"),Z.revertValue(i,"pointerMove"),Z.revertValue(i,"pointerUp"),Z.revertValue(i,"updateMatrixWorld")}},i.prototype.setSize=function(e){console.warn("[AxisTransformControl] Please use '.size' to replace 'setSize()'"),this.size=e},l(i,[{key:"object",get:function(){return this.control.object}},{key:"node",get:function(){return this.control}},{key:"mode",set:function(e){if(e){if("translate"!=e&&"rotate"!=e&&"scale"!=e)return void console.error('[AxisTransformControl] mode is invalid, must be "translate/rotate/scale"');this.control.setMode(e)}},get:function(){return this.control.getMode()}},{key:"space",set:function(e){if(e){if("world"!=e&&"local"!=e)return void console.error('[AxisTransformControl] space is invalid, must be "world/local"');this.control.setSpace(e)}},get:function(){return this.control.space}},{key:"size",set:function(e){this.control.setSize(e)},get:function(){return this.control.size}},{key:"visible",set:function(e){this.control.visible=e,this.control.enabled=e},get:function(){return this.control.visible}}]),i}(),Vn=function(){function t(e){y(this,t),this.state=e,this.app=e.app,this.control=e.control,this.root=new THREE.Group,this.root.userData.childUseWorldAnglesAlways=!0,this.root.name="EditObjectGroup",this.lastRootPosition=null,this.lastRootScale=null,this.lastRootRotation=null}return t.prototype.hasChanged=function(){var e=this.root.position,t=this.root.scale,r=this.root.rotation;return!(this.lastRootPosition.equals(e)&&this.lastRootScale.equals(t)&&this.lastRootRotation.equals(r))},t.prototype.recordTranslation=function(){this.state.execute({type:"SetNodeTranslation",node:this.root,position:this.lastRootPosition,scale:this.lastRootScale,rotation:this.lastRootRotation}),this.synTranslation()},t.prototype.notify=function(e){for(var t=this.root.children,r=0;r<t.length;r++){var i=t[r].userData,n=this.app.objectManager.get(i.id);if(n){var o=n.userData._editCallbacks;o&&o[e].call(n);var a=n.userData.selectObjectCallback;a&&a.call(n)}}},t.prototype._pushSubNodeAttach=function(e,t,r,i,n){var o=this.app.objectManager.getAncestors(t);e.push({type:"AttachNode",node:o.node,nodeParent:o.node.userData.nodeParent})},t.prototype.recordSubNodeAttach=function(e,t,r,i){var n=[];this._pushSubNodeAttach(n,e,t,r,i),this.state.execute(n),this.synTranslation()},t.prototype._pushSubNodeOnlyAttach=function(e,t,r,i,n,o,a,s,l){for(var c=0;c<r.length;c++){var u=r[c];this.hasSelected(u)&&e.push({type:"AttachNode",node:r[c].node,nodeParent:i[c]})}},t.prototype.recordSubNodeOnlyAttach=function(e,t,r,i,n,o,a,s){var l=[];this._pushSubNodeOnlyAttach(l,e,t,r,i,n,o,a,s),this.state.execute(l),this.synTranslation()},t.prototype._pushNodeAttach=function(e,t,r,i,n){e.push({type:"AttachNode",node:t.node,nodeParent:r})},t.prototype.recordNodeAttach=function(e,t,r,i){var n=[];this._pushNodeAttach(n,e,t,r,i),this.state.execute(n),this.synTranslation()},t.prototype._pushNodeOnlyAttach=function(e,t,r,i,n,o,a,s,l){e.push({type:"AttachNode",node:t.node,nodeParent:r});for(var c=0;c<i.length;c++)i[c]!=t&&e.push({type:"AttachNode",node:i[c].node,nodeParent:n[c]})},t.prototype.recordNodeOnlyAttach=function(e,t,r,i,n,o,a,s){var l=[];this._pushNodeOnlyAttach(l,e,t,r,i,n,o,a,s),this.state.execute(l),this.synTranslation()},t.prototype._pushNodesAttach=function(e,t,r,i,n){for(var o=0;o<t.length;o++){var a=t[o],s=r[o];e.push({type:"AttachNode",node:a.node,nodeParent:s})}},t.prototype.recordNodesAttach=function(e,t,r,i){var n=[];this._pushNodesAttach(n,e,t,r,i),this.state.execute(n)},t.prototype._pushSubNodesAttach=function(e,t,r,i,n){},t.prototype.recordSubNodesAttach=function(e,t,r,i){var n=[];this._pushSubNodesAttach(n,e,t,r,i),this.state.execute(n)},t.prototype.synTranslation=function(){this.lastRootPosition=this.root.position.clone(),this.lastRootScale=this.root.scale.clone(),this.lastRootRotation=this.root.rotation.clone();for(var e=0;e<this.root.children.length;e++){var t=this.root.children[e].userData.id;t&&(this.app.objectManager.get(t).dirty=!0)}},t.prototype.updateRoot=function(){this.updateControl(),this.updateRootVisible(),this.updateRootPosition(),this.updateSelections(),this.synTranslation(),this.app.needUpdate=!0},t.prototype._getNodeCenterPosition=function(e){var t=new THREE.Vector3;if(this.state._isSubNode(e))e.getWorldPosition(t);else{var r=this.app.objectManager.get(e.userData.id);if(r){var i=r.position,n=r.centerPos;n?(t.set(n[0],0,n[1]),r.node.updateMatrixWorld(),t.applyMatrix4(r.node.matrixWorld),t.y=i[1]):t=Z.parseVector3(i)}else e.getWorldPosition(t)}return t},t.prototype.clearSelections=function(){this.state._selectionObjects.clear()},t.prototype.addSelection=function(e){this.state._selectionObjects.add(e)},t.prototype.hasSelected=function(e){return this.state._selectionObjects.has(e)},t.prototype.updateSelections=function(){this.state.objects,this.clearSelections();for(var e=0;e<this.root.children.length;e++){var t=this.root.children[e].userData,r=t.id;if(r){var i=this.app.objectManager.get(r);t.subNode||this.addSelection(i)}}},t.prototype.updateControl=function(){this.control.object||this.root.children.length&&(this.control.attach(this.root),this.app.scene.add(this.control.node),this.synTranslation())},t.prototype.updateRootVisible=function(){this.root.children.length?this.root.visible=!0:this.root.visible=!1,this.control.visible=this.root.visible},t.prototype.updateRootPosition=function(){var e=this.root.children;if(e.length){for(var t=new THREE.Vector3,r=0;r<e.length;r++){var i=e[r],n=this._getNodeCenterPosition(i);t.add(n)}t.divideScalar(e.length);var o=this.root.parent.worldToLocal(t),a=this.root.detachChildren(this.app.scene);this.root.position.copy(o),this.root.attachChildren(a,this.app.scene)}},t.prototype.getObjectInfo=function(e,t){for(var r=new Set,i=this.root.children,n=0;n<i.length;n++){var o=i[n],a=this.app.objectManager.get(o.userData.id);if(!r.has(a)&&(r.add(a),e&&e.push(a),t)){var s=a.node.userData.nodeParent;t.push(s)}}},t.prototype.getSubNodeInfo=function(i,n){var o=this;this.root.traverse(function(e){var t=o.app.objectManager.get(e.userData.id);if(t&&-1!==t.getSubNodeIndex(e)&&(i&&i.push(e),n)){var r=e.userData.nodeParent;n.push(r)}})},t.prototype.recordNodeParent=function(e){e.isBaseObject&&(e=e.node);var t=e.parent;t!=this.root&&(e.userData.nodeParent=t)},t.prototype._pushAddObjects=function(e,t){if(t&&t.length){for(var r=[],i=0;i<t.length;i++){var n=t[i];this.hasSelected(n)||r.push(n)}if(r.length)for(i=0;i<r.length;i++)n=r[i],this.recordNodeParent(n),e.push({type:"AttachNode",node:n.node,nodeParent:this.root})}},t.prototype._dispatchBreakableEvent=function(e,t){return t.continueFlag=!0,this.app.trigger(e,t),t.continueFlag},t.prototype.addObjects=function(e){var t=[];this._pushAddObjects(t,e),this.state.execute(t),this.updateRoot()},t.prototype._pushAddSubNodes=function(e,t){if(t.length)for(var r=0;r<t.length;r++){var i=t[r];this.state._isSubNode(i)&&(i.isChildOf(this.root)||this.recordNodeParent(i))}},t.prototype.addSubNodes=function(e){var t=[];this._pushAddSubNodes(t,e),this.state.execute(t),this.updateRoot()},t.prototype.addSubNode=function(e){return!!this.state._isSubNode(e)&&!!this.app.objectManager.getAncestors(e)&&(this.recordNodeParent(e),this.recordSubNodeAttach(e,this.root,this.state.selectOutlineColor,null),this.updateRoot(),!0)},t.prototype.addSubNodeOnly=function(e){if(!e)return!1;if(!e.userData.subNode)return!1;if(!this.app.objectManager.getAncestors(e))return!1;var t=[],r=[];this.getObjectInfo(t,r);var i=[],n=[];this.getSubNodeInfo(i,n);for(var o=0;o<i.length;o++)if(i[o]==e){i.splice(o,1);break}return this.recordNodeParent(e),this.recordSubNodeOnlyAttach(e,t,r,i,n,this.root,this.state.selectOutlineColor,null),this.updateRoot(),!0},t.prototype.add=function(e,t){t&&this.addSubNode(t.intersect.node)||(this.recordNodeParent(e),this.recordNodeAttach(e,this.root,this.state.selectOutlineColor,null),this.updateRoot())},t.prototype.addOnly=function(e,t){if(!(t&&this.addSubNodeOnly(t.intersect.node)||1==this.root.children.length&&this.has(e))){var r=[],i=[];this.getObjectInfo(r,i);var n=[],o=[];this.getSubNodeInfo(n,o),this.recordNodeParent(e),this.recordNodeOnlyAttach(e,this.root,r,i,n,o,this.state.selectOutlineColor,null),this.updateRoot()}},t.prototype.remove=function(e){if(this.state._isSubNode(e)){for(var t=this.root.children,r=0;r<t.length;r++)if((n=t[r])==e){var i=n.userData.nodeParent;this.recordSubNodeAttach(e,i,null,this.state.selectOutlineColor);break}}else for(t=this.root.children,r=0;r<t.length;r++){var n=t[r],o=this.app.objectManager.get(n.userData.id);if(e==o){this.app.trigger("unselectEditableObject",{object:o}),i=n.userData.nodeParent,this.recordNodeAttach(e,i,null,this.state.selectOutlineColor);break}}this.updateRoot()},t.prototype.removeAll=function(){if(this.root.children.length){var e=[],t=[];this.getObjectInfo(e,t);var r=[],i=[];this.getSubNodeInfo(r,i);for(var n=0;n<e.length;n++){var o=e[n];this.app.trigger("unselectEditableObject",{object:o})}this.state.canRespondFromCommandManager=!1,this.recordNodesAttach(e,t,null,this.state.selectOutlineColor),this.recordSubNodesAttach(r,i,null,this.state.selectOutlineColor),this.state.canRespondFromCommandManager=!0,this.updateRoot()}},t.prototype.has=function(e){var t=this.root.children;if(this.state._isSubNode(e)){for(var r=0;r<t.length;r++)if((i=t[r]).userData.subNode&&i==e)return!0}else for(r=0;r<t.length;r++){var i;if(!(i=t[r]).userData.subNode&&e==this.app.objectManager.get(i.userData.id))return!0}return!1},t.prototype.attach=function(){this.root.attach(this.app.scene,this.app.scene)},t.prototype.detach=function(){this.removeAll(),this.control.detach(),this.app.scene.remove(this.control.node),this.root.detach(this.app.scene),this.updateRoot()},t.prototype.clearScene=function(){var e=[];this.state._pushDeleteSubNodes(e,this.state.subNodes),this.state._pushDeleteObjects(e,this.state.objects),this.state.execute(e,!0),this.updateRoot()},t.prototype.toJSON=function(){for(var e=Array.from(this.state._selectionObjects),t=0;t<e.length;t++)this.remove(e[t]);var r=this.state.subNodes;for(t=0;t<r.length;t++)this.remove(r[t]);var i=[],n=this.state.objects;for(t=0;t<n.length;t++){var o=n[t];i.push(o.toJSON())}for(t=0;t<r.length;t++)this.addSubNode(r[t]);for(t=0;t<e.length;t++)this.add(e[t]);return JSON.stringify(i)},t.prototype.pasteObjects=function(){0<arguments.length&&void 0!==arguments[0]&&arguments[0],console.warn('[EditObjectState] we do not support ".pasteObjects()" anymore, please do not use it')},t.prototype.fromJSON=function(e){console.warn('[EditObjectState] we do not support ".fromJSON()" anymore, please do not use it')},t}(),Bn=function(){function i(e){y(this,i);var t=this;this.app=e,this.picker=e.picker,this.copyObjectsJSONData=[],this._selectionObjects=new Set,this.canRespondFromCommandManager=!1,this._enableDirectMode=!1,this._enableKeyMode=!1,this._enableAutoRemoveAllWhenClick=!0,this.app.on("push",function(e){t.onPush(e)}),this.app.on("redo",function(e){t.onRedo(e)}),this.app.on("undo",function(e){t.onUndo(e)});var r={changeEnd:function(e){t.group.hasChanged()&&(t.group.recordTranslation(),t.group.notify("modify"))}};this.control=new Un,this.control.init(e,"translate",r),this.selectOutlineColor="#0000FF",this.group=new Vn(this)}return i.prototype.onPush=function(e){this.canRespondFromCommandManager&&this.group.updateRoot()},i.prototype.onRedo=function(e){this.canRespondFromCommandManager&&this.group.updateRoot()},i.prototype.onUndo=function(e){this.canRespondFromCommandManager&&this.group.updateRoot()},i.prototype.notify=function(e,t){var r=e.userData._editCallbacks;r&&r[t].call(e)},i.prototype.startDrag=function(e,t,r,i){if(e){i=i||.1,this.app.camera.disable({rotate:!0}),e.pickable=!1,e.catchEventAnyTime=!0,e.node.userData.skipPick=!0,e.position=app.camera.screenToWorld(t,r);var n=this;e.on("mousemove",function(e){var t=n.app.picker.pickWorldPosition(e.clientX,e.clientY);t||(t=n.app.camera.screenToWorld(e.clientX,e.clientY)),t&&(t[1]+=i,this.position=t)},"startDrag_mousemove"),e.on("mouseup",function(e){this.pickable=!0,this.catchEventAnyTime=!1,delete this.node.userData.skipPick,n.group._dispatchBreakableEvent("selectEditableObject",{object:this})&&n.selectObject(this),this.off("mousemove",null,"startDrag_mousemove"),this.off("mouseup",null,"startDrag_mouseup"),n.app.camera.resume({rotate:!0}),n.notify(this,"dragEnd")},"startDrag_mouseup")}},i.prototype.selectObject=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"translate",r=arguments[2];"translate"==t||"rotate"==t?(this.group.addOnly(e),r&&(e.userData.selectObjectCallback=r),this.setMode(t)):console.error("The mode must be 'translate' or 'rotate'")},i.prototype.unselectObject=function(e){this.group.remove(e)},i.prototype.setMode=function(e){e&&(this.control.mode=e)},i.prototype.parseParams=function(e){var t=e.type;if("RouteLine"==t||"PolygonLine"==t){var r=e.points;if(!r){r=[[-5,0,-5],[0,0,-5],[0,0,0],[0,0,5],[5,0,5]],e.points=r,e.style=e.style||{};var i=e.style;i.color=Z.parseValue(i.color,5824222),e.image&&void 0===e.scrollUV&&(e.scrollUV=!0)}}else"Water"==t?(r=[[-20,0,-20],[-20,0,20],[20,0,20],[20,0,-20]],e.points=r,e.normalMap0=Z.parseValue(e.normalMap0,"images/water/Water_1_M_Normal.jpg"),e.normalMap1=Z.parseValue(e.normalMap1,"images/water/Water_2_M_Normal.jpg")):"Region"==t&&(r=[[-20,0,-20],[-20,0,20],[20,0,20],[20,0,-20]],e.points=r,e.fontColor=Math.random(),e.fontSize=THING.Math.randomInt(9,32),e.fontText="");return Z.cloneObject(e)},i.prototype.addObjects=function(e){for(var t=[],r=0;r<e.length;r++){var i=e[r];i instanceof Ee?(i.internalUserData.editable=!0,t.push(i)):console.error("The object is not BaseObject, so we can not add object to edit state")}this.group.addObjects(t)},i.prototype.createObject=function(e,t){(e=e||{}).internalUserData={editable:!0};var r=(e=this.parseParams(e)).complete;e.complete=function(){r&&r()};var i=this.app.create(e);return t&&(i.userData._editCallbacks=t),i},i.prototype._pushDeselectObject=function(e,t){t&&e.push({type:"AttachNode",node:t.node,nodeParent:t.node.userData.nodeParent})},i.prototype._pushDeleteObject=function(e,t){t&&this._pushDeselectObject(e,t)},i.prototype.deleteObject=function(e){this.notify(e,"remove");var t=[];this._pushDeleteObject(t,e),this.execute(t,!0),this.group.updateRoot()},i.prototype._pushDeleteObjects=function(e,t){for(var r=0;r<t.length;r++){var i=t[r];this._pushDeleteObject(e,i)}},i.prototype.deleteObjects=function(e){for(var t=0;t<e.length;t++)this.notify(e[t],"remove");var r=[];this._pushDeleteObjects(r,e),this.execute(r,!0),this.group.updateRoot()},i.prototype._isSubNode=function(e){return!!e&&!e.isBaseObject&&!!e.userData.subNode},i.prototype._isBreakByControlAxis=function(e){var t=e.intersect;return!(t&&this._isSubNode(t.node)||!this.control.axis||!this.control.visible)},i.prototype._isCanPick=function(e){if(this._isBreakByControlAxis(e))return!1;var t=e.object;if(t){if(t==this.app.outdoors)return!1;if(!t.internalUserData.editable)return!1}return!0},i.prototype._getSortedSubNodes=function(e,t){for(var r=[],i=0;i<e.length;i++){var n=e[i],o=n.userData,a=this.app.objectManager.get(o.id),s=a.getSubNodeIndex(n);r.push({index:s,node:n,object:a})}return r.sort(t),r},i.prototype._pushInsertSubNode=function(e,t){},i.prototype.insertSubNode=function(){var e=this.subNodes;if(e.length){var t=[];this._pushInsertSubNode(t,e),this.execute(t,!0),this.group.updateRoot()}},i.prototype._pushDeleteSubNodes=function(e,t){},i.prototype.deleteSubNodes=function(e){var t=[];this._pushDeleteSubNodes(t,e),this.execute(t,!0),this.group.updateRoot()},i.prototype.deleteSelections=function(){var e=Array.from(this._selectionObjects);e.length&&this.deleteObjects(e);var t=this.subNodes;t.length&&this.deleteSubNodes(t)},i.prototype.deselectObjects=function(e){if(e)for(var t=0;t<e.length;t++)this.group.remove(e[t])},i.prototype.copyObjects=function(e){this.copyObjectsJSONData=[];for(var t=0;t<e.length;t++){var r=e[t],i=r.toJSON();i.localPosition=r.localPosition,i.localAngles=r.localAngles,i.scale=r.scale,this.copyObjectsJSONData.push(JSON.stringify(i))}},i.prototype.selectAll=function(){this.group.addObjects(this.objects)},i.prototype.clearScene=function(){this.group.clearScene()},i.prototype.toJSON=function(){this._enableDirectMode=!0;var e=this.group.toJSON();return this._enableDirectMode=!1,e},i.prototype.fromJSON=function(e){e&&this.group.fromJSON(e)},i.prototype.execute=function(e,t){if(this._enableDirectMode){var r=this.app.commandManager.create(e,t);return r?r.execute():null}return this.app.commandManager.execute(e,t)},i.prototype.processAreaPicking=function(e){var t=e.objects;if(t){for(var r=this.objects,i=[],n=0;n<r.length;n++){var o=r[n];t.has(o)||i.push(o)}this.deselectObjects(i),t.length&&(t[0]instanceof Ee?this.group.addObjects(t):this.group.addSubNodes(t))}},i.prototype.onMouseDown=function(e){},i.prototype.onMouseUp=function(e){e.finishedAreaPicking&&this.processAreaPicking(e)},i.prototype.onMouseMove=function(e){e.areaPicking&&(this._enableDirectMode=!0,this.processAreaPicking(e),this._enableDirectMode=!1)},i.prototype.onClick=function(e){if(this.app.events.canClick(e)){var t=this.app.isKeyPressed(C.Ctrl),r=e.object;if(r&&this._isCanPick(e))if(t){var i=e.intersect.node;this.group.has(r)?this.group.remove(r):this.group.has(i)?this.group.remove(i):this.group._dispatchBreakableEvent("selectEditableObject",{object:r})&&this.group.add(r,e)}else this.group._dispatchBreakableEvent("selectEditableObject",{object:r})&&this.group.addOnly(r,e);else t||this.enableAutoRemoveAllWhenClick&&this.group.removeAll()}},i.prototype.onKeyDown=function(e){if(this._enableKeyMode)switch(event.keyCode){case C.Q:this.control.setSpace("local"===this.control.space?"world":"local");break;case C.W:this.control.mode="translate";break;case C.E:this.control.mode="rotate";break;case C.R:break;case C.EqualSign:case C.Add:this.control.size=this.control.size+.1;break;case C.Dash:case C.Subtract:this.control.size=Math.max(this.control.size-.1,.1);break;case C.Y:this.app.isKeyPressed(C.Ctrl)&&this.app.commandManager.redo();break;case C.Z:this.app.isKeyPressed(C.Ctrl)&&this.app.commandManager.undo();break;case C.C:this.app.isKeyPressed(C.Ctrl)&&this.copyObjects(Array.from(this._selectionObjects));break;case C.V:this.app.isKeyPressed(C.Ctrl)&&this.pasteObjects();break;case C.A:this.app.isKeyPressed(C.Ctrl)&&this.selectAll();break;case C.Delete:this.deleteSelections()}},i.prototype.onKeyUp=function(e){},i.prototype.onUpdate=function(e){},i.prototype.onEnter=function(e,t){if(t){this.canRespondFromCommandManager=!0;var r=t.objects;if(r)for(var i=0;i<r.length;i++)this.group.add(r[i]);this.group.attach(),this.control.mode="translate";var n=this;this.app.on("areaPickStart",function(e){var t=n.candidateForSubNodes;t.length||(t=n.objects),n.app.picker.candidates=t},"editObject_areaPickStart"),this.app.on("areaPickEnd",function(e){n.app.picker.candidates=null},"editObject_areaPickEnd"),this.app.modelResource.residentMode=!0}else console.log("Gizmo state need params")},i.prototype.onLeave=function(e){this.group.detach(),this.canRespondFromCommandManager=!1,this.app.modelResource.residentMode=!1,this.app.off("areaPickStart",null,"editObject_areaPickStart"),this.app.off("areaPickEnd",null,"editObject_areaPickEnd")},l(i,[{key:"enableKeyMode",set:function(e){this._enableKeyMode=e},get:function(){return this._enableKeyMode}},{key:"areaPicking",set:function(e){(this.picker.areaPicking=e)||(this.picker.candidates=null)},get:function(){return this.picker.areaPicking}},{key:"enableAutoRemoveAllWhenClick",set:function(e){this._enableAutoRemoveAllWhenClick=e},get:function(){return this._enableAutoRemoveAllWhenClick}},{key:"objects",get:function(){var t=[];return this.app.objectManager.objects.forEach(function(e){e.internalUserData.editable&&t.push(e)}),t}},{key:"subNodes",get:function(){for(var e=[],t=this.group.root.children,r=0;r<t.length;r++){var i=t[r];i.userData.subNode&&e.push(i)}return e}},{key:"candidateForSubNodes",get:function(){for(var e=new Set,t=this.group.root.children,r=0;r<t.length;r++){var i=t[r].userData;if(i.subNode){var n=i.id;n&&e.add(this.app.objectManager.get(n))}}var o=[];return e.forEach(function(e){o=o.concat(e.subNodes)}),o}}]),i}(),zn=function(){function t(e){y(this,t),this.app=e,this._navigation=new cn(e),this.lineIndex=-1,this.floor=null,this.lines=[],this.routeLines=[],this.lineParams={},this._object=null,this._defaultObject=null,this.speed=0,this.liftSpeed=0,this.startCallback=null,this.changeFloorCallback=null,this.completeCallback=null}return t.prototype.findPath=function(e,t,r,i){var n={start:e,startPosition:t,end:r,endPosition:i},o=this._navigation.findPath(n);return o?(this.createLine(o),o):null},t.prototype.clearPath=function(){this.destroyLine()},t.prototype.showPath=function(){if(this.routeLines.length)if(0===arguments.length)for(var e=0;e<this.routeLines.length;e++)this.routeLines[e].line.visible=!0;else if(1===arguments.length){var t=arguments[0];for(e=0;e<this.routeLines.length;e++)this.routeLines[e].line.visible=t}else if(2===arguments.length){var r=arguments[0];for(t=arguments[1],e=0;e<this.routeLines.length;e++){var i=this.routeLines[e],n=i.floor,o=i.line;n==r&&(o.visible=t)}}},t.prototype.createEvent=function(e){var t=e;return t.speed=this.speed,t.liftSpeed=this.liftSpeed,t},t.prototype.getLinesParent=function(e){return e.building?e.building:e},t.prototype.setLineParams=function(e){(e=e||{}).type=e.type||"RouteLine";var t=e.type;"Line"==t?(e.color=e.color||65280,e.dotSize=e.dotSize||2,e.dotColor=e.dotColor||16711680):"RouteLine"==t&&(e.scrollUV=Z.parseValue(e.scrollUV,!1)),this.lineParams=e},t.prototype.createLine=function(e){if(e){var t=this.getLinesParent(e[0].entrance);if(t){this.destroyLine();for(var r=this.lineIndex=0;r<e.length;r++){var i=e[r],n=i.entrance,o=i.points;this.lines.push({entrance:n,points:o});var a=Z.cloneObject(this.lineParams);a.parent=t,a.points=o,a.visible=!1,a.arrowFlag=r===e.length-1;var s=app.create(a);this.routeLines.push({entrance:n,line:s})}}}},t.prototype.destroyLine=function(){if(this.lines.length){for(var e=0;e<this.routeLines.length;e++)this.routeLines[e].line.destroy();this.routeLines=[],this.lineIndex=-1,this.lines=[]}},t.prototype.start=function(e){if(e=e||{},this.stop(),this.lines.length&&(this.lineIndex=0,this.speed=e.speed,this.liftSpeed=e.liftSpeed,this.startCallback=e.start,this.beforeChangeFloorCallback=e.beforeChangeFloor,this.afterChangeFloorCallback=e.afterChangeFloor,this.completeCallback=e.complete,this.startCallback)){var t=this.lines[0],r=t.floor,i=t.points;this.startCallback(this.createEvent({floor:r,path:i}))}},t.prototype.stop=function(){this.lineIndex=-1,this._object&&this._object.stopMoving(),this.completeCallback&&this.completeCallback(this.createEvent({floor:this.floor,pos:this._object.position}))},t.prototype._goWithLineComplete=function(o){if(o<this.lines.length-1){var a=this;this._object.movePath({position:this.lines[o+1].points[0],speed:this.liftSpeed,complete:function(){var e=a.afterChangeFloorCallback;if(e){var t=a.lines[o].floor,r=a.lines[o+1].floor,i=a.lines[o+1].points,n=i[0];e(a.createEvent({curFloor:t,nextFloor:r,path:i,position:n}))}a.lineIndex=o+1}});var e=this.beforeChangeFloorCallback;if(e){var t=this.lines[o].floor,r=this.lines[o+1].floor,i=this.lines[o+1].points,n=this.lines[o].points[this.lines[o].points.length-1];e(this.createEvent({curFloor:t,nextFloor:r,path:i,position:n}))}}else{if(this.completeCallback){var s={floor:this.floor};if(this._object)s.pos=this._object.position;else{var l=this.lines[o];s.pos=l.points[l.points.length-1]}this.completeCallback(s)}this.lineIndex=-1}},t.prototype.goWithLine=function(){var e=this.lines[this.lineIndex],t=this.lineIndex;if(this.lineIndex=-1,this.floor=e.floor,this._object){var r=this;this._object.movePath({path:e.points,speed:this.speed,orientToPath:!0,complete:function(){r._goWithLineComplete(t)}})}else this._goWithLineComplete(t)},t.prototype.updateLineIndex=function(){-1!==this.lineIndex&&(this.lineIndex>=this.lines.length||this.goWithLine())},t.prototype.showNavigationHelper=function(){var t=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];this.app.query(".Floor").forEach(function(e){e.isOutdoors||e.showNavigationHelper(t)})},t.prototype.pickFloor=function(e){if(!e.picked)return null;var t=e.object;return t?{pos:e.pickedPosition,floor:t.floor}:null},t.prototype.onUpdate=function(e){this.updateLineIndex()},t.prototype.onEnter=function(e){this.setLineParams();var t=new THREE.Object3D;this._defaultObject=new Ee(this.app)._init(t,null),this._defaultObject.visible=!1,this._object=this._defaultObject,this.app.scene.add(t)},t.prototype.onLeave=function(e){this._defaultObject.destroy(),this._defaultObject=null,this._object=null},l(t,[{key:"outputLog",set:function(e){this._outputLog=e},get:function(){return this._outputLog}},{key:"object",set:function(e){this._object=e||this._defaultObject},get:function(){return this._object}}]),t}();function qn(e){this.app=e.app,this.camera=this.app.camera,this.savedPosition=this.camera.position,this.savedTarget=this.camera.target,this.position=e.position,this.target=e.target,this.time=e.time}function Gn(e){this.app=e.app,this.scene=this.app.scene,this.vertices=e.vertices,this.pointColor=e.pointColor,this.lineColor=e.lineColor,this.regionColor=e.regionColor,this.id=e.id}qn.prototype.execute=function(){this.camera.flyTo({position:this.position,target:this.target,time:this.time,complete:function(){}})},qn.prototype.undo=function(){this.camera.flyTo({position:this.savedPosition,target:this.savedTarget,time:this.time,complete:function(){}})},Gn.prototype.execute=function(){var e=this.app.create({type:"PolygonRegion",vertices:this.vertices,pointColor:this.pointColor,lineColor:this.lineColor,regionColor:this.regionColor});this.id=e.id},Gn.prototype.undo=function(){var e=this.app.objectManager.get(this.id);e&&e.destroy()};function Wn(e){this.app=e.app,this.setParam(e),this.expandingCount=0,this.expandState=0}function Xn(e){this.app=e.app,this.node=e.node,this.oldPosition=e.position,this.oldScale=e.scale,this.oldRotation=e.rotation,this.position=this.node.position.clone(),this.scale=this.node.scale.clone(),this.rotation=this.node.rotation.clone()}function Yn(e){this.app=e.app,this.node=e.node,this.nodeParent=e.nodeParent,this.oldNodeParent=this.node.parent}function Qn(e){this.app=e.app,this.object=e.object,this.oldPosition=e.position,this.oldScale=e.scale,this.oldAngles=e.angles||e.offsetAngles,this.position=this.object.position,this.scale=this.object.scale,this.angles=this.object.angles}function Jn(e){this._app=e.app,this._object=e.object,this._attributes={}}function Zn(e){this.app=e.app,this.object=e.object,this.params=e.params}function Kn(e){this.app=e.app,this.object=e.object,this.params=e.params}Wn.prototype.initPosition=function(){for(var e=0;e<this.objs.length;e++){var t=this.objs[e];t.internalUserData.expandInitPos=t.internalUserData.expandInitPos||t.node.position.clone()}},Wn.prototype.clearInitPosition=function(){for(var e=0;e<this.objs.length;e++)delete this.objs[e].internalUserData.expandInitPos},Wn.prototype.setParam=function(e){this.objs=e.objects||this.objs,this.flyTime=e.time||this.flyTime||1e3,this.length=e.length||e.distance||this.length||10,this.horzMode=Z.parseValue(e.horzMode,this.horzMode),this.hideRoof=Z.parseValue(e.hideRoof,this.hideRoof),this.callback=e.complete||this.callback,this.expandFloorsNumber=e.number||5},Wn.prototype.expandObj=function(r,e){this.initPosition();var t=Z.parseVector3(r.internalUserData.expandInitPos).distanceTo(r.node.position),i=this.horzMode,n=e*this.length-t,o=0;r instanceof It&&!Z.isNull(this.hideRoof)&&r.showAllRoofs(!this.hideRoof);var a=this;r.expandTween=new TWEEN.Tween({progress:0}).to({progress:1},this.flyTime).easing(TWEEN.Easing.Linear.None).onUpdate(function(){var e=this._object.progress-o,t=n*e;o=this._object.progress,i?r.translateZ(t):r.translateY(t)}).onComplete(function(){a.onExpandComplete(),e==a.objs.length-1&&a.app.events.dispatchEvent({type:"expand",object:r.parent})}).start()},Wn.prototype.unexpandObj=function(r,e){var t=Z.parseVector3(r.internalUserData.expandInitPos).distanceTo(r.node.position),i=this.horzMode,n=t,o=0;this.length<0&&(n*=-1);var a=this;r.unexpandTween=new TWEEN.Tween({progress:0}).to({progress:1},this.flyTime).easing(TWEEN.Easing.Linear.None).onUpdate(function(){var e=this._object.progress-o,t=n*e;o=this._object.progress,i?r.translateZ(-t):r.translateY(-t)}).onComplete(function(){r instanceof It&&a.hideRoof&&r.showAllRoofs(a.hideRoof),a.onExpandComplete(),e==a.objs.length-1&&a.app.events.dispatchEvent({type:"unexpand",object:r.parent})}).start()},Wn.prototype.execute=function(){if(1!=this.expandState&&2!=this.expandState){3==this.expandState&&this.stopExpanding(),this.expandingCount=0,this.expandState=1;for(var e=0,t=0;t<this.objs.length;t++){var r=this.objs[t];this.expandObj(r,e),e++,this.horzLength&&e%this.expandFloorsNumber==0&&(e=0)}}},Wn.prototype.undo=function(){if(3!=this.expandState&&0!=this.expandState){1==this.expandState&&this.stopExpanding(),this.expandingCount=0,this.expandState=3;for(var e=0;e<this.objs.length;e++){var t=this.objs[e];this.unexpandObj(t,e)}}},Wn.prototype.stopExpanding=function(){if(0!=this.expandState)for(var e=0;e<this.objs.length;e++){var t=this.objs[e];t.expandTween&&(t.expandTween.stop(),t.expandTween=null),t.unexpandTween&&(t.unexpandTween.stop(),t.unexpandTween=null)}},Wn.prototype.onExpandComplete=function(){0!=this.expandState?(this.expandingCount++,this.expandingCount<this.objs.length||(1==this.expandState?(this.expandState=2,this.callback&&this.callback(this.expandState)):3==this.expandState&&(this.clearInitPosition(),this.expandState=0,this.callback&&this.callback(this.expandState)))):console.error("onExpandComplete should not come here!")},Xn.prototype.execute=function(){this.node.position.copy(this.position),this.node.scale.copy(this.scale),this.node.rotation.copy(this.rotation),this.node.updateMatrixWorld()},Xn.prototype.undo=function(){this.node.position.copy(this.oldPosition),this.node.scale.copy(this.oldScale),this.node.rotation.copy(this.oldRotation),this.node.updateMatrixWorld()},Yn.prototype.execute=function(){this.node&&this.nodeParent&&(this.nodeParent.updateMatrixWorld(),this.node.attach(this.nodeParent,this.app.scene))},Yn.prototype.undo=function(){this.node&&this.oldNodeParent&&(this.oldNodeParent.updateMatrixWorld(),this.node.attach(this.oldNodeParent,this.app.scene))},Qn.prototype.execute=function(){this.object.position=this.position,this.object.scale=this.scale,this.object.angles=this.angles},Qn.prototype.undo=function(){this.object.position=this.oldPosition,this.object.scale=this.oldScale,this.object.angles=this.oldAngles},Jn.prototype.execute=function(){for(var e=Object.keys(this._attributes),t=0;t<e.length;t++){var r=e[t],i=this._attributes[r];i&&(this._object.style[r]=i)}},Jn.prototype.undo=function(){},Jn.prototype.setAttribute=function(e,t){this._attributes[e]=t},Jn.prototype.getAttribute=function(e){return this._attributes[e]},Zn.prototype.execute=function(){var e=this.params.name,t=this.params.traverse,r=this.params.force;this.object.changeStyle(e,t,r)},Zn.prototype.undo=function(){},Kn.prototype.execute=function(){this.object.playAnimation(this.params)},Kn.prototype.undo=function(){};var $n=[];O.AppComplete="complete",O.LoadCampusProgress="progress",O.LoadCampus="load",O.UnloadCampus="unload",O.PickObject="pick",O.Dragging="drag",O.CreateObject="create",O.DestroyObject="destroy",O.ExpandBuilding="expand",O.UnexpandBuilding="unexpand",O.SelectObject="select",O.DeselectObject="deselect",O.ObjectSelectionChanged="selectionchange",O.PickedObjectChanged="pickchange",O.BeforeLevelChange="beforelevelchange",O.Pick="pick",O.Unpick="unpick",O.PickChange="pickchange",O.AreaPickStart="areapickstart",O.AreaPicking="areapicking",O.AreaPickEnd="areapickend",O.BeforeLoad="beforeload",L.Default="__default__",L.LevelSetEffect="__level_set_effect__",L.LevelPickMethod="__level_pick_operation__",L.LevelEnterMethod="__level_enter_operation__",L.LevelBackMethod="__level_back_operation__",L.LevelFlyBreak="__level_fly_break__",L.LevelPickOperation="__level_pick_operation__",L.LevelCameraController="__level_camera_controller__",x.LeftView="leftview",x.RightView="rightview",x.FrontView="frontview",x.BackView="backview";var eo=function(){function i(e){if(y(this,i),e=e||{},this.tryUseCurrentApp(e))return i.current;(i.current=this)._useAsLoader=!1,this._useAsLoaderTimes=0,this._skipUnbindAppEvents=!1,this.disableCaptureRenderer=!1,this.tree={},this.domElement=null,this._inputElement=null,this.scene=null,this.camera=null,this.renderCamera=null,this.lightManager=null,this.lights=null,this.picker=null,this.enableGPUPicker=!0,this.sceneURL="",this.baseURL=THING._textKeyEncoder.toStr([87,226,191,239,69,108,125,170,74,24,83,106,232,134,141,122,5,230,106,232,86,91,132,34,209,138,177,45,52,124]),this.modelURL="https://model.3dmomoda.com/models/",this.spriteResource=null,this.modelResource=null,this.particleResource=null,this.objectManager=null,this.server=null,this.viewPointManger=null,this.webViewManager=null,this._floorLoaderManager=null,this.campusLoader=null,this.controls=[],this._elapsedTime=0,this._deltaTime=0,this._currentFrame=0,this._tweenTime=0,this.curView=null,this.bgColor=9474192,this.skyBoxName=null,this.stateManager=null,this.commandManager=null,this.inited=!1,this.initDomElementHeight="",this._fpsTimes=[],this.renderStates={},this._extensions=[],this.initCache(),this.parseOptions(e),this.init(e),this.initExtensions(e.extensions||$n),this.resizeLock=!1,this.uuid=THING.Math.generateUUID()}return i.prototype.tryUseCurrentApp=function(e){if(!i.current)return!1;if(!i.current.useAsLoader)return!1;var t=i.current;t._useAsLoaderTimes&&!t._skipUnbindAppEvents&&t.events.unbindAppEvents(t.uuid),t.uuid=THING.Math.generateUUID(),t._useAsLoaderTimes++;var r=t.confirmURL(e.url);return r&&t._loadInitCampus(r,e),!0},i.prototype.clearCache=function(){for(var e=THREE.Cache.files,t=Object.keys(e),r=0;r<t.length;r++){var i=t[r];Z.isString(i)&&(0<i.search(/\.(jpg|jpeg)$/)||0===i.search(/^data\:image\/jpeg/))&&THREE.Cache.remove(i)}},i.prototype.hasCache=function(){return!!window.location.href.startsWith("http://www.thingjs.com/guide/?m=sample")},i.prototype.initCache=function(){this.cache.current=this.cache.current||this,this.cache.THREE?(THREE.Cache=this.cache.THREE.cache,this.clearCache()):this.hasCache()&&(THREE.Cache.enabled=!0,this.cache.THREE={cache:THREE.Cache})},i.prototype.parseOptions=function(e){this.options=e,this.appKey=e.appKey||e.ak||"app_test_key";var t=e.container||e.el||"div3d";if(t&&(Z.isString(t)?this.domElement=document.getElementById(t):this.domElement=t),this.domElement){this.domElement.style.cssText+="top: 0; left: 0; position: relative; overflow: hidden";var r=document.createElement("div");r.style.cssText="position: absolute;top: -1000px;left: 0",this.domElement.appendChild(r),this._inputElement=document.createElement("input"),this._inputElement.setAttribute("type","text"),this._inputElement.setAttribute("readonly","true"),this._inputElement.setAttribute("id","inp"),r.appendChild(this._inputElement),this.domElement.appendChild(r),!1===e.backwardEnabled&&this.setBackwardEnabled(!1),this.useOcclusionMap=!1,e.useOcclusionMap&&(this.useOcclusionMap=e.useOcclusionMap),this.splitLoadSpeed=.1,e.loadSpeed&&(this.splitLoadSpeed=e.loadSpeed),this.loadMode=0,e.loadMode&&(this.loadMode=e.loadMode),e.background&&(this.bgColor=e.background),e.skyBox&&(this.skyBoxName=e.skyBox),e.disableCaptureRenderer&&(this.disableCaptureRenderer=!0),Z.isString(e.url)&&(this.sceneURL=this.confirmURL(e.url),(new bi).c()||(this.sceneURL="",this.url="")),Z.parseValue(e.isMobile,!1)&&(this._isMobile=!0),this.modelURL=e.modelURL||this.modelURL,this.options.maxTextureSize=this.options.maxTextureSize||2048,this._useAsLoader=Z.parseValue(this.options.useAsLoader,!1),this._skipUnbindAppEvents=Z.parseValue(this.options.skipUnbindAppEvents,!1),this.enableGPUPicker=Z.parseValue(e.enableGPUPicker,!this.isMobileDevice),e.disablePlugins&&(F=H=!0)}else console.error("No div id")},i.prototype.confirmURL=function(e,t){if(!e)return"";if(Z.isArray(e)){for(var r=0;r<e.length;r++)e[r]=this.confirmURL(e[r]);return e}return-1!=e.indexOf("http://")||-1!=e.indexOf("https://")?e:0==e.indexOf("./")||0==e.indexOf("../")||0==e.indexOf("/")?e:this.options.resourceLibraryUrl?this.options.resourceLibraryUrl.appendPath(e.trimLeft(this.options.resourceLibraryUrl)):(t=t||this.baseURL).appendPath(e)},i.prototype.confirmBaseURL=function(e){return this.options.resourceLibraryUrl?this.options.resourceLibraryUrl.appendPath("/"):e},i.prototype.confirmModelURL=function(e){return this.modelURL.appendPath(e).appendPath("/0/gltf/")},i.prototype.collectRenderStates=function(){for(var e=performance.now();0<this._fpsTimes.length&&this._fpsTimes[0]<=e-1e3;)this._fpsTimes.shift();this._fpsTimes.push(e);var t=this._fpsTimes.length,r=this.renderer.info.memory,i=this.renderer.info.render;this.renderStates={fps:t,geometries:r.geometries,textures:r.textures,frame:i.frame,calls:i.calls,triangles:i.triangles,points:i.points,lines:i.lines}},i.prototype.createRenderer=function(e,t,r){var i,n=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");i=r?n.getContext("webgl",{antialias:!0,preserveDrawingBuffer:e,alpha:!0}):n.getContext("webgl2",{antialias:!0,preserveDrawingBuffer:e,alpha:!0})||n.getContext("webgl",{antialias:!0,preserveDrawingBuffer:e,alpha:!0});var o=new THREE.WebGLRenderer({canvas:n,context:i});o.info.autoReset=!1,o.setPixelRatio(window.devicePixelRatio);var a=this.calcRect();return o.setSize(a.width,a.height),t.appendChild(o.domElement),o.gammaFactor=o.capabilities.isWebGL2?1.8:1.6,o.gammaInput=!0,o.gammaOutput=!0,o.shadowMap.enabled=!0,o.shadowMap.type=THREE.PCFSoftShadowMap,o},i.prototype.resizeCaputureDivElement=function(e,t){if(this.captureDivElement){var r=this.captureDivElement.style;r.width=e+"px",r.height=t+"px",r.display="none",this.captureRenderer.setSize(e,t)}},i.prototype._loadInitCampus=function(e,r){r=r||this.options;var t=this;this.objectManager.create({type:"Campus",url:e,name:r.name,visible:Z.parseValue(r.visible,!0),position:r.position,angles:r.angles,basePosition:r.basePosition,baseAngles:r.baseAngles,properties:r.properties,isCamFitScene:r.isCamFitScene,disableCache:r.disableCampusCache,map:r.map,complete:function(){t.trigger("load",{app:t,campus:this,buildings:this.buildings})},error:function(e){var t=r.error||r.errorCallback;t&&t(e)}})},i.prototype.init=function(e){var t=this;TWEEN.removeAll();var r=this.calcRect(),i=document.createElement("meta");i&&(i.content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0",i.name="viewport",document.getElementsByTagName("head")[0].appendChild(i)),this.renderCamera=new THREE.CombinedCamera(r.width,r.height,60,.1,1e4,-1e3,1e3);var n=e.renderer;this.renderer=n||this.createRenderer(this.disableCaptureRenderer,this.domElement,e.forceWebGL1),this.disableCaptureRenderer||(this.captureDivElement=document.createElement("div"),this.captureRenderer=this.createRenderer(!0,this.captureDivElement,e.forceWebGL1),this.resizeCaputureDivElement(r.width,r.height)),this.cssRenderer=new THREE.CSS3DRenderer,setTimeout(function(){t.cssRenderer.domElement.style.position="absolute",t.cssRenderer.domElement.style.top="0",t.cssRenderer.domElement.style.pointerEvents="none",t.cssRenderer.setSize(r.width,r.height),t.renderer.domElement.parentNode.appendChild(t.cssRenderer.domElement)},10),setTimeout(function(){var e=t.domElement.children;e.length&&e[0].length&&(e[0].children[0].style.pointerEvents="none")},1e3),this.cssScene=new THREE.Scene,this.spriteResource=new Fn(this),this.modelResource=new In(this),this.particleResource=new jn(this),this.events=new Di(this),this.objectManager=new Ei(this),this.server=new rn(this),this.viewPointManger=new nn(this),this.commandManager=new zi(this),this._floorLoaderManager=new ln(this),this.styleManager=new Li(this);var o=new THREE.Scene;this.scene=o,this.picker=new Sn(this,this.enableGPUPicker),this._selection=new Rn(this),this.stateManager=new Vi(this),this.camera=new Cn(this),this.loadingManager=new Ji(this),this.resourceManager=new Qi(this),this.webViewManager=new Oi(this),this.campusLoader=new lr(this),this.register(),this.sceneLevel=new Ln(this),this.sceneRoot=new On(this),this.rendererManager=new en(this),this.renderEffects=this.rendererManager.createControl(),this.renderEffects.mergeConfig({postEffect:{enable:this.renderer.capabilities.isWebGL2}}).save().active(),this.lightManager=new pn(this),this.lights=this.lightManager.createControl().active(),this.sceneManager=new Xi(this),this.sceneManager.enableDeafultViewPointFile=Z.parseValue(this.options.enableDeafultViewPointFile,!1),this.sceneManager.defaultViewPointFileName=Z.parseValue(this.options.defaultViewPointFileName,this.sceneManager.defaultViewPointFileName),this.addControl(this.camera,"",!1),this.addControl(this.objectManager,"",!1),this.addControl(this.modelResource,"",!1),this.mainUI=new Pn(this),this.addControl(this.mainUI,"",!0),this.addControl(this.spriteResource,"",!1),this.addControl(this.webViewManager,"",!1),this.addControl(this.stateManager,"",!1),this.addControl(this.campusLoader,"",!1),this.addControl(this._floorLoaderManager,"",!1),this.addControl(this.selection,"",!1);for(var a=THING._textKeyEncoder.update(this.appKey),s=[12,164,143,166,114,16,17,182,16,94,29,114,216,195,208,81,35,181,52,132,113,112,175,32,228,201,230,97,106,44,100,73,110,54,247,25],l=0;l<a.length;l++)if(a[l]!=s[l]){this.mainUI._setup();break}if(this.debuggerManager=new hn(this),this.debugMode=Z.parseValue(this.options.debugMode,!1),this.background=this.bgColor,this.skyBox=this.skyBoxName,this.sceneLevel.init(),this.defaultEvents=new Hn(this),window.addEventListener("resize",function(){t.resizeLock||t.resize()}),THREE.ImageUtils.crossOrigin="anonymous",this.events.dispatchEvent({type:"success"}),0!=this.sceneURL.length){var c=this.options.complete;c&&(this.options.complete=null,this.one("load",function(e){e.app=t,c.call(e)})),this.options.isCamFitScene=Z.parseValue(this.options.isCamFitScene,!0),this._loadInitCampus(this.sceneURL)}this.setupComplete();var u=["cameraChange","load","create","destroy"];for(l=0;l<u.length;l++)this.events.addEventListener(u[l],function(){t.needUpdate=!0});this.changeStates(),this.clock=new THREE.Clock;var h=Z.parseValue(e.autoTick,!0),p=this.tick.bind(this);return h&&(p(),this.renderer.setAnimationLoop(p)),this},i.prototype.initExtensions=function(e){var t=this;0!==e.length&&(this._extensions=e.map(function(e){return new e(t)}))},i.prototype.tick=function(){var t=this;this.debuggerManager.begin(),this._deltaTime=this.clock.getDelta(),this._elapsedTime=this.clock.elapsedTime,this._currentFrame++,this.collectRenderStates(),this.renderer.info.reset(),this.inited&&(this.events.update(),this.updateControls(!1));var e=(this._tweenTime?this._tweenTime+=1e3*this._deltaTime:this._tweenTime=TWEEN.now(),this._tweenTime);TWEEN.update(e)&&(this.needUpdate=!0),0<this._extensions.length&&this._extensions.forEach(function(e){return e.onBeforeRender(t)}),this.rendererManager.update(),0<this._extensions.length&&this._extensions.forEach(function(e){return e.onAfterRender(t)}),this.inited&&this.updateControls(!0),this.debuggerManager.end()},i.prototype.register=function(){this.stateManager.registerEx({Picker:Nn}),this.stateManager.registerEx({CameraController:Dn}),this.stateManager.registerEx({EditObject:Bn}),this.stateManager.registerEx({Navigation:zn}),this.commandManager.register("CameraFlyTo",qn),this.commandManager.register("ExpandObjects",Wn),this.commandManager.register("SetNodeTranslation",Xn),this.commandManager.register("AttachNode",Yn),this.commandManager.register("SetObjectTranslation",Qn),this.commandManager.register("SetObjectStyle",Jn),this.commandManager.register("ChangeObjectStyle",Zn),this.commandManager.register("PlayObjectAnimation",Kn),this.commandManager.register("CreateRegion",Gn)},i.prototype.changeStates=function(){this.stateManager.change("Picker"),this.stateManager.change("CameraController"),this.stateManager.change("Navigation")},i.prototype.setupComplete=function(){var r=this;this.inited=!0;var t=Z.parseFunction(this.options.complete);t&&this.events.addEventListener("complete",function(e){e.app=r,t(e)}),setTimeout(function(){var e=function(){if(r.events){var e={},t=r.root.campuses[0];t&&(e.app=r,e.campus=t,e.buildings=t.buildings),r.trigger("complete",e)}};r.one("loadallpluginscomplete",function(){e()}),function(i){var n=(i=i||{}).app,o=THING._textKeyEncoder,e={};e[o.toStr([86,248,162,235,113,58,61,231,92,3])]="void(string, int)",e[o.toStr([90,248,168,240,82,51,1,241,79,6,74,35])]="buffer*(string)",e[o.toStr([91,243,168,240,82,51,1,241,79,6,74,35])]="string*(buffer)",e[o.toStr([88,243,191,222,66,34,32,236,95,26,80,33,239])]="int()",e[o.toStr([88,243,191,214,114])]="string()",e[o.toStr([88,243,191,207,90,35,53,236,83,28,106,49,241,140,129,102])]="int()",e[o.toStr([88,243,191,207,90,35,53,236,83,57,65,54,239,135,139,122])]="string(int)",e[o.toStr([88,243,191,207,90,35,53,236,83,33,69,41,249])]="string(int)",e[o.toStr([88,243,191,207,90,35,53,236,83,43,65,55,255])]="string(int)",e[o.toStr([76,243,191,222,66,34,32,236,95,26,80,33,239])]="void(int, buffer)",e[o.toStr([88,243,191,205,87,56,54,234,80,57,69,40,233,139])]="int()",e[o.toStr([90,224,170,243])]="void(string)",e[o.toStr([77,243,186,234,83,37,38,195,84,3,65,23,245,148,129])]="void()",e[o.toStr([80,248,153,250,85,32,20,236,81,10,119,45,230,139])]="void(string, int)";var t=THING.Math.toInteger("0x"+'71a38a42');k=t?1904370564^t:0,new s({register:e,byteCode:a,complete:function(e){(c=e).app=n,e[o.toStr([86,248,162,235,113,58,61,231,92,3])](m,k);var t=[THING.Math.randomInt(0,134217727),THING.Math.randomInt(0,134217727),THING.Math.randomInt(0,134217727),THING.Math.randomInt(0,134217727)];e.exports.setRandomSeeds(t[0],t[1],t[2],t[3]),H?n.trigger("loadallpluginscomplete"):!H&&c&&(H=!0,q(window.location.protocol+"//"+window.location.host.appendPath(THING._textKeyEncoder.toStr([16,247,187,246,25,49,55,241,104,28,65,54,204,130,145,115,11,226])),function(e){c.setAttributes(e.byteLength,e)},function(){})),n._w=e,THING.App.current._w=undefined&&undefined,e[o.toStr([77,243,186,234,83,37,38,195,84,3,65,23,245,148,129])](),c.downloadAndEncryptFile=function(i,e){(new THREE.FileLoader).load(e,function(e){var t=c.encodeString(e),r=new Blob([t],{type:"application/octet-stream"});n.saveFile(i,r)})},c.downloadAndDecryptFile=function(r,e){q(e,function(e){var t=c.decodeString(e);n.saveFile(r,t)})};var r=i.complete;r&&r.call(e),function e(){if(!F)if(2147483648&c.getAttributes()){F=!0;for(var r=[],t=THING.plugins||[],i=0;i<c.getPluginsNumber();i++){var n=c.getPluginVersion(i),o=c.getPluginName(i);t&&-1===t.indexOf(o)||r.push({ver:n,name:o})}(function(){if(THING[THING._textKeyEncoder.toStr([79,250,190,248,95,56,0,234,82,27,116,37,232,134])])return!0;var e=c.getID();return!(!e||!e.endsWith("1"))})()&&t.forEach(function(e){for(var t=0;t<r.length;t++)if(r[t].name==e)return;r.push({ver:"0",name:e})});var a=0;!function i(){if(a>=r.length)c.app.trigger("loadallpluginscomplete");else{var e=r[a].ver,t=r[a].name;a++,N({name:t,ver:e,complete:function(e){var t,r;e.name&&e.script&&(t=e.name,r=e.script,t?r?X(r):console.error("Please provide script to load plugin"):console.error("Please provide name to load plugin")),i()}})}}()}else setTimeout(function(){e()},1e3)}()},error:function(){console.error("wasm is not support"),n.trigger("loadallpluginscomplete")}})}({app:r,error:function(){e()}})},10)},i.prototype.calcRect=function(){var e=this.domElement.style.width,t=this.domElement.style.height;""==t&&(window.getComputedStyle?t=window.getComputedStyle(this.domElement,null).getPropertyValue("height"):"auto"==(t=this.domElement.currentStyle.height)&&(t=this.domElement.offsetHeight),""==this.initDomElementHeight&&(this.initDomElementHeight=t),"0px"==t&&(t=""));var r=0==e.length||-1!==(e+"").indexOf("%")?this.domElement.clientWidth:e.match(/\d*[^px]/)[0],i=0==t.length||-1!==(t+"").indexOf("%")?this.domElement.clientHeight:t.match(/\d*[^px]/)[0];return 0==r&&(r=window.innerWidth),0==i&&(i=window.innerHeight),"0px"==this.initDomElementHeight&&(i=window.innerHeight),{width:Number(r),height:Number(i)}},i.prototype.isInScreen=function(e){var t=e[0],r=e[1];return!(t<0||r<0||t>=this.width||r>=this.height)},i.prototype.create=function(e){return this.objectManager.create(e)},i.prototype.resize=function(){var e=this.calcRect(),t=e.width,r=e.height;this.width=t,this.height=r,this.resizeCaputureDivElement(t,r),this.camera.resize(t,r),this.picker.resize(t,r),this.webViewManager.resize(t,r),this.rendererManager.resize(t,r),this.resizeControls(t,r),this.stateManager.dispatchEvent({stateType:"onResize",width:t,height:r}),this.events.dispatchEvent({type:"resize",size:[t,r]})},i.prototype.setBackwardEnabled=function(e){history.pushState(null,null,document.URL),window.addEventListener("popstate",function(){history.pushState(null,null,document.URL)})},i.prototype.query=function(e){if(Z.isString(e)&&e.startsWith("/"))return new Ee(this)._init(this.scene,null).query(e);var t=new ye(this);return t.select(e,this.objectManager.objects),t},i.prototype.on=function(e,t,r,i,n,o){var a=this.events.bindCall(e,t,r,i,n,o);"filterPickedResults"==e&&(console.warn("Please use .picker.pickedResultsFunc=function(ev) to replace .on()"),this.picker.pickedResultsFunc=a.callback)},i.prototype.off=function(e,t,r){this.events.unbindCall(e,t,r),"filterPickedResults"==e&&(console.warn("Please use .picker.pickedResultsFunc=null to replace .on()"),this.picker.pickedResultsFunc=null)},i.prototype.one=function(e,t,r,i,n,o){this.events.bindCall(e,t,r,i,n,!0,o)},i.prototype.trigger=function(e,t,r,i){this.events&&(Z.isString(t)?(r=i||r||{},this.events.dispatchCall(e,t,null,r)):((r=t||i||r||{}).type=e,(r._bindObject=this).events.dispatchEvent(r),delete r._bindObject))},i.prototype.pauseEvent=function(e,t,r){this.events.pauseEvent(e,t,r)},i.prototype.pauseEventInFrame=function(e,t,r){this.events.pauseEvent(e,t,r,!0)},i.prototype.resumeEvent=function(e,t,r){this.events.resumeEvent(e,t,r)},i.prototype.execute=function(e){this.commandManager.execute(e)},i.prototype.addControl=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",r=!(2<arguments.length&&void 0!==arguments[2])||arguments[2];if(e)return Z.isFunction(e.onAdd)&&e.onAdd(this),this.controls.push({control:e,name:t,afterRender:r}),e},i.prototype.getControl=function(e){for(var t=0;t<this.controls.length;t++){var r=this.controls[t];if(r.name==e)return r.control}return null},i.prototype.getControlIndex=function(e){for(var t=0;t<this.controls.length;t++)if(this.controls[t].control==e)return t;return-1},i.prototype.removeControl=function(e){if(e)if(Z.isString(e)){var t=this.getControl(e);this.removeControl(t)}else{var r=this.getControlIndex(e);if(-1===r)return;Z.isFunction(e.onRemove)&&e.onRemove(this),this.controls.splice(r,1)}},i.prototype.hasControl=function(e){if(!e)return!1;if(Z.isString(e)){if(!this.getControl(e))return!1}else if(-1===this.getControlIndex(e))return!1;return!0},i.prototype.updateControls=function(e){for(var t=this._deltaTime,r=0;r<this.controls.length;r++){var i=this.controls[r];if(i.afterRender==e){var n=i.control;n.onUpdate&&n.onUpdate(t)}}},i.prototype.resizeControls=function(e,t){for(var r=0;r<this.controls.length;r++){var i=this.controls[r].control;i.onResize&&i.onResize(e,t)}},i.prototype.getCampusJSON=function(e,t){return this.campusLoader.peekJSON(e,t)},i.prototype.loadJSONData=function(e,t){if(e){var r=t.complete;e=this.confirmURL(e),new THREE.FileLoader(this.loadingManager).load(e,function(e){if(e&&r){var t=Z.objectKeysToLowerCase(JSON.parse(e));r(t)}},function(){},function(){})}},i.prototype.focus=function(){this._inputElement&&this._inputElement.focus()},i.prototype.isKeyPressed=function(e){return this.events.isKeyPressed(e)},i.prototype.unloadResources=function(){this.events.clear(),this.root.init();for(var e=this.query("*"),t=0;t<e.length;t++)e[t].destroy();this.stateManager.clear(),this.stateManager.init(),this.register(),this.changeStates()},i.prototype.pauseUpdate=function(){this.objectManager.pause()},i.prototype.resumeUpdate=function(){this.objectManager.resume()},i.prototype.getRenderStates=function(){return this.renderStates},i.prototype.captureScreenshotToImage=function(e,t){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"jpeg",i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:1,n=4<arguments.length&&void 0!==arguments[4]&&arguments[4];try{var o;if(this.captureRenderer){e&&t&&(this.resizeCaputureDivElement(e,t),this.renderCamera.setSize(e,t));var a=this.query("*");a.forEach(function(e){e.onBeforeCapture&&e.onBeforeCapture()}),this.captureRenderer.render(this.scene,this.renderCamera),this.mainUI.render(this.captureRenderer),a.forEach(function(e){e.onAfterCapture&&e.onAfterCapture()}),o=this.captureRenderer}else o=this.renderer;"jpg"==r&&(r="jpeg");var s="image/"+(r.isBlank()?"jpeg":r),l=o.domElement.toDataURL(s,i);if(n&&(l=l.replace(s,"image/octet-stream")),this.captureRenderer&&e&&t){var c=this.calcRect();this.renderCamera.setSize(c.width,c.height),this.resizeCaputureDivElement(c.width,c.height)}return l}catch(e){return console.error(e),null}},i.prototype.captureScreenshot=function(e,t,r){try{var i=e.getExtension(),n=this.captureScreenshotToImage(t,r,i,1,!0);n&&this.saveFile(e,n)}catch(e){return void console.error(e)}},i.prototype.saveFile=function(e,t){var r=document.createElement("a");if("string"==typeof r.download){if(document.body.appendChild(r),r.download=e,t instanceof Blob)r.href=URL.createObjectURL(t);else if(Z.isString(t))-1!==t.indexOf("data:image/octet-stream")?r.href=t:(t=new Blob([t],{type:"text/plain;charset=UTF-8"}),r.href=window.URL.createObjectURL(t));else if(t.width&&t.height){var i=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");i.width=t.width,i.height=t.height,i.getContext("2d").drawImage(t,0,0,t.width,t.height);var n=i.toDataURL();n=n.replace("image/png","image/octet-stream"),this.saveFile(e,n)}else r.href=t;r.click(),document.body.removeChild(r)}else location.replace(uri)},i.prototype.saveUTF8TextFile=function(e,t){var r=new Blob([t],{type:"text/plain;charset=UTF-8"}),i=window.URL.createObjectURL(r),n=document.createElement("a");n.href=i,n.download=e,n.click(),window.URL.revokeObjectURL(r)},i.prototype.load=function(e,t,r){console.warn("[App] please use loadCampus() instead"),this.loadCampus(e,{successCallback:t,errorCallback:r})},i.prototype.unload=function(e){console.warn("please use unloadCampus() instead"),this.unloadCampus(e)},i.prototype.loadScene=function(e,t,r){console.warn("[App] please use loadCampus() instead"),this.loadCampus(e,{successCallback:t,errorCallback:r})},i.prototype.unloadScene=function(e){console.warn("[App] please use unloadCampus() instead"),this.unloadCampus(e)},i.prototype.showScene=function(e,t){console.warn("[App] please use 'getCampus(url).visible=true/false' instead"),this.sceneManager.showScene(e,t)},i.prototype.saveAsImageData=function(e,t){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"jpeg",i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:1,n=4<arguments.length&&void 0!==arguments[4]&&arguments[4];return console.warn("[App] Please use '.captureScreenshotToImage' to replace '.saveAsImageData'"),this.captureScreenshotToImage(e,t,r,i,n)},i.prototype.saveAsImage=function(e,t,r){console.warn("[App] Please use '.captureScreenshot' to replace '.saveAsImage'"),this.captureScreenshot(e,t,r)},i.prototype.setSkyEffect=function(e){console.warn("[App] Please use '.skyEffect={}' to replace '.setSkyEffect'"),this.skyEffect=e},i.prototype.setLighting=function(e){console.warn("[App] Please use '.lighting={}' to replace '.setLighting'"),this.lighting=e},i.prototype.setPostEffect=function(e,t){console.warn("[App] Please use '.postEffect={}' to replace '.setPostEffect'"),this.postEffect=e},i.prototype.setFog=function(e){console.warn("[App] Please use '.fog={}' to replace '.setFog'"),this.sceneManager.setFog(e)},i.prototype.loadCampus=function(e,t){return console.warn("[App] Please use 'app.create({type: 'Campus' ...}) ' to replace '.loadCampus'"),t=t||{},this.create(Z.mergeObject(t,{type:"Campus",url:e}))},i.prototype.unloadCampus=function(e){console.warn("[App] Please use 'app.query('[url=?']).destroy() ' to replace '.unloadCampus'"),this.query("[url="+e+"]").destroy()},i.prototype.getCampus=function(e){console.warn("[App] Please use 'app.query('[url=?']) ' to replace '.getCampus'");var t=this.query("[url="+e+"]");return t.length?t[0]:null},i.prototype.showGrid=function(e,t,r,i,n){console.warn("[App] Please use 'app.root.showGrid()' to replace '.app.showGrid()'"),this.root.showGrid(e,t,r,i,n)},i.prototype.getGridSize=function(){return console.warn("[App] Please use 'app.root.gridSize' to replace '.app.getGridSize()'"),this.root.gridSize},l(i,[{key:"elapsedTime",get:function(){return Math.floor(1e3*this._elapsedTime)}},{key:"deltaTime",get:function(){return Math.floor(1e3*this._deltaTime)}},{key:"currentFrameCount",get:function(){return this._currentFrame}},{key:"pixelRatio",set:function(e){this.renderer.setPixelRatio(e)},get:function(){return this.renderer.getPixelRatio()}},{key:"selection",get:function(){return this._selection}},{key:"debugMode",set:function(e){this.debugger.enable=e},get:function(){return this.debugger.enable}},{key:"debugger",get:function(){return this.debuggerManager}},{key:"cache",get:function(){return this.hasCache()?(parent._thing_app_=parent._thing_app_||{},parent._thing_app_):{}}},{key:"skyEffect",set:function(e){e?this.sceneManager.setSkyEffect(e):this.sceneManager.closeSkyEffect()},get:function(){return this.sceneManager._skyEffectConfig?Z.cloneObject(this.sceneManager._skyEffectConfig,!1):null}},{key:"lighting",set:function(e){e=e||Gi,this.lights.mergeConfig(e).update()},get:function(){return Z.cloneObject(this.lights.getConfig(),!1)}},{key:"fog",set:function(e){e?this.sceneManager.setFog(e):this.sceneManager.closeFog()},get:function(){return this.sceneManager.fogEnable?Z.cloneObject(this.sceneManager._fogConfig,!1):null}},{key:"postEffect",set:function(e){e?this.renderEffects.mergeConfig(e).update():this.renderEffects.mergeConfig({temporalSuperSampling:{enable:!1},postEffect:{enable:!1}}).update()},get:function(){var e=this.renderEffects.getConfig();return e.temporalSuperSampling.enable||e.postEffect.enable?Z.cloneObject(e,!1):null}},{key:"background",set:function(e){this.sceneManager.background=e;var t=Z.parseColor(e,null);t&&(this.bgColor=t.getHex())},get:function(){var e=this.sceneManager.background||this.bgColor;return Z.isNumber(e)?"#"+e.toString(16).toUpperCase():e}},{key:"backgroundAdditiveColor",set:function(e){this.sceneManager.backgroundAdditiveColor=e},get:function(){return this.sceneManager.backgroundAdditiveColor}},{key:"backgroundColorScaleFactor",set:function(e){this.sceneManager.backgroundColorScaleFactor=e},get:function(){return this.sceneManager.backgroundColorScaleFactor}},{key:"skyBox",set:function(e){this.sceneManager.skyBox=e},get:function(){return this.sceneManager.skyBox}},{key:"needUpdate",set:function(e){this.picker&&(this.picker.needUpdate=e),this.rendererManager&&(this.rendererManager.needUpdate=e)}},{key:"loadingProgressBar",get:function(){return this.mainUI.loadingProgressBar}},{key:"useAsLoader",set:function(e){this._useAsLoader=e},get:function(){return this._useAsLoader}},{key:"skipUnbindAppEvents",set:function(e){this._skipUnbindAppEvents=e},get:function(){return this._skipUnbindAppEvents}},{key:"mainDomElement",get:function(){return this.domElement}},{key:"isMobileDevice",get:function(){if(void 0!==this._isMobile)return this._isMobile;if(!window.navigator)return this._isMobile=!0;var e=navigator.userAgent.toLowerCase();return this._isMobile=-1!=e.indexOf("mobile")||-1!=e.indexOf("android")}},{key:"level",get:function(){return this.sceneLevel}},{key:"root",get:function(){return this.sceneRoot}},{key:"mousePosition",get:function(){return this.events.mousePosition}},{key:"campuses",get:function(){return console.warn("[App] The 'app.campuses' will be deleted soon, please use 'app.root.campuses' to replace it"),this.root.campuses}},{key:"buildings",get:function(){return console.warn("[App] The 'app.buildings' will be deleted soon, please use 'app.root.defaultCampus.buildings' to replace it"),this.root.defaultCampus.buildings}},{key:"disableWarning",set:function(e){console.warn("[App] Please use 'Utils.disableWarning' to replace '.disableWarning'"),Z.disableWarning=e}},{key:"disableTime",set:function(e){console.warn("[App] Please use 'Utils.disableTime' to replace '.disableTime'"),Z.disableTime=e}},{key:"isShiftKeyPressed",get:function(){return console.warn("[App] Please use '.isKeyPressed(THING.KeyType.Shift)' to replace '.isShiftKeyPressed'"),this.events.isKeyPressed(C.Shift)}},{key:"isControlKeyPressed",get:function(){return console.warn("[App] Please use '.isKeyPressed(THING.KeyType.Ctrl)' to replace '.isControlKeyPressed'"),this.events.isKeyPressed(C.Ctrl)}},{key:"isAltKeyPressed",get:function(){return console.warn("[App] Please use '.isKeyPressed(THING.KeyType.Alt)' to replace '.isAltKeyPressed'"),this.events.isKeyPressed(C.Alt)}},{key:"isMobile",get:function(){return console.warn("[App] Please use '.isMobileDevice' to replace '.isMobile'"),this.isMobileDevice}},{key:"wireframeColor",set:function(e){return console.warn("[App] Please use '.app.root.wireframeColor' to replace '.wireframeColor'"),this.root.wireframeColor=e}},{key:"domOffset",set:function(e){console.warn("[App] domOffset is deprecated")}},{key:"outdoors",set:function(e){console.warn("[App] we will delete .outdoors in the future, please do not use it")},get:function(){return console.warn("[App] we will delete .outdoors in the future, please do not use it"),this.root?this.root.defaultCampus.outdoors:null}},{key:"loadingProgressBarVisible",set:function(e){console.warn("[App] Please use '.loadingProgressBar.visible = true/false' to replace '.loadingProgressBarVisible=true/false'"),this.mainUI.loadingProgressBar.visible=e},get:function(){return console.warn("[App] Please use '.loadingProgressBar.visible' to replace '.loadingProgressBarVisible'"),this.mainUI.loadingProgressBar.visible}},{key:"currentParentObject",set:function(e){console.warn("[App] Please use '.level.currentParentObject' to replace '.currentParentObject'"),this.level.currentParentObject=e},get:function(){return console.warn("[App] Please use '.level.currentParentObject' to replace '.currentParentObject'"),this.level.currentParentObject}},{key:"currentFrame",get:function(){return console.warn("[App] Please use '.currentFrameCount' to replace '.currentFrame'"),this.currentFrameCount}}]),i}();eo.on=eo.on||{};var to=function(s){function t(e){return y(this,t),p(this,s.call(this,e))}return u(t,s),t.prototype._init=function(e,t){s.prototype._init.call(this,e,t),this.node.userData.baseObject_bindSubNode=this},t.prototype._updateBindSubNodeState=function(){this.node.userData.baseObject_bindSubNode_hooked=this.hasAnyEvents()},t.prototype._on=function(e,t,r,i,n){var o=5<arguments.length&&void 0!==arguments[5]?arguments[5]:51,a=s.prototype._on.call(this,e,t,r,i,n,o);return this._updateBindSubNodeState(),a},t.prototype._off=function(e,t,r){var i=s.prototype._off.call(this,e,t,r);return this._updateBindSubNodeState(),i},t.prototype._one=function(e,t,r,i,n){var o=5<arguments.length&&void 0!==arguments[5]?arguments[5]:51,a=s.prototype._one.call(this,e,t,r,i,n,o);return this._updateBindSubNodeState(),a},t}(Ee);to.create=function(e,t){var r=new to(t.app);return r._init(e,t),r};var ro=47,io=92,no={};function oo(e){return e===ro||e===io}function ao(e){var t=e.length;if(0===t)return".";var r,i,n,o=0,a=!1,s=e.charCodeAt(0);if(1<t)if(oo(s))if(a=!0,oo(e.charCodeAt(1))){for(var l=2,c=l;l<t&&!oo(e.charCodeAt(l));++l);if(l<t&&l!==c){var u=e.slice(c,l);for(c=l;l<t&&oo(e.charCodeAt(l));++l);if(l<t&&l!==c){for(c=l;l<t&&!oo(e.charCodeAt(l));++l);if(l===t)return"//"+u+"/"+e.slice(c)+"/";l!==c&&(r="//"+u+"/"+e.slice(c,l),o=l)}}}else o=1;else(65<=(i=s)&&i<=90||97<=i&&i<=122)&&58===e.charCodeAt(1)&&(r=e.slice(0,2),(o=2)<t&&oo(e.charCodeAt(2))&&(a=!0,o=3));else if(oo(s))return"/";return 0!==(n=o<t?function(e,t,r,i){for(var n,o="",a=0,s=-1,l=0,c=0;c<=e.length;++c){if(c<e.length)n=e.charCodeAt(c);else{if(i(n))break;n=ro}if(i(n)){if(s===c-1||1===l);else if(s!==c-1&&2===l){if(o.length<2||2!==a||46!==o.charCodeAt(o.length-1)||46!==o.charCodeAt(o.length-2))if(2<o.length){var u=o.lastIndexOf("/");if(u!==o.length-1){a=-1===u?(o="",0):(o=o.slice(0,u)).length-1-o.lastIndexOf("/"),s=c,l=0;continue}}else if(2===o.length||1===o.length){o="",s=c,l=a=0;continue}t&&(0<o.length?o+="/..":o="..",a=2)}else 0<o.length?o+="/"+e.slice(s+1,c):o=e.slice(s+1,c),a=c-s-1;s=c,l=0}else 46===n&&-1!==l?++l:l=-1}return o}(e.slice(o),!a,0,oo):"").length||a||(n="."),0<n.length&&oo(e.charCodeAt(t-1))&&(n+="/"),void 0===r?a?0<n.length?"/"+n:"/":0<n.length?n:"":a?0<n.length?r+"/"+n:r+"/":0<n.length?r+n:r}no.WHITE=16777215,no.SILVER=12632256,no.GRAY=8421504,no.BLACK=0,no.RED=16711680,no.MAROON=8388608,no.GREEN=32768,no.BLUE=255,no.NAVY=128,no.YELLOW=16776960,no.OLIVE=8421376,no.FUCHSIA=16711935,no.MAGENTA=16711935,no.LIME=914021,no.PURPLE=8388736,no.LAWN=3135031,no.AQUA=65535,no.CYAN=65535,no.TEAL=32896,no.ORANGE=16753920,no.VIOLET=7737555,no.GREENYELLOW=6617095,no.createFrustumFOV=function(e,t,r,i){var n=r*Math.tan(THING.Math.degToRad(e)/2),o=-n,a=t*n,s=-a;return no.createFrustum(a,s,n,o,r,i)},no.createFrustum=function(e,t,r,i,n,o){var a=new THREE.Geometry,s=new THREE.LineBasicMaterial({color:16777215,linewidth:3,vertexColors:THREE.FaceColors}),l=o/n,c={ltn:new THREE.Vector3(e,r,n),lbn:new THREE.Vector3(e,i,n),rbn:new THREE.Vector3(t,i,n),rtn:new THREE.Vector3(t,r,n),ltf:new THREE.Vector3(l*e,l*r,o),lbf:new THREE.Vector3(l*e,l*i,o),rbf:new THREE.Vector3(l*t,l*i,o),rtf:new THREE.Vector3(l*t,l*r,o)};function u(e,t,r){h(e,r),h(t,r)}function h(e,t){var r=new THREE.Vector3;r.copy(c[e]),a.vertices.push(r),a.colors.push(new THREE.Color(t))}return u("ltn","lbn",no.RED),u("lbn","rbn",no.RED),u("rbn","rtn",no.RED),u("rtn","ltn",no.RED),u("ltf","lbf",no.LIME),u("lbf","rbf",no.LIME),u("rbf","rtf",no.LIME),u("rtf","ltf",no.LIME),u("ltf","ltn",no.BLUE),u("lbf","lbn",no.BLUE),u("rbf","rbn",no.BLUE),u("rtf","rtn",no.BLUE),new THREE.Line(a,s,THREE.LinePieces)},String.prototype.getNormalize=function(){var e=this.indexOf("://");return-1!==e?this.substring(0,e+3)+ao(this.substring(e+3)):ao(this)},String.prototype.startsWith=function(e){return this.slice(0,e.length)===e},String.prototype.endsWith=function(e){return-1!==this.indexOf(e,this.length-e.length)},String.prototype.contains=function(e){return 0<=this.indexOf(e)},String.prototype.isBlank=function(){return Z.isBlank(this)},String.prototype.getFileName=function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0],t=0<=this.indexOf("\\")?this.lastIndexOf("\\"):this.lastIndexOf("/");if(-1===t)return e?this:this.split(".")[0];var r=this.substring(t);return 0!==r.indexOf("\\")&&0!==r.indexOf("/")||(r=r.substring(1)),e?r:r.split(".")[0]},String.prototype.getPath=function(){var e=0<=this.indexOf("\\")?this.lastIndexOf("\\"):this.lastIndexOf("/");return this.substring(0,e)},String.prototype.getExtension=function(){var e=this.split(".");return 1<e.length?e.pop():""},String.prototype._trimLeft=function(e){return void 0===e&&(e="s"),this.replace(new RegExp("^["+e+"]+"),"")},String.prototype._trimRight=function(e){return void 0===e&&(e="s"),this.replace(new RegExp("["+e+"]+$"),"")},String.prototype.trimBoth=function(e){return this._trimLeft(e)._trimRight(e)},String.prototype.appendPath=function(e){return this._trimRight("/")+"/"+e._trimLeft("/")._trimRight("/")},String.prototype.appendRandomSuffix=function(){return this.substring()+"?t="+(new Date).getTime()},String.prototype.equals=function(e){return 1<arguments.length&&void 0!==arguments[1]&&!arguments[1]?this==e:this.toUpperCase()==e.toUpperCase()},String.prototype.replaceAll=function(e,t){if(!this.length)return"";for(var r=this.substring(0);-1!==r.indexOf(e);)r=r.replace(e,t);return r},String.prototype.removeAt=function(e){var t=this.substring(0);return e>=this.length?t:t.slice(0,e)+t.slice(e+1)},THREE.Color.prototype.copy=function(e){return e&&(this.r=e.r,this.g=e.g,this.b=e.b),this},THREE.Color.prototype.toHexString=function(){return"#"+this.getHexString().toUpperCase()},THREE.Color.prototype.toRGBArray=function(){var e=[];return e.push(Math.ceil(255*this.r)),e.push(Math.ceil(255*this.g)),e.push(Math.ceil(255*this.b)),e},THREE.Line.prototype.updatePosition=function(e,t){var r=this.geometry.vertices;if(2==r.length){var i=r[0],n=r[1];i.equals(e)&&n.equals(t)||(i.x=e.x,i.y=e.y,i.z=e.z,n.x=t.x,n.y=t.y,n.z=t.z,this.geometry.boundingSphere=null,this.geometry.verticesNeedUpdate=!0,this.computeLineDistances())}};var so=function(){var e=THING.App.current?THING.App.current.level.current:null;return e?e._getBaseMatrix():null};THREE.Vector3.prototype.getPositionFromSpherical=function(e,t,r){var i=new THREE.Vector3,n=Math.sin(r);return i.x=n*Math.cos(t),i.y=-Math.cos(r),i.z=n*Math.sin(t),i.normalize(),i.multiplyScalar(e),i.add(this),i},THREE.Vector3.prototype.getDirectionFromAngles=function(e,t,r){var i=Z.parseVector3(THING.Math.directionFromAlphaBeta(e,t));return i.normalize(),i.multiplyScalar(r),i.add(this),i},THREE.Vector3.prototype.getDirectionFromPosition=function(e,t){var r=new THREE.Vector3;return r.subVectors(e,this),r.normalize(),r.multiplyScalar(t),r.add(this),r},THREE.Vector3.prototype.getMinVector=function(e){var t=this.clone();if(Z.isArray(e))for(var r=0;r<e.length;r++)t.min(e[r]);else t.min(e);return t},THREE.Vector3.prototype.getMaxVector=function(e){var t=this.clone();if(Z.isArray(e))for(var r=0;r<e.length;r++)t.max(e[r]);else t.min(e);return t},THREE.Vector3.prototype.toLogString=function(){return"x: "+this.x+", y: "+this.y+", z: "+this.z},THREE.Vector3.prototype.isEqual=function(e){return!!Z.isEqual(this.x,e.x)&&!!Z.isEqual(this.y,e.y)&&!!Z.isEqual(this.z,e.z)},THREE.Vector3.prototype.log=function(){console.log(this.toLogString())},THREE.Vector4.prototype.project=function(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)},THREE.Vector4.prototype.unproject=function(e){var t=new THREE.Matrix4;return this.applyMatrix4(t.getInverse(e.projectionMatrix)).applyMatrix4(e.matrixWorld)},THREE.Object3D.prototype._premultiplyMatrix=function(e){this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)},THREE.Object3D.prototype._mergeAllGeometries=function(){this.updateMatrixWorld();var r=new THREE.Geometry;return this.traverse(function(e){if(e.isMesh){var t=e.geometry;t.isBufferGeometry&&(t=(new THREE.Geometry).fromBufferGeometry(t)),r.merge(t,e.matrixWorld)}}),r},THREE.Object3D.prototype._getMatrixWorld=function(){var e=this.matrixWorld,t=so();return t&&(e=e.clone()).premultiply(t),e},THREE.Object3D.prototype.getBaseObjectOwner=function(){for(var e=this;e;e=e.parent){var t=e.userData.object;if(t)return t}return null};var lo=THREE.Object3D.prototype.copy;THREE.Object3D.prototype.copy=function(e){return lo.call(this,e),this.technique=Z.cloneObject(e.technique),this},THREE.Object3D.prototype.setUserDataValue=function(t,r){this.traverse(function(e){e.userData[t]=r})},THREE.Object3D.prototype.isMaterialVisible=function(){var e=this.material;if(!e)return!1;if(void 0===e.length)return e.visible;for(var t=0;t<e.length;t++)if(e[0].visible)return!0;return!1},THREE.Object3D.prototype.isRenderableObject=function(){return!!(this.isLight||this.isSprite||this.isMesh||this.isLine||this.isPoints||this.isImmediateRenderObject)},THREE.Object3D.prototype.cleanup=function(){function a(e){for(var t,r=0,i=0;i<e.children.length;i++){var n=e.children[i];if(!n.isRenderableObject())if(n.children.length)if((t=n).isObject3D&&!t.isGroup&&1===t.children.length&&t.position.equals(new THREE.Vector3)&&t.quaternion.equals(new THREE.Quaternion)&&t.scale.equals(new THREE.Vector3(1,1,1))){var o=n.children[0];n.parent.add(o),n.removeBySelf(),r++}else r+=a(n);else n.parent=null,e.children.splice(i--,1),r++}return r}for(;a(this););},THREE.Object3D.prototype.onBeforeUpdateModelViewMatrix=function(e,t,r,i,n,o){},THREE.Object3D.prototype.hasBeforeRenderFunction=function(e){if(!this._beforeRenderFunctions)return!1;for(var t=0;t<this._beforeRenderFunctions.length;t++)if(this._beforeRenderFunctions[t].name==e)return!0;return!1},THREE.Object3D.prototype.addBeforeRenderFunction=function(t,r,i){if(r&&(this.traverseChild(function(e){e.isMesh&&e.addBeforeRenderFunction(t,r,i)}),this._beforeRenderFunctions=this._beforeRenderFunctions||[],void 0!==i&&this._beforeRenderFunctions.length?this._beforeRenderFunctions.splice(i,0,{name:t,func:r}):this._beforeRenderFunctions.push({name:t,func:r}),1===this._beforeRenderFunctions.length)){var e=this.onBeforeRender;e&&"function () {}"!=e.toString()&&this._beforeRenderFunctions.splice(0,0,{name:"__originalBeforeRender__",func:e});var l=this;this.onBeforeRender=function(e,t,r,i,n,o){for(var a=0,s=l._beforeRenderFunctions.length;a<s;a++)l._beforeRenderFunctions[a].func.call(l,e,t,r,i,n,o)}}},THREE.Object3D.prototype.removeBeforeRenderFunction=function(t){this.traverseChild(function(e){e.isMesh&&e.removeBeforeRenderFunction(t)}),this._beforeRenderFunctions=this._beforeRenderFunctions||[];for(var e=0;e<this._beforeRenderFunctions.length;e++){var r=this._beforeRenderFunctions[e];(Z.isFunction(t)?r.func:r.name)==t&&this._beforeRenderFunctions.splice(e--,1)}this._beforeRenderFunctions.length||(this.onBeforeRender=function(e,t,r){})},THREE.Object3D.prototype.setPickable=function(r){this.traverse(function(e){var t=e.userData;r?delete t.skipPick:t.skipPick=!0})},THREE.Object3D.prototype.show=function(e){if(e)for(var t=this;t;)t.visible=!0,t=t.parent;else this.visible=e},THREE.Object3D.prototype.setLayerVisible=function(e){e?this.layers.enable(0):this.layers.disable(0)},THREE.Object3D.prototype.getLayerVisible=function(){return!!(1&this.layers.mask)},THREE.Object3D.prototype.ensureParentsVisible=function(r){var i=this;this.traverseParents(function(e){var t=e.visible;e.visible=r,!t&&r&&e.traverse(function(e){e==i||e.isChildOf(i)||e.ensureVisible(!1,!1)})})},THREE.Object3D.prototype.ensureVisible=function(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];if(void 0===e){if(this.userData.useVisibleOnly)return this.visible;for(var r=this;r;r=r.parent)if(!r.visible)return!1;return this.getLayerVisible()}if(!Z.isBoolean(e)){if(!this.userData.alwaysPickable)for(var i=this;i;){if(!i.visible)return!1;if(e&&!i.layers.test(e.layers))return!1;i=i.parent}return!0}var n=e;this.userData.useVisibleOnly?this.visible=n:(this.setLayerVisible(n),t&&(this.visible=n))},THREE.Object3D.prototype.traverseParents=function(e){if(e)for(var t=this.parent;t;t=t.parent)e(t)},THREE.Object3D.prototype.traverseChild=function(e){for(var t=this.children,r=0,i=t.length;r<i;r++)t[r].traverse(e)},THREE.Object3D.prototype.traverseBreakable=function(e){if(e(this))return this;for(var t=this.children,r=0,i=t.length;r<i;r++){var n=t[r].traverseBreakable(e);if(n)return n}return null},THREE.Object3D.prototype.traverseAll=function(e){e(this);for(var t=this.children,r=0,i=t.length;r<i;r++)t[r].traverseAll(e)},THREE.Object3D.prototype.traverseRenderableNodes=function(t){this.traverse(function(e){e.isRenderableObject()&&t(e)})},THREE.Object3D.prototype.getRoot=function(){var e=this.parent;if(!e)return this;for(;e.parent;)e=e.parent;return e},THREE.Object3D.prototype.indexOf=function(e){return e?this.children.indexOf(e):-1},THREE.Object3D.prototype.indexOfParent=function(){var e=this.parent;if(e)return e.children.indexOf(this)},THREE.Object3D.prototype.isChildOf=function(e){for(var t=this.parent;t;){if(t==e)return!0;t=t.parent}return!1},THREE.Object3D.prototype.getChildIndex=function(e){for(var t=0;t<this.children.length;t++)if(this.children[t]==e)return t;return-1},THREE.Object3D.prototype.getIndexPath=function(e){for(var t=[],r=this;r.parent;){var i=r.parent,n=i.getChildIndex(r);if(-1==n)break;if(t.push(n),i==e)break;r=i}return t},THREE.Object3D.prototype.getChildNodeByIndexPath=function(e){for(var t=this,r=0;r<e.length;r++){var i=e[r];if(i>=t.children.length)return null;t=t.children[i]}return t},THREE.Object3D.prototype.getChildNodesNumber=function(){var e=0;return this.traverse(function(){e++}),e},THREE.Object3D.prototype.getBones=function(e,t){for(var r=[],i=0;i<t.bones.length;i++){for(var n=t.bones[i].getIndexPath(e),o=this,a=n.length-1;0<=a;a--){var s=n[a];o=o.children[s]}r.push(o)}return r},THREE.Object3D.prototype._detach=function(e,t){this.applyMatrix(e.matrixWorld),e.remove(this),t.add(this)},THREE.Object3D.prototype._attach=function(e,t){this.applyMatrix((new THREE.Matrix4).getInverse(t.matrixWorld)),e.remove(this),t.add(this)},THREE.Object3D.prototype.attach=function(e,t,r){void 0===t?t=e:Z.isBoolean(t)&&(r=t,t=e),this.parent&&(r&&this.updateWorldMatrix(!0,!1),this._detach(this.parent,t)),e&&(r&&e.updateWorldMatrix(!0,!1),this._attach(t,e))},THREE.Object3D.prototype.detach=function(e){this.parent.updateMatrixWorld(),this._detach(this.parent,e)},THREE.Object3D.prototype.attachChildren=function(e,t){this.updateMatrixWorld();for(var r=0;r<e.length;r++)THREE.SceneUtils.attach(e[r],t,this)},THREE.Object3D.prototype.detachChildren=function(e){this.updateMatrixWorld();for(var t=this.children.concat(),r=0;r<t.length;r++)t[r]._detach(this,e);return t},THREE.Object3D.prototype.getChildrenNames=function(){var t=[];return this.traverse(function(e){e.name.isBlank()||t.push(e.name)}),t},THREE.Object3D.prototype.getVisibleChildrenNumber=function(){var t=0;return this.traverse(function(e){e.visible&&t++}),t},THREE.Object3D.prototype.getInvisibleChildrenNumber=function(){var t=0;return this.traverse(function(e){e.visible||t++}),t},THREE.Object3D.prototype.getParents=function(){for(var e=[],t=this.parent;t;t=t.parent)e.push(t);return e},THREE.Object3D.prototype.getInvalidNodes=function(){var r=[];return this.traverse(function(e){var t=e.scale;0!=t.x&&0!=t.y&&0!=t.z||r.push(e)}),r},THREE.Object3D.prototype.getGeometries=function(){var r=[];return this.traverse(function(e){var t=e.geometry;t&&r.push(t)}),r},THREE.Object3D.prototype.getVisibleMeshes=function(){var t=[];return this.traverse(function(e){e.isMesh&&e.ensureVisible&&t.push(e)}),t},THREE.Object3D.prototype.getMeshes=function(){var t=[];return this.traverse(function(e){e.isMesh&&t.push(e)}),t},THREE.Object3D.prototype.getSprites=function(){var t=[];return this.traverse(function(e){e.isSprite&&t.push(e)}),t},THREE.Object3D.prototype.getRenderableNodes=function(){var t=[];return this.traverse(function(e){e.isRenderableObject()&&t.push(e)}),t},THREE.Object3D.prototype.getTextures=function(){for(var e=this.getMaterials(),t=new Set,r=0;r<e.length;r++)for(var i=e[r],n=Object.keys(i),o=0;o<n.length;o++){var a=i[n[o]];a&&a.isTexture&&t.add(a)}return Array.from(t)},THREE.Object3D.prototype.getTexturesFromImage=function(e){for(var t=[],r=this.getTextures(),i=0;i<r.length;i++){var n=r[i];n.image==e&&t.push(n)}return t},THREE.Object3D.prototype.getTexturesFromURL=function(e){for(var t=[],r=this.getTextures(),i=0;i<r.length;i++){var n=r[i];n.image.currentSrc==e&&t.push(n)}return t},THREE.Object3D.prototype.traverseMaterials=function(i){this.traverse(function(e){var t=e.material;if(t)if(Z.isArray(t))for(var r=0;r<t.length;r++)i(t[r]);else i(t)})},THREE.Object3D.prototype.getMaterials=function(){var i=new Set;return this.traverse(function(e){var t=e.material;if(t)if(Z.isArray(t))for(var r=0;r<t.length;r++)i.add(t[r]);else i.add(t)}),Array.from(i)},THREE.Object3D.prototype.getMeshByName=function(t){var r=null;return this.traverseBreakable(function(e){if(e.isMesh&&e.name==t)return r=e,!0}),r},THREE.Object3D.prototype.hasMesh=function(){var t=!1;return this.traverseBreakable(function(e){if(e.isMesh)return t=!0}),t},THREE.Object3D.prototype.getMeshNames=function(){var t=[];return this.traverse(function(e){e.isMesh&&t.push(e.name)}),t},THREE.Object3D.prototype.getSkinnedMeshes=function(){var t=[];return this.traverse(function(e){e.isSkinnedMesh&&t.push(e)}),t},THREE.Object3D.prototype.hasSkinnedMesh=function(){var t=!1;return this.traverseBreakable(function(e){if(e.isSkinnedMesh)return t=!0}),t},THREE.Object3D.prototype.hasSprite=function(){var t=!1;return this.traverseBreakable(function(e){if(e.isSprite)return t=!0}),t},THREE.Object3D.prototype.hasMaterial=function(t){if(!t)return!1;var r=!1;return this.traverseBreakable(function(e){if(e.material==t)return r=!0}),r},THREE.Object3D.prototype.hasGeometry=function(t){if(!t)return!1;var r=!1;return this.traverseBreakable(function(e){if(e.geometry==t)return r=!0}),r},THREE.Object3D.prototype.hasTexture=function(n){if(!n)return!1;function r(e){for(var t=Object.keys(e),r=0;r<t.length;r++){var i=e[t[r]];if(i&&i.isTexture&&i==n)return!0}return!1}var i=!1;return this.traverseBreakable(function(e){var t=e.material;if(t)if(Z.isArray(t)){if(r(t))return i=!0}else if(r(t))return i=!0}),i},THREE.Object3D.prototype.identity=function(){this.matrix.identity(),this.matrix.decompose(this.position,this.quaternion,this.scale),this.updateMatrixWorld(!0)},THREE.Object3D.prototype.replace=function(e,t,r){if(t&&t.isObject3D)for(var i=0;i<this.children.length;i++){var n=this.children[i];if(n==e){r&&r(n),n=void 0,(t.parent=this).children[i]=t;break}}},THREE.Object3D.prototype.insert=function(e,t){e>this.children.length||t&&(this.children.splice(e,0,t),t.parent=this)},THREE.Object3D.prototype.removeBySelf=function(){this.parent&&this.parent.remove(this)},THREE.Object3D.prototype.getAngles=function(){return Z.parseAngles(this.rotation)},THREE.Object3D.prototype.setAngles=function(e){var t=Z.parseEuler(e);this.rotation.copy(t)},THREE.Object3D.prototype.getFacesNumber=function(){var i=0;return this.traverse(function(e){if(e.isMesh){var t=e.geometry;if(t.isBufferGeometry){var r=t.index;i+=r?r.count/3:t.attributes.position.count/3}else t.isGeometry&&(i+=t.faces.length)}}),i},THREE.Object3D.prototype.getVerticesNumber=function(){var i=0;return this.traverse(function(e){if(e.isMesh){var t=e.geometry;if(t.isBufferGeometry){var r=t.index;i+=r?t.index.count:t.attributes.position.count}else t.isGeometry&&(i+=t.vertices.length)}}),i},THREE.Object3D.prototype.getNodes=function(){var t=[];return this.traverse(function(e){t.push(e)}),t},THREE.Object3D.prototype.getNodeByID=function(t){var r;return this.traverseBreakable(function(e){if(e.id==t)return r=e,!0}),r},THREE.Object3D.prototype.getNodeByUUID=function(t){var r;return this.traverseBreakable(function(e){if(e.uuid==t)return r=e,!0}),r},THREE.Object3D.prototype.setTransform=function(e){var t=new THREE.Vector3,r=new THREE.Vector3,i=new THREE.Quaternion;e.decompose(t,i,r),this.quaternion.copy(i),this.position.copy(t),this.scale.copy(r)},THREE.Object3D.prototype.getDistanceFromCamera=function(e){if(this.parent){var t=new THREE.Vector3;return this.getWorldPosition(t),e.sub(t).length()}},THREE.Object3D.prototype.keepSize=function(e,t,r,i,n){if(this.parent){i&&this.updateWorldMatrix(!0,!1);var o=new THREE.Vector3;o.setFromMatrixPosition(this.matrixWorld);var a=e.sub(o).length();if(t.isVector2){var s=[r/t.x,r/t.y];this.scale.set(a/s[0],a/s[1],1)}n&&this._synMatrixWorld()}},THREE.Object3D.prototype._synMatrixWorld=function(){this.updateWorldMatrix(!0,!0)},THREE.Object3D.prototype._getWorldPosition=function(e){return void 0===e&&(e=new THREE.Vector3),e.setFromMatrixPosition(this._getMatrixWorld())},THREE.Object3D.prototype._setWorldPosition=function(e,t,r){var i=e;this.parent&&(t&&this.parent.updateMatrixWorld(),i=this.parent.worldToLocal(e)),this.position.set(i.x,i.y,i.z),r&&this._synMatrixWorld()},THREE.Object3D.prototype._setWorldAngles=function(e,t){for(var r=this.parent;r;r=r.parent){var i=Z.parseQuaternion(r.rotation);i.inverse(),e.premultiply(i)}var n=Z.parseEuler(e);this.rotation.copy(n),t&&this._synMatrixWorld()},THREE.Object3D.prototype._setWorldScale=function(e,t){for(var r=this.parent;r;r=r.parent)e.divide(r.scale);this.scale.copy(e),t&&this._synMatrixWorld()},THREE.Object3D.prototype._getWorldScale=function(){this.updateWorldMatrix(!0,!1);var e=new THREE.Vector3,t=new THREE.Quaternion,r=new THREE.Vector3;return this.matrixWorld.decompose(e,t,r),r},THREE.Object3D.prototype.cloneByFilter=function(e){for(var t=this.clone(!1),r=0;r<this.children.length;r++){var i=this.children[r];if(!e||e(i)){var n=i.cloneByFilter(e);t.add(n)}}return t},THREE.Object3D.prototype.getForwardPosition=function(e){var t=new THREE.Vector3;return this.updateMatrixWorld(!0),this.getWorldDirection(t),t.normalize(),t.multiplyScalar(e),t.add(this.position),t},THREE.Object3D.prototype._lookAtPosition=function(e,t){var r=(e=e||{}).type,i=e.axis,n=e.quat,o=e.targetPosition;"axis"==r&&"y"==i?this.rotation.y=Math.atan2(o.x-this.position.x,o.z-this.position.z):(this.lookAt(o),"axis"==r&&("x"==i?this.rotateY(-Math.PI/2):"z"==i&&this.rotateX(-Math.PI/2))),n&&this.quaternion.multiply(n),t?this._synMatrixWorld():this.updateWorldMatrix(!1,!1)},THREE.Object3D.prototype._lookAt=function(s,l){if(this.removeBeforeRenderFunction("__lookAt__"),s){var c=this;this.addBeforeRenderFunction("__lookAt__",function(e,t,r,i,n,o){var a=s.targetPosition||r;a.isObject3D&&(a=a.position),s.targetPosition=a,c._lookAtPosition(s,Z.isFunction(l)?l():l)})}},THREE.Object3D.prototype.skipBoundingBox=function(t){this.traverse(function(e){t?e.userData.skipBoundingBox=t:delete e.userData.skipBoundingBox})},THREE.Object3D.prototype.setFrustumCulled=function(t){this.traverse(function(e){e.frustumCulled=t})},THREE.Object3D.prototype.getMatrixWorldFromRoot=function(e,t){var r=new THREE.Matrix4;if(e){for(var i=[],n=this;n!=e;){var o=new THREE.Matrix4;o.compose(n.position,t,n.scale),i.push(o),n=n.parent}r=e.matrixWorld.clone();for(var a=i.length-1;0<=a;a--)r.multiply(i[a])}return r},THREE.Matrix4.prototype.setScale=function(e){var t=this.elements;return t[0]=e.x,t[5]=e.y,t[10]=e.z,this},THREE.Euler.prototype.multiplyMatrix4=function(e){var t=new THREE.Quaternion;t.setFromEuler(this);var r=new THREE.Quaternion;r.setFromRotationMatrix(e),t.multiply(r),this.setFromQuaternion(t)},THREE.Euler.prototype.setRotationOrder=function(e){var t=new THREE.Quaternion;t.setFromEuler(this,!1),this.setFromQuaternion(t,e,!0)},THREE.Quaternion.prototype.multiplyMatrix4=function(e){var t=new THREE.Quaternion;t.setFromRotationMatrix(e),this.multiply(t)},THREE.Quaternion.prototype.getAngles=function(){return Z.parseAngles(this)},THREE.PerspectiveCamera.prototype.orthoSize=function(e,t){var r=Z.parseVector3(t),i=e.distanceTo(r),n=2*Math.tan(this.fov/2*Math.PI/180),o=n*i;return{x:o*this.aspect,y:o,depth:n,z:i}},THREE.OrthographicCamera.prototype.orthoSize=function(){return{x:(this.right-this.left)/this.zoom,y:(this.top-this.bottom)/this.zoom}},THREE.OrthographicCamera.prototype.resize=function(e,t){if(void 0!==this.userData){var r=this.userData.depth*this.userData.z,i=r*(e/t);this.left=-i/2,this.right=i/2,this.top=r/2,this.bottom=-r/2,this.updateProjectionMatrix()}},Object.defineProperty(THREE.CombinedCamera.prototype,"isPerspectiveCamera",{get:function(){return this.inPerspectiveMode}}),Object.defineProperty(THREE.CombinedCamera.prototype,"isOrthographicCamera",{get:function(){return this.inOrthographicMode}}),THREE.CombinedCamera.prototype.setNear=function(e){this.cameraP.near=e,this.cameraO.near=e,this.updateProjectionMatrix()},THREE.CombinedCamera.prototype.setFar=function(e){this.cameraP.far=e,this.cameraO.far=e,this.updateProjectionMatrix()},THREE.CombinedCamera.prototype.toPerspectiveCamera=function(){var e=new THREE.CombinedCamera(1,1,1,1,1,1,1);return e.fov=this.fov,e.left=this.left,e.right=this.right,e.top=this.top,e.bottom=this.bottom,e.cameraO=new THREE.OrthographicCamera(1,1,1,1,1,1),e.cameraO.copy(this.cameraO),e.cameraP=new THREE.PerspectiveCamera(1,1,1,1),e.cameraP.copy(this.cameraP),e.zoom=this.zoom,e.toPerspective(),e},THREE.CombinedCamera.prototype.toOrthoCamera=function(e,t){var r=this.cameraP.orthoSize(e,t),i=new THREE.CombinedCamera(r.x,r.y,this.fov,this.near,this.far,this.cameraO.near,this.cameraO.far);return i.orthoSize=r,i.toOrthographic(),i},THREE.CombinedCamera.prototype.lerpMatrix=function(e){var t=(e=e||{}).fromMatrix,r=e.toMatrix,i=e.time,n=e.lerpType||S.Quintic.Out,o=e.stop,a=e.complete,s=Z.toMatrixElementsArray(t),l=Z.toMatrixElementsArray(r);this.matrixTween&&this.matrixTween.stop(),this.matrixTween=new TWEEN.Tween(s).to(l,i).easing(n).onUpdate(function(){Z.elementsArrayToMatrix(t,this._object)}).onStop(function(){o&&o()}).onComplete(function(){a&&a()}).start()},THREE.CombinedCamera.prototype.lerpToOrthographic=function(e,t,r,i){var n=this.toOrthoCamera(e,t);this.orthoSize=n.orthoSize,this.zoom=1;var o=this;this.lerpMatrix({lerpType:S.Cubic.InOut,fromMatrix:this.projectionMatrix,toMatrix:n.projectionMatrix,time:r,stop:function(){i&&i()},complete:function(){o.toOrthographic(),i&&i()}})},THREE.CombinedCamera.prototype.lerpToPerspective=function(e,t){var r=this.toPerspectiveCamera(),i=this;this.lerpMatrix({fromMatrix:this.projectionMatrix,toMatrix:r.projectionMatrix,time:e,stop:function(){t&&t()},complete:function(){i.toPerspective(),t&&t()}})},THREE.CombinedCamera.prototype.getEffectiveFOV=function(){return this.cameraP.getEffectiveFOV()},THREE.CombinedCamera.prototype.isInView=function(e){var t=new THREE.Matrix4;t.multiplyMatrices(this.projectionMatrix,this.matrixWorldInverse);var r=new THREE.Frustum;return r.setFromMatrix(t),r.intersectsBox(e)},THREE.CombinedCamera.prototype.updateMatrixWorld=function(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&this.matrixWorld.copy(this.matrix);var t=so();t&&this.matrixWorld.premultiply(t),this.matrixWorldInverse.getInverse(this.matrixWorld)},THREE.Mesh.prototype.verticesCount=function(){return this.geometry?this.geometry.isBufferGeometry?this.geometry.attributes.position.count:this.geometry.vertices.length:0},THREE.Mesh.prototype.simplify=function(e){var t=THING.Math.clamp(e,0,1),r=new THREE.SimplifyModifier,i=this.geometry;i instanceof THREE.BufferGeometry&&(i=(new THREE.Geometry).fromBufferGeometry(i)),i.mergeVertices();var n=THING.Math.toInteger(i.vertices.length*(1-t)),o=r.modify(i,n);return new THREE.Mesh(o,this.material)},THREE.Mesh.prototype.getPerimeter=function(){var e=0,t=this.geometry.attributes;if(t){var r=t.position;if(r.count<2)return 0;for(var i=new THREE.Vector2(r.getX(0),r.getZ(0)),n=1;n<r.count;n++)e+=(a=new THREE.Vector2(r.getX(n),r.getZ(n))).distanceTo(i),i=a;e+=i.distanceTo(new THREE.Vector2(r.getX(0),r.getZ(0)))}else{var o=this.geometry.vertices;if(o.length<2)return 0;for(i=new THREE.Vector2(o[0].x,o[0].y),n=1;n<o.length;n++){var a;e+=(a=new THREE.Vector2(o[n].x,o[n].y)).distanceTo(i),i=a}e+=i.distanceTo(new THREE.Vector2(o[0].x,o[0].y))}return e},THREE.Mesh.prototype.getArea=function(){var e=[],t=this.geometry.attributes;if(t)for(var r=t.position,i=0;i<r.count;i++){var n=new THREE.Vector2(r.getX(i),r.getZ(i));e.push(n)}else{var o=this.geometry.vertices;for(i=0;i<o.length;i++)n=new THREE.Vector2(o[i].x,o[i].y),e.push(n)}var a=THREE.ShapeUtils.area(e);return Math.abs(a)},THREE.Mesh.prototype.getPoints=function(){var e=[],t=this.geometry.attributes;if(t)for(var r=t.position,i=0;i<r.count;i++)e.push([r.getX(i),r.getY(i),r.getZ(i)]);else{var n=this.geometry.vertices;if(n)for(i=0;i<n.length;i++){var o=n[i].clone();o.applyMatrix4(this.matrixWorld),e.push(o.toArray())}}return e},THREE.Mesh.prototype.getLabelPosition=function(e,t){var r=[];if(this.geometry.attributes)for(var i=this.geometry.attributes.position,n=0;n<i.count;n++)r.push([i.getX(n),i.getZ(n)]);else for(n=0;n<this.geometry.vertices.length;n++){var o=this.geometry.vertices[n];"xy"==t?r.push([o.x,o.y]):r.push([o.x,o.z])}if(!r.length)return null;var a=[];if(a.push(r),e&&0!=e.length)for(n=0;n<e.length;n++){var s=[e[n][0],e[n][1],e[n][2],e[n][3]];a.push(s)}var l,c=new polylabel(a);return l="xy"==t?this.localToWorld(new THREE.Vector3(c[0],c[1],0)):this.localToWorld(new THREE.Vector3(c[0],0,c[1])),this.getRayCastPosition(l)},THREE.Mesh.prototype.getAvaliableLabelPosition=function(e,t,r){this.updateMatrixWorld();var i=new THREE.Matrix4;i.getInverse(this.matrixWorld);for(var n=[],o=0;o<r.length;o++){var a=Z.parseVector3(r[o]);a.applyMatrix4(i),n.push(a.toArray())}var s=[];for(o=0;o<e.length;o++){var l=e[o],c=l[0]/2,u=l[1]/2;if(0!=c&&0!=u){var h=this.getLabelPosition(r,t);if(!h)break;s.push(h),(h=h.clone()).applyMatrix4(i);var p=h.x,d="xy"==t?h.y:h.z,f=[p-c,d-u],m=[p+c,d-u],g=[p+c,d+u],v=[p-c,d+u];n.push([f,m,g,v])}}return s},THREE.Mesh.prototype.getRayCastPosition=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1e3;this.updateMatrixWorld();var r=new THREE.Vector3,i=new THREE.Vector3(0,1,0),n=this.position.clone();r.copy(i).applyQuaternion(this.quaternion),n.add(r.multiplyScalar(t)),n.applyMatrix4(this.matrixWorld);var o=new THREE.Vector3,a=new THREE.Vector3(0,-1,0),s=this.position.clone();o.copy(a).applyQuaternion(this.quaternion),s.add(o.multiplyScalar(t)),s.applyMatrix4(this.matrixWorld);var l=new THREE.Vector3;l.subVectors(s,n),l.normalize();var c=e.clone();c.add(l.clone().multiplyScalar(-t));var u=new THREE.Raycaster;u.ray.origin.copy(c),u.ray.direction.copy(l);var h=u.intersectObjectForcible(this,!0);return h.length?h[0].point:null},THREE.Mesh.prototype.raycast=function(){var k=new THREE.Matrix4,I=new THREE.Ray,j=new THREE.Sphere,N=new THREE.Vector3,D=new THREE.Vector3,U=new THREE.Vector3,V=new THREE.Vector3,B=new THREE.Vector3,z=new THREE.Vector3,q=new THREE.Vector2,G=new THREE.Vector2,W=new THREE.Vector2,s=new THREE.Vector3,X=new THREE.Vector3,c=new THREE.Vector3;function Y(e,t,r,i,n,o,a){return THREE.Triangle.getBarycoord(e,t,r,i,s),n.multiplyScalar(s.x),o.multiplyScalar(s.y),a.multiplyScalar(s.z),n.add(o).add(a),n.clone()}function Q(e,t,r,i,n,o,a,s){if(null===(t.side===THREE.BackSide?i.intersectTriangle(a,o,n,!0,s):i.intersectTriangle(n,o,a,t.side!==THREE.DoubleSide,s)))return null;c.copy(s),c.applyMatrix4(e.matrixWorld);var l=r.ray.origin.distanceTo(c);return l<r.near||l>r.far?null:{distance:l,point:c.clone(),object:e}}function J(e,t,r,i,n,o,a,s){N.fromBufferAttribute(i,o),D.fromBufferAttribute(i,a),U.fromBufferAttribute(i,s);var l=Q(e,e.material,t,r,N,D,U,X);if(l){n&&(q.fromBufferAttribute(n,o),G.fromBufferAttribute(n,a),W.fromBufferAttribute(n,s),l.uv=Y(X,N,D,U,q,G,W));var c=new THREE.Face3(o,a,s);THREE.Triangle.getNormal(N,D,U,c.normal),l.face=c,l.faceIndex=o}return l}return function(e,t){var r,i=this.geometry,n=this.material,o=this.matrixWorld;if(void 0!==n&&(null===i.boundingSphere&&i.computeBoundingSphere(),j.copy(i.boundingSphere),j.applyMatrix4(o),!1!==e.ray.intersectsSphere(j)&&(k.getInverse(o),I.copy(e.ray).applyMatrix4(k),null===i.boundingBox||!1!==I.intersectsBox(i.boundingBox))))if(i.isBufferGeometry){var a,s,l,c,u=i.index,h=i.attributes.position,p=i.attributes.uv;if(null!==u)for(c=0,f=u.count;c<f;c+=3)a=u.getX(c),s=u.getX(c+1),l=u.getX(c+2),(r=J(this,e,I,h,p,a,s,l))&&(r.faceIndex=Math.floor(c/3),t.push(r));else if(void 0!==h){var d=this.drawMode===THREE.TriangleStripDrawMode,f=Math.min(i.drawRange.count,h.count)-Math.max(i.drawRange.start,0),m=d?1:3;for(d&&(f-=2),c=0;c<f;c+=m)(r=J(this,e,I,h,p,a=c,s=c+1,l=c+2))&&t.push(r)}}else if(i.isGeometry){var g,v,y,b,x=Array.isArray(n),E=i.vertices,_=i.faces,w=i.faceVertexUvs[0];0<w.length&&(b=w);for(var T=0,M=_.length;T<M;T++){var S=_[T],R=x?n[S.materialIndex]:n;if(void 0!==R){if(g=E[S.a],v=E[S.b],y=E[S.c],!0===R.morphTargets){var P=i.morphTargets,A=this.morphTargetInfluences;N.set(0,0,0),D.set(0,0,0),U.set(0,0,0);for(var C=0,L=P.length;C<L;C++){var O=A[C];if(0!==O){var H=P[C].vertices;N.addScaledVector(V.subVectors(H[S.a],g),O),D.addScaledVector(B.subVectors(H[S.b],v),O),U.addScaledVector(z.subVectors(H[S.c],y),O)}}N.add(g),D.add(v),U.add(y),g=N,v=D,y=U}if(r=Q(this,R,e,I,g,v,y,X)){if(b&&b[T]){var F=b[T];q.copy(F[0]),G.copy(F[1]),W.copy(F[2]),r.uv=Y(X,g,v,y,q,G,W)}r.face=S,r.faceIndex=T,t.push(r)}}}}}}(),THREE.Raycaster.prototype.clone=function(){return new THREE.Raycaster(this.ray.origin.clone(),this.ray.direction.clone())},THREE.Raycaster.prototype._intersectObjectForcible=function(e,t,r,i){if(e.raycast(t,r),!0===i)for(var n=e.children,o=0,a=n.length;o<a;o++)this._intersectObjectForcible(n[o],t,r,!0)},THREE.Raycaster.prototype.intersectObjectForcible=function(e,t,r){var i=r||[];return this._intersectObjectForcible(e,this,i,t),i.sort(function(e,t){return e.distance-t.distance}),i},THREE.Raycaster.prototype.intersectEnsureVisibleObject=function(e,t,r,i,n){if(!1!==e.ensureVisible(n)&&(e.raycast(t,r),!0===i))for(var o=e.children,a=0,s=o.length;a<s;a++)this.intersectEnsureVisibleObject(o[a],t,r,!0,n)},THREE.Raycaster.prototype.intersectEnsureVisibleObjects=function(e,t,r,i){if(!1===Array.isArray(t))return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),e;for(var n=0,o=t.length;n<o;n++)this.intersectEnsureVisibleObject(t[n],this,e,r,i);return e.sort(function(e,t){return e.distance-t.distance}),e},THREE.Geometry.prototype.genFaceVertexUVs=function(){this.computeFaceNormals(),this.computeVertexNormals(),this.computeBoundingBox();for(var e=this.boundingBox.max,t=this.boundingBox.min,r=new THREE.Vector2(0-t.x,0-t.y),i=new THREE.Vector2(e.x-t.x,e.y-t.y),n=this.faces,o=[],a=0;a<n.length;a++){var s=this.vertices[n[a].a],l=this.vertices[n[a].b],c=this.vertices[n[a].c],u=new THREE.Vector2((s.x+r.x)/i.x,(s.y+r.y)/i.y),h=new THREE.Vector2((l.x+r.x)/i.x,(l.y+r.y)/i.y),p=new THREE.Vector2((c.x+r.x)/i.x,(c.y+r.y)/i.y);o.push([u,h,p])}for(a=0;a<this.faceVertexUvs.length;a++)this.faceVertexUvs[a]=o.concat();this.uvsNeedUpdate=!0,this.elementsNeedUpdate=!0},THREE.Scene.prototype.verticesCount=function(){var t=0;return this.traverse(function(e){e.isMesh&&(t+=e.verticesCount())}),t},THREE.AnimationMixer.prototype.isRunning=function(e){for(var t=this._actions,r=this._nActiveActions,i=0;i!==r;++i){var n=t[i];if(e){var o=n.getClip();if(o&&e!=o.name)continue}if(n.isRunning())return!0}return!1},THREE.AnimationMixer.prototype.log=function(){for(var e=this.stats,t=0;t<this._actions.length;t++){var r=this._actions[t],i=r.getClip(),n=r.getEffectiveWeight();0!=n&&console.log("action: [name: "+i.name+", weight: "+n+"]")}console.log("action: "+e.actions.inUse+"/"+e.actions.total),console.log("bindings: "+e.bindings.inUse+"/"+e.bindings.total),console.log("controlInterpolants: "+e.controlInterpolants.inUse+"/"+e.controlInterpolants.total)},THREE.Material.prototype.clone=function(){var e=(new this.constructor).copy(this);e.defines=e.defines||{};var t=this.defines;for(var r in t)e.defines[r]=t[r];return e},THREE.Material.prototype.copy=function(e){this.name=e.name,this.fog=e.fog,this.lights=e.lights,this.blending=e.blending,this.side=e.side,this.flatShading=e.flatShading,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.userData=JSON.parse(JSON.stringify(e.userData)),this.defines=void 0!==e.defines?JSON.parse(JSON.stringify(e.defines)):void 0,this.__texture=e.__texture,this.clipShadows=e.clipShadows,this.clipIntersection=e.clipIntersection;var t=e.clippingPlanes,r=null;if(null!==t){var i=t.length;r=new Array(i);for(var n=0;n!==i;++n)r[n]=t[n].clone()}return this.clippingPlanes=r,this.shadowSide=e.shadowSide,this.onBeforeCompile=e.onBeforeCompile,this},THREE.Box3.prototype.getIntersection=function(e){var t=new THREE.Box3;return this.intersectsBox(e)&&(t.min.x=Math.max(this.min.x,e.min.x),t.max.x=Math.min(this.max.x,e.max.x),t.min.y=Math.max(this.min.y,e.min.y),t.max.y=Math.min(this.max.y,e.max.y),t.min.z=Math.max(this.min.z,e.min.z),t.max.z=Math.min(this.max.z,e.max.z)),t},THREE.Box3.prototype.setFromVisibleObject=function(e,t){this.makeEmpty(),e.updateWorldMatrix(!0,!0);var a=new THREE.Vector3,s=this,l=!1;if(e.traverseVisible(function(e){if(!e.isLight&&!e.userData.skipBoundingBox){var t=e.geometry;if(void 0!==t){if(t.isGeometry)for(var r=t.vertices,i=0,n=r.length;i<n;i++)a.copy(r[i]),a.applyMatrix4(e.matrixWorld),s.expandByPoint(a);else if(t.isBufferGeometry){var o=t.attributes.position;if(void 0!==o)for(i=0,n=o.count;i<n;i++)a.fromBufferAttribute(o,i),a.applyMatrix4(e.matrixWorld),s.expandByPoint(a)}l=!0}}}),!l){var r=new THREE.Vector3;e.getWorldPosition(r),this.expandByPoint(r)}return this},THREE.Box3.prototype.setFromObjectInLocalSpace=function(e,a){this.makeEmpty(),e.updateWorldMatrix(!0,!0);var s=new THREE.Vector3,l=this;return e.traverseVisible(function(e){if(!e.isLight&&!e.userData.skipBoundingBox){var t=e.geometry;if(void 0!==t)if(t.isGeometry)for(var r=t.vertices,i=0,n=r.length;i<n;i++)s.copy(r[i]),s.applyMatrix4(e.matrixWorld),s.applyMatrix4(a),l.expandByPoint(s);else if(t.isBufferGeometry){var o=t.attributes.position;if(void 0!==o)for(i=0,n=o.count;i<n;i++)s.fromBufferAttribute(o,i),s.applyMatrix4(e.matrixWorld),s.applyMatrix4(a),l.expandByPoint(s)}}}),this},THREE.ShaderLib.normal.vertexShader=THREE.ShaderLib.normal.vertexShader.replace("#include <logdepthbuf_pars_vertex>","#include <logdepthbuf_pars_vertex> \n"+THREE.ShaderChunk.clipping_planes_pars_vertex),THREE.ShaderLib.normal.vertexShader=THREE.ShaderLib.normal.vertexShader.replace("#include <logdepthbuf_vertex>","#include <logdepthbuf_vertex> \n"+THREE.ShaderChunk.clipping_planes_vertex),THREE.ShaderLib.normal.fragmentShader=THREE.ShaderLib.normal.fragmentShader.replace("#include <logdepthbuf_pars_fragment>","#include <logdepthbuf_pars_fragment> \n"+THREE.ShaderChunk.clipping_planes_pars_fragment),THREE.ShaderLib.normal.fragmentShader=THREE.ShaderLib.normal.fragmentShader.replace("void main() {","void main() { \n"+THREE.ShaderChunk.clipping_planes_fragment),THREE.ShaderChunk.map_fragment=["","#ifdef USE_MAP","#ifdef USE_DIFFUSE_UV2","vec4 texelColor = texture2D( map, vUv2 );","#else","vec4 texelColor = texture2D( map, vUv );","#endif","texelColor = mapTexelToLinear( texelColor );","diffuseColor *= texelColor;","#endif",""].join("\n"),THREE.ShaderChunk.alphamap_fragment=["","#ifdef USE_ALPHAMAP","diffuseColor.a *= texture2D( alphaMap, vUv3).g;","#endif",""].join("\n"),THREE.ShaderChunk.uv2_pars_fragment=["","#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP ) || defined (USE_DIFFUSE_UV2)","varying vec2 vUv2;","#endif","#ifdef USE_ALPHAMAP","varying vec2 vUv3;","#endif",""].join("\n"),THREE.ShaderChunk.uv2_pars_vertex=["","#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP ) || defined( USE_ALPHA_UV2 ) || defined (USE_DIFFUSE_UV2)","attribute vec2 uv2;","#endif","#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP ) || defined (USE_DIFFUSE_UV2)","varying vec2 vUv2;","#endif","#ifdef USE_ALPHAMAP","#ifdef USE_ALPHA_UV3","attribute vec2 uv3;","#endif","varying vec2 vUv3;","uniform mat3 uvTransform1;","#endif",""].join("\n"),THREE.ShaderChunk.uv2_vertex=["#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP ) || defined (USE_DIFFUSE_UV2)","#if defined(USE_DIFFUSE_UV2) && defined(USE_MAP)","vUv2 = (uvTransform * vec3(uv2, 1.0)).xy;","#else","vUv2 = uv2;","#endif","#endif","#ifdef USE_ALPHAMAP","vUv3 = (uvTransform1 * vec3(uv, 1.0)).xy;","#ifdef USE_ALPHA_UV2","vUv3 = (uvTransform1 * vec3(uv2, 1.0)).xy;","#endif","#ifdef USE_ALPHA_UV3","vUv3 = (uvTransform1 * vec3(uv3, 1.0)).xy;","#endif","#endif",""].join("\n"),THREE.ShaderChunk.color_pars_vertex+=["","#ifdef USE_ALPHAINDEX","attribute float alphaIndex;","varying float vAlpha;","#endif",""].join("\n"),THREE.ShaderChunk.color_vertex+=["","#ifdef USE_ALPHAINDEX","vAlpha = alphaIndex;","#endif",""].join("\n"),THREE.ShaderChunk.color_pars_fragment+=["","#ifdef USE_ALPHAINDEX","varying float vAlpha;","#endif",""].join("\n"),THREE.ShaderChunk.color_fragment+=["","#ifdef USE_ALPHAINDEX","diffuseColor.a *= vAlpha;","#endif",""].join("\n"),["sprite","basic"].forEach(function(e){var t=THREE.ShaderLib[e];t.vertexShader=t.vertexShader.replace("#include <clipping_planes_pars_vertex>","\n\t#include <clipping_planes_pars_vertex>\n\t#ifdef USE_GPUPICKER\n\t\tuniform float baseId;\n\t\tvarying vec4 worldId;\n\t#endif\n\t"),t.vertexShader=t.vertexShader.replace("#include <fog_vertex>","\n\t#include <fog_vertex>\n\t#ifdef USE_GPUPICKER\n\t\tvec3 a = fract(vec3(1.0/255.0, 1.0/(255.0*255.0), 1.0/(255.0*255.0*255.0)) * baseId);\n\t\ta -= a.xxy * vec3(0.0, 1.0/255.0, 1.0/255.0);\n\t\tworldId = vec4(a,1);\n\t#endif\n\t"),t.fragmentShader=t.fragmentShader.replace("#include <clipping_planes_pars_fragment>","\n\t#include <clipping_planes_pars_fragment>\n\t#ifdef USE_GPUPICKER\n\t\tvarying vec4 worldId;\n\t#endif\n\t"),t.fragmentShader=t.fragmentShader.replace("#include <fog_fragment>","\n\t#include <fog_fragment>\n\t#ifdef USE_GPUPICKER\n\t\tgl_FragColor = worldId;\n\t#endif\n\t"),t.fragmentShader=t.fragmentShader.replace("#include <clipping_planes_fragment>","\n\t#ifdef USE_MAP\n\t\t#ifdef USE_UV_DISCARD\n\t\t\tif (vUv.x < 0. || vUv.x > 1. || vUv.y < 0. || vUv.y > 1.) discard;\n\t\t#endif\n\t#endif\n\t#include <clipping_planes_fragment>\n\t")}),THREE.ShaderChunk.aomap_fragment="\n\t#ifdef USE_AOMAP\n\t\t#ifdef WALL_AO\n\t\t\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity * 0.5 + 1.5;\n\t\t#else\n\t\t\t#ifdef FLOOR_AO\n\t\t\t\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.1;\n\t\t\t#else\n\t\t\t\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity * 1.5 + 1.45;\n\t\t\t#endif\n\t\t#endif\n\t\t// reflectedLight.indirectDiffuse *= ambientOcclusion;\n\t\t#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\t\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t\t#endif\n\t#endif\n",THREE.ShaderChunk.emissivemap_fragment+=["","#ifdef STANDARD","totalEmissiveRadiance = vec3(0.0,0.0,0.0);","vec3 newEmissiveColor = emissive;","#ifdef USE_EMISSIVEMAP","newEmissiveColor = emissive * emissiveColor.rgb;","#endif","#endif",""].join("\n"),THREE.ShaderChunk.encodings_fragment=["gl_FragColor = linearToOutputTexel( gl_FragColor );","#ifdef USE_AOMAP","gl_FragColor.rgb *= ambientOcclusion;","#endif","#ifdef STANDARD","gl_FragColor.rgb += newEmissiveColor;","#endif"].join("\n"),THREE.ShaderChunk.tonemapping_fragment=["#if defined( TONE_MAPPING ) && defined(STANDARD)","gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );","#endif"].join("\n");var co=function(){function n(e){y(this,n);var t=e.image,r=e.opacity||.8,i=new THREE.SpriteMaterial({map:THREE.ImageUtils.loadTexture(t),opacity:r,transparent:!0});this._position=null,this._uiPosition=[1,1],Object.defineProperty(this,"position",{get:function(){return this._position},set:function(e){if(Z.isNumber(e))switch(this._position=e,this._position){case E.LeftTop:this._uiPosition=[-1,-1];break;case E.RightTop:this._uiPosition=[1,-1];break;case E.LeftBottom:this._uiPosition=[-1,1];break;case E.RightBottom:this._uiPosition=[1,1]}return this._position}}),null!=e.position?this.position=e.position:this.position=E.RightBottom,this.size=e.size||50,this.offset=e.offset||[0,0],this.sprite=new THREE.Sprite(i),this.sprite.scale.set(this.size,this.size,1)}return n.prototype.onUpdate=function(){var e=this.app.mainUI.getRenderPosition(this._uiPosition,[this.size,this.size]);this.sprite.position.set(e[0]+this.offset[0],e[1]+this.offset[1],-10),this.sprite.material.rotation=this.app.renderCamera.rotation._z},n.prototype.onAdd=function(e){this.app=e,this.app.mainUI.scene2D.add(this.sprite)},n.prototype.onRemove=function(){this.app.mainUI.scene2D.remove(this.sprite)},n}(),uo=function(){function t(e){y(this,t),this._controls=null}return t.prototype.onResize=function(){},t.prototype.onUpdate=function(){this._controls&&(this._controls.update(this.app._deltaTime),this.app.needUpdate=!0)},t.prototype.onAdd=function(e){(this.app=e).camera.inputEnabled=!1,this._controls||(this._controls=new THREE.FreeMouseControls(e.renderCamera),this._controls.movementSpeed=.25),this._controls.enabled=!0},t.prototype.onRemove=function(){this.app.camera.inputEnabled=!0,this._controls&&(this._controls.dispose(),this._controls.enabled=!1,this._controls=null)},t}();function ho(e){return e instanceof ye?e.getNodes():(Array.isArray(e)&&console.warn("[WalkControl/WalkButtronControl] please set collision objects by selector object, instead of object3D array."),e)}var po=function(){function t(e){y(this,t),this._controls=null,e=e||{},this.walkSpeed=void 0===e.walkSpeed?.02:e.walkSpeed,this.turnSpeed=void 0===e.turnSpeed?.25:e.turnSpeed,this.jumpSpeed=void 0===e.jumpSpeed?3:e.jumpSpeed,this.enableKeyRotate=void 0!==e.enableKeyRotate&&e.enableKeyRotate,this.useGravity=void 0===e.useGravity||e.useGravity,this.gravity=e.gravity?e.gravity:9.8,this.eyeHeight=void 0===e.eyeHeight?1.6:e.eyeHeight,this._groundObjects=void 0===e.groundObjects?void 0:ho(e.groundObjects),this.useCollision=void 0!==e.useCollision&&e.useCollision,this._collisionObjects=void 0===e.collisionObjects?void 0:ho(e.collisionObjects),this._downRaycaster=new THREE.Raycaster,this._downRaycaster.ray.direction.set(0,-1,0),this._forwardRaycaster=new THREE.Raycaster,this._fallSpeed=0,this._prevCameraAdjustNear=!1,this._cameraChangeStarted=!1}return t.prototype._notifyCameraEvent=function(e){var t=this.app.camera;this.app.trigger(e,{position:t.position,target:t.target})},t.prototype.onResize=function(){},t.prototype.onUpdate=function(){var e=this.app.renderCamera,t=!1;if(this.useCollision){this._forwardRaycaster.ray.origin.copy(e.position),this._forwardRaycaster.ray.origin.y-=this.eyeHeight/2;var r,i=this._controls.getMoveDirection();this._forwardRaycaster.ray.direction.copy(i).normalize(),0<(r=this._forwardRaycaster.intersectObjects(this._collisionObjects,!0)).length&&r[0].distance<.5&&(t=!0)}if(this._controls&&(this._controls.movementSpeed=t?0:this.walkSpeed,this._controls.rotateSpeed=this.turnSpeed,this._controls.enableKeyRotate=this.enableKeyRotate,this._controls.update()?this._cameraChangeStarted?this._notifyCameraEvent("cameraChange"):(this._cameraChangeStarted=!0,this._notifyCameraEvent("cameraChangeStart")):this._cameraChangeStarted&&(this._cameraChangeStarted=!1,this._notifyCameraEvent("cameraChangeEnd")),this.app.needUpdate=!0),this.useGravity)if(this._downRaycaster.ray.origin.copy(e.position),(r=this._downRaycaster.intersectObjects(this._groundObjects,!0)).length<1)this._fallSpeed+=.0166*this.gravity,e.position.y-=Math.min(.0166*this._fallSpeed,this.eyeHeight-.001);else{var n=r[0].distance;n<=this.eyeHeight&&0<=this._fallSpeed?(this._fallSpeed=0,e.position.y=e.position.y-n+this.eyeHeight):(this._fallSpeed+=.0166*this.gravity,e.position.y-=Math.min(.0166*this._fallSpeed,this.eyeHeight-.001))}},t.prototype.onAdd=function(e){this.app=e,this._prevCameraAdjustNear=e.camera.autoAdjustNear,e.camera.autoAdjustNear=!1,e.camera.inputEnabled=!1,this._controls||(this._controls=new THREE.FreeMouseControls(e.renderCamera),this._controls.movementSpeed=this.walkSpeed,this._controls.rotateSpeed=this.turnSpeed,this._controls.enableFly=!1),this._controls.enabled=!0,this._groundObjects=this._groundObjects||e.query(".Ground || .Floor").getNodes(),this._collisionObjects=this._collisionObjects||[this.app.scene],this._jumpBind=function(e){32==e.keyCode&&this.jump()}.bind(this),window.addEventListener("keydown",this._jumpBind,!1)},t.prototype.onRemove=function(){var e=this.app;e.camera.inputEnabled=!0,this._controls&&(this._controls.dispose(),this._controls.enabled=!1,this._controls=null),this._groundObjects=null,this._collisionObjects=null,e.camera.autoAdjustNear=this._prevCameraAdjustNear,window.removeEventListener("keydown",this._jumpBind,!1)},t.prototype.jump=function(){0==this._fallSpeed&&(this._fallSpeed-=this.jumpSpeed)},l(t,[{key:"groundObjects",set:function(e){this._groundObjects=void 0!==e?ho(e):[]}},{key:"collisionObject",set:function(e){this._collisionObjects=void 0!==e?ho(e):[]}}]),t}(),fo=function(t){function r(e){return y(this,r),p(this,t.call(this,e))}return u(r,t),r.prototype.onResize=function(){},r.prototype.onAdd=function(e){this.app=e,this._prevCameraAdjustNear=e.camera.autoAdjustNear,e.camera.autoAdjustNear=!1,e.camera.inputEnabled=!1,this._controls||(this._controls=new THREE.FreeControls(e.renderCamera),this._controls.movementSpeed=this.walkSpeed,this._controls.rotateSpeed=this.turnSpeed,this._controls.enableFly=!1,e.renderCamera.rotation.x=0),this._controls.enabled=!0,this._groundObjects=this._groundObjects||e.query(".Ground || .Floor").getNodes(),this._collisionObjects=this._collisionObjects||[this.app.scene],this._createWalkButton()},r.prototype.onRemove=function(){var e=this.app;e.camera.inputEnabled=!0,this._controls&&(this._controls.enabled=!1,this._controls=null),this._groundObjects=null,this._collisionObjects=null,e.camera.autoAdjustNear=this._prevCameraAdjustNear,this._removeWalkButton()},r.prototype._setMoveState=function(e,t){this._controls&&(this._controls.moveState[e]=t,this._controls.updateMovementVector())},r.prototype._setRotate=function(e,t){this._controls&&this._controls.rotateDelta.set(e,t)},r.prototype._createWalkButton=function(){var e=this.app,c=this;if(!(0<e.domElement.getElementsByClassName("walkbutton").length)){this._walkButtonDom=e.domElement.appendChild(document.createElement("div")),this._walkButtonDom.className="walkbutton",this._walkButtonDom.style.cssText="position: absolute;right: 0;bottom: 0;width: 0;height: 0;border-radius: 50%;box-sizing: border-box;z-index: 1000;background: #f0f0f0;";var u,h,p,d,f,m=this._walkButtonDom.appendChild(document.createElement("div"));m.style.cssText="width: 46%;height: 46%;border-radius: 50%;overflow: hidden;position: absolute;top: 27%;left: 27%;border-radius: 50%;background: #003A9E;",this._resizeWalkButton(),c._moveState="",this._walkButtonDom.addEventListener("touchstart",function(e){e.preventDefault(),u=e.changedTouches[0].pageX,h=e.changedTouches[0].pageY,p=e.changedTouches[0].pageX-m.offsetLeft,d=e.changedTouches[0].pageY-m.offsetTop,document.body.addEventListener("touchmove",t,!1)}),document.addEventListener("touchend",function(){document.body.removeEventListener("touchmove",t,!1),m.style.left="27%",m.style.top="27%",c._setMoveState(c._moveState,0),c._moveState=""})}function t(e){var t=e.changedTouches[0].pageX,r=e.changedTouches[0].pageY,i=t-p,n=r-d,o=t-u,a=r-h,s=parseFloat(c.width)/2;if(c._getDistance(o,a)<=s)m.style.left=i+"px",m.style.top=n+"px";else{var l=c._getNewPos(s,c._getRadian(o,a));m.style.left=l[0]+u-p+"px",m.style.top=l[1]+h-d+"px"}(f=Math.abs(o)>Math.abs(a)?0<o?"right":"left":0<a?"back":"forward")!==c._moveState&&(c._setMoveState(c._moveState,0),c._setMoveState(f,1),c._moveState=f)}},r.prototype._removeWalkButton=function(){var e=this.app.domElement.getElementsByClassName("walkbutton");0<e.length&&e[0].parentNode.removeChild(e[0])},r.prototype._getDistance=function(e,t){return Math.sqrt(Math.pow(e,2)+Math.pow(t,2))},r.prototype._getRadian=function(e,t){return Math.atan2(t,e)},r.prototype._getNewPos=function(e,t){var r=[];return r.push(Math.cos(t)*e),r.push(Math.sin(t)*e),r},r.prototype._getwindowOrientation=function(){return 180==window.orientation||0==window.orientation||90!=window.orientation&&-90!=window.orientation&&void 0},r.prototype._resizeWalkButton=function(){this.width=this._getwindowOrientation()?.2*this.app.domElement.offsetWidth:.2*this.app.domElement.offsetHeight,this._walkButtonDom.style.width=this.width+"px",this._walkButtonDom.style.height=this.width+"px",this._walkButtonDom.style.right=.5*this.width+"px",this._walkButtonDom.style.bottom=.3*this.width+"px"},r}(po),mo=function(){function t(e){y(this,t),this.parseParam(e),this._enable=!0,this.scene=new THREE.Scene,this.camera=null,this.sprite=null,this.raycaster=new THREE.Raycaster,this.mouse=new THREE.Vector2,this.ratio=2,this.mainAspect=1,this.miniDom=null,this.renderTarget=null,this.inited=!1,this.create()}return t.prototype.parseParam=function(e){this.app=e.app,this._opacity=e.opacity||.7,this._posIndex=e.position||e.posIndex||0,this.bIcon=e.bIcon||!0,this.width=e.width||150,this.height=e.height||this.width,this._scale=e.scale||1,this.closeBtnImg=e.closeBtnImg||"http://www.thingjs.com/static/images/minimap2.png",this.cameraViewImg=e.cameraViewImg||"http://www.thingjs.com/static/images/minimap1.png",this.cameraCenterImg=e.cameraCenterImg||"http://www.thingjs.com/static/images/minimap0.png",this.center={};var t=this.app.root.box,r=(t.max.x+t.min.x)/2,i=(t.max.z+t.min.z)/2;if(e.sceneCenter?(this.center.x=e.sceneCenter[0],this.center.y=e.sceneCenter[1]):e.center?(this.center.x=e.center[0],this.center.y=e.center[1]):(this.center.x=r,this.center.y=i),this.angle=e.angle||0,this.canMoushWheel=e.mousewheel,this.ground=e.ground,this.hasClose=e.hasClose,!this.ground)for(var n=0;n<this.app.root.campuses.length;n++){var o=this.app.root.campuses[n].outdoors;if(o){this.ground=o.node.children;break}}this.bTranslate=e.bTranslate||!1},t.prototype.init2d=function(){if(this.miniDom=this.app.domElement.appendChild(document.createElement("div")),this.miniDom.className="minimap",this.miniDom.style.position="absolute",this.miniDom.style.cssText="position: absolute;width:"+this.width+";height:"+this.height+";border: 5px solid rgba(255, 255, 255, 0.8);border-radius: 3px;display: block;box-sizing: border-box;overflow:hidden",this.miniDom.style.zIndex=1e3,this.hasClose){var e=this.miniDom.appendChild(document.createElement("img"));e.className="minimap_closeBtn",e.style.position="absolute",e.style.width=this.width/5,e.style.right="1px",e.style.top="1px",e.src=this.closeBtnImg;var l=this;e.addEventListener("click",function(){close=!0,l.enable=!1})}var t=this.miniDom.appendChild(document.createElement("img"));t.className="minimap_cameraView",t.style.position="absolute",t.src=this.cameraViewImg;var r=this.miniDom.appendChild(document.createElement("img"));function i(){l.raycaster.setFromCamera(l.mouse,l.camera);var e=l.raycaster.intersectObjects(l.ground[0].children,!0);if(0<e.length){var t=e[0].point;if(l.bTranslate){var r=l.app.camera.cameraObject.forward;r=new THREE.Vector3(r[0],0,r[2]);var i,n=new THREE.Vector3(t.x,0,t.z).normalize(),o=r.dot(n),a=(new THREE.Vector3).crossVectors(r,n).y;i=0<o?a<0?90*-(a+1)-90:90+90*(1-a):90*a;var s=l.app.create({type:"Thing",position:[t.x,l.app.camera.position[1],t.z]});l.app.camera.flyTo({time:1e3,object:s,xAngle:45,yAngle:i,zAngle:0})}else l.app.camera.flyTo({time:1e3,position:[t.x,l.app.camera.position[1],t.z],target:l.app.camera.target})}}r.className="minimap_cameraCenter",r.src=this.cameraCenterImg,t.style.width="40px",t.style.height="30px",this.miniDom.onmousedown=function(e){var t=e||event;t.cancelBubble=!0,t.stopPropagation()},this.miniDom.onmousemove=function(e){var t=e||event;t.cancelBubble=!0,t.stopPropagation()},this.miniDom.onmousewheel=function(e){var t=e||event;t.cancelBubble=!0,t.stopPropagation()},this.canMoushWheel&&this.miniDom.addEventListener("mousewheel",function(e){l.scale+=0<e.wheelDelta?.1:-.1},!1),this.miniDom.addEventListener("mousedown",function(e){0===e.button&&(l.mouse.x=e.clientX/(l.miniDom.clientWidth+10)*2-1,l.mouse.y=-e.clientY/(l.miniDom.clientWidth+10)*2+1,i(),l.miniDom.onmousemove=function(e){l.mouse.x=e.clientX/(l.miniDom.clientWidth+10)*2-1,l.mouse.y=-e.clientY/(l.miniDom.clientWidth+10)*2+1,i()},l.miniDom.onmouseup=function(){l.miniDom.onmousemove=null,l.miniDom.onmouseup=null})},!1),l=this},t.prototype.init3d=function(){this.init2d();var e=this.app.root.box,t=e.max.x>e.max.z?e.max.x:e.max.z,r=Math.abs(e.min.x)>Math.abs(e.min.z)?Math.abs(e.min.x):Math.abs(e.min.z),i=r<t?t:r;i*=1/this.scale,this.camera=new THREE.OrthographicCamera(-i,i,i,-i,-1e4,1e4),this.camera.position.set(this.center.x,100,this.center.y),this.camera.up=new THREE.Vector3(0,0,-1).applyEuler(new THREE.Euler(0,this.angle*Math.PI/180,0,"XYZ")),this.camera.lookAt(new THREE.Vector3(this.center.x,-1,this.center.y));var n=this.app.domElement;this.mainAspect=n.clientWidth/n.clientHeight,this.ratio=n.clientWidth/i;var o=i,a=8*o<256?8*o:256,s=i*this.mainAspect*8<256*this.mainAspect?8*o:256*this.mainAspect;this.renderTarget=new THREE.WebGLRenderTarget(a,s,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,generateMipmaps:!1,format:THREE.RGBAFormat});var l=new THREE.SpriteMaterial({map:this.renderTarget.texture,overdraw:!1,transparent:!0,opacity:this._opacity});this.sprite=new THREE.Sprite(l),this.setMiniRect(),this.update();var c=this;window.onresize=function(){c.mainAspect=n.clientWidth/n.clientHeight,c.ratio=n.clientWidth/i,c.setMiniRect()},this.inited=!0},t.prototype.create=function(){this.inited||(this.init3d(),this.scene.add(this.camera),this.camera.add(this.sprite))},t.prototype.setMiniRect=function(){this.miniDom.style.width=this.width+"px",this.miniDom.style.height=this.height+"px";var n=this;function e(e,t,r,i){n.miniDom.style.top=e,n.miniDom.style.left=t,n.miniDom.style.bottom=r,n.miniDom.style.right=i}var t=this.width/(.5*this.ratio),r=t*this.mainAspect;this.sprite.scale.set(t,r,1);var i,o,a=this.camera.right,s=this.camera.left;switch(this._posIndex){case 0:i=s+t/2,o=s+r/2,e("0px","0px",null,null);break;case 2:i=s+t/2,o=a-r/2,e(null,"0px","0px",null);break;case 1:i=a-t/2,o=s+r/2,e("0px",null,null,"0px");break;case 3:i=a-t/2,o=a-r/2,e(null,null,"0px","0px")}this.sprite.position.set(i,-o,0)},t.prototype.update=function(){var e=this.app.lighting,t=this.app.lighting;t.mainLight.intensity=0,t.secondaryLight.intensity=0,t.tertiaryLight.intensity=0,this.app.lighting=t;var r=this.app.scene.background;this.app.scene.background=null,this.app.renderer.setClearColor(0,0),this.app.renderer.render(this.app.scene,this.camera,this.renderTarget,!0),this.app.lighting=e,this.app.scene.background=r},t.prototype.destroy=function(){var e=this.scene.children.length;if(0!=e){if(0<e)for(var t=0;t<e;t++)this.scene.remove(this.scene.children[t]);this.camera=null,(this.sprite=null)!=this.miniDom&&(this.app.domElement.removeChild(this.miniDom),this.miniDom=null)}},t.prototype.render=function(){if(this.miniDom)if(this._enable){this.miniDom.style.display="block";var t=this;if(this.miniDom.childNodes.forEach(function(e){e.style.display=t.bIcon?"block":"none"}),null!=this.camera&&null!=this.renderTarget){var e=this.app.renderer.autoClear;this.app.renderer.autoClear=!1,this.app.renderer.render(this.scene,this.camera),this.app.renderer.autoClear=e;var r=this.app.camera.position,i=new THREE.Vector3(r[0],r[1],r[2]);if(0!=this.angle){var n=new THREE.Vector3(this.center.x,i.y,this.center.y),o=i.sub(n);o.applyEuler(new THREE.Euler(0,-this.angle*Math.PI/180,0,"XYZ")),o.add(n),i.copy(o)}var a=this.transToMinimapCoord(i).x,s=this.transToMinimapCoord(i).y;this.setImage(a,s,this.app.camera.position[1]);var l,c=this.app.camera.camera.rotation,u="YXZ"==c.order?c.y:c.z,h=(document.getElementsByClassName("minimap_cameraCenter")[0],document.getElementsByClassName("minimap_cameraView")[0]);l=0<=u?u/Math.PI*180:180*(2-Math.abs(u)/Math.PI),h.style.transform="rotate("+(-l+this.angle)+"deg)",h.style.transformOrigin="50% 100%"}}else this.miniDom.style.display="none"},t.prototype.transToMinimapCoord=function(e){var t,r,i,n,o=(r=t=this.width/2)/((this.camera.right-this.camera.left)/2);return n=e.hasOwnProperty("x")?(i=e.x-this.center.x,e.z-this.center.y):(i=e[0]-this.center.x,e[2]-this.center.y),{x:0<=i?t-o*i:t+o*Math.abs(i),y:0<=n?r-o*n:r+o*Math.abs(n)}},t.prototype.setImage=function(e,t,r){var i=1/(220/30)*(80<r?r-80:0)+15;30<i&&(i=30);var n=document.getElementsByClassName("minimap_cameraCenter")[0],o=document.getElementsByClassName("minimap_cameraView")[0],a=i;i/2<=e&&e<=this.width-i/2&&i/2<=t&&this.width,n.style.position="absolute",n.style.width=i+"px",n.style.height=a+"px",n.style.right=e-i/2+"px",n.style.bottom=t-a+"px",o.style.right=e-20+"px",o.style.bottom=t-a/2+"px"},l(t,[{key:"scale",set:function(e){this._scale=e,this.destroy(),this.inited=!1,this.create()},get:function(){return this._scale}},{key:"opacity",set:function(e){this._opacity=e,this.sprite.material.opacity=this._opacity},get:function(){return this._opacity}},{key:"posIndex",set:function(e){this._posIndex=e,this.setMiniRect()},get:function(){return this._posIndex}},{key:"enable",set:function(e){this._enable=e},get:function(){return this._enable}}]),t}(),go=function(){function t(e){y(this,t),this.minimap=null,this.param=e}return t.prototype.onAdd=function(e){null!=this.minimap&&this.onRemove(),this.param.app||(this.param.app=e),this.minimap=new mo(this.param)},t.prototype.onRemove=function(){this.minimap&&this.minimap.destroy()},t.prototype.onUpdate=function(){this.minimap&&this.minimap.render()},t}(),vo=function(){function t(e){y(this,t),this.params=e,this.draggable=!0,e&&(this.draggable=Z.parseValue(e.draggable,!0))}return t.prototype.init=function(){var i=this,e=this.params;if(this.cameraTarget=function(e){var t,r=2,i=1218267;if(!e)return null;var n=e.size,o=e.color,a=e.url;if(null==a)return null;t=a,null!=n&&(r=n),null!=o&&(i=o);var s=app.create({type:"Marker",offset:[0,8,0],size:r,keepSize:!0,url:t,useSpriteMaterial:!1,angles:[90,0,0]});return s.style.alwaysOnTop=!0,s.style.color=i,s}(e),this.cameraTarget){t();var n=!1,o=null,a=!1;$(document).on("mousedown.ctctrl",function(e){2==e.button&&(a=!0)}),$(document).on("mouseup.ctctrl",function(e){if(2==e.button&&(a=!1),n=!1,i.app.camera.enablePan=!0,i.app.camera.enableRotate=!0,i.cameraTarget.style.color="#1296db",o){var t=new THREE.Vector3(o[0],o[1],o[2]),r=new THREE.Vector3(i.cameraTarget.position[0],i.cameraTarget.position[1],i.cameraTarget.position[2]).clone().sub(t);i.app.camera.position=[i.app.camera.position[0]+r.x,i.app.camera.position[1]+r.y,i.app.camera.position[2]+r.z],i.app.camera.target=i.cameraTarget.position,o=null}}),$(document).on("mousemove.ctctrl",function(e){n&&(i.cameraTarget.position=i.app.camera.screenToWorld(e.pageX,e.pageY))}),this.cameraTarget.on("mouseenter",function(){1==i.draggable&&(i.cameraTarget.style.color="#FE7F0B")}),this.cameraTarget.on("mouseleave",function(){1!=i.draggable||n||(i.cameraTarget.style.color="#1296db")}),this.cameraTarget.on("mousedown",function(){1==i.draggable&&(n=!0,i.app.camera.enablePan=!1,i.app.camera.enableRotate=!1,i.cameraTarget.style.color="#FE7F0B",o=i.cameraTarget.position)}),this.app.on("update",function(e){a&&t()})}function t(){var e=i.app.camera.screenToWorld(i.app.domElement.clientWidth/2,i.app.domElement.clientHeight/2);i.cameraTarget.position=e}},t.prototype.onAdd=function(e){this.app=e,this.init()},t.prototype.onRemove=function(){$(document).off(".ctctrl"),this.cameraTarget&&this.cameraTarget.destroy()},t}(),yo=function(){function r(e,t){y(this,r),this._candidates=e,this._options=t||{},this._app=null,this._objects=[],this._previousObjects=[],this._started=!1}return r.prototype.onAdd=function(e){this._app=e,this._app.focus(),this._objects=new ye(this._app,[]),this._previousObjects=this._objects,this.start()},r.prototype.onRemove=function(){this.end()},r.prototype._start=function(e){if(e){this.candidates=this._candidates;var t=this._options.start;t&&t.call(this,{candidates:this.candidates});var i=this;this._app.camera.inputEnabled=!1,this._app.picker.startAreaPicking({x:e.x,y:e.y}),this._app.on("pick",".Thing",function(e){var t=i._options.select;if(t&&t.call(i,e),!e._stopPropagation){var r=i._options.outlineColor||"#FF8000";e.object.style.outlineColor=r}},"RectangleSelectControl_pick"),this._app.on("unpick",".Thing",function(e){var t=i._options.deselect;t&&t.call(i,e),e._stopPropagation||(e.object.style.outlineColor=null)},"RectangleSelectControl_unpick"),this._app.on(O.AreaPickEnd,function(e){i._previousObjects=i._objects,i._objects=i._app.picker.objects.concat()},"RectangleSelectControl_AreaPickEnd"),this._started=!0}},r.prototype._end=function(){if(this._started){this._started=!1,this._app.picker.endAreaPicking(),this._app.off("pick",".Thing","RectangleSelectControl_pick"),this._app.off("unpick",".Thing","RectangleSelectControl_unpick"),this._app.off(O.AreaPickEnd,null,"RectangleSelectControl_AreaPickEnd"),this._app.camera.inputEnabled=!0;var e=this._options.end;e&&e.call(this,{candidates:this.candidates})}},r.prototype.start=function(){var t=this;this._app.on("mousedown",function(e){0==e.button&&t._start(e)},"RectangleSelectControl_mousedown"),this._app.on("mouseup",function(e){0==e.button&&t._end()},"RectangleSelectControl_mouseup")},r.prototype.end=function(){this._end(),this._app.off("mousedown",null,"RectangleSelectControl_mousedown"),this._app.off("mouseup",null,"RectangleSelectControl_mouseup"),this._app.off("pick",".Thing","RectangleSelectControl_pick"),this._app.off("unpick",".Thing","RectangleSelectControl_unpick")},r.prototype.clear=function(){if(this._objects.length){for(var e=0;e<this._objects.length;e++){var t=this._objects,r=this._options.deselect;r&&r.call(t,{object:t})}this._objects.clear()}},l(r,[{key:"candidates",set:function(e){this._app.picker.areaCandidates=e},get:function(){return this._app.picker.areaCandidates}},{key:"options",set:function(e){this._options=e},get:function(){return this._options}},{key:"previousObjects",get:function(){return this._previousObjects}},{key:"objects",get:function(){return this._objects}}]),r}(),bo=function(){function e(){y(this,e),this.object=null,this.app=null,this._height=0,this._box=null,this._pickResults=null}return e.prototype._setupBox=function(){this._box&&(this.app.resourceManager.remove(this._box),this._box=null);var e=this.object.boundingBox.size,t=new THREE.BoxGeometry(e[0],e[1],e[2]),r=new THREE.EdgesGeometry(t);this._box=new THREE.LineSegments(r),this.object.node.add(this._box);var i=Z.parseVector3(this.object.boundingBox.center);this._box._setWorldPosition(i,!1,this.object.static);for(var n=[16711680,65280,255,0],o=0;o<4;o++){(t=new THREE.Geometry).vertices.push(new THREE.Vector3),t.vertices.push(new THREE.Vector3);var a=new THREE.LineBasicMaterial({color:n[o]}),s=new THREE.Line(t,a);s.visible=!1,this._box.add(s)}},e.prototype._useCenterMode=function(){var e=this.object.angles,t=THING.Math.abs(e[1]);return t<1e-5||!!THING.Math.isFloatEquals(t,90)||!!THING.Math.isFloatEquals(t,180)||!!THING.Math.isFloatEquals(t,270)},e.prototype._updatePickedResult=function(){for(var e=[new THREE.Raycaster,new THREE.Raycaster,new THREE.Raycaster,new THREE.Raycaster],t=[],r=this._box.geometry.attributes.position.array,i=0;i<r.length;i+=3){var n=new THREE.Vector3(r[i],r[i+1],r[i+2]);if(!(n.y<0)){for(var o=!1,a=0;a<t.length;a++)t[a].equals(n)&&(o=!0);o||t.push(n)}}var s,l,c,u;if(this.object.node.updateMatrixWorld(),this._useCenterMode()){var h=[];for(i=0;i<t.length;i++)h.push(t[i].clone());t[0].addVectors(h[0],h[1]).divideScalar(2),t[1].addVectors(h[1],h[2]).divideScalar(2),t[2].addVectors(h[2],h[3]).divideScalar(2),t[3].addVectors(h[3],h[0]).divideScalar(2)}for(i=0;i<t.length;i++){var p=(d=e[i]).ray.origin;p.set(t[i].x,this._height-this._box.position.y,t[i].z),p=this._box.localToWorld(p),(!s||p.x<s.ray.origin.x)&&(s=d),(!c||p.z<c.ray.origin.z)&&(c=d),(!l||p.x>l.ray.origin.x)&&(l=d),(!u||p.z>u.ray.origin.z)&&(u=d)}for(s.ray.direction.set(-1,0,0),c.ray.direction.set(0,0,-1),l.ray.direction.set(1,0,0),u.ray.direction.set(0,0,1),this._pickResults=[],i=0;i<e.length;i++){var d,f=(d=e[i]).intersectObject(this.app.scene,!0);for(a=0;a<f.length&&(g=f[a]).object.isChildOf(this.object.node);a++)f.splice(a--,1);this._pickResults.push({startPosition:d.ray.origin.toArray(),pickedPosition:null,pickedObject:null,distance:100,direction:d.ray.direction.toArray()});var m=this._pickResults[i];if(f.length){var g=f[0];m.pickedPosition=g.point.toArray(),m.pickedObject=this.app.objectManager.getAncestors(g.object),m.distance=g.distance}}var v=this._pickResults;for(i=0;i<v.length;i++){var y,b,x=v[i],E=this._box.children[i];if(y=Z.parseVector3(x.startPosition),x.pickedPosition)b=Z.parseVector3(x.pickedPosition);else{var _=new THREE.Vector3,w=Z.parseVector3(x.direction);_.addVectors(Z.parseVector3(x.startPosition),w.multiplyScalar(100)),b=_}y=E.worldToLocal(y),b=E.worldToLocal(b),E.geometry.vertices[0].copy(y),E.geometry.vertices[1].copy(b),E.geometry.verticesNeedUpdate=!0,E.geometry.elementsNeedUpdate=!0,E.computeLineDistances()}return this._pickResults},e.prototype.onAdd=function(e){this.object=e,this.app=e.app,this.height=this.object.boundingBox.size[1]/2},e.prototype.onRemove=function(){this._box&&(this.app.resourceManager.remove(this._box),this._box=null)},e.prototype.onUpdate=function(e){return!1},l(e,[{key:"height",set:function(e){this._height=e},get:function(){return this._height}},{key:"visible",set:function(e){this._box||this._setupBox(),this._box.visible=e},get:function(){return!!this._box&&this._box.visible}},{key:"lineVisible",set:function(t){this._box||this._setupBox(),this._box.children.forEach(function(e){e.visible=t})},get:function(){return!!this._box&&this._box.children[0].visible}},{key:"pickResults",get:function(){return this._updatePickedResult(),this._pickResults}}]),e}(),xo=function(){function e(){y(this,e),this._object=null,this._prevCameraInfo={}}return e.prototype.onAdd=function(e){this.app=e;var t=this.app.camera;this._prevCameraInfo={enablePan:t.enablePan,autoAdjustTarget:t.autoAdjustTarget,autoFixTargetOnWheel:t.autoFixTargetOnWheel,distanceLimited:t.distanceLimited,dampingFactor:t.dampingFactor},t.enablePan=!1,t.autoAdjustTarget=!1,t.autoFixTargetOnWheel=!1,t.dampingFactor=.05},e.prototype.onRemove=function(){var e=this.app.camera;for(var t in this._prevCameraInfo)e[t]=this._prevCameraInfo[t]},e.prototype.onUpdate=function(e){},e.prototype._getObject=function(e){var t=e.target;if(t)return t;var r=e.url;if(r){var i=this,n=e.time||1e3,o=e.distance||10,a=e.direction,s=e.complete;this.app.create({type:"Thing",url:r,position:this.getNextObjectPosition(e),nodeReady:function(e){setTimeout(function(){i.lookAt({target:e.object,time:n,distance:o,direction:a,complete:s})},10)}})}return null},e.prototype.getNextObjectPosition=function(e){if(e=e||{},this._object){var t=e.distance||10,r=this.app.camera.rightDirection;return-1===e.direction&&(r=THING.Math.negVector(r)),this._object.getWorldPosition({worldDirection:r,distance:t})}return[0,0,0]},e.prototype.lookAt=function(e){e=e||{};var t=this._getObject(e);if(t){var r=this,i=e.time||1e3,n=e.complete,o=this.app.camera,a=t.boundingBox.radius;if(this._object){var s=e.distance||10,l=(i=e.time||1e3,e.lerpType||THING.LerpType.Quartic.Out),c=o.rightDirection;-1===e.direction&&(c=THING.Math.negVector(c));var u=t.getWorldPosition({worldDirection:c,distance:s});t.position=u,t.lerpTo({from:{position:u},to:{position:[0,0,0]},time:i,lerpType:l},"modelViewControl_lerp_fadeIn"),t.fadeIn({time:i}),this._object.lerpTo({from:{position:this._object.position},to:{position:this._object.getWorldPosition({worldDirection:THING.Math.negVector(c),distance:s})},time:i,lerpType:l,stop:function(e){e.object.destroy()},complete:function(e){e.object.destroy(),n&&n.call(r,{})}},"modelViewControl_lerp_fadeOut"),this._object.fadeOut({time:i/2})}else o.flyTo({target:t,xAngle:0,yAngle:0,time:i,complete:function(){n&&n.call(r,{})}});this._object=t,o.distanceLimited=[.5*a,4*a]}},e}(),Eo=function(){function i(){y(this,i);var t=this;function e(e){Math[e]=function(){return console.warn("Please use THING.Math."+e+" to replace Math."+e),Z.callFuncByArguments(t,e,arguments)}}for(var r in this.__proto__)"constructor"!=r&&e(r);this.TOLERANCE=1e-5,this.E=Math.E,this.LN2=Math.LN2,this.LN10=Math.LN10,this.LOG2E=Math.LOG2E,this.LOG10E=Math.LOG10E,this.PI=Math.PI,this.SQRT1_2=Math.SQRT1_2,this.SQRT2=Math.SQRT2,this.abs=Math.abs,this.acos=Math.acos,this.acosh=Math.acosh,this.asin=Math.asin,this.asinh=Math.asinh,this.atan=Math.atan,this.atan2=Math.atan2,this.atanh=Math.atanh,this.cbrt=Math.cbrt,this.ceil=Math.ceil,this.clz32=Math.clz32,this.cos=Math.cos,this.cosh=Math.cosh,this.exp=Math.exp,this.expm1=Math.expm1,this.floor=Math.floor,this.fround=Math.fround,this.hypot=Math.hypot,this.imul=Math.imul,this.log=Math.log,this.log1p=Math.log1p,this.log2=Math.log2,this.log10=Math.log10,this.max=Math.max,this.min=Math.min,this.pow=Math.pow,this.random=Math.random,this.round=Math.round,this.sign=Math.sign,this.sin=Math.sin,this.sinh=Math.sinh,this.sqrt=Math.sqrt,this.tan=Math.tan,this.tanh=Math.tanh,this.trunc=Math.trunc}return i.prototype.ceilPowerOf2=function(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},i.prototype.floorPowerOf2=function(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))},i.prototype.isPowerOf2=function(e){return 0<e&&0==(e&e-1)},i.prototype.roundUpPowerOf2=function(e){return e--,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,++e},i.prototype.toInteger=function(e){return(e=+e)!=e?e=0:0!==e&&e!==1/0&&e!==-1/0&&(e=(0<e||-1)*Math.floor(Math.abs(e))),e},i.prototype.toHexNumberString=function(e){var t=(1<arguments.length&&void 0!==arguments[1]?arguments[1]:"00000000")+(e=e.toString(16));return t.substr(e.length,t.length)},i.prototype.clamp=function(e,t,r){return THREE.Math.clamp(e,t,r)},i.prototype.randomBoolean=function(){return!!(this.randomInt()%2)},i.prototype.randomFloat=function(e,t){return Math.random()*(t-e)+e},i.prototype.randomInt=function(e,t){return Math.floor(Math.random()*(t-e+1))+e},i.prototype.randomColor=function(){return this.randomInt(0,16777215)},i.prototype.randomFromArray=function(e){return e[this.randomInt(0,e.length-1)]},i.prototype.randomIndex=function(e){return e?this.randomInt(0,e-1):0},i.prototype.randomVector3=function(){var e=0,t=0,r=0;if(1==arguments.length)e=THREE.Math.randFloat(-range,range),t=THREE.Math.randFloat(-range,range),r=THREE.Math.randFloat(-range,range);else if(3==arguments.length){var i=arguments[0],n=arguments[1],o=arguments[2];e=THREE.Math.randFloat(-i,i),t=THREE.Math.randFloat(-n,n),r=THREE.Math.randFloat(-o,o)}else console.warn("Please provide the range to generate random position in THING.Math.randomVector3()");return[e,t,r]},i.prototype.lerp=function(e,t,r){return e+r*(t-e)},i.prototype.getDistance=function(e,t){var r=Z.parseVector3(e),i=Z.parseVector3(t);return r.distanceTo(i)},i.prototype.degToRad=function(e){return THREE.Math.degToRad(e)},i.prototype.radToDeg=function(e){return THREE.Math.radToDeg(e)},i.prototype.generateUUID=function(e){var t=THREE.Math.generateUUID();return e&&(t=t.replaceAll("-","")),t},i.prototype.equalsVector=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]},i.prototype.addVector=function(e,t){return Z.isArray(t)?[e[0]+t[0],e[1]+t[1],e[2]+t[2]]:Z.isNumber(t)?[e[0]+t,e[1]+t,e[2]+t]:void 0},i.prototype.subVector=function(e,t){return Z.isArray(t)?[e[0]-t[0],e[1]-t[1],e[2]-t[2]]:Z.isNumber(t)?[e[0]-t,e[1]-t,e[2]-t]:void 0},i.prototype.scaleVector=function(e,t){return Z.isArray(t)?[e[0]*t[0],e[1]*t[1],e[2]*t[2]]:Z.isNumber(t)?[e[0]*t,e[1]*t,e[2]*t]:void 0},i.prototype.divideVector=function(e,t){return Z.isArray(t)?[e[0]/t[0],e[1]/t[1],e[2]/t[2]]:Z.isNumber(t)?[e[0]/t,e[1]/t,e[2]/t]:void 0},i.prototype.dotVector=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},i.prototype.crossVector=function(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]},i.prototype.negVector=function(e){return[-e[0],-e[1],-e[2]]},i.prototype.normalizeVector=function(e){var t=1/this.getVectorLength(e);return[e[0]*t,e[1]*t,e[2]*t]},i.prototype.minVector=function(e){if(!e.length)return null;if(1===e.length)return e[0].concat();for(var t=e[0].concat(),r=1;r<e.length;r++){var i=e[r];t[0]=Math.min(t[0],i[0]),t[1]=Math.min(t[1],i[1]),t[2]=Math.min(t[2],i[2])}return t},i.prototype.maxVector=function(e){if(!e.length)return null;if(1===e.length)return e[0].concat();for(var t=e[0].concat(),r=1;r<e.length;r++){var i=e[r];t[0]=Math.max(t[0],i[0]),t[1]=Math.max(t[1],i[1]),t[2]=Math.max(t[2],i[2])}return t},i.prototype.getVectorLength=function(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2])},i.prototype.getVectorLengthSquared=function(e){return e[0]*e[0]+e[1]*e[1]+e[2]*e[2]},i.prototype.getArea=function(e){for(var t=[],r=0;r<e.length;r++){var i=Z.parseVector3(e[r]);t.push({x:i.x,y:i.z})}var n=THREE.ShapeUtils.area(t);return Math.abs(n)},i.prototype.fract=function(e){return e-Math.floor(e)},i.prototype.pointInPolygon=function(e,t){for(var r=e[0],i=e[1],n=!1,o=0,a=t.length-1;o<t.length;a=o++){var s=t[o][0],l=t[o][1],c=t[a][0],u=t[a][1];i<l!=i<u&&r<(c-s)*(i-l)/(u-l)+s&&(n=!n)}return n},i.prototype.swapArray=function(e,t,r){return e[t]=e.splice(r,1,e[t])[0],e},i.prototype.getDirection=function(e,t){var r=Z.parseVector3(e),i=Z.parseVector3(t),n=new THREE.Vector3;return n.subVectors(i,r),n.normalize(),n.toArray()},i.prototype.roundUp=function(e,t){if("number"!=typeof e)return e;for(var r=1;0<t;r*=10,t--);for(;t<0;r/=10,t++);return Math.round(e*r)/r},i.prototype.directionFromAlphaBeta=function(e,t){var r=e/180*Math.PI+Math.PI/2,i=-t/180*Math.PI+Math.PI/2,n=new THREE.Vector3,o=Math.sin(r);return n.x=o*Math.cos(i),n.y=-Math.cos(r),n.z=o*Math.sin(i),n.toArray()},i.prototype.getAngleBetweenVectors=function(e,t){var r=this.dotVector(e,t);return 1<r&&r<1+this.TOLERANCE?r=1:r<-1&&r>-1-this.TOLERANCE&&(r=-1),this.radToDeg(this.acos(r))},i.prototype.lonlat2World=function(e){var t=(1<arguments.length&&void 0!==arguments[1]?arguments[1]:0)+(2<arguments.length&&void 0!==arguments[2]?arguments[2]:6378e3),r=e[0],i=e[1],n=r/180*this.PI,o=i/180*this.PI,a=t*this.sin(o),s=t*this.cos(o);return[-s*this.cos(n),a,s*this.sin(n)]},i.prototype.world2Lonlat=function(e,t){t||(t=[0,0,0]);var r=this.subVector(e,t),i=r[1],n=r[2],o=[r[0],0,r[2]];r=this.normalizeVector(r),o=this.normalizeVector(o);var a=180-this.getAngleBetweenVectors(o,[1,0,0]),s=this.getAngleBetweenVectors(o,r);return n<0&&(a=-a),i<0&&(s=-s),[a,s,this.getDistance(e,t)-6378e3]},i.prototype.position2angles=function(e,t){null==t&&(t=0);var r=this.normalizeVector([0,1,0]),i=e.slice(0),n=this.normalizeVector(i),o=new THREE.Quaternion;o=o.setFromUnitVectors(new THREE.Vector3(r[0],r[1],r[2]),new THREE.Vector3(n[0],n[1],n[2]));var a=new THREE.Quaternion;a=(a=a.setFromAxisAngle(new THREE.Vector3(n[0],n[1],n[2]),t/180*Math.PI)).multiply(o);var s=new THREE.Euler;return[(s=s.setFromQuaternion(a,"XYZ",!1))._x/Math.PI*180,s._y/Math.PI*180,s._z/Math.PI*180]},i.prototype.getAnglesFromLonlat=function(e,t){var r=this.lonlat2World(e),i=e[0]+90;return void 0!==t&&(i-=t),this.position2angles(r,i)},i.prototype.isFloatEquals=function(e,t){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1e-4;return this.abs(e-t)<r},i.prototype.getLabelPosition=function(e,t){if(!e)return null;if(!e.length)return null;for(var r=0,i=[],n=0;n<e.length;n++){var o=e[n];i.push([o[0],o[2]]),r+=o[1]}r/=e.length;var a=new polylabel([i]);return[a[0],void 0!==t?t:r,a[1]]},i.prototype.distance=function(e,t){return console.warn("[Math] Please use 'THING.Math.getDistance' to replace 'Math.distance'"),THING.Math.getDistance(e,t)},i.prototype.addVector3=function(e,t){return console.warn("[Math] Please use 'THING.Math.addVector' to replace 'THING.Math.addVector3'"),THING.Math.addVector(e,t)},i.prototype.subVector3=function(e,t){return console.warn("[Math] Please use 'THING.Math.subVector' to replace 'THING.Math.subVector3'"),THING.Math.subVector(e,t)},i.prototype.minVector3=function(e){return console.warn("[Math] Please use 'THING.Math.minVector' to replace 'THING.Math.minVector3'"),THING.Math.minVector(e)},i.prototype.maxVector3=function(e){return console.warn("[Math] Please use 'THING.Math.maxVector' to replace 'THING.Math.maxVector3'"),THING.Math.maxVector3(e)},i}();t3d.Math=new Eo,e.REVISION="77d47d1520c2af7d99e83d2f585f3746b37016a0no",e.VERSION="1.2.4.8",e.COMPILETIME="Thu, 06 Jun 2019 09:55:44 GMT",e.App=eo,e.BaseObject=Ee,e.SubObject=to,e.Ground=qe,e.Facade=Te,e.Building=cr,e.Floor=It,e.Room=ur,e.Thing=Se,e.Box=Ce,e.Circle=Le,e.Sphere=Oe,e.Plane=He,e.Grid=Fe,e.Cylinder=ke,e.Tetrahedron=Ie,e.Frustum=je,e.Shape=Ne,e.Door=De,e.ElevatorDoor=Ue,e.Elevator=Ve,e.StairDoor=Be,e.Stair=ze,e.VideoSurvilance=Ge,e.Line=Mr,e.PolygonLine=Ur,e.RouteLine=Dr,e.Water=si,e.WebView=fi,e.TextRegion=mr,e.Fence=gr,e.CurveFence=vr,e.Region=yr,e.PolygonRegion=xr,e.Marker=di,e.Campus=ar,e.Group=Nt,e.CameraController=Cn,e.Selector=ye,e.Navigation=cn,e.factory=xi,e.StyleManager=Li,e.BaseStyle=pr,e.Helper=no,e.CompassControl=co,e.FlyControl=uo,e.WalkControl=po,e.WalkButtonControl=fo,e.MiniMapControl=go,e.AxisTransformControl=Un,e.CameraTargetControl=vo,e.RectangleSelectControl=yo,e.MeasurementControl=bo,e.ModelViewControl=xo,e.Mathics=Eo,e.TextKeyEncoder=t,e.Utils=Z,e.LerpType=S,e.CornerType=E,e.SpaceType=_,e.CameraProjectionType=R,e.CameraView=x,e.DistributionsType={Box:1,Sphere:2,Disc:3},e.BlendingType=w,e.WrapType={Repeat:"repeat",ClampToEdge:"clamptoedge",MirroredRepeat:"mirroredrepeat"},e.LoopType=P,e.DragState=T,e.AreaPickType=M,e.SkyBox={BlueSky:"BlueSky",MilkyWay:"MilkyWay",Night:"Night",SunCloud:"SunCloud"},e.IndependentControlType=A,e.LevelType={Unknown:"",Campus:"Campus",Building:"Building",Floor:"Floor",Room:"Room",Thing:"Thing"},e.KeyType=C,e.EventTag=L,e.EventType=O,e.DEFAULT_EXTENSIONS=$n,Object.defineProperty(e,"__esModule",{value:!0})});var THING=t3d;